<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css" integrity="sha256-no0c5ccDODBwp+9hSmV5VvPpKwHCpbVzXHexIkupM6U=" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js" integrity="sha256-a5YRB27CcBwBFcT5EF/f3E4vzIqyHrSR878nseNYw64=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;gcdd1993.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.5.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:true,&quot;lazyload&quot;:false,&quot;pangu&quot;:true,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;},&quot;path&quot;:&quot;&#x2F;search.xml&quot;,&quot;localsearch&quot;:{&quot;enable&quot;:true,&quot;trigger&quot;:&quot;auto&quot;,&quot;top_n_per_article&quot;:1,&quot;unescape&quot;:false,&quot;preload&quot;:false}}</script><script src="/js/config.js"></script>
<meta name="description" content="一寸光阴一寸金">
<meta property="og:type" content="website">
<meta property="og:title" content="寸土">
<meta property="og:url" content="https://gcdd1993.github.io/page/4/index.html">
<meta property="og:site_name" content="寸土">
<meta property="og:description" content="一寸光阴一寸金">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Gcdd1993">
<meta property="article:tag" content="IT,Java,Scala,Kotlin">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://gcdd1993.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;page&#x2F;4&#x2F;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>寸土</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="寸土" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">寸土</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Gcdd1993"
      src="/asserts/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Gcdd1993</p>
  <div class="site-description" itemprop="description">一寸光阴一寸金</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/gcdd1993" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gcdd1993" rel="noopener" target="_blank"><i class="fa fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gcwm99@gmail.com" title="E-Mail → mailto:gcwm99@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/gcdd1993" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/5479/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/5479/" class="post-title-link" itemprop="url">使用Tesseract-Ocr识别数字</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-02 01:59:30" itemprop="dateCreated datePublished" datetime="2019-06-02T01:59:30+08:00">2019-06-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/5479/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/5479/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/tesseract">Tesseract-Ocr</a>是我在编写爬虫项目中，用来识别图片（不是验证码）的本地解决方案（因为客户不想使用API识别，太贵），识别率目前达到了100%，可以说是相当了得，当然了，这取决于使用的<code>traineddata</code>。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/5479/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/61241/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/61241/" class="post-title-link" itemprop="url">理解一致性Hash算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-29 17:13:47" itemprop="dateCreated datePublished" datetime="2019-05-29T17:13:47+08:00">2019-05-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/61241/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/61241/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote>
<p>一致性哈希算法在1997年由麻省理工学院的Karger等人在解决分布式Cache中提出的，设计目标是为了解决因特网中的热点(Hot spot)问题，初衷和CARP十分类似。一致性哈希修正了CARP使用的简单哈希算法带来的问题，使得DHT可以在P2P环境中真正得到应用。</p>
</blockquote>
<p>现在一致性hash算法在分布式系统中也得到了广泛应用，研究过memcached缓存数据库的人都知道，memcached服务器端本身不提供分布式cache的一致性，而是由客户端来提供，具体在计算一致性hash时采用如下步骤：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/61241/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/52703/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/52703/" class="post-title-link" itemprop="url">理解Nginx负载均衡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-29 10:30:45" itemprop="dateCreated datePublished" datetime="2019-05-29T10:30:45+08:00">2019-05-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/52703/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/52703/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>工作以来，一直都在使用Nginx作为负载均衡服务器，但是关于Nginx的负载均衡算法一直没有深入理解过，这次好好的整理下。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/52703/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/1091/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/1091/" class="post-title-link" itemprop="url">Redis 常用命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-26 11:41:40" itemprop="dateCreated datePublished" datetime="2019-05-26T11:41:40+08:00">2019-05-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/1091/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/1091/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Redis提供了丰富的命令（command）对数据库和各种数据类型进行操作，这些command可以在Linux终端使用。在编程时，比如各类语言包，这些命令都有对应的方法。下面将Redis提供的命令做一总结。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/1091/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/38807/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/38807/" class="post-title-link" itemprop="url">Redis 数据类型及操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-25 23:59:44" itemprop="dateCreated datePublished" datetime="2019-05-25T23:59:44+08:00">2019-05-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/38807/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/38807/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>作为Key-value型数据库，Redis也提供了键（Key）和键值（Value）的映射关系。但是，除了常规的数值或<a href="#strings%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89">字符串</a>，Redis的键值还可以是以下形式之一：
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/38807/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/12805/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/12805/" class="post-title-link" itemprop="url">Ubuntu切换为阿里镜像源</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-25 23:45:14" itemprop="dateCreated datePublished" datetime="2019-05-25T23:45:14+08:00">2019-05-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/12805/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/12805/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>550</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在VM虚拟机搭建Ubuntu系统学习或者测试时，常常要使用<code>apt</code>安装测试，但是由于系统自带的下载源在国外服务器上，下载速度慢的无法忍受。所以我们需要切换为国内镜像源，能显著加快安装包下载速度。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/12805/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/60138/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/60138/" class="post-title-link" itemprop="url">Cassandra学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-22 15:42:04" itemprop="dateCreated datePublished" datetime="2019-05-22T15:42:04+08:00">2019-05-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/60138/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/60138/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>17k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>按照<a href="https://gcdd1993.github.io/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0%EF%BC%88%E9%83%A8%E7%BD%B2%E7%AF%87%EF%BC%89/#more">Cassandra集群部署</a>搭建两台测试机，环境信息如下：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>IP</th>
<th>数据中心名称</th>
</tr>
</thead>
<tbody><tr>
<td>node-01</td>
<td>192.168.198.130</td>
<td>datacenter1</td>
</tr>
<tr>
<td>node-02</td>
<td>192.168.198.131</td>
<td>datacenter1</td>
</tr>
</tbody></table>
<h1 id="Keyspace"><a href="#Keyspace" class="headerlink" title="Keyspace"></a>Keyspace</h1><h2 id="创建Keyspace"><a href="#创建Keyspace" class="headerlink" title="创建Keyspace"></a>创建Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_keyspace_statement ::=  CREATE KEYSPACE [ IF NOT EXISTS ] keyspace_name WITH options</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## 使用SimpleStrategy复制策略</span><br><span class="line">CREATE KEYSPACE excelsior</span><br><span class="line">    WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125;;</span><br><span class="line"></span><br><span class="line">## 使用NetworkTopologyStrategy复制策略</span><br><span class="line"># 1. 确认分区名称</span><br><span class="line">$ nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># 2. 使用NetworkTopologyStrategy复制策略创建keyspace</span><br><span class="line">CREATE KEYSPACE excalibur</span><br><span class="line">    WITH replication = &#123;&#x27;class&#x27;: &#x27;NetworkTopologyStrategy&#x27;, &#x27;DC1&#x27; : 1, &#x27;DC2&#x27; : 3&#125;</span><br><span class="line">    AND durable_writes = false;</span><br></pre></td></tr></table></figure>

<h2 id="使用Keyspace"><a href="#使用Keyspace" class="headerlink" title="使用Keyspace"></a>使用Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use_statement ::=  USE keyspace_name</span><br></pre></td></tr></table></figure>

<h2 id="修改Keyspace（replication-factor）"><a href="#修改Keyspace（replication-factor）" class="headerlink" title="修改Keyspace（replication factor）"></a>修改Keyspace（replication factor）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter_keyspace_statement ::=  ALTER KEYSPACE keyspace_name WITH options</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER KEYSPACE excelsior </span><br><span class="line">	WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 4&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="查看Keyspace"><a href="#查看Keyspace" class="headerlink" title="查看Keyspace"></a>查看Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE KEYSPACE &lt;keyspace name&gt;;</span><br></pre></td></tr></table></figure>

<p>使用该语句查看创建的键空间是否正确：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE KEYSPACE excelsior;</span><br><span class="line"></span><br><span class="line">CREATE KEYSPACE excelsior WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125; AND durable_writes = true;</span><br></pre></td></tr></table></figure>

<h2 id="删除Keyspace"><a href="#删除Keyspace" class="headerlink" title="删除Keyspace"></a>删除Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop_keyspace_statement ::=  DROP KEYSPACE [ IF EXISTS ] keyspace_name</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DROP KEYSPACE excelsior;</span><br><span class="line">DESCRIBE excelsior;</span><br><span class="line"></span><br><span class="line">&#x27;excelsior&#x27; not found in keyspaces</span><br></pre></td></tr></table></figure>

<h1 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h1><h2 id="创建Table"><a href="#创建Table" class="headerlink" title="创建Table"></a>创建Table</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create_table_statement ::=  CREATE TABLE [ IF NOT EXISTS ] table_name</span><br><span class="line">                            &#x27;(&#x27;</span><br><span class="line">                                column_definition</span><br><span class="line">                                ( &#x27;,&#x27; column_definition )*</span><br><span class="line">                                [ &#x27;,&#x27; PRIMARY KEY &#x27;(&#x27; primary_key &#x27;)&#x27; ]</span><br><span class="line">                            &#x27;)&#x27; [ WITH table_options ]</span><br><span class="line">column_definition      ::=  column_name cql_type [ STATIC ] [ PRIMARY KEY]</span><br><span class="line">primary_key            ::=  partition_key [ &#x27;,&#x27; clustering_columns ]</span><br><span class="line">partition_key          ::=  column_name</span><br><span class="line">                            | &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27;</span><br><span class="line">clustering_columns     ::=  column_name ( &#x27;,&#x27; column_name )*</span><br><span class="line">table_options          ::=  COMPACT STORAGE [ AND table_options ]</span><br><span class="line">                            | CLUSTERING ORDER BY &#x27;(&#x27; clustering_order &#x27;)&#x27; [ AND table_options ]</span><br><span class="line">                            | options</span><br><span class="line">clustering_order       ::=  column_name (ASC | DESC) ( &#x27;,&#x27; column_name (ASC | DESC) )*</span><br></pre></td></tr></table></figure>

<p>创建Table必须指定主键，主键是用于在表中唯一标识某一行，可以是一列或多列。</p>
<p>示例，在<code>excelsior</code>键空间创建一张名为<code>excelsior_alt_stats </code>的表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE excelsior.excelsior_alt_stats (</span><br><span class="line">	id UUID PRIMARY KEY,</span><br><span class="line">	lastname text,</span><br><span class="line">	birthday timestamp,</span><br><span class="line">	nationality text,</span><br><span class="line">	weight text,</span><br><span class="line">	height text</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>cassandra还支持collection（map, set, 或者 list）类型作为列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE excelsior.whimsey ( </span><br><span class="line">    id UUID PRIMARY KEY, </span><br><span class="line">    lastname text, </span><br><span class="line">    excelsior_teams set&lt;text&gt;, </span><br><span class="line">    events list&lt;text&gt;, </span><br><span class="line">    teams map&lt;int,text&gt; </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>甚至是嵌套的元组类型（tuple）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE excelsior.route (</span><br><span class="line">    race_id int, </span><br><span class="line">    race_name text, </span><br><span class="line">    point_id int, </span><br><span class="line">    lat_long tuple&lt;text, tuple&lt;float,float&gt;&gt;, </span><br><span class="line">    PRIMARY KEY (race_id, point_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>更多数据类型请参阅下一节<a href="#Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">Cassandra数据结构</a></p>
<h3 id="静态列"><a href="#静态列" class="headerlink" title="静态列"></a>静态列</h3><p>某些列可以在表定义中声明为STATIC。静态的列将由属于同一分区（具有相同分区键）的所有行“共享”。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t (</span><br><span class="line">    pk int,</span><br><span class="line">    t int,</span><br><span class="line">    v text,</span><br><span class="line">    s text static,</span><br><span class="line">    PRIMARY KEY (pk, t)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO t (pk, t, v, s) VALUES (0, 0, &#x27;val0&#x27;, &#x27;static0&#x27;);</span><br><span class="line">INSERT INTO t (pk, t, v, s) VALUES (0, 1, &#x27;val1&#x27;, &#x27;static1&#x27;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM t;</span><br><span class="line">   pk | t | v      | s</span><br><span class="line">  ----+---+--------+-----------</span><br><span class="line">   0  | 0 | &#x27;val0&#x27; | &#x27;static1&#x27;</span><br><span class="line">   0  | 1 | &#x27;val1&#x27; | &#x27;static1&#x27;</span><br><span class="line">   </span><br><span class="line">## 所有记录中的静态列将永远展示最后一次更新的值   </span><br></pre></td></tr></table></figure>

<h2 id="修改Table"><a href="#修改Table" class="headerlink" title="修改Table"></a>修改Table</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alter_table_statement   ::=  ALTER TABLE table_name alter_table_instruction</span><br><span class="line">alter_table_instruction ::=  ADD column_name cql_type ( &#x27;,&#x27; column_name cql_type )*</span><br><span class="line">                             | DROP column_name ( column_name )*</span><br><span class="line">                             | WITH options</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE addamsFamily ADD gravesite varchar;</span><br><span class="line"></span><br><span class="line">ALTER TABLE addamsFamily</span><br><span class="line">       WITH comment = &#x27;A most excellent and useful table&#x27;;</span><br></pre></td></tr></table></figure>

<p>修改Table可以：</p>
<ol>
<li>向表中添加新列（通过ADD指令）。请注意，无法更改表的主键，因此新添加的列将不会成为主键的一部分。</li>
<li>从表中删除列。这会丢弃列及其所有内容。</li>
<li>更改一些表选项（通过WITH指令）。支持的选项与创建表时相同（在创建后无法更改的COMPACT STORAGE和CLUSTERING ORDER之外）。</li>
</ol>
<h2 id="删除Table"><a href="#删除Table" class="headerlink" title="删除Table"></a>删除Table</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop_table_statement ::=  DROP TABLE [ IF EXISTS ] table_name</span><br></pre></td></tr></table></figure>

<h2 id="截断Table（清空表数据）"><a href="#截断Table（清空表数据）" class="headerlink" title="截断Table（清空表数据）"></a>截断Table（清空表数据）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate_statement ::=  TRUNCATE [ TABLE ] table_name</span><br></pre></td></tr></table></figure>

<p>由于表是唯一可以在当前截断的对象，因此可以省略TABLE关键字。</p>
<p>截断表会永久删除表中的所有现有数据，但不会删除表本身。</p>
<h1 id="Cassandra数据结构"><a href="#Cassandra数据结构" class="headerlink" title="Cassandra数据结构"></a>Cassandra数据结构</h1><blockquote>
<p>CQL是一种类型化语言，支持丰富的数据类型集，包括本地类型，集合类型，用户定义类型，元组类型和自定义类型：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cql_type ::=  native_type | collection_type | user_defined_type | tuple_type | custom_type</span><br></pre></td></tr></table></figure>

<h2 id="本地类型（Native-Types）"><a href="#本地类型（Native-Types）" class="headerlink" title="本地类型（Native Types）"></a>本地类型（Native Types）</h2><table>
<thead>
<tr>
<th>类型</th>
<th>常量支持</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ascii</td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>ASCII字符串</td>
</tr>
<tr>
<td><code>bigint</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>64位无符号整数</td>
</tr>
<tr>
<td><code>blob</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-blob"><code>blob</code></a></td>
<td>任意字节（无验证）</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-boolean"><code>boolean</code></a></td>
<td><code>true</code>或<code>false</code></td>
</tr>
<tr>
<td><code>counter</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>计数器列（64位有符号值）</td>
</tr>
<tr>
<td><code>date</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>， <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>日期（没有相应的时间值）</td>
</tr>
<tr>
<td><code>decimal</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>， <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>十进制可变精度</td>
</tr>
<tr>
<td><code>double</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a> <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>64位IEEE-754浮点</td>
</tr>
<tr>
<td><code>duration</code></td>
<td><code>duration</code></td>
<td>持续时间（纳秒精度）</td>
</tr>
<tr>
<td><code>float</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>， <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>32位IEEE-754浮点</td>
</tr>
<tr>
<td><code>inet</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>IP地址，IPv4（4字节长）或IPv6（16字节长）</td>
</tr>
<tr>
<td><code>int</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>32位无符号整数</td>
</tr>
<tr>
<td><code>smallint</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>16位有符号整数</td>
</tr>
<tr>
<td><code>text</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>UTF8编码的字符串</td>
</tr>
<tr>
<td><code>time</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>， <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>具有纳秒精度的时间（没有相应的日期值）</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>， <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>时间戳（日期和时间），精度为毫秒</td>
</tr>
<tr>
<td><code>timeuuid</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-uuid"><code>uuid</code></a></td>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>（版本1），通常用作“无冲突”时间戳</td>
</tr>
<tr>
<td><code>tinyint</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>8位有符号整数</td>
</tr>
<tr>
<td><code>uuid</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-uuid"><code>uuid</code></a></td>
<td>一个<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>（任何版本）</td>
</tr>
<tr>
<td><code>varchar</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>UTF8编码的字符串</td>
</tr>
<tr>
<td><code>varint</code></td>
<td><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>任意精度整数</td>
</tr>
</tbody></table>
<p>其中需要注意的是时间类型：</p>
<h3 id="timestamps"><a href="#timestamps" class="headerlink" title="timestamps"></a>timestamps</h3><blockquote>
<p>时间戳类型的值被编码为64位有符号整数，表示自标准基准时间（称为纪元：1970年1月1日格林威治标准时间00:00:00）以来的毫秒数。</p>
</blockquote>
<ul>
<li><code>1299038700000</code></li>
<li><code>&#39;2011-02-03 04:05+0000&#39;</code></li>
<li><code>&#39;2011-02-03 04:05:00+0000&#39;</code></li>
<li><code>&#39;2011-02-03 04:05:00.000+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05:00+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05:00.000+0000&#39;</code></li>
</ul>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM point</span><br><span class="line">WHERE ts = &#x27;2018-11-15 00:00:30.557+0000&#x27;;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM point</span><br><span class="line">WHERE ts = 1542211230557;</span><br></pre></td></tr></table></figure>

<p>其中，<code>+0000</code>是RFC 822 4-digit时区规范，<code>+0000</code>指GMT。美国太平洋标准时间为<code>-0800</code>，中国北京标准时间为<code>+8000</code>，官方建议<strong>每次插入查询都带上时区</strong>，不加的话，默认是使用Cassandra节点配置的时区，可能会出现时区不一致导致的查询失败问题。</p>
<h3 id="dates"><a href="#dates" class="headerlink" title="dates"></a>dates</h3><blockquote>
<p> 日期类型的值被编码为32位无符号整数，表示在该范围的中心处具有“纪元”的天数（2^31）。大纪元是1970年1月1日。</p>
</blockquote>
<p>至于时间戳，日期可以作为整数或使用日期字符串输入。在后一种情况下，格式应为<code>yyyy-mm-dd</code>（例如’2011-02-03’）。</p>
<h3 id="times"><a href="#times" class="headerlink" title="times"></a>times</h3><blockquote>
<p>时间类型的值被编码为64位有符号整数，表示自午夜以来的纳秒数。</p>
</blockquote>
<p>对于时间戳，可以以整数或表示时间的字符串的形式输入时间。在后一种情况下，格式应为<code>hh:mm:ss [.fffffffff]</code>（其中亚秒精度是可选的，如果提供，则可以小于纳秒）。例如，以下是一段时间内的有效输入：</p>
<ul>
<li><code>&#39;08:12:54&#39;</code></li>
<li><code>&#39;08:12:54.123&#39;</code></li>
<li><code>&#39;08:12:54.123456&#39;</code></li>
<li><code>&#39;08:12:54.123456789&#39;</code></li>
</ul>
<h3 id="durations"><a href="#durations" class="headerlink" title="durations"></a>durations</h3><blockquote>
<p>持续时间类型的值被编码为3个有符号整数的可变长度。这是因为一个月的天数可以改变，一天可以有23或25小时，具体取决于夏令时。</p>
<ul>
<li><p>第一个整数表示月数（32位整数）</p>
</li>
<li><p>第二个表示天数（32位整数）</p>
</li>
<li><p>第三个表示纳秒数（64位整数）</p>
</li>
</ul>
</blockquote>
<ol>
<li>支持的单位：</li>
</ol>
<ul>
<li><code>y</code>: 年(12 月)</li>
<li><code>mo</code>: 月 (1 月)</li>
<li><code>w</code>: 周(7 天)</li>
<li><code>d</code>: 天(1 天)</li>
<li><code>h</code>: 小时(3,600,000,000,000 纳秒)</li>
<li><code>m</code>: 分钟(60,000,000,000 纳)</li>
<li><code>s</code>: 秒(1,000,000,000 纳)</li>
<li><code>ms</code>: 毫秒(1,000,000 纳)</li>
<li><code>us</code> or <code>µs</code> : 微妙(1000 纳)</li>
<li><code>ns</code>: 纳秒(1 纳)</li>
</ul>
<ol start="2">
<li>ISO 8601格式：<code>P[n]Y[n]M[n]DT[n]H[n]M[n]S or P[n]W</code></li>
<li>ISO 8601替代格式：<code>P[YYYY]-[MM]-[DD]T[hh]:[mm]:[ss]</code></li>
</ol>
<p>插入示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;Christopher Froome&#x27;, &#x27;Tour de France&#x27;, 89h4m48s);</span><br><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;BARDET Romain&#x27;, &#x27;Tour de France&#x27;, PT89H8M53S);</span><br><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;QUINTANA Nairo&#x27;, &#x27;Tour de France&#x27;, P0000-00-00T89:09:09);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>持续时间列不能作为主键。这是由于无法精确确认持续时间。如果没有日期上下文，实际上不可能知道1个月是否大于29天。</p>
<p>1天的持续时间也不等于24h，因为持续时间类型需要支持夏令时。</p>
</blockquote>
<h2 id="集合类型（Collections）"><a href="#集合类型（Collections）" class="headerlink" title="集合类型（Collections）"></a>集合类型（Collections）</h2><p>cassandra支持三种类型的集合：<a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/types.html#maps">Maps</a>, <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/types.html#sets">Sets</a> and <a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/types.html#lists">Lists</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">collection_type ::=  MAP &#x27;&lt;&#x27; cql_type &#x27;,&#x27; cql_type &#x27;&gt;&#x27;</span><br><span class="line">                     | SET &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27;</span><br><span class="line">                     | LIST &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27;</span><br></pre></td></tr></table></figure>

<p>可以这样输入集合类型的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collection_literal ::=  map_literal | set_literal | list_literal</span><br><span class="line">map_literal        ::=  &#x27;&#123;&#x27; [ term &#x27;:&#x27; term (&#x27;,&#x27; term : term)* ] &#x27;&#125;&#x27;</span><br><span class="line">set_literal        ::=  &#x27;&#123;&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;&#125;&#x27;</span><br><span class="line">list_literal       ::=  &#x27;[&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;]&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h3><blockquote>
<p>Maps是一组（有序）键值对，其中键是唯一的，并且按其键排序。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    name text,</span><br><span class="line">    favs map&lt;text, text&gt; // A map of text keys, and text values</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO users (id, name, favs)</span><br><span class="line">           VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">// Replace the existing map entirely.</span><br><span class="line">UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<p>另外，Maps还具有一些高级特性：</p>
<ul>
<li>更新或插入一个或多个元素</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users SET favs[&#x27;author&#x27;] = &#x27;Ed Poe&#x27; WHERE id = &#x27;jsmith&#x27;;</span><br><span class="line">UPDATE users SET favs = favs + &#123; &#x27;movie&#x27; : &#x27;Cassablanca&#x27;, &#x27;band&#x27; : &#x27;ZZ Top&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除一个或多个元素（如果一个元素不存在，删除它是一个无效操作但不会抛出错误）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE favs[&#x27;author&#x27;] FROM users WHERE id = &#x27;jsmith&#x27;;</span><br><span class="line">UPDATE users SET favs = favs - &#123; &#x27;movie&#x27;, &#x27;band&#x27;&#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h3><blockquote>
<p> Sets是唯一值的（已排序）集合。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    name text,</span><br><span class="line">    favs map&lt;text, text&gt; // A map of text keys, and text values</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO users (id, name, favs)</span><br><span class="line">           VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">// Replace the existing map entirely.</span><br><span class="line">UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<p>另外，Sets也具有一些高级特性：</p>
<ul>
<li>添加一个或多个元素（因为这是一个集合，插入一个已存在的元素是一个无效操作）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE images SET tags = tags + &#123; &#x27;gray&#x27;, &#x27;cuddly&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除一个或多个元素（如果一个元素不存在，删除它是一个无效操作但不会抛出错误）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE images SET tags = tags - &#123; &#x27;cat&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><blockquote>
<p>Lists是非唯一值的（已排序）集合，其中元素按列表中的位置排序。它与Sets的区别就在于是否是唯一值。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE plays (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    game text,</span><br><span class="line">    players int,</span><br><span class="line">    scores list&lt;int&gt; // A list of integers</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">INSERT INTO plays (id, game, players, scores)</span><br><span class="line">           VALUES (&#x27;123-afde&#x27;, &#x27;quake&#x27;, 3, [17, 4, 2]);</span><br><span class="line"></span><br><span class="line">// Replace the existing list entirely</span><br><span class="line">UPDATE plays SET scores = [ 3, 9, 4] WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>另外，Lists同样也具有一些高级特性：</p>
<ul>
<li>在列表头或尾添加元素</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE plays SET players = 5, scores = scores + [ 14, 21 ] WHERE id = &#x27;123-afde&#x27;;</span><br><span class="line">UPDATE plays SET players = 6, scores = [ 3 ] + scores WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>💡该操作不是幂等的，特别是在其中一个操作超时时，重试操作是不安全的，可能会导致同一数据插入两次。</p>
<ul>
<li>在列表中指定下标处设置值。该列表必须长度大于此下标，否则将抛出列表太小的错误</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE plays SET scores[1] = 7 WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过列表指定下标删除元素。该列表必须长度大于此下标，否则将抛出列表太小的错误。此外，当操作从列表中删除元素时，列表大小将减1，从而改变此下标之后所有元素的位置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE scores[1] FROM plays WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除列表中指定下标之间的所有元素</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE plays SET scores = scores - [ 12, 21 ] WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>💡以上2,3,4操作会出现内部的<code> read-before-write</code>，会比通常的更新消耗更多的资源，所以尽量使用<a href="#Sets">Sets</a>代替Lists。</p>
<h2 id="用户自定义类型（User-Defined-Types）"><a href="#用户自定义类型（User-Defined-Types）" class="headerlink" title="用户自定义类型（User-Defined Types）"></a>用户自定义类型（User-Defined Types）</h2><blockquote>
<p>CQL支持用户定义类型（以下简称UDT）。可以使用下面<code>create_type_statement</code>，<code>alter_type_statement</code>和<code>drop_type_statement</code>创建，修改和删除此类型。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_defined_type ::=  udt_name</span><br><span class="line">udt_name          ::=  [ keyspace_name &#x27;.&#x27; ] identifier</span><br></pre></td></tr></table></figure>

<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create_type_statement ::=  CREATE TYPE [ IF NOT EXISTS ] udt_name</span><br><span class="line">                               &#x27;(&#x27; field_definition ( &#x27;,&#x27; field_definition )* &#x27;)&#x27;</span><br><span class="line">field_definition      ::=  identifier cql_type</span><br></pre></td></tr></table></figure>

<p>UDT有一个名称（用于声明该类型的列），是一组命名和类型字段。字段名称可以是任何类型，包括集合或其他UDT。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TYPE phone (</span><br><span class="line">    country_code int,</span><br><span class="line">    number text,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE TYPE address (</span><br><span class="line">    street text,</span><br><span class="line">    city text,</span><br><span class="line">    zip text,</span><br><span class="line">    phones map&lt;text, phone&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE TABLE user (</span><br><span class="line">    name text PRIMARY KEY,</span><br><span class="line">    addresses map&lt;text, frozen&lt;address&gt;&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>💡注意</p>
<ul>
<li>尝试创建现有类型时请使用<code>IF NOT EXISTS</code>选项，否则将会抛出错误。</li>
<li>UDT本质上绑定到创建它的键空间，并且只能在该键空间中使用。在创建时，如果类型名称以键空间名称为前缀，则在该键空间中创建它。否则，它将在当前键空间中创建。</li>
<li>从Cassandra 4.0开始，在大多数情况下必须冻结UDT，因此在上面的表定义中冻结了<code>&lt;address&gt;</code>。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.datastax.com/en/archived/cql/3.1/cql/cql_reference/collection_type_r.html">冻结</a>部分。</li>
</ul>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter_type_statement    ::=  ALTER TYPE udt_name alter_type_modification</span><br><span class="line">alter_type_modification ::=  ADD field_definition</span><br><span class="line">                             | RENAME identifier TO identifier ( identifier TO identifier )*</span><br></pre></td></tr></table></figure>

<p>修改一个UDT，可以：</p>
<ol>
<li>在类型中添加一个新字段</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TYPE address ADD country text</span><br></pre></td></tr></table></figure>

<p>请注意：新添加的字段在之前的记录中，都将被置为NULL。</p>
<ol start="2">
<li>重命名该类型的字段</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TYPE address RENAME zip TO zipcode</span><br></pre></td></tr></table></figure>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop_type_statement ::=  DROP TYPE [ IF EXISTS ] udt_name</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udt_literal ::=  &#x27;&#123;&#x27; identifier &#x27;:&#x27; term ( &#x27;,&#x27; identifier &#x27;:&#x27; term )* &#x27;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>使用UDT有点像<a href="#Maps">Maps</a>，例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user (name, addresses)</span><br><span class="line">          VALUES (&#x27;z3 Pr3z1den7&#x27;, &#123;</span><br><span class="line">              &#x27;home&#x27; : &#123;</span><br><span class="line">                  street: &#x27;1600 Pennsylvania Ave NW&#x27;,</span><br><span class="line">                  city: &#x27;Washington&#x27;,</span><br><span class="line">                  zip: &#x27;20500&#x27;,</span><br><span class="line">                  phones: &#123; &#x27;cell&#x27; : &#123; country_code: 1, number: &#x27;202 456-1111&#x27; &#125;,</span><br><span class="line">                            &#x27;landline&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#x27;work&#x27; : &#123;</span><br><span class="line">                  street: &#x27;1600 Pennsylvania Ave NW&#x27;,</span><br><span class="line">                  city: &#x27;Washington&#x27;,</span><br><span class="line">                  zip: &#x27;20500&#x27;,</span><br><span class="line">                  phones: &#123; &#x27;fax&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="元组（Tuples）"><a href="#元组（Tuples）" class="headerlink" title="元组（Tuples）"></a>元组（Tuples）</h2><blockquote>
<p>CQL还支持元组和元组类型（元素可以是不同类型），类似于匿名的UDT或者是Scala的Tuple类型。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tuple_type    ::=  TUPLE &#x27;&lt;&#x27; cql_type ( &#x27;,&#x27; cql_type )* &#x27;&gt;&#x27;</span><br><span class="line">tuple_literal ::=  &#x27;(&#x27; term ( &#x27;,&#x27; term )* &#x27;)&#x27;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE durations (</span><br><span class="line">    event text,</span><br><span class="line">    duration tuple&lt;int, text&gt;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">INSERT INTO durations (event, duration) VALUES (&#x27;ev1&#x27;, (3, &#x27;hours&#x27;));</span><br></pre></td></tr></table></figure>

<h2 id="自定义类型（Custom-Types）"><a href="#自定义类型（Custom-Types）" class="headerlink" title="自定义类型（Custom Types）"></a>自定义类型（Custom Types）</h2><blockquote>
<p>自定义类型主要是为了<strong>兼容老项目，不建议使用</strong>。使用已有的类型加上用户自定义类型（UDT）就够了。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">custom_type ::=  string</span><br></pre></td></tr></table></figure>

<h1 id="数据增删改查（CRUD）"><a href="#数据增删改查（CRUD）" class="headerlink" title="数据增删改查（CRUD）"></a>数据增删改查（CRUD）</h1><h2 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">select_statement ::=  SELECT [ JSON | DISTINCT ] ( select_clause | &#x27;*&#x27; )</span><br><span class="line">                      FROM table_name</span><br><span class="line">                      [ WHERE where_clause ]</span><br><span class="line">                      [ GROUP BY group_by_clause ]</span><br><span class="line">                      [ ORDER BY ordering_clause ]</span><br><span class="line">                      [ PER PARTITION LIMIT (integer | bind_marker) ]</span><br><span class="line">                      [ LIMIT (integer | bind_marker) ]</span><br><span class="line">                      [ ALLOW FILTERING ]</span><br><span class="line">select_clause    ::=  selector [ AS identifier ] ( &#x27;,&#x27; selector [ AS identifier ] )</span><br><span class="line">selector         ::=  column_name</span><br><span class="line">                      | term</span><br><span class="line">                      | CAST &#x27;(&#x27; selector AS cql_type &#x27;)&#x27;</span><br><span class="line">                      | function_name &#x27;(&#x27; [ selector ( &#x27;,&#x27; selector )* ] &#x27;)&#x27;</span><br><span class="line">                      | COUNT &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;</span><br><span class="line">where_clause     ::=  relation ( AND relation )*</span><br><span class="line">relation         ::=  column_name operator term</span><br><span class="line">                      &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator tuple_literal</span><br><span class="line">                      TOKEN &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator term</span><br><span class="line">operator         ::=  &#x27;=&#x27; | &#x27;&lt;&#x27; | &#x27;&gt;&#x27; | &#x27;&lt;=&#x27; | &#x27;&gt;=&#x27; | &#x27;!=&#x27; | IN | CONTAINS | CONTAINS KEY</span><br><span class="line">group_by_clause  ::=  column_name ( &#x27;,&#x27; column_name )*</span><br><span class="line">ordering_clause  ::=  column_name [ ASC | DESC ] ( &#x27;,&#x27; column_name [ ASC | DESC ] )*</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, occupation FROM users WHERE userid IN (199, 200, 207);</span><br><span class="line">SELECT JSON name, occupation FROM users WHERE userid = 199;</span><br><span class="line">SELECT name AS user_name, occupation AS user_occupation FROM users;</span><br><span class="line"></span><br><span class="line">SELECT time, value</span><br><span class="line">FROM events</span><br><span class="line">WHERE event_type = &#x27;myEvent&#x27;</span><br><span class="line">  AND time &gt; &#x27;2011-02-03&#x27;</span><br><span class="line">  AND time &lt;= &#x27;2012-01-01&#x27;</span><br><span class="line"></span><br><span class="line">SELECT COUNT (*) AS user_count FROM users;</span><br></pre></td></tr></table></figure>

<h3 id="Allowing-filtering"><a href="#Allowing-filtering" class="headerlink" title="Allowing filtering"></a>Allowing filtering</h3><blockquote>
<p>默认情况下，CQL仅允许不涉及“过滤”服务器端的选择查询，原因是那些“非过滤”查询具有可预测的性能，因为它们的查询性能与Limit成比例。</p>
</blockquote>
<p>举个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    username text PRIMARY KEY,</span><br><span class="line">    firstname text,</span><br><span class="line">    lastname text,</span><br><span class="line">    birth_year int,</span><br><span class="line">    country text</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE INDEX ON users(birth_year);</span><br></pre></td></tr></table></figure>

<p>以下两种查询是不需要添加<code>ALLOW FILTERING</code>的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users;</span><br><span class="line">SELECT * FROM users WHERE birth_year = 1981;</span><br></pre></td></tr></table></figure>

<p>因为在这两种情况下，Cassandra都保证这些查询性能与返回的数据量成正比。</p>
<p>而下面的这个查询，则需要强制添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE birth_year = 1981 AND country = &#x27;FR&#x27; ALLOW FILTERING;</span><br></pre></td></tr></table></figure>

<p>👉🏼 关于如何定义可预测的列，可参考<a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/cql/indexes.html">Cassandra中的索引</a></p>
<h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert_statement ::=  INSERT INTO table_name ( names_values | json_clause )</span><br><span class="line">                      [ IF NOT EXISTS ]</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">names_values     ::=  names VALUES tuple_literal</span><br><span class="line">json_clause      ::=  JSON string [ DEFAULT ( NULL | UNSET ) ]</span><br><span class="line">names            ::=  &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO NerdMovies (movie, director, main_actor, year)</span><br><span class="line">                VALUES (&#x27;Serenity&#x27;, &#x27;Joss Whedon&#x27;, &#x27;Nathan Fillion&#x27;, 2005)</span><br><span class="line">      USING TTL 86400;</span><br><span class="line"></span><br><span class="line">INSERT INTO NerdMovies JSON &#x27;&#123;&quot;movie&quot;: &quot;Serenity&quot;,</span><br><span class="line">                              &quot;director&quot;: &quot;Joss Whedon&quot;,</span><br><span class="line">                              &quot;year&quot;: 2005&#125;&#x27;;</span><br></pre></td></tr></table></figure>

<p>💡请注意</p>
<ol>
<li><p>与SQL不同，INSERT默认情况下不检查行的先前存在：如果之前不存在，则创建行，否则更新。此外，没有办法知道发生了哪些创建或更新。</p>
</li>
<li><p>如果要做到存在则不更新，可以使用<code>IF NOT EXISTS</code>条件。但请注意，使用<code>IF NOT EXISTS</code>将导致不可忽略的性能成本（内部使用Paxos），因此应谨慎使用。</p>
</li>
<li><p>INSERT的所有更新都以原子方式单独应用。</p>
</li>
</ol>
<h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">update_statement ::=  UPDATE table_name</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                      SET assignment ( &#x27;,&#x27; assignment )*</span><br><span class="line">                      WHERE where_clause</span><br><span class="line">                      [ IF ( EXISTS | condition ( AND condition )*) ]</span><br><span class="line">update_parameter ::=  ( TIMESTAMP | TTL ) ( integer | bind_marker )</span><br><span class="line">assignment       ::=  simple_selection &#x27;=&#x27; term</span><br><span class="line">                     | column_name &#x27;=&#x27; column_name ( &#x27;+&#x27; | &#x27;-&#x27; ) term</span><br><span class="line">                     | column_name &#x27;=&#x27; list_literal &#x27;+&#x27; column_name</span><br><span class="line">simple_selection ::=  column_name</span><br><span class="line">                     | column_name &#x27;[&#x27; term &#x27;]&#x27;</span><br><span class="line">                     | column_name &#x27;.&#x27; `field_name</span><br><span class="line">condition        ::=  simple_selection operator term</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UPDATE NerdMovies USING TTL 400</span><br><span class="line">   SET director   = &#x27;Joss Whedon&#x27;,</span><br><span class="line">       main_actor = &#x27;Nathan Fillion&#x27;,</span><br><span class="line">       year       = 2005</span><br><span class="line"> WHERE movie = &#x27;Serenity&#x27;;</span><br><span class="line"></span><br><span class="line">UPDATE UserActions</span><br><span class="line">   SET total = total + 2</span><br><span class="line">   WHERE user = B70DE1D0-9908-4AE3-BE34-5573E5B09F14</span><br><span class="line">     AND action = &#x27;click&#x27;;</span><br></pre></td></tr></table></figure>

<p>💡请注意</p>
<ol>
<li><p>与SQL不同，UPDATE默认情况下不检查行的先前存在（除非通过IF）：如果之前不存在，则创建行，否则更新。此外，没有办法知道是否发生了创建或更新。</p>
</li>
<li><p>可以通过IF在某些列上使用条件，在这种情况下，除非满足条件，否则不会更新行。但请注意，使用IF条件会产生不可忽视的性能成本（内部使用Paxos），因此应谨慎使用。</p>
</li>
<li><p>在UPDATE语句中，同一分区键中的所有更新都以原子方式单独应用。</p>
</li>
</ol>
<p>此外，UPDATE操作针对某些数据类型有强制性要求：</p>
<ol>
<li><code>c = c + 3</code></li>
</ol>
<p>用于递增/递减计数器。 </p>
<p>‘=’符号后面的列名称必须与’=’符号前面的列名相同。请注意，<strong>仅在计数器上允许递增/递减，并且是计数器上允许的唯一更新操作</strong>。</p>
<ol start="2">
<li><code>id = id + &lt;some-collection&gt;</code> 和<code>id[value1] = value2</code></li>
</ol>
<p>用于集合。</p>
<ol start="3">
<li><code>id.field = 3</code></li>
</ol>
<p>在非冻结的用户定义类型上设置字段的值。</p>
<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delete_statement ::=  DELETE [ simple_selection ( &#x27;,&#x27; simple_selection ) ]</span><br><span class="line">                      FROM table_name</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                      WHERE where_clause</span><br><span class="line">                      [ IF ( EXISTS | condition ( AND condition )*) ]</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM NerdMovies USING TIMESTAMP 1240003134</span><br><span class="line"> WHERE movie = &#x27;Serenity&#x27;;</span><br><span class="line"></span><br><span class="line">DELETE phone FROM Users</span><br><span class="line"> WHERE userid IN (C73DE1D3-AF08-40F3-B124-3FF3E5109F22, B70DE1D0-9908-4AE3-BE34-5573E5B09F14);</span><br></pre></td></tr></table></figure>

<p>💡请注意</p>
<ol>
<li><p>WHERE子句指定要删除的行。使用IN运算符可以使用一个语句删除多行。可以使用不等运算符（例如&gt;=）删除一系列行。</p>
</li>
<li><p>在DELETE语句中，同一分区键中的所有删除都以原子方式单独应用。</p>
</li>
<li><p>DELETE操作可以通过使用IF子句来条件化，类似于UPDATE和INSERT语句。但是，与INSERT和UPDATE语句一样，这将导致不可忽略的性能成本（内部，将使用Paxos），因此应谨慎使用。</p>
</li>
</ol>
<h2 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h2><blockquote>
<p>批处理只允许包含UPDATE，INSERT和DELETE语句。</p>
<p>批处理节省客户端和服务器之间的网络资源消耗。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">batch_statement        ::=  BEGIN [ UNLOGGED | COUNTER ] BATCH</span><br><span class="line">                            [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                            modification_statement ( &#x27;;&#x27; modification_statement )*</span><br><span class="line">                            APPLY BATCH</span><br><span class="line">modification_statement ::=  insert_statement | update_statement | delete_statement</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BEGIN BATCH</span><br><span class="line">   INSERT INTO users (userid, password, name) VALUES (&#x27;user2&#x27;, &#x27;ch@ngem3b&#x27;, &#x27;second user&#x27;);</span><br><span class="line">   UPDATE users SET password = &#x27;ps22dhds&#x27; WHERE userid = &#x27;user3&#x27;;</span><br><span class="line">   INSERT INTO users (userid, password) VALUES (&#x27;user4&#x27;, &#x27;ch@ngem3c&#x27;);</span><br><span class="line">   DELETE name FROM users WHERE userid = &#x27;user1&#x27;;</span><br><span class="line">APPLY BATCH;</span><br></pre></td></tr></table></figure>

<p>💡请注意</p>
<ol>
<li>属于给定分区键的BATCH中的所有更新都是单独执行的。</li>
<li>默认情况下，批处理中的所有操作都按记录执行，以确保所有变更都最终完成（或不执行任何操作）。类似于SQL事务，但不完全等同于SQL事务。</li>
</ol>
<h3 id="UNLOGGED-batches"><a href="#UNLOGGED-batches" class="headerlink" title="UNLOGGED batches"></a>UNLOGGED batches</h3><p>默认情况下，Cassandra使用批处理日志来确保所有变更都最终完成（或不执行任何操作）【请注意，操作仅在单个分区中隔离】。</p>
<p>批处理跨越多个分区时，批处理在性能上会有所损失。可以使用UNLOGGED选项来跳过批处理日志，不过，如果批处理失败，可能会造成批处理中的任务部分成功部分失败，请谨慎选择。</p>
<h3 id="COUNTER-batches"><a href="#COUNTER-batches" class="headerlink" title="COUNTER batches"></a>COUNTER batches</h3><p>使用COUNTER选项进行批量计数器更新。</p>
<p>与Cassandra中的其他更新不同，计数器更新不是幂等的。</p>
<h1 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h1><p><a target="_blank" rel="noopener" href="http://cassandra.apache.org/doc/latest/">Apache Cassandra Documentation</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/7877/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/7877/" class="post-title-link" itemprop="url">记一次Postgres CPU爆满故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-10 13:19:22" itemprop="dateCreated datePublished" datetime="2019-05-10T13:19:22+08:00">2019-05-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/7877/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/7877/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>公司项目测试环境调用某些接口的时候，服务器立即崩溃，并一定时间内无法提供服务。
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/7877/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/58700/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/58700/" class="post-title-link" itemprop="url">记一次生产事故--磁盘被占满</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-18 22:08:20" itemprop="dateCreated datePublished" datetime="2019-04-18T22:08:20+08:00">2019-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/58700/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/58700/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>今天，跑在阿里云ECS上的生产环境，突然间访问异常，接口各种报错，无奈公司没有专业的运维人员，只能硬着头皮解决一下。
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/58700/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gcdd1993.github.io/p/8505/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/asserts/images/avatar.jpg">
      <meta itemprop="name" content="Gcdd1993">
      <meta itemprop="description" content="一寸光阴一寸金">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寸土">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/p/8505/" class="post-title-link" itemprop="url">运维笔记（部署篇）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-16 15:43:58" itemprop="dateCreated datePublished" datetime="2019-04-16T15:43:58+08:00">2019-04-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-19 23:18:16" itemprop="dateModified" datetime="2021-06-19T23:18:16+08:00">2021-06-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/p/8505/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="p/8505/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>19k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>18 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>针对<code>Ubuntu 16.04</code>，汇总常用服务的搭建指南。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/p/8505/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gcdd1993</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">322k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:52</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>





  <script class="next-config" data-name="nprogress" type="application/json">{&quot;enable&quot;:true,&quot;spinner&quot;:true}</script>
  <script src="/js/third-party/nprogress.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js" integrity="sha256-KK3rvmDcW72MSl9jzzNZWlQjZNrRzAuGhAQ+0SFOg7Q=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{&quot;enable&quot;:true,&quot;home&quot;:true,&quot;archive&quot;:true,&quot;delay&quot;:true,&quot;timeout&quot;:3000,&quot;priority&quot;:true,&quot;ignores&quot;:null,&quot;url&quot;:&quot;https:&#x2F;&#x2F;gcdd1993.github.io&#x2F;page&#x2F;4&#x2F;&quot;}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="disqus" type="application/json">{&quot;enable&quot;:true,&quot;shortname&quot;:&quot;gcdd1993&quot;,&quot;count&quot;:true,&quot;i18n&quot;:{&quot;disqus&quot;:&quot;disqus&quot;}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>

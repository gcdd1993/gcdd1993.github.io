[{"title":"Kuberneteséƒ¨ç½²csi-driver","date":"2021-06-19T18:52:38.000Z","path":"p/20900/","text":"æœ¬æ–‡ä»‹ç»åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²nfs-csi-driver ç¯å¢ƒä¾èµ– Docker Kubernetesï¼ˆæœ¬æ–‡æ˜¯åŸºäºRancherçš„RKEé›†ç¾¤ï¼‰ å‰è¨€csi-driveræ˜¯éå¸¸ä¸°å¯Œçš„ï¼Œæ–°æ­å»ºçš„é›†ç¾¤ï¼Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘çš„NASä½œä¸ºå­˜å‚¨åç«¯ï¼ˆNASå¯¹æ¯”äº‘ç›˜ï¼Œæ‰©å±•æ€§é«˜ã€è´¹ç”¨ä½ã€å®¹é”™å¥½ï¼‰ï¼Œä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„NAS CSI Pluginè¿›è¡Œcsi-driverçš„å®‰è£…ã€‚ å¯¹äºæœ‰äº‘ç›˜çš„ECSæˆ–è€…æœ¬åœ°æœåŠ¡å™¨æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨åç«¯ï¼Œk8så®˜æ–¹æä¾›äº†nfs-csi-driver å¦‚æœæ˜¯é˜¿é‡Œçš„ECSï¼Œè¿˜å¯ä»¥ä½¿ç”¨é˜¿é‡Œæä¾›çš„disk-csi-driverï¼Œä½¿ç”¨äº‘ç›˜ä½œä¸ºå­˜å‚¨åç«¯ï¼ˆæœ‰å•æœºæ•…éšœçš„é£é™©ï¼‰ éƒ¨ç½²nfs-csi-driver1ã€å®‰è£…nfs-server1234567891011121314151617181920# é€‰æ‹©ä¸€å°ä¸»æœºï¼Œå®‰è£…nfs-server$ sudo apt update$ sudo apt install nfs-kernel-server$ mkdir -p /data/nfs$ sudo vim /etc/fstab172.16.1.23:/data/nfs /data/nfs nfs defaults,timeo=900,retrans=5,_netdev 0 0$ sudo vim /etc/exports/data/nfs 172.16.1.23/12(rw,sync,all_squash,anonuid=1001,anongid=1001,no_subtree_check) # è¿™é‡Œè®¾ç½®anonuidå’Œanongidï¼Œæ˜¯ä¸ºäº†ä¾¿äºéƒ¨ç½²bitnamiæä¾›çš„helm charts$ sudo exportfs -ra# bitnamiæä¾›çš„helm-chartçš„fsGroupé»˜è®¤æ˜¯1001ï¼Œå¦‚æœ1001çš„ç”¨æˆ·è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ç”¨æˆ·çš„uidå’Œgidï¼Œå°†1001ç©ºå‡ºæ¥ç»™bitnamiä½¿ç”¨# å…¶ä»–ä¸»æœºï¼Œé…ç½®nfs-client$ apt install nfs-common$ sudo mount -t nfs -o vers=4 172.16.1.23:/data/nfs /data/nfs$ sudo vim /etc/fstab172.16.1.23:/data/nfs /data/nfs nfs defaults,timeo=900,retrans=5,_netdev 0 0# æµ‹è¯•nfsè®¿é—®# åœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šä¼šå¯¹åº”åˆ—å‡ºä¿®æ”¹ 2ã€å®‰è£…nfs-csi-driverè¿™é‡Œæœ‰ä¸ªå°æ’æ›²ï¼Œç”±äºå›½å†…çš„ç½‘ç»œç¯å¢ƒï¼Œæ— æ³•ä¸‹è½½è°·æ­Œçš„dockeré•œåƒï¼Œæ‰€ä»¥åªèƒ½ä¸€ä¸ªä¸ªçš„æŠŠå®ƒä»¬è½¬åˆ°dockerhubä¸Š 1234567891011docker pull k8s.gcr.io/sig-storage/livenessprobe:v2.1.0 \\ &amp;&amp; docker tag k8s.gcr.io/sig-storage/livenessprobe:v2.1.0 qq1398371419/gcr.sig-storage.livenessprobe:v2.1.0 \\ &amp;&amp; docker push qq1398371419/gcr.sig-storage.livenessprobe:v2.1.0docker pull k8s.gcr.io/sig-storage/csi-provisioner:v2.1.0 \\ &amp;&amp; docker tag k8s.gcr.io/sig-storage/csi-provisioner:v2.1.0 qq1398371419/gcr.sig-storage.csi-provisioner:v2.1.0 \\ &amp;&amp; docker push qq1398371419/gcr.sig-storage.csi-provisioner:v2.1.0 docker pull k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.1.0 \\ &amp;&amp; docker tag k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.1.0 qq1398371419/gcr.sig-storage.csi-node-driver-registrar:v2.1.0 \\ &amp;&amp; docker push qq1398371419/gcr.sig-storage.csi-node-driver-registrar:v2.1.0 å®‰è£…nfs-csi-driver 1curl -skSL https://gitee.com/qq1398371419/csi-driver-nfs/raw/master/deploy/install-driver.sh | bash -s master -- 3ã€å®‰è£…StorageClassnfs-sc.yaml 1234567891011121314---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-csiprovisioner: nfs.csi.k8s.ioparameters: server: 172.16.1.23 # è¿™é‡Œæ”¹æˆè‡ªå·±çš„å†…ç½‘IP share: /data/nfs # è¿™é‡Œæ”¹æˆè‡ªå·±çš„nfså…±äº«ç›®å½•reclaimPolicy: RetainvolumeBindingMode: ImmediatemountOptions: - hard - nfsvers=4.1 1$ kubectl create -f nfs-sc.yaml 4ã€æµ‹è¯•éƒ¨ç½²Redis123456789101112131415$ vim redis-test.yaml---master: persistence: storageClass: nfs-csi service: nodePort: 30001 type: NodePortreplica: persistence: storageClass: nfs-csiauth: enabled: false$ helm repo add bitnami https://charts.bitnami.com/bitnami$ helm install my-release bitnami/redis -f redis-test.yaml é—®é¢˜ å‰é¢æåˆ°çš„è®¾ç½®anonuidå’Œanongidï¼Œæ˜¯å› ä¸ºéƒ¨ç½²bitnamiæä¾›çš„helm chartsé‡åˆ°äº†æ— æ³•å†™å…¥æ–‡ä»¶çš„é—®é¢˜ï¼Œä¹‹æ‰€ä»¥è®¾ç½®ä¸º1001ï¼Œå› ä¸ºbitnamié»˜è®¤çš„uidæ˜¯1001 å®¹å™¨å¯¹äºmountçš„è·¯å¾„çš„è®¿é—®æƒé™é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒhttps://www.cnblogs.com/sammyliu/p/10129670.html ç›¸å…³èµ„æ–™ Kubernetes CSI Developer Documentation alibaba-cloud-csi-driver Kubernetes CSI","tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://gcdd1993.github.io/tags/Kubernetes/"},{"name":"Docker","slug":"Docker","permalink":"https://gcdd1993.github.io/tags/Docker/"}]},{"title":"Dubboä½¿ç”¨Kryoåºåˆ—åŒ–åè®®çš„æ€è€ƒ","date":"2021-06-19T18:04:07.000Z","path":"p/13982/","text":"æœ¬æ–‡æ˜¯ä½¿ç”¨Dubboè¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒï¼Œä¸è¶³ä»¥ä½œä¸ºå‚è€ƒï¼Œåªä¸ºç•™å­˜è®°å½•ã€‚ å‰è¨€Dubboå®˜æ–¹æ¨èä½¿ç”¨kryoæˆ–è€…fstä½œä¸ºRPCåºåˆ—åŒ–åè®®ï¼ŒåŸå› æ˜¯è¿™ä¸¤æ¬¾åºåˆ—åŒ–åè®®ï¼Œæ€§èƒ½æ˜¾è‘—ä¼˜äºå…¶ä»–åºåˆ—åŒ–åè®®ã€‚è™½ç„¶é«˜æ•ˆï¼Œä½†å…¶å®Dubboå¯¹è¿™ä¸¤æ¬¾çš„æ”¯æŒå´ä¸æ˜¯é‚£ä¹ˆç†æƒ³ï¼Œå¯¼è‡´ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›é—®é¢˜ å¤šæœåŠ¡ä¸‹kryoåºåˆ—åŒ–é—®é¢˜Q1ã€æ— æ³•ä½¿ç”¨kryoç±»ç´¢å¼•çº¢åˆ© åœ¨å¤šæ¨¡å—åä½œçš„ç³»ç»Ÿä¸­ï¼Œæ— æ³•ä¿è¯æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹DTOæ•°é‡ä»¥åŠæ³¨å†Œé¡ºåºçš„ä¸€è‡´ï¼Œå¯èƒ½Aä½œä¸ºæœåŠ¡æä¾›æ–¹ï¼Œæä¾›äº†DTOï¼Œè€ŒBä½œä¸ºæ¶ˆè´¹æ–¹ï¼Œå¯èƒ½åŒæ—¶æ¶ˆè´¹Aã€Cçš„æœåŠ¡ï¼ŒåŒæ—¶è‡ªèº«ä¹Ÿå¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨ä½¿ç”¨Kryoåºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åŒæ—¶æ³¨å†ŒAã€Bã€CæœåŠ¡çš„DTOã€‚ ä¾‹å¦‚Aç³»ç»Ÿçš„SerializationOptimizerå®ç° 1234567891011public class ASerializationOptimizerImpl implements SerializationOptimizer &#123; @Override public Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123; return A1.class; return A2.class; return A3.class; return A4.class; return C1.class; return C2.class; &#125;&#125; Bç³»ç»Ÿçš„SerializationOptimizerå®ç° 12345678910111213public class BSerializationOptimizerImpl implements SerializationOptimizer &#123; @Override public Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123; return A1.class; return A2.class; return A3.class; return A4.class; return B1.class; return B2.class; return C1.class; return C2.class; &#125;&#125; è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œkryoä¹‹æ‰€ä»¥é«˜æ•ˆï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå…¶äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ›´ç”±äºå…¶å¯ä»¥é¢„å…ˆä¸ºå¾…åºåˆ—åŒ–çš„ç±»æŒ‡å®šç´¢å¼•ï¼Œåœ¨RPCä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä½¿ç”¨ç´¢å¼•ä»£æ›¿å…¨ç±»åï¼Œåœ¨ç±»ä½¿ç”¨éå¸¸é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥èŠ‚çœå¤§é‡å­—èŠ‚ï¼Œä»è€Œå¤§å¤§æå‡ä¼ è¾“æ•ˆç‡ã€‚ è€ŒDubboä¼¼ä¹ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å°†ä¸€äº›ä½¿ç”¨é¢‘ç¹çš„ç±»è¿›è¡Œäº†é¢„å¤„ç†ï¼Œè§org.apache.dubbo.common.serialize.kryo.utils.AbstractKryoFactory#create ä½†æ˜¯å…¶ä¸­å¾ˆé‡è¦çš„ä¸€å¤„ 1234567SerializableClassRegistry.getRegisteredClasses().forEach((clazz, ser) -&gt; &#123; if (ser == null) &#123; kryo.register(clazz); &#125; else &#123; kryo.register(clazz, (Serializer) ser); &#125;&#125;); ä½¿ç”¨çš„æ˜¯kryo.register(clazz)ï¼Œæ— æ³•æŒ‡å®škryo class indexï¼Œè¿™é‡Œæˆ‘åˆ†æäº†ä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹è€çš„åºåˆ—åŒ–åè®®ï¼Œæ¯”å¦‚jsonç­‰ï¼Œè€Œä¸”SerializableClassRegistryæ˜¯å¾ˆæ—©å°±æœ‰çš„æ¥å£ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°ç±»ç´¢å¼•çš„é—®é¢˜ã€‚ æ‰€ä»¥è¿™é‡Œè¦æ³¨å†Œçš„è¯ï¼Œåªèƒ½å°†é¡¹ç›®å†…æ‰€æœ‰ç±»éƒ½å†™åˆ°åŒä¸€ä¸ªjarä¸­ï¼Œç„¶åå†™ä¸€ä¸ªç»Ÿä¸€çš„SerializationOptimizerå®ç°ã€‚ è¿™åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡å¿…ç„¶ä¼šæä¾›è‡ªå·±çš„dto.jarå’Œdubbo-service.jarï¼Œè€Œä¸”æœåŠ¡ä¹‹é—´ä¹Ÿä¸å¯èƒ½ä¾èµ–å…¶ä»–æ‰€æœ‰çš„æœåŠ¡ï¼Œæ‰€ä»¥è¿™ä¸€æ¡æ— æ³•æ»¡è¶³ã€‚ è¿™æ ·ä¸€æ¥ï¼Œç±»çš„æ³¨å†Œé¡ºåºä¸èƒ½ä¿è¯ï¼Œç±»çš„æ•°é‡ä¹Ÿæ— æ³•ä¿è¯ï¼Œæ‰€ä»¥Dubboçš„kryoåºåˆ—åŒ–åªèƒ½è¯´åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡äº†æ•ˆç‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨å‘æŒ¥å‡ºkryoçš„æ€§èƒ½ä¼˜åŠ¿ã€‚ Q2ã€ç¤¾åŒºä¸æ´»è·ƒ è™½ç„¶é˜¿é‡Œé‡å¯äº†Dubboï¼Œå¹¶ä¸”åŠ å…¥äº†Apacheè¿›è¡Œå­µåŒ–ï¼Œä½†æ˜¯ç¤¾åŒºç›¸è¾ƒäºSpring Cloudï¼Œè¿˜æ˜¯ä¸å¤Ÿæ´»è·ƒï¼Œè€Œä¸”é˜¿é‡Œçš„å¼€æºäº§å“ï¼Œå¤šå¤šå°‘å°‘å¸¦äº†ç‚¹é˜¿é‡Œå†…éƒ¨çš„å‘³é“ï¼Œä¸å¦‚Spring Cloudé€šç”¨å’Œè€ƒè™‘å‘¨å…¨ã€‚ä¸€äº›åŠŸèƒ½æˆ‘ä»¬ä¸éœ€è¦ï¼ˆæ¯”å¦‚dubboæ³¨å†Œæ—¶çš„ä¸€å †å‚æ•°ï¼Œå¾ˆå¤šéƒ½æ˜¯éœ€è¦é˜¿é‡Œçš„ä¸€å¥—å¼€å‘ä½“ç³»æ‰èƒ½ä½¿ç”¨åˆ°ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦çš„åˆè¿Ÿè¿Ÿä¸æ·»åŠ ï¼ˆkryoçš„ClassIdæ”¯æŒï¼‰ã€‚ æ‰€ä»¥ç›®å‰é¡¹ç›®å·²ç»å…¨é¢åˆ‡æ¢åˆ°Spring Cloud Kubernetesï¼Œæœ‰æ—¶é—´ä¹Ÿä¼šæ€»ç»“ä¸€ä¸‹Dubboåˆ‡æ¢åˆ°Spring Cloudçš„ç»éªŒï¼Œä»¥åŠåœ¨äº‘åŸç”Ÿæ—¶ä»£Spring Cloudæ‰€åšå‡ºçš„åŠªåŠ›ã€‚ ç›¸å…³èµ„æ–™ Dubbo Issue Kryo å’Œ FST åºåˆ—åŒ– Kryoåºåˆ—åŒ–åè®®","tags":[{"name":"Dubbo","slug":"Dubbo","permalink":"https://gcdd1993.github.io/tags/Dubbo/"}]},{"title":"Gradle é…ç½®ç‰‡æ®µ","date":"2021-06-19T17:29:55.000Z","path":"p/9306/","text":"æœ¬æ–‡ä»‹ç»Gradleå¸¸ç”¨é…ç½®ï¼Œæœ¬äººå¾ˆæ—©å°±å¼€å§‹ä½¿ç”¨Gradleä»£æ›¿Mavenä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ï¼ŒGradleç›¸è¾ƒäºMavenç¹ççš„XMLé…ç½®æ¥è¯´ï¼Œç¡®å®æ›´ä¸ºå…ˆè¿›ï¼Œä¾æ‰˜äºGroovyè„šæœ¬çš„å¼ºå¤§ï¼Œä¹Ÿæ›´åŠ çµæ´»ã€‚ 1ã€Jetbrains IDEAè®¾ç½®Gradleä¸è‡ªåŠ¨åˆ›å»ºæ¨¡å— åœ¨IDEAæŸä¸ªç‰ˆæœ¬ä¹‹åï¼Œåˆ›å»ºæˆ–å¯¼å…¥Gradleé¡¹ç›®çš„æ—¶å€™ï¼Œæ— æ³•å†å–æ¶ˆå‹¾é€‰Create separate module per source setï¼Œå¤šå°‘æœ‰ç‚¹å¼ºåŠ çš„æ„æ€ï¼Œå› ä¸ºè‡ªåŠ¨ä¸ºæ¯ä¸ªèµ„æºæ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ¨¡å—å¤šäº†ä»¥åï¼Œä¼šå‡ºç°æ„æ–™ä¹‹å¤–çš„é”™è¯¯ï¼Œæ¯”å¦‚æŸä¸ªä¾èµ–æ— æ³•åŠ è½½ç­‰é—®é¢˜ ç¼–è¾‘.idea/gradle.xmlï¼ŒåŠ ä¸Šä¸€è¡Œ&lt;option name=&quot;resolveModulePerSourceSet&quot; value=&quot;false&quot; /&gt;å°±è¡Œ 1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project version=&quot;4&quot;&gt; &lt;component name=&quot;GradleMigrationSettings&quot; migrationVersion=&quot;1&quot; /&gt; &lt;component name=&quot;GradleSettings&quot;&gt; &lt;option name=&quot;linkedExternalProjectsSettings&quot;&gt; &lt;GradleProjectSettings&gt; &lt;option name=&quot;delegatedBuild&quot; value=&quot;true&quot; /&gt; &lt;option name=&quot;testRunner&quot; value=&quot;GRADLE&quot; /&gt; &lt;option name=&quot;distributionType&quot; value=&quot;LOCAL&quot; /&gt; &lt;option name=&quot;externalProjectPath&quot; value=&quot;$PROJECT_DIR$&quot; /&gt; &lt;option name=&quot;gradleHome&quot; value=&quot;$PROJECT_DIR$/../../../../DevTools/Gradle/gradle-6.8.3&quot; /&gt; &lt;option name=&quot;gradleJvm&quot; value=&quot;#JAVA_HOME&quot; /&gt; &lt;option name=&quot;resolveModulePerSourceSet&quot; value=&quot;false&quot; /&gt; &lt;/GradleProjectSettings&gt; &lt;/option&gt; &lt;/component&gt;&lt;/project&gt; ç„¶åé‡æ–°å¯¼å…¥Gradleé¡¹ç›® 2ã€ä½¿ç”¨é˜¿é‡Œäº‘Mavenä»“åº“åŠ é€Ÿä¾èµ–ä¸‹è½½ Gradle 6.8.3å³ä»¥ä¸Šé€‚ç”¨ ç¼–è¾‘settings.gradle 123456789101112131415161718192021222324pluginManagement &#123; repositories &#123; mavenLocal() repositories &#123; maven &#123; url &#x27;https://maven.aliyun.com/repository/google&#x27; &#125; maven &#123; url &#x27;https://maven.aliyun.com/repository/gradle-plugin&#x27; &#125; maven &#123; url &#x27;https://maven.aliyun.com/repository/public/&#x27; &#125; &#125; mavenCentral() gradlePluginPortal() &#125;&#125;dependencyResolutionManagement &#123; repositories &#123; mavenLocal() maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/central&quot;) &#125; // central maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/public&quot;) &#125; // jcenter &amp; public maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/google&quot;) &#125; // google maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/spring&quot;) &#125; // spring maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/spring-plugin&quot;) &#125; // spring plugin maven &#123; url = uri(&quot;https://maven.aliyun.com/repository/grails-core&quot;) &#125; // spring plugin &#125;&#125;rootProject.name = &#x27;my-prject&#x27; 3ã€maven-publish.gradle1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// jaræ·»åŠ ä»¥ä¸‹æ’ä»¶//plugins &#123;// id &#x27;java-library&#x27;// id &#x27;maven-publish&#x27;//&#125;// bomæ·»åŠ ä»¥ä¸‹æ’ä»¶//plugins &#123;// id &#x27;java-platform&#x27;// id &#x27;maven-publish&#x27;//&#125;def artifactory = &#x27;https://packages.aliyun.com/maven/repository/&#x27;def releasePath = &quot;xxx&quot;def snapshotsPath = &quot;xxx&quot;def mavenName = &#x27;my-project&#x27;afterEvaluate &#123; Project project -&gt; if (project.plugins.hasPlugin(&quot;maven-publish&quot;)) &#123; if (project.plugins.hasPlugin(&quot;java&quot;)) &#123; java &#123; withSourcesJar() &#125; &#125; publishing &#123; repositories &#123; maven &#123; name &quot;$&#123;mavenName&#125;&quot; url = &quot;$&#123;artifactory&#125;$&#123;(version.endsWith(&#x27;SNAPSHOT&#x27;) ? snapshotsPath : releasePath)&#125;&quot; credentials &#123; username &quot;$&#123;maven_username&#125;&quot; password &quot;$&#123;maven_password&#125;&quot; &#125; authentication &#123; basic(BasicAuthentication) &#125; &#125; &#125; publications &#123; omac(MavenPublication) &#123; from components.java versionMapping &#123; usage(&#x27;java-api&#x27;) &#123; fromResolutionOf(&#x27;runtimeClasspath&#x27;) &#125; usage(&#x27;java-runtime&#x27;) &#123; fromResolutionResult() &#125; &#125; &#125; &#125; &#125; &#125;&#125; åœ¨build.gradleå¼•å…¥å³å¯ 1apply from: &quot;$&#123;rootDir&#125;/gradle/maven-publish.gradle&quot; 4ã€docker.gradle123456789101112131415161718192021222324252627282930afterEvaluate &#123; if (pluginManager.hasPlugin(&quot;application&quot;)) &#123; task archiveDeps(type: Tar) &#123; task -&gt; def dependencies = task.project.configurations.runtimeClasspath.fileCollection &#123; true &#125; from dependencies.sort() compression = Compression.GZIP archiveFileName = &quot;dep-libs.tar.gz&quot; from jar.archiveFile destinationDirectory = file(&quot;$buildDir/docker&quot;) &#125; task copyDeps(type: Copy) &#123; dependsOn(archiveDeps) from tarTree(resources.gzip(&quot;$buildDir/docker/dep-libs.tar.gz&quot;)) into &quot;$buildDir/docker/libs/&quot; &#125; task copyApp(type: Copy) &#123; dependsOn(jar, startScripts) from &quot;$buildDir/scripts/&quot; from jar.outputs into &quot;$buildDir/docker/&quot; &#125; task prepare() &#123; dependsOn(copyApp, copyDeps) &#125; &#125;&#125; æ·»åŠ æ’ä»¶application 123plugins &#123; id &quot;application&quot;&#125; å¹¶é…åˆä»¥ä¸‹Dockerfile 123456789101112131415161718192021222324252627282930313233343536373839# First stage: complete build environmentFROM registry.cn-shanghai.aliyuncs.com/halmawork/gradle:6.8.3-jdk11-openj9 AS builderARG MAVEN_USERNAMEARG MAVEN_PASSWORDARG MODULERUN echo &quot;org.gradle.daemon=false&quot; &gt;&gt; ~/.gradle/gradle.properties \\ &amp;&amp; echo &quot;org.gradle.parallel=true&quot; &gt;&gt; ~/.gradle/gradle.properties \\ &amp;&amp; echo &quot;maven_username=$MAVEN_USERNAME&quot; &gt;&gt; ~/.gradle/gradle.properties \\ &amp;&amp; echo &quot;maven_password=$MAVEN_PASSWORD&quot; &gt;&gt; ~/.gradle/gradle.propertiesWORKDIR /builderCOPY . /builder# package jarRUN gradle :$MODULE:clean :$MODULE:prepare# Second stage: minimal runtime environmentFROM adoptopenjdk/openjdk11:jreENV MODULE &quot;&quot;ENV TZ=Asia/ShanghaiLABEL name=$MODULERUN ln -fs /usr/share/zoneinfo/$TZ /etc/localtime \\ &amp;&amp; dpkg-reconfigure -f noninteractive tzdataWORKDIR /appCOPY --from=builder /builder/build/docker/libs/*.jar /app/lib/COPY --from=builder /builder/build/docker/$MODULE /app/bin/runCOPY --from=builder /builder/build/docker/$MODULE-*.jar /app/lib/EXPOSE 8080CMD [&quot;/app/bin/run&quot;] æ‰“åŒ…dockeré•œåƒ 1$ docker build -f gradle/Dockerfile -t gcdd1993/demo:latest-snapshot . 5ã€æ”¯æŒkotlingradle.properties 1kotlin_version=1.5.10 build.gradle 12345678910111213141516171819202122plugins &#123; id &quot;org.jetbrains.kotlin.jvm&quot; version &quot;$&#123;kotlin_version&#125;&quot; apply false // jvm æ’ä»¶ id &quot;org.jetbrains.kotlin.plugin.spring&quot; version &quot;$&#123;kotlin_version&#125;&quot; apply false // spring æ’ä»¶ï¼Œallopen æ’ä»¶ id &quot;org.jetbrains.kotlin.kapt&quot; version &quot;$&#123;kotlin_version&#125;&quot; apply false // kaptï¼Œä»£æ›¿annotationProcessor id &quot;org.jetbrains.kotlin.plugin.noarg&quot; version &quot;$&#123;kotlin_version&#125;&quot; apply false // ç”¨äºè‡ªå®šä¹‰æ³¨è§£ç”Ÿæˆno arg constructor&#125;apply plugin: &quot;org.jetbrains.kotlin.jvm&quot;apply plugin: &quot;org.jetbrains.kotlin.plugin.spring&quot;apply plugin: &quot;org.jetbrains.kotlin.kapt&quot;apply plugin: &quot;org.jetbrains.kotlin.plugin.noarg&quot;compileKotlin &#123; kotlinOptions &#123; freeCompilerArgs = [&quot;-Xjsr305=warn&quot;] jvmTarget = &quot;11&quot; &#125;&#125;noArg &#123; annotation(&quot;io.github.gcdd1993.NoArg&quot;) // è¯¥æ³¨è§£æ³¨é‡Šçš„classï¼Œä¼šç”ŸæˆNoArg Constructor&#125; 6ã€é™åˆ¶é¡¹ç›®JDKç‰ˆæœ¬ å¯¹äºå¤šäººååŒæ—¶ï¼Œå¾ˆæœ‰ç”¨ï¼Œé¿å…å› ä¸ºJDKç‰ˆæœ¬ä¸ä¸€å¯¼è‡´çš„å„ç§é—®é¢˜ 1234def javaVersion = System.getProperty(&quot;java.version&quot;)if (!javaVersion.startsWith(&quot;11&quot;)) &#123; throw new RuntimeException(&quot;Incompatible JRE version: &quot; + javaVersion + &quot;. Use JRE 11 instead.&quot;)&#125; 7ã€ä¸ºé¡¹ç›®ç¼–è¯‘jaræ–‡ä»¶æ·»åŠ é¡¹ç›®ç¼–è¯‘ä¿¡æ¯1234567891011121314151617181920212223242526plugins &#123; id &quot;org.springframework.boot&quot; version &quot;$&#123;spring_boot_version&#125;&quot; apply false id &quot;com.gorylenko.gradle-git-properties&quot; version &quot;2.2.4&quot;&#125;apply plugin: &quot;io.spring.dependency-management&quot;apply plugin: &quot;org.springframework.boot&quot;jar &#123; enabled = true manifest &#123; attributes( &quot;Implementation-Title&quot;: project.name, &quot;Implementation-Version&quot;: project.version, &quot;Built-By&quot;: System.properties[&quot;user.name&quot;], &quot;Build-Timestamp&quot;: new SimpleDateFormat(&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSZ&quot;).format(new Date()), &quot;Created-By&quot;: &quot;Gradle $&#123;gradle.gradleVersion&#125;&quot;, &quot;Build-Jdk&quot;: &quot;$&#123;System.properties[&quot;java.version&quot;]&#125; ($&#123;System.properties[&quot;java.vendor&quot;]&#125; $&#123;System.properties[&quot;java.vm.version&quot;]&#125;)&quot;, &quot;Build-OS&quot;: &quot;$&#123;System.properties[&quot;os.name&quot;]&#125; $&#123;System.properties[&quot;os.arch&quot;]&#125; $&#123;System.properties[&quot;os.version&quot;]&#125;&quot; ) &#125;&#125;springBoot &#123; buildInfo()&#125; å¦‚æœæ˜¯Spring Booté¡¹ç›®ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ‰“å°å‡ºç¼–è¯‘ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334353637383940/** * åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‰“å°åº”ç”¨åŸºæœ¬ä¿¡æ¯ * * @author gcdd1993 * @date 2021/2/20 * @since 1.0.0 */class AppInfoPreviewAutoConfiguration &#123; private val log = LoggerFactory.getLogger(javaClass) @Autowired(required = false) private val gitProperties: GitProperties? = null @Autowired(required = false) private val buildProperties: BuildProperties? = null @Value(&quot;\\$&#123;spring.application.name&#125;&quot;) private val name: String? = null @EventListener(ApplicationStartedEvent::class) fun onBootUp(event: ApplicationStartedEvent?) &#123; log.info(&quot;&#123;&#125; Started.&quot;, name) if (buildProperties != null) &#123; log.info(&quot;build.name : &#123;&#125;&quot;, buildProperties.name) log.info(&quot;build.artifact : &#123;&#125;&quot;, buildProperties.artifact) log.info(&quot;build.group : &#123;&#125;&quot;, buildProperties.group) log.info(&quot;build.version : &#123;&#125;&quot;, buildProperties.version) log.info(&quot;build.time : &#123;&#125;&quot;, buildProperties.time.atZone(ZoneId.systemDefault()).toLocalDateTime()) &#125; else &#123; log.warn(&quot;cannot find any build properties file from this project. please reference: https://stackoverflow.com/questions/47283048/how-to-capture-build-info-using-gradle-and-spring-boot.&quot;) &#125; if (gitProperties != null) &#123; log.info(&quot;commit.branch : &#123;&#125;&quot;, gitProperties.branch) log.info(&quot;commit.commit.id : &#123;&#125;&quot;, gitProperties.commitId) log.info(&quot;commit.commit.time : &#123;&#125;&quot;, gitProperties.commitTime.atZone(ZoneId.systemDefault()).toLocalDateTime()) &#125; else &#123; log.warn(&quot;cannot find any git properties file from this project. please add gradle plugin: https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties.&quot;) &#125; &#125;&#125; æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚","tags":[{"name":"Gradle","slug":"Gradle","permalink":"https://gcdd1993.github.io/tags/Gradle/"}]},{"title":"ä½¿ç”¨certbotç»™ç½‘ç«™ä¸Šå…è´¹çš„SSLè¯ä¹¦","date":"2021-06-19T16:55:06.000Z","path":"p/16060/","text":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨certbotä¸ºç½‘ç«™æ·»åŠ HTTPSæ”¯æŒï¼Œå¹¶è‡ªåŠ¨æ›´æ–° å‰æ docker docker-compose éƒ¨ç½²å…‹éš†ä»“åº“ è¿™ä¸€æ­¥å¿…ä¸å¯å°‘ï¼Œä¸€å®šè¦æŒ‰ç…§ä½œè€…çš„ä»“åº“ç›®å½•ç»“æ„æ¥æ‰§è¡Œï¼Œå®Œæˆåï¼Œå¯ä»¥è‡ªè¡Œæ›´æ”¹nginx/conf.dä¸‹çš„é…ç½®æ–‡ä»¶ã€‚ å…·ä½“åŸå› æˆ‘ä¹Ÿä¸çŸ¥ï¼Œä½†æ˜¯ä¸ç…§åšï¼Œä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚ 1234567891011121314$ mkdir -p /data$ cd /data$ git clone https://ghproxy.com/https://github.com/gcdd1993/nginx-certbot$ cd nginx-certbot$ ls -ldrwxr-xr-x 4 root root 4096 Jun 8 22:01 ./drwxr-xr-x 5 root root 4096 Jun 8 21:49 ../drwxr-xr-x 4 root root 4096 Jun 8 21:53 data/-rw-r--r-- 1 root root 660 Jun 8 21:49 docker-compose.ymldrwxr-xr-x 8 root root 4096 Jun 8 21:49 .git/-rw-r--r-- 1 root root 14 Jun 8 21:49 .gitignore-rwxr-xr-x 1 root root 2286 Jun 8 22:01 init-letsencrypt.sh*-rw-r--r-- 1 root root 1074 Jun 8 21:49 LICENSE-rw-r--r-- 1 root root 1376 Jun 8 21:49 README.md ä¸ºåŸŸåæ·»åŠ è¯ä¹¦ ğŸ’¡åœ¨è¿™ä¸€æ­¥æ‰§è¡Œå‰ï¼Œè¯·ç¡®è®¤å·²ç»å°†éœ€è¦æ·»åŠ è¯ä¹¦çš„åŸŸåæŒ‡å‘æœ¬æœºå…¬ç½‘IPï¼Œå› ä¸ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡ŒæœåŠ¡å™¨æ‰€å±æƒæ ¡éªŒï¼Œéœ€è¦è®¿é—®ä½ æ‰€æ“ä½œçš„åŸŸå 1ã€ä¿®æ”¹init-letsencrypt.shçš„emailä¸ºä½ çš„é‚®ç®±1234$ vim init-letsencrypt.sh...email=&quot;gcwm99@gmail.com&quot;... 2ã€ä¿®æ”¹æ“ä½œåŸŸå12$ sed -i &#x27;s/example.org/your_domain/g&#x27; data/nginx/app.conf \\ &amp;&amp; sed -i &#x27;s/example.org/your_domain/g&#x27; init-letsencrypt.sh 3ã€æ‰§è¡Œinit-letsencrypt.sh ç›´åˆ°å‡ºç°ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜å·²ç»å®Œæˆ 123456789101112131415161718$ ./init-letsencrypt.sh...Requesting a certificate for your_domainSuccessfully received certificate.Certificate is saved at: /etc/letsencrypt/live/your_domain/fullchain.pemKey is saved at: /etc/letsencrypt/live/your_domain/privkey.pemThis certificate expires on 2021-09-06.These files will be updated when the certificate renews.NEXT STEPS:- The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need to take steps to enable that functionality. See https://certbot.org/renewal-setup for instructions.- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -If you like Certbot, please consider supporting our work by:* Donating to ISRG / Let&#x27;s Encrypt: https://letsencrypt.org/donate* Donating to EFF: https://eff.org/donate-le- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 4ã€å¤šåŸŸåæ“ä½œ æ­¥éª¤åŒä¸Šï¼Œå…ˆä¿®æ”¹åŸŸåä¸ºå¾…æ“ä½œåŸŸåï¼Œç„¶åæ‰§è¡Œinit-letsencrypt.sh 1234$ sed -i &#x27;s/your_domain/your_domain2/g&#x27; data/nginx/app.conf \\ &amp;&amp; sed -i &#x27;s/your_domain/your_domain2/g&#x27; init-letsencrypt.sh$ ./init-letsencrypt.sh... 5ã€å¯åŠ¨ä½ çš„ç½‘ç«™1234# æ³¨é‡Šapp.conf$ cd data/nginx$ mv app.conf app.conf.bak# æ·»åŠ ä½ çš„ç½‘ç«™é…ç½® ç¤ºä¾‹é…ç½® 12345678910111213141516171819202122232425262728293031upstream my.site &#123; server localhost:8080;&#125;server &#123; server_name your_domain; proxy_read_timeout 600s; proxy_send_timeout 600s; location / &#123; add_header X-Frame-Options deny; proxy_pass http://my.site; &#125; listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/your_domain/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/your_domain/privkey.pem; include /etc/letsencrypt/options-ssl-nginx.conf; ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; server_tokens off;&#125;server &#123; if ($host = your_domain) &#123; return 301 https://$host$request_uri; &#125; # managed by Certbot server_name your_domain; listen 80; return 404; # managed by Certbot&#125; æ›´æ–°è¯ä¹¦ ä½œè€…ç»™å‡ºçš„docker-compose.ymlå·²ç»é»˜è®¤12å°æ—¶æ£€æŸ¥å¹¶æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥éå¸¸çœå¿ƒ 12345$ docker exec -it nginx-certbot_certbot_1 certbot renew...The following certificates are not due for renewal yet: /etc/letsencrypt/live/your_domain/fullchain.pem expires on 2021-09-06 (skipped)No renewals were attempted. ç›¸å…³èµ„æ–™ certbot nginx-certbot","tags":[{"name":"é»˜è®¤","slug":"é»˜è®¤","permalink":"https://gcdd1993.github.io/tags/%E9%BB%98%E8%AE%A4/"}]},{"title":"Ubuntuéƒ¨ç½²docker","date":"2021-06-19T16:29:58.000Z","path":"p/42583/","text":"æœ¬æ–‡ä»‹ç»åœ¨Ubuntuä¸Šéƒ¨ç½²docker å®‰è£…docker123sudo apt-get update &amp;&amp; sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common &amp;&amp; curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - &amp;&amp; sudo apt-key fingerprint 0EBFCD88 &amp;&amp; sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot; &amp;&amp; sudo apt-get update &amp;&amp; sudo apt-get -y install docker-ce docker-ce-cli containerd.io &amp;&amp; sudo docker --version...Docker version 19.03.12, build 48a66213fe å®‰è£…docker-compose123sudo curl -L &quot;https://github.91chifun.workers.dev/https://github.com//docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose &amp;&amp; sudo chmod +x /usr/local/bin/docker-compose &amp;&amp; docker-compose --version...docker-compose version 1.26.2, build eefe0d31 é…ç½®docker å¯é€‰ï¼Œä½†æ˜¯ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒç­‰å› ç´ ï¼Œè¿˜æ˜¯å»ºè®®åšä¸€ä¸‹é…ç½® 1234567891011121314151617181920212223$ sudo vim /etc/docker/daemon.json&#123; &quot;data-root&quot;: &quot;/data/docker&quot;, // å°†dockeré•œåƒç­‰å†…å®¹ç§»åŠ¨åˆ°æ•°æ®ç›˜ï¼Œæ³¨æ„ï¼šä¹‹å‰å¦‚æœæœ‰å¯åŠ¨è¿‡çš„å®¹å™¨ï¼Œæˆ–è€…æ‹‰å–çš„é•œåƒï¼Œä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå°†ä¼šå¤±æ•ˆï¼Œè°¨æ…ä¿®æ”¹ &quot;log-driver&quot;:&quot;json-file&quot;, // è®¾ç½®logæ–‡ä»¶æ ¼å¼ &quot;log-opts&quot;:&#123; // è®¾ç½®logæ–‡ä»¶ &quot;max-size&quot;:&quot;10m&quot;, &quot;max-file&quot;:&quot;3&quot;, &quot;labels&quot;:&quot;production_status&quot;, &quot;env&quot;:&quot;os,customer&quot; &#125;, &quot;insecure-registries&quot;:[ &quot;registryhost:5000&quot;, &quot;10.0.0.0/8&quot; ], &quot;registry-mirrors&quot;:[ // é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ &quot;https://mubkcb81.mirror.aliyuncs.com&quot; ]&#125;$ sudo systemctl daemon-reload$ sudo systemctl restart docker# é…ç½®dockerå¼€æœºè‡ªå¯åŠ¨sudo systemctl enable docker ç›¸å…³èµ„æ–™ CentOS Ubuntu Debian Fedora","tags":[{"name":"é»˜è®¤","slug":"é»˜è®¤","permalink":"https://gcdd1993.github.io/tags/%E9%BB%98%E8%AE%A4/"}]},{"title":"ç®—æ³•å¾ˆç¾ï¼ˆè“æ¡¥ï¼‰ | ä½è¿ç®—çš„å¥‡æŠ€æ·«å·§","date":"2021-06-19T16:18:43.534Z","path":"p/60563/","text":"æˆ‘æœ‰è¯è¯´å‰é˜µå­è·‘å»é¢è¯•ï¼Œæœ‰å®¶å…¬å¸æ˜¯åšç”µå•†å¹¿å‘Šæ•°æ®åˆ†æçš„ï¼Œå¾ˆæœ‰æ„æ€ï¼Œä¸Šæ¥å…ˆåšäº†ä¸‰é“ç®—æ³•é¢˜ï¼ˆç­”å¾—ä¸å¥½ï¼‰ï¼Œç„¶åé¢è¯•å®˜èŠ±äº†å¾ˆé•¿æ—¶é—´ä¸ºæˆ‘è§£ç­”äº†ä¸‰é“é¢˜ç›®ï¼Œä¸€åº¦è®©æˆ‘ä»¥ä¸ºå·²ç»æ˜¯è¿™å®¶å…¬å¸çš„å‘˜å·¥äº†ã€‚ä¸´äº†ï¼Œå¾æ±‚äº†ä¸‹é¢è¯•å®˜å¯¹æˆ‘çš„å»ºè®®ï¼Œâ€œä¸æ˜¯ç§‘ç­å‡ºèº«ï¼ˆæˆ‘æœ¬ç§‘å­¦çš„ç‰©ç†ï¼‰ï¼Œè®¡ç®—æœºåŸºç¡€å’Œç®—æ³•æ˜¯åå¼±äº›ï¼Œè¿™ä¸¤å—è¦å¥½å¥½æ‰“ç£¨æ‰“ç£¨ã€‚â€ å‰è¨€ åœ¨å­¦ä¹ ç®—æ³•å¾ˆç¾è¯¾ç¨‹çš„æ—¶å€™ï¼Œå­¦ä¹ åˆ°äº†ä¸€äº›ä½è¿ç®—çš„å¥‡æŠ€æ·«å·§ï¼Œæ”¶å½•åœ¨æ­¤ åˆ¤æ–­å¥‡å¶æ•°åˆ¤æ–­å¥‡æ•°1 &amp; x == 11System.out.println((1991 &amp; 1) == 1); åˆ¤æ–­å¶æ•°1 &amp; x == 0 1System.out.println((1990 &amp; 1) == 0); è·å–äºŒè¿›åˆ¶æ•°xä½yæ˜¯1è¿˜æ˜¯0 å°†xå³ç§»y - 1ä½ï¼Œä¸1 1234int x = 0b010110010;int y = 5;int res = (x &gt;&gt; (y - 1)) &amp; 1;System.out.println(res); äº¤æ¢ä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼ä¸ç”¨åˆ¤æ–­è¯­å¥ï¼Œæ±‚æ•´æ•°çš„ç»å¯¹å€¼ å¼‚æˆ–ï¼Œå¯ä»¥ç†è§£ä¸ºä¸è¿›ä½åŠ æ³•ï¼Œ1 + 1 = 0ï¼Œ0 + 0 = 0ï¼Œ1 + 0 = 1 å¼‚æˆ–çš„æ€§è´¨ äº¤æ¢å¾‹ï¼šå¯ä»»æ„äº¤æ¢è¿ç®—å› å­çš„ä½ç½®ï¼Œç»“æœä¸å˜ ç»“åˆå¾‹ï¼šå³ï¼ˆa ^ bï¼‰^ c == a ^ ( b ^ c ) å¯¹äºä»»ä½•æ•°xï¼Œéƒ½æœ‰x ^ x = 0, x ^ 0 = xï¼ŒåŒè‡ªå·±æ±‚å¼‚æˆ–ä¸º0ï¼ŒåŒ0æ±‚å¼‚æˆ–ä¸ºè‡ªå·± è‡ªåæ€§ï¼šA ^ B ^ B = A ^ 0 = Aï¼Œè¿ç»­å’ŒåŒä¸€ä¸ªå› å­åšå¼‚æˆ–è¿ç®—ï¼Œæœ€ç»ˆç»“æœä¸ºè‡ªå·± 1234int a = -100;// aä¸ºæ­£æ•°ï¼Œa &gt;&gt; 31 = 00000000 00000000 00000000 00000000ï¼Œæ±‚ç»å¯¹å€¼å°±æ˜¯è‡ªå·±// aä¸ºè´Ÿæ•°ï¼Œa &gt;&gt; 31 = 11111111 11111111 11111111 11111111ï¼Œæ±‚ç»å¯¹å€¼å°±æ˜¯è‡ªå·± * -1ï¼ˆ00000000 00000000 00000000 00000001ï¼‰System.out.println((a + (a &gt;&gt; 31) ^ (a &gt;&gt; 31))); è¿™è¾¹è¯¾ç¨‹è®²çš„ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä¸‹ä½è¿ç®—æ±‚æ•´æ•°çš„ç»å¯¹å€¼ï¼Œå†™çš„å¾ˆå¥½ã€‚","tags":[{"name":"algorithm","slug":"algorithm","permalink":"https://gcdd1993.github.io/tags/algorithm/"}]},{"title":"åœ¨Dubboä¸­ä½¿ç”¨Kryoåºåˆ—åŒ–åè®®","date":"2020-12-09T03:43:12.000Z","path":"p/34460/","text":"Kryoæ˜¯ä»€ä¹ˆï¼ŸKryoæ˜¯ç”¨äºJavaçš„å¿«é€Ÿé«˜æ•ˆçš„äºŒè¿›åˆ¶å¯¹è±¡å›¾åºåˆ—åŒ–æ¡†æ¶ã€‚ è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯é«˜é€Ÿï¼Œå°å°ºå¯¸å’Œæ˜“äºä½¿ç”¨çš„APIã€‚ä¸ç®¡æ˜¯å°†å¯¹è±¡æŒä¹…ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“è¿˜æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“æ—¶ï¼Œéƒ½å¯ä»¥å°è¯•Kryoã€‚ Kryoè¿˜å¯ä»¥æ‰§è¡Œè‡ªåŠ¨çš„æ·±æµ…å¤åˆ¶/å…‹éš†ã€‚è¿™æ˜¯ä»å¯¹è±¡åˆ°å¯¹è±¡çš„ç›´æ¥å¤åˆ¶ï¼Œè€Œä¸æ˜¯ä»å¯¹è±¡åˆ°å­—èŠ‚çš„å¤åˆ¶ã€‚ å…·ä½“å¯ä»¥å‚è€ƒKryoå®˜ç½‘ åœ¨Dubboä¸­ä½¿ç”¨Kryo æœ¬æ–‡åŸºäºDubboç‰ˆæœ¬2.7.8 Dubboæ”¯æŒéå¸¸å¤šçš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¦‚hession2ã€avroã€FSTç­‰ç­‰ï¼Œå…¶ä¸­Dubboå®˜ç½‘æ¨èçš„åºåˆ—åŒ–æ–¹å¼æ˜¯Kryoï¼Œå› ä¸ºKryoæ˜¯ä¸€ç§éå¸¸æˆç†Ÿçš„åºåˆ—åŒ–å®ç°ï¼Œå·²ç»åœ¨Twitterã€Grouponã€Yahooä»¥åŠå¤šä¸ªè‘—åå¼€æºé¡¹ç›®ï¼ˆå¦‚Hiveã€Stormï¼‰ä¸­å¹¿æ³›çš„ä½¿ç”¨ã€‚ å¼€å§‹åœ¨Dubboä¸­ä½¿ç”¨Kryoéå¸¸æ–¹ä¾¿ï¼Œé¦–å…ˆå¼•å…¥ä¾èµ– 1234// è§£å†³ä¸€äº›Kryoç‰¹æ®Šåºåˆ—åŒ–ï¼Œhttps://github.com/magro/kryo-serializersimplementation &#x27;de.javakaffee:kryo-serializers:0.43&#x27;// é«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶, https://github.com/EsotericSoftware/kryoimplementation &#x27;com.esotericsoftware:kryo:4.0.2&#x27; å¦‚æœåªæ˜¯ç®€å•ä½¿ç”¨ï¼Œå¼•å…¥kryoå³å¯ï¼Œå¦‚æœè¦æ”¯æŒä¸€äº›ä¾‹å¦‚Listæ¥å£ï¼Œåˆ™éœ€è¦å¼•å…¥kryo-serializersï¼Œå®ƒé’ˆå¯¹ä¸€äº›ç‰¹æ®Šç±»ä¸ºKryoåšäº†é€‚é…ã€‚ é…ç½®åœ¨Dubboä¸­å¯ç”¨Kryoåºåˆ—åŒ–æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨SpringBoot YMLé…ç½®æ–¹å¼ 123protocol: serialization: kryo optimizer: org.hmwebframework.microservice.dubbo.serialize.SerializationOptimizerImpl å…¶ä¸­org.hmwebframework.microservice.dubbo.serialize.SerializationOptimizerImplæ˜¯æŒ‡å®šKryoåºåˆ—åŒ–ç±»ï¼Œä¾‹å¦‚ 123456789101112public class SerializationOptimizerImpl implements SerializationOptimizer &#123; public Collection&lt;Class&gt; getSerializableClasses() &#123; List&lt;Class&gt; classes = new LinkedList&lt;Class&gt;(); classes.add(BidRequest.class); classes.add(BidResponse.class); classes.add(Device.class); classes.add(Geo.class); classes.add(Impression.class); classes.add(SeatBid.class); return classes; &#125;&#125; åˆ°è¿™ï¼ŒDubboä½¿ç”¨Kryoå°±å·²ç»OKäº†ã€‚ ä¸ºä»€ä¹ˆè¦å®šä¹‰SerializationOptimizerå®ç°ç±»ï¼Ÿé¦–å…ˆæˆ‘ä»¬åˆ†æä¸‹SerializationOptimizer 123456789public interface SerializationOptimizer &#123; /** * Get serializable classes * * @return serializable classes * */ Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses();&#125; æä¾›äº†ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼Œç”¨äºè·å–åºåˆ—åŒ–çš„javaç±»å‹åˆ—è¡¨ï¼Œåœ¨DubboProtocol#optimizeSerializationä¸­è¢«ä½¿ç”¨ 12345678910111213141516171819202122232425private void optimizeSerialization(URL url) throws RpcException &#123; // ... try &#123; Class clazz = Thread.currentThread().getContextClassLoader().loadClass(className); // åˆ¤æ–­æ˜¯å¦ä¸ºSerializationOptimizerå®ç°ç±» if (!SerializationOptimizer.class.isAssignableFrom(clazz)) &#123; throw new RpcException(&quot;The serialization optimizer &quot; + className + &quot; isn&#x27;t an instance of &quot; + SerializationOptimizer.class.getName()); &#125; SerializationOptimizer optimizer = (SerializationOptimizer) clazz.newInstance(); if (optimizer.getSerializableClasses() == null) &#123; return; &#125; // å°†SerializationOptimizerä¸­å®šä¹‰çš„ç±»å‹åˆ—è¡¨ï¼Œæ³¨å†Œåˆ°SerializableClassRegistry for (Class c : optimizer.getSerializableClasses()) &#123; SerializableClassRegistry.registerClass(c); &#125; optimizers.add(className); &#125; catch (ClassNotFoundException e) &#123; // ... &#125;&#125; æ¥ç€ï¼Œä»SerializableClassRegistryä¸­æ‹¿å‡ºæ³¨å†Œçš„ç±»å‹ï¼Œè¿›è¡ŒKryoçš„ç±»å‹æ³¨å†Œï¼Œå¯ä»¥çœ‹åˆ°SerializableClassRegistry#getRegisteredClassesè¢«FSTå’ŒKryoä½¿ç”¨ï¼Œè¯æ˜FSTå’ŒKryoéƒ½éœ€è¦è¿›è¡Œåºåˆ—åŒ–ç±»çš„æ³¨å†Œï¼Œå½“ç„¶FSTä¹Ÿæ”¯æŒä¸æ³¨å†Œåºåˆ—åŒ–ç±»å‹ã€‚ Kryoç±»æ³¨å†Œçš„å…·ä½“ç»†èŠ‚ï¼ŒAbstractKryoFactory#create 123456789101112// ...for (Class clazz : registrations) &#123; kryo.register(clazz);&#125;// éå†å–å‡ºSerializableClassRegistryçš„æ³¨å†Œç±»ï¼Œä¾æ¬¡å°†ç±»æ³¨å†Œåˆ°KryoSerializableClassRegistry.getRegisteredClasses().forEach((clazz, ser) -&gt; &#123; if (ser == null) &#123; kryo.register(clazz); &#125; else &#123; kryo.register(clazz, (Serializer) ser); &#125;&#125;); å¾ªç¯å–å‡ºSerializableClassRegistryä¸­çš„æ³¨å†Œç±»è¿›è¡Œæ³¨å†Œï¼Œçœ‹åˆ°è¿™é‡Œä¹Ÿèƒ½æ˜ç™½ï¼Œä¸ºä»€ä¹ˆDubboå®˜ç½‘çš„SerializationOptimizerä¾‹å­éœ€è¦ä½¿ç”¨LinkedListã€‚ ä¸ºä»€ä¹ˆKryoéœ€è¦è¿›è¡Œç±»çš„æ³¨å†Œï¼Œä¸”ä¿æŒé¡ºåºï¼Ÿç±»çš„æ³¨å†Œåœ¨Dubboè¿™æ ·çš„RPCæ¡†æ¶è¿›è¡Œé€šä¿¡æ—¶ï¼Œæ€§èƒ½ç“¶é¢ˆå¾€å¾€åœ¨äºRPCä¼ è¾“è¿‡ç¨‹ä¸­çš„ç½‘ç»œIOè€—æ—¶ï¼Œæå‡ç½‘ç»œIOçš„åŠæ³•ï¼Œä¸€æ˜¯åŠ å¤§å¸¦å®½ï¼ŒäºŒæ˜¯å‡å°ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œè€Œé«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶å¯ä»¥åšåˆ°çš„å°±æ˜¯å‡å°ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚ Kryoæ³¨å†Œç±»çš„æ—¶å€™ï¼Œä½¿ç”¨äº†ä¸€ä¸ªintç±»å‹çš„IDæ¥ä¸ç±»è¿›è¡Œå…³è”ï¼Œåœ¨åºåˆ—åŒ–è¯¥ç±»çš„å®ä¾‹æ—¶ï¼Œç”¨int IDæ¥æ ‡è¯†ç±»å‹ï¼Œååºåˆ—åŒ–è¯¥ç±»æ—¶ï¼ŒåŒæ ·é€šè¿‡int IDæ¥æ‰¾åˆ°ç±»å‹ï¼Œè¿™æ¯”å†™å‡ºç±»åé«˜æ•ˆçš„å¤šã€‚ ç»´æŒç±»æ³¨å†Œé¡ºåºKryoæ³¨å†Œç±»çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç±»å…³è”çš„int IDï¼Œä¾‹å¦‚ 1234Kryo kryo = new Kryo();kryo.register(SomeClass.class, 10);kryo.register(AnotherClass.class, 11);kryo.register(YetAnotherClass.class, 12); ä½†æ˜¯ä¸Šé¢æˆ‘ä»¬è®²åˆ°ï¼ŒDubboå¯¹Kryoåšäº†ç›¸å½“ç¨‹åº¦çš„é›†æˆï¼Œå¯¼è‡´æˆ‘ä»¬æ²¡æ³•ç»™ç±»æŒ‡å®šint IDï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿è¯æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹ç±»æ³¨å†Œé¡ºåºçš„ä¸€è‡´ï¼Œé—´æ¥åœ°ä¿è¯äº†int IDçš„ä¸€è‡´æ€§ã€‚ ä¼˜åŒ–åå°„è·å–ä»£æ³¨å†Œçš„ç±» åœ¨Dubboä¸­ä½¿ç”¨Kryoæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªSerializationOptimizerï¼Œå¹¶æä¾›ä¸€ä¸ªæ³¨å†Œç±»åˆ—è¡¨ã€‚éšç€é¡¹ç›®è§„æ¨¡æ‰©å¤§ï¼Œä¸å¯èƒ½æ—¶æ—¶åˆ»åˆ»æƒ³ç€ç»´æŠ¤è¿™ä¸ªæ³¨å†Œç±»åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„æ¥è‡ªåŠ¨è·å–è¿™ä¸ªæ³¨å†Œç±»åˆ—è¡¨ å¼•å…¥ä¾èµ– 12// Javaåå°„å·¥å…·åŒ…implementation &#x27;org.reflections:reflections:0.9.11&#x27; ç¼–å†™æ¥å£ï¼Œ 123public interface KryoDubboSerializable extends Serializable &#123;&#125; ç¼–å†™SerializationOptimizerå®ç°ç±» 123456789101112131415161718192021222324252627282930313233@Slf4jpublic abstract class AbstractSerializationOptimizerImpl implements SerializationOptimizer &#123; private final List&lt;Class&lt;?&gt;&gt; classList; public AbstractSerializationOptimizerImpl() &#123; var reflections = new Reflections( new ConfigurationBuilder() .forPackages(basePackage()) .addScanners(new SubTypesScanner()) ); this.classList = reflections.getSubTypesOf(KryoDubboSerializable.class) .stream() // Kryoåºåˆ—åŒ–åè®®è¦æ±‚ç±»æ³¨å†Œé¡ºåºä¸€è‡´ .sorted(Comparator.comparing(Class::getSimpleName)) .collect(Collectors.toList()); log.info(&quot;load &#123;&#125; classes to use kryo serializable&quot;, this.classList.size()); log.debug(&quot;kryo serializable classes: &#123;&#125;&quot;, this.classList.stream().map(Class::getSimpleName).collect(Collectors.joining(&quot;,&quot;))); &#125; @Override public Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123; return classList; &#125; /** * æ‰«æåŒ…è·¯å¾„ * * @return packages */ protected abstract String[] basePackage();&#125; æ¯æ¬¡ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦ç»§æ‰¿AbstractSerializationOptimizerImplï¼Œå¹¶æä¾›å¾…æ³¨å†ŒåŒ…è·¯å¾„ï¼ˆæ”¯æŒå¤šä¸ªï¼‰ï¼Œå¾…æ³¨å†Œçš„ç±»éœ€è¦å®ç°KryoDubboSerializableæ¥å£ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡çµæ´»æ€§ï¼ˆå¦‚æœä¸éœ€è¦æ³¨å†Œåˆ°Kryoï¼Œä¸å®ç°è¯¥æ¥å£å³å¯ï¼‰ã€‚ å‚è€ƒ https://dubbo.apache.org/zh/docs/v2.7/user/serialization/ https://github.com/EsotericSoftware/kryo","tags":[{"name":"Java","slug":"Java","permalink":"https://gcdd1993.github.io/tags/Java/"}]},{"title":"æ˜é‡‘è§£ç»‘æ–¹æ¡ˆï¼ˆå·²æˆåŠŸè§£ç»‘å¾®ä¿¡ï¼‰","date":"2020-12-09T03:43:12.000Z","path":"p/34461/","text":"æ˜é‡‘çš„ç»‘å®šé™åˆ¶ä¸ºåŒä¸€ä¸ªç¬¬ä¸‰æ–¹è´¦å·åªèƒ½ç»‘å®šä¸€ä¸ªæ˜é‡‘è´¦å·ï¼Œä¸”å¿…é¡»ç•™å­˜ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»‘å®šã€‚ æ¯”å¦‚ï¼Œæˆ‘åªç»‘å®šäº†å¾®ä¿¡ï¼Œæƒ³è¦è§£ç»‘å¾®ä¿¡ï¼Œå¯¹ä¸èµ·ï¼Œä¸æ”¯æŒã€‚ è§£å†³æ–¹æ¡ˆæˆ‘çªç„¶æƒ³åˆ°ï¼Œæ—¢ç„¶å¿…é¡»ç•™å­˜ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»‘å®šï¼Œé‚£æˆ‘ç•™å­˜ä¸€ä¸ªé‚®ç®±ç»‘å®šä¸å°±å¥½äº†å—ï¼Ÿ æ€è·¯å°±æ˜¯ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€ï¼Œé€šè¿‡ç»‘å®šä¸€ä¸ªé‚®ç®±è´¦å·ï¼Œæ¥ç»‘å®šé‚®ç®±ï¼Œä»è€Œå°†æˆ‘ä»¬çš„è´¦å·è§£æ”¾å‡ºæ¥ï¼Œç»‘å®šæˆ‘ä»¬çš„å¤§å·æˆ–è€…å…¶ä»–è´¦å·ã€‚ è·å–ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€æ‰“å¼€ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€ï¼Œä½ å°†ä¼šè·å–åˆ°ä¸€ä¸ªä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªé‚®ä»¶ç»‘å®šæˆ‘ä»¬çš„æ˜é‡‘è´¦å·ã€‚ ç»‘å®šä¸´æ—¶é‚®ç®±ç‚¹å‡»ç»‘å®šé‚®ç®±ï¼Œè¾“å…¥æˆ‘ä»¬ä¸Šä¸€æ­¥è·å–åˆ°çš„ä¸´æ—¶é‚®ä»¶åœ°å€ï¼Œè¿”å›ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€ç½‘ç«™ï¼Œè€å¿ƒç­‰å¾…10så·¦å³ã€‚ ä½ å°†ä¼šå—åˆ°æ˜é‡‘çš„é‚®ç®±ç»‘å®šéªŒè¯é‚®ä»¶ï¼Œæ‰“å¼€å¹¶ç‚¹å‡»ï¼Œç›´åˆ°ç»‘å®šæˆåŠŸã€‚ è§£ç»‘æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¼€å¿ƒçš„è§£ç»‘æˆ‘ä»¬è‡ªå·±çš„è´¦å·äº†ã€‚æˆ‘è¦è§£ç»‘çš„æ˜¯å¾®ä¿¡ï¼Œè¯•ä¸€ä¸‹å§ã€‚ å‹æƒ…æé†’ ç”±äºä½¿ç”¨çš„æ˜¯ä¸€æ¬¡æ€§é‚®ä»¶åœ°å€ï¼Œè¯¥åšæ³•å¯èƒ½ä¼šå¯¼è‡´ä½ è§£ç»‘çš„è´¦å·ç™»å½•ä¸ä¸Šï¼Œè¯·è°¨æ…æ“ä½œï¼","tags":[{"name":"æŠ€å·§","slug":"æŠ€å·§","permalink":"https://gcdd1993.github.io/tags/%E6%8A%80%E5%B7%A7/"}]},{"title":"Scalaå­¦ä¹ ç¬”è®°","date":"2020-02-02T05:49:38.000Z","path":"p/37757/","text":"å†™åœ¨å‰é¢Scalaæ˜¯ä¸€é—¨ä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€é—¨çº¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä¸”æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ã€‚ Scalaè¿è¡ŒäºJvmï¼Œæ‰€æœ‰Scalaçš„ä»£ç ï¼Œéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œç„¶åäº¤ç”±Javaè™šæ‹Ÿæœºæ¥è¿è¡Œã€‚Scalaå’ŒJavaæ˜¯å¯ä»¥æ— ç¼äº’æ“ä½œçš„ã€‚Scalaå¯ä»¥ä»»æ„è°ƒç”¨Javaçš„ä»£ç ã€‚ å®‰è£…Scala ä»Scalaå®˜æ–¹ç½‘ç«™ä¸‹è½½ï¼Œhttp://www.scala-lang.org/download/ï¼Œwindowsç‰ˆæœ¬çš„å®‰è£…åŒ…æ˜¯`scala-2.11.7.msi`ã€‚ ä½¿ç”¨ä¸‹è½½ä¸‹æ¥çš„å®‰è£…åŒ…å®‰è£…Scalaã€‚ åœ¨PATHç¯å¢ƒå˜é‡ä¸­ï¼Œé…ç½®$SCALA_HOME/binç›®å½•ã€‚ åœ¨windowså‘½ä»¤è¡Œå†…å³å¯ç›´æ¥é”®å…¥scalaï¼Œæ‰“å¼€scalaå‘½ä»¤è¡Œï¼Œè¿›è¡Œscalaç¼–ç¨‹ã€‚ 12345$ scalaWelcome to Scala 2.11.12 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_231).Type in expressions for evaluation. Or try :help.scala&gt; åŸºç¡€è¯­æ³•Scalaè§£é‡Šå™¨çš„ä½¿ç”¨REPL scalaè§£é‡Šå™¨ä¹Ÿè¢«ç§°ä¸ºREPLï¼Œä¼šå¿«é€Ÿç¼–è¯‘scalaä»£ç ä¸ºå­—èŠ‚ç ï¼Œç„¶åäº¤ç»™JVMæ¥æ‰§è¡Œã€‚ Readï¼ˆå–å€¼ï¼‰-&gt; Evaluationï¼ˆæ±‚å€¼ï¼‰-&gt; Printï¼ˆæ‰“å°ï¼‰-&gt; Loopï¼ˆå¾ªç¯ï¼‰ã€‚ è®¡ç®—è¡¨è¾¾å¼ åœ¨scala&gt;å‘½ä»¤è¡Œå†…ï¼Œé”®å…¥scalaä»£ç ï¼Œè§£é‡Šå™¨ä¼šç›´æ¥è¿”å›ç»“æœç»™ä½ ã€‚å¦‚æœä½ æ²¡æœ‰æŒ‡å®šå˜é‡æ¥å­˜æ”¾è¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆå€¼é»˜è®¤çš„åç§°ä¸ºresï¼Œè€Œä¸”ä¼šæ˜¾ç¤ºç»“æœçš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚Intã€Doubleã€Stringç­‰ç­‰ã€‚ ä¾‹å¦‚ï¼Œè¾“å…¥1 + 1ï¼Œä¼šçœ‹åˆ°res0: Int = 2 12scala&gt; 1 + 1res0: Int = 2 å†…ç½®å˜é‡ åœ¨åé¢å¯ä»¥ç»§ç»­ä½¿ç”¨resè¿™ä¸ªå˜é‡ï¼Œä»¥åŠå®ƒå­˜æ”¾çš„å€¼ã€‚ ä¾‹å¦‚ï¼Œ2.0 * res0ï¼Œè¿”å›res1: Double = 4.0 12scala&gt; 2.0 * res0res1: Double = 4.0 ä¾‹å¦‚ï¼Œâ€Hi, â€œ + res0ï¼Œè¿”å›res2: String = Hi, 2 12scala&gt; &quot;Hi, &quot; + res0res2: String = Hi, 2 è‡ªåŠ¨è¡¥å…¨ åœ¨scala&gt;å‘½ä»¤è¡Œå†…ï¼Œå¯ä»¥ä½¿ç”¨Tabé”®è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ã€‚ ä¾‹å¦‚ï¼Œè¾“å…¥res2.toï¼Œæ•²å‡»Tabé”®ï¼Œè§£é‡Šå™¨ä¼šæ˜¾ç¤ºå‡ºä»¥ä¸‹é€‰é¡¹ï¼ŒtoCharArrayï¼ŒtoLowerCaseï¼ŒtoStringï¼ŒtoUpperCaseã€‚å› ä¸ºæ­¤æ—¶æ— æ³•åˆ¤å®šä½ éœ€è¦è¡¥å…¨çš„æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¼šæä¾›ç»™ä½ æ‰€æœ‰çš„é€‰é¡¹ã€‚ 12scala&gt; res2.toto toCharArray toIterable toMap ... ä¾‹å¦‚ï¼Œè¾“å…¥res2.toUï¼Œæ•²å‡»Tabé”®ï¼Œç›´æ¥ä¼šç»™ä½ è¡¥å…¨ä¸ºres2.toUpperCaseã€‚ å£°æ˜å˜é‡å£°æ˜valå˜é‡ å¯ä»¥å£°æ˜valå˜é‡æ¥å­˜æ”¾è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœã€‚ ä¾‹å¦‚ï¼Œval result = 1 + 1 12scala&gt; val result = 1 + 1result: Int = 2 åç»­è¿™äº›å¸¸é‡æ˜¯å¯ä»¥ç»§ç»­ä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œ2 * result 12scala&gt; 2 * resultres6: Int = 4 ä½†æ˜¯å¸¸é‡å£°æ˜åï¼Œæ˜¯æ— æ³•æ”¹å˜å®ƒçš„å€¼çš„ï¼Œä¾‹å¦‚ï¼Œresult = 1ï¼Œä¼šè¿”å›error: reassignment to valçš„é”™è¯¯ä¿¡æ¯ã€‚ 1234scala&gt; result = 1&lt;console&gt;:12: error: reassignment to val result = 1 ^ å£°æ˜varå˜é‡ å¦‚æœè¦å£°æ˜å€¼å¯ä»¥æ”¹å˜çš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨varå˜é‡ã€‚ ä¾‹å¦‚ï¼Œval myresult = 1ï¼Œmyresult = 2 ä½†æ˜¯åœ¨Scalaç¨‹åºä¸­ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨valï¼Œä¹Ÿå°±æ˜¯å¸¸é‡ï¼Œå› æ­¤æ¯”å¦‚ç±»ä¼¼äºsparkçš„å¤§å‹å¤æ‚ç³»ç»Ÿä¸­ï¼Œéœ€è¦å¤§é‡çš„ç½‘ç»œä¼ è¾“æ•°æ®ï¼Œå¦‚æœä½¿ç”¨varï¼Œå¯èƒ½ä¼šæ‹…å¿ƒå€¼è¢«é”™è¯¯çš„æ›´æ”¹ã€‚ åœ¨Javaçš„å¤§å‹å¤æ‚ç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘ä¸­ï¼Œä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä¼ é€’ç»™å…¶ä»–æ¨¡å— / ç»„ä»¶ / æœåŠ¡çš„å¯¹è±¡ï¼Œè®¾è®¡æˆä¸å¯å˜ç±»ï¼ˆImmutable Classï¼‰ã€‚åœ¨é‡Œé¢ä¹Ÿä¼šä½¿ç”¨Javaçš„å¸¸é‡å®šä¹‰ï¼Œæ¯”å¦‚finalï¼Œé˜»æ­¢å˜é‡çš„å€¼è¢«æ”¹å˜ã€‚ä»è€Œæé«˜ç³»ç»Ÿçš„å¥å£®æ€§ï¼ˆrobustï¼Œé²æ£’æ€§ï¼‰ï¼Œå’Œå®‰å…¨æ€§ã€‚ æŒ‡å®šç±»å‹ æ— è®ºå£°æ˜valå˜é‡ï¼Œè¿˜æ˜¯å£°æ˜varå˜é‡ï¼Œéƒ½å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå…¶ç±»å‹ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒScalaä¼šè‡ªåŠ¨æ ¹æ®å€¼ï¼Œè¿›è¡Œç±»å‹çš„æ¨æ–­ã€‚ ä¾‹å¦‚ï¼Œval name: String = null ä¾‹å¦‚ï¼Œval name: Any = &quot;leo&quot;","tags":[{"name":"Scala","slug":"Scala","permalink":"https://gcdd1993.github.io/tags/Scala/"}]},{"title":"MacOsä½¿ç”¨CleanMyMac Xæ¸…é™¤å¯æ¸…é™¤ç©ºé—´","date":"2019-10-11T10:41:15.000Z","path":"p/46997/","text":"å†™åœ¨å‰é¢æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨CleanMyMac Xæ¸…é™¤å¯æ¸…é™¤çš„ç©ºé—´ å¯ä»¥çœ‹åˆ°ï¼Œå¯æ¸…é™¤çš„ç©ºé—´è¾¾åˆ°äº†125.79GBï¼Œè™½ç„¶è¯´ä¸å½±å“ç³»ç»Ÿçš„ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶é—´æœºå™¨è¿›è¡Œå¤‡ä»½çš„æ—¶å€™ï¼Œä»ç„¶ä¼šå°†å¯æ¸…é™¤ç©ºé—´å½“æˆå¤‡ä»½çš„ä¸€éƒ¨åˆ†ï¼Œé€ æˆå¤‡ä»½æ–‡ä»¶è¿‡å¤§ï¼Œé¦–æ¬¡å¤‡ä»½æ—¶é—´è¿‡é•¿ã€‚ å‡†å¤‡æ¸…é™¤å¯æ¸…é™¤ç©ºé—´ï¼Œä½ åªéœ€è¦CleanMyMac Xè¿™ä¸ªå·¥å…·å³å¯ï¼Œæˆ‘åˆ†äº«ä¸‹æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå½“ç„¶æœ‰èƒ½åŠ›çš„å»ºè®®ä½¿ç”¨æ­£ç‰ˆã€‚ https://pan.baidu.com/s/1L05kBwZIghM73IRC8rMpMw å¼€å§‹å®‰è£…å®Œæ¯•åï¼Œæ‰“å¼€CleanMyMac X ç‚¹å‡»â€ç»´æŠ¤â€œï¼Œä½ å¯ä»¥ä½¿ç”¨â€œé‡Šæ”¾å¯æ¸…é™¤ç©ºé—´â€æˆ–è€…æ˜¯â€œæ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«â€ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯â€œæ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«â€ å»ºè®®å…ˆä½¿ç”¨â€œæ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«â€ï¼Œå¦‚æœä¸è¡Œï¼Œå†é‡Šæ”¾å¯æ¸…é™¤ç©ºé—´ï¼Œå› ä¸ºé‡Šæ”¾å¯æ¸…é™¤ç©ºé—´è€—æ—¶è¾ƒé•¿ ç‚¹å‡»è¿è¡Œï¼Œç¨ä½œç­‰å¾…å³å¯ è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å›åˆ°ç£ç›˜å·¥å…·ï¼Œå†æ¬¡æŸ¥çœ‹å¯æ¸…é™¤ç©ºé—´ï¼Œå¯ä»¥å‘ç°ï¼Œå¯æ¸…é™¤ç©ºé—´å°äº†ä¸å°‘ï¼","tags":[{"name":"macOs","slug":"macOs","permalink":"https://gcdd1993.github.io/tags/macOs/"}]},{"title":"TamperMonkey ä½¿ç”¨æŒ‡å—ä»¥åŠè„šæœ¬æ¨è","date":"2019-10-07T12:56:20.000Z","path":"p/29031/","text":"å†™åœ¨å‰é¢Chromeæµè§ˆå™¨æ˜¯æœ€é€‚åˆå¼€å‘è€…ä½¿ç”¨çš„æµè§ˆå™¨ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºChromeå¯¹äºJsçš„å‹å¥½æ”¯æŒï¼Œæ›´æ˜¯ç”±äºChromeæ”¯æŒä¸°å¯Œä¸”åŠŸèƒ½å¼ºå¤§çš„æ’ä»¶ï¼Œæ‰©å±•äº†æµè§ˆå™¨çš„åŠŸèƒ½å’Œä½¿ç”¨ä½“éªŒã€‚ åœ¨è¿™äº›æ’ä»¶é‡Œé¢ï¼Œç›¸ä¿¡ä½ ä¸€å®šä½¿ç”¨è¿‡TamperMonkeyï¼Œä»–å¯ä»¥è®©ä½ åŠ é€Ÿä¸‹è½½ç™¾åº¦ç½‘ç›˜ï¼Œè·Ÿç™¾åº¦é™é€Ÿè¯´æ‹œæ‹œï¼Œä¹Ÿå¯ä»¥è®©ä½ å…è´¹è§‚çœ‹VIPå½±è§†å’ŒéŸ³ä¹ï¼Œåæ­£ä¸€å¥è¯ï¼Œé»‘ç§‘æŠ€ï¼ TamperMonkeyä½¿ç”¨TamperMonkeyçš„å®˜ç½‘æ˜¯ï¼šhttps://www.tampermonkey.netï¼Œæ”¯æŒå„ç±»Chromeå†…æ ¸çš„æµè§ˆå™¨ä»¥åŠç«ç‹æµè§ˆå™¨ï¼ˆFireFoxï¼‰ã€‚ ä»¥ä¸‹ä»¥Chromeæµè§ˆå™¨ä¸ºä¾‹ã€‚ å®‰è£…å®‰è£…éå¸¸ç®€å•ï¼Œæ‰“å¼€Chromeå•†åº—ï¼Œç‚¹å‡»â€æ·»åŠ åˆ°Chromeâ€ å®‰è£…è„šæœ¬ ç‚¹å‡»â€è·å–æ–°è„šæœ¬â€ é€‰æ‹©åˆé€‚çš„è„šæœ¬æºï¼Œè¿™é‡Œæ¨èGreasyFork å®‰è£…è„šæœ¬ï¼Œä»¥VIPè§†é¢‘è§£æä¸ºä¾‹ æˆ‘ä»¬ç‚¹å‡»ç¬¬ä¸€ä¸ªè„šæœ¬ï¼ˆæœ‰æ—¶å€™ä¼šæ¯”è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ä¸‹ï¼‰ï¼Œç‚¹å‡»â€å®‰è£…æ­¤è„šæœ¬â€ ç‚¹å‡»å®‰è£… ä¸‹é¢å¯ä»¥ç›´æ¥çœ‹åˆ°è„šæœ¬çš„æºç ï¼Œæœ‰èƒ½åŠ›çš„è¯ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹æˆ–è€…ç¼–å†™è„šæœ¬ã€‚ çœ‹çœ‹è„šæœ¬çš„æ•ˆæœ æˆ‘ä»¬æ‰“å¼€çˆ±å¥‡è‰ºï¼Œæ‰¾ä¸ªvipç”µå½±ï¼Œæ¯”å¦‚æœ€è¿‘çƒ­æ’­çš„é“¶æ²³è¡¥ä¹ ç­ TamperMonkeyè„šæœ¬æ¨èåœ¨TamperMonkeyçš„ç®¡ç†é¢æ¿ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…çš„æ‰€æœ‰è„šæœ¬ ä¸‹é¢åˆ—ä¸¾å‡ºæˆ‘å¸¸ç”¨çš„è„šæœ¬ 52pojieå¾çˆ±ç ´è§£è®ºå›è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹-å…æ‰“æ‰° å¾çˆ±ç ´è§£è®ºå›-ç™¾åº¦ç½‘ç›˜é“¾æ¥æ¿€æ´»-æå–ç è‡ªåŠ¨è¡¥å…¨ ac-baidu-é‡å®šå‘ä¼˜åŒ–ç™¾åº¦æœç‹—è°·æ­Œæœç´¢-å»å¹¿å‘Š-favicon-åŒåˆ— ac-baidu-ä¼˜åŒ–ç™¾åº¦-æœç‹—-è°·æ­Œæœç´¢ç»“æœä¹‹å…³é”®è¯è‡ªåŠ¨é«˜äº® csdnè‡ªåŠ¨å±•å¼€-å»å¹¿å‘Š-å‡€åŒ–å‰ªè´´æ¿-å…ç™»é™† ä¸€é”®vipè§†é¢‘è§£æ-å»å¹¿å‘Š-å…¨ç½‘-ä¸€ç«™å¼éŸ³ä¹æœç´¢ä¸‹è½½-ç™¾åº¦äº‘ç¦»çº¿è·³è½¬-è·å–bç«™å°é¢-æ·˜å®äº¬ä¸œä¼˜æƒ åˆ¸-2019-10-01-æ›´æ–°-æŠ¥é”™è¯·åŠæ—¶åé¦ˆ åŸé€šç½‘ç›˜-çš®çš®ç›˜-ç‰›ç›˜æ˜¾ç¤ºæ­£ç¡®ä¸‹è½½åœ°å€ ç™¾åº¦æ–‡åº“æ–‡æ¡£å…è´¹ä¸‹è½½-åŸæ–‡æ¡£-è½¬æ¢æå–æ–‡æ¡£-æ–‡æ¡£å†…å®¹è‡ªç”±å¤åˆ¶-ç§»é™¤å¹¿å‘Š-è±†ä¸ç½‘æ–‡æ¡£ä¸‹è½½-è§£é™¤å¤§éƒ¨åˆ†ç½‘ç«™æ“ä½œé™åˆ¶-å…¨ç½‘vipè§†é¢‘å…è´¹åœ¨çº¿çœ‹-æ”¯æŒç”µè§†å‰§å…è·³å‡ºé€‰é›† ç™¾åº¦ç½‘ç›˜ç›´é“¾ä¸‹è½½åŠ©æ‰‹ çŸ¥ä¹ç½‘é¡µåŠ©æ‰‹-5å¤§åŠŸèƒ½é›†äºä¸€èº« è´´å§å…¨èƒ½åŠ©æ‰‹ TamperMonkeyè„šæœ¬åŒæ­¥TamperMonkeyæä¾›äº†éå¸¸æ–¹ä¾¿çš„æ–¹æ³•è®©æˆ‘ä»¬åŒæ­¥è„šæœ¬ï¼Œä»è€Œé¿å…æ¯æ¬¡å®‰è£…éƒ½è¦é‡æ–°å®‰è£…è„šæœ¬çš„çƒ¦æ¼ã€‚ è¿›å…¥TamperMonkeyæ’ä»¶è®¾ç½®é¡µ é…ç½®æ¨¡å¼é€‰æ‹©â€åˆå­¦è€…â€ å‹¾é€‰â€å¯ç”¨ TESLAâ€ï¼Œç±»å‹é€‰æ‹©â€æµè§ˆå™¨åŒæ­¥â€ ç‚¹å‡»ä¿å­˜","tags":[{"name":"Chrome","slug":"Chrome","permalink":"https://gcdd1993.github.io/tags/Chrome/"}]},{"title":"MacOsç§‘å­¦ä¸Šç½‘","date":"2019-10-06T15:47:37.000Z","path":"p/709/","text":"å‰è¨€ä¹‹å‰ä½¿ç”¨Windowsçš„æ—¶å€™ï¼Œæœ‰éå¸¸ä¼˜ç§€çš„å…¨å±€ä»£ç†è½¯ä»¶SSTapç”¨æ¥ç¿»å¢™ï¼Œä½†æ˜¯åˆ°äº†MacOsä¸Šï¼Œæ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼SSTapçš„å…¨å±€ç¿»å¢™ç¥å™¨ã€‚ æœ€ç»ˆé‡‡å–çš„æ–¹æ¡ˆæ˜¯ShadowsocksX-NG R8+Proxifierçš„æ–¹å¼æ¥å®ç°ã€‚ è½¯ä»¶ShadowsocksX-NG R8 ShadowsocksX-NGæ˜¯Macä¸‹çš„SSRå·¥å…·ï¼Œå…·æœ‰å’ŒWindowsä¸‹åŒæ ·çš„ä½“éªŒï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œæ”¯æŒæœåŠ¡å™¨è®¢é˜…ã€‚ é…ç½®å°±ä¸å¤šè¯´äº†ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼ŒSocks5çš„ç›‘å¬åœ°å€æ˜¯ï¼š127.0.0.1:1086ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€ä¼šè¦ç”¨åˆ°ã€‚ Proxifier Proxifieræ˜¯Macä¸‹çš„å…¨å±€ä»£ç†å·¥å…·ï¼Œå¯ä»¥å°†æµé‡ç»Ÿç»Ÿéƒ½è½¬åˆ°ä»£ç†ä¸Šï¼Œé…åˆShadowsocksX-NGï¼Œæˆ‘ä»¬å¾ˆè½»æ¾çš„å°±å¯ä»¥å®ç°å…¨å±€ç¿»å¢™ è½¯ä»¶æœ¬èº«æ˜¯æ”¶è´¹çš„ï¼Œå½“ç„¶äº†ï¼Œåœ¨Xclient.infoä¸Šå¯ä»¥æ‰¾åˆ°ç ´è§£ç‰ˆï¼šhttps://xclient.info/s/proxifier.html å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„é…ç½®ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°å…¨å±€ç§‘å­¦ä¸Šç½‘äº†ï¼ æ·»åŠ Socks5ä»£ç† ç‚¹å‡»Proxies ç‚¹å‡»Addï¼Œæ·»åŠ ä»£ç† æ·»åŠ å®Œæ¯•åï¼Œå›åˆ°ä¸»ç•Œé¢ï¼Œç‚¹å‡»Rulesï¼Œä¿®æ”¹é»˜è®¤è§„åˆ™ï¼Œå°†åŠ¨ä½œæŒ‡å‘æˆ‘ä»¬æ–°æ·»åŠ çš„Socks5ä»£ç† æµ‹è¯• æ‰“å¼€ITerm2æµ‹è¯•ä¸‹ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ 1$ curl www.google.com åŒæ—¶ï¼ŒProxifierä¹Ÿæ‰“å°å‡ºäº†ITerm2çš„æµé‡ä¿¡æ¯ å¦å¤–ï¼ŒProxifierä¹Ÿæ”¯æŒæŒ‡å®šè½¯ä»¶èµ°ä»£ç†ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ åœ¨Rulesæ ‡ç­¾ä¸­ç‚¹å‡»Addï¼Œæ–°å»ºä¸€ä¸ªè§„åˆ™ æ·»åŠ å®Œæˆåå‹¾é€‰ä½¿ç”¨ï¼ŒåŒæ—¶ï¼Œä¸è¦å¿˜è®°æŠŠDefaultè§„åˆ™çš„åŠ¨ä½œè®¾ç½®ä¸ºDirectï¼Œä¸ç„¶çš„è¯ï¼Œè¿˜æ˜¯å…¨å±€éƒ½èµ°ä»£ç†çš„ã€‚ ç›¸å…³è½¯ä»¶ ShadowsocksX-NGï¼šé“¾æ¥:https://pan.baidu.com/s/10i6PZZIParFRkvaVu5KhxA å¯†ç :jvzx Proxifierï¼šé“¾æ¥:https://pan.baidu.com/s/1ymZZRDJrjrIXXFrYfIxV_w å¯†ç :exns","tags":[{"name":"ç§‘å­¦ä¸Šç½‘","slug":"ç§‘å­¦ä¸Šç½‘","permalink":"https://gcdd1993.github.io/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"}]},{"title":"Dell å·¥ä½œç«™M4800 å®‰è£…macOs Mojave","date":"2019-10-01T01:43:12.000Z","path":"p/62106/","text":"å‰è¨€æœ€è¿‘ï¼Œå…¥æ‰‹äº†ä¸€å°äºŒæ‰‹Dellå·¥ä½œç«™M4800ï¼Œä»·æ ¼ä¸º3600ï¼Œé…ç½®å¦‚ä¸‹ ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œé…ç½®å¤Ÿç”¨ï¼Œå…³é”®æ˜¯ç”¨æ–™çœŸçš„è¶³ï¼è™½ç„¶æ˜¯16å¹´çš„æœºå™¨ï¼Œä½†æ˜¯åšå·¥åŠæ‰“ä¸€ä¼—æ¸¸æˆæœ¬ã€‚ ç„¶åï¼Œé‡ç‚¹æ¥äº†ï¼Œæˆ‘å®‰è£…ä¸Šäº†é»‘è‹¹æœmacOs Mojaveï¼Œç­‰äºè¯´èŠ±äº†3600ä¹°äº†å°MBPï¼Œè€Œä¸”æ˜¯éå¸¸çš„é«˜é…ã€‚ ç›®å‰ä½¿ç”¨ä¸ŠåŸºæœ¬å®Œç¾ï¼Œé™¤äº†æ— çº¿ç½‘å¡ï¼ˆä¹°äº†å…é©±å†…ç½®æ— çº¿ç½‘å¡åœ¨è·¯ä¸Šï¼‰ï¼ŒHDMIï¼ˆæš‚æ—¶ä¸æ€ä¹ˆç”¨ï¼Œä¸è¿‡ä¸æ˜¯æ— è§£ï¼‰ã€‚ é»‘è‹¹æœå®‰è£…è®°å½• ä»¥ä¸‹å†…å®¹ä»…ä½œè®°å½•ï¼Œä¸ä¿è¯èƒ½å®‰è£…æˆåŠŸã€‚ å®‰è£…æ•™ç¨‹éƒ½å¤§å·®ä¸å·®ï¼Œä¸»è¦æ˜¯è¦æ‰¾åˆ°é€‚ç”¨æœºå‹çš„EFIæ–‡ä»¶ï¼Œç„¶åæ›¿æ¢å°±å¯ä»¥ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœä½ æœ‰èƒ½åŠ›ï¼Œå¯ä»¥è‡ªå·±é€‚é…EFIï¼Œç„¶åè´¡çŒ®ç»™å¤§å®¶ğŸ‘ğŸ‘ğŸ‘ã€‚ å¦‚æœæœºå‹è·Ÿæˆ‘ä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘æ•´ç†å¥½çš„ï¼šhttps://github.com/gcdd1993/Dell-M4800-Hackintosh æ•™ç¨‹ æˆ‘ä¹Ÿæ˜¯å°ç™½ï¼Œä¸ç­é—¨å¼„æ–§ï¼Œæ”¾ä¸Šæˆ‘è£…çš„æ—¶å€™çš„å‚è€ƒé“¾æ¥ï¼Œç…§ç€è£…ï¼Œä¸€èˆ¬éƒ½èƒ½æå®š å•ç¡¬ç›˜å•ç³»ç»Ÿï¼ˆæ¨èï¼‰ å•ç¡¬ç›˜åŒç³»ç»Ÿï¼ˆä¸æ¨èï¼Œå¯èƒ½å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼‰ å¯åŠ¨Uç›˜è£…å¥½åï¼Œä¸è¦å¿˜è®°æ›¿æ¢é€‚é…æœºå‹çš„EFI ç„¶åæ­£å¼è¿›å…¥é»‘è‹¹æœçš„å®‰è£…ã€‚ ä¿®æ”¹BIOSè®¾ç½®ï¼ˆå¼€æœºæŒ‰F2ï¼‰ Advanced Boot Options = Enable Legacy Integrated NIC = Enable Parallel Ports = AT Serial Ports = Disabled ( If you are using Dock station then Enable it - Expermental ) Sata Operation = AHCI Drivers = Check all Switchable Graphics = Enable Switchable Graphics Secure Boot = Disabled Virtualization = Disable å®Œæˆåé€€å‡ºé‡å¯ é‡å¯é€‰æ‹©ä»Uç›˜å¯åŠ¨ï¼ˆå¼€æœºæŒ‰F12ï¼‰æŒ‰ç…§æ•™ç¨‹ï¼ŒæŠ¹ç›˜â€“å®‰è£…â€“è¿›å…¥ç³»ç»Ÿ è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…ä¼šç»å†3æ¬¡é‡å¯ ç¬¬ä¸€æ¬¡æ˜¯å®‰è£…å‰©ä½™2åˆ†é’Ÿçš„æ—¶å€™ï¼Œè¿™é‡Œè¦é€‰æ‹©ç¡¬ç›˜å¯åŠ¨ï¼ˆCloverç•Œé¢ä¼šå‡ºç°Boot install macos from ç¡¬ç›˜åˆ†åŒºåï¼‰ï¼Œå¦‚æœä½ é€‰äº†Uç›˜å¯åŠ¨ï¼Œé‚£å°±è¦å†æ¥ä¸€æ¬¡äº†ã€‚ ç¬¬äºŒæ¬¡é‡å¯ï¼Œè¿˜æ˜¯é€‰æ‹©ç¡¬ç›˜å¯åŠ¨ ç¬¬ä¸‰æ¬¡é‡å¯ï¼Œå¯ä»¥é€‰æ‹©Boot macos from ç¡¬ç›˜åˆ†åŒºåï¼Œå¯åŠ¨macOsäº† æˆåŠŸè¿›å…¥ç³»ç»Ÿåï¼Œæ‰§è¡Œæœ€åä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œé‚£å°±æ˜¯å®‰è£…é©±åŠ¨ æ›¿æ¢é©±åŠ¨æ–‡ä»¶è¿™é‡Œè¦ç”¨åˆ°Clover Configuratorå¯†ç :zcyj æ‰“å¼€Clover Configuratorï¼Œé€‰æ‹©æŒ‚è½½åˆ†åŒºï¼Œç„¶åæ‰“å¼€åˆ†åŒº æ›¿æ¢EFIæ–‡ä»¶å¤¹ï¼ˆå…ˆç§»é™¤åŸå…ˆçš„ï¼Œå°†å¤§ä½¬ä»¬æä¾›çš„EFIå¤åˆ¶è¿›å»ï¼‰ æ›¿æ¢é©±åŠ¨æ–‡ä»¶ï¼ˆkextsï¼‰ æœ€åé‡å¯è¯•ä¸‹å§ï¼Œå¯ä»¥æ‘†è„±Uç›˜äº† Cloverä¸»é¢˜ä¿®æ”¹é»‘è‹¹æœæ¯æ¬¡å¼€æœºéƒ½ä¼šè¿›å…¥Cloverå¼•å¯¼ç•Œé¢ï¼Œä½†æ˜¯é»˜è®¤çš„Cloverä¸»é¢˜æ˜¯é»‘é»‘çš„ï¼Œä¸‘ä¸‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ›¿æ¢æ‰ï¼Œæ¢ä¸€ä¸ªé«˜å¤§ä¸Šçš„å¼•å¯¼ç•Œé¢ã€‚ è¿™é‡Œæ¨èå·¥å…·CloverThemeManager WIFIç½‘å¡å·²å®‰è£…ä¸Šï¼Œä½¿ç”¨çš„æ˜¯BCM43224ï¼Œä¸å¸¦è“ç‰™ï¼Œå…é©±ï¼Œæ·˜å®25å—é’±å·¦å³ï¼ŒmSataæ¥å£ï¼Œä½¿ç”¨æ— å¼‚å¸¸ã€‚ å‚è€ƒ Clover æ›´æ–°å’Œç•Œé¢ç¾åŒ– macOs Mojave on M4800 Hackintoshé»‘è‹¹æœé•¿æœŸç»´æŠ¤æœºå‹EFIåŠå®‰è£…æ•™ç¨‹æ•´ç† Mojaveç¡¬ä»¶æ”¯æŒåˆ—è¡¨ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰ é»‘è‹¹æœå®‰è£…æ•™ç¨‹","tags":[{"name":"é»‘è‹¹æœ","slug":"é»‘è‹¹æœ","permalink":"https://gcdd1993.github.io/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/"}]},{"title":"SpringJpa CRUDä»£ç ç”Ÿæˆå™¨","date":"2019-09-10T16:34:19.000Z","path":"p/30009/","text":"åˆ©ç”¨ä¸šä½™æ—¶é—´æ’¸äº†ä¸€ä¸ªSpring Jpaä»£ç ç”Ÿæˆå™¨jpa-codegenã€‚ ç®€ä»‹è¿™æ˜¯ä¸€æ¬¾åŸºäºFreemarkeræ¨¡æ¿é©±åŠ¨çš„ä»£ç ç”Ÿæˆå™¨ã€‚ ä¾æ®ç°æœ‰çš„å®ä½“ç±»ä»£ç ï¼Œè‡ªåŠ¨ç”ŸæˆCRUDä»£ç ï¼Œè§£æ”¾åŒæ‰‹ï¼ŒåŠ å¿«å¼€å‘é€Ÿåº¦ã€‚ ç”Ÿæˆçš„ä»£ç åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼ˆå¯ä»¥è‡ªå®šä¹‰ç”Ÿæˆæ¨¡å—ï¼‰ Formè¡¨å•ä»£ç  Repositoryä»£ç  Serviceä»£ç  Controllerä»£ç  SpringBootä½¿ç”¨ç¤ºä¾‹å…‹éš†ç¤ºä¾‹é¡¹ç›®ï¼Œä½“ä¼šè§£æ”¾åŒæ‰‹çš„ç¾å¦™æ„Ÿå—ï¼ å¦‚ä½•ä½¿ç”¨å¯¼å…¥ä»“åº“12345678maven &#123; url &#x27;https://dl.bintray.com/gcdd1993/maven&#x27;&#125;dependencies &#123; // jpa code generator testCompile &#x27;io.github.gcdd1993:jpa-codegen:v1.0.1&#x27; testCompile &#x27;org.freemarker:freemarker:2.3.28&#x27;&#125; é…ç½®ä»£ç ç”Ÿæˆå™¨é…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526272829## ä½œè€…author=gcdd1993## ä»£ç æ³¨é‡Šcomments=code generated by jpa-codegen## æ˜¯å¦è¦†ç›–åŸæ–‡ä»¶ï¼Œé™¤éç‰¹æ®Šæƒ…å†µï¼Œä¸ç„¶è¯·ä¸è¦è¦†ç›–cover=false## ä»£ç æ¨¡æ¿ç›®å½•template.dir=src/test/resources/template/## å®ä½“ç±»åŒ…å Deprecatedä»v1.0.1å¼€å§‹ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤- entity.package=com.maxtropy.sample.entity## å®ä½“ç±»æ ‡è¯†ç¬¦ Deprecatedä»v1.0.1å¼€å§‹ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤- entity.flag=entity## ä»¥ä¸‹é…ç½®æ˜¯æ¨¡å—é…ç½®(æ ¼å¼ æ¨¡å—å.é…ç½®å)ï¼Œå¿…é¡»åœ¨æ¨¡æ¿ç›®å½•ä¸‹æä¾›ä¸æ¨¡å—åç›¸åŒçš„æ¨¡æ¿## ç”Ÿæˆçš„ä»£ç åç¼€repository.suffix=Repository## æ¨¡æ¿åç§°repository.template=repository.ftl## æ¨¡å—æ ‡è¯†ç¬¦repository.flag=entity.reposervice.suffix=Serviceservice.template=service.ftlservice.flag=serviceform.suffix=Formform.template=form.ftlform.flag=formcontroller.suffix=Controllercontroller.template=controller.ftlcontroller.flag=web å…¶ä¸­ 123repository.suffix=Repositoryrepository.template=repository.ftlrepository.flag=entity.repo æ˜¯æ¨¡å—é…ç½®ï¼Œä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ ç¼–å†™ä»£ç æ¨¡æ¿æ¨¡æ¿ä¸»è¦åŸºäºFreemarkerï¼Œå¦‚Spring Boot2.xä»£ç æ¨¡æ¿å¯ä»¥åƒä¸‹é¢è¿™æ · 123456789101112131415161718package $&#123;packageName&#125;;import $&#123;entity.packageName&#125;.$&#123;entity.className&#125;;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.data.querydsl.QuerydslPredicateExecutor;&lt;#list imports as import&gt;import $&#123;import&#125;;&lt;/#list&gt;/** * repository for $&#123;entity.className&#125; generated by jpa-codegen * $&#123;comments&#125; * * @author $&#123;author&#125; * Created On $&#123;date&#125;. */public interface $&#123;className&#125; extends JpaRepository&lt;$&#123;entity.className&#125;, $&#123;entity.id.className&#125;&gt;, QuerydslPredicateExecutor&lt;$&#123;entity.className&#125;&gt; &#123;&#125; Spring Boot 2.xæ¨¡æ¿ å¦‚ä½•ç¼–å†™æ¨¡æ¿? ç¼–å†™ç”Ÿæˆå™¨å…¥å£åœ¨testæ¨¡å—ä¸­ç¼–å†™ç”Ÿæˆå™¨å…¥å£ï¼Œå¦‚ 12345678910public class Codegen &#123; @Test public void generate() &#123; new CodeGenerator(&quot;src/test/resources/codegen.properties&quot;) .registerRender(&quot;repository&quot;) .generate(); &#125; &#125; ç„¶åè¿è¡Œgenerate()ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹å°†ä¼šç”Ÿæˆ ç”Ÿæˆçš„ä»£ç å®Œå…¨ç”±æ¨¡æ¿ä»¥åŠå®ä½“ç±»ä¿¡æ¯å†³å®šã€‚ å¦‚ä½•ç¼–å†™æ¨¡æ¿ï¼Ÿæ¨¡æ¿å®Œå…¨åŸºäºFreeMarkerä»¥åŠå®ä½“ç±»ä¿¡æ¯ï¼ŒFreeMarkerå‚è€ƒFreeMarker Docs æ”¯æŒçš„å…ƒç´ å®šä¹‰å¦‚ä¸‹ åŸºæœ¬ä¿¡æ¯ Freemarkerå…ƒç´  è§£é‡Š ç¤ºä¾‹è¾“å‡º $&#123;ftlName&#125; æ¨¡æ¿åç§° controller.ftl $&#123;ftlPath&#125; æ¨¡æ¿ç›®å½• src/main/resources/template/ $&#123;savePath&#125; ä¿å­˜è·¯å¾„ src/main/resources/io/github/gcdd1993/controller $&#123;packageName&#125; javaæ–‡ä»¶åŒ…å io.github.gcdd1993.controller $&#123;className&#125; javaæ–‡ä»¶ç±»å UserController $&#123;author&#125; ä½œè€… gaochen $&#123;date&#125; åˆ›å»ºæ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¥æœŸ 2019/6/23 $&#123;comments&#125; æ³¨é‡Šä¿¡æ¯ generated by jpa-codegen $&#123;imports&#125; javaæ–‡ä»¶å¼•å…¥ä¿¡æ¯ org.springframework.beans.factory.annotation.Autowired å®ä½“ä¿¡æ¯ Freemarkerå…ƒç´  è§£é‡Š ç¤ºä¾‹è¾“å‡º $&#123;entity.className&#125; å®ä½“ç±»åï¼Œclass.getSimpleName() User $&#123;entity.packageName&#125; å®ä½“åŒ…åï¼Œclass.getPackage().getName() io.github.gcdd1993 $&#123;entity.tableName&#125; å®ä½“è¡¨åï¼Œ@Table(name=&quot;&quot;) sys_user $&#123;entity.id.className&#125; å®ä½“ä¸»é”®ç±»åï¼Œ@Idæ³¨é‡Šçš„å­—æ®µçš„ç±»å Integer $&#123;entity.id.packageName&#125; å®ä½“ä¸»é”®åŒ…åï¼Œ@Idæ³¨é‡Šçš„å­—æ®µçš„åŒ…å java.lang $&#123;entity.fields.className&#125; å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰ç±»å String $&#123;entity.fields.packageName&#125; å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰åŒ…å java.lang $&#123;entity.fields.name&#125; å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰å±æ€§å name $&#123;entity.fields.annotations.className&#125; å®ä½“æ‰€æœ‰å­—æ®µæ³¨è§£çš„ç±»å Id $&#123;entity.fields.annotations.packageName&#125; å®ä½“æ‰€æœ‰å­—æ®µæ³¨è§£çš„åŒ…å javax.persistence è‡ªå®šä¹‰é…ç½®é™¤äº†ä»¥ä¸Šé»˜è®¤çš„ä¿¡æ¯ä¹‹å¤–ï¼Œå¯èƒ½ä¼šæœ‰é¢å¤–çš„ä¿¡æ¯éœ€è¦å¡«å…¥ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œjpa-codegenæä¾›ç›´æ¥å°†é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®æ¸²æŸ“åˆ°æ¨¡æ¿çš„èƒ½åŠ›ã€‚ ä¾‹å¦‚åœ¨é…ç½®æ–‡ä»¶autogen.propertieså†™ä¸‹ä¸€è¡Œ 1custom.additional.comment=this is additional comment åœ¨æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨$&#123;otherParams.additional_comment&#125;è·å–åˆ°è¯¥é…ç½®ã€‚ è¦æ³¨æ„çš„æ˜¯ï¼šè‡ªå®šä¹‰é…ç½®ä½¿ç”¨customå¼€å¤´ï¼Œåé¢çš„**é…ç½®ä¼šå°†.æ›¿æ¢ä¸º_**ä½œä¸ºFreeMarkeræ¨¡æ¿çš„keyï¼Œä¾‹å¦‚ä¸Šè¿°çš„additional.commentä½¿ç”¨$&#123;otherParams.additional_comment&#125;è·å–ã€‚ ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿç”±äºä»£ç åƒå˜ä¸‡åŒ–ï¼Œä¸ºäº†å°½å¯èƒ½çš„åšåˆ°é€šç”¨æ€§ï¼Œjpa-codegenå°†æ¯ä¸€ç§ç±»å‹çš„ä»£ç æŠ½è±¡ä¸ºæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å°†ä½¿ç”¨å„è‡ªçš„æ¨¡æ¿ï¼Œä¾ç…§å®ä½“ä¿¡æ¯ç”Ÿæˆä»£ç ã€‚ éœ€è¦ä¸ºæ¨¡æ¿é…ç½®ä¸€ä¸‹ä¿¡æ¯ï¼š repository.suffix=Repository æ¨¡å—ç±»ååç¼€ï¼Œç”Ÿæˆçš„ç±»åè§„åˆ™ç”±å®ä½“ç±»å+åç¼€æ„æˆ repository.template=repository.ftl æ¨¡å—ä½¿ç”¨çš„Freemarkeræ¨¡æ¿ repository.flag=entity.repo æ¨¡å—æ ‡è¯†ç¬¦ï¼Œç”Ÿæˆçš„ä»£ç åŒ…åç”±å®ä½“ç±»å°†å®ä½“æ ‡è¯†ç¬¦æ›¿æ¢ä¸ºæ¨¡å—æ ‡è¯†ç¬¦æ¥ç¡®è®¤ã€‚ å¦‚ å®ä½“åŒ…åï¼šio.github.gcdd1993.entity å®ä½“æ ‡è¯†ç¬¦ï¼šentity æ¨¡å—æ ‡è¯†ç¬¦ï¼šentity.repo åˆ™ç”Ÿæˆçš„repositoryä»£ç åŒ…åä¸º â€“&gt; io.github.gcdd1993.entity.repo","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Ubuntuç¦ç”¨rootè´¦å·ï¼Œå¼€å¯Ubuntuå¯†é’¥ç™»å½•","date":"2019-09-10T04:08:44.000Z","path":"p/46186/","text":"æ–°å»ºæ™®é€šç”¨æˆ·12345## æ–°å»ºæ™®é€šç”¨æˆ·$ adduser ubuntu$ apt-get install sudo## å°†ç”¨æˆ·åŠ å…¥sudoç»„$ usermod -a -G sudo ubuntu ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ å…¬é’¥123456789$ su ubuntu$ mkdir -p ~/.ssh$ cd ~/.ssh## æ·»åŠ å…¬é’¥$ touch authorized_keys$ cat &#x27;ä½ çš„å…¬é’¥å­—ç¬¦ä¸²&#x27; &gt;&gt; authorized_keys$ chmod 600 authorized_keys$ chmod 700 ~/.ssh è®¾ç½® SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•12345678910$ vim /etc/ssh/sshd_configRSAAuthentication yesPubkeyAuthentication yes## ç¦ç”¨rootè´¦å·ç™»å½•PermitRootLogin no## ç¦ç”¨å¯†ç ç™»å½•PasswordAuthentication no$ service sshd restart","tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://gcdd1993.github.io/tags/Ubuntu/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰å·¥å‚æ–¹æ³•æ¨¡å¼","date":"2019-07-28T15:52:33.000Z","path":"p/30626/","text":"å®šä¹‰ä¸ç±»å‹ å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†è®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œå·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œã€‚ ç±»å‹ï¼šåˆ›å»ºå‹ é€‚ç”¨åœºæ™¯ åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç  å®¢æˆ·ç«¯(åº”ç”¨å±‚)ä¸ä¾èµ–äºäº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€å®ç°ç­‰ç»†èŠ‚ ä¸€ä¸ªç±»é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå“ªä¸ªå¯¹è±¡ ä¼˜ç‚¹ ç”¨æˆ·åªéœ€è¦å…³å¿ƒæ‰€éœ€äº§å“å¯¹åº”çš„å·¥å‚ï¼Œæ— é¡»å…³å¿ƒåˆ›å»ºç»†èŠ‚ åŠ å…¥æ–°äº§å“ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæé«˜å¯æ‰©å±•æ€§ ç¼ºç‚¹ ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ Codingå·¥å‚æ–¹æ³•æ¨¡å¼ä»ä¸€å®šæ„ä¹‰ä¸Šè®²æ˜¯ä»ç®€å•å·¥å‚æ¨¡å¼è¡ç”Ÿè¿‡æ¥çš„ï¼Œåˆ›å»ºäº§å“æŠ½è±¡ç±» 123public abstract class Video &#123; public abstract void produce();&#125; åˆ›å»ºå…·ä½“äº§å“ 123456789101112public class JavaVideo extends Video &#123; @Override public void produce() &#123; System.out.println(&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;); &#125;&#125;public class PythonVideo extends Video &#123; @Override public void produce() &#123; System.out.println(&quot;å½•åˆ¶Pythonè§†é¢‘&quot;); &#125;&#125; åˆ›å»ºäº§å“å·¥å‚æ–¹æ³•æŠ½è±¡ç±» 123public abstract class VideoFactory &#123; public abstract Video getVideo();&#125; åˆ›å»ºäº§å“å·¥å‚æ–¹æ³•å®ç°ç±»ï¼ˆæ¯ä¸ªäº§å“éƒ½æœ‰å¯¹åº”çš„å®ç°ç±»ï¼‰ 123456789101112public class JavaVideoFactory extends VideoFactory &#123; @Override public Video getVideo() &#123; return new JavaVideo(); &#125;&#125;public class PythonVideoFactory extends VideoFactory &#123; @Override public Video getVideo() &#123; return new PythonVideo(); &#125;&#125; æµ‹è¯•ç±» 1234567891011public class Test &#123; public static void main(String[] args) &#123; VideoFactory javaVideoFactory = new JavaVideoFactory(); VideoFactory pythonVideoFactory = new PythonVideoFactory(); Video video = javaVideoFactory.getVideo(); video.produce(); video = pythonVideoFactory.getVideo(); video.produce(); &#125;&#125; æ§åˆ¶å°è¾“å‡º 12å½•åˆ¶Javaè¯¾ç¨‹å½•åˆ¶Pythonè§†é¢‘ å¦‚æœæˆ‘ä»¬ç°åœ¨æ–°å¢ä¸€ä¸ªäº§å“â€“å‰ç«¯è¯¾ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºäº§å“ç±»ï¼Œäº§å“å·¥å‚ç±»ï¼Œä½†æ˜¯æ— éœ€æ”¹åŠ¨å…¶ä»–ä»£ç ï¼Œåšåˆ°äº†å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ 123456789101112public class FEVideo extends Video &#123; @Override public void produce() &#123; System.out.println(&quot;å½•åˆ¶å‰ç«¯è¯¾ç¨‹&quot;); &#125;&#125;public class FEVideoFactory extends VideoFactory &#123; @Override public Video getVideo() &#123; return new FEVideo(); &#125;&#125; ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾çœ‹å‡ºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ç¼ºç‚¹â€“ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚ å› ä¸ºä¸€æ—¦æˆ‘ä»¬éœ€è¦ç°åœ¨äº§å“ï¼Œå°±éœ€è¦åˆ›å»ºäº§å“å¯¹åº”çš„äº§å“å®ç°ç±»ï¼Œä»¥åŠäº§å“å·¥å‚æ–¹æ³•ç±»ï¼Œæ— ç–‘å¢åŠ äº†ç±»çš„ä¸ªæ•°å’Œç³»ç»Ÿçš„å¤æ‚åº¦ã€‚ å®Œæ•´çš„UMLç±»å›¾ æºç è§£æCollectionæºç jdkä¸­å…¸å‹çš„å·¥å‚æ–¹æ³•æ¨¡å¼ä½“ç°ä¸ºjava.util.Collection æŠ½è±¡äº§å“ä¸ºjava.util.Iterator 123public interface Iterator&lt;E&gt; &#123; ...&#125; æŠ½è±¡å·¥å‚å®šä¹‰äº†åˆ›å»ºäº§å“æ—çš„æ–¹æ³•java.util.Collection.#iterator 1Iterator&lt;E&gt; iterator(); ç”±å­ç±»æ¥å®šä¹‰å…·ä½“åˆ›å»ºäº§å“çš„é€»è¾‘ï¼Œå¦‚java.util.ArrayList.#iterator 123public Iterator&lt;E&gt; iterator() &#123; return new Itr();&#125; è€Œå…·ä½“çš„äº§å“å®šä¹‰ä¸ºjava.util.ArrayList$Itr 123private class Itr implements Iterator&lt;E&gt; &#123; ...&#125; UMLç±»å›¾ URLStreamHandlerFactoryæºç å†æ¥çœ‹ä¸€ä¸ªå…¸å‹ä¾‹å­ï¼Œjava.net.URLStreamHandlerFactoryä½œä¸ºå·¥å‚æ–¹æ³•æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†åˆ›å»ºäº§å“çš„æŠ½è±¡æ–¹æ³• 123public interface URLStreamHandlerFactory &#123; URLStreamHandler createURLStreamHandler(String protocol);&#125; äº§å“æŠ½è±¡ç±»å°±æ˜¯java.net.URLStreamHandler 123public abstract class URLStreamHandler &#123; ...&#125; äº§å“çš„å·¥å‚æ–¹æ³•å®ç°ç±»ä¸ºsun.misc.Launcher$Factory 123456789101112131415161718192021private static class Factory implements URLStreamHandlerFactory &#123; ... public URLStreamHandler createURLStreamHandler(String var1) &#123; private static String PREFIX = &quot;sun.net.www.protocol&quot;; private Factory() &#123; &#125; public URLStreamHandler createURLStreamHandler(String var1) &#123; String var2 = PREFIX + &quot;.&quot; + var1 + &quot;.Handler&quot;; try &#123; // é€šè¿‡åå°„åˆ›å»ºæŒ‡å®šç±»å‹çš„äº§å“ Class var3 = Class.forName(var2); return (URLStreamHandler)var3.newInstance(); &#125; catch (ReflectiveOperationException var4) &#123; throw new InternalError(&quot;could not load &quot; + var1 + &quot;system protocol handler&quot;ï¼Œ var4); &#125; &#125; &#125;&#125; å¯ä»¥å‘ç°ï¼Œå·¥å‚å®ç°ç±»é€šè¿‡åå°„ç±»åˆ›å»ºå…·ä½“çš„äº§å“å®ç°ç±»ï¼Œè€Œäº§å“å®ç°ç±»éå¸¸å¤š è¿™æ ·æ»¡è¶³äº†å¼€é—­åŸåˆ™ï¼Œä¹Ÿæ²¡æœ‰è¿‡å¤šçš„å¢åŠ ç±»çš„æ•°é‡ï¼Œå€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gcdd1993.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰ç®€å•å·¥å‚æ¨¡å¼","date":"2019-07-28T15:14:04.000Z","path":"p/21710/","text":"å®šä¹‰ä¸ç±»å‹ å®šä¹‰:ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ ç±»å‹:åˆ›å»ºå‹ï¼Œä½†ä¸å±äºGOF23ç§è®¾è®¡æ¨¡å¼ é€‚ç”¨åœºæ™¯ å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘ å®¢æˆ·ç«¯(åº”ç”¨å±‚)åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡(é€»è¾‘)ä¸å…³å¿ƒ ä¼˜ç‚¹åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ï¼Œå°±å¯ä»¥è·å–ä½ æ‰€éœ€è¦çš„å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“å…¶åˆ›å»ºç»†èŠ‚ ç¼ºç‚¹å·¥å‚ç±»çš„èŒè´£ç›¸å¯¹è¿‡é‡ï¼Œå¢åŠ æ–°çš„äº§å“ï¼Œéœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„åˆ¤æ–­é€»è¾‘ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ Codingåˆ›å»ºä¸€ä¸ªæŠ½è±¡äº§å“ç±» 123public abstract class Video &#123; public abstract void produce();&#125; äº§å“å®ç°ç±» 123456789101112public class JavaVideo extends Video &#123; @Override public void produce() &#123; System.out.println(&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;); &#125;&#125;public class PythonVideo extends Video &#123; @Override public void produce() &#123; System.out.println(&quot;å½•åˆ¶Pythonè§†é¢‘&quot;); &#125;&#125; åˆ›å»ºäº§å“å¯¹åº”çš„ç®€å•å·¥å‚ï¼Œé€šè¿‡äº§å“ç±»å‹æ¥åˆ›å»ºäº§å“ï¼Œåº”ç”¨æ–¹æ— éœ€çŸ¥é“åˆ›å»ºäº§å“çš„ç»†èŠ‚ 123456789101112public class VideoFactory &#123; public Video getVideo(String type) &#123; if (&quot;java&quot;.equalsIgnoreCase(type)) &#123; return new JavaVideo(); &#125; else if (&quot;python&quot;.equalsIgnoreCase(type)) &#123; return new PythonVideo(); &#125; else &#123; return null; &#125; &#125;&#125; æµ‹è¯•ç±» 1234567public class Test &#123; public static void main(String[] args) &#123; VideoFactory videoFactory = new VideoFactory(); Video video = videoFactory.getVideo(&quot;Java&quot;); video.produce(); &#125;&#125; æ§åˆ¶å°è¾“å‡º 1å½•åˆ¶Javaè¯¾ç¨‹ å¦‚æœå¢åŠ äº§å“ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦ä¿®æ”¹äº§å“å¯¹åº”çš„äº§å“ç±»ï¼Œè¿˜éœ€è¦ä¿®æ”¹å·¥å‚ç±»ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æ¥ä¼˜åŒ–ä¸‹æˆ‘ä»¬çš„å·¥å‚ç±» 1234567891011public class VideoFactory &#123; public Video getVideo(Class&lt;? extends Video&gt; clazz) &#123; try &#123; return clazz.newInstance(); &#125; catch (InstantiationException | IllegalAccessException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; è¿™æ ·ä¸€æ¥ï¼Œæ·»åŠ äº§å“çš„æ—¶å€™ä¸ç”¨å†ä¿®æ”¹æˆ‘ä»¬çš„å·¥å‚ç±»ï¼Œè€Œæ˜¯ç›´æ¥æ·»åŠ äº§å“å³å¯ã€‚ æœ€ç»ˆçš„UMLç±»å›¾ æºç è§£æJDKæºç åœ¨JDKä¸­ï¼Œä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼çš„ä¾‹å­å¦‚java.util.Calendarï¼Œä¸€ç»„getInstanceçš„é‡è½½æ–¹æ³•ï¼Œæä¾›äº†åˆ›å»ºCalendaräº§å“çš„ç®€å•å·¥å‚æ–¹æ³•ã€‚ 1234public static Calendar getInstance()public static Calendar getInstance(TimeZone zone)public static Calendar getInstance(Locale aLocale)public static Calendar getInstance(TimeZone zoneï¼ŒLocale aLocale) æ ¸å¿ƒæ–¹æ³•ä¸º 1private static Calendar createCalendar(TimeZone zoneï¼ŒLocale aLocale) æºç è¾ƒé•¿ï¼Œä¸è´´äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹ä¸‹æºç ã€‚ Calendarçš„UMLç±»å›¾å¦‚ä¸‹ Logbackæºç logbackç±»ä¸­çš„ç®€å•å·¥å‚æ¨¡å¼ä¸»è¦ä½“ç°åœ¨ch.qos.logback.classic.LoggerContext#getLogger(String) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Overridepublic final Logger getLogger(final String name) &#123; if (name == null) &#123; throw new IllegalArgumentException(&quot;name argument cannot be null&quot;); &#125; // åˆ¤æ–­logç±»å‹è¿”å›rootèŠ‚ç‚¹çš„logger if (Logger.ROOT_LOGGER_NAME.equalsIgnoreCase(name)) &#123; return root; &#125; int i = 0; Logger logger = root; // å¦‚æœç¼“å­˜ä¸­å·²ç»å­˜åœ¨çš„æŒ‡å®šçš„loggerï¼Œç›´æ¥è¿”å›childLogger Logger childLogger = (Logger) loggerCache.get(name); // if we have the childï¼Œ then let us return it without wasting time if (childLogger != null) &#123; return childLogger; &#125; // ä»¥ä¸‹æ˜¯åˆ›å»ºloggerçš„é€»è¾‘ String childName; while (true) &#123; int h = LoggerNameUtil.getSeparatorIndexOf(nameï¼Œ i); if (h == -1) &#123; childName = name; &#125; else &#123; childName = name.substring(0ï¼Œ h); &#125; // move i left of the last point i = h + 1; synchronized (logger) &#123; childLogger = logger.getChildByName(childName); if (childLogger == null) &#123; childLogger = logger.createChildByName(childName); loggerCache.put(childNameï¼Œ childLogger); incSize(); &#125; &#125; logger = childLogger; if (h == -1) &#123; return childLogger; &#125; &#125;&#125; æ˜¯ä¸€ä¸ªå…¸å‹çš„ç®€å•å·¥å‚æ–¹æ³•","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gcdd1993.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰è®¾è®¡æ¨¡å¼åŸåˆ™","date":"2019-07-27T17:34:12.000Z","path":"p/64818/","text":"å­¦ä¹ Javaè®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£è®¾è®¡æ¨¡å¼åŸåˆ™ã€‚ å¼€é—­åŸåˆ™å®šä¹‰ ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ ä¼˜ç‚¹ï¼šæé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯å¤ç”¨æ€§åŠå¯ç»´æŠ¤æ€§ Codingåˆ›å»ºæ¥å£ 1234567public interface ICourse &#123; Integer getId(); String getName(); Double getPrice();&#125; åˆ›å»ºå®ç°ç±» 12345678910111213@ToString@AllArgsConstructorpublic class JavaCourse implements ICourse &#123; @Getter private Integer id; @Getter private String name; @Getter private Double price;&#125; æµ‹è¯•ç±» 1234567public class Test &#123; public static void main(String[] args) &#123; ICourse iCourse = new JavaCourse(96ï¼Œ &quot;æˆ‘çš„Javaè¯¾ç¨‹&quot;ï¼Œ 348d); System.out.println(&quot;è¯¾ç¨‹ID: &quot; + iCourse.getId() + &quot; è¯¾ç¨‹åç§°ï¼š &quot; + iCourse.getName() + &quot;è¯¾ç¨‹ä»·æ ¼ï¼š &quot; + iCourse.getPrice()); &#125;&#125; æ§åˆ¶å°è¾“å‡º 1è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹ä»·æ ¼ï¼š 348.0 å¦‚æœç°åœ¨è¦æ‰“æŠ˜å‡ºå”®è¯¾ç¨‹ï¼ŒæŒ‰ç…§å¼€é—­åŸåˆ™æ¥è®¾è®¡ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ åˆ›å»ºæ‰“æŠ˜ç±» 1234567891011121314public class JavaDiscountCourse extends JavaCourse &#123; public JavaDiscountCourse(Integer idï¼Œ String nameï¼Œ Double price) &#123; super(idï¼Œ nameï¼Œ price); &#125; public Double getOriginPrice() &#123; return super.getPrice(); &#125; @Override public Double getPrice() &#123; return super.getPrice() * 0.8; &#125;&#125; ä¿®æ”¹åº”ç”¨ç±» 123456789public class Test &#123; public static void main(String[] args) &#123; ICourse javaCourse = new JavaDiscountCourse(96ï¼Œ &quot;æˆ‘çš„Javaè¯¾ç¨‹&quot;ï¼Œ 348d); JavaDiscountCourse iCourse = (JavaDiscountCourse) javaCourse; System.out.println(&quot;è¯¾ç¨‹ID: &quot; + iCourse.getId() + &quot; è¯¾ç¨‹åç§°ï¼š &quot; + iCourse.getName() + &quot;è¯¾ç¨‹åŸä»·ï¼š &quot; + iCourse.getOriginPrice() + &quot; è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š &quot; + iCourse.getPrice()); &#125;&#125; æ§åˆ¶å°è¾“å‡º 1è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹åŸä»·ï¼š 348.0 è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š 278.40000000000003 è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼ŒDouble * 0.8åè¾“å‡ºçš„æµ®ç‚¹æ•°ç²¾åº¦æœ‰ä¸¢å¤±çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨BigDecimalçš„Stringæ„é€ å™¨public BigDecimal(String val)æ¥è§£å†³ã€‚ ä¿®æ”¹JavaDiscountCourse 1234567891011121314public class JavaDiscountCourse extends JavaCourse &#123; public JavaDiscountCourse(Integer idï¼Œ String nameï¼Œ Double price) &#123; super(idï¼Œ nameï¼Œ price); &#125; public Double getOriginPrice() &#123; return super.getPrice(); &#125; @Override public Double getPrice() &#123; return new BigDecimal(super.getPrice().toString()).multiply(new BigDecimal(&quot;0.8&quot;)).doubleValue(); &#125;&#125; æ§åˆ¶å°è¾“å‡º 1è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹åŸä»·ï¼š 348.0 è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š 278.4 ä¾èµ–å€’ç½®åŸåˆ™å®šä¹‰ é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚;ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹ ä¼˜ç‚¹:å¯ä»¥å‡å°‘ç±»é—´çš„è€¦åˆæ€§ã€æé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¯é™ä½ä¿®æ”¹ç¨‹åºæ‰€é€ æˆçš„é£é™© Codingåä¾‹åˆ›å»ºç±» 12345678910111213public class Geely &#123; public void studyJavaCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹&quot;); &#125; public void studyFECourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹&quot;); &#125; public void studyPythonCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ Pythonè¯¾ç¨‹&quot;); &#125;&#125; æµ‹è¯•ç±» 12345678public class Test &#123; // v1 public static void main(String[] args) &#123; Geely geely = new Geely(); geely.studyFECourse(); geely.studyJavaCourse(); &#125;&#125; æ§åˆ¶å°è¾“å‡º 12Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹ è¿™æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è¦è®©Geelyå­¦ä¹ Rubyè¯¾ç¨‹ï¼Œæˆ‘ä»¬åªèƒ½åœ¨Geelyç±»ä¸­æ·»åŠ  123public void studyRubyCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ Rubyè¯¾ç¨‹&quot;);&#125; ç„¶åï¼Œåœ¨Testç±»ä¸­æ·»åŠ  1geely.studyRubyCourse(); ä¸ç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ æ­£ä¾‹åˆ›å»ºæ¥å£ 123public interface ICourse &#123; void studyCourse();&#125; åˆ›å»ºç±»ï¼Œå¸¦æœ‰æˆå‘˜å˜é‡ICourse course 1234567891011@AllArgsConstructorpublic class Geely &#123; @Setter private ICourse course; public void studyImoocCourse() &#123; course.studyCourse(); &#125;&#125; åˆ›å»ºå®ç°ç±» 123456789101112131415161718public class FECourse implements ICourse &#123; @Override public void studyCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹&quot;); &#125;&#125;public class JavaCourse implements ICourse &#123; @Override public void studyCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹&quot;); &#125;&#125;public class PythonCourse implements ICourse &#123; @Override public void studyCourse() &#123; System.out.println(&quot;Geelyåœ¨å­¦ä¹ Pythonè¯¾ç¨‹&quot;); &#125;&#125; æµ‹è¯•ç±» 123456789public class Test &#123; public static void main(String[] args) &#123; Geely geely = new Geely(new JavaCourse()); geely.studyImoocCourse(); geely.setCourse(new FECourse()); geely.studyImoocCourse(); &#125;&#125; æ§åˆ¶å°è¾“å‡º 12Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹ è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœè¦æ·»åŠ æ–°çš„è¯¾ç¨‹ï¼Œåªéœ€è¦åˆ›å»ºå®ç°ç±»å³å¯ã€‚ç„¶ååº”ç”¨ç±»è®¾ç½®å®ç°ç±»ï¼Œæ— éœ€æ”¹åŠ¨å…¶ä»–ä»£ç ï¼Œç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ã€‚ å•ä¸€èŒè´£åŸåˆ™å®šä¹‰ ä¸è¦å­˜åœ¨å¤šäºä¸€ä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå›  ä¸€ä¸ªç±»/æ¥å£/æ–¹æ³•åªè´Ÿè´£ä¸€é¡¹èŒè´£ ä¼˜ç‚¹:é™ä½ç±»çš„å¤æ‚åº¦ã€æé«˜ç±»çš„å¯è¯»æ€§ã€æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€é™ä½å˜æ›´å¼•èµ·çš„é£é™© Codingåä¾‹åˆ›å»ºç±» 12345public class Bird &#123; public void mainMoveMode(String birdName) &#123; System.out.println(birdName + &quot; ç”¨ç¿…è†€é£&quot;); &#125;&#125; æµ‹è¯•ç±» 12345678public class Test &#123; public static void main(String[] args) &#123; Bird bird = new Bird(); bird.mainMoveMode(&quot;å¤§é›&quot;); bird.mainMoveMode(&quot;é¸µé¸Ÿ&quot;); &#125;&#125; æ§åˆ¶å°è¾“å‡º 12å¤§é› ç”¨ç¿…è†€é£é¸µé¸Ÿ ç”¨ç¿…è†€é£ é¸µé¸Ÿæ˜¯ç”¨è„šèµ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹Birdç±» 123456789public class Bird &#123; public void mainMoveMode(String birdName) &#123; if (&quot;é¸µé¸Ÿ&quot;.equals(birdName)) &#123; System.out.println(birdName + &quot; ç”¨è„šèµ°&quot;); &#125; else &#123; System.out.println(birdName + &quot; ç”¨ç¿…è†€é£&quot;); &#125; &#125;&#125; å¦‚æœæœ‰æ›´å¤šçš„é¸Ÿç±»ï¼Œæˆ‘ä»¬è¿˜è¦å†™æ›´å¤šçš„elseä»£ç ã€‚ æ­£ä¾‹æˆ‘ä»¬ä¿®æ”¹ä¸‹åä¾‹ä¸­çš„ä¾‹å­ 12345678910public class FlyBird &#123; public void mainMoveMode(String birdName) &#123; System.out.println(birdName + &quot; ç”¨ç¿…è†€é£&quot;); &#125;&#125;public class WalkBird &#123; public void mainMoveMode(String birdName) &#123; System.out.println(birdName + &quot; ç”¨è„šèµ°&quot;); &#125;&#125; æ·»åŠ æµ‹è¯•ç±» 12345678910public class Test &#123; public static void main(String[] args) &#123; FlyBird flyBird = new FlyBird(); flyBird.mainMoveMode(&quot;å¤§é›&quot;); WalkBird walkBird = new WalkBird(); walkBird.mainMoveMode(&quot;é¸µé¸Ÿ&quot;); &#125;&#125; æ§åˆ¶å°è¾“å‡º 12å¤§é› ç”¨ç¿…è†€é£é¸µé¸Ÿ ç”¨è„šèµ° å†ä¸¾ä¸€ä¸ªä¾‹å­ åˆ›å»ºæ¥å£ 123456789101112131415161718192021222324/** * è¯¾ç¨‹å†…å®¹ * * @author gaochen * Created on 2019/7/27. */public interface ICourseContent &#123; String getCoursName(); byte[] getCourseVideo();&#125;/** * è¯¾ç¨‹ç®¡ç† * * @author gaochen * Created on 2019/7/27. */public interface ICourseManager &#123; void studyCourse(); void refundCourse();&#125; åˆ›å»ºå®ç°ç±»ï¼Œæœ‰ç€è¯¾ç¨‹å†…å®¹å’Œè¯¾ç¨‹ç®¡ç†ä¸¤ç§èŒèƒ½ 123456789101112131415161718192021public class CourseImpl implements ICourseContentï¼Œ ICourseManager &#123; @Override public String getCoursName() &#123; return null; &#125; @Override public byte[] getCourseVideo() &#123; return new byte[0]; &#125; @Override public void studyCourse() &#123; &#125; @Override public void refundCourse() &#123; &#125;&#125; æ¥å£éš”ç¦»åŸåˆ™å®šä¹‰ ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ ä¸€ä¸ªç±»å¯¹ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£ å°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ ä¼˜ç‚¹:ç¬¦åˆæˆ‘ä»¬å¸¸è¯´çš„é«˜å†…èšä½è€¦åˆçš„è®¾è®¡æ€æƒ³ï¼Œä»è€Œä½¿å¾—ç±»å…·æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ æ³¨æ„é€‚åº¦åŸåˆ™ï¼Œä¸€å®šè¦é€‚åº¦ Codingåä¾‹åˆ›å»ºæ¥å£ 12345678public interface IAnimalAction &#123; void eat(); void fly(); void swim();&#125; åˆ›å»ºå®ç°ç±» 1234567891011121314151617181920212223242526272829303132public class Bird implements IAnimalAction &#123; @Override public void eat() &#123; System.out.println(&quot;é¸Ÿ åƒé¥­&quot;); &#125; @Override public void fly() &#123; System.out.println(&quot;é¸Ÿ é£&quot;); &#125; @Override public void swim() &#123; // é¸Ÿä¸ä¼šæ¸¸æ³³ï¼Œç©ºå®ç° &#125;&#125;public class Dog implements IAnimalAction &#123; @Override public void eat() &#123; System.out.println(&quot;ç‹— åƒé¥­&quot;); &#125; @Override public void fly() &#123; // ç‹—ä¸ä¼šé£ï¼Œç©ºå®ç° &#125; @Override public void swim() &#123; System.out.println(&quot;ç‹— æ¸¸æ³³&quot;); &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé¸Ÿå’Œç‹—å®ç°äº†æ¥å£åï¼Œå„è‡ªéƒ½æœ‰æ— ç”¨çš„æ¥å£ï¼Œæ‰€ä»¥è¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œåªèƒ½é‡‡å–ç©ºå®ç°çš„æ–¹å¼ã€‚ä½†æ˜¯å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ï¼Œè¿˜æ˜¯å¯ä»¥è°ƒç”¨ç‹—çš„flyæ–¹æ³•ï¼Œå¾—åˆ°ç©ºçš„å®ç°ã€‚ æ­£ä¾‹å°†åä¾‹ä¸­çš„æ¥å£æ¥å£æ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„æ¥å£ 123456789public interface IEatAnimalAction &#123; void eat();&#125;public interface IFlyAnimalAction &#123; void fly();&#125;public interface ISwimAnimalAction &#123; void swim();&#125; Dogæ”¹ä¸º 1234567891011public class Dog implements IEatAnimalActionï¼ŒISwimAnimalAction &#123; @Override public void eat() &#123; System.out.println(&quot;ç‹— åƒé¥­&quot;); &#125; @Override public void swim() &#123; System.out.println(&quot;ç‹— æ¸¸æ³³&quot;); &#125;&#125; Birdæ”¹ä¸º 1234567891011public class Bird implements IEatAnimalActionï¼ŒIFlyAnimalAction &#123; @Override public void eat() &#123; System.out.println(&quot;é¸Ÿ åƒé¥­&quot;); &#125; @Override public void fly() &#123; System.out.println(&quot;é¸Ÿ é£&quot;); &#125;&#125; è¿™æ ·å°±æˆåŠŸçš„å°†ä¸€ä¸ªå¤§æ¥å£ï¼Œä¼˜åŒ–ä¸ºåˆ†æ‘ŠèŒè´£çš„å°æ¥å£ï¼Œå®ç°ç±»å¯ä»¥æ ¹æ®éœ€è¦å®ç°å¤šä¸ªèŒèƒ½æ¥å£ã€‚ è¿ªç±³ç‰¹åŸåˆ™å®šä¹‰ ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ å°½é‡é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆ ä¼˜ç‚¹:é™ä½ç±»ä¹‹é—´çš„è€¦åˆ Codingåä¾‹åˆ›å»ºè¯¾ç¨‹ç±» 12public class Course &#123;&#125; åˆ›å»ºé¡¹ç›®ç»ç†ç±» 123456public class TeamLeader &#123; public void checkNumberOfCourse(List&lt;Course&gt; courseList) &#123; System.out.println(&quot;åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š&quot; + courseList.size()); &#125;&#125; åˆ›å»ºè€æ¿ç±» 12345678910public class Boss &#123; public void commandCheckNumber(TeamLeader teamLeader) &#123; List&lt;Course&gt; courseList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 20; i++) &#123; courseList.add(new Course()); &#125; teamLeader.checkNumberOfCourse(courseList); &#125;&#125; æµ‹è¯•ç±» 1åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š20 æˆ‘ä»¬ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œå…¶å®è€æ¿å¹¶ä¸éœ€è¦çŸ¥é“è¯¾ç¨‹çš„ç»†èŠ‚ï¼Œåªéœ€è¦é—®ä¸€ä¸‹é¡¹ç›®ç»ç†ï¼Œæœ‰å¤šå°‘è¯¾ç¨‹ï¼Œé¡¹ç›®ç»ç†ç›´æ¥å‘Šè¯‰è€æ¿æœ‰20èŠ‚åœ¨çº¿è¯¾ç¨‹ã€‚è€Œä¸æ˜¯è€æ¿å°†è¯¾ç¨‹åˆ—å‡ºï¼Œè®©é¡¹ç›®ç»ç†ç»Ÿè®¡ã€‚ æˆ‘ä»¬çœ‹ä¸‹UMLç±»å›¾ æ­£ä¾‹é¡¹ç›®ç»ç†ç±»ä¿®æ”¹ä¸º 12345678910public class TeamLeader &#123; public void checkNumberOfCourse() &#123; List&lt;Course&gt; courseList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 20; i++) &#123; courseList.add(new Course()); &#125; System.out.println(&quot;åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š&quot; + courseList.size()); &#125;&#125; è€æ¿ç±» 123456public class Boss &#123; public void commandCheckNumber(TeamLeader teamLeader) &#123; teamLeader.checkNumberOfCourse(); &#125;&#125; è¿™æ—¶å€™è¿è¡Œä¸€ä¸‹ï¼Œç»“æœä¸€æ ·ã€‚ä½†æ˜¯ä»UMLç±»å›¾ä¸Šæ¥çœ‹ï¼Œæ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŒ–çš„ã€‚","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gcdd1993.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"UML","slug":"UML","permalink":"https://gcdd1993.github.io/tags/UML/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰UMLæ€»ç»“","date":"2019-07-27T16:02:06.000Z","path":"p/63230/","text":"å®šä¹‰ç»Ÿä¸€å»ºæ¨¡è¯­è¨€(è‹±è¯­: Unified Modeling Language ï¼Œç¼©å†™UML)æ˜¯éä¸“åˆ©çš„ç¬¬ä¸‰ä»£å»ºæ¨¡å’Œè§„çº¦è¯­è¨€ã€‚ UMLç‰¹ç‚¹ UMLæ˜¯ä¸€ç§å¼€æ”¾çš„æ–¹æ³• ç”¨äºè¯´æ˜ã€å¯è§†åŒ–ã€æ„å»ºå’Œç¼–å†™ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„é¢å‘å¯¹è±¡çš„ã€è½¯ä»¶å¯†é›†ç³»ç»Ÿçš„åˆ¶å“çš„å¼€æ”¾æ–¹æ³•ã€‚ UMLå±•ç°äº†ä¸€ç³»åˆ—æœ€ä½³å·¥ç¨‹å®è·µï¼Œè¿™äº›æœ€ä½³å®è·µåœ¨å¯¹å¤§è§„æ¨¡ï¼Œå¤æ‚ç³»ç»Ÿè¿›è¡Œå»ºæ¨¡æ–¹é¢ï¼Œç‰¹åˆ«æ˜¯åœ¨è½¯ä»¶æ¶æ„å±‚æ¬¡å·²ç»è¢«éªŒè¯æœ‰æ•ˆã€‚ UML2.2åˆ†ç±»UML2.2ä¸­ä¸€å…±å®šä¹‰äº†14ç§å›¾ç¤ºï¼Œåˆ†ç±»å¦‚ä¸‹: ç»“æ„å¼å›¾å½¢ï¼šå¼ºè°ƒçš„æ˜¯ç³»ç»Ÿå¼çš„å»ºæ¨¡ é™æ€å›¾(ç±»å›¾ï¼Œå¯¹è±¡å›¾ï¼ŒåŒ…å›¾) å®ç°å›¾(ç»„ä»¶å›¾ï¼Œéƒ¨ç½²å›¾) å‰–é¢å›¾ å¤åˆç»“æ„å›¾ è¡Œä¸ºå¼å›¾å½¢ï¼šå¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­è§¦å‘çš„äº‹ä»¶ æ´»åŠ¨å›¾ çŠ¶æ€å›¾ ç”¨ä¾‹å›¾ äº¤äº’å¼å›¾å½¢ï¼šå±äºè¡Œä¸ºå¼å›¾å½¢å­é›†åˆï¼Œå¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­çš„èµ„æ–™æµç¨‹ é€šä¿¡å›¾ äº¤äº’æ¦‚è¿°å›¾(UML2.0) æ—¶åºå›¾(UML2.0) æ—¶é—´å›¾(UML2.0) UMLç±»å›¾å®šä¹‰Class Diagram:ç”¨äºè¡¨ç¤ºç±»ã€æ¥å£ã€å®ä¾‹ç­‰ä¹‹é—´ç›¸äº’çš„é™æ€å…³ç³»ã€‚è™½ç„¶åå­—å«ç±»å›¾ï¼Œä½†ç±»å›¾ä¸­å¹¶ä¸åªæœ‰ç±»ï¼ˆä¹ŸåŒ…æ‹¬æƒé™ï¼Œå±æ€§ï¼Œæ–¹æ³•ç­‰ï¼‰ã€‚ è®°å¿†æŠ€å·§ç®­å¤´æ–¹å‘ å®šä¹‰å­ç±»æ—¶éœ€è¦é€šè¿‡extendså…³é”®å­—æŒ‡å®šçˆ¶ç±» å­ç±»ä¸€å®šæ˜¯çŸ¥é“çˆ¶ç±»å®šä¹‰çš„ï¼Œä½†çˆ¶ç±»å¹¶ä¸çŸ¥é“å­ç±»çš„å®šä¹‰ åªæœ‰çŸ¥é“å¯¹æ–¹ä¿¡æ¯æ—¶æ‰èƒ½æŒ‡å‘å¯¹æ–¹ æ‰€ä»¥ç®­å¤´æ–¹å‘æ˜¯ä»å­ç±»æŒ‡å‘çˆ¶ç±» å®çº¿-ç»§æ‰¿|è™šçº¿-å®ç° ç©ºå¿ƒä¸‰è§’ç®­å¤´:ç»§æ‰¿æˆ–å®ç° å®çº¿ç»§æ‰¿ï¼Œ is aå…³ç³»ï¼Œæ‰©å±•ç›®çš„ï¼Œä¸è™šï¼Œå¾ˆç»“å® è™šçº¿-å®ç°ï¼Œè™šçº¿ä»£è¡¨â€œè™šâ€ï¼Œæ— å®ä½“ å®çº¿-å…³è”|è™šçº¿-ä¾èµ– å®çº¿-å…³è”å…³ç³»:å…³ç³»ç¨³å®šï¼Œå®æ‰“å®çš„å…³ç³»ï¼Œé“å“¥ä»¬ è¡¨ç¤ºä¸€ä¸ªç±»å¯¹è±¡å’Œå¦ä¸€ä¸ªç±»å¯¹è±¡æœ‰å…³è” é€šå¸¸æ˜¯ä¸€ä¸ªç±»ä¸­æœ‰å¦ä¸€ä¸ªç±»å¯¹è±¡åšä¸ºå±æ€§ è™šçº¿-ä¾èµ–å…³ç³»:ä¸´æ—¶ç”¨ä¸€ä¸‹ï¼Œè‹¥å³è‹¥ç¦»ï¼Œè™šæ— ç¼¥ç¼ˆï¼Œè‹¥æœ‰è‹¥æ—  è¡¨ç¤ºä¸€ç§ä½¿ç”¨å…³ç³»ï¼Œä¸€ä¸ªç±»éœ€è¦å€ŸåŠ©å¦ä¸€ä¸ªç±»æ¥å®ç°åŠŸèƒ½ ä¸€èˆ¬æ˜¯ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»åšä¸ºå‚æ•°ä½¿ç”¨ï¼Œæˆ–ä½œä¸ºè¿”å›å€¼ ç©ºå¿ƒè±å½¢-èšåˆ|å®å¿ƒè±å½¢-ç»„åˆ è±å½¢å°±æ˜¯ä¸€ä¸ªç››ä¸œè¥¿çš„å™¨çš¿(ä¾‹å¦‚ç›˜å­) èšåˆ:ä»£è¡¨ç©ºå™¨çš¿é‡Œå¯ä»¥æ”¾å¾ˆå¤šç›¸åŒä¸œè¥¿ï¼Œèšåœ¨ä¸€èµ·(ç®­å¤´æ–¹å‘æ‰€æŒ‡çš„ç±») ç»„åˆ:ä»£è¡¨æ»¡å™¨çš¿é‡Œå·²ç»æœ‰å®ä½“ç»“æ„çš„å­˜åœ¨ï¼Œç”Ÿæ­»ä¸å…± æ•´ä½“å’Œå±€éƒ¨çš„å…³ç³»ï¼Œä¸¤è€…æœ‰ç€ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯has açš„å…³ç³» å¼±å…³ç³» æ¶ˆæçš„è¯:å¼±-ç©º æ•´ä½“ä¸å±€éƒ¨çš„å…³ç³»ï¼Œå’Œèšåˆçš„å…³ç³»ç›¸æ¯”ï¼Œå…³ç³»æ›´åŠ å¼ºçƒˆ ä¸¤è€…æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œ contains-açš„å…³ç³» å¼ºå…³ç³» ç§¯æçš„è¯:å¼º-æ»¡ å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§ 0..1:0æˆ–1ä¸ªå®ä¾‹. 0..*:0æˆ–å¤šä¸ªå®ä¾‹. 1..1:1ä¸ªå®ä¾‹. 1:åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹. 1..*:è‡³å°‘æœ‰ä¸€ä¸ªå®ä¾‹. ç±»å›¾è¯¦è§£ ç±»å›¾ä»ä¸Šåˆ°ä¸‹åŒ…å«ï¼š ç±»åï¼šæŠ½è±¡ç±»ä½¿ç”¨æ–œä½“è¡¨ç¤ºï¼Œæ¥å£ç”¨&lt;&gt;è¡¨ç¤º å±æ€§ï¼šè®¿é—®æƒé™+å±æ€§åï¼šå±æ€§ç±»å‹ +ï¼špublic -ï¼šprivate #ï¼šprotected ~ï¼šdefault ä¸‹æ¨ªçº¿è¡¨ç¤ºstatic æ–¹æ³•: è®¿é—®æƒé™+æ–¹æ³•åï¼šè¿”å›å€¼ç±»å‹ +ï¼špublic -ï¼šprivate #ï¼šprotected ~ï¼šdefault ä¸‹æ¨ªçº¿è¡¨ç¤ºstatic æ–œä½“è¡¨ç¤ºæŠ½è±¡æ–¹æ³• å…¸å‹çš„ç±»å›¾è¡¨ç¤ºï¼š UMLæ—¶åºå›¾Sequence Diagram :æ˜¯æ˜¾ç¤ºå¯¹è±¡ä¹‹é—´äº¤äº’çš„å›¾ï¼Œè¿™äº›å¯¹è±¡æ˜¯æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„ã€‚ æ—¶åºå›¾ä¸­åŒ…æ‹¬çš„å»ºæ¨¡å…ƒç´ ä¸»è¦æœ‰: å¯¹è±¡(Actor) ç”Ÿå‘½çº¿(Lifeline) æ§åˆ¶ç„¦ç‚¹(Focus of control) æ¶ˆæ¯(Message)ç­‰ å…¸å‹çš„ä¸€ä¸ªæ—¶åºå›¾å¦‚ä¸‹ï¼š","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gcdd1993.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"UML","slug":"UML","permalink":"https://gcdd1993.github.io/tags/UML/"}]},{"title":"Spring Mvc Http 400 Bad Requesté—®é¢˜æ’æŸ¥","date":"2019-07-26T10:32:46.000Z","path":"p/6604/","text":"å¦‚æœé‡åˆ°äº†Spring MVCæŠ¥é”™400ï¼Œè€Œä¸”æ²¡æœ‰è¿”å›ä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹è¯¥å¦‚ä½•æ’æŸ¥é—®é¢˜ï¼Ÿ é—®é¢˜æè¿°ä¸€ç›´éƒ½æ²¡æ¯›ç—…çš„æ¥å£ï¼Œä»Šå¤©æµ‹è¯•çš„æ—¶å€™çªç„¶æŠ¥é”™400 Bad Requestï¼Œè€Œä¸”Responseæ²¡æœ‰è¿”å›ä»»ä½•ä¿¡æ¯ã€‚ è§£å†³æ–¹æ¡ˆå°è¯•äº†ä¸€ä¸‹åˆï¼Œç»ˆäºæ‰¾åˆ°äº†æ’æŸ¥è¿™ç±»é—®é¢˜çš„åŠæ³•ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Spring MVCé‡Œé¢ï¼Œorg.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandlerè´Ÿè´£æ‰€æœ‰å¼‚å¸¸çš„ç»Ÿä¸€å¤„ç†ã€‚æˆ‘ä»¬åªè¦åœ¨æ–¹æ³•handleExceptionæ‰“ä¸Šæ–­ç‚¹å³å¯ã€‚ ç‚¹å¼€å‘ç°ï¼ŒåŸæ¥æ˜¯Lombokçš„é—®é¢˜ã€‚æŠ¥é”™å¦‚ä¸‹ 12Could not read JSON document: Can not construct instance of xxx: no suitable constructor found, can not deserialize from Object value (missing default constructor or creator, or perhaps need to add/enable type information?) at [Source: java.io.PushbackInputStream@12544acd; line: 2, column: 5] Lombokæ²¡æœ‰ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆç±»çš„æ„é€ å‡½æ•°ã€‚æˆ‘ä»¬åœ¨ç›®æ ‡ç±»åŠ ä¸Š@NoArgsConstructorå³å¯è§£å†³ã€‚ åˆ¨æ ¹é—®åº•ä¸ºä»€ä¹ˆLombokè‡ªåŠ¨ç”Ÿæˆçš„ç±»ï¼Œæ²¡æœ‰å¯ä¾›Jacksonååºåˆ—åŒ–çš„æ„é€ å‡½æ•°å‘¢ï¼Ÿæˆ‘çœ‹äº†ä¸€ä¸‹ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé‡Œé¢ç¡®å®ä¸å­˜åœ¨æ— å‚æ„é€ å’Œå…¨å‚æ„é€ å‡½æ•°ï¼Œå”¯ä¸€çš„æ„é€ å‡½æ•°æ˜¯å¸¦ä¸€ä¸ªå‚æ•°çš„ã€‚ ç›®æ ‡ç±»ä½¿ç”¨äº†@Dataæ³¨è§£ï¼Œè€Œ@Dataæ³¨è§£çš„å£°æ˜å¦‚ä¸‹ 1234567891011121314151617181920/** * Generates getters for all fields, a useful toString method, and hashCode and equals implementations that check * all non-transient fields. Will also generate setters for all non-final fields, as well as a constructor. * &lt;p&gt; * Equivalent to &#123;@code @Getter @Setter @RequiredArgsConstructor @ToString @EqualsAndHashCode&#125;. * &lt;p&gt; * Complete documentation is found at &lt;a href=&quot;https://projectlombok.org/features/Data&quot;&gt;the project lombok features page for &amp;#64;Data&lt;/a&gt;. * * @see Getter * @see Setter * @see RequiredArgsConstructor * @see ToString * @see EqualsAndHashCode * @see lombok.Value */@Target(ElementType.TYPE)@Retention(RetentionPolicy.SOURCE)public @interface Data &#123; String staticConstructor() default &quot;&quot;;&#125; ç®€å•æ¥è¯´ï¼Œ@DataåŒ…å«äº†ä»¥ä¸‹æ³¨è§£çš„åŠŸèƒ½ @Getter @Setter @RequiredArgsConstructor @ToString @EqualsAndHashCode è€Œâ€œç½ªé­ç¥¸é¦–â€å°±æ˜¯@RequiredArgsConstructoräº†ï¼Œå®ƒçš„ä½œç”¨æ˜¯ ä¸ºæ¯ä¸ªéœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µï¼ˆfinalä¿®é¥°çš„æˆ–è€…æ˜¯@NotNullæ³¨é‡Šçš„å­—æ®µï¼‰ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ã€‚ è€Œç›®æ ‡ç±»æ°å·§æœ‰ä¸€ä¸ªå­—æ®µå°±æ˜¯@NotNullæ³¨è§£ä¿®é¥°çš„ï¼Œæ‰€ä»¥ç”Ÿæˆäº†å•å‚æ„é€ å‡½æ•°ã€‚ å‚è€ƒ Lombok Features Spring MVCè‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Nginxé…ç½®HttpsæŒ‡å—","date":"2019-07-24T08:42:05.000Z","path":"p/17023/","text":"å‰è¨€æœ¬æ–‡æ˜¯å¯¹Nginxé…ç½®SSLè¯ä¹¦çš„æ€»ç»“ã€‚ ç”³è¯·SSLè¯ä¹¦ ä½ å¯ä»¥ä»ä»»ä½•è¯ä¹¦æä¾›å•†å¤„ç”³è¯·è¯ä¹¦ï¼Œè¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ã€‚ æ‰“å¼€é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°ï¼Œç‚¹å‡»è´­ä¹°è¯ä¹¦ é€‰æ‹©å…è´¹å‹ä¸€å¹´æœŸçš„è¯ä¹¦ï¼Œç‚¹å‡»ç«‹å³è´­ä¹°æ³¨æ„ï¼Œ1å¹´åˆ°æœŸååˆ«å¿˜è®°é‡æ–°ç”³è¯·è¯ä¹¦ï¼ æ”¯ä»˜æ”¾å¿ƒå¤§èƒ†çš„æ”¯ä»˜å§ï¼Œä¸ç”¨é’±ï¼ éªŒè¯SSLè¯ä¹¦è´­ä¹°å®Œæˆä¹‹åï¼Œè¿”å›SSLè¯ä¹¦æ§åˆ¶å°ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšæ‰è´­ä¹°çš„è¯ä¹¦ã€‚æˆ‘ä»¬ç‚¹å‡»ç”³è¯· å¡«å†™åŸŸåï¼ˆå¿…é¡»æ˜¯ä½ è‡ªå·±çš„æˆ–è€…æœ‰ç®¡ç†æƒçš„åŸŸåï¼‰å’Œç›¸å…³ä¿¡æ¯ï¼Œå®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚æ³¨æ„ï¼Œå…è´¹å‹è¯ä¹¦åªæ”¯æŒå•ä¸ªåŸŸåï¼ä¾‹å¦‚ä½ è¦ä¸ºwww.example.comç”³è¯·è¯ä¹¦ï¼Œä½ å¿…é¡»å¡«å†™www.example.comï¼Œè€Œä¸èƒ½æ˜¯example.comã€‚ åœ¨DNSæœåŠ¡å•†å¤„é…ç½®é˜¿é‡Œäº‘æä¾›çš„éªŒè¯ä¿¡æ¯ã€‚ä¾‹å¦‚DNSPodï¼Œå¡«å†™ä¸»æœºè®°å½•ï¼Œè®°å½•å€¼å’Œè®°å½•ç±»å‹ï¼Œç„¶åç‚¹å‡»ä¿å­˜ã€‚ è€å¿ƒç­‰å¾…TTLåˆ·æ–°ï¼ˆä¸€èˆ¬ä¸º10åˆ†é’Ÿï¼Œä¹Ÿå¯èƒ½èŠ±ä¸äº†10åˆ†é’Ÿï¼‰ã€‚ å›åˆ°é˜¿é‡Œäº‘SSLè¯ä¹¦ç”³è¯·é¡µé¢ï¼Œç‚¹å‡»éªŒè¯ã€‚ ç­¾å‘åŸŸåéªŒè¯é€šè¿‡åï¼Œè¯ä¹¦æä¾›å•†å°†ä¼šä¸ºä½ çš„åŸŸåé¢å‘è¯ä¹¦ã€‚åœ¨é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°çš„å·²ç­¾å‘åˆ—è¡¨ä¸‹å¯ä»¥æ‰¾åˆ°ä½ çš„åŸŸåå¯¹åº”çš„SSLè¯ä¹¦ã€‚ ä¸‹è½½è¯ä¹¦ä¸‹è½½Nginxå¯¹åº”çš„SSLè¯ä¹¦xx_nginx.zipï¼Œå‡†å¤‡é…ç½®Nginxã€‚ é…ç½®Nginxå¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…Nginxï¼Œå¯ä»¥å‚è€ƒéƒ¨ç½²Nginx ä¸Šä¼ è¯ä¹¦1234567891011$ sudo mkdir /etc/nginx/certs$ sudo cd /etc/nginx/certs## ä¸Šä¼ ä½ çš„è¯ä¹¦è‡³æ­¤ç›®å½•$ sudo ls -ldrwxr-xr-x 2 root root 4096 Jul 24 17:15 ./drwxr-xr-x 7 root root 4096 Jul 24 17:15 ../-rw-r--r-- 1 root root 4053 Jul 24 16:49 xx_nginx.zip$ sudo unzip xx_nginx.zip$ sudo ls -l-rw-r--r-- 1 root root 1679 Jul 24 16:48 xx.key ## ssl cert key-rw-r--r-- 1 root root 3667 Jul 24 16:48 xx.pem ## ssl cert ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œå¯ä»¥å¼€å§‹ä¿®æ”¹æˆ‘ä»¬çš„Nginxé…ç½®æ–‡ä»¶äº†ã€‚ ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶å°†Httpä¿®æ”¹ä¸ºHttpséå¸¸ç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€å¤„å†…å®¹ï¼Œå¹¶æ·»åŠ è‹¥å¹²ä»£ç ã€‚ å°†listen 80;ä¿®æ”¹ä¸ºlisten 443; åœ¨serverå—ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç  12345ssl on;ssl_certificate certs/xx.pem;ssl_certificate_key certs/xx.key;ssl_session_timeout 5m; ä¿®æ”¹å®Œæˆåï¼Œé‡å¯Nginx 12$ sudo service nginx reload$ sudo service nginx restart å¥½äº†ï¼Œä½¿ç”¨Httpsè®¿é—®ä½ çš„ç½‘ç«™å§ã€‚ Httpå¼ºåˆ¶è½¬å‘Httpsæ³¨æ„ï¼Œä»¥ä¸Šä¿®æ”¹å®Œæˆåï¼Œåªèƒ½ä½¿ç”¨Httpsè®¿é—®äº†ï¼Œä½†æ˜¯å¾€å¾€æˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·ä½¿ç”¨Httpè®¿é—®çš„æ—¶å€™å‡ºç°404çš„æƒ…å†µã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å°†80ç«¯å£çš„ç”¨æˆ·è½¬å‘åˆ°443ç«¯å£ï¼Œæ¥è¾¾åˆ°Httpå’ŒHttpså…±å­˜çš„çŠ¶æ€ã€‚ åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­æ·»åŠ  123456server &#123; listen 80; server_name xx.xx.com; return 301 https://$server_name$request_uri;&#125; é‡å¯Nginx","tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://gcdd1993.github.io/tags/Nginx/"}]},{"title":"ä½¿ç”¨Hyper-Væ›¿ä»£VMware","date":"2019-07-19T05:52:46.000Z","path":"p/14834/","text":"Hyper-Væ˜¯ä»€ä¹ˆ Hyper-Vç¡¬ä»¶è¦æ±‚ä¸ºWindows 10 ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Macæˆ–è€…Linuxçš„ç”µè„‘ï¼Œå¯ä»¥ä¸å¾€ä¸‹çœ‹äº†ã€‚ è™šæ‹Ÿæœºå¤§å®¶éƒ½æ‡‚å§ï¼Œç®€å•æ¥è¯´ï¼ŒHyper-Vå°±æ˜¯è™šæ‹Ÿæœºç®¡ç†å·¥å…·ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡VMware Workstation Proæˆ–è€…æ˜¯VirtualBoxï¼Œé‚£ä½ ä¸€å®šä¸é™Œç”Ÿäº†ã€‚ å…·ä½“æ¥è¯´ï¼ŒHyper-V æä¾›ç¡¬ä»¶è™šæ‹ŸåŒ–ã€‚ è¿™æ„å‘³ç€æ¯ä¸ªè™šæ‹Ÿæœºéƒ½åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œã€‚ Hyper-V å…è®¸ä½ åˆ›å»ºè™šæ‹Ÿç¡¬ç›˜é©±åŠ¨å™¨ã€è™šæ‹Ÿäº¤æ¢æœºä»¥åŠè®¸å¤šå…¶ä»–è™šæ‹Ÿè®¾å¤‡ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vè€Œä¸æ˜¯VMwareï¼Ÿé¦–å…ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿæœºï¼Ÿ è¿è¡Œéœ€è¦æ—©æœŸç‰ˆæœ¬çš„Windows æ“ä½œç³»ç»Ÿæˆ–éWindows æ“ä½œç³»ç»Ÿçš„è½¯ä»¶ã€‚ å®éªŒå…¶ä»–æ“ä½œç³»ç»Ÿã€‚ é€šè¿‡è™šæ‹Ÿæœºï¼Œå¯è½»æ¾åˆ›å»ºå’Œåˆ é™¤ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚ ä½¿ç”¨å¤šä¸ªè™šæ‹Ÿæœºåœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šæµ‹è¯•è½¯ä»¶ã€‚ é€šè¿‡è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨ä¸€éƒ¨å°å¼æœºæˆ–ä¾¿æºå¼è®¡ç®—æœºä¸Šè¿è¡Œæ‰€æœ‰å†…å®¹ã€‚ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vï¼Ÿ é¦–å…ˆï¼ŒHyper-Væ˜¯Windows 10 ä¸“ä¸šç‰ˆè‡ªå¸¦çš„åŠŸèƒ½ï¼Œæ— éœ€å®‰è£…å…¶ä»–ä»»ä½•å·¥å…· Docker for Windowsæ¨èä½¿ç”¨Hyper-Vä½œä¸ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ å…è´¹ æ‰€ä»¥ï¼Œåœ¨Hyper-Vèƒ½èƒœä»»çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨Hyper-Vã€‚ å¦‚ä½•ä½¿ç”¨Hyper-Væ£€æŸ¥ç³»ç»Ÿè¦æ±‚ Windows 10 ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆã€‚ å…·æœ‰äºŒçº§åœ°å€è½¬æ¢ (SLAT) çš„ 64 ä½å¤„ç†å™¨ã€‚ è™šæ‹Ÿæœºç›‘è§†å™¨æ¨¡å¼æ‰©å±•çš„ CPU æ”¯æŒ (Intel Cpu ä¸Šçš„ VT-c)ã€‚ æœ€å° 4 GB å†…å­˜ã€‚ æ³¨æ„ï¼šç³»ç»Ÿå¿…é¡»æ˜¯Windows 10ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆã€‚ å¼€å¯Hyper-Vä½¿ç”¨ PowerShell å¯ç”¨ Hyper-V ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æ§åˆ¶å°ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All å¦‚æœæ— æ³•æ‰¾åˆ°æ­¤å‘½ä»¤ï¼Œè¯·ç¡®ä¿ä½ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellã€‚ å®‰è£…å®Œæˆåï¼Œè¯·é‡å¯ã€‚ ä½¿ç”¨ CMD å’Œ DISM å¯ç”¨ Hyper-Véƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†å·¥å…· (DISM) å¯å¸®åŠ©é…ç½® Windows å’Œ Windows æ˜ åƒã€‚ åœ¨ä¼—å¤šåº”ç”¨ç¨‹åºä¸­ï¼ŒDISM å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿè¿è¡Œæ—¶å¯ç”¨ Windows åŠŸèƒ½ã€‚ ä½¿ç”¨ DISM å¯ç”¨ Hyper-V è§’è‰²ï¼š ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æˆ– CMD ä¼šè¯ã€‚ é”®å…¥ä¸‹åˆ—å‘½ä»¤ï¼š 1DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V é€šè¿‡â€œè®¾ç½®â€å¯ç”¨ Hyper-V è§’è‰²æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ å³é”®å•å‡» Windows æŒ‰é’®å¹¶é€‰æ‹©â€œåº”ç”¨å’ŒåŠŸèƒ½â€ã€‚ åœ¨ â€œç›¸å…³è®¾ç½®â€ ä¸‹çš„å³ä¾§é€‰æ‹© â€œç¨‹åºå’ŒåŠŸèƒ½â€œã€‚ é€‰æ‹©â€œæ‰“å¼€æˆ–å…³é—­ Windows åŠŸèƒ½â€ã€‚ é€‰æ‹© Hyper-Vï¼Œç„¶åå•å‡»ç¡®å®šã€‚ åŒæ ·çš„ï¼Œå®‰è£…å®Œæˆåï¼Œè¯·é‡å¯ã€‚ åˆ›å»ºè™šæ‹Ÿæœºåœ¨å¼€å§‹èœå•æ‰¾åˆ°å¹¶æ‰“å¼€Hyper-Vç®¡ç†å™¨ï¼Œå®ƒåº”è¯¥ä½äºWindowsç®¡ç†å·¥å…·æ–‡ä»¶å¤¹ä¸‹é¢ã€‚ æˆ–è€…ç›´æ¥æœç´¢Hyper-V æ‰“å¼€åç•Œé¢å¦‚ä¸‹ï¼Œæˆ‘è§‰å¾—æ¯”VMwareç•Œé¢å¥½çœ‹ç‚¹ã€‚ å¿«é€Ÿåˆ›å»ºç‚¹å‡»å¿«é€Ÿåˆ›å»ºï¼Œä½ å°†ä¼šçœ‹åˆ° ç±»ä¼¼äºåœ¨çº¿å®‰è£…ï¼Œæ¯”è¾ƒç®€å•ã€‚ æˆ‘å°è¯•äº†å¯¼å…¥æœ¬åœ°å®‰è£…æºå®‰è£…Ubuntu 16.04ï¼Œä½†æ˜¯å¯åŠ¨æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°Bootä¿¡æ¯ã€‚ å¯èƒ½åŸå› æ˜¯ï¼šæˆ‘çš„ç”µè„‘ä¸æ”¯æŒç¬¬äºŒä»£è™šæ‹Ÿæœºä¸–ä»£ï¼ˆæ˜¯ä¸€ç§è¾ƒæ–°çš„è™šæ‹ŸåŒ–åŠŸèƒ½ï¼‰ æ–°å»ºè™šæ‹Ÿæœºç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœºï¼Œä½ å°†ä¼šè¿›å…¥ä¸€ä¸‹ç•Œé¢ è·Ÿç€ä¸€æ­¥æ­¥æ¥å§ï¼Œé¦–å…ˆä½ å¾—å‡†å¤‡å¥½ä¸€ä¸ªç³»ç»Ÿé•œåƒï¼ˆISOç»“å°¾çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ï¼‰ ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå®Œæˆã€‚ æ¥ç€ï¼Œå°±è¿›å…¥äº†Ubuntuç³»ç»Ÿå®‰è£…ç¯èŠ‚ï¼Œçœç•¥äº†ï¼Œå¤§å®¶åº”è¯¥éƒ½ä¼šè£…çš„ã€‚ å¯¼å…¥è™šæ‹Ÿæœºé™¤äº†è‡ªå·±åˆ›å»ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥åˆ«äººåˆ›å»ºå¥½çš„è™šæ‹Ÿæœº ç‚¹å‡»å¯¼å…¥è™šæ‹Ÿæœº ä»¥ä¸‹æ˜¯æˆ‘åˆ›å»ºçš„Ubuntu 16.04è™šæ‹Ÿæœºï¼Œä½ å¯ä»¥ç›´æ¥å¯¼å…¥ä½¿ç”¨ã€‚ https://1drv.ms/f/s!AjfBPvEeW2r2hukqwAdOrPSMPpKZ4A å‚è€ƒWindows 10 ä¸Šçš„ Hyper-V ç®€ä»‹","tags":[{"name":"Hyper-V","slug":"Hyper-V","permalink":"https://gcdd1993.github.io/tags/Hyper-V/"}]},{"title":"Ubuntu æ­å»ºphpcms","date":"2019-06-24T09:50:42.000Z","path":"p/5357/","text":"å®‰è£…Apache2123$ sudo apt-get update -y$ sudo apt-get install apache2 -y$ sudo systemctl start apache2.service å®‰è£…Mysql12345678$ sudo apt-get install mysql-server -y$ sudo /usr/bin/mysql_secure_installation## éƒ½é€‰yå°±è¡Œ$ mysql -u root -p mysql&gt; CREATE DATABASE js_website;## å¯¼å…¥æ•°æ®mysql&gt; source /tmp/jskj.sql;mysql&gt; \\q; å®‰è£…PHP12$ sudo apt-get install php -y;$ sudo apt-get install -y php-&#123;bcmath,bz2,intl,gd,mbstring,mcrypt,mysql,zip&#125; &amp;&amp; sudo apt-get install libapache2-mod-php -y; éƒ¨ç½²PHPå®˜ç½‘123456789101112131415161718192021222324252627$ mkdir /var/www/html/phpcms$ cd /var/www/html/phpcms# ä¸Šä¼ phpcms.zipåŒ…è‡³æ­¤ç›®å½•$ unzip phpcms.zip$ ls -ldrwxr-xr-x 11 root root 4096 Jun 24 17:21 ./drwxr-xr-x 3 root root 4096 Jun 24 17:21 ../-rw-r--r-- 1 root root 48 Jun 24 15:53 admin.phpdrwxr-xr-x 3 root root 4096 Jun 24 15:53 api/-rw-r--r-- 1 root root 991 Jun 24 15:53 api.phpdrwxr-xr-x 18 root root 4096 Jun 24 15:53 caches/-rw-r--r-- 1 root root 104 Jun 24 15:53 crossdomain.xmldrwxr-xr-x 6 root root 4096 Jun 24 15:53 custom/-rw-r--r-- 1 root root 3158 Jun 24 15:53 favicon.icodrwxr-xr-x 2 root root 4096 Jun 24 15:53 html/-rw-r--r-- 1 root root 4444 Jun 24 15:53 index.htm-rw-r--r-- 1 root root 22758 Jun 24 15:53 index.html-rw-r--r-- 1 root root 318 Jun 24 15:53 index.php-rw-r--r-- 1 root root 523 Jun 24 15:53 js.htmldrwxr-xr-x 8 root root 4096 Jun 24 15:53 mes/drwxr-xr-x 8 root root 4096 Jun 24 15:53 phpcms/-rw-r--r-- 1 root root 168191200 Jun 24 16:38 phpcms.zipdrwxr-xr-x 7 root root 4096 Jun 24 15:53 phpsso_server/-rw-r--r-- 1 root root 3621 Jun 24 15:53 plugin.php-rw-r--r-- 1 root root 170 Jun 24 15:53 robots.txtdrwxr-xr-x 6 root root 4096 Jun 24 15:53 statics/drwxr-xr-x 4 root root 4096 Jun 24 15:53 uploadfile/ ğŸ‘‰è¿™é‡Œçš„zipå‹ç¼©åŒ…ï¼Œæ˜¯å·²ç»installåçš„phpcmsï¼Œå› ä¸ºé¡¹ç›®ç»ç†ç»™æˆ‘çš„å°±æ˜¯å®‰è£…å¥½çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨äº†ã€‚ åæ­£åŸç†éƒ½ä¸€æ ·ï¼Œé…ç½®Apacheè§£æåŸŸåæŒ‡å‘è·¯å¾„å°±è¡Œã€‚ é…ç½®Apache1234567891011121314$ cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/phpcms.conf$ cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/phpcms-mes.conf$ ln -s /etc/apache2/sites-available/phpcms.conf /etc/apache2/sites-enabled/phpcms.conf$ ln -s /etc/apache2/sites-available/phpcms-mes.conf /etc/apache2/sites-enabled/phpcms-mes.conf$ vim /etc/apache2/sites-available/phpcms.confServerName js.dbpe-cps.com# ServerAdmin webmaster@localhostDocumentRoot /var/www/html/phpcms$ vim /etc/apache2/sites-available/phpcms-mes.confServerName mes.js.dbpe-cps.com# ServerAdmin webmaster@localhostDocumentRoot /var/www/html/phpcms/mes$ service apache2 restart åŸŸåè§£æé…ç½®ä½ çš„åŸŸåæŒ‡å‘ä½ çš„æœåŠ¡å™¨å°±è¡Œã€‚è¿™é‡Œç•¥è¿‡ã€‚ å…¶ä»–Apacheå¸¸ç”¨å‘½ä»¤1234## é‡å¯Apache2$ service apache2 restart $ service apache2 status$ service apache2 start Apacheç›®å½• é…ç½®ç›®å½•ï¼š/etc/apache2 é»˜è®¤wwwç›®å½•ï¼š/var/www/html è¿™ä¸€ç‚¹è·Ÿå…¶ä»–çš„ä¸ä¸€æ ·ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹åˆ°é…ç½®æ–‡ä»¶æ‰çŸ¥é“æ˜¯è¿™ä¸ªç›®å½•çš„ /etc/apache2/apache2.conf","tags":[{"name":"phpcms","slug":"phpcms","permalink":"https://gcdd1993.github.io/tags/phpcms/"}]},{"title":"å‘å¸ƒå¼€æºé¡¹ç›®åˆ°Jcenter","date":"2019-06-10T08:44:17.000Z","path":"p/53809/","text":"å‰è¨€ ä¸ºäº†å°†é˜¿é‡Œäº‘çŸ­ä¿¡å¼€ç®±å³ç”¨å‘å¸ƒåˆ°Jcenterä»“åº“ï¼Œå‰å‰ååèŠ±è´¹äº†1å¤©åŠçš„æ—¶é—´ï¼ŒæŠŠç«¯åˆèŠ‚éƒ½æ­è¿›å»äº†ã€‚ç»ˆäºä»Šå¤©æ”¶åˆ°äº†Jcenterçš„æ¶ˆæ¯ï¼Œè‡ªå·±å‘å¸ƒçš„åŒ…è¢«æ·»åŠ åˆ°äº†Jcenterä»“åº“ï¼Œä¹Ÿç®—ç»™å¼€æºç¤¾åŒºåšäº†æ¬¡å°è´¡çŒ®ğŸ˜ğŸ˜ğŸ˜ã€‚ ç°åœ¨è®°å½•ä¸‹è¸©è¿‡çš„å‘ã€‚ æ³¨å†ŒJcenterè´¦å·è¦æ³¨æ„çš„åœ°æ–¹ï¼ŒJcenterè´¦å·è·Ÿå›½å†…ä¸€æ ·åˆ†ä¸ºç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆï¼Œä¼ä¸šç‰ˆå½“ç„¶æ˜¯è¦ä»˜è´¹çš„ï¼Œè€Œä¸”å¾ˆå‘çš„æ˜¯ç‚¹è¿›Bintrayå®˜ç½‘ï¼Œé¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯å¤§å¤§çš„Start Your Free Trialï¼ˆå¼€å§‹å…è´¹è¯•ç”¨ï¼‰ï¼Œä¸€å¼€å§‹æˆ‘å°±æ³¨å†Œäº†ä¼ä¸šç‰ˆè´¦å·ï¼Œåæ¥åˆ å·é‡å»ºäº†ğŸ˜‚ã€‚æˆ‘ä»¬åº”è¯¥ç‚¹è¿™é‡Œï¼š å¡«å†™ä¿¡æ¯åæ³¨å†Œï¼Œæˆ‘æ˜¯ç›´æ¥ä½¿ç”¨çš„Githubè´¦å·æ³¨å†Œã€‚ åˆ›å»ºRepositoryç‚¹å‡»å³ä¸Šè§’View Profile åœ¨è´¦å·ä¿¡æ¯ä¸‹æ–¹ï¼Œæˆ‘ä»¬ç‚¹å‡»Add New Repositoryï¼Œåˆ›å»ºæ–°çš„ä»“åº“ã€‚ åœ¨å¡«å†™ä¿¡æ¯çš„æ—¶å€™ï¼Œé€‰æ‹©Publicï¼ˆPrivateæ˜¯éœ€è¦ä»˜é’±çš„ï¼Œå¤§å®¶éƒ½æ‡‚ï¼‰ï¼Œå¦‚æœä½ æ˜¯mavené¡¹ç›®ï¼Œä»“åº“åæœ€å¥½å¡«å†™mavenï¼Œå› ä¸ºæˆ‘åœ¨ç”³è¯·Add To Jcenteræ—¶ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥äº†ï¼Œè¦æ±‚æˆ‘æŠŠé¡¹ç›®æ”¾åœ¨mavenè·¯å¾„ä¸‹ã€‚ åˆ›å»ºPackageåˆ›å»ºå®Œä»“åº“ï¼Œå°±æ˜¯åˆ›å»ºåŒ…äº†ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½ çš„åº”ç”¨å«å•¥åï¼ŒåŒ…å°±å«å•¥åå°±è¡Œã€‚ åˆ›å»ºå®Œå¯ä»¥çœ‹åˆ°åŒ…çš„åŸºæœ¬ä¿¡æ¯ï¼š æ‰“åŒ…ä¸Šä¼ è¿™é‡Œä½¿ç”¨çš„æ˜¯å¼€æºé¡¹ç›®bintray-releaseï¼Œå®˜æ–¹æ–‡æ¡£bintray-release/wiki ä¸»è¦åœ¨build.gradleé‡Œæ·»åŠ å¦‚ä¸‹ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132buildscript &#123; repositories &#123; jcenter() &#125; dependencies &#123; classpath &#x27;com.novoda:bintray-release:0.9.1&#x27; &#125;&#125;apply plugin: &#x27;com.novoda.bintray-release&#x27;publish &#123; userOrg = &#x27;ä½ çš„Bintrayç”¨æˆ·å&#x27; groupId = &#x27;åº”ç”¨çš„groupIdï¼Œä¾‹å¦‚ï¼šio.github.gcdd1993&#x27; artifactId = &#x27;åº”ç”¨çš„åç§°ï¼Œä¾‹å¦‚ï¼šali-sms-spring-boot-starter&#x27; publishVersion = &#x27;åº”ç”¨çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼š1.0.0.RELEASE&#x27; desc = &#x27;ä¸€å¥è¯æ¦‚è¿°ä½ çš„åº”ç”¨å¹²å•¥çš„&#x27; website = &#x27;åº”ç”¨é“¾æ¥ï¼Œä¸€èˆ¬å†™githubåœ°å€å°±è¡Œï¼Œä¾‹å¦‚ï¼šhttps://github.com/gcdd1993/ali-sms-spring-boot-starter&#x27;&#125;/** * ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±åŠ çš„ * ç¬¬ä¸€ä¸ªè§£å†³Gradle Task:jar skippedçš„é—®é¢˜ * ç¬¬äºŒä¸ªè§£å†³javaDoc &#x27;UTF-8&#x27;ä¹±ç é—®é¢˜ */jar &#123; enabled = true&#125;tasks.withType(JavaCompile) &#123; options.encoding = &quot;UTF-8&quot;&#125; æ¥ä¸‹æ¥æ‰§è¡Œgradleå‘½ä»¤ï¼š 1./gradlew bintrayUpload -PbintrayUser=BINTRAY_USERNAME -PbintrayKey=BINTRAY_KEY -PdryRun=false æœ¬åœ°æµ‹è¯•å¯ä»¥æŠŠ-PdryRun=falseæ”¹ä¸º-PdryRun=trueï¼Œè¿™æ ·å°±ä¸ä¼šå¸®ä½ ä¸Šä¼ åˆ°Bintrayï¼Œå…¶ä»–çš„éƒ½æ‰§è¡Œã€‚ çœ‹åˆ°ä»¥ä¸Šä¿¡æ¯ï¼Œè¯æ˜å‘å¸ƒæˆåŠŸäº†ã€‚ Add To Jcenterå‘å¸ƒæˆåŠŸåï¼Œä½ åº”è¯¥ä¼šåœ¨Packageçš„Filesæ ‡ç­¾ä¸‹çœ‹åˆ°ä½ ä¸Šä¼ çš„æ–‡ä»¶ æˆ‘ä»¬ç‚¹å‡»å³ä¸Šè§’Actionsä¸‹çš„Add To Jcenter å¡«å†™ä¿¡æ¯ï¼Œä¸¤ä¸ªå¤é€‰æ¡†æˆ‘éƒ½å‹¾é€‰äº†ï¼Œç„¶åå¡«å†™Group Idï¼Œå¡«ä¸Šåº”ç”¨è¯´æ˜ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ï¼Œç„¶åç­‰ç€å°±è¡Œäº†ã€‚ ä¸€èˆ¬æ¥è¯´1~3å¤©ä½ å°†ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œé€šçŸ¥ä½ çš„ç”³è¯·é€šè¿‡æ²¡æœ‰ï¼Œå¦‚ä¸‹ ğŸ‘‰å¦‚æœæ²¡æœ‰é€šè¿‡ï¼Œä¹Ÿä¼šå‘Šè¯‰ä½ æ€ä¹ˆæ”¹ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚ è¿™æ—¶å€™å†æ‰“å¼€Bintrayçš„Packageé¡µé¢ï¼Œä¼šå‘ç°Included In Jcenterï¼Œè¯æ˜å·²ç»è¢«Jcenteræ”¶å½•äº†ï¼Œå…¶ä»–äººå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å•¦ã€‚ Travis CIæŒç»­é›†æˆTravis CIæ˜¯ä»€ä¹ˆå°±ä¸ä»‹ç»äº†ï¼Œä¸æ˜ç™½çš„å¯ä»¥çœ‹ä¸‹é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—-æŒç»­é›†æˆæœåŠ¡ Travis CI æ•™ç¨‹ï¼ŒGithubå…¬å¼€ä»“åº“å…è´¹çš„æŒç»­é›†æˆå·¥å…·ã€‚ é¡¹ç›®æ ¹ç›®å½•æ·»åŠ .travis.ymlï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼ˆé’ˆå¯¹Gradleæ­å»ºçš„Javaé¡¹ç›®é€‚ç”¨ï¼‰ 123456789101112131415161718192021language: javasudo: requireddist: xenialjdk: - openjdk8branches: only: - masterbefore_cache: - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock - rm -fr $HOME/.gradle/caches/*/plugin-resolution/cache: directories: - $HOME/.gradle/caches/ - $HOME/.gradle/wrapper/before_install: - chmod +x gradlewinstall: - ./gradlew jarscript: - ./gradlew bintrayUpload -PbintrayUser=$&#123;bintray_user&#125; -PbintrayKey=$&#123;bintray_key&#125; -PdryRun=false å…¶ä¸­å˜é‡$&#123;bintray_user&#125;å’Œ$&#123;bintray_key&#125;æ˜¯Travis CIè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ï¼Œè¯·åˆ°Travis CI Settingså¡«å†™ã€‚ å‚è€ƒæ–‡æ¡£ bintray-release-wiki Maven Publish Plugin é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—-æŒç»­é›†æˆæœåŠ¡ Travis CI æ•™ç¨‹","tags":[{"name":"Jcenter","slug":"Jcenter","permalink":"https://gcdd1993.github.io/tags/Jcenter/"}]},{"title":"é˜¿é‡Œäº‘çŸ­ä¿¡å¼€ç®±å³ç”¨","date":"2019-06-07T15:52:16.000Z","path":"p/28056/","text":"ç®€ä»‹ ä½¿ç”¨SpringBootè‡ªåŠ¨è£…é…ç®€åŒ–å¯¹æ¥é˜¿é‡Œäº‘çŸ­ä¿¡è¿‡ç¨‹ã€‚ å°å·¥å…·ä¸€æšï¼Œæ¬¢è¿ä½¿ç”¨å’ŒStaræ”¯æŒï¼Œå¦‚ä½¿ç”¨è¿‡ç¨‹ä¸­ç¢°åˆ°é—®é¢˜ï¼Œå¯ä»¥æå‡ºIssueï¼Œæˆ‘ä¼šå°½åŠ›å®Œå–„è¯¥Starterã€‚ ç‰ˆæœ¬åŸºç¡€aliyun-java-sdk-core:4.1.0 å¦‚ä½•ä½¿ç”¨Maven12345&lt;dependency&gt; &lt;groupId&gt;io.github.gcdd1993&lt;/groupId&gt; &lt;artifactId&gt;ali-sms-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0.0.RELEASE&lt;/version&gt;&lt;/dependency&gt; Gradle1compile &#x27;io.github.gcdd1993:ali-sms-spring-boot-starter:1.0.0.RELEASE&#x27; ğŸ‘‰æ³¨æ„ï¼šéœ€è¦å¼•å…¥Jcenterä»“åº“ å‚æ•°é…ç½®ä»¥application.ymlä¸¾ä¾‹ 12345678910ali: sms: domain: &quot;dysmsapi.aliyuncs.com&quot; ## é»˜è®¤dysmsapi.aliyuncs.com version: &quot;2017-05-25&quot; ## é»˜è®¤2017-05-25 action: &quot;SendSms&quot; ## é»˜è®¤SendSms access-key: id: &quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡AccessKeyId&#125;&quot; secret: &quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡AccessKeySecret&#125;&quot; region-id: &quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡åœ°åŸŸ&#125;&quot; sign-name: &quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡ç­¾å&#125;&quot; ## å¦‚æœä¸å¡«ï¼Œå¿…é¡»åœ¨å‘é€æ–¹æ³•ä¸­æŒ‡å®š åŸºæœ¬ä½¿ç”¨åŒæ­¥å‘é€çŸ­ä¿¡ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ¥å£ä¸Šè¿›è¡Œäº†æ–¹æ³•çš„é‡è½½ï¼Œæä¾›5ç§ä¸åŒçš„å‚æ•°åˆ—è¡¨ä¾›é€‰æ‹©ï¼Œä½ å¯ä»¥è‡ªè¡Œé€‰æ‹©ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * åŒæ­¥å‘é€çŸ­ä¿¡ * &lt;p&gt; * å‚æ•°1ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID * å‚æ•°2ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot; * å‚æ•°3ï¼šMapï¼Œkeyå¯¹åº”æ¨¡æ¿ä¸­çš„å‚æ•°åï¼Œvalueå¯¹åº”å€¼ï¼ˆè¿™é‡Œæ˜¯ä½¿ç”¨Jacksonæ¥åºåˆ—åŒ–ï¼‰ * &lt;/p&gt; */@Testpublic void sendSync() &#123; SmsResponse smsResponse = sendService.sendSync(TEMPLATE_ID, PHONE_NUMBER, MAP); Assert.assertTrue(smsResponse.isSuccess());&#125;/** * åŒæ­¥å‘é€çŸ­ä¿¡ * &lt;p&gt; * å‚æ•°1ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID * å‚æ•°2ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot; * å‚æ•°3ï¼šè¦å‘é€çš„çŸ­ä¿¡å†™å…¥å€¼ï¼Œä½ å¯ä»¥è‡ªå·±è¿›è¡Œjsonçš„æ‹¼è£…ã€‚æ³¨æ„è¦è¿›è¡Œjsonçš„è½¬ä¹‰ï¼Œä¾‹å¦‚ï¼š&quot;&#123;\\&quot;code\\&quot;:\\&quot;112233\\&quot;&#125;&quot; * &lt;/p&gt; */@Testpublic void sendSync1() &#123; SmsResponse smsResponse = sendService.sendSync(TEMPLATE_ID, PHONE_NUMBER, &quot;&#123;\\&quot;code\\&quot;:\\&quot;112233\\&quot;&#125;&quot;); Assert.assertTrue(smsResponse.isSuccess());&#125;/** * åŒæ­¥å‘é€çŸ­ä¿¡ * &lt;p&gt; * å‚æ•°1ï¼šçŸ­ä¿¡ç­¾åï¼Œé€‚ç”¨äºåŒä¸€æ¨¡æ¿éœ€è¦æœ‰ä¸åŒçŸ­ä¿¡ç­¾åçš„ * å‚æ•°2ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID * å‚æ•°3ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot; * å‚æ•°4ï¼šMapï¼Œkeyå¯¹åº”æ¨¡æ¿ä¸­çš„å‚æ•°åï¼Œvalueå¯¹åº”å€¼ï¼ˆè¿™é‡Œæ˜¯ä½¿ç”¨Jacksonæ¥åºåˆ—åŒ–ï¼‰ * &lt;/p&gt; */@Testpublic void sendSync2() &#123; SmsResponse smsResponse = sendService.sendSync(SIGN_NAME, TEMPLATE_ID, PHONE_NUMBER, MAP); Assert.assertTrue(smsResponse.isSuccess());&#125;/** * åŒæ­¥å‘é€çŸ­ä¿¡ * &lt;p&gt; * å‚æ•°1ï¼šçŸ­ä¿¡ç­¾åï¼Œé€‚ç”¨äºåŒä¸€æ¨¡æ¿éœ€è¦æœ‰ä¸åŒçŸ­ä¿¡ç­¾åçš„ * å‚æ•°2ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID * å‚æ•°3ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot; * å‚æ•°4ï¼šè¦å‘é€çš„çŸ­ä¿¡å†™å…¥å€¼ï¼Œä½ å¯ä»¥è‡ªå·±è¿›è¡Œjsonçš„æ‹¼è£…ã€‚æ³¨æ„è¦è¿›è¡Œjsonçš„è½¬ä¹‰ï¼Œä¾‹å¦‚ï¼š&quot;&#123;\\&quot;code\\&quot;:\\&quot;112233\\&quot;&#125;&quot; * &lt;/p&gt; */@Testpublic void sendSync3() &#123; SmsResponse smsResponse = sendService.sendSync(SIGN_NAME, TEMPLATE_ID, PHONE_NUMBER, &quot;&#123;\\&quot;code\\&quot;:\\&quot;112233\\&quot;&#125;&quot;); Assert.assertTrue(smsResponse.isSuccess());&#125; æœ€åä¸€ä¸ªæä¾›äº†ä¸€ä¸ªå‚æ•°å¯¹è±¡æ¥å®šä¹‰çŸ­ä¿¡å‘é€è¯·æ±‚ï¼Œå¦‚æœä¸å«Œéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ 12345678910111213141516171819202122232425262728293031323334353637/** * é˜¿é‡Œäº‘çŸ­ä¿¡è¯·æ±‚ä½“ * * @author gaochen * @date 2019/6/6 */@Datapublic class SmsRequest &#123; /** * æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç ã€‚ä»¥è‹±æ–‡é€—å·ï¼ˆ,ï¼‰åˆ†éš”ã€‚ */ private String phoneNumbers; /** * çŸ­ä¿¡ç­¾ååç§°ã€‚è¯·åœ¨æ§åˆ¶å°ç­¾åç®¡ç†é¡µé¢ç­¾ååç§°ä¸€åˆ—æŸ¥çœ‹ã€‚ */ private String signName; /** * çŸ­ä¿¡æ¨¡æ¿IDï¼Œå‰ç¼€ä¸ºSMS_ */ private Integer templateId; /** * é˜¿é‡Œäº‘çŸ­ä¿¡å†…å®¹,key:çŸ­ä¿¡æ¨¡æ¿ä¸­çš„å­—æ®µåï¼Œvalueï¼šçŸ­ä¿¡æ¨¡æ¿å­—æ®µå¯¹åº”å€¼ * ä½¿ç”¨æ­¤å­—æ®µéœ€è¦&#123;@link com.fasterxml.jackson.databind.ObjectMapper&#125; */ private Map&lt;String, String&gt; params; /** * json str of &#123;@link #getParams()&#125; * ä½¿ç”¨æ­¤å­—æ®µè¯·è®¾ç½®paramsä¸ºNull */ private String paramStr;&#125; ä½¿ç”¨ï¼š 123456789@Testpublic void sendSync4() &#123; SmsRequest smsRequest = new SmsRequest(); smsRequest.setPhoneNumbers(PHONE_NUMBER); smsRequest.setTemplateId(TEMPLATE_ID); smsRequest.setParams(MAP); SmsResponse smsResponse = sendService.sendSync(smsRequest); Assert.assertTrue(smsResponse.isSuccess());&#125; å¼‚æ­¥å‘é€çŸ­ä¿¡ è€ƒè™‘åˆ°å‘çŸ­ä¿¡çš„éœ€æ±‚ï¼Œä¸€èˆ¬æ¥è¯´éƒ½éœ€è¦å¼‚æ­¥åŠ æŒï¼Œå¯¹ä»¥ä¸Š5ç§æ–¹æ³•åˆ†åˆ«æä¾›äº†å¼‚æ­¥æ¥å£sendAsyncï¼Œä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä½ å¯ä»¥å¼‚æ­¥å¤„ç†çŸ­ä¿¡å‘é€è¿”å›å€¼ã€‚ 12345678CompletableFuture&lt;SmsResponse&gt; smsResponse = sendService.sendAsync(TEMPLATE_ID, PHONE_NUMBER, MAP);smsResponse.thenAcceptAsync(sr -&gt; &#123; if (sr.isSuccess()) &#123; System.out.println(&quot;å‘çŸ­ä¿¡æˆåŠŸ&quot;); &#125; else &#123; System.out.println(&quot;å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡†å¤‡é‡è¯•æ­¤æ¬¡çŸ­ä¿¡&quot;); &#125;&#125;); é«˜çº§ä½¿ç”¨é™¤äº†ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•å‘é€çŸ­ä¿¡å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹çš„IAcsClientæ¥å‘é€çŸ­ä¿¡ï¼Œå¦‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package io.github.gcdd1993.demo;import com.aliyuncs.CommonRequest;import com.aliyuncs.IAcsClient;import com.aliyuncs.request;import com.aliyuncs.CommonResponse;import com.aliyuncs.exceptions.ClientException;import com.aliyuncs.http.MethodType;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.databind.ObjectMapper;import io.github.gcdd1993.alisms.domain.SmsRequest;import io.github.gcdd1993.alisms.domain.SmsResponse;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;/** * TODO * * @author gaochen * @date 2019/6/8 */@Servicepublic class SendService &#123; @Autowired private IAcsClient acsClient; public SmsResponse sendSync() &#123; try &#123; CommonRequest request = new CommonRequest(); request.setMethod(MethodType.POST); request.setDomain(&quot;dysmsapi.aliyuncs.com&quot;); request.setVersion(&quot;2017-05-25&quot;); request.setAction(&quot;SendSms&quot;); request.putQueryParameter(&quot;RegionId&quot;, &quot;region&quot;); request.putQueryParameter(&quot;PhoneNumbers&quot;, &quot;1771636783&quot;); request.putQueryParameter(&quot;SignName&quot;, &quot;SignName&quot;); request.putQueryParameter(&quot;TemplateCode&quot;, &quot;SMS_12345678&quot;); request.putQueryParameter(&quot;TemplateParam&quot;, &quot;&#123;\\&quot;code\\&quot;:\\&quot;112233\\&quot;&#125;&quot;); CommonResponse commonResponse = acsClient.getCommonResponse(request); return SmsResponse.SmsResponseBuilder.build(commonResponse); &#125; catch (ClientException e) &#123; log.error(&quot;send msg error.&quot;, e); return SmsResponse.SmsResponseBuilder.buildFail(e.getMessage()); &#125; catch (JsonProcessingException e) &#123; log.error(&quot;write json failed.&quot;, e); return SmsResponse.SmsResponseBuilder.buildFail(&quot;çŸ­ä¿¡å‚æ•°åœ¨jsonåºåˆ—åŒ–æ—¶å‡ºé”™&quot;); &#125; &#125;&#125; LicensesThe Apache License, Version 2.0 IssuesIssues Welcome æ”¯æŒ Click Github to star, Thanks! æ›´å¤šå‚è€ƒé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡APIå‚è€ƒ","tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"https://gcdd1993.github.io/tags/Spring-Boot/"}]},{"title":"åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦XXL-JOBåˆä½“éªŒ","date":"2019-06-05T05:19:33.000Z","path":"p/29085/","text":"ç®€ä»‹XXL-JOBæ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚ å®˜æ–¹æ–‡æ¡£å¾ˆå®Œå–„ï¼Œä¸å¤šèµ˜è¿°ã€‚æœ¬æ–‡ä¸»è¦æ˜¯æ­å»ºXXL-JOBå’Œç®€å•ä½¿ç”¨çš„è®°å½•ã€‚ æ­å»ºxxl-job-adminç®¡ç†ç«¯è¿è¡Œç¯å¢ƒ Ubuntu 16.04 64ä½ Mysql 5.7 å®‰è£…Mysql1234567891011121314$ sudo apt-get update$ sudo apt-get install mysql-server## è®¾ç½®mysqlï¼Œä¸»è¦æ˜¯å®‰å…¨æ–¹é¢çš„ï¼Œå¯†ç ç­–ç•¥ç­‰$ mysql_secure_installation## é…ç½®è¿œç¨‹è®¿é—®$ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnfbind-address = 0.0.0.0$ sudo service mysql restart$ sudo service mysql statusâ— mysql.service - MySQL Community Server Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled) Active: active (running) since Wed 2019-06-05 13:23:41 HKT; 45s ago... åˆ›å»ºæ•°æ®åº“12$ mysql -u root -pmysql&gt; CREATE database if NOT EXISTS `xxl-job` default character set utf8 collate utf8_general_ci; åˆ›å»ºç”¨æˆ·123$ mysql -u root -pmysql&gt; CREATE USER &#x27;xxl-job&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;xxlJob2019@&#x27;;mysql&gt; GRANT ALL PRIVILEGES ON `xxl-job`.* TO &#x27;xxl-job&#x27;@&#x27;%&#x27;; æœ¬åœ°æµ‹è¯•xxl-job-adminæ‹‰å–æœ€æ–°æºç 12$ git clone git@github.com:xuxueli/xxl-job.git$ cd xxl-job å¯¼å…¥é¡¹ç›®æˆ‘æ¯”è¾ƒç†Ÿæ‚‰Ideaå¼€å‘å·¥å…·ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨Ideaçš„Gradleé¡¹ç›®è¿›è¡Œæ¼”ç¤ºã€‚ æ‰“å¼€xxl-jobï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ æµ‹è¯•é¡¹ç›®æ‰“å¼€xxl-job-admin/resources/application.propertiesï¼Œä¿®æ”¹mysqlè¿æ¥ä¿¡æ¯ 1234### xxl-job, datasourcespring.datasource.url=jdbc:mysql://192.168.32.129:3306/xxl-job?Unicode=true&amp;characterEncoding=UTF-8spring.datasource.username=xxl-jobspring.datasource.password=xxlJob2019@ ä½¿ç”¨/xxl-job/doc/db/tables_xxl_job.sqlåˆå§‹åŒ–æ•°æ®åº“ï¼Œåˆå§‹åŒ–å®Œåº”è¯¥å¦‚ä¸‹å›¾ å‡†å¤‡å°±ç»ªåï¼Œå°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ï¼Œç„¶åæ‰“å¼€åœ°å€http://localhost:8080/xxl-job-adminå°†ä¼šçœ‹åˆ°é¦–é¡µ éƒ¨ç½²æ‰“åŒ…è°ƒåº¦ä¸­å¿ƒ12345678910111213141516171819$ cd /xxl-job$ mvn install...[INFO] xxl-job ............................................ SUCCESS [ 0.513 s][INFO] xxl-job-core ....................................... SUCCESS [ 4.258 s][INFO] xxl-job-admin ...................................... SUCCESS [ 5.525 s][INFO] xxl-job-executor-samples ........................... SUCCESS [ 0.016 s][INFO] xxl-job-executor-sample-spring ..................... SUCCESS [ 2.188 s][INFO] xxl-job-executor-sample-springboot ................. SUCCESS [ 0.892 s][INFO] xxl-job-executor-sample-jfinal ..................... SUCCESS [ 1.753 s][INFO] xxl-job-executor-sample-nutz ....................... SUCCESS [ 1.316 s][INFO] xxl-job-executor-sample-frameless .................. SUCCESS [ 0.358 s][INFO] xxl-job-executor-sample-jboot ...................... SUCCESS [ 1.279 s][INFO] ------------------------------------------------------------------------[INFO] BUILD SUCCESS[INFO] ------------------------------------------------------------------------[INFO] Total time: 18.549 s[INFO] Finished at: 2019-06-05T14:40:25+08:00[INFO] ------------------------------------------------------------------------ çœ‹åˆ°ä»¥ä¸Šä¿¡æ¯ï¼Œè¯´æ˜æˆ‘ä»¬æ‰“åŒ…æˆåŠŸäº†ï¼Œåœ¨/xxl-job/xxl-job-adminç›®å½•ä¸‹ä¼šå­˜åœ¨jaræ–‡ä»¶ï¼šxxl-job-admin-2.1.0-SNAPSHOT.jar éƒ¨ç½²åˆ°æœåŠ¡å™¨12345678910111213141516171819202122232425262728293031323334$ sudo apt install openjdk-8-jdk$ java -versionopenjdk version &quot;1.8.0_212&quot;OpenJDK Runtime Environment (build 1.8.0_212-8u212-b03-0ubuntu1.16.04.1-b03)OpenJDK 64-Bit Server VM (build 25.212-b03, mixed mode)$ sudo mkdir -p /data/xxl-job$ sudo cd /data/xxl-job## ä¸Šä¼ æˆ‘ä»¬æ‰“åŒ…å¥½çš„jarè‡³æ­¤ç›®å½•ï¼Œå¹¶æ·»åŠ è½¯è¿æ¥$ sudo ln -s xxl-job-admin-2.1.0-SNAPSHOT.jar current.jar## æ³¨å†Œä¸ºsystemæœåŠ¡ï¼Œå¯ä»¥è¾¾åˆ°å¼‚å¸¸é‡å¯ï¼Œå¼€æœºè‡ªå¯ç­‰ç›®çš„$ sudo vim /etc/systemd/system/xxl-job.service[Unit]Description=xxl-job Service DaemonAfter=mysql.service[Service]Environment=&quot;JAVA_OPTS= -Xmx1024m -Xms1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:NewRatio=3 -Dserver.port=8081&quot;# javaè¦å†™ç»å¯¹è·¯å¾„ExecStart=/usr/local/jdk/bin/java -jar /data/xxl-job/current.jarRestart=alwaysWorkingDirectory=/data/xxl-job/[Install]WantedBy=multi-user.target$ sudo systemctl enable xxl-job.service$ sudo service xxl-job start$ sudo service xxl-job statusâ— xxl-job.service - xxl-job Service Daemon Loaded: loaded (/etc/systemd/system/xxl-job.service; enabled; vendor preset: enabled) Active: active (running) since Thu 2019-07-18 18:19:08 CST; 2min 19s ago Main PID: 27572 (java) CGroup: /system.slice/xxl-job.service â””â”€27572 /usr/local/jdk/bin/java -jar /data/xxl-job/current.jar æˆ‘ä»¬è®¿é—®ä¸€ä¸‹http://192.168.32.129:8080/xxl-job-adminï¼š æµ‹è¯•ä»»åŠ¡è°ƒåº¦ä»¥ä¸Šï¼Œæˆ‘ä»¬çš„ä»»åŠ¡è°ƒåº¦ç®¡ç†ç«¯å·²ç»æ­å»ºå®Œæˆï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸‹ä»»åŠ¡è°ƒåº¦ã€‚ ç›´æ¥ä½¿ç”¨è‡ªå¸¦çš„SpringBootæµ‹è¯•é¡¹ç›®xxl-job-executor-sample-springbootè¿›è¡Œæµ‹è¯•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ 1xxl-job-executor-sample-springboot=http://192.168.32.129:8080/xxl-job-admin è‡ªå®šä¹‰ä»»åŠ¡ç¼–å†™ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œæ‰“å°100æ¬¡å½“å‰åºåˆ— 12345678910111213141516171819202122232425262728package com.xxl.job.executor.service.jobhandler;import com.xxl.job.core.biz.model.ReturnT;import com.xxl.job.core.handler.IJobHandler;import com.xxl.job.core.handler.annotation.JobHandler;import com.xxl.job.core.log.XxlJobLogger;import org.springframework.stereotype.Component;import java.util.concurrent.TimeUnit;/** * TODO * * @author gaochen * @date 2019/6/5 */@JobHandler(value=&quot;gcddJobHandler&quot;)@Componentpublic class GcddJobHandler extends IJobHandler &#123; @Override public ReturnT&lt;String&gt; execute(String param) throws Exception &#123; for (int i = 0; i &lt; 100; i++) &#123; XxlJobLogger.log(&quot;XXL-JOB, print &quot; + i); TimeUnit.SECONDS.sleep(1); &#125; return SUCCESS; &#125;&#125; å¯åŠ¨æ‰§è¡Œå™¨ç„¶åå¯åŠ¨æ‰§è¡Œå™¨ï¼Œå¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬ä¼šå‘ç°ç®¡ç†é¡µé¢çš„æ‰§è¡Œå™¨åˆ—è¡¨ä¼šå¤šå‡ºæˆ‘ä»¬åˆšæ‰å¯åŠ¨çš„æ‰§è¡Œå™¨ æ·»åŠ ä»»åŠ¡ æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿— å¯ä»¥çœ‹åˆ°ï¼Œä»»åŠ¡å·²ç»æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ’æ‰§è¡ŒæˆåŠŸäº†ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚ ç»“è¯­æƒ³è¦äº†è§£æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·è®¿é—®xxl-jobå®˜ç½‘","tags":[{"name":"xxl-job","slug":"xxl-job","permalink":"https://gcdd1993.github.io/tags/xxl-job/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://gcdd1993.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"æ‰‹å†™IOCå®¹å™¨","date":"2019-06-02T11:59:52.000Z","path":"p/11305/","text":"å‰è¨€æœ¬æ–‡æ˜¯ä¸ºäº†å­¦ä¹ Spring IOCå®¹å™¨çš„æ‰§è¡Œè¿‡ç¨‹è€Œå†™ï¼Œä¸èƒ½å®Œå…¨ä»£è¡¨Spring IOCå®¹å™¨ï¼Œåªæ˜¯ç®€å•å®ç°äº†å®¹å™¨çš„ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬åŠŸèƒ½ï¼Œæ— æ³•ç”¨äºç”Ÿäº§ï¼Œåªèƒ½è¯´å¯¹ç†è§£Springå®¹å™¨èƒ½å¤Ÿèµ·åˆ°ä¸€å®šçš„ä½œç”¨ã€‚ å¼€å§‹åˆ›å»ºé¡¹ç›®åˆ›å»ºGradleé¡¹ç›®ï¼Œå¹¶ä¿®æ”¹build.gradle 1234567891011121314151617plugins &#123; id &#x27;java&#x27; id &quot;io.franzbecker.gradle-lombok&quot; version &quot;3.1.0&quot;&#125;group &#x27;io.github.gcdd1993&#x27;version &#x27;1.0-SNAPSHOT&#x27;sourceCompatibility = 1.8repositories &#123; mavenCentral()&#125;dependencies &#123; testCompile group: &#x27;junit&#x27;, name: &#x27;junit&#x27;, version: &#x27;4.12&#x27;&#125; åˆ›å»ºBeanFactoryBeanFactoryæ˜¯IOCä¸­ç”¨äºå­˜æ”¾beanå®ä¾‹ä»¥åŠè·å–beançš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯getBeanä»¥åŠgetBeançš„é‡è½½æ–¹æ³•ï¼Œè¿™é‡Œç®€å•å®ç°ä¸¤ä¸ªgetBeançš„æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728package io.github.gcdd1993.ioc.bean;/** * bean factory interface * * @author gaochen * @date 2019/6/2 */public interface BeanFactory &#123; /** * é€šè¿‡beanåç§°è·å–bean * * @param name beanåç§° * @return bean */ Object getBean(String name); /** * é€šè¿‡beanç±»å‹è·å–bean * * @param tClass beanç±»å‹ * @param &lt;T&gt; æ³›å‹T * @return bean */ &lt;T&gt; T getBean(Class&lt;T&gt; tClass);&#125; åˆ›å»ºApplicationContextä¸Šä¸‹æ–‡ApplicationContextï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå®é™…å°±æ˜¯Springå®¹å™¨æœ¬èº«äº†ã€‚ æˆ‘ä»¬åˆ›å»ºApplicationContextç±»ï¼Œå¹¶å®ç°BeanFactoryæ¥å£ã€‚ 12public class ApplicationContext implements BeanFactory &#123;&#125; getBeanæ–¹æ³•æ—¢ç„¶è¯´æ˜¯å®¹å™¨ï¼Œé‚£è‚¯å®šè¦æœ‰åœ°æ–¹è£…æˆ‘ä»¬çš„beanå®ä¾‹å§ï¼Œä½¿ç”¨ä¸¤ä¸ªMapä½œä¸ºå®¹å™¨ã€‚ 123456789/** * æŒ‰ç…§beanNameåˆ†ç»„ */private final Map&lt;String, Object&gt; beanByNameMap = new ConcurrentHashMap&lt;&gt;(256);/** * æŒ‰ç…§beanClassåˆ†ç»„ */private final Map&lt;Class&lt;?&gt;, Object&gt; beanByClassMap = new ConcurrentHashMap&lt;&gt;(256); ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®Œæˆæˆ‘ä»¬çš„getBeanæ–¹æ³•ã€‚ 123456789@Overridepublic Object getBean(String name) &#123; return beanByNameMap.get(name);&#125;@Overridepublic &lt;T&gt; T getBean(Class&lt;T&gt; tClass) &#123; return tClass.cast(beanByClassMap.get(tClass));&#125; ç›´æ¥ä»Mapä¸­è·å–beanå®ä¾‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå½“ç„¶äº†ï¼Œåœ¨çœŸå®çš„Springå®¹å™¨ä¸­ï¼Œæ˜¯ä¸ä¼šè¿™ä¹ˆç®€å•å•¦ï¼Œä¸è¿‡æˆ‘ä»¬è¿™æ¬¡æ˜¯è¦åŒ–ç¹ä¸ºç®€ï¼Œç†è§£IOCå®¹å™¨ã€‚ æ„é€ å™¨Springæä¾›äº†@ComponentScanæ¥æ‰«æåŒ…ä¸‹çš„Componentï¼Œæˆ‘ä»¬ä¸ºäº†ç®€ä¾¿ï¼Œç›´æ¥åœ¨æ„é€ å™¨ä¸­æŒ‡å®šè¦æ‰«æçš„åŒ…ã€‚ 123456789101112131415private final Set&lt;String&gt; basePackages;/** * é»˜è®¤æ„é€ å™¨ï¼Œé»˜è®¤æ‰«æå½“å‰æ‰€åœ¨åŒ… */public ApplicationContext() &#123; this(new HashSet&lt;&gt;(Collections.singletonList(ApplicationContext.class.getPackage().getName())));&#125;/** * å…¨å‚æ„é€ å™¨ * @param basePackages æ‰«æçš„åŒ…ååˆ—è¡¨ */public ApplicationContext(Set&lt;String&gt; basePackages) &#123; this.basePackages = basePackages;&#125; refreshæ–¹æ³•refreshçš„è¿‡ç¨‹åŸºæœ¬æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ¥èµ° æ‰«ææŒ‡å®šçš„åŒ…ä¸‹æ‰€æœ‰å¸¦@Beanæ³¨è§£ï¼ˆSpringä¸­æ˜¯@Componentæ³¨è§£ï¼‰çš„ç±»ã€‚ 12345678910List&lt;Class&gt; beanClasses = PackageScanner.findClassesWithAnnotation(packageName, Bean.class);System.out.println(&quot;scan classes with Bean annotation : &quot; + beanClasses.toString());for (Class beanClass : beanClasses) &#123; try &#123; createBean(beanClass); &#125; catch (ClassNotFoundException | NoSuchMethodException | IllegalAccessException | InvocationTargetException | InstantiationException e) &#123; e.printStackTrace(); &#125;&#125; éå†ç±»ï¼Œè·å–ç±»çš„æ„é€ å™¨ä»¥åŠæ‰€æœ‰å­—æ®µã€‚ 123Constructor constructor = beanClass.getDeclaredConstructor();Object object = constructor.newInstance();Field[] fields = beanClass.getDeclaredFields(); åˆ¤æ–­å­—æ®µæ˜¯ä¾èµ–æ³¨å…¥çš„è¿˜æ˜¯æ™®é€šå­—æ®µã€‚ å¦‚æœæ˜¯æ™®é€šå­—æ®µï¼Œé€šè¿‡å­—æ®µç±»å‹åˆå§‹åŒ–è¯¥å­—æ®µï¼Œå¹¶å°è¯•ä»@Valueæ³¨è§£è·å–å€¼å¡ç»™å­—æ®µã€‚ 1234567Value value = field.getAnnotation(Value.class);if (value != null) &#123; // æ³¨å…¥ field.setAccessible(true); // éœ€è¦åšä¸€äº›ç±»å‹è½¬æ¢ï¼Œä»Stringè½¬ä¸ºå¯¹åº”çš„ç±»å‹ field.set(object, value.value());&#125; å¦‚æœæ˜¯ä¾èµ–æ³¨å…¥çš„å­—æ®µï¼Œå°è¯•ä»beanByClassMapä¸­è·å–å¯¹åº”çš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å…ˆè¦å»å®ä¾‹åŒ–è¯¥å­—æ®µå¯¹åº”çš„ç±»å‹ã€‚ 123456789101112131415161718192021Autowired autowired = field.getAnnotation(Autowired.class);if (autowired != null) &#123; // ä¾èµ–æ³¨å…¥ String name = autowired.name(); // æŒ‰ç…§åç§°æ³¨å…¥ Object diObj; if (!name.isEmpty()) &#123; diObj = beanByNameMap.get(name) == null ? createBean(name) : beanByNameMap.get(name); &#125; else &#123; // æŒ‰ç…§ç±»å‹æ³¨å…¥ Class&lt;?&gt; aClass = field.getType(); diObj = beanByClassMap.get(aClass) == null ? createBean(aClass) : beanByClassMap.get(aClass); &#125; // æ³¨å…¥ field.setAccessible(true); field.set(object, diObj);&#125; æµ‹è¯•æˆ‘ä»¬çš„IOCå®¹å™¨åˆ›å»ºAddress 123456789@Data@Beanpublic class Address &#123; @Value(&quot;2222&quot;) private String longitude; @Value(&quot;1111&quot;) private String latitude;&#125; åˆ›å»ºPersonå¹¶æ³¨å…¥Address 123456789101112@Data@Beanpublic class Person &#123; @Autowired private Address address; @Value(&quot;gaochen&quot;) private String name; @Value(&quot;27&quot;) private String age;&#125; åˆ›å»ºæµ‹è¯•ç±»ApplicationContextTest 12345678910111213141516public class ApplicationContextTest &#123; @Test public void refresh() &#123; Set&lt;String&gt; basePackages = new HashSet&lt;&gt;(1); basePackages.add(&quot;io.github.gcdd1993.ioc&quot;); ApplicationContext ctx = new ApplicationContext(basePackages); ctx.refresh(); Person person = ctx.getBean(Person.class); System.out.println(person); Object person1 = ctx.getBean(&quot;Person&quot;); System.out.println(person1); &#125;&#125; æ§åˆ¶å°å°†ä¼šè¾“å‡ºï¼š 1234scan classes with Bean annotation : [class io.github.gcdd1993.ioc.util.Address, class io.github.gcdd1993.ioc.util.Person]scan classes with Bean annotation : [class io.github.gcdd1993.ioc.util.Address, class io.github.gcdd1993.ioc.util.Person]Person(address=Address(longitude=2222, latitude=1111), name=gaochen, age=27)Person(address=Address(longitude=2222, latitude=1111), name=gaochen, age=27) å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸå°†Addresså®ä¾‹æ³¨å…¥åˆ°äº†Personå®ä¾‹ä¸­ï¼Œå¹¶ä¸”å°†å®ƒä»¬å­˜å‚¨åœ¨äº†æˆ‘ä»¬è‡ªå·±çš„IOCå®¹å™¨ä¸­ã€‚å…¶å®ï¼ŒSpringå®¹å™¨çš„åŸç†å¤§è‡´å°±æ˜¯å¦‚æ­¤ï¼Œåªä¸è¿‡ä¸ºäº†åº”å¯¹ä¼ä¸šçº§å¼€å‘ï¼Œæä¾›äº†å¾ˆå¤šä¾¿æ·çš„åŠŸèƒ½ï¼Œä¾‹å¦‚beançš„ä½œç”¨åŸŸã€beançš„è‡ªå®šä¹‰æ–¹æ³•ç­‰ç­‰ã€‚ è·å–æºç å®Œæ•´æºç å¯ä»¥åœ¨æˆ‘çš„githubä»“åº“è·å–ğŸ‘‰Simple-IOC-Container","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"ä½¿ç”¨Tesseract-Ocrè¯†åˆ«æ•°å­—","date":"2019-06-01T17:59:30.000Z","path":"p/5479/","text":"å‰è¨€Tesseract-Ocræ˜¯æˆ‘åœ¨ç¼–å†™çˆ¬è™«é¡¹ç›®ä¸­ï¼Œç”¨æ¥è¯†åˆ«å›¾ç‰‡ï¼ˆä¸æ˜¯éªŒè¯ç ï¼‰çš„æœ¬åœ°è§£å†³æ–¹æ¡ˆï¼ˆå› ä¸ºå®¢æˆ·ä¸æƒ³ä½¿ç”¨APIè¯†åˆ«ï¼Œå¤ªè´µï¼‰ï¼Œè¯†åˆ«ç‡ç›®å‰è¾¾åˆ°äº†100%ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“äº†å¾—ï¼Œå½“ç„¶äº†ï¼Œè¿™å–å†³äºä½¿ç”¨çš„traineddataã€‚ ç®€ä»‹ Tesseractæœ€åˆæ˜¯åœ¨1985å¹´è‡³1994å¹´é—´åœ¨Hewlett-Packard Laboratories Bristolå’ŒGreeley Coloradoçš„Hewlett-Packard Coå¼€å‘çš„ï¼Œ1996å¹´è¿›è¡Œäº†ä¸€äº›æ›´æ”¹ï¼Œç§»æ¤åˆ°Windowsï¼Œå¹¶ä¸”éšç€C++åœ¨1998å¹´å…´èµ·ã€‚2005å¹´Tesseractç”±æƒ æ™®å¼€æºï¼Œç„¶åä»2006å¹´è‡³ä»Šï¼Œç”±è°·æ­Œç»§ç»­å¼€å‘ã€‚ Tesseract-Ocrå¹¶ä¸æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ŒåŒ…å«äº†ä¸€ä¸ªOCRå¼•æ“ã€libtesseractã€‘å’Œä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº ã€tesseractã€‘ã€‚Tesseract 4å¢åŠ äº†ä¸€ä¸ªåŸºäºOCRå¼•æ“çš„æ–°ç¥ç»ç½‘ç»œï¼ˆLSTMï¼‰ï¼Œè¯¥å¼•æ“ä¸“æ³¨äºè¡Œçº§è¯†åˆ«ï¼Œä½†ä»ç„¶æ”¯æŒTesseract 3çš„ä¼ ç»ŸTesseract OCRå¼•æ“ï¼Œè¯¥å¼•æ“é€šè¿‡è¯†åˆ«å­—ç¬¦æ¨¡å¼æ¥å·¥ä½œã€‚ è¦å¯ç”¨ä¸Tesseract 3çš„å…¼å®¹æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨Legacy OCR Engineæ¨¡å¼ï¼ˆâ€“oem 0ï¼‰ã€‚å®ƒè¿˜éœ€è¦æ”¯æŒä¼ ç»Ÿå¼•æ“çš„traineddataï¼ˆè®­ç»ƒå¥½çš„æ•°æ®æ–‡ä»¶ï¼‰ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥ä»tessdataå­˜å‚¨åº“çš„æ–‡ä»¶è·å–ã€‚ Tesseractæ”¯æŒè¯†åˆ«unicodeï¼ˆUTF-8ï¼‰ï¼Œå¯ä»¥â€œå¼€ç®±å³ç”¨â€è¯†åˆ«100å¤šç§è¯­è¨€ã€‚ Tesseractæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼šçº¯æ–‡æœ¬ï¼ŒhOCRï¼ˆHTMLï¼‰ï¼ŒPDFï¼ŒTSVã€‚ä¸»åˆ†æ”¯è¿˜å…·æœ‰ALTOï¼ˆXMLï¼‰è¾“å‡ºçš„å®éªŒæ”¯æŒã€‚ â­ï¸â­ï¸â­ï¸ å…·ä½“ä»‹ç»å¯ä»¥ä¸Štesseract-wikiæŸ¥çœ‹ã€‚ åœ¨Javaä¸Šä½¿ç”¨åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å¼•å…¥JaråŒ…Maven123456&lt;!-- https://mvnrepository.com/artifact/net.sourceforge.tess4j/tess4j --&gt;&lt;dependency&gt; &lt;groupId&gt;net.sourceforge.tess4j&lt;/groupId&gt; &lt;artifactId&gt;tess4j&lt;/artifactId&gt; &lt;version&gt;4.3.1&lt;/version&gt;&lt;/dependency&gt; Gradle1compile &#x27;net.sourceforge.tess4j:tess4j:4.3.1&#x27; å¯¼å…¥traineddatatraineddataæ˜¯ä½¿ç”¨Tesseract-Ocrè®­ç»ƒå¥½çš„æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è¿™äº›æ–‡ä»¶ä½ å¯ä»¥å»tessdataå­˜å‚¨åº“æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥å»è°·æ­Œæœç´¢ï¼Œå½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±è®­ç»ƒğŸ˜‚ã€‚ traineddataé€šå¸¸ä»¥*.traineddataå‘½åï¼Œå…¶ä¸­*æŒ‡çš„æ˜¯æ”¯æŒçš„è¯­è¨€ç±»å‹ã€‚åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°4.0.0ç‰ˆæœ¬æ”¯æŒçš„è¯­è¨€ä»¥åŠtraineddataåˆ—è¡¨ã€‚ è¿™æ¬¡ï¼Œæˆ‘ä»¬é€‰æ‹©eng.traineddataè¿›è¡Œæµ‹è¯•ã€‚ä¸‹è½½eng.traineddataæ”¾å…¥/resources/traineddataç›®å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¼–å†™æµ‹è¯•ä»£ç åˆå§‹åŒ–Tesseractå¼•æ“1234567891011public class TesseractTest &#123; private ITesseract tesseract; @Before public void init() &#123; tesseract = new Tesseract(); System.out.println(&quot;tesseract init done...&quot;); &#125;&#125; å®é™…ä¸Šï¼Œä¸Šé¢çš„ä»£ç æ˜¯æ— æ³•æ­£å¸¸è¿è¡Œçš„ï¼Œå› ä¸ºæ‰¾ä¸åˆ°æŒ‡å®šè¯­è¨€ç‰ˆæœ¬çš„traineddataæ–‡ä»¶ã€‚ net.sourceforge.tess4j:tess4j:4.1.1æä¾›çš„APIå¹¶ä¸å¥½ï¼Œåœ¨Tesseractæ„é€ å‡½æ•°ä¸­ï¼Œæ²¡æœ‰æä¾›å¯é€‰å‚æ•°çš„æ„é€ å™¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class Tesseract implements ITesseract &#123; // Tesseractä½¿ç”¨çš„è¯­è¨€ç‰ˆæœ¬ï¼Œç”¨ä»¥é€‰æ‹©traineddata private String language = &quot;eng&quot;; // traineddataç›®å½•ï¼Œé‡Œé¢æ”¾*.traineddataæ•°æ®æ–‡ä»¶ private String datapath; // çœç•¥å…¶ä»–ä»£ç  ... public Tesseract() &#123; try &#123; // é»˜è®¤ä»ç³»ç»Ÿç¯å¢ƒå˜é‡è·å–traineddataç›®å½• datapath = System.getenv(&quot;TESSDATA_PREFIX&quot;); &#125; catch (Exception e) &#123; // ignore &#125; finally &#123; if (datapath == null) &#123; datapath = &quot;./&quot;; &#125; &#125; &#125; /** * Sets language for OCR. * * @param language the language code, which follows ISO 639-3 standard. */ @Override public void setLanguage(String language) &#123; this.language = language; &#125; /** * Sets path to &lt;code&gt;tessdata&lt;/code&gt;. * * @param datapath the tessdata path to set */ @Override public void setDatapath(String datapath) &#123; this.datapath = datapath; &#125; // çœç•¥å…¶ä»–ä»£ç  ...&#125; æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è®¾ç½®ç¯å¢ƒå˜é‡TESSDATA_PREFIXä¸ºæ•°æ®ç›®å½•ï¼Œæˆ–è€…é€šè¿‡Javaç¼–ç çš„æ–¹å¼æ¥è®¾ç½®ã€‚ 12tesseract.setLanguage(&quot;eng&quot;); // é»˜è®¤å°±æ˜¯engï¼Œä½ å¯ä»¥é€‰æ‹©å…¶ä»–langtesseract.setDatapath(TesseractTest.class.getResource(&quot;/traineddata&quot;).getPath().substring(1)); OCRè¯†åˆ«æµ‹è¯•tesseractæä¾›äº†ä¸€ç³»åˆ—doOcræ–¹æ³•çš„é‡è½½ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„è¿›è¡ŒOCRè¯†åˆ«ã€‚ 123456789101112131415String doOCR(File imageFile) throws TesseractException;String doOCR(File imageFile, Rectangle rect) throws TesseractException;String doOCR(BufferedImage bi) throws TesseractException;String doOCR(BufferedImage bi, Rectangle rect) throws TesseractException;String doOCR(List&lt;IIOImage&gt; imageList, Rectangle rect) throws TesseractException;String doOCR(List&lt;IIOImage&gt; imageList, String filename, Rectangle rect) throws TesseractException;String doOCR(int xsize, int ysize, ByteBuffer buf, Rectangle rect, int bpp) throws TesseractException;String doOCR(int xsize, int ysize, ByteBuffer buf, String filename, Rectangle rect, int bpp) throws TesseractException; å¯ä»¥çœ‹å‡ºï¼ŒdoOcræ–¹æ³•æ”¯æŒå¤šç§å›¾ç‰‡è¯†åˆ«æ–¹å¼ï¼Œå¦‚å›¾ç‰‡æ–‡ä»¶ã€å¤šä¸ªå›¾ç‰‡æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶å±€éƒ¨å¤„ç†ç­‰ç­‰æ–¹å¼ã€‚ ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬é€‰å–æœ€ç®€å•çš„å›¾ç‰‡æ–‡ä»¶æ–¹å¼æµ‹è¯•ã€‚ å›¾ç‰‡æ˜¯ä¸ªURLé“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤º 123456@Testpublic void testOcr() throws IOException, TesseractException &#123; BufferedImage image = ImageIO.read(new URL(&quot;http://static8.ziroom.com/phoenix/pc/images/price/aacd14fbc53a106c7f0f0d667535683as.png&quot;)); String ocr = tesseract.doOCR(image); System.out.println(&quot;ocr result : &quot; + ocr);&#125; æ§åˆ¶å°è¾“å‡ºï¼š 12tesseract init done...ocr result : 2710386495 è¯†åˆ«å‡†ç¡®ç‡ï¼Œä¸»è¦åœ¨äºä½ é€‰æ‹©çš„è®­ç»ƒæ•°æ®æ–‡ä»¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯æ•°æ®æ–‡ä»¶æ˜¯è¿™ä¸ªï¼Œå¯¹äºæ•°å­—çš„å‡†ç¡®ç‡åŸºæœ¬ä¸Šæ˜¯100%ã€‚ å¼‚å¸¸å¦‚æœä½ é­é‡Invalid memory accesså¼‚å¸¸ï¼Œè¿™æ˜¯ç”±äºæ‰¾ä¸åˆ°å¯¹åº”langçš„*.traineddataæ–‡ä»¶ï¼Œè¯·ä¿®æ”¹languageå’Œdatapathã€‚ 1234567891011121314Invalid memory accessjava.lang.Error: Invalid memory access at com.sun.jna.Native.invokePointer(Native Method) at com.sun.jna.Function.invokePointer(Function.java:470) at com.sun.jna.Function.invoke(Function.java:404) at com.sun.jna.Function.invoke(Function.java:315) at com.sun.jna.Library$Handler.invoke(Library.java:212) at com.sun.proxy.$Proxy9.TessBaseAPIGetUTF8Text(Unknown Source) at net.sourceforge.tess4j.Tesseract.getOCRText(Tesseract.java:495) at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:321) at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:293) at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:274) at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:258) ... è®­ç»ƒå·¥å…·https://github.com/tesseract-ocr/tesseract/wiki/AddOns è®­ç»ƒæ•°æ®ä»“åº“ tessdata_bestï¼šåŸºäºLSTMå¼•æ“çš„è®­ç»ƒæ•°æ®ï¼Œæœ€ä½³æœ€å‡†ç¡®çš„ tessdata_fastï¼šåŸºäºLSTMå¼•æ“çš„è®­ç»ƒæ•°æ®ï¼Œå¿«é€Ÿï¼ˆç²¾ç®€ï¼‰ç‰ˆæœ¬ tessdataï¼šæ”¯æŒåŒå¼•æ“ï¼ˆLSTMå’Œä¼ ç»Ÿå¼•æ“ï¼‰ï¼Œä½†LSTMè®­ç»ƒæ•°æ®ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ æ¨èä½¿ç”¨tessdata_bestï¼Œè™½ç„¶è¯†åˆ«é€Ÿåº¦ç›¸å¯¹äºtessdata_fastç¨æ…¢ï¼Œä½†æ˜¯å‡†ç¡®ç‡å¯ä»¥ä¿è¯ã€‚ å‚è€ƒtesseract-ocr-wiki","tags":[{"name":"Tesseract-Ocr","slug":"Tesseract-Ocr","permalink":"https://gcdd1993.github.io/tags/Tesseract-Ocr/"}]},{"title":"ç†è§£ä¸€è‡´æ€§Hashç®—æ³•","date":"2019-05-29T09:13:47.000Z","path":"p/61241/","text":"ç®€ä»‹ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨1997å¹´ç”±éº»çœç†å·¥å­¦é™¢çš„Kargerç­‰äººåœ¨è§£å†³åˆ†å¸ƒå¼Cacheä¸­æå‡ºçš„ï¼Œè®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³å› ç‰¹ç½‘ä¸­çš„çƒ­ç‚¹(Hot spot)é—®é¢˜ï¼Œåˆè¡·å’ŒCARPååˆ†ç±»ä¼¼ã€‚ä¸€è‡´æ€§å“ˆå¸Œä¿®æ­£äº†CARPä½¿ç”¨çš„ç®€å•å“ˆå¸Œç®—æ³•å¸¦æ¥çš„é—®é¢˜ï¼Œä½¿å¾—DHTå¯ä»¥åœ¨P2Pç¯å¢ƒä¸­çœŸæ­£å¾—åˆ°åº”ç”¨ã€‚ ç°åœ¨ä¸€è‡´æ€§hashç®—æ³•åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¹Ÿå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œç ”ç©¶è¿‡memcachedç¼“å­˜æ•°æ®åº“çš„äººéƒ½çŸ¥é“ï¼ŒmemcachedæœåŠ¡å™¨ç«¯æœ¬èº«ä¸æä¾›åˆ†å¸ƒå¼cacheçš„ä¸€è‡´æ€§ï¼Œè€Œæ˜¯ç”±å®¢æˆ·ç«¯æ¥æä¾›ï¼Œå…·ä½“åœ¨è®¡ç®—ä¸€è‡´æ€§hashæ—¶é‡‡ç”¨å¦‚ä¸‹æ­¥éª¤ï¼š é¦–å…ˆæ±‚å‡ºmemcachedæœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶é…ç½®åˆ°0ï½2^32çš„åœ†ï¼ˆcontinuumï¼‰ä¸Šã€‚ é‡‡ç”¨åŒæ ·çš„æ–¹æ³•æ±‚å‡ºå­˜å‚¨æ•°æ®çš„é”®çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ˜ å°„åˆ°ç›¸åŒçš„åœ†ä¸Šã€‚ ä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚å¦‚æœè¶…è¿‡2^32ä»ç„¶æ‰¾ä¸åˆ°æœåŠ¡å™¨ï¼Œå°±ä¼šä¿å­˜åˆ°ç¬¬ä¸€å°memcachedæœåŠ¡å™¨ä¸Šã€‚ ä»ä¸Šå›¾çš„çŠ¶æ€ä¸­æ·»åŠ ä¸€å°memcachedæœåŠ¡å™¨ã€‚ä½™æ•°åˆ†å¸ƒå¼ç®—æ³•ç”±äºä¿å­˜é”®çš„æœåŠ¡å™¨ä¼šå‘ç”Ÿå·¨å¤§å˜åŒ–è€Œå½±å“ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œä½†Consistent Hashingä¸­ï¼Œåªæœ‰åœ¨åœ†ï¼ˆcontinuumï¼‰ä¸Šå¢åŠ æœåŠ¡å™¨çš„åœ°ç‚¹é€†æ—¶é’ˆæ–¹å‘çš„ç¬¬ä¸€å°æœåŠ¡å™¨ä¸Šçš„é”®ä¼šå—åˆ°å½±å“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€è‡´æ€§Hashæ€§è´¨ è€ƒè™‘åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½å¤±æ•ˆï¼Œå¹¶ä¸”æ–°çš„èŠ‚ç‚¹å¾ˆå¯èƒ½åŠ¨æ€çš„å¢åŠ è¿›æ¥ï¼Œå¦‚ä½•ä¿è¯å½“ç³»ç»Ÿçš„èŠ‚ç‚¹æ•°ç›®å‘ç”Ÿå˜åŒ–æ—¶ä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›è‰¯å¥½çš„æœåŠ¡ï¼Œè¿™æ˜¯å€¼å¾—è€ƒè™‘çš„ã€‚ å°¤å…¶æ˜¯åœ¨è®¾è®¡åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿæ—¶ï¼Œå¦‚æœæŸå°æœåŠ¡å™¨å¤±æ•ˆï¼Œå¯¹äºæ•´ä¸ªç³»ç»Ÿæ¥è¯´å¦‚æœä¸é‡‡ç”¨åˆé€‚çš„ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆç¼“å­˜äºç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¯èƒ½ä¼šå¤±æ•ˆï¼ˆå³ç”±äºç³»ç»ŸèŠ‚ç‚¹æ•°ç›®å˜å°‘ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚æŸä¸€å¯¹è±¡æ—¶éœ€è¦é‡æ–°è®¡ç®—å…¶hashå€¼ï¼ˆé€šå¸¸ä¸ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ•°ç›®æœ‰å…³ï¼‰ï¼Œç”±äºhashå€¼å·²ç»æ”¹å˜ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½æ‰¾ä¸åˆ°ä¿å­˜è¯¥å¯¹è±¡çš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼‰ï¼Œå› æ­¤ä¸€è‡´æ€§hashå°±æ˜¾å¾—è‡³å…³é‡è¦ã€‚ è‰¯å¥½çš„åˆ†å¸ƒå¼cahceç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§hashç®—æ³•åº”è¯¥æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å¹³è¡¡æ€§(Balance) å¹³è¡¡æ€§æ˜¯æŒ‡å“ˆå¸Œçš„ç»“æœèƒ½å¤Ÿå°½å¯èƒ½åˆ†å¸ƒåˆ°æ‰€æœ‰çš„ç¼“å†²ä¸­å»ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ‰€æœ‰çš„ç¼“å†²ç©ºé—´éƒ½å¾—åˆ°åˆ©ç”¨ã€‚å¾ˆå¤šå“ˆå¸Œç®—æ³•éƒ½èƒ½å¤Ÿæ»¡è¶³è¿™ä¸€æ¡ä»¶ã€‚ å•è°ƒæ€§(Monotonicity) å•è°ƒæ€§æ˜¯æŒ‡å¦‚æœå·²ç»æœ‰ä¸€äº›å†…å®¹é€šè¿‡å“ˆå¸Œåˆ†æ´¾åˆ°äº†ç›¸åº”çš„ç¼“å†²ä¸­ï¼Œåˆæœ‰æ–°çš„ç¼“å†²åŒºåŠ å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆå“ˆå¸Œçš„ç»“æœåº”èƒ½å¤Ÿä¿è¯åŸæœ‰å·²åˆ†é…çš„å†…å®¹å¯ä»¥è¢«æ˜ å°„åˆ°æ–°çš„ç¼“å†²åŒºä¸­å»ï¼Œè€Œä¸ä¼šè¢«æ˜ å°„åˆ°æ—§çš„ç¼“å†²é›†åˆä¸­çš„å…¶ä»–ç¼“å†²åŒºã€‚ ç®€å•çš„å“ˆå¸Œç®—æ³•å¾€å¾€ä¸èƒ½æ»¡è¶³å•è°ƒæ€§çš„è¦æ±‚ï¼Œå¦‚æœ€ç®€å•çš„çº¿æ€§å“ˆå¸Œx = (ax + b) mod (P)ï¼Œåœ¨ä¸Šå¼ä¸­ï¼ŒPè¡¨ç¤ºå…¨éƒ¨ç¼“å†²çš„å¤§å°ã€‚ä¸éš¾çœ‹å‡ºï¼Œå½“ç¼“å†²å¤§å°å‘ç”Ÿå˜åŒ–æ—¶(ä»P1åˆ°P2)ï¼ŒåŸæ¥æ‰€æœ‰çš„å“ˆå¸Œç»“æœå‡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œä¸æ»¡è¶³å•è°ƒæ€§çš„è¦æ±‚ã€‚ å“ˆå¸Œç»“æœçš„å˜åŒ–æ„å‘³ç€å½“ç¼“å†²ç©ºé—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰çš„æ˜ å°„å…³ç³»éœ€è¦åœ¨ç³»ç»Ÿå†…å…¨éƒ¨æ›´æ–°ã€‚è€Œåœ¨P2Pç³»ç»Ÿå†…ï¼Œç¼“å†²çš„å˜åŒ–ç­‰ä»·äºPeeråŠ å…¥æˆ–é€€å‡ºç³»ç»Ÿï¼Œè¿™ä¸€æƒ…å†µåœ¨P2Pç³»ç»Ÿä¸­ä¼šé¢‘ç¹å‘ç”Ÿï¼Œå› æ­¤ä¼šå¸¦æ¥æå¤§è®¡ç®—å’Œä¼ è¾“è´Ÿè·ã€‚å•è°ƒæ€§å°±æ˜¯è¦æ±‚å“ˆå¸Œç®—æ³•èƒ½å¤Ÿåº”å¯¹è¿™ç§æƒ…å†µã€‚ åˆ†æ•£æ€§(Spread) åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»ˆç«¯æœ‰å¯èƒ½çœ‹ä¸åˆ°æ‰€æœ‰çš„ç¼“å†²ï¼Œè€Œæ˜¯åªèƒ½çœ‹åˆ°å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ å½“ç»ˆç«¯å¸Œæœ›é€šè¿‡å“ˆå¸Œè¿‡ç¨‹å°†å†…å®¹æ˜ å°„åˆ°ç¼“å†²ä¸Šæ—¶ï¼Œç”±äºä¸åŒç»ˆç«¯æ‰€è§çš„ç¼“å†²èŒƒå›´æœ‰å¯èƒ½ä¸åŒï¼Œä»è€Œå¯¼è‡´å“ˆå¸Œçš„ç»“æœä¸ä¸€è‡´ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„å†…å®¹è¢«ä¸åŒçš„ç»ˆç«¯æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ã€‚è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯åº”è¯¥é¿å…çš„ï¼Œå› ä¸ºå®ƒå¯¼è‡´ç›¸åŒå†…å®¹è¢«å­˜å‚¨åˆ°ä¸åŒç¼“å†²ä¸­å»ï¼Œé™ä½äº†ç³»ç»Ÿå­˜å‚¨çš„æ•ˆç‡ã€‚ åˆ†æ•£æ€§çš„å®šä¹‰å°±æ˜¯ä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„ä¸¥é‡ç¨‹åº¦ã€‚å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é¿å…ä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯å°½é‡é™ä½åˆ†æ•£æ€§ã€‚ è´Ÿè½½(Load) è´Ÿè½½é—®é¢˜å®é™…ä¸Šæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦çœ‹å¾…åˆ†æ•£æ€§é—®é¢˜ã€‚ æ—¢ç„¶ä¸åŒçš„ç»ˆç«¯å¯èƒ½å°†ç›¸åŒçš„å†…å®¹æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„ç¼“å†²åŒºè€Œè¨€ï¼Œä¹Ÿå¯èƒ½è¢«ä¸åŒçš„ç”¨æˆ·æ˜ å°„ä¸ºä¸åŒçš„å†…å®¹ã€‚ ä¸åˆ†æ•£æ€§ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯åº”å½“é¿å…çš„ï¼Œå› æ­¤å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é™ä½ç¼“å†²çš„è´Ÿè·ã€‚ å¹³æ»‘æ€§(Smoothness) å¹³æ»‘æ€§æ˜¯æŒ‡ç¼“å­˜æœåŠ¡å™¨çš„æ•°ç›®å¹³æ»‘æ”¹å˜å’Œç¼“å­˜å¯¹è±¡çš„å¹³æ»‘æ”¹å˜æ˜¯ä¸€è‡´çš„ã€‚ åŸç†åŸºæœ¬æ¦‚å¿µä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆConsistent Hashingï¼‰æœ€æ—©åœ¨è®ºæ–‡ã€ŠConsistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Webã€‹ä¸­è¢«æå‡ºã€‚ ç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§å“ˆå¸Œå°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-2^32-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç©ºé—´ç¯å¦‚ä¸‹ï¼š æ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ã€‚0å’Œ2^32-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆã€‚ ä¸‹ä¸€æ­¥å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨Hashè¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œå…·ä½“å¯ä»¥é€‰æ‹©æœåŠ¡å™¨çš„ipæˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ï¼Œè¿™é‡Œå‡è®¾å°†ä¸Šæ–‡ä¸­å››å°æœåŠ¡å™¨ä½¿ç”¨ipåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼šå°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬æœ‰Object Aã€Object Bã€Object Cã€Object Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼š æ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Šã€‚ å®¹é”™æ€§ç°å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚ å¯æ‰©å±•æ€§å¦‚æœåœ¨ç³»ç»Ÿä¸­å¢åŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœå¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯¹äºèŠ‚ç‚¹çš„å¢å‡éƒ½åªéœ€é‡å®šä½ç¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚ æ•°æ®å€¾æ–œé—®é¢˜å¦å¤–ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œé—®é¢˜ã€‚ä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼š æ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šã€‚ ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚ å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨ipæˆ–ä¸»æœºåçš„åé¢å¢åŠ ç¼–å·æ¥å®ç°ã€‚ä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š åŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚ ä»£ç æµ‹è¯•ä¸€è‡´æ€§Hashæ¨¡æ‹Ÿç±»ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119package com.example.demo.hash;import java.util.*;/** * ä¸€è‡´æ€§Hash * * @author gaochen * @date 2019/5/29 */public class ConsistentHash&lt;T&gt; &#123; /** * èŠ‚ç‚¹çš„å¤åˆ¶å› å­,å®é™…èŠ‚ç‚¹ä¸ªæ•° * numberOfReplicas */ private final int numberOfReplicas; /** * è™šæ‹ŸèŠ‚ç‚¹ä¸ªæ•°,å­˜å‚¨è™šæ‹ŸèŠ‚ç‚¹çš„hashå€¼åˆ°çœŸå®èŠ‚ç‚¹çš„æ˜ å°„ */ private final SortedMap&lt;Integer, T&gt; circle = new TreeMap&lt;&gt;(); public ConsistentHash(int numberOfReplicas, Collection&lt;T&gt; nodes) &#123; this.numberOfReplicas = numberOfReplicas; for (T node : nodes) &#123; add(node); &#125; &#125; /** * æ¨¡æ‹Ÿæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ * &lt;p&gt; * å¯¹äºä¸€ä¸ªå®é™…æœºå™¨èŠ‚ç‚¹ node, å¯¹åº” numberOfReplicas ä¸ªè™šæ‹ŸèŠ‚ç‚¹ * ä¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹(iä¸åŒ)æœ‰ä¸åŒçš„hashå€¼,ä½†éƒ½å¯¹åº”åŒä¸€ä¸ªå®é™…æœºå™¨node * è™šæ‹Ÿnodeä¸€èˆ¬æ˜¯å‡è¡¡åˆ†å¸ƒåœ¨ç¯ä¸Šçš„,æ•°æ®å­˜å‚¨åœ¨é¡ºæ—¶é’ˆæ–¹å‘çš„è™šæ‹Ÿnodeä¸Š * &lt;/P&gt; * * @param node å“ˆå¸Œç¯èŠ‚ç‚¹ */ public void add(T node) &#123; for (int i = 0; i &lt; numberOfReplicas; i++) &#123; String nodestr = node.toString() + i; int hashcode = nodestr.hashCode(); System.out.println(&quot;hashcode:&quot; + hashcode); circle.put(hashcode, node); &#125; &#125; /** * åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ * * @param node å¾…åˆ é™¤èŠ‚ç‚¹ */ public void remove(T node) &#123; for (int i = 0; i &lt; numberOfReplicas; i++) &#123; circle.remove((node.toString() + i).hashCode()); &#125; &#125; /** * è·å¾—ä¸€ä¸ªæœ€è¿‘çš„é¡ºæ—¶é’ˆèŠ‚ç‚¹,æ ¹æ®ç»™å®šçš„key å–Hash * ç„¶åå†å–å¾—é¡ºæ—¶é’ˆæ–¹å‘ä¸Šæœ€è¿‘çš„ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„å®é™…èŠ‚ç‚¹ * å†ä»å®é™…èŠ‚ç‚¹ä¸­å–å¾— æ•°æ® * * @param key æ¨¡æ‹Ÿç¼“å­˜Key */ public T get(Object key) &#123; if (circle.isEmpty()) &#123; return null; &#125; // node ç”¨Stringæ¥è¡¨ç¤º,è·å¾—nodeåœ¨å“ˆå¸Œç¯ä¸­çš„hashCode int hash = key.hashCode(); System.out.println(&quot;hashcode-----&gt;:&quot; + hash); //æ•°æ®æ˜ å°„åœ¨ä¸¤å°è™šæ‹Ÿæœºå™¨æ‰€åœ¨ç¯ä¹‹é—´,å°±éœ€è¦æŒ‰é¡ºæ—¶é’ˆæ–¹å‘å¯»æ‰¾æœºå™¨ if (!circle.containsKey(hash)) &#123; SortedMap&lt;Integer, T&gt; tailMap = circle.tailMap(hash); hash = tailMap.isEmpty() ? circle.firstKey() : tailMap.firstKey(); &#125; return circle.get(hash); &#125; /** * è·å–å½“å‰å“ˆå¸Œç¯èŠ‚ç‚¹æ•° * * @return å“ˆå¸Œç¯èŠ‚ç‚¹æ•° */ public long getSize() &#123; return circle.size(); &#125; /** * æŸ¥çœ‹è¡¨ç¤ºæ•´ä¸ªå“ˆå¸Œç¯ä¸­å„ä¸ªè™šæ‹ŸèŠ‚ç‚¹ä½ç½® */ public void showBalance() &#123; //è·å¾—TreeMapä¸­æ‰€æœ‰çš„Key Set&lt;Integer&gt; sets = circle.keySet(); //å°†è·å¾—çš„Keyé›†åˆæ’åº SortedSet&lt;Integer&gt; sortedSets = new TreeSet&lt;Integer&gt;(sets); for (Integer hashCode : sortedSets) &#123; System.out.println(hashCode); &#125; System.out.println(&quot;----each location &#x27;s distance are follows: ----&quot;); //æŸ¥çœ‹ç›¸é‚»ä¸¤ä¸ªhashCodeçš„å·®å€¼ Iterator&lt;Integer&gt; it = sortedSets.iterator(); Iterator&lt;Integer&gt; it2 = sortedSets.iterator(); if (it2.hasNext()) &#123; it2.next(); &#125; long keyPre, keyAfter; while (it.hasNext() &amp;&amp; it2.hasNext()) &#123; keyPre = it.next(); keyAfter = it2.next(); System.out.println(keyAfter - keyPre); &#125; &#125;&#125; æµ‹è¯•ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package com.example.demo.hash;import org.junit.Before;import org.junit.Test;import java.util.Arrays;import java.util.HashSet;import java.util.List;import java.util.Set;/** * TODO * * @author gaochen * @date 2019/5/29 */public class ConsistentHashTest &#123; private static ConsistentHash&lt;String&gt; consistentHash; @Before public void initHash() &#123; Set&lt;String&gt; nodes = new HashSet&lt;&gt;(); consistentHash = new ConsistentHash&lt;&gt;(2, nodes); &#125; @Test public void testBalance() &#123; // åˆ†é…ä¸‰ä¸ªèŠ‚ç‚¹ consistentHash.add(&quot;A1&quot;); consistentHash.add(&quot;C1&quot;); consistentHash.add(&quot;D1&quot;); System.out.println(&quot;hash circle size: &quot; + consistentHash.getSize()); System.out.println(&quot;location of each node are follows: &quot;);// consistentHash.showBalance(); // hashå€¼åœ¨å½“å‰å“ˆå¸Œç¯å†… final String key1 = &quot;A31&quot;; // hashå€¼è¶…å‡ºäº†å½“å‰å“ˆå¸Œç¯ final String key2 = &quot;Apple&quot;; final List&lt;String&gt; keys = Arrays.asList(key1, key2); // æ¨¡æ‹ŸèŠ‚ç‚¹åˆ†é… showAllocate(keys); // æ¨¡æ‹Ÿå¢åŠ èŠ‚ç‚¹, A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„B1èŠ‚ç‚¹ consistentHash.add(&quot;B1&quot;); System.out.println(&quot;å¢åŠ èŠ‚ç‚¹B1&quot;); showAllocate(keys); System.out.println(&quot;-------------------------------------&quot;); // æ¨¡æ‹Ÿåˆ é™¤èŠ‚ç‚¹, A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„C1èŠ‚ç‚¹ consistentHash.remove(&quot;B1&quot;); System.out.println(&quot;åˆ é™¤èŠ‚ç‚¹B1&quot;); showAllocate(keys); &#125; /** * æ¨¡æ‹Ÿç¼“å­˜åˆ†é… * * @param keys ç¼“å­˜é”® */ private void showAllocate(List&lt;String&gt; keys) &#123; keys.forEach(key -&gt; &#123; String node = consistentHash.get(key); // A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„C1èŠ‚ç‚¹ System.out.println(String.format(&quot;key %s is allocated to node %s&quot;, key, node)); &#125;); &#125;&#125; æ§åˆ¶å°è¾“å‡ºï¼š 12345678910111213141516171819202122232425hashcode:64032hashcode:64033hashcode:65954hashcode:65955hashcode:66915hashcode:66916hash circle size: 6location of each node are follows: hashcode-----&gt;:64095key A31 is allocated to node C1hashcode-----&gt;:63476538key Apple is allocated to node A1hashcode:64993hashcode:64994å¢åŠ èŠ‚ç‚¹B1hashcode-----&gt;:64095key A31 is allocated to node B1hashcode-----&gt;:63476538key Apple is allocated to node A1-------------------------------------åˆ é™¤èŠ‚ç‚¹B1hashcode-----&gt;:64095key A31 is allocated to node C1hashcode-----&gt;:63476538key Apple is allocated to node A1 å¯ä»¥çœ‹å‡ºï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œåªä¼šå½±å“åˆ°èŠ‚ç‚¹ä¸ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸€è‡´æ€§Hashç®—æ³•åœ¨å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ä¸Šé¢è¾ƒæ™®é€šHashæ˜¯æœ‰å·¨å¤§æå‡çš„ã€‚ å‚è€ƒèµ„æ–™äº”åˆ†é’Ÿçœ‹æ‡‚ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ç»´åŸºç™¾ç§‘-æ•£åˆ—å‡½æ•° ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŠå…¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨","tags":[{"name":"ä¸€è‡´æ€§Hash","slug":"ä¸€è‡´æ€§Hash","permalink":"https://gcdd1993.github.io/tags/%E4%B8%80%E8%87%B4%E6%80%A7Hash/"}]},{"title":"ç†è§£Nginxè´Ÿè½½å‡è¡¡","date":"2019-05-29T02:30:45.000Z","path":"p/52703/","text":"å‰è¨€å·¥ä½œä»¥æ¥ï¼Œä¸€ç›´éƒ½åœ¨ä½¿ç”¨Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä½†æ˜¯å…³äºNginxçš„è´Ÿè½½å‡è¡¡ç®—æ³•ä¸€ç›´æ²¡æœ‰æ·±å…¥ç†è§£è¿‡ï¼Œè¿™æ¬¡å¥½å¥½çš„æ•´ç†ä¸‹ã€‚ å‡†å¤‡æœåŠ¡å™¨ æ­å»ºä¸‰å°ç”¨äºæµ‹è¯•çš„è™šæ‹Ÿæœº åç§° IP æœåŠ¡ node01 192.168.198.131 Nginxã€æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰ node02 192.168.198.130 æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰ node03 192.168.198.132 æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰ ä¿®æ”¹hostnameå’Œhosts 123456$ vim /etc/hosts192.168.198.131 node01$ vim /etc/hostnamenode01$ reboot## å…¶ä½™ä¸¤å°ä¹Ÿæ”¹ä¸‹ï¼Œå¹¶é‡å¯ä½¿é…ç½®ç”Ÿæ•ˆ åœ¨node01ä¸Šå®‰è£…NginxæœåŠ¡ 1234$ echo -e &quot;deb http://nginx.org/packages/ubuntu/ $(lsb_release -cs) nginx\\ndeb-src http://nginx.org/packages/ubuntu/ $(lsb_release -cs) nginx&quot; | sudo tee /etc/apt/sources.list.d/nginx.list$ wget -O- http://nginx.org/keys/nginx_signing.key | sudo apt-key add -$ sudo apt-get update$ sudo apt-get install nginx æ¨¡æ‹Ÿä¸šåŠ¡ä½¿ç”¨https://start.spring.ioå¿«é€Ÿæ–°å»ºSpring Booté¡¹ç›®ï¼Œæ·»åŠ Webæ¨¡å—ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š 123456789@RestController@RequestMapping(&quot;/test&quot;)public class DemoController &#123; @GetMapping public String test() throws UnknownHostException &#123; return &quot;this is : &quot; + Inet4Address.getLocalHost(); &#125;&#125; æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯The Application Pluginï¼Œéƒ¨ç½²å®Œæ¯•å¯åŠ¨ æµ‹è¯•ä¸‹ï¼š 123456789101112## node01$ curl 192.168.198.131:8080/test...this is : node01/192.168.198.131## node02$ curl 192.168.198.130:8080/test...this is : node02/192.168.198.130## node03$ curl 192.168.198.132:8080/test...this is : node03/192.168.198.132 Nginxè´Ÿè½½å‡è¡¡Round Robinï¼ˆè½®è¯¢ï¼‰ è¯·æ±‚åœ¨æœåŠ¡å™¨ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼Œå¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡ã€‚ 12345678910111213141516$ vim /etc/nginx/conf/demo.confupstream backend &#123; server 192.168.198.131:8080; server 192.168.198.132:8080; server 192.168.198.130:8080;&#125;server &#123; listen 80; server_name 192.168.198.131; location / &#123; proxy_pass http://backend; &#125;&#125;$ service nginx restart æµ‹è¯•ä¸‹ 123456789101112$ curl 192.168.198.131/test...this is : node01/192.168.198.131 # node01$ curl 192.168.198.131/test...this is : node03/192.168.198.132 # node03$ curl 192.168.198.131/test...this is : node03/192.168.198.130 # node02$ curl 192.168.198.131/test...this is : node01/192.168.198.131 # node01 å¯ä»¥çœ‹åˆ°ï¼Œæ¯å°æœåŠ¡å™¨è®¿é—®åˆ°çš„æ¬¡æ•°æ˜¯ç›¸ç­‰çš„ã€‚ Least Connections è¯·æ±‚åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼Œå¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡ã€‚ 12345678$ vim /etc/nginx/conf/demo.confupstream backend &#123; least_conn; server 192.168.198.131:8080; server 192.168.198.132:8080; server 192.168.198.130:8080;&#125;$ service nginx restart è¿™ä¸ªä¸çŸ¥é“æ€ä¹ˆæ¨¡æ‹Ÿå‡ºè¿æ¥æ•°æœ€å°‘åœºæ™¯ã€‚ IP Hash ä»å®¢æˆ·ç«¯çš„IPåœ°å€æ¥ç¡®å®šè¯·æ±‚åº”è¯¥å‘é€ç»™å“ªå°æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨IPv4åœ°å€çš„å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚æˆ–æ•´ä¸ªIPv6åœ°å€æ¥è®¡ç®—æ•£åˆ—å€¼ã€‚è¯¥æ–¹æ³•èƒ½ä¿è¯æ¥è‡ªåŒä¸€åœ°å€çš„è¯·æ±‚åˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œé™¤éè¯¥æœåŠ¡å™¨ä¸å¯ç”¨ã€‚ 12345678$ vim /etc/nginx/conf/demo.confupstream backend &#123; ip_hash; server 192.168.198.131:8080; server 192.168.198.132:8080; server 192.168.198.130:8080;&#125;$ service nginx restart æµ‹è¯•ä¸‹ 123456789$ curl 192.168.198.131/test...this is : node01/192.168.198.131$ curl 192.168.198.131/test...this is : node01/192.168.198.131$ curl 192.168.198.131/test...this is : node01/192.168.198.131 å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°node01èŠ‚ç‚¹ã€‚ æ¥ä¸‹æ¥ï¼Œå°†node01èŠ‚ç‚¹å…³é—­ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š 12345678910111213141516$ ps -ef | grep demoroot 3343 1764 0 11:52 pts/0 00:00:23 java -jar /home/demo/demo-boot-0.0.1-SNAPSHOT/lib/demo-0.0.1-SNAPSHOT.jarroot 4529 1764 0 13:11 pts/0 00:00:00 grep --color=auto demo$ kill -9 3343$ ps -ef | grep demoroot 4529 1764 0 13:11 pts/0 00:00:00 grep --color=auto demo$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node03/192.168.198.132 ç”±äºnode01èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°node03èŠ‚ç‚¹ã€‚ Generic Hash ä¸ä¸Šé¢çš„IP_HASHç±»ä¼¼ï¼Œé€šç”¨HASHæŒ‰ç…§ç”¨æˆ·å®šä¹‰çš„å‚æ•°æ¥è®¡ç®—æ•£åˆ—å€¼ï¼Œå‚æ•°å¯ä»¥æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå˜é‡æˆ–ç»„åˆã€‚ä¾‹å¦‚ï¼Œå‚æ•°å¯ä»¥æ˜¯è¿œç«¯åœ°å€ï¼š 12345678$ vim /etc/nginx/conf/demo.confupstream backend &#123; hash $remote_addr consistent; server 192.168.198.131:8080; server 192.168.198.132:8080; server 192.168.198.130:8080;&#125;$ service nginx restart æµ‹è¯•ä¸‹ 123456789$ curl 192.168.198.131/test...this is : node02/192.168.198.130$ curl 192.168.198.131/test...this is : node02/192.168.198.130$ curl 192.168.198.131/test...this is : node02/192.168.198.130 å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°äº†node02èŠ‚ç‚¹ã€‚ ğŸ‘‰ä¸Šé¢çš„consistentæ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œå°†é‡‡ç”¨Ketamaä¸€è‡´æ€§hashç®—æ³•è®¡ç®—æ•£åˆ—å€¼ã€‚ å…³äºä¸€è‡´æ€§Hashï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼šç†è§£ä¸€è‡´æ€§Hashç®—æ³• Random è¯·æ±‚ä¼šè¢«éšæœºåˆ†é…åˆ°ä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡ã€‚ 12345678$ vim /etc/nginx/conf/demo.confupstream backend &#123; random; server 192.168.198.131:8080; server 192.168.198.132:8080; server 192.168.198.130:8080;&#125;$ service nginx restart æµ‹è¯•ä¸‹ 123456789101112$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node01/192.168.198.131$ curl 192.168.198.131/test...this is : node02/192.168.198.130$ curl 192.168.198.131/test...this is : node01/192.168.198.130 å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚æ˜¯è¢«éšæœºåˆ†é…åˆ°ä¸‰å°æœåŠ¡å™¨çš„ã€‚ Weights é™¤äº†è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæœåŠ¡å™¨è®¾ç½®æƒé‡ï¼Œæƒé‡é»˜è®¤å€¼æ˜¯1 1234567$ vim /etc/nginx/conf/demo.confupstream backend &#123; server 192.168.198.131:8080 weight=5; server 192.168.198.132:8080 weight=10; server 192.168.198.130:8080;&#125;$ service nginx restart æµ‹è¯•ä¸‹ 123456789101112131415$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node01/192.168.198.131$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node03/192.168.198.132$ curl 192.168.198.131/test...this is : node01/192.168.198.131 å¯ä»¥çœ‹åˆ°ï¼Œ5æ¬¡è¯·æ±‚ä¸­ï¼Œnode03(weight=10)å äº†3æ¬¡ï¼Œnode01(weight=5)å äº†2æ¬¡ï¼Œnode02(weight=1)1æ¬¡éƒ½æ²¡æœ‰ã€‚ ç†è®ºä¸Šæ¥è¯´ï¼Œä¸Šé¢çš„é…ç½®ï¼Œè®¿é—®16æ¬¡ï¼Œnode03åº”è¢«åˆ†é…10æ¬¡ï¼Œnode01åº”è¢«åˆ†é…5æ¬¡ï¼Œnode02åº”è¢«åˆ†é…1æ¬¡ã€‚ å‚è€ƒèµ„æ–™http-load-balancer","tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://gcdd1993.github.io/tags/Nginx/"}]},{"title":"Redis å¸¸ç”¨å‘½ä»¤","date":"2019-05-26T03:41:40.000Z","path":"p/1091/","text":"å‰è¨€Redisæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤ï¼ˆcommandï¼‰å¯¹æ•°æ®åº“å’Œå„ç§æ•°æ®ç±»å‹è¿›è¡Œæ“ä½œï¼Œè¿™äº›commandå¯ä»¥åœ¨Linuxç»ˆç«¯ä½¿ç”¨ã€‚åœ¨ç¼–ç¨‹æ—¶ï¼Œæ¯”å¦‚å„ç±»è¯­è¨€åŒ…ï¼Œè¿™äº›å‘½ä»¤éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚ä¸‹é¢å°†Redisæä¾›çš„å‘½ä»¤åšä¸€æ€»ç»“ã€‚ é”®å€¼ç›¸å…³å‘½ä»¤keys è¿”å›æ»¡è¶³ç»™å®špatternçš„æ‰€æœ‰key 12345678910111213141516171819202122232425127.0.0.1:6379&gt; keys * 1) &quot;mylist4&quot; 2) &quot;myset7&quot; 3) &quot;name1&quot; 4) &quot;myset3&quot; 5) &quot;myset2&quot; 6) &quot;mylist2&quot; 7) &quot;mylist6&quot; 8) &quot;name&quot; 9) &quot;myhash&quot;10) &quot;mylist7&quot;11) &quot;key1&quot;12) &quot;mylist5&quot;13) &quot;mylist8&quot;14) &quot;myzset2&quot;15) &quot;myzset3&quot;16) &quot;myzset&quot;17) &quot;myset5&quot;18) &quot;myset4&quot;19) &quot;mylist3&quot;20) &quot;myset&quot;21) &quot;myset6&quot;22) &quot;age&quot;23) &quot;mylist&quot;24) &quot;key2&quot; ç”¨è¡¨è¾¾å¼*ï¼Œä»£è¡¨å–å‡ºæ‰€æœ‰çš„keyã€‚ 123456789127.0.0.1:6379&gt; keys mylist*1) &quot;mylist4&quot;2) &quot;mylist2&quot;3) &quot;mylist6&quot;4) &quot;mylist7&quot;5) &quot;mylist5&quot;6) &quot;mylist8&quot;7) &quot;mylist3&quot;8) &quot;mylist&quot; ç”¨è¡¨è¾¾å¼mylist*ï¼Œä»£è¡¨å–å‡ºæ‰€æœ‰ä»¥mylistå¼€å¤´çš„keyã€‚ exists ç¡®è®¤ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨ 1234127.0.0.1:6379&gt; exists HongWan(integer) 0127.0.0.1:6379&gt; exists age(integer) 1 ä»ç»“æœæ¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨HongWanè¿™ä¸ªkeyï¼Œä½†æ˜¯ageè¿™ä¸ªkeyæ˜¯å­˜åœ¨çš„ã€‚ del åˆ é™¤ä¸€ä¸ªkey 1234127.0.0.1:6379&gt; del age(integer) 1127.0.0.1:6379&gt; exists age(integer) 0 expire è®¾ç½®ä¸€ä¸ªkeyçš„è¿‡æœŸæ—¶é—´(å•ä½:ç§’) 12345678910111213141516127.0.0.1:6379&gt; exists addr(integer) 1127.0.0.1:6379&gt; ttl addr(integer) -1127.0.0.1:6379&gt; expire addr 10(integer) 1127.0.0.1:6379&gt; ttl addr(integer) 6127.0.0.1:6379&gt; ttl addr(integer) 5127.0.0.1:6379&gt; ttl addr(integer) 4127.0.0.1:6379&gt; ttl addr(integer) -2127.0.0.1:6379&gt; exists addr(integer) 0 å¯ä»¥çœ‹åˆ°ï¼Œæœªè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œttlå€¼ä¸º-1ï¼Œè®¾ç½®10sè¿‡æœŸåï¼Œä¸æ–­åœ°ä½¿ç”¨ttlè·å–keyçš„æœ‰æ•ˆæ—¶é•¿ï¼Œå½“å€¼ä¸º-2æ—¶ï¼Œè¡¨ç¤ºå·²è¿‡æœŸå¹¶è¢«åˆ é™¤ã€‚ move å°†å½“å‰æ•°æ®åº“ä¸­çš„keyè½¬ç§»åˆ°å…¶å®ƒæ•°æ®åº“ä¸­ 1234567891011121314127.0.0.1:6379&gt; select 0OK127.0.0.1:6379&gt; set age 30OK127.0.0.1:6379&gt; get age&quot;30&quot;127.0.0.1:6379&gt; move age 1(integer) 1127.0.0.1:6379&gt; get age(nil)127.0.0.1:6379&gt; select 1OK127.0.0.1:6379[1]&gt; get age&quot;30&quot; åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘å…ˆæ˜¾å¼çš„é€‰æ‹©äº†æ•°æ®åº“0ï¼Œç„¶ååœ¨è¿™ä¸ªåº“ä¸­è®¾ç½®ä¸€ä¸ªkeyï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™ä¸ªkeyä»æ•°æ®åº“0ç§»åˆ°æ•°æ®åº“1ï¼Œä¹‹åæˆ‘ä»¬ç¡®è®¤åœ¨æ•°æ®åº“0ä¸­æ— æ­¤keyäº†, ä½†åœ¨æ•°æ®åº“1ä¸­å­˜åœ¨è¿™ä¸ªkeyï¼Œè¯´æ˜æˆ‘ä»¬è½¬ç§»æˆåŠŸäº† ã€‚ persist ç§»é™¤ç»™å®škeyçš„è¿‡æœŸæ—¶é—´ 12345678127.0.0.1:6379[1]&gt; expire age 300(integer) 1127.0.0.1:6379[1]&gt; ttl age(integer) 296127.0.0.1:6379[1]&gt; persist age(integer) 1127.0.0.1:6379[1]&gt; ttl age(integer) -1 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨çš„å°†æœªåˆ°è¿‡æœŸæ—¶é—´çš„keyï¼ŒæˆåŠŸè®¾ç½®ä¸ºè¿‡æœŸã€‚ randomkey éšæœºè¿”å›keyç©ºé—´çš„ä¸€ä¸ªkey 1234127.0.0.1:6379&gt; randomkey&quot;mylist5&quot;127.0.0.1:6379&gt; randomkey&quot;myzset2&quot; é€šè¿‡ç»“æœå¯ä»¥çœ‹åˆ°å–keyçš„è§„åˆ™æ˜¯éšæœºçš„ã€‚ rename é‡å‘½åkey 123456127.0.0.1:6379[1]&gt; keys *1) &quot;age&quot;127.0.0.1:6379[1]&gt; rename age age_newOK127.0.0.1:6379[1]&gt; keys *1) &quot;age_new&quot; ageæˆåŠŸçš„è¢«æˆ‘ä»¬æ”¹åä¸ºage_newäº†ã€‚ type è¿”å›å€¼çš„ç±»å‹ 123456127.0.0.1:6379&gt; type namestring127.0.0.1:6379&gt; type mysetset127.0.0.1:6379&gt; type myzsetzset æœåŠ¡å™¨ç›¸å…³å‘½ä»¤ping æµ‹è¯•è¿æ¥æ˜¯å¦å­˜æ´» 12345678127.0.0.1:6379&gt; pingPONG// æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬åœæ­¢redisæœåŠ¡å™¨127.0.0.1:6379&gt; pingCould not connect to Redis at 127.0.0.1:6379: Connection refused// æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯åŠ¨redisæœåŠ¡å™¨not connected&gt; pingPONG echo åœ¨å‘½ä»¤è¡Œæ‰“å°ä¸€äº›å†…å®¹ 12127.0.0.1:6379&gt; echo HongWan&quot;HongWan&quot; select é€‰æ‹©æ•°æ®åº“ã€‚Redisæ•°æ®åº“ç¼–å·ä»0~15ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°æ®åº“æ¥è¿›è¡Œæ•°æ®çš„å­˜å– 1234127.0.0.1:6379&gt; select 1OK127.0.0.1:6379[1]&gt; select 16(error) ERR invalid DB index quit é€€å‡ºè¿æ¥ 12127.0.0.1:6379&gt; quitroot@test01:~# dbsize è¿”å›å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›® 12127.0.0.1:6379&gt; dbsize(integer) 23 ç»“æœè¯´æ˜æ­¤åº“ä¸­æœ‰23ä¸ªkeyã€‚ info è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡ 123456789101112127.0.0.1:6379&gt; info# Serverredis_version:3.0.6redis_git_sha1:00000000redis_git_dirty:0redis_build_id:28b6715d3583bf8eredis_mode:standaloneos:Linux 4.4.0-148-generic x86_64arch_bits:64multiplexing_api:epollgcc_version:5.4.0... æ­¤ç»“æœç”¨äºè¯´æ˜æœåŠ¡å™¨çš„åŸºç¡€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€å¯åŠ¨æ—¶é—´ç­‰ã€‚ monitor å®æ—¶è½¬å‚¨æ”¶åˆ°çš„è¯·æ±‚ å…ˆåœ¨ç»ˆç«¯1è¾“å…¥monitorå‘½ä»¤ï¼Œå°†ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ 12127.0.0.1:6379&gt; monitorOK æ–°å»ºä¸€ä¸ªç»ˆç«¯ï¼Œè¾“å…¥ä¸€äº›rediså‘½ä»¤ 1234567891011121314151617181920212223242526127.0.0.1:6379&gt; keys * 1) &quot;myset3&quot; 2) &quot;myset2&quot; 3) &quot;mylist7&quot; 4) &quot;mylist4&quot; 5) &quot;key1&quot; 6) &quot;myset7&quot; 7) &quot;name1&quot; 8) &quot;mylist6&quot; 9) &quot;myzset&quot;10) &quot;mylist2&quot;11) &quot;myset&quot;12) &quot;mylist&quot;13) &quot;myhash&quot;14) &quot;myset4&quot;15) &quot;name&quot;16) &quot;myset5&quot;17) &quot;myzset3&quot;18) &quot;mylist3&quot;19) &quot;mylist5&quot;20) &quot;myzset2&quot;21) &quot;mylist8&quot;22) &quot;key2&quot;23) &quot;myset6&quot;127.0.0.1:6379&gt; get addr(nil) å›åˆ°ç»ˆç«¯1ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ‰“å°å‡ºäº†åˆšæ‰æˆ‘ä»¬åœ¨ç»ˆç«¯2ä¸­æ•²å…¥çš„rediså‘½ä»¤ 1234127.0.0.1:6379&gt; monitorOK1558844434.297954 [0 127.0.0.1:34926] &quot;keys&quot; &quot;*&quot;1558844444.673315 [0 127.0.0.1:34926] &quot;get&quot; &quot;addr&quot; config get è·å–æœåŠ¡å™¨é…ç½®ä¿¡æ¯ 123127.0.0.1:6379&gt; config get dir1) &quot;dir&quot;2) &quot;/var/lib/redis&quot; æœ¬ä¾‹ä¸­æˆ‘ä»¬è·å–äº†dirè¿™ä¸ªå‚æ•°é…ç½®çš„å€¼ï¼Œå¦‚æœæƒ³è·å–å…¨éƒ¨å‚æ•°æ®çš„é…ç½®å€¼ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€æ‰§è¡Œâ€config get *â€å³å¯å°†å…¨éƒ¨çš„å€¼éƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚ flushdb åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key 123456127.0.0.1:6379&gt; dbsize(integer) 23127.0.0.1:6379&gt; flushdbOK127.0.0.1:6379&gt; dbsize(integer) 0 åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†0å·æ•°æ®åº“ä¸­çš„keyéƒ½æ¸…é™¤äº†ã€‚ flushall åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key 123456789101112127.0.0.1:6379&gt; select 1OK127.0.0.1:6379[1]&gt; dbsize(integer) 1127.0.0.1:6379[1]&gt; select 0OK127.0.0.1:6379&gt; flushallOK127.0.0.1:6379&gt; select 1OK127.0.0.1:6379[1]&gt; dbsize(integer) 0 åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å…ˆæŸ¥çœ‹äº†ä¸€ä¸ª1å·æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªkeyï¼Œç„¶åæˆ‘åˆ‡æ¢åˆ°0å·åº“æ‰§è¡Œflushallå‘½ä»¤ï¼Œç»“æœ1å·åº“ä¸­çš„keyä¹Ÿè¢«æ¸…é™¤äº†ï¼Œè¯´æ˜æ­¤å‘½ä»¤å·¥ä½œæ­£å¸¸ã€‚ æ•°æ®ç›¸å…³å‘½ä»¤ğŸ‘‰Redis-æ•°æ®ç±»å‹åŠæ“ä½œ","tags":[{"name":"Redis","slug":"Redis","permalink":"https://gcdd1993.github.io/tags/Redis/"},{"name":"NoSql","slug":"NoSql","permalink":"https://gcdd1993.github.io/tags/NoSql/"}]},{"title":"Redis æ•°æ®ç±»å‹åŠæ“ä½œ","date":"2019-05-25T15:59:44.000Z","path":"p/38807/","text":"å‰è¨€ä½œä¸ºKey-valueå‹æ•°æ®åº“ï¼ŒRedisä¹Ÿæä¾›äº†é”®ï¼ˆKeyï¼‰å’Œé”®å€¼ï¼ˆValueï¼‰çš„æ˜ å°„å…³ç³»ã€‚ä½†æ˜¯ï¼Œé™¤äº†å¸¸è§„çš„æ•°å€¼æˆ–å­—ç¬¦ä¸²ï¼ŒRedisçš„é”®å€¼è¿˜å¯ä»¥æ˜¯ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š [Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰ ](#Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰ ) [Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰ ](#Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰) [Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰ ](#Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰) [Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰](#Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰) é”®å€¼çš„æ•°æ®ç±»å‹å†³å®šäº†è¯¥é”®å€¼æ”¯æŒçš„æ“ä½œã€‚Redisæ”¯æŒè¯¸å¦‚åˆ—è¡¨ã€é›†åˆæˆ–æœ‰åºé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€æŸ¥é›†ç­‰é«˜çº§åŸå­æ“ä½œï¼›åŒæ—¶ï¼Œå¦‚æœé”®å€¼çš„ç±»å‹æ˜¯æ™®é€šæ•°å­—ï¼ŒRedisåˆ™æä¾›è‡ªå¢ç­‰åŸå­æ“ä½œã€‚ stringsï¼ˆå­—ç¬¦ä¸²ï¼‰ stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ set è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueã€‚ 12127.0.0.1:6379&gt; set name wwlOK setnx è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueã€‚å¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œè¿”å›0ï¼Œnxæ˜¯not existçš„æ„æ€ã€‚ 123456127.0.0.1:6379&gt; get name&quot;wwl&quot;127.0.0.1:6379&gt; setnx name HongWan_new(integer) 0127.0.0.1:6379&gt; get name &quot;HongWan&quot; ç”±äºåŸæ¥nameæœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥æœ¬æ¬¡çš„ä¿®æ”¹ä¸ç”Ÿæ•ˆï¼Œä¸”è¿”å›ç æ˜¯0ã€‚ setex è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueï¼Œå¹¶æŒ‡å®šæ­¤é”®å€¼å¯¹åº”çš„æœ‰æ•ˆæœŸã€‚ 12345678127.0.0.1:6379&gt; setex haircolor 10 red OK127.0.0.1:6379&gt; get haircolor&quot;red&quot;127.0.0.1:6379&gt; get haircolor&quot;red&quot;127.0.0.1:6379&gt; get haircolor(nil) å¯è§ç”±äºæœ€åä¸€æ¬¡çš„è°ƒç”¨æ˜¯10ç§’ä»¥åäº†ï¼Œæ‰€ä»¥å–ä¸åˆ°haicolorè¿™ä¸ªé”®å¯¹åº”çš„å€¼ã€‚ setrange è®¾ç½®æŒ‡å®škeyçš„valueå€¼çš„å­å­—ç¬¦ä¸²ã€‚ 12345678127.0.0.1:6379&gt; set name &#x27;HongWan@126.com&#x27;OK127.0.0.1:6379&gt; get name &quot;HongWan@126.com&quot;127.0.0.1:6379&gt; setrange name 8 gmail.com (integer) 17127.0.0.1:6379&gt; get name &quot;HongWan@gmail.com&quot; å…¶ä¸­çš„8æ˜¯æŒ‡ä»ä¸‹æ ‡ä¸º8ï¼ˆåŒ…å«8ï¼‰çš„å­—ç¬¦å¼€å§‹æ›¿æ¢ã€‚ mset ä¸€æ¬¡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼ŒæˆåŠŸè¿”å›okè¡¨ç¤ºæ‰€æœ‰çš„å€¼éƒ½è®¾ç½®äº†ï¼Œå¤±è´¥è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½®ã€‚ 123456127.0.0.1:6379&gt; mset key1 HongWan1 key2 HongWan2 OK127.0.0.1:6379&gt; get key1 &quot;HongWan1&quot;127.0.0.1:6379&gt; get key2&quot;HongWan2&quot; msetnx ä¸€æ¬¡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼ŒæˆåŠŸè¿”å›okè¡¨ç¤ºæ‰€æœ‰çš„å€¼éƒ½è®¾ç½®äº†ï¼Œå¤±è´¥è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½®ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„keyã€‚ 12345678910127.0.0.1:6379&gt; get key1&quot;HongWan1&quot;127.0.0.1:6379&gt; get key2&quot;HongWan2&quot;127.0.0.1:6379&gt; msetnx key2 HongWan2_new key3 HongWan3(integer) 0127.0.0.1:6379&gt; get key2 &quot;HongWan2&quot;127.0.0.1:6379&gt; get key3(nil) å¯ä»¥çœ‹å‡ºå¦‚æœè¿™æ¡å‘½ä»¤è¿”å›0ï¼Œé‚£ä¹ˆé‡Œé¢æ“ä½œéƒ½ä¼šå›æ»šï¼Œéƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚ get è·å–keyå¯¹åº”çš„stringå€¼,å¦‚æœkeyä¸å­˜åœ¨è¿”å›nilã€‚ 12345127.0.0.1:6379&gt; get name &quot;HongWan_new&quot;## æˆ‘ä»¬è·å–ä¸€ä¸ªåº“ä¸­ä¸å­˜åœ¨çš„é”®name1ï¼Œé‚£ä¹ˆå®ƒä¼šè¿”å›ä¸€ä¸ªnilä»¥è¡¨æ—¶æ— æ­¤é”®å€¼å¯¹ redis 127.0.0.1:6379&gt; get name1 (nil) getset è®¾ç½®keyçš„å€¼ï¼Œå¹¶è¿”å›keyçš„æ—§å€¼ã€‚ 123456127.0.0.1:6379&gt; get name &quot;HongWan&quot;127.0.0.1:6379&gt; getset name HongWan_new &quot;HongWan&quot;127.0.0.1:6379&gt; get name&quot;HongWan_new&quot; å¦‚æœkeyä¸å­˜åœ¨ï¼Œå°†è¿”å›nilï¼Œå¹¶ä¼šè®¾ç½®æ–°å€¼ã€‚ 1234redis 127.0.0.1:6379&gt; getset name1 aaa(nil) 127.0.0.1:6379&gt; get name1&quot;aaa&quot; getrange è·å–æŒ‡å®škeyçš„valueå€¼çš„å­å­—ç¬¦ä¸²ã€‚ 1234567891011127.0.0.1:6379&gt; get name &quot;HongWan_new&quot;127.0.0.1:6379&gt; getrange name 0 6 &quot;HongWan&quot;## å­—ç¬¦ä¸²å·¦é¢ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„127.0.0.1:6379&gt; getrange name -7 -1&quot;Wan_new&quot;## å­—ç¬¦ä¸²å³é¢ä¸‹æ ‡æ˜¯ä»-1å¼€å§‹çš„127.0.0.1:6379&gt; getrange name 7 100 &quot;_new&quot;## å½“ä¸‹æ ‡è¶…å‡ºå­—ç¬¦ä¸²é•¿åº¦æ—¶ï¼Œå°†é»˜è®¤ä¸ºæ˜¯åŒæ–¹å‘çš„æœ€å¤§ä¸‹æ ‡ mget ä¸€æ¬¡è·å–å¤šä¸ªkeyçš„å€¼ï¼Œå¦‚æœå¯¹åº”keyä¸å­˜åœ¨ï¼Œåˆ™å¯¹åº”è¿”å›nilã€‚ 12345127.0.0.1:6379&gt; mget key1 key2 key3 1) &quot;HongWan1&quot;2) &quot;HongWan2&quot;3) (nil)## key3ç”±äºæ²¡æœ‰è¿™ä¸ªé”®å®šä¹‰ï¼Œæ‰€ä»¥è¿”å›nilã€‚ incr å¯¹keyçš„å€¼åšåŠ åŠ æ“ä½œ,å¹¶è¿”å›æ–°çš„å€¼ã€‚æ³¨æ„incrä¸€ä¸ªä¸æ˜¯intçš„valueä¼šè¿”å›é”™è¯¯ï¼Œincrä¸€ä¸ªä¸å­˜åœ¨çš„keyï¼Œåˆ™è®¾ç½®keyä¸º1 ã€‚ 123456127.0.0.1:6379&gt; set age 20OK127.0.0.1:6379&gt; incr age (integer) 21127.0.0.1:6379&gt; get age&quot;21&quot; incrby åŒincrç±»ä¼¼ï¼ŒåŠ æŒ‡å®šå€¼ ï¼Œkeyä¸å­˜åœ¨æ—¶å€™ä¼šè®¾ç½®keyï¼Œå¹¶è®¤ä¸ºåŸæ¥çš„valueæ˜¯ 0 ã€‚ 12345678127.0.0.1:6379&gt; get age &quot;21&quot;127.0.0.1:6379&gt; incrby age 5(integer) 26127.0.0.1:6379&gt; get name&quot;HongWan_new&quot;127.0.0.1:6379&gt; get age&quot;26&quot; decr å¯¹keyçš„å€¼åšçš„æ˜¯å‡å‡æ“ä½œï¼Œdecrä¸€ä¸ªä¸å­˜åœ¨keyï¼Œåˆ™è®¾ç½®keyä¸º-1ã€‚ 123456127.0.0.1:6379&gt; get age&quot;26&quot;127.0.0.1:6379&gt; decr age(integer) 25127.0.0.1:6379&gt; get age&quot;25&quot; decrby åŒdecrï¼Œå‡æŒ‡å®šå€¼ã€‚ 123456127.0.0.1:6379&gt; get age&quot;25&quot;127.0.0.1:6379&gt; decrby age 5(integer) 20127.0.0.1:6379&gt; get age&quot;20&quot; decrbyå®Œå…¨æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡incrbyä¸€ä¸ªè´Ÿå€¼æ¥å®ç°åŒæ ·æ•ˆæœï¼Œåä¹‹ä¸€æ ·ã€‚ 123456127.0.0.1:6379&gt; get age&quot;20&quot;127.0.0.1:6379&gt; incrby age -5(integer) 15127.0.0.1:6379&gt; get age&quot;15&quot; append ç»™æŒ‡å®škeyçš„å­—ç¬¦ä¸²å€¼è¿½åŠ value,è¿”å›æ–°å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚ 123456127.0.0.1:6379&gt; get name&quot;HongWan_new&quot;127.0.0.1:6379&gt; append name @126.com(integer) 19127.0.0.1:6379&gt; get name&quot;HongWan_new@126.com&quot; strlen å–æŒ‡å®škeyçš„valueå€¼çš„é•¿åº¦ã€‚ 12345678127.0.0.1:6379&gt; get name&quot;HongWan_new@126.com&quot;127.0.0.1:6379&gt; strlen name(integer) 19127.0.0.1:6379&gt; get age&quot;15&quot;127.0.0.1:6379&gt; strlen age(integer) 2 Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰listæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œä¸»è¦åŠŸèƒ½æ˜¯pushã€popã€è·å–ä¸€ä¸ªèŒƒå›´çš„æ‰€æœ‰å€¼ç­‰ç­‰ï¼Œæ“ä½œä¸­keyç†è§£ä¸ºé“¾è¡¨çš„åå­—ã€‚ Redisçš„listç±»å‹å…¶å®å°±æ˜¯ä¸€ä¸ªæ¯ä¸ªå­å…ƒç´ éƒ½æ˜¯stringç±»å‹çš„åŒå‘é“¾è¡¨ã€‚é“¾è¡¨çš„æœ€å¤§é•¿åº¦æ˜¯(2^32)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡push,popæ“ä½œä»é“¾è¡¨çš„å¤´éƒ¨æˆ–è€…å°¾éƒ¨æ·»åŠ åˆ é™¤å…ƒç´ ã€‚è¿™ä½¿å¾—listæ—¢å¯ä»¥ç”¨ä½œæ ˆï¼Œä¹Ÿå¯ä»¥ç”¨ä½œé˜Ÿåˆ—ã€‚ lpush åœ¨keyå¯¹åº”listçš„å¤´éƒ¨æ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚ 1234567127.0.0.1:6379&gt; lpush mylist &quot;world&quot;(integer) 1127.0.0.1:6379&gt; lpush mylist &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; lrange mylist 0 -11) &quot;hello&quot;2) &quot;world&quot; åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªworldï¼Œç„¶ååœ¨worldçš„å¤´éƒ¨æ’å…¥äº†ä¸€ä¸ªhelloã€‚å…¶ä¸­lrangeæ˜¯ç”¨äºè·å–mylistçš„å†…å®¹ã€‚ rpush åœ¨keyå¯¹åº”listçš„å°¾éƒ¨æ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚ 1234567127.0.0.1:6379&gt; rpush mylist2 &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist2 &quot;world&quot;(integer) 2127.0.0.1:6379&gt; lrange mylist2 0 -11) &quot;hello&quot;2) &quot;world&quot; åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªhelloï¼Œç„¶ååœ¨helloçš„å°¾éƒ¨æ’å…¥äº†ä¸€ä¸ªworldã€‚ linsert åœ¨keyå¯¹åº”listçš„ç‰¹å®šä½ç½®ä¹‹å‰æˆ–ä¹‹åæ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚ 12345678910127.0.0.1:6379&gt; rpush mylist3 &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist3 &quot;world&quot;(integer) 2127.0.0.1:6379&gt; linsert mylist3 before &quot;world&quot; &quot;there&quot;(integer) 3127.0.0.1:6379&gt; lrange mylist3 0 -11) &quot;hello&quot;2) &quot;there&quot;3) &quot;world&quot; åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªhelloï¼Œç„¶ååœ¨helloçš„å°¾éƒ¨æ’å…¥äº†ä¸€ä¸ªworldï¼Œç„¶ååˆåœ¨worldçš„å‰é¢æ’å…¥äº†thereã€‚ lset è®¾ç½®listä¸­æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ å€¼(ä¸‹æ ‡ä»0å¼€å§‹) ã€‚ 1234567891011121314127.0.0.1:6379&gt; rpush mylist4 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist4 &quot;two&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist4 &quot;three&quot;(integer) 3127.0.0.1:6379&gt; lset mylist4 0 &quot;four&quot;OK127.0.0.1:6379&gt; lset mylist4 -2 &quot;five&quot;OK127.0.0.1:6379&gt; lrange mylist4 0 -11) &quot;four&quot;2) &quot;five&quot;3) &quot;three&quot; åœ¨æ­¤å¤„æˆ‘ä»¬ä¾æ¬¡æ’å…¥äº†one,two,threeï¼Œç„¶åå°†æ ‡æ˜¯0çš„å€¼è®¾ç½®ä¸ºfourï¼Œå†å°†ä¸‹æ ‡æ˜¯-2çš„å€¼è®¾ç½®ä¸ºfiveã€‚ lrem ä»keyå¯¹åº”listä¸­åˆ é™¤countä¸ªå’Œvalueç›¸åŒçš„å…ƒç´ ã€‚ count&gt;0æ—¶ï¼ŒæŒ‰ä»å¤´åˆ°å°¾çš„é¡ºåºåˆ é™¤ã€‚ 12345678910111213127.0.0.1:6379&gt; rpush mylist5 &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist5 &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist5 &quot;foo&quot;(integer) 3127.0.0.1:6379&gt; rpush mylist5 &quot;hello&quot;(integer) 4127.0.0.1:6379&gt; lrem mylist5 2 &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; lrange mylist5 0 -11) &quot;foo&quot;2) &quot;hello&quot; count&lt;0æ—¶ï¼ŒæŒ‰ä»å°¾åˆ°å¤´çš„é¡ºåºåˆ é™¤ã€‚ 12345678910111213127.0.0.1:6379&gt; rpush mylist6 &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist6 &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist6 &quot;foo&quot;(integer) 3127.0.0.1:6379&gt; rpush mylist6 &quot;hello&quot;(integer) 4127.0.0.1:6379&gt; lrem mylist6 -2 &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; lrange mylist6 0 -11) &quot;hello&quot;2) &quot;foo&quot; count=0æ—¶ï¼Œåˆ é™¤å…¨éƒ¨ã€‚ 123456789101112127.0.0.1:6379&gt; rpush mylist7 &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist7 &quot;hello&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist7 &quot;foo&quot;(integer) 3127.0.0.1:6379&gt; rpush mylist7 &quot;hello&quot;(integer) 4127.0.0.1:6379&gt; lrem mylist7 0 &quot;hello&quot;(integer) 3127.0.0.1:6379&gt; lrange mylist7 0 -11) &quot;foo&quot; ltrim ä¿ç•™æŒ‡å®škey çš„å€¼èŒƒå›´å†…çš„æ•°æ®ã€‚ 1234567891011121314127.0.0.1:6379&gt; rpush mylist8 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist8 &quot;two&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist8 &quot;three&quot;(integer) 3127.0.0.1:6379&gt; rpush mylist8 &quot;four&quot;(integer) 4127.0.0.1:6379&gt; ltrim mylist8 1 -1OK127.0.0.1:6379&gt; lrange mylist8 0 -11) &quot;two&quot;2) &quot;three&quot;3) &quot;four&quot; lpop ä»listçš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ ã€‚ 1234567127.0.0.1:6379&gt; lrange mylist 0 -11) &quot;hello&quot;2) &quot;world&quot;127.0.0.1:6379&gt; lpop mylist&quot;hello&quot;127.0.0.1:6379&gt; lrange mylist 0 -11) &quot;world&quot; rpop ä»listçš„å°¾éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ ã€‚ 1234567127.0.0.1:6379&gt; lrange mylist2 0 -11) &quot;hello&quot;2) &quot;world&quot;127.0.0.1:6379&gt; rpop mylist2&quot;world&quot;127.0.0.1:6379&gt; lrange mylist2 0 -11) &quot;hello&quot; rpoplpush ä»ç¬¬ä¸€ä¸ªlistçš„å°¾éƒ¨ç§»é™¤å…ƒç´ å¹¶æ·»åŠ åˆ°ç¬¬äºŒä¸ªlistçš„å¤´éƒ¨,æœ€åè¿”å›è¢«ç§»é™¤çš„å…ƒç´ å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚å¦‚æœç¬¬ä¸€ä¸ªlistæ˜¯ç©ºæˆ–è€…ä¸å­˜åœ¨è¿”å›nilã€‚ 1234567891011121314127.0.0.1:6379&gt; lrange mylist5 0 -11) &quot;foo&quot;2) &quot;hello&quot;127.0.0.1:6379&gt; lrange mylist6 0 -11) &quot;hello&quot;2) &quot;foo&quot;127.0.0.1:6379&gt; rpoplpush mylist5 mylist6&quot;hello&quot;127.0.0.1:6379&gt; lrange mylist5 0 -11) &quot;foo&quot;127.0.0.1:6379&gt; lrange mylist6 0 -11) &quot;hello&quot;2) &quot;hello&quot;3) &quot;foo&quot; lindex è¿”å›åç§°ä¸ºkeyçš„listä¸­indexä½ç½®çš„å…ƒç´ ã€‚ 1234567127.0.0.1:6379&gt; lrange mylist5 0 -11) &quot;three&quot;2) &quot;foo&quot;127.0.0.1:6379&gt; lindex mylist5 0&quot;three&quot;127.0.0.1:6379&gt; lindex mylist5 1&quot;foo&quot; llen è¿”å›keyå¯¹åº”listçš„é•¿åº¦ã€‚ 12127.0.0.1:6379&gt; llen mylist5(integer) 2 Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰Redisçš„setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚setå…ƒç´ æœ€å¤§å¯ä»¥åŒ…å«(2^32)ä¸ªå…ƒç´ ã€‚ setçš„æ˜¯é€šè¿‡hash tableå®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ã€åˆ é™¤å’ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚hash tableä¼šéšç€æ·»åŠ æˆ–è€…åˆ é™¤è‡ªåŠ¨çš„è°ƒæ•´å¤§å°ã€‚ sadd å‘åç§°ä¸ºkeyçš„setä¸­æ·»åŠ å…ƒç´ ã€‚ 123456789127.0.0.1:6379&gt; sadd myset &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; sadd myset &quot;world&quot;(integer) 1127.0.0.1:6379&gt; sadd myset &quot;world&quot;(integer) 0127.0.0.1:6379&gt; smembers myset1) &quot;world&quot;2) &quot;hello&quot; æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘mysetä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ï¼Œä½†ç”±äºç¬¬ä¸‰ä¸ªå…ƒç´ è·Ÿç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå…ƒç´ æ²¡æœ‰æ·»åŠ æˆåŠŸï¼Œæœ€åæˆ‘ä»¬ç”¨smembersæ¥æŸ¥çœ‹mysetä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ srem åˆ é™¤åç§°ä¸ºkeyçš„setä¸­çš„å…ƒç´ memberã€‚ 12345678910111213127.0.0.1:6379&gt; sadd myset2 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; sadd myset2 &quot;two&quot;(integer) 1127.0.0.1:6379&gt; sadd myset2 &quot;three&quot;(integer) 1127.0.0.1:6379&gt; srem myset2 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; srem myset2 &quot;four&quot;(integer) 0127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot; æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘myset2ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ åï¼Œå†è°ƒç”¨sremæ¥åˆ é™¤oneå’Œfourï¼Œä½†ç”±äºå…ƒç´ ä¸­æ²¡æœ‰fouræ‰€ä»¥ï¼Œæ­¤æ¡sremå‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚ spop éšæœºè¿”å›å¹¶åˆ é™¤åç§°ä¸ºkeyçš„setä¸­ä¸€ä¸ªå…ƒç´ ã€‚ 1234567891011127.0.0.1:6379&gt; sadd myset3 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; sadd myset3 &quot;two&quot;(integer) 1127.0.0.1:6379&gt; sadd myset3 &quot;three&quot;(integer) 1127.0.0.1:6379&gt; spop myset3&quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot; æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘myset3ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ åï¼Œå†è°ƒç”¨spopæ¥éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ°threeå…ƒç´ è¢«åˆ é™¤äº†ã€‚ sdiff è¿”å›æ‰€æœ‰ç»™å®škeyä¸ç¬¬ä¸€ä¸ªkeyçš„å·®é›†ã€‚ 12345678127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sdiff myset2 myset31) &quot;two&quot; æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°myset2ä¸­çš„å…ƒç´ ä¸myset3ä¸­ä¸åŒçš„åªæ˜¯threeï¼Œæ‰€ä»¥åªæœ‰threeè¢«æŸ¥å‡ºæ¥äº†ï¼Œè€Œä¸æ˜¯threeå’Œoneï¼Œå› ä¸ºoneæ˜¯myset3çš„å…ƒç´ ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†myset2å’Œmyset3æ¢ä¸ªé¡ºåºæ¥çœ‹ä¸€ä¸‹ç»“æœï¼š 12127.0.0.1:6379&gt; sdiff myset3 myset21) &quot;one&quot; è¿™ä¸ªç»“æœä¸­åªæ˜¾ç¤ºäº†ï¼Œmyset3ä¸­çš„å…ƒç´ ä¸myset2ä¸­ä¸åŒçš„å…ƒç´ ã€‚ sdiffstoreè¿”å›æ‰€æœ‰ç»™å®škeyä¸ç¬¬ä¸€ä¸ªkeyçš„å·®é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚ 12345678910127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sdiffstore myset4 myset2 myset3(integer) 1127.0.0.1:6379&gt; smembers myset41) &quot;two&quot; sinter è¿”å›æ‰€æœ‰ç»™å®škeyçš„äº¤é›†ã€‚ 12345678127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sinter myset2 myset31) &quot;three&quot; é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„äº¤é›†twoè¢«æŸ¥å‡ºæ¥äº†ã€‚ sinterstore è¿”å›æ‰€æœ‰ç»™å®škeyçš„äº¤é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚ 12345678910127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sinterstore myset5 myset2 myset3(integer) 1127.0.0.1:6379&gt; smembers myset51) &quot;three&quot; é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„äº¤é›†è¢«ä¿å­˜åˆ°myset5ä¸­äº†ã€‚ sunion è¿”å›æ‰€æœ‰ç»™å®škeyçš„å¹¶é›†ã€‚ 12345678910127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sunion myset2 myset31) &quot;three&quot;2) &quot;one&quot;3) &quot;two&quot; é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„å¹¶é›†è¢«æŸ¥å‡ºæ¥äº†ã€‚ sunionstore è¿”å›æ‰€æœ‰ç»™å®škeyçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚ 123456789101112127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; sunionstore myset6 myset2 myset3(integer) 3127.0.0.1:6379&gt; smembers myset61) &quot;three&quot;2) &quot;one&quot;3) &quot;two&quot; é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„å¹¶é›†è¢«ä¿å­˜åˆ°myset6ä¸­äº†ã€‚ smove ä»ç¬¬ä¸€ä¸ªkeyå¯¹åº”çš„setä¸­ç§»é™¤memberå¹¶æ·»åŠ åˆ°ç¬¬äºŒä¸ªå¯¹åº”setä¸­ã€‚ 1234567127.0.0.1:6379&gt; smembers myset21) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; smove myset2 myset7 three(integer) 1127.0.0.1:6379&gt; smembers myset71) &quot;three&quot; é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œmyset2çš„threeè¢«ç§»åˆ°myset7ä¸­äº†ã€‚ scard è¿”å›åç§°ä¸ºkeyçš„setçš„å…ƒç´ ä¸ªæ•°ã€‚ 12127.0.0.1:6379&gt; scard myset2(integer) 1 sismember æµ‹è¯•memberæ˜¯å¦æ˜¯åç§°ä¸ºkeyçš„setçš„å…ƒç´ ã€‚ 123456127.0.0.1:6379&gt; smembers myset21) &quot;two&quot;127.0.0.1:6379&gt; sismember myset2 two(integer) 1127.0.0.1:6379&gt; sismember myset2 one(integer) 0 é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œtwoæ˜¯myset2çš„æˆå‘˜ï¼Œè€Œoneä¸æ˜¯ã€‚ srandmember éšæœºè¿”å›åç§°ä¸ºkeyçš„setçš„ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ä¸åˆ é™¤å…ƒç´ ã€‚ 123456789127.0.0.1:6379&gt; smembers myset31) &quot;three&quot;2) &quot;one&quot;127.0.0.1:6379&gt; srandmember myset3&quot;three&quot;127.0.0.1:6379&gt; srandmember myset3&quot;one&quot;127.0.0.1:6379&gt; srandmember myset3&quot;one&quot; é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡è¿”å›äº†å…ƒç´ â€oneâ€ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åˆ é™¤â€oneâ€å…ƒç´ ã€‚ Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰sorted setæ˜¯setçš„ä¸€ä¸ªå‡çº§ç‰ˆæœ¬ï¼Œå®ƒåœ¨setçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªé¡ºåºå±æ€§ï¼Œè¿™ä¸€å±æ€§åœ¨æ·»åŠ ä¿®æ”¹å…ƒç´ çš„æ—¶å€™å¯ä»¥æŒ‡å®šï¼Œæ¯æ¬¡æŒ‡å®šåï¼Œzsetä¼šè‡ªåŠ¨é‡æ–°æŒ‰æ–°çš„å€¼è°ƒæ•´é¡ºåºã€‚å¯ä»¥ç†è§£ä¸ºæœ‰ä¸¤åˆ—çš„mysqlè¡¨ï¼Œä¸€åˆ—å­˜valueï¼Œä¸€åˆ—å­˜é¡ºåºã€‚ å’Œsetä¸€æ ·sorted setä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„scoreã€‚sorted setçš„å®ç°æ˜¯skip listå’Œhash tableçš„æ··åˆä½“ã€‚ zadd å‘åç§°ä¸ºkeyçš„zsetä¸­æ·»åŠ å…ƒç´ memberï¼Œscoreç”¨äºæ’åºã€‚å¦‚æœè¯¥å…ƒç´ å·²ç»å­˜åœ¨ï¼Œåˆ™æ ¹æ®scoreæ›´æ–°è¯¥å…ƒç´ çš„é¡ºåºã€‚ 1234567891011127.0.0.1:6379&gt; zadd myzset 1 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset 2 &quot;two&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset 3 &quot;two&quot;(integer) 0127.0.0.1:6379&gt; zrange myzset 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot;3) &quot;two&quot;4) &quot;3&quot; zrem åˆ é™¤åç§°ä¸ºkeyçš„zsetä¸­çš„å…ƒç´ memberã€‚ 12345678910127.0.0.1:6379&gt; zrange myzset 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot;3) &quot;two&quot;4) &quot;3&quot;127.0.0.1:6379&gt; zrem myzset two(integer) 1127.0.0.1:6379&gt; zrange myzset 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot; å¯ä»¥çœ‹åˆ°twoè¢«åˆ é™¤äº†ã€‚ zincrby å¦‚æœåœ¨åç§°ä¸ºkeyçš„zsetä¸­å·²ç»å­˜åœ¨å…ƒç´ memberï¼Œåˆ™è¯¥å…ƒç´ çš„scoreå¢åŠ incrementï¼›å¦åˆ™å‘é›†åˆä¸­æ·»åŠ è¯¥å…ƒç´ ï¼Œå…¶scoreçš„å€¼ä¸ºincrementã€‚ 1234567891011127.0.0.1:6379&gt; zadd myzset2 1 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset2 2 &quot;two&quot;(integer) 1127.0.0.1:6379&gt; zincrby myzset2 2 &quot;one&quot;&quot;3&quot;127.0.0.1:6379&gt; zrange myzset2 0 -1 withscores1) &quot;two&quot;2) &quot;2&quot;3) &quot;one&quot;4) &quot;3&quot; æœ¬ä¾‹ä¸­å°†oneçš„scoreä»1å¢åŠ äº†2ï¼Œå¢åŠ åˆ°äº†3ã€‚ zrank è¿”å›åç§°ä¸ºkeyçš„zsetä¸­memberå…ƒç´ çš„æ’å(æŒ‰scoreä»å°åˆ°å¤§æ’åº)å³ä¸‹æ ‡ã€‚ 12345678910111213141516171819127.0.0.1:6379&gt; zadd myzset3 1 &quot;one&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset3 2 &quot;two&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset3 3 &quot;three&quot;(integer) 1127.0.0.1:6379&gt; zadd myzset3 5 &quot;five&quot;(integer) 1127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot;3) &quot;two&quot;4) &quot;2&quot;5) &quot;three&quot;6) &quot;3&quot;7) &quot;five&quot;8) &quot;5&quot;127.0.0.1:6379&gt; zrank myzset3 two(integer) 1 zrevrank è¿”å›åç§°ä¸ºkeyçš„zsetä¸­memberå…ƒç´ çš„æ’å(æŒ‰scoreä»å¤§åˆ°å°æ’åº)å³ä¸‹æ ‡ã€‚ 1234567891011127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot;3) &quot;two&quot;4) &quot;2&quot;5) &quot;three&quot;6) &quot;3&quot;7) &quot;five&quot;8) &quot;5&quot;127.0.0.1:6379&gt; zrevrank myzset3 two(integer) 2 æŒ‰ä»å¤§åˆ°å°æ’åºçš„è¯twoæ˜¯ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œä¸‹æ ‡æ˜¯2ã€‚ zrevrange è¿”å›åç§°ä¸ºkeyçš„zsetï¼ˆæŒ‰scoreä»å¤§åˆ°å°æ’åºï¼‰ä¸­çš„indexä»startåˆ°endçš„æ‰€æœ‰å…ƒç´ ã€‚ 123456789127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;five&quot;2) &quot;5&quot;3) &quot;three&quot;4) &quot;3&quot;5) &quot;two&quot;6) &quot;2&quot;7) &quot;one&quot;8) &quot;1&quot; zrangebyscore è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚ 1234567891011121314127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores1) &quot;one&quot;2) &quot;1&quot;3) &quot;two&quot;4) &quot;2&quot;5) &quot;three&quot;6) &quot;3&quot;7) &quot;five&quot;8) &quot;5&quot;127.0.0.1:6379&gt; zrangebyscore myzset3 2 3 withscores1) &quot;two&quot;2) &quot;2&quot;3) &quot;three&quot;4) &quot;3&quot; zcount è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„æ•°é‡ã€‚ 1234567891011127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;five&quot;2) &quot;5&quot;3) &quot;three&quot;4) &quot;3&quot;5) &quot;two&quot;6) &quot;2&quot;7) &quot;one&quot;8) &quot;1&quot;127.0.0.1:6379&gt; zcount myzset3 2 3(integer) 2 zcard è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°ã€‚ 1234567891011127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;five&quot;2) &quot;5&quot;3) &quot;three&quot;4) &quot;3&quot;5) &quot;two&quot;6) &quot;2&quot;7) &quot;one&quot;8) &quot;1&quot;127.0.0.1:6379&gt; zcard myzset3(integer) 4 zscore è¿”å›ç»™å®šå…ƒç´ å¯¹åº”çš„scoreã€‚ 1234567891011127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;five&quot;2) &quot;5&quot;3) &quot;three&quot;4) &quot;3&quot;5) &quot;two&quot;6) &quot;2&quot;7) &quot;one&quot;8) &quot;1&quot;127.0.0.1:6379&gt; zscore myzset3 two&quot;2&quot; zremrangebyrank åˆ é™¤é›†åˆä¸­æ’ååœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚ 123456789101112131415161718127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;five&quot;2) &quot;5&quot;3) &quot;three&quot;4) &quot;3&quot;5) &quot;two&quot;6) &quot;2&quot;7) &quot;one&quot;8) &quot;1&quot;127.0.0.1:6379&gt; zremrangebyrank myzset3 3 3(integer) 1127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;three&quot;2) &quot;3&quot;3) &quot;two&quot;4) &quot;2&quot;5) &quot;one&quot;6) &quot;1&quot; åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†myzset3ä¸­æŒ‰ä»å°åˆ°å¤§æ’åºç»“æœçš„ä¸‹æ ‡ä¸º3çš„å…ƒç´ åˆ é™¤äº†ã€‚ zremrangebyscore åˆ é™¤é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚ 123456789101112127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;three&quot;2) &quot;3&quot;3) &quot;two&quot;4) &quot;2&quot;5) &quot;one&quot;6) &quot;1&quot;127.0.0.1:6379&gt; zremrangebyscore myzset3 1 2(integer) 2127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores1) &quot;three&quot;2) &quot;3&quot; åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†myzset3ä¸­æŒ‰ä»å°åˆ°å¤§æ’åºç»“æœçš„scoreåœ¨1~2ä¹‹é—´çš„å…ƒç´ åˆ é™¤äº†ã€‚ Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ã€‚å®ƒçš„æ·»åŠ ã€åˆ é™¤æ“ä½œéƒ½æ˜¯O(1)ï¼ˆå¹³å‡ï¼‰ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ ç›¸è¾ƒäºå°†å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå­˜æˆå•ä¸ªstringç±»å‹ï¼Œå°†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨åœ¨hashç±»å‹ä¸­ä¼šå ç”¨æ›´å°‘çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ–¹ä¾¿çš„å­˜å–æ•´ä¸ªå¯¹è±¡ã€‚ hset è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚ 12127.0.0.1:6379&gt; hset myhash field1 Hello(integer) 1 hsetnx è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚å¦‚æœfieldå·²ç»å­˜åœ¨ï¼Œè¿”å›0ï¼Œnxæ˜¯not existçš„æ„æ€ã€‚ 1234127.0.0.1:6379&gt; hsetnx myhash field &quot;Hello&quot;(integer) 1127.0.0.1:6379&gt; hsetnx myhash field &quot;Hello&quot;(integer) 0 ç¬¬ä¸€æ¬¡æ‰§è¡Œæ˜¯æˆåŠŸçš„ï¼Œä½†ç¬¬äºŒæ¬¡æ‰§è¡Œç›¸åŒçš„å‘½ä»¤å¤±è´¥ï¼ŒåŸå› æ˜¯fieldå·²ç»å­˜åœ¨äº†ã€‚ hmset åŒæ—¶è®¾ç½®hashçš„å¤šä¸ªfieldã€‚ 12127.0.0.1:6379&gt; hmset myhash field1 Hello field2 WorldOK hget è·å–æŒ‡å®šçš„hash fieldã€‚ 123456127.0.0.1:6379&gt; hget myhash field1&quot;Hello&quot;127.0.0.1:6379&gt; hget myhash field2&quot;World&quot;127.0.0.1:6379&gt; hget myhash field3(nil) ç”±äºæ•°æ®åº“æ²¡æœ‰field3ï¼Œæ‰€ä»¥å–åˆ°çš„æ˜¯ä¸€ä¸ªç©ºå€¼nilã€‚ hmget è·å–å…¨éƒ¨æŒ‡å®šçš„hash filedã€‚ 1234127.0.0.1:6379&gt; hmget myhash field1 field2 field31) &quot;Hello&quot;2) &quot;World&quot;3) (nil) ç”±äºæ•°æ®åº“æ²¡æœ‰field3ï¼Œæ‰€ä»¥å–åˆ°çš„æ˜¯ä¸€ä¸ªç©ºå€¼nilã€‚ hincrby ç»™æŒ‡å®šçš„hash filed åŠ ä¸Šç»™å®šå€¼ã€‚ 12345678127.0.0.1:6379&gt; hset myhash field3 20(integer) 1127.0.0.1:6379&gt; hget myhash field3 &quot;20&quot;127.0.0.1:6379&gt; hincrby myhash field3 -8(integer) 12127.0.0.1:6379&gt; hget myhash field3&quot;12&quot; åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†field3çš„å€¼ä»20é™åˆ°äº†12ï¼Œå³åšäº†ä¸€ä¸ªå‡8çš„æ“ä½œã€‚ hexists æµ‹è¯•æŒ‡å®šfieldæ˜¯å¦å­˜åœ¨ã€‚ 1234127.0.0.1:6379&gt; hexists myhash field1(integer) 1127.0.0.1:6379&gt; hexists myhash field9(integer) 0 é€šè¿‡ä¸Šä¾‹å¯ä»¥è¯´æ˜field1å­˜åœ¨ï¼Œä½†field9æ˜¯ä¸å­˜åœ¨çš„ã€‚ hlen è¿”å›æŒ‡å®šhashçš„fieldæ•°é‡ã€‚ 12127.0.0.1:6379&gt; hlen myhash(integer) 4 é€šè¿‡ä¸Šä¾‹å¯ä»¥çœ‹åˆ°myhashä¸­æœ‰4ä¸ªfieldã€‚ hdel åˆ é™¤æŒ‡å®šhashçš„æŒ‡å®šfieldã€‚ 123456127.0.0.1:6379&gt; hlen myhash(integer) 4127.0.0.1:6379&gt; hdel myhash field1(integer) 1127.0.0.1:6379&gt; hlen myhash(integer) 3 hkeys è¿”å›hashçš„æ‰€æœ‰fieldã€‚ 1234127.0.0.1:6379&gt; hkeys myhash1) &quot;field&quot;2) &quot;field2&quot;3) &quot;field3&quot; hvals è¿”å›hashçš„æ‰€æœ‰valueã€‚ 1234127.0.0.1:6379&gt; hvals myhash1) &quot;Hello&quot;2) &quot;World&quot;3) &quot;12&quot; hgetall è·å–æŸä¸ªhashä¸­å…¨éƒ¨çš„filedåŠvalueã€‚ 1234567127.0.0.1:6379&gt; hgetall myhash1) &quot;field&quot;2) &quot;Hello&quot;3) &quot;field2&quot;4) &quot;World&quot;5) &quot;field3&quot;6) &quot;12&quot; ä¸€ä¸‹å­å°†myhashä¸­æ‰€æœ‰çš„fieldåŠå¯¹åº”çš„valueéƒ½å–å‡ºæ¥äº†ã€‚","tags":[{"name":"Redis","slug":"Redis","permalink":"https://gcdd1993.github.io/tags/Redis/"},{"name":"NoSql","slug":"NoSql","permalink":"https://gcdd1993.github.io/tags/NoSql/"}]},{"title":"Ubuntuåˆ‡æ¢ä¸ºé˜¿é‡Œé•œåƒæº","date":"2019-05-25T15:45:14.000Z","path":"p/12805/","text":"å‰è¨€åœ¨VMè™šæ‹Ÿæœºæ­å»ºUbuntuç³»ç»Ÿå­¦ä¹ æˆ–è€…æµ‹è¯•æ—¶ï¼Œå¸¸å¸¸è¦ä½¿ç”¨aptå®‰è£…æµ‹è¯•ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè‡ªå¸¦çš„ä¸‹è½½æºåœ¨å›½å¤–æœåŠ¡å™¨ä¸Šï¼Œä¸‹è½½é€Ÿåº¦æ…¢çš„æ— æ³•å¿å—ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ‡æ¢ä¸ºå›½å†…é•œåƒæºï¼Œèƒ½æ˜¾è‘—åŠ å¿«å®‰è£…åŒ…ä¸‹è½½é€Ÿåº¦ã€‚ æ­¥éª¤123456$ cd /etc/apt/$ cp sources.list sources.list.bak ## å¤‡ä»½ç³»ç»Ÿè‡ªå¸¦çš„sourceåˆ—è¡¨## é€‰æ‹©åˆé€‚çš„é•œåƒæºï¼Œå¦‚é˜¿é‡Œäº‘çš„é•œåƒ http://mirrors.aliyun.com/ubuntu$ sed -i &#x27;s/^\\(deb\\|deb-src\\) \\([^ ]*\\) \\(.*\\)/\\1 http:\\/\\/mirrors.aliyun.com\\/ubuntu \\3/&#x27; sources.list## æ›´æ–°apt$ apt-get update å›½å†…é•œåƒæº åç§° åœ°å€ é˜¿é‡Œé•œåƒæº http://mirrors.aliyun.com/ubuntu æ¸…åå¤§å­¦é•œåƒæº https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ ç½‘æ˜“é•œåƒæº https://mirrors.163.com/ubuntu/ ä¸œåŒ—å¤§å­¦é•œåƒæº http://mirror.neu.edu.cn/ubuntu/ è‡³äºå“ªä¸ªæºæ¯”è¾ƒå¿«ï¼Œçœ‹ä¸ªäººçš„ç½‘ç»œå§ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•ä¸‹ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯é˜¿é‡Œé•œåƒæºã€‚","tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://gcdd1993.github.io/tags/Ubuntu/"}]},{"title":"Cassandraå­¦ä¹ ç¬”è®°","date":"2019-05-22T07:42:04.000Z","path":"p/60138/","text":"å‡†å¤‡æŒ‰ç…§Cassandraé›†ç¾¤éƒ¨ç½²æ­å»ºä¸¤å°æµ‹è¯•æœºï¼Œç¯å¢ƒä¿¡æ¯å¦‚ä¸‹ï¼š åç§° IP æ•°æ®ä¸­å¿ƒåç§° node-01 192.168.198.130 datacenter1 node-02 192.168.198.131 datacenter1 Keyspaceåˆ›å»ºKeyspace1create_keyspace_statement ::= CREATE KEYSPACE [ IF NOT EXISTS ] keyspace_name WITH options ç¤ºä¾‹ï¼š 1234567891011121314## ä½¿ç”¨SimpleStrategyå¤åˆ¶ç­–ç•¥CREATE KEYSPACE excelsior WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125;;## ä½¿ç”¨NetworkTopologyStrategyå¤åˆ¶ç­–ç•¥# 1. ç¡®è®¤åˆ†åŒºåç§°$ nodetool statusDatacenter: datacenter1...# 2. ä½¿ç”¨NetworkTopologyStrategyå¤åˆ¶ç­–ç•¥åˆ›å»ºkeyspaceCREATE KEYSPACE excalibur WITH replication = &#123;&#x27;class&#x27;: &#x27;NetworkTopologyStrategy&#x27;, &#x27;DC1&#x27; : 1, &#x27;DC2&#x27; : 3&#125; AND durable_writes = false; ä½¿ç”¨Keyspace1use_statement ::= USE keyspace_name ä¿®æ”¹Keyspaceï¼ˆreplication factorï¼‰1alter_keyspace_statement ::= ALTER KEYSPACE keyspace_name WITH options ç¤ºä¾‹ï¼š 12ALTER KEYSPACE excelsior WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 4&#125;; æŸ¥çœ‹Keyspace1DESCRIBE KEYSPACE &lt;keyspace name&gt;; ä½¿ç”¨è¯¥è¯­å¥æŸ¥çœ‹åˆ›å»ºçš„é”®ç©ºé—´æ˜¯å¦æ­£ç¡®ï¼š 123DESCRIBE KEYSPACE excelsior;CREATE KEYSPACE excelsior WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125; AND durable_writes = true; åˆ é™¤Keyspace1drop_keyspace_statement ::= DROP KEYSPACE [ IF EXISTS ] keyspace_name 1234DROP KEYSPACE excelsior;DESCRIBE excelsior;&#x27;excelsior&#x27; not found in keyspaces Tableåˆ›å»ºTable123456789101112131415create_table_statement ::= CREATE TABLE [ IF NOT EXISTS ] table_name &#x27;(&#x27; column_definition ( &#x27;,&#x27; column_definition )* [ &#x27;,&#x27; PRIMARY KEY &#x27;(&#x27; primary_key &#x27;)&#x27; ] &#x27;)&#x27; [ WITH table_options ]column_definition ::= column_name cql_type [ STATIC ] [ PRIMARY KEY]primary_key ::= partition_key [ &#x27;,&#x27; clustering_columns ]partition_key ::= column_name | &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27;clustering_columns ::= column_name ( &#x27;,&#x27; column_name )*table_options ::= COMPACT STORAGE [ AND table_options ] | CLUSTERING ORDER BY &#x27;(&#x27; clustering_order &#x27;)&#x27; [ AND table_options ] | optionsclustering_order ::= column_name (ASC | DESC) ( &#x27;,&#x27; column_name (ASC | DESC) )* åˆ›å»ºTableå¿…é¡»æŒ‡å®šä¸»é”®ï¼Œä¸»é”®æ˜¯ç”¨äºåœ¨è¡¨ä¸­å”¯ä¸€æ ‡è¯†æŸä¸€è¡Œï¼Œå¯ä»¥æ˜¯ä¸€åˆ—æˆ–å¤šåˆ—ã€‚ ç¤ºä¾‹ï¼Œåœ¨excelsioré”®ç©ºé—´åˆ›å»ºä¸€å¼ åä¸ºexcelsior_alt_stats çš„è¡¨ï¼š 12345678CREATE TABLE excelsior.excelsior_alt_stats ( id UUID PRIMARY KEY, lastname text, birthday timestamp, nationality text, weight text, height text); cassandraè¿˜æ”¯æŒcollectionï¼ˆmap, set, æˆ–è€… listï¼‰ç±»å‹ä½œä¸ºåˆ—ï¼š 1234567CREATE TABLE excelsior.whimsey ( id UUID PRIMARY KEY, lastname text, excelsior_teams set&lt;text&gt;, events list&lt;text&gt;, teams map&lt;int,text&gt; ); ç”šè‡³æ˜¯åµŒå¥—çš„å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰ï¼š 1234567CREATE TABLE excelsior.route ( race_id int, race_name text, point_id int, lat_long tuple&lt;text, tuple&lt;float,float&gt;&gt;, PRIMARY KEY (race_id, point_id)); æ›´å¤šæ•°æ®ç±»å‹è¯·å‚é˜…ä¸‹ä¸€èŠ‚Cassandraæ•°æ®ç»“æ„ é™æ€åˆ—æŸäº›åˆ—å¯ä»¥åœ¨è¡¨å®šä¹‰ä¸­å£°æ˜ä¸ºSTATICã€‚é™æ€çš„åˆ—å°†ç”±å±äºåŒä¸€åˆ†åŒºï¼ˆå…·æœ‰ç›¸åŒåˆ†åŒºé”®ï¼‰çš„æ‰€æœ‰è¡Œâ€œå…±äº«â€ã€‚ä¾‹å¦‚ï¼š 123456789101112131415161718CREATE TABLE t ( pk int, t int, v text, s text static, PRIMARY KEY (pk, t));INSERT INTO t (pk, t, v, s) VALUES (0, 0, &#x27;val0&#x27;, &#x27;static0&#x27;);INSERT INTO t (pk, t, v, s) VALUES (0, 1, &#x27;val1&#x27;, &#x27;static1&#x27;);SELECT * FROM t; pk | t | v | s ----+---+--------+----------- 0 | 0 | &#x27;val0&#x27; | &#x27;static1&#x27; 0 | 1 | &#x27;val1&#x27; | &#x27;static1&#x27; ## æ‰€æœ‰è®°å½•ä¸­çš„é™æ€åˆ—å°†æ°¸è¿œå±•ç¤ºæœ€åä¸€æ¬¡æ›´æ–°çš„å€¼ ä¿®æ”¹Table1234alter_table_statement ::= ALTER TABLE table_name alter_table_instructionalter_table_instruction ::= ADD column_name cql_type ( &#x27;,&#x27; column_name cql_type )* | DROP column_name ( column_name )* | WITH options ç¤ºä¾‹ï¼š 1234ALTER TABLE addamsFamily ADD gravesite varchar;ALTER TABLE addamsFamily WITH comment = &#x27;A most excellent and useful table&#x27;; ä¿®æ”¹Tableå¯ä»¥ï¼š å‘è¡¨ä¸­æ·»åŠ æ–°åˆ—ï¼ˆé€šè¿‡ADDæŒ‡ä»¤ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæ— æ³•æ›´æ”¹è¡¨çš„ä¸»é”®ï¼Œå› æ­¤æ–°æ·»åŠ çš„åˆ—å°†ä¸ä¼šæˆä¸ºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚ ä»è¡¨ä¸­åˆ é™¤åˆ—ã€‚è¿™ä¼šä¸¢å¼ƒåˆ—åŠå…¶æ‰€æœ‰å†…å®¹ã€‚ æ›´æ”¹ä¸€äº›è¡¨é€‰é¡¹ï¼ˆé€šè¿‡WITHæŒ‡ä»¤ï¼‰ã€‚æ”¯æŒçš„é€‰é¡¹ä¸åˆ›å»ºè¡¨æ—¶ç›¸åŒï¼ˆåœ¨åˆ›å»ºåæ— æ³•æ›´æ”¹çš„COMPACT STORAGEå’ŒCLUSTERING ORDERä¹‹å¤–ï¼‰ã€‚ åˆ é™¤Table1drop_table_statement ::= DROP TABLE [ IF EXISTS ] table_name æˆªæ–­Tableï¼ˆæ¸…ç©ºè¡¨æ•°æ®ï¼‰1truncate_statement ::= TRUNCATE [ TABLE ] table_name ç”±äºè¡¨æ˜¯å”¯ä¸€å¯ä»¥åœ¨å½“å‰æˆªæ–­çš„å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥çœç•¥TABLEå…³é”®å­—ã€‚ æˆªæ–­è¡¨ä¼šæ°¸ä¹…åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œä½†ä¸ä¼šåˆ é™¤è¡¨æœ¬èº«ã€‚ Cassandraæ•°æ®ç»“æ„ CQLæ˜¯ä¸€ç§ç±»å‹åŒ–è¯­è¨€ï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹é›†ï¼ŒåŒ…æ‹¬æœ¬åœ°ç±»å‹ï¼Œé›†åˆç±»å‹ï¼Œç”¨æˆ·å®šä¹‰ç±»å‹ï¼Œå…ƒç»„ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹ï¼š 1cql_type ::= native_type | collection_type | user_defined_type | tuple_type | custom_type æœ¬åœ°ç±»å‹ï¼ˆNative Typesï¼‰ ç±»å‹ å¸¸é‡æ”¯æŒ è¯´æ˜ ascii string ASCIIå­—ç¬¦ä¸² bigint integer 64ä½æ— ç¬¦å·æ•´æ•° blob blob ä»»æ„å­—èŠ‚ï¼ˆæ— éªŒè¯ï¼‰ boolean boolean trueæˆ–false counter integer è®¡æ•°å™¨åˆ—ï¼ˆ64ä½æœ‰ç¬¦å·å€¼ï¼‰ date integerï¼Œ string æ—¥æœŸï¼ˆæ²¡æœ‰ç›¸åº”çš„æ—¶é—´å€¼ï¼‰ decimal integerï¼Œ float åè¿›åˆ¶å¯å˜ç²¾åº¦ double integer float 64ä½IEEE-754æµ®ç‚¹ duration duration æŒç»­æ—¶é—´ï¼ˆçº³ç§’ç²¾åº¦ï¼‰ float integerï¼Œ float 32ä½IEEE-754æµ®ç‚¹ inet string IPåœ°å€ï¼ŒIPv4ï¼ˆ4å­—èŠ‚é•¿ï¼‰æˆ–IPv6ï¼ˆ16å­—èŠ‚é•¿ï¼‰ int integer 32ä½æ— ç¬¦å·æ•´æ•° smallint integer 16ä½æœ‰ç¬¦å·æ•´æ•° text string UTF8ç¼–ç çš„å­—ç¬¦ä¸² time integerï¼Œ string å…·æœ‰çº³ç§’ç²¾åº¦çš„æ—¶é—´ï¼ˆæ²¡æœ‰ç›¸åº”çš„æ—¥æœŸå€¼ï¼‰ timestamp integerï¼Œ string æ—¶é—´æˆ³ï¼ˆæ—¥æœŸå’Œæ—¶é—´ï¼‰ï¼Œç²¾åº¦ä¸ºæ¯«ç§’ timeuuid uuid UUIDï¼ˆç‰ˆæœ¬1ï¼‰ï¼Œé€šå¸¸ç”¨ä½œâ€œæ— å†²çªâ€æ—¶é—´æˆ³ tinyint integer 8ä½æœ‰ç¬¦å·æ•´æ•° uuid uuid ä¸€ä¸ªUUIDï¼ˆä»»ä½•ç‰ˆæœ¬ï¼‰ varchar string UTF8ç¼–ç çš„å­—ç¬¦ä¸² varint integer ä»»æ„ç²¾åº¦æ•´æ•° å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯æ—¶é—´ç±»å‹ï¼š timestamps æ—¶é—´æˆ³ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º64ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºè‡ªæ ‡å‡†åŸºå‡†æ—¶é—´ï¼ˆç§°ä¸ºçºªå…ƒï¼š1970å¹´1æœˆ1æ—¥æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´00:00:00ï¼‰ä»¥æ¥çš„æ¯«ç§’æ•°ã€‚ 1299038700000 &#39;2011-02-03 04:05+0000&#39; &#39;2011-02-03 04:05:00+0000&#39; &#39;2011-02-03 04:05:00.000+0000&#39; &#39;2011-02-03T04:05+0000&#39; &#39;2011-02-03T04:05:00+0000&#39; &#39;2011-02-03T04:05:00.000+0000&#39; ä¾‹å¦‚ï¼š 123SELECT *FROM pointWHERE ts = &#x27;2018-11-15 00:00:30.557+0000&#x27;; æˆ–è€… 123SELECT *FROM pointWHERE ts = 1542211230557; å…¶ä¸­ï¼Œ+0000æ˜¯RFC 822 4-digitæ—¶åŒºè§„èŒƒï¼Œ+0000æŒ‡GMTã€‚ç¾å›½å¤ªå¹³æ´‹æ ‡å‡†æ—¶é—´ä¸º-0800ï¼Œä¸­å›½åŒ—äº¬æ ‡å‡†æ—¶é—´ä¸º+8000ï¼Œå®˜æ–¹å»ºè®®æ¯æ¬¡æ’å…¥æŸ¥è¯¢éƒ½å¸¦ä¸Šæ—¶åŒºï¼Œä¸åŠ çš„è¯ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨CassandraèŠ‚ç‚¹é…ç½®çš„æ—¶åŒºï¼Œå¯èƒ½ä¼šå‡ºç°æ—¶åŒºä¸ä¸€è‡´å¯¼è‡´çš„æŸ¥è¯¢å¤±è´¥é—®é¢˜ã€‚ dates æ—¥æœŸç±»å‹çš„å€¼è¢«ç¼–ç ä¸º32ä½æ— ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºåœ¨è¯¥èŒƒå›´çš„ä¸­å¿ƒå¤„å…·æœ‰â€œçºªå…ƒâ€çš„å¤©æ•°ï¼ˆ2^31ï¼‰ã€‚å¤§çºªå…ƒæ˜¯1970å¹´1æœˆ1æ—¥ã€‚ è‡³äºæ—¶é—´æˆ³ï¼Œæ—¥æœŸå¯ä»¥ä½œä¸ºæ•´æ•°æˆ–ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²è¾“å…¥ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ ¼å¼åº”ä¸ºyyyy-mm-ddï¼ˆä¾‹å¦‚â€™2011-02-03â€™ï¼‰ã€‚ times æ—¶é—´ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º64ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºè‡ªåˆå¤œä»¥æ¥çš„çº³ç§’æ•°ã€‚ å¯¹äºæ—¶é—´æˆ³ï¼Œå¯ä»¥ä»¥æ•´æ•°æˆ–è¡¨ç¤ºæ—¶é—´çš„å­—ç¬¦ä¸²çš„å½¢å¼è¾“å…¥æ—¶é—´ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ ¼å¼åº”ä¸ºhh:mm:ss [.fffffffff]ï¼ˆå…¶ä¸­äºšç§’ç²¾åº¦æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæä¾›ï¼Œåˆ™å¯ä»¥å°äºçº³ç§’ï¼‰ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€æ®µæ—¶é—´å†…çš„æœ‰æ•ˆè¾“å…¥ï¼š &#39;08:12:54&#39; &#39;08:12:54.123&#39; &#39;08:12:54.123456&#39; &#39;08:12:54.123456789&#39; durations æŒç»­æ—¶é—´ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º3ä¸ªæœ‰ç¬¦å·æ•´æ•°çš„å¯å˜é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºä¸€ä¸ªæœˆçš„å¤©æ•°å¯ä»¥æ”¹å˜ï¼Œä¸€å¤©å¯ä»¥æœ‰23æˆ–25å°æ—¶ï¼Œå…·ä½“å–å†³äºå¤ä»¤æ—¶ã€‚ ç¬¬ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæœˆæ•°ï¼ˆ32ä½æ•´æ•°ï¼‰ ç¬¬äºŒä¸ªè¡¨ç¤ºå¤©æ•°ï¼ˆ32ä½æ•´æ•°ï¼‰ ç¬¬ä¸‰ä¸ªè¡¨ç¤ºçº³ç§’æ•°ï¼ˆ64ä½æ•´æ•°ï¼‰ æ”¯æŒçš„å•ä½ï¼š y: å¹´(12 æœˆ) mo: æœˆ (1 æœˆ) w: å‘¨(7 å¤©) d: å¤©(1 å¤©) h: å°æ—¶(3,600,000,000,000 çº³ç§’) m: åˆ†é’Ÿ(60,000,000,000 çº³) s: ç§’(1,000,000,000 çº³) ms: æ¯«ç§’(1,000,000 çº³) us or Âµs : å¾®å¦™(1000 çº³) ns: çº³ç§’(1 çº³) ISO 8601æ ¼å¼ï¼šP[n]Y[n]M[n]DT[n]H[n]M[n]S or P[n]W ISO 8601æ›¿ä»£æ ¼å¼ï¼šP[YYYY]-[MM]-[DD]T[hh]:[mm]:[ss] æ’å…¥ç¤ºä¾‹ï¼š 123INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;Christopher Froome&#x27;, &#x27;Tour de France&#x27;, 89h4m48s);INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;BARDET Romain&#x27;, &#x27;Tour de France&#x27;, PT89H8M53S);INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;QUINTANA Nairo&#x27;, &#x27;Tour de France&#x27;, P0000-00-00T89:09:09); æŒç»­æ—¶é—´åˆ—ä¸èƒ½ä½œä¸ºä¸»é”®ã€‚è¿™æ˜¯ç”±äºæ— æ³•ç²¾ç¡®ç¡®è®¤æŒç»­æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰æ—¥æœŸä¸Šä¸‹æ–‡ï¼Œå®é™…ä¸Šä¸å¯èƒ½çŸ¥é“1ä¸ªæœˆæ˜¯å¦å¤§äº29å¤©ã€‚ 1å¤©çš„æŒç»­æ—¶é—´ä¹Ÿä¸ç­‰äº24hï¼Œå› ä¸ºæŒç»­æ—¶é—´ç±»å‹éœ€è¦æ”¯æŒå¤ä»¤æ—¶ã€‚ é›†åˆç±»å‹ï¼ˆCollectionsï¼‰cassandraæ”¯æŒä¸‰ç§ç±»å‹çš„é›†åˆï¼šMaps, Sets and Lists 123collection_type ::= MAP &#x27;&lt;&#x27; cql_type &#x27;,&#x27; cql_type &#x27;&gt;&#x27; | SET &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27; | LIST &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27; å¯ä»¥è¿™æ ·è¾“å…¥é›†åˆç±»å‹çš„æ•°æ®ï¼š 1234collection_literal ::= map_literal | set_literal | list_literalmap_literal ::= &#x27;&#123;&#x27; [ term &#x27;:&#x27; term (&#x27;,&#x27; term : term)* ] &#x27;&#125;&#x27;set_literal ::= &#x27;&#123;&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;&#125;&#x27;list_literal ::= &#x27;[&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;]&#x27; Maps Mapsæ˜¯ä¸€ç»„ï¼ˆæœ‰åºï¼‰é”®å€¼å¯¹ï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æŒ‰å…¶é”®æ’åºã€‚ 1234567891011CREATE TABLE users ( id text PRIMARY KEY, name text, favs map&lt;text, text&gt; // A map of text keys, and text values);INSERT INTO users (id, name, favs) VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);// Replace the existing map entirely.UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;; å¦å¤–ï¼ŒMapsè¿˜å…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š æ›´æ–°æˆ–æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  12UPDATE users SET favs[&#x27;author&#x27;] = &#x27;Ed Poe&#x27; WHERE id = &#x27;jsmith&#x27;;UPDATE users SET favs = favs + &#123; &#x27;movie&#x27; : &#x27;Cassablanca&#x27;, &#x27;band&#x27; : &#x27;ZZ Top&#x27; &#125; WHERE id = &#x27;jsmith&#x27;; åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå¦‚æœä¸€ä¸ªå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ é™¤å®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œä½†ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰ 12DELETE favs[&#x27;author&#x27;] FROM users WHERE id = &#x27;jsmith&#x27;;UPDATE users SET favs = favs - &#123; &#x27;movie&#x27;, &#x27;band&#x27;&#125; WHERE id = &#x27;jsmith&#x27;; Sets Setsæ˜¯å”¯ä¸€å€¼çš„ï¼ˆå·²æ’åºï¼‰é›†åˆã€‚ 1234567891011CREATE TABLE users ( id text PRIMARY KEY, name text, favs map&lt;text, text&gt; // A map of text keys, and text values);INSERT INTO users (id, name, favs) VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);// Replace the existing map entirely.UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;; å¦å¤–ï¼ŒSetsä¹Ÿå…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé›†åˆï¼Œæ’å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ æ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œï¼‰ 1UPDATE images SET tags = tags + &#123; &#x27;gray&#x27;, &#x27;cuddly&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;; åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå¦‚æœä¸€ä¸ªå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ é™¤å®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œä½†ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰ 1UPDATE images SET tags = tags - &#123; &#x27;cat&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;; Lists Listsæ˜¯éå”¯ä¸€å€¼çš„ï¼ˆå·²æ’åºï¼‰é›†åˆï¼Œå…¶ä¸­å…ƒç´ æŒ‰åˆ—è¡¨ä¸­çš„ä½ç½®æ’åºã€‚å®ƒä¸Setsçš„åŒºåˆ«å°±åœ¨äºæ˜¯å¦æ˜¯å”¯ä¸€å€¼ã€‚ 123456789101112CREATE TABLE plays ( id text PRIMARY KEY, game text, players int, scores list&lt;int&gt; // A list of integers)INSERT INTO plays (id, game, players, scores) VALUES (&#x27;123-afde&#x27;, &#x27;quake&#x27;, 3, [17, 4, 2]);// Replace the existing list entirelyUPDATE plays SET scores = [ 3, 9, 4] WHERE id = &#x27;123-afde&#x27;; å¦å¤–ï¼ŒListsåŒæ ·ä¹Ÿå…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š åœ¨åˆ—è¡¨å¤´æˆ–å°¾æ·»åŠ å…ƒç´  12UPDATE plays SET players = 5, scores = scores + [ 14, 21 ] WHERE id = &#x27;123-afde&#x27;;UPDATE plays SET players = 6, scores = [ 3 ] + scores WHERE id = &#x27;123-afde&#x27;; ğŸ’¡è¯¥æ“ä½œä¸æ˜¯å¹‚ç­‰çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¶ä¸­ä¸€ä¸ªæ“ä½œè¶…æ—¶æ—¶ï¼Œé‡è¯•æ“ä½œæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒä¸€æ•°æ®æ’å…¥ä¸¤æ¬¡ã€‚ åœ¨åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡å¤„è®¾ç½®å€¼ã€‚è¯¥åˆ—è¡¨å¿…é¡»é•¿åº¦å¤§äºæ­¤ä¸‹æ ‡ï¼Œå¦åˆ™å°†æŠ›å‡ºåˆ—è¡¨å¤ªå°çš„é”™è¯¯ 1UPDATE plays SET scores[1] = 7 WHERE id = &#x27;123-afde&#x27;; é€šè¿‡åˆ—è¡¨æŒ‡å®šä¸‹æ ‡åˆ é™¤å…ƒç´ ã€‚è¯¥åˆ—è¡¨å¿…é¡»é•¿åº¦å¤§äºæ­¤ä¸‹æ ‡ï¼Œå¦åˆ™å°†æŠ›å‡ºåˆ—è¡¨å¤ªå°çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå½“æ“ä½œä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œåˆ—è¡¨å¤§å°å°†å‡1ï¼Œä»è€Œæ”¹å˜æ­¤ä¸‹æ ‡ä¹‹åæ‰€æœ‰å…ƒç´ çš„ä½ç½® 1DELETE scores[1] FROM plays WHERE id = &#x27;123-afde&#x27;; åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä¹‹é—´çš„æ‰€æœ‰å…ƒç´  1UPDATE plays SET scores = scores - [ 12, 21 ] WHERE id = &#x27;123-afde&#x27;; ğŸ’¡ä»¥ä¸Š2,3,4æ“ä½œä¼šå‡ºç°å†…éƒ¨çš„ read-before-writeï¼Œä¼šæ¯”é€šå¸¸çš„æ›´æ–°æ¶ˆè€—æ›´å¤šçš„èµ„æºï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨Setsä»£æ›¿Listsã€‚ ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUser-Defined Typesï¼‰ CQLæ”¯æŒç”¨æˆ·å®šä¹‰ç±»å‹ï¼ˆä»¥ä¸‹ç®€ç§°UDTï¼‰ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢create_type_statementï¼Œalter_type_statementå’Œdrop_type_statementåˆ›å»ºï¼Œä¿®æ”¹å’Œåˆ é™¤æ­¤ç±»å‹ã€‚ 12user_defined_type ::= udt_nameudt_name ::= [ keyspace_name &#x27;.&#x27; ] identifier åˆ›å»º123create_type_statement ::= CREATE TYPE [ IF NOT EXISTS ] udt_name &#x27;(&#x27; field_definition ( &#x27;,&#x27; field_definition )* &#x27;)&#x27;field_definition ::= identifier cql_type UDTæœ‰ä¸€ä¸ªåç§°ï¼ˆç”¨äºå£°æ˜è¯¥ç±»å‹çš„åˆ—ï¼‰ï¼Œæ˜¯ä¸€ç»„å‘½åå’Œç±»å‹å­—æ®µã€‚å­—æ®µåç§°å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬é›†åˆæˆ–å…¶ä»–UDTã€‚ä¾‹å¦‚ï¼š 12345678910111213141516CREATE TYPE phone ( country_code int, number text,)CREATE TYPE address ( street text, city text, zip text, phones map&lt;text, phone&gt;)CREATE TABLE user ( name text PRIMARY KEY, addresses map&lt;text, frozen&lt;address&gt;&gt;) ğŸ’¡æ³¨æ„ å°è¯•åˆ›å»ºç°æœ‰ç±»å‹æ—¶è¯·ä½¿ç”¨IF NOT EXISTSé€‰é¡¹ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºé”™è¯¯ã€‚ UDTæœ¬è´¨ä¸Šç»‘å®šåˆ°åˆ›å»ºå®ƒçš„é”®ç©ºé—´ï¼Œå¹¶ä¸”åªèƒ½åœ¨è¯¥é”®ç©ºé—´ä¸­ä½¿ç”¨ã€‚åœ¨åˆ›å»ºæ—¶ï¼Œå¦‚æœç±»å‹åç§°ä»¥é”®ç©ºé—´åç§°ä¸ºå‰ç¼€ï¼Œåˆ™åœ¨è¯¥é”®ç©ºé—´ä¸­åˆ›å»ºå®ƒã€‚å¦åˆ™ï¼Œå®ƒå°†åœ¨å½“å‰é”®ç©ºé—´ä¸­åˆ›å»ºã€‚ ä»Cassandra 4.0å¼€å§‹ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¿…é¡»å†»ç»“UDTï¼Œå› æ­¤åœ¨ä¸Šé¢çš„è¡¨å®šä¹‰ä¸­å†»ç»“äº†&lt;address&gt;ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å†»ç»“éƒ¨åˆ†ã€‚ ä¿®æ”¹123alter_type_statement ::= ALTER TYPE udt_name alter_type_modificationalter_type_modification ::= ADD field_definition | RENAME identifier TO identifier ( identifier TO identifier )* ä¿®æ”¹ä¸€ä¸ªUDTï¼Œå¯ä»¥ï¼š åœ¨ç±»å‹ä¸­æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µ 1ALTER TYPE address ADD country text è¯·æ³¨æ„ï¼šæ–°æ·»åŠ çš„å­—æ®µåœ¨ä¹‹å‰çš„è®°å½•ä¸­ï¼Œéƒ½å°†è¢«ç½®ä¸ºNULLã€‚ é‡å‘½åè¯¥ç±»å‹çš„å­—æ®µ 1ALTER TYPE address RENAME zip TO zipcode åˆ é™¤1drop_type_statement ::= DROP TYPE [ IF EXISTS ] udt_name ä½¿ç”¨1udt_literal ::= &#x27;&#123;&#x27; identifier &#x27;:&#x27; term ( &#x27;,&#x27; identifier &#x27;:&#x27; term )* &#x27;&#125;&#x27; ä½¿ç”¨UDTæœ‰ç‚¹åƒMapsï¼Œä¾‹å¦‚ 12345678910111213141516INSERT INTO user (name, addresses) VALUES (&#x27;z3 Pr3z1den7&#x27;, &#123; &#x27;home&#x27; : &#123; street: &#x27;1600 Pennsylvania Ave NW&#x27;, city: &#x27;Washington&#x27;, zip: &#x27;20500&#x27;, phones: &#123; &#x27;cell&#x27; : &#123; country_code: 1, number: &#x27;202 456-1111&#x27; &#125;, &#x27;landline&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125; &#125;, &#x27;work&#x27; : &#123; street: &#x27;1600 Pennsylvania Ave NW&#x27;, city: &#x27;Washington&#x27;, zip: &#x27;20500&#x27;, phones: &#123; &#x27;fax&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125; &#125; &#125;) å…ƒç»„ï¼ˆTuplesï¼‰ CQLè¿˜æ”¯æŒå…ƒç»„å’Œå…ƒç»„ç±»å‹ï¼ˆå…ƒç´ å¯ä»¥æ˜¯ä¸åŒç±»å‹ï¼‰ï¼Œç±»ä¼¼äºåŒ¿åçš„UDTæˆ–è€…æ˜¯Scalaçš„Tupleç±»å‹ã€‚ 12tuple_type ::= TUPLE &#x27;&lt;&#x27; cql_type ( &#x27;,&#x27; cql_type )* &#x27;&gt;&#x27;tuple_literal ::= &#x27;(&#x27; term ( &#x27;,&#x27; term )* &#x27;)&#x27; ä¾‹å¦‚ï¼š 123456CREATE TABLE durations ( event text, duration tuple&lt;int, text&gt;,)INSERT INTO durations (event, duration) VALUES (&#x27;ev1&#x27;, (3, &#x27;hours&#x27;)); è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom Typesï¼‰ è‡ªå®šä¹‰ç±»å‹ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹è€é¡¹ç›®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ä½¿ç”¨å·²æœ‰çš„ç±»å‹åŠ ä¸Šç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUDTï¼‰å°±å¤Ÿäº†ã€‚ 1custom_type ::= string æ•°æ®å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰SELECT123456789101112131415161718192021select_statement ::= SELECT [ JSON | DISTINCT ] ( select_clause | &#x27;*&#x27; ) FROM table_name [ WHERE where_clause ] [ GROUP BY group_by_clause ] [ ORDER BY ordering_clause ] [ PER PARTITION LIMIT (integer | bind_marker) ] [ LIMIT (integer | bind_marker) ] [ ALLOW FILTERING ]select_clause ::= selector [ AS identifier ] ( &#x27;,&#x27; selector [ AS identifier ] )selector ::= column_name | term | CAST &#x27;(&#x27; selector AS cql_type &#x27;)&#x27; | function_name &#x27;(&#x27; [ selector ( &#x27;,&#x27; selector )* ] &#x27;)&#x27; | COUNT &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;where_clause ::= relation ( AND relation )*relation ::= column_name operator term &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator tuple_literal TOKEN &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator termoperator ::= &#x27;=&#x27; | &#x27;&lt;&#x27; | &#x27;&gt;&#x27; | &#x27;&lt;=&#x27; | &#x27;&gt;=&#x27; | &#x27;!=&#x27; | IN | CONTAINS | CONTAINS KEYgroup_by_clause ::= column_name ( &#x27;,&#x27; column_name )*ordering_clause ::= column_name [ ASC | DESC ] ( &#x27;,&#x27; column_name [ ASC | DESC ] )* ç¤ºä¾‹ï¼š 1234567891011SELECT name, occupation FROM users WHERE userid IN (199, 200, 207);SELECT JSON name, occupation FROM users WHERE userid = 199;SELECT name AS user_name, occupation AS user_occupation FROM users;SELECT time, valueFROM eventsWHERE event_type = &#x27;myEvent&#x27; AND time &gt; &#x27;2011-02-03&#x27; AND time &lt;= &#x27;2012-01-01&#x27;SELECT COUNT (*) AS user_count FROM users; Allowing filtering é»˜è®¤æƒ…å†µä¸‹ï¼ŒCQLä»…å…è®¸ä¸æ¶‰åŠâ€œè¿‡æ»¤â€æœåŠ¡å™¨ç«¯çš„é€‰æ‹©æŸ¥è¯¢ï¼ŒåŸå› æ˜¯é‚£äº›â€œéè¿‡æ»¤â€æŸ¥è¯¢å…·æœ‰å¯é¢„æµ‹çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬çš„æŸ¥è¯¢æ€§èƒ½ä¸Limitæˆæ¯”ä¾‹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 123456789CREATE TABLE users ( username text PRIMARY KEY, firstname text, lastname text, birth_year int, country text)CREATE INDEX ON users(birth_year); ä»¥ä¸‹ä¸¤ç§æŸ¥è¯¢æ˜¯ä¸éœ€è¦æ·»åŠ ALLOW FILTERINGçš„ï¼š 12SELECT * FROM users;SELECT * FROM users WHERE birth_year = 1981; å› ä¸ºåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒCassandraéƒ½ä¿è¯è¿™äº›æŸ¥è¯¢æ€§èƒ½ä¸è¿”å›çš„æ•°æ®é‡æˆæ­£æ¯”ã€‚ è€Œä¸‹é¢çš„è¿™ä¸ªæŸ¥è¯¢ï¼Œåˆ™éœ€è¦å¼ºåˆ¶æ·»åŠ ï¼š 1SELECT * FROM users WHERE birth_year = 1981 AND country = &#x27;FR&#x27; ALLOW FILTERING; ğŸ‘‰ğŸ¼ å…³äºå¦‚ä½•å®šä¹‰å¯é¢„æµ‹çš„åˆ—ï¼Œå¯å‚è€ƒCassandraä¸­çš„ç´¢å¼• INSERT123456insert_statement ::= INSERT INTO table_name ( names_values | json_clause ) [ IF NOT EXISTS ] [ USING update_parameter ( AND update_parameter )* ]names_values ::= names VALUES tuple_literaljson_clause ::= JSON string [ DEFAULT ( NULL | UNSET ) ]names ::= &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; ç¤ºä¾‹ï¼š 1234567INSERT INTO NerdMovies (movie, director, main_actor, year) VALUES (&#x27;Serenity&#x27;, &#x27;Joss Whedon&#x27;, &#x27;Nathan Fillion&#x27;, 2005) USING TTL 86400;INSERT INTO NerdMovies JSON &#x27;&#123;&quot;movie&quot;: &quot;Serenity&quot;, &quot;director&quot;: &quot;Joss Whedon&quot;, &quot;year&quot;: 2005&#125;&#x27;; ğŸ’¡è¯·æ³¨æ„ ä¸SQLä¸åŒï¼ŒINSERTé»˜è®¤æƒ…å†µä¸‹ä¸æ£€æŸ¥è¡Œçš„å…ˆå‰å­˜åœ¨ï¼šå¦‚æœä¹‹å‰ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¡Œï¼Œå¦åˆ™æ›´æ–°ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“å‘ç”Ÿäº†å“ªäº›åˆ›å»ºæˆ–æ›´æ–°ã€‚ å¦‚æœè¦åšåˆ°å­˜åœ¨åˆ™ä¸æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨IF NOT EXISTSæ¡ä»¶ã€‚ä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨IF NOT EXISTSå°†å¯¼è‡´ä¸å¯å¿½ç•¥çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚ INSERTçš„æ‰€æœ‰æ›´æ–°éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚ UPDATE12345678910111213update_statement ::= UPDATE table_name [ USING update_parameter ( AND update_parameter )* ] SET assignment ( &#x27;,&#x27; assignment )* WHERE where_clause [ IF ( EXISTS | condition ( AND condition )*) ]update_parameter ::= ( TIMESTAMP | TTL ) ( integer | bind_marker )assignment ::= simple_selection &#x27;=&#x27; term | column_name &#x27;=&#x27; column_name ( &#x27;+&#x27; | &#x27;-&#x27; ) term | column_name &#x27;=&#x27; list_literal &#x27;+&#x27; column_namesimple_selection ::= column_name | column_name &#x27;[&#x27; term &#x27;]&#x27; | column_name &#x27;.&#x27; `field_namecondition ::= simple_selection operator term ç¤ºä¾‹ï¼š 12345678910UPDATE NerdMovies USING TTL 400 SET director = &#x27;Joss Whedon&#x27;, main_actor = &#x27;Nathan Fillion&#x27;, year = 2005 WHERE movie = &#x27;Serenity&#x27;;UPDATE UserActions SET total = total + 2 WHERE user = B70DE1D0-9908-4AE3-BE34-5573E5B09F14 AND action = &#x27;click&#x27;; ğŸ’¡è¯·æ³¨æ„ ä¸SQLä¸åŒï¼ŒUPDATEé»˜è®¤æƒ…å†µä¸‹ä¸æ£€æŸ¥è¡Œçš„å…ˆå‰å­˜åœ¨ï¼ˆé™¤éé€šè¿‡IFï¼‰ï¼šå¦‚æœä¹‹å‰ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¡Œï¼Œå¦åˆ™æ›´æ–°ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“æ˜¯å¦å‘ç”Ÿäº†åˆ›å»ºæˆ–æ›´æ–°ã€‚ å¯ä»¥é€šè¿‡IFåœ¨æŸäº›åˆ—ä¸Šä½¿ç”¨æ¡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤éæ»¡è¶³æ¡ä»¶ï¼Œå¦åˆ™ä¸ä¼šæ›´æ–°è¡Œã€‚ä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨IFæ¡ä»¶ä¼šäº§ç”Ÿä¸å¯å¿½è§†çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚ åœ¨UPDATEè¯­å¥ä¸­ï¼ŒåŒä¸€åˆ†åŒºé”®ä¸­çš„æ‰€æœ‰æ›´æ–°éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚ æ­¤å¤–ï¼ŒUPDATEæ“ä½œé’ˆå¯¹æŸäº›æ•°æ®ç±»å‹æœ‰å¼ºåˆ¶æ€§è¦æ±‚ï¼š c = c + 3 ç”¨äºé€’å¢/é€’å‡è®¡æ•°å™¨ã€‚ â€˜=â€™ç¬¦å·åé¢çš„åˆ—åç§°å¿…é¡»ä¸â€™=â€™ç¬¦å·å‰é¢çš„åˆ—åç›¸åŒã€‚è¯·æ³¨æ„ï¼Œä»…åœ¨è®¡æ•°å™¨ä¸Šå…è®¸é€’å¢/é€’å‡ï¼Œå¹¶ä¸”æ˜¯è®¡æ•°å™¨ä¸Šå…è®¸çš„å”¯ä¸€æ›´æ–°æ“ä½œã€‚ id = id + &lt;some-collection&gt; å’Œid[value1] = value2 ç”¨äºé›†åˆã€‚ id.field = 3 åœ¨éå†»ç»“çš„ç”¨æˆ·å®šä¹‰ç±»å‹ä¸Šè®¾ç½®å­—æ®µçš„å€¼ã€‚ DELETE12345delete_statement ::= DELETE [ simple_selection ( &#x27;,&#x27; simple_selection ) ] FROM table_name [ USING update_parameter ( AND update_parameter )* ] WHERE where_clause [ IF ( EXISTS | condition ( AND condition )*) ] ç¤ºä¾‹ï¼š 12345DELETE FROM NerdMovies USING TIMESTAMP 1240003134 WHERE movie = &#x27;Serenity&#x27;;DELETE phone FROM Users WHERE userid IN (C73DE1D3-AF08-40F3-B124-3FF3E5109F22, B70DE1D0-9908-4AE3-BE34-5573E5B09F14); ğŸ’¡è¯·æ³¨æ„ WHEREå­å¥æŒ‡å®šè¦åˆ é™¤çš„è¡Œã€‚ä½¿ç”¨INè¿ç®—ç¬¦å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¯­å¥åˆ é™¤å¤šè¡Œã€‚å¯ä»¥ä½¿ç”¨ä¸ç­‰è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚&gt;=ï¼‰åˆ é™¤ä¸€ç³»åˆ—è¡Œã€‚ åœ¨DELETEè¯­å¥ä¸­ï¼ŒåŒä¸€åˆ†åŒºé”®ä¸­çš„æ‰€æœ‰åˆ é™¤éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚ DELETEæ“ä½œå¯ä»¥é€šè¿‡ä½¿ç”¨IFå­å¥æ¥æ¡ä»¶åŒ–ï¼Œç±»ä¼¼äºUPDATEå’ŒINSERTè¯­å¥ã€‚ä½†æ˜¯ï¼Œä¸INSERTå’ŒUPDATEè¯­å¥ä¸€æ ·ï¼Œè¿™å°†å¯¼è‡´ä¸å¯å¿½ç•¥çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ï¼Œå°†ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚ æ‰¹å¤„ç† æ‰¹å¤„ç†åªå…è®¸åŒ…å«UPDATEï¼ŒINSERTå’ŒDELETEè¯­å¥ã€‚ æ‰¹å¤„ç†èŠ‚çœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œèµ„æºæ¶ˆè€—ã€‚ 12345batch_statement ::= BEGIN [ UNLOGGED | COUNTER ] BATCH [ USING update_parameter ( AND update_parameter )* ] modification_statement ( &#x27;;&#x27; modification_statement )* APPLY BATCHmodification_statement ::= insert_statement | update_statement | delete_statement ç¤ºä¾‹ 123456BEGIN BATCH INSERT INTO users (userid, password, name) VALUES (&#x27;user2&#x27;, &#x27;ch@ngem3b&#x27;, &#x27;second user&#x27;); UPDATE users SET password = &#x27;ps22dhds&#x27; WHERE userid = &#x27;user3&#x27;; INSERT INTO users (userid, password) VALUES (&#x27;user4&#x27;, &#x27;ch@ngem3c&#x27;); DELETE name FROM users WHERE userid = &#x27;user1&#x27;;APPLY BATCH; ğŸ’¡è¯·æ³¨æ„ å±äºç»™å®šåˆ†åŒºé”®çš„BATCHä¸­çš„æ‰€æœ‰æ›´æ–°éƒ½æ˜¯å•ç‹¬æ‰§è¡Œçš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰¹å¤„ç†ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æŒ‰è®°å½•æ‰§è¡Œï¼Œä»¥ç¡®ä¿æ‰€æœ‰å˜æ›´éƒ½æœ€ç»ˆå®Œæˆï¼ˆæˆ–ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€‚ç±»ä¼¼äºSQLäº‹åŠ¡ï¼Œä½†ä¸å®Œå…¨ç­‰åŒäºSQLäº‹åŠ¡ã€‚ UNLOGGED batchesé»˜è®¤æƒ…å†µä¸‹ï¼ŒCassandraä½¿ç”¨æ‰¹å¤„ç†æ—¥å¿—æ¥ç¡®ä¿æ‰€æœ‰å˜æ›´éƒ½æœ€ç»ˆå®Œæˆï¼ˆæˆ–ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€è¯·æ³¨æ„ï¼Œæ“ä½œä»…åœ¨å•ä¸ªåˆ†åŒºä¸­éš”ç¦»ã€‘ã€‚ æ‰¹å¤„ç†è·¨è¶Šå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ‰¹å¤„ç†åœ¨æ€§èƒ½ä¸Šä¼šæœ‰æ‰€æŸå¤±ã€‚å¯ä»¥ä½¿ç”¨UNLOGGEDé€‰é¡¹æ¥è·³è¿‡æ‰¹å¤„ç†æ—¥å¿—ï¼Œä¸è¿‡ï¼Œå¦‚æœæ‰¹å¤„ç†å¤±è´¥ï¼Œå¯èƒ½ä¼šé€ æˆæ‰¹å¤„ç†ä¸­çš„ä»»åŠ¡éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥ï¼Œè¯·è°¨æ…é€‰æ‹©ã€‚ COUNTER batchesä½¿ç”¨COUNTERé€‰é¡¹è¿›è¡Œæ‰¹é‡è®¡æ•°å™¨æ›´æ–°ã€‚ ä¸Cassandraä¸­çš„å…¶ä»–æ›´æ–°ä¸åŒï¼Œè®¡æ•°å™¨æ›´æ–°ä¸æ˜¯å¹‚ç­‰çš„ã€‚ å‚è€ƒèµ„æºApache Cassandra Documentation","tags":[{"name":"Cassandra","slug":"Cassandra","permalink":"https://gcdd1993.github.io/tags/Cassandra/"}]},{"title":"è®°ä¸€æ¬¡Postgres CPUçˆ†æ»¡æ•…éšœ","date":"2019-05-10T05:19:22.000Z","path":"p/7877/","text":"é—®é¢˜æè¿°å…¬å¸é¡¹ç›®æµ‹è¯•ç¯å¢ƒè°ƒç”¨æŸäº›æ¥å£çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«‹å³å´©æºƒï¼Œå¹¶ä¸€å®šæ—¶é—´å†…æ— æ³•æä¾›æœåŠ¡ã€‚ é—®é¢˜æ’æŸ¥æœåŠ¡å™¨é…ç½®ä¸å¤Ÿç¬¬ä¸€ååº”æ˜¯æœåŠ¡å™¨éœ€è¦å‡é…å•¦ï¼ŒèŠ±é’±è§£å†³ä¸€åˆ‡ï¼æ¯•ç«Ÿæµ‹è¯•æœåŠ¡å™¨é…ç½®ç¡®å®ä¸é«˜ï¼Œ2CPU + 4Gibï¼Œèƒ½å¹²å•¥ï¼Ÿä¸è¿‡é—®é¢˜æ˜¯ä»Šå¤©çªç„¶å‘ç”Ÿçš„ï¼Œè€Œä¸”è¯´å´©å°±å´©ã€‚å‡­ç€ä¸¥è°¨çš„æ€åº¦ï¼Œè¿˜æ˜¯è¦åˆ¨æ ¹é—®åº•åœ°æ‰¾ä¸‹é—®é¢˜ã€‚ æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½ free -m å†…å­˜å ç”¨å¹¶ä¸å¤§ï¼Œå¿˜è®°æˆªå›¾äº†ï¼Œåæ­£çœ‹ä¸‹æ¥ä¸æ˜¯å†…å­˜è¿‡é«˜å¯¼è‡´çš„å´©æºƒ top æ•°æ®åº“å ç”¨CPUè¿‡é«˜è¿æ¥æ•°è¿‡å¤š ä¸šåŠ¡é«˜å³°æ´»è·ƒè¿æ¥é™¡å¢ï¼Œæ´»è·ƒçš„è¿æ¥æ•°æ˜¯å¦æ¯”å¹³æ—¶å¤šå¾ˆå¤š 123456SELECT COUNT(*) FROM pg_stat_activity WHERE STATE NOT LIKE &#x27;%idle&#x27;; æŸ¥è¯¢ä¸‹æ¥åªæœ‰3ä¸ªè¿æ¥ï¼Œæ‰€ä»¥ä¸æ˜¯è¿æ¥æ•°å¯¼è‡´çš„CPUè¿‡é«˜ æ…¢SQL å¦‚æœæ´»è·ƒè¿æ¥æ•°çš„å˜åŒ–å¤„äºæ­£å¸¸èŒƒå›´ï¼Œåˆ™å¯èƒ½æ˜¯å½“æ—¶æœ‰æ€§èƒ½å¾ˆå·®çš„SQLè¢«å¤§é‡æ‰§è¡Œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849select datname, usename, client_addr, application_name, state, backend_start, xact_start, xact_stay, query_start, query_stay, replace( query, chr(10), &#x27; &#x27; ) as query from ( select pgsa.datname as datname, pgsa.usename as usename, pgsa.client_addr client_addr, pgsa.application_name as application_name, pgsa.state as state, pgsa.backend_start as backend_start, pgsa.xact_start as xact_start, extract( epoch from (now() - pgsa.xact_start) ) as xact_stay, pgsa.query_start as query_start, extract( epoch from (now() - pgsa.query_start) ) as query_stay, pgsa.query as query from pg_stat_activity as pgsa where pgsa.state != &#x27;idle&#x27; and pgsa.state != &#x27;idle in transaction&#x27; and pgsa.state != &#x27;idle in transaction (aborted)&#x27; ) idleconnections order by query_stay desc limit 5; å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®æœ‰ä¸€æ¡æ…¢SQLï¼Œè€Œä¸”å±äºå¥‡æ…¢æ— æ¯”ï¼Œæ‰§è¡Œäº†æ¥è¿‘1åˆ†é’Ÿè¿˜æ²¡æ‰§è¡Œå®Œæ¯•ï¼ŒåŸºæœ¬å¯ä»¥å®šä½ï¼Œæ˜¯æ…¢SQLå¯¼è‡´çš„CPUå ç”¨é™¡å¢ã€‚ é—®é¢˜è§£å†³å¯¹äºä¸Šé¢çš„æ–¹æ³•æŸ¥å‡ºæ¥çš„æ…¢SQLï¼Œé¦–å…ˆéœ€è¦åšçš„æ˜¯Killæ‰ä»–ä»¬ï¼Œä½¿ä¸šåŠ¡å…ˆæ¢å¤ã€‚ 12select pg_cancel_backend(pid) from pg_stat_activity where query like &#x27;%&lt;query text&gt;%&#x27; and pid != pg_backend_pid();select pg_terminate_backend(pid) from pg_stat_activity where query like &#x27;%&lt;query text&gt;%&#x27; and pid != pg_backend_pid(); å¦‚æœè¿™äº›SQLç¡®å®æ˜¯ä¸šåŠ¡ä¸Šå¿…éœ€çš„ï¼Œåˆ™éœ€è¦å¯¹ä»–ä»¬åšå¦‚ä¸‹ä¼˜åŒ–ï¼š å¯¹æŸ¥è¯¢æ¶‰åŠçš„è¡¨ï¼Œæ‰§è¡ŒANALYZE &lt;table&gt;æˆ–VACUUM ANZLYZE &lt;table&gt;ï¼Œæ›´æ–°è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿æŸ¥è¯¢è®¡åˆ’æ›´å‡†ç¡®ã€‚ä¸ºé¿å…å¯¹ä¸šåŠ¡å½±å“ï¼Œæœ€å¥½åœ¨ä¸šåŠ¡ä½å³°æ‰§è¡Œã€‚ æ‰§è¡Œexplain &lt;query text&gt;æˆ–explain (buffers true, analyze true, verbose true) &lt;query text&gt;å‘½ä»¤ï¼ŒæŸ¥çœ‹SQLçš„æ‰§è¡Œè®¡åˆ’ï¼ˆå‰è€…ä¸ä¼šå®é™…æ‰§è¡ŒSQLï¼Œåè€…ä¼šå®é™…æ‰§è¡Œè€Œä¸”èƒ½å¾—åˆ°è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯ï¼‰ï¼Œå¯¹å…¶ä¸­çš„Table Scanæ¶‰åŠçš„è¡¨ï¼Œå»ºç«‹ç´¢å¼•ã€‚ é‡æ–°ç¼–å†™SQLï¼Œå»é™¤æ‰ä¸å¿…è¦çš„å­æŸ¥è¯¢ã€æ”¹å†™UNION ALLã€ä½¿ç”¨JOIN CLAUSEå›ºå®šè¿æ¥é¡ºåºç­‰ï¼Œéƒ½æ˜¯è¿›ä¸€æ­¥æ·±åº¦ä¼˜åŒ–SQLçš„æ‰‹æ®µï¼Œè¿™é‡Œä¸å†æ·±å…¥è¯´æ˜ã€‚ æ€»ç»“åœ¨æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå°½é‡å‡å°‘ä¸å¿…è¦çš„å­æŸ¥è¯¢ï¼Œå…¬å¸ä½¿ç”¨çš„ORMæ¡†æ¶æ˜¯Spring JPAï¼Œé’ˆå¯¹ä¸€äº›ç‰¹åˆ«æ…¢çš„HQLï¼Œå¯ä»¥é‡‡ç”¨ç›´æ¥æ‰§è¡ŒSQLçš„æ–¹å¼æ¥ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ã€‚ 12@Query(value = &quot;select count(*) from example_table where example_id = :exampleId&quot;, nativeQuery = true)int exampleNativeQuery(@Param(&quot;exampleId&quot;) Long exampleId); å‚è€ƒPostgreSQL/PPAS CPUä½¿ç”¨ç‡é«˜çš„åŸå› åŠè§£å†³åŠæ³•","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://gcdd1993.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"è®°ä¸€æ¬¡ç”Ÿäº§äº‹æ•…--ç£ç›˜è¢«å æ»¡","date":"2019-04-18T14:08:20.000Z","path":"p/58700/","text":"å†™åœ¨å‰é¢ä»Šå¤©ï¼Œè·‘åœ¨é˜¿é‡Œäº‘ECSä¸Šçš„ç”Ÿäº§ç¯å¢ƒï¼Œçªç„¶é—´è®¿é—®å¼‚å¸¸ï¼Œæ¥å£å„ç§æŠ¥é”™ï¼Œæ— å¥ˆå…¬å¸æ²¡æœ‰ä¸“ä¸šçš„è¿ç»´äººå‘˜ï¼Œåªèƒ½ç¡¬ç€å¤´çš®è§£å†³ä¸€ä¸‹ã€‚ é—®é¢˜æ’æŸ¥å…ˆä»è¡¨é¢çœ‹èµ·ï¼Œæ•°æ®åº“é¦–å…ˆæŠ¥é”™ 12Caused by: org.postgresql.util.PSQLException: ERROR: could not extend file &quot;base/16385/16587_fsm&quot;: No space left on device å»ºè®®ï¼šCheck free disk space. ç›´è§‚ä¸Šçœ‹ï¼Œè®¾å¤‡æ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜æ»¡äº†ã€‚ è¿›å…¥æœåŠ¡å™¨åå°ï¼Œæ‰§è¡Œ 12345678910$ df -hFilesystem Size Used Avail Use% Mounted onudev 7.9G 0 7.9G 0% /devtmpfs 1.6G 3.5M 1.6G 1% /run/dev/vda1 59G 56G 0 100% /tmpfs 7.9G 4.0K 7.9G 1% /dev/shmtmpfs 5.0M 4.0K 5.0M 1% /run/locktmpfs 7.9G 0 7.9G 0% /sys/fs/cgroup/dev/mapper/vg0-vol0 1000G 14G 937G 2% /datatmpfs 1.6G 0 1.6G 0% /run/user/0 å‘ç°ç¡®å®ç£ç›˜æ»¡äº†ï¼Œè€Œä¸”æ»¡çš„å¾ˆå½»åº•ã€‚ç³»ç»Ÿç›˜å ç”¨100%ï¼Œä¼°è®¡ä»€ä¹ˆæœåŠ¡éƒ½è·‘ä¸åŠ¨äº†ã€‚/dev/vda1 59G 56G 0 100% / ä¸è¿‡å‘ç°/dev/mapper/vg0-vol0 1000G 14G 937G 2% /dataï¼Œ1000Gåªç”¨äº†2% é˜¿é‡Œäº‘ECSåˆ†ä¸ºç³»ç»Ÿç›˜å’Œæ•°æ®ç›˜ï¼Œ1000Gçš„æ˜¯æ•°æ®ç›˜ ç¬¬ä¸€ååº”ï¼Œåº”è¯¥æ˜¯æ­å»ºçš„PGæ•°æ®åº“çš„æ•°æ®æ²¡æœ‰ç§»åˆ°æ•°æ®ç›˜ä¸Šã€‚ å°†Postgresæ•°æ®åº“æ•°æ®ç›®å½•ç§»åŠ¨åˆ°ç³»ç»Ÿç›˜ å‚è€ƒå¦‚ä½•å°†PostgreSQLæ•°æ®ç›®å½•ç§»åŠ¨åˆ°Ubuntu 16.04ä¸Šçš„æ–°ä½ç½® 123456789101112131415161718192021222324$ sudo -u postgres psqlpostgres# SHOW data_directory; # æŸ¥çœ‹å½“å‰æ•°æ®ç›®å½• data_directory ------------------------------ /var/lib/postgresql/9.5/main(1 row)postgres# \\q; # é€€å‡º# ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬å°†åœ¨å®é™…æ›´æ”¹æ•°æ®ç›®å½•ä¹‹å‰å…³é—­PostgreSQL$ sudo systemctl stop postgresql# ç¡®ä¿å…³é—­å®Œæˆ$ sudo systemctl status postgresql. . .Jul 22 16:22:44 ubuntu-512mb-nyc1-01 systemd[1]: Stopped PostgreSQL RDBMS.$ sudo rsync -av /var/lib/postgresql /data # /dataä¸ºè¦è¿ç§»åˆ°çš„æ–°ç›®å½•$ cd /data$ ls... postgresql# åˆ é™¤åŸæ•°æ®ç›®å½•$ sudo rm -rf /var/lib/postgresql# å°†æ–°æ•°æ®ç›®å½•é“¾æ¥åˆ°åŸæ•°æ®ç›®å½•$ sudo ln -s /data/postgresql /var/lib/postgresql# é‡å¯Postgresæ•°æ®åº“$ sudo systemctl start postgresql$ sudo systemctl status postgresql å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œå³å°†postgreæ•°æ®åº“æ•°æ®ç›®å½•ç§»åˆ°äº†é˜¿é‡Œäº‘æ•°æ®ç›˜ ä»¥ä¸ºOKäº†ï¼Œæ‰§è¡Œ 12345678910$ df -hFilesystem Size Used Avail Use% Mounted onudev 7.9G 0 7.9G 0% /devtmpfs 1.6G 3.5M 1.6G 1% /run/dev/vda1 59G 56G 51M 100% /tmpfs 7.9G 4.0K 7.9G 1% /dev/shmtmpfs 5.0M 4.0K 5.0M 1% /run/locktmpfs 7.9G 0 7.9G 0% /sys/fs/cgroup/dev/mapper/vg0-vol0 1000G 14G 937G 2% /datatmpfs 1.6G 0 1.6G 0% /run/user/0 çº¹ä¸æœªåŠ¨ã€‚ã€‚ã€‚ UbuntuæŸ¥è¯¢å¤§æ–‡ä»¶çŒœæµ‹æ˜¯å­˜åœ¨å¤§æ–‡ä»¶å¯¼è‡´ç£ç›˜è¢«å æ»¡ 123456$ cd /$ find . -type f -size +800M -print0 | xargs -0 du -h5.6G ./var/log/syslog.16.7G ./var/log/syslog...$ rm ... å¦‚æœå‘ç°æ˜¯logå­—çœ¼çš„å¤§æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¯«ä¸ç•™æƒ…çš„åˆ æ‰ï¼Œè¦æ˜¯é‡è§ä¸€äº›ä¸è®¤è¯†çš„ï¼Œä¸è¦è´¸ç„¶åˆ æ‰ï¼Œä¸€å®šè¦æŸ¥æ¸…æ¥šæ–‡ä»¶çš„ä½œç”¨ï¼Œèƒ½åˆ åˆ™åˆ ï¼Œåƒä¸‡ä¸è¦ä¸å°å¿ƒåˆ åº“è·‘è·¯ã€‚ã€‚ã€‚ åˆ é™¤å®Œæ¯•åï¼Œå†æ¬¡æŸ¥çœ‹ 12345678910$ df -hFilesystem Size Used Avail Use% Mounted onudev 7.9G 0 7.9G 0% /devtmpfs 1.6G 3.4M 1.6G 1% /run/dev/vda1 59G 45G 12G 80% /tmpfs 7.9G 4.0K 7.9G 1% /dev/shmtmpfs 5.0M 4.0K 5.0M 1% /run/locktmpfs 7.9G 0 7.9G 0% /sys/fs/cgroup/dev/mapper/vg0-vol0 1000G 14G 936G 2% /datatmpfs 1.6G 0 1.6G 0% /run/user/0 å¤šå‡ºäº†12Gã€‚ æŸ¥çœ‹å·²åˆ é™¤ç©ºé—´å´æ²¡æœ‰é‡Šæ”¾çš„è¿›ç¨‹è¿™æ—¶å€™ï¼ŒæœåŠ¡åº”è¯¥å¯ä»¥æ¢å¤æˆåŠŸã€‚ä½†ä½ é©¬ä¸Šä¼šå‘ç°ï¼Œç£ç›˜åˆè¢«å æ»¡ï¼Œè€Œè¿™æ¬¡ï¼Œæ—¥å¿—æ–‡ä»¶å´ä¸ç®—å¤§ã€‚ æŸ¥çœ‹å·²ç»åˆ é™¤çš„æ–‡ä»¶ï¼Œç©ºé—´æœ‰æ²¡æœ‰é‡Šæ”¾ï¼Œæ²¡æœ‰çš„è¯killæ‰pid ä½¿ç”¨rmåˆ é™¤æ–‡ä»¶çš„æ—¶å€™ï¼Œè™½ç„¶æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œç©ºé—´å´æ²¡æœ‰é‡Šæ”¾ 1234$ sudo lsof -n |grep deletedjava 17866 root 237r REG 253,1 163541 1709285 /tmp/tomcat.8250394289784312179.8080/work/Tomcat/localhost/ROOT/upload_c6db0c17_6e6a_4141_bfb6_ac1b2d8a3b0b_00000000.tmp (deleted)...$ sudo kill -9 17866 å†æ¬¡ä½¿ç”¨df -hå‘½ä»¤ï¼Œç£ç›˜ä½¿ç”¨ç‡ä¸€ä¸‹å­å‡å°‘äº†å¥½å¤šã€‚ æ€»ç»“ æœåŠ¡å™¨ç³»ç»Ÿç›˜è¢«å æ»¡æ˜¯éå¸¸å¯æ€•çš„ï¼å±Šæ—¶ï¼Œä¸€åˆ‡æœåŠ¡éƒ½å°†å˜å¾—ä¸å¯ç”¨ï¼Œä¸šåŠ¡ç³»ç»Ÿä¹Ÿä¼šè«åå…¶å¦™å¤šå‡ºå¥‡æ€ªçš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œè¿ç»´éœ€è¦ç»å¸¸æ€§çš„æŸ¥çœ‹æœåŠ¡å™¨ç£ç›˜å ç”¨æƒ…å†µï¼Œé˜¿é‡Œäº‘ECSç”¨æˆ·ï¼Œå¯ä»¥å¼€å¯æŠ¥è­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ï¼Œè§£å†³é—®é¢˜ï¼ é˜¿é‡Œäº‘ECSæä¾›äº†ç³»ç»Ÿç›˜å’Œæ•°æ®ç›˜ï¼Œè®°ä½ï¼Œä¾‹å¦‚Pgã€Redisã€Cassandraç­‰å®¹æ˜“å ç£ç›˜çš„æœåŠ¡ï¼Œä¸€å®šè¦å°†æ•°æ®ç›®å½•æ”¾åœ¨é˜¿é‡Œäº‘ECSæä¾›çš„æ•°æ®ç›˜ä¸Šã€‚ /var/logæ˜¯ç³»ç»Ÿæ—¥å¿—ç›®å½•ï¼Œå¯ä»¥ç»å¸¸æ€§çš„å…³æ³¨ä¸‹ï¼Œå¤§å®¹é‡æ—¥å¿—å°½æ—©åˆ é™¤ã€‚ å¯¹å¾…è¿›ç¨‹ä¸åœå¯¹æ–‡ä»¶å†™æ—¥å¿—çš„æ“ä½œï¼Œè¦é‡Šæ”¾æ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çº¿æ¸…ç©ºè¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®Œæˆï¼š 1[root@localhost ~]# echo &quot;&quot; &gt;/var/log/syslog é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œç£ç›˜ç©ºé—´ä¸ä½†å¯ä»¥é©¬ä¸Šé‡Šæ”¾ï¼Œä¹Ÿå¯ä¿éšœè¿›ç¨‹ç»§ç»­å‘æ–‡ä»¶å†™å…¥æ—¥å¿—ï¼Œè¿™ç§æ–¹æ³•ç»å¸¸ç”¨äºåœ¨çº¿æ¸…ç†Apacheã€Tomcatã€Nginxç­‰WebæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶ã€‚ æœ€åï¼Œæœ‰ä¸€ä¸ªä¸“ä¸šçš„è¿ç»´æ˜¯å¤šä¹ˆé‡è¦ï¼","tags":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://gcdd1993.github.io/tags/%E8%BF%90%E7%BB%B4/"}]},{"title":"è¿ç»´ç¬”è®°ï¼ˆéƒ¨ç½²ç¯‡ï¼‰","date":"2019-04-16T07:43:58.000Z","path":"p/8505/","text":"å‰è¨€é’ˆå¯¹Ubuntu 16.04ï¼Œæ±‡æ€»å¸¸ç”¨æœåŠ¡çš„æ­å»ºæŒ‡å—ã€‚ ç³»ç»Ÿåˆå§‹åŒ– æ–°ä¹°çš„ECSéœ€è¦æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334$ sudo apt update$ sudo apt dist-upgrade$ sudo apt autoremove$ sudo apt clean$ cat /etc/hosts # ä¿®æ”¹hostsï¼Œä¸€èˆ¬å°†æœ¬æœºéœ€è¦ä½¿ç”¨çš„å¤–éƒ¨å†…ç½‘æœåŠ¡è®¾ç½®æ˜ å°„ä¸ºåç§°172.16.0.192 kftest-config01$ cat /etc/hostname # ä¿®æ”¹hostnameï¼Œä¾¿äºè¾¨è®¤pg_1$ reboot # ä¿®æ”¹hostnameéœ€è¦é‡å¯ç”Ÿæ•ˆ# æŒ‚è½½æ•°æ®ç›˜ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘æ•°æ®ç›˜ https://help.aliyun.com/document_detail/25446.html$ sudo fdisk -l # æŸ¥çœ‹å®ä¾‹ä¸Šçš„æ•°æ®ç›˜Disk /dev/vdb: 1000 GiB, 1073741824000 bytes, 2097152000 sectors$ sudo fdisk -u /dev/vdbCommand (m for help): n... ä¸€è·¯enterCommand (m for help): w## æ›´å¤šå‚è€ƒ https://help.aliyun.com/document_detail/108501.html$ sudo fdisk -lu /dev/vdbDevice Boot Start End Sectors Size Id Type/dev/vdb1 2048 2097151999 2097149952 1000G 83 Linux$ sudo mkfs.ext4 /dev/vdb1 # åœ¨æ–°åˆ†åŒºä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ$ cp /etc/fstab /etc/fstab.bak # å¤‡ä»½ etc/fstab$ echo /dev/vdb1 /data ext4 defaults 0 0 &gt;&gt; /etc/fstab # å‘ /etc/fstab å†™å…¥æ–°åˆ†åŒºä¿¡æ¯$ sudo mkdir /data$ sudo mount /dev/vdb1 /data # æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ$ df -h/dev/vdb1 985G 72M 935G 1% /data Postgresqlå®‰è£…Postgresql12345$ echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main&quot; | sudo tee /etc/apt/sources.list.d/pgdg.list$ wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -$ sudo apt-get update$ sudo apt-get install postgresql-9.6 # è‡ªè¡Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬## æ›´å¤šå‚è€ƒ https://www.postgresql.org/download/linux/ubuntu/ ä¿®æ”¹é…ç½®æ–‡ä»¶1234567891011$ sudo vim /etc/postgresql/9.6/main/postgresql.conflisten_addresses = &#x27;*&#x27;max_connections = 1000logging_collector = on## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/runtime-config.html $ sudo vim /etc/postgresql/9.6/main/pg_hba.confhost all all 0.0.0.0/0 md5## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html $ sudo service postgresql restart ä¿®æ”¹é»˜è®¤ç”¨æˆ·Postgresçš„å¯†ç 1234$ sudo -u postgres psql# ALTER USER postgres WITH PASSWORD &#x27;postgres&#x27;;# \\q$ exit æ­å»ºé›†ç¾¤ï¼ˆå¯é€‰ï¼‰ ä¸»æœº ip MasterèŠ‚ç‚¹ 10.10.10.10 SlaveèŠ‚ç‚¹ 10.10.10.9 MasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹åˆ†åˆ«æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å®‰è£…å®Œæˆpostgresåï¼Œå¼€å§‹æ­å»ºé›†ç¾¤ã€‚ masterèŠ‚ç‚¹ï¼š ä¿®æ”¹é…ç½® 1234567891011121314151617181920$ sudo vi /etc/postgresql/9.6/main/postgresql.conflisten_addresses = &#x27;*&#x27;wal_level = hot_standbyarchive_mode = onarchive_command = &#x27;test ! -f /var/lib/postgresql/9.6/archive/%f &amp;&amp; cp %p /var/lib/postgresql/9.6/archive/%f&#x27;max_wal_senders = 16wal_keep_segments = 100hot_standby = onlogging_collector = on## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/runtime-config.html$ sudo vi /etc/postgresql/9.6/main/pg_hba.confhost all all 10.0.0.0/8 md5host replication repuser 10.0.0.0/8 md5## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html $ sudo -upostgres mkdir /var/lib/postgresql/9.6/archive$ sudo chmod 0700 /var/lib/postgresql/9.6/archive $ sudo service postgresql restart åˆ›å»ºå·¥ä½œè´¦æˆ· repuser 12345$ sudo -upostgres createuser --replication repuser$ sudo -upostgres psqlpostgres=# \\password repuser&lt;password&gt;## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/user-manag.html slaveèŠ‚ç‚¹ï¼š å…ˆåœæ­¢æœåŠ¡ 1$ sudo service postgresql stop ç”±masterèŠ‚ç‚¹å¯¼å…¥æ•°æ®ï¼ˆpostgres å…å¯†ç ç™»å½• repuser roleï¼‰ 1234567$ sudo -upostgres vi /var/lib/postgresql/.pgpass10.10.10.10:5432:*:repuser:&lt;password&gt;127.0.0.1:5432:*:repuser:&lt;password&gt; $ sudo chmod 0600 /var/lib/postgresql/.pgpass$ sudo mv /var/lib/postgresql/9.6/main /var/lib/postgresql/9.6/main.bak$ sudo -upostgres pg_basebackup -D /var/lib/postgresql/9.6/main -F p -X stream -v -R -h 10.10.10.10 -p 5432 -U repuser ä¿®æ”¹é…ç½® 123456789$ sudo vi /var/lib/postgresql/9.6/main/recovery.confstandby_mode = &#x27;on&#x27;primary_conninfo = &#x27;user=repuser host=10.10.10.10 port=5432&#x27;trigger_file = &#x27;failover.now&#x27;## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/recovery-config.html $ sudo vi /etc/postgresql/9.6/main/postgresql.confhot_standby = on é‡å¯å¹¶æ£€æŸ¥æœåŠ¡ 123456789$ sudo service postgresql start $ sudo service postgresql status...Active: active (exited)$ sudo -upostgres psqlpsql (9.6.12)... æµ‹è¯•é›†ç¾¤åœ¨masterèŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œå¯¹ç…§çœ‹slaveèŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿä»masterèŠ‚ç‚¹å¤åˆ¶æ“ä½œ å¸¸ç”¨å‘½ä»¤123$ sudo service postgresql start$ sudo service postgresql status$ sudo service postgresql restart ğŸ‘‰ PGæ•°æ®åº“å¸¸ç”¨å‘½ä»¤ Rediså®‰è£…Redisï¼ˆå•æœºï¼‰1234$ sudo apt-get install redis-server$ sudo vim /etc/redis/redis.conf# bind 127.0.0.1$ sudo systemctl restart redis-server å®‰è£…Redisï¼ˆé›†ç¾¤ï¼‰ ä¸»æœº ip redis-server sentinel node01 10.10.10.5 ä¸» âˆš node02 10.10.10.4 ä» âˆš node03 10.10.10.6 ä» âˆš å®‰è£… Redis-Server12345678910111213141516node01:$ sudo apt-get install redis-server$ sudo vi /etc/redis/redis.confbind: 10.10.10.5$ sudo service redis-server restartnode02:$ sudo apt-get install redis-server$ sudo vi /etc/redis/redis.confbind: 10.10.10.4slaveof 10.10.10.5 $ sudo service redis-server restartnode03 åŒnode02 æµ‹è¯•ä¸»ä»åŒæ­¥12345678910111213141516171819202122232425262728node01:$ redis-cli -h 10.10.10.5 -p 637910.10.10.5:6379&gt;info....# Replicationrole:masterconnected_slaves:2slave0:ip=10.10.10.4,port=6379,state=online,offset=99,lag=0slave1:ip=10.10.10.6,port=6379,state=online,offset=99,lag=1master_repl_offset:99....10.10.10.5:6379&gt;set testkey testvalueOK10.10.10.5:6379&gt;get testkey&quot;testvalue&quot; node02:$ redis-cli -h 10.10.10.4 -p 637910.9.8.203:6379&gt;info...# Replicationrole:slavemaster_host:10.10.10.5master_port:6379master_link_status:up...10.10.10.4:6379&gt;get testkey&quot;testvalue&quot; é…ç½® Sentinelï¼ˆå¯é€‰ï¼‰ ä¸€ä¸ªç¨³å¥çš„ Redis Sentinel é›†ç¾¤ï¼Œåº”è¯¥ä½¿ç”¨è‡³å°‘ ä¸‰ä¸ª Sentinel å®ä¾‹ï¼Œå¹¶ä¸”ä¿è¯å°†è¿™äº›å®ä¾‹æ”¾åˆ° ä¸åŒçš„æœºå™¨ ä¸Šï¼Œç”šè‡³ä¸åŒçš„ ç‰©ç†åŒºåŸŸã€‚ 123456789101112131415161718192021222324$ sudo wget http://download.redis.io/redis-stable/sentinel.conf -O /etc/redis/sentinel.conf$ sudo chown redis:redis /etc/redis/sentinel.conf$ sudo vi /etc/redis/sentinel.confsentinel monitor mymaster 10.10.10.5 6379 2sentinel down-after-milliseconds mymaster 60000sentinel parallel-syncs mymaster 1sentinel failover-timeout mymaster 180000## è‡ªå¯åŠ¨é…ç½®$ sudo vi /etc/redis/sentinel.service[Unit]Documentation=http://redis.io/topics/sentinel[Service]ExecStart=/usr/bin/redis-server /etc/redis/sentinel.conf --sentinelUser=redisGroup=redis[Install]WantedBy=multi-user.target $ sudo ln -s /etc/redis/sentinel.service /lib/systemd/system/sentinel.service$ sudo systemctl enable sentinel.service$ sudo service sentinel startnode02 node03 sentinel é…ç½®åŒnode01ï¼Œæ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œæˆï¼Œå†ç»§ç»­ä¸‹ä¸€æ­¥ é…ç½®å¥½sentinelä¹‹åï¼Œredis.confå’Œsentinel.conféƒ½ç”±sentinelæ¥ç®¡ï¼›sentinelç›‘æ§ä¸»èŠ‚ç‚¹å‘ç”Ÿæ”¹å˜çš„è¯ï¼Œä¼šæ›´æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶sentinel.confå’Œredis.confã€‚ æµ‹è¯•Sentinelç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹å“¨å…µé…ç½®node01,node02,node03:$ redis-cli -h 10.10.10.5 -p 2637910.10.10.5:26379&gt; info# Serverredis_version:3.0.6...config_file:/etc/redis/sentinel.conf# Sentinelsentinel_masters:1sentinel_tilt:0sentinel_running_scripts:0sentinel_scripts_queue_length:0master0:name=mymaster,status=ok,address=10.10.10.5:6379,slaves=2,sentinels=1# åœ¨ä»èŠ‚ç‚¹æŸ¥çœ‹å“¨å…µè¯¦æƒ…ï¼Œå…³æ³¨ä¸»èŠ‚ç‚¹$ redis-cli -h 10.10.10.4 -p 2637910.10.10.5:26379&gt; sentinel master mymaster 1) &quot;name&quot; 2) &quot;mymaster&quot; 3) &quot;ip&quot; 4) &quot;10.10.10.5&quot; 5) &quot;port&quot; 6) &quot;6379&quot;...# åœæ­¢ä¸»èŠ‚ç‚¹æ‰€åœ¨redis-servernode01:$ systemctl stop redis-server.service# æŸ¥çœ‹ä»èŠ‚ç‚¹çš„å“¨å…µè¯¦æƒ…ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿‡1åˆ†é’Ÿ~2åˆ†é’Ÿï¼Œä¼šè‡ªåŠ¨é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¾‹å¦‚node03è¢«æ¨ä¸¾ä¸ºä¸»èŠ‚ç‚¹node02:$ redis-cli -h 10.10.10.4 -p 2637910.10.10.4:26379&gt; info...# Sentinelsentinel_masters:1sentinel_tilt:0sentinel_running_scripts:0sentinel_scripts_queue_length:0master0:name=mymaster,status=ok,address=10.10.10.6:6379,slaves=2,sentinels=3$ redis-cli -h 10.10.10.6 -p 637910.10.10.6:6379&gt; info# Replicationrole:masterconnected_slaves:1slave0:ip=10.10.10.4,port=6379,state=online,offset=19874,lag=0master_repl_offset:19874...# å¯åŠ¨åˆšæ‰è¢«åœæ­¢çš„åŸä¸»èŠ‚ç‚¹redis-serverï¼Œå°†ä½œä¸ºä»èŠ‚ç‚¹åŠ å…¥åˆ°redisé›†ç¾¤node01:$ systemctl start redis-server$ redis-cli -h 10.10.10.5 -p 637910.10.10.5:6379&gt; info...# Replicationrole:slavemaster_host:10.10.10.6master_port:6379master_link_status:up...$ redis-cli -h 10.10.10.5 -p 2637910.10.10.5:26379&gt; info...# Sentinelsentinel_masters:1sentinel_tilt:0sentinel_running_scripts:0sentinel_scripts_queue_length:0master0:name=mymaster,status=ok,address=10.10.10.6:6379,slaves=2,sentinels=3 å®¢æˆ·ç«¯è¿æ¥Sentinelé…ç½®å®Œsentinelï¼Œå®¢æˆ·ç«¯è¿æ¥æ–¹å¼å°±æ”¹å˜äº†ï¼Œæ‹¿Redissonä¸¾ä¾‹ï¼Œéœ€è¦å¢åŠ ä»¥ä¸‹é…ç½®ï¼Œå¹¶åˆ é™¤å•æœºæ¨¡å¼ä¸‹spring.redis.hosté…ç½®ï¼Œç«¯å£å·æ”¹æˆå“¨å…µçš„ç«¯å£å· 12spring.redis.sentinel.master=mymasterspring.redis.sentinel.nodes=10.10.10.4:26379,10.10.10.5:26379,10.10.10.6:26379 å¼•å…¥çš„jaræ˜¯ 1compile &quot;org.redisson:redisson-spring-boot-starter:3.9.1&quot; é…ç½®ç±»æ‰€åœ¨ä½ç½®ï¼š 1org.springframework.boot.autoconfigure.data.redis.RedisProperties.Sentinel å¸¸ç”¨å‘½ä»¤1234$ sudo systemctl start redis$ sudo systemctl enable redis$ sudo systemctl restart$ sudo systemctl stop redis å¸¸è§é—®é¢˜ æœ‰æ—¶å¯èƒ½ä¼šé‡åˆ°å…³é—­æˆ–é‡å¯ä¸äº†ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨redis-cliæä¾›çš„å‘½ä»¤è¡Œæ¥å¼ºåˆ¶å…³é—­ 123$ redis-cli -h 10.10.10.5 -p 637910.10.10.5:6379&gt; shutdown nosave## æ›´å¤šå‚è€ƒ https://redis.io/commands/SHUTDOWN Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Redisè¢«é…ç½®ä¸ºä¿å­˜æ•°æ®åº“å¿«ç…§ï¼Œä½†å®ƒç›®å‰ä¸èƒ½æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚ 12345$ vim /etc/sysctl.conf## æ·»åŠ ä¸€è¡Œvm.overcommit_memory=1$ sudo sysctl -p /etc/sysctl.conf## é‡å¯æ‰€æœ‰èŠ‚ç‚¹redis-serverå’Œsentinel å¦‚æœæ”¹å¥½åï¼Œè¿˜ä¸è¡Œï¼Œå°±éœ€è¦æŸ¥çœ‹ä¸‹Redisçš„dumpæ–‡ä»¶é…ç½®æ˜¯ä¸æ˜¯è¢«æ›´æ”¹äº† 1234567$ redis-cli -h 10.10.10.510.10.10.5:6379&gt; CONFIG GET dbfilename1) &quot;dbfilename&quot;2) &quot;.rdb&quot; ## é»˜è®¤æ˜¯dump.rdb10.10.10.5:6379&gt; CONFIG GET dir1) &quot;dir&quot;2) &quot;/var/spool/cron&quot; ## é»˜è®¤æ˜¯dump.rdb ä»¥ä¸Šé…ç½®ï¼Œå¦‚æœä¸æ˜¯è‡ªå·±æ›´æ”¹çš„ï¼Œåˆ™å¯æ€€ç–‘æ˜¯è¢«é»‘å®¢ç¯¡æ”¹äº† æ£€æŸ¥Redisç«¯å£æ˜¯å¦åœ¨å…¬ç½‘å¼€æ”¾ï¼Œå¦‚æœæ˜¯ï¼Œç«‹é©¬å…³é—­ è®¾ç½®Redisè®¿é—®å¯†ç  æ¢å¤Redisé»˜è®¤é…ç½® 1234567$ vim /etc/redis/redis.confdbfilename &quot;dump.rdb&quot;dir &quot;/var/lib/redis&quot;$ service redis-server restartnode01 node02 node03å‡æŒ‰æ­¤ä¿®æ”¹å¹¶é‡å¯## äº†è§£æ›´å¤š https://serverfault.com/questions/800295/redis-spontaneously-failed-failed-opening-rdb-for-saving-permission-denied Consulå®‰è£…Consulï¼ˆå•æœºï¼‰12345678910111213141516171819202122232425262728293031$ sudo mkdir -p /data/consul/&#123;current/&#123;bin,etc&#125;,data&#125;$ sudo wget https://releases.hashicorp.com/consul/1.5.3/consul_1.5.3_linux_amd64.zip -O /data/consul/consul_1.5.3_linux_amd64.zip$ sudo apt-get install unzip$ sudo unzip /data/consul/consul_1.5.3_linux_amd64.zip -d /data/consul/current/bin$ sudo vi /data/consul/current/etc/consul.json&#123; &quot;bootstrap&quot;: true, &quot;datacenter&quot;: &quot;test-datacenter&quot;, &quot;data_dir&quot;: &quot;/data/consul/data&quot;, &quot;log_level&quot;: &quot;INFO&quot;, &quot;server&quot;: true, &quot;client_addr&quot;: &quot;0.0.0.0&quot;, &quot;ui&quot;: true, &quot;start_join&quot;: [&quot;ip:8301&quot;], &quot;enable_syslog&quot;: true&#125;## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/agent/options.html#configuration_files$ sudo ln -s /data/consul/current/etc /data/consul/etc$ sudo vi /etc/systemd/system/consul.service[Unit]Description=consul service[Service]ExecStart=/data/consul/current/bin/consul agent -bind=&#123;ip&#125; -config-dir /data/consul/etc/consul.jsonUser=root[Install]WantedBy=multi-user.target$ sudo systemctl enable consul.service$ sudo systemctl start consul.service å®‰è£…Consulï¼ˆé›†ç¾¤ï¼‰ ä¸»æœº ip node01 10.10.10.5 node02 10.10.10.4 node03 10.10.10.6 1234567891011121314151617181920212223242526272829303132node01 node02 node03$ sudo mkdir -p /data/consul/&#123;current/&#123;bin,etc&#125;,data&#125;$ sudo wget https://releases.hashicorp.com/consul/1.5.3/consul_1.5.3_linux_amd64.zip -O /data/consul/consul_1.5.3_linux_amd64.zip$ sudo apt-get install unzip$ sudo unzip /data/consul/consul_1.5.3_linux_amd64.zip -d /data/consul/current/bin$ sudo vi /data/consul/current/etc/consul.json&#123; &quot;datacenter&quot;: &quot;roc-datacenter&quot;, &quot;data_dir&quot;: &quot;/data/consul/data&quot;, &quot;log_level&quot;: &quot;INFO&quot;, &quot;server&quot;: true, &quot;bootstrap_expect&quot;: 3, &quot;client_addr&quot;: &quot;10.10.10.4&quot;, &quot;ui&quot;: true, &quot;start_join&quot;: [&quot;10.10.10.4:8301&quot;,&quot;10.10.10.5:8301&quot;,&quot;10.10.10.6:8301&quot;], &quot;enable_syslog&quot;: true&#125;## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/agent/options.html#configuration_files$ sudo ln -s /data/consul/current/etc /data/consul/etc$ sudo vi /etc/systemd/system/consul.service[Unit]Description=consul service[Service]ExecStart=/data/consul/current/bin/consul agent -config-dir /data/consul/etc/consul.jsonUser=root[Install]WantedBy=multi-user.target$ sudo systemctl enable consul.service$ sudo systemctl start consul.service éœ€è¦å¼€æ”¾çš„ç«¯å£ï¼š8300, 8301, 8500ï¼Œå¦‚æœç½‘ç»œä¸é€šï¼Œåˆ™å­èŠ‚ç‚¹å°†æ— æ³•joinåˆ°ä¸»èŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå‡ºç° 1failed to sync remote state: No cluster leader æ— æ³•é€‰ä¸¾å‡ºleaderï¼Œå…¶å®æ˜¯èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œå¦‚æœé€šä¿¡æ­£å¸¸ï¼Œå¯åŠ¨ä¹‹æ—¶æ‰€æœ‰èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¨ä¸¾å‡ºleaderã€‚ å¸¸ç”¨å‘½ä»¤12345$ sudo systemctl start consul.service$ sudo systemctl stop consul.service$ sudo systemctl restart consul.service## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/commands/index.html Nginxå®‰è£…Nginx12345$ echo -e &quot;deb http://nginx.org/packages/ubuntu/ $(lsb_release -cs) nginx\\ndeb-src http://nginx.org/packages/ubuntu/ $(lsb_release -cs) nginx&quot; | sudo tee /etc/apt/sources.list.d/nginx.list$ wget -O- http://nginx.org/keys/nginx_signing.key | sudo apt-key add -$ sudo apt-get update$ sudo apt-get install nginx## æ›´å¤šå‚è€ƒï¼šhttp://nginx.org/en/linux_packages.html#stable å¸¸ç”¨å‘½ä»¤12345$ sudo service nginx start$ sudo service nginx stop$ sudo service nginx restart$ sudo service nginx reload # é‡æ–°åŠ è½½é…ç½® Cassandraé›†ç¾¤ ä¸»æœº IP cassandra-1 192.168.0.1 cassandra-2 192.168.0.2 å®‰è£…Cassandra123456$ echo &quot;deb http://www.apache.org/dist/cassandra/debian 39x main&quot; | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list$ curl https://www.apache.org/dist/cassandra/KEYS | sudo apt-key add -$ sudo apt update$ sudo apt -y install cassandra$ sudo apt install openjdk-8-jdk-headless## æ›´å¤šå‚è€ƒï¼šhttp://cassandra.apache.org/download/#installation-from-debian-packages ä¿®æ”¹é…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657$ sudo vi /etc/cassandra/cassandra.yamlseed_provider: - seeds: &quot;192.168.0.1,192.168.0.2&quot; concurrent_writes: 64concurrent_counter_writes: 64concurrent_counter_writes: 64concurrent_materialized_view_writes: 64compaction_throughput_mb_per_sec: 128file_cache_size_in_mb: 1024buffer_pool_use_heap_if_exhausted: truedisk_optimization_strategy: spinning#listen_address: localhostlisten_interface: eth0#rpc_address: localhostrpc_interface: eth0enable_user_defined_functions: trueauto_bootstrap: false## ä¼˜åŒ–cassandra jvmé…ç½®$ sudo vi /etc/cassandra/jvm.options#-XX:+UseParNewGC#-XX:+UseConcMarkSweepGC#-XX:+CMSParallelRemarkEnabled#-XX:SurvivorRatio=8#-XX:MaxTenuringThreshold=1#-XX:CMSInitiatingOccupancyFraction=75#-XX:+UseCMSInitiatingOccupancyOnly#-XX:CMSWaitDuration=10000#-XX:+CMSParallelInitialMarkEnabled#-XX:+CMSEdenChunksRecordAlways-XX:+UseG1GC-XX:G1RSetUpdatingPauseTimePercent=5-XX:MaxGCPauseMillis=500-XX:InitiatingHeapOccupancyPercent=70-XX:ParallelGCThreads=16-XX:ConcGCThreads=16$ sudo vi /etc/cassandra/cassandra-env.sh## é…ç½®ä¸ºä¸»æœºå†…ç½‘åœ°å€JVM_OPTS=&quot;$JVM_OPTS -Djava.rmi.server.hostname=192.168.0.1&quot;#if [ &quot;x$LOCAL_JMX&quot; = &quot;x&quot; ]; then# LOCAL_JMX=yes# fi if [ &quot;x$LOCAL_JMX&quot; = &quot;x&quot; ]; then LOCAL_JMX=no fi#JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.authenticate=true&quot;JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.authenticate=false&quot;#JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.password.file=/etc/cassandra/jmxremote.password&quot;$ sudo systemctl stop cassandra è¿ç§»é…ç½®å¯¼æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰1234$ sudo mv /var/lib/cassandra /data/cassandra$ sudo ln -s /data/cassandra /var/lib/cassandra$ sudo systemctl start cassandra é›†ç¾¤å†…å…¶ä½™æœºå™¨ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä¿®æ”¹å¯¹åº”IP Zookeeperé›†ç¾¤ ä¸»æœº IP zk-01 192.168.0.1 zk-02 192.168.0.2 zk-03 192.168.0.3 å®‰è£…Zookeeper1$ sudo apt install zookeeperd ä¿®æ”¹é…ç½®æ–‡ä»¶12345678$ sudo vim /etc/zookeeper/conf/zoo.cfgserver.1=192.168.0.1:2888:3888server.2=192.168.0.2:2888:3888server.3=192.168.0.3:2888:3888$ sudo vim /etc/zookeeper/conf/myid1# æ¯å°ä¸»æœºidå„ä¸ç›¸åŒï¼Œæ¯”å¦‚zk-01=1,zk-02=2,zk-03=3$ sudo systemctl restart zookeeper å®‰è£…ZK-UIï¼ˆå¯é€‰ï¼‰123456789# å®‰è£…zkui$ cd /data &amp;&amp; wget https://github.com/zifangsky/zkui/releases/download/v2.0/zkui-2.0.zip$ sudo unzip zkui-2.0.zip$ sudo vi /data/zkui/config.cfg zkServer=192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181userSet = &#123;&quot;users&quot;: [&#123; &quot;username&quot;:&quot;&lt;username&gt;&quot; , &quot;password&quot;:&quot;&lt;password&gt;&quot;,&quot;role&quot;: &quot;ADMIN&quot; &#125;,&#123; &quot;username&quot;:&quot;appconfig&quot; , &quot;password&quot;:&quot;appconfig&quot;,&quot;role&quot;: &quot;USER&quot; &#125;]&#125; $ cd /data/zkui &amp;&amp; sudo bash start.sh é›†ç¾¤å†…å…¶ä½™æœºå™¨ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ Kafkaé›†ç¾¤ ä¸»æœº IP zk-01 192.168.0.1 zk-02 192.168.0.2 zk-03 192.168.0.3 å®‰è£…Kafka12345678$ sudo mkdir /data/kafka &amp;&amp; cd ~$ wget &quot;http://www-eu.apache.org/dist/kafka/1.0.1/kafka_2.12-1.0.1.tgz&quot;$ curl http://kafka.apache.org/KEYS | gpg --import$ wget https://dist.apache.org/repos/dist/release/kafka/1.0.1/kafka_2.12-1.0.1.tgz.asc$ gpg --verify kafka_2.12-1.0.1.tgz.asc kafka_2.12-1.0.1.tgz$ sudo tar -xvzf kafka_2.12-1.0.1.tgz --directory /data/kafka --strip-components 1$ sudo rm -rf kafka_2.12-1.0.1.tgz kafka_2.12-1.0.1.tgz.asc## æ›´å¤šå‚è€ƒ https://tecadmin.net/install-apache-kafka-ubuntu/ ä¿®æ”¹é…ç½®æ–‡ä»¶123456789101112131415161718$ sudo mkdir /data/kafka-logs$ sudo cp /data/kafka/config/server.properties&#123;,.bak&#125;$ sudo vim /data/kafka/config/server.properties broker.id=0 # æ¯å°ä¸»æœºå„ä¸ç›¸åŒlisteners=PLAINTEXT://0.0.0.0:9092advertised.listeners=PLAINTEXT://&lt;ip&gt;:9092delete.topic.enable = trueleader.imbalance.check.interval.seconds=5 # leaderä¸å¹³è¡¡æ£€æŸ¥é—´éš”leader.imbalance.per.broker.percentage=1log.dirs=/data/kafka-logsoffsets.topic.replication.factor=3log.retention.hours=72log.segment.bytes=1073741824zookeeper.connect=192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181 $ sudo vim /data/kafka/bin/kafka-server-start.shexport JMX_PORT=12345 # æš´éœ²jmxç«¯å£ï¼Œç•™å¾…ç›‘æ§ä½¿ç”¨ æ³¨å†Œä¸ºSystemdæœåŠ¡12345678910111213141516171819$ sudo adduser --system --no-create-home --disabled-password --disabled-login kafka$ sudo chown -R kafka:nogroup /data/kafka$ sudo chown -R kafka:nogroup /data/kafka-logs $ sudo vim /etc/systemd/system/kafka.service[Unit]Description=High-available, distributed message brokerAfter=network.target[Service]User=kafkaExecStart=/data/kafka/bin/kafka-server-start.sh /data/kafka/config/server.properties[Install]WantedBy=multi-user.target## å¯ç”¨æœåŠ¡$ sudo systemctl enable kafka.service$ sudo systemctl start kafka.service## æ›´å¤šå‚è€ƒ https://kafka.apache.org/quickstart æµ‹è¯•Kafkaçš„ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰123456789$ /data/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test$ /data/kafka/bin/kafka-topics.sh --list --zookeeper localhost:2181 $ /data/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test&gt; Hello World # å¦å¤–ä¸€ä¸ªterminal$ /data/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginningHello World éƒ¨ç½²Kafka-manager1234567891011121314151617181920212223$ cd /data &amp; sudo wget https://github.com/yahoo/kafka-manager/archive/1.3.3.17.zip$ sudo unzip kafka-manager-1.3.3.17.zip$ sudo mv kafka-manager-1.3.3.17 kafka-manager$ sudo chown -R kafka:nogroup /data/kafka-manager$ sudo vim /data/kafka-manager/conf/application.confkafka-manager.zkhosts=&quot;192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181&quot;basicAuthentication.enabled=truebasicAuthentication.username=&quot;&lt;username&gt;&quot;basicAuthentication.password=&quot;&lt;password&gt;&quot; $ sudo vim /etc/systemd/system/kafka-manager.service[Unit]Description=High-available, distributed message broker managerAfter=network.target[Service]User=kafkaExecStart=/data/kafka-manager/bin/kafka-manager[Install]WantedBy=multi-user.target## å¯ç”¨æœåŠ¡$ sudo systemctl enable kafka-manager.service$ sudo systemctl start kafka-manager.service Mysqlå®‰è£…Mysql12$ sudo apt-get update$ sudo apt-get install mysql-server åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå°†æç¤ºæ‚¨åˆ›å»ºrootå¯†ç ã€‚è¯·åŠ¡å¿…è®°ä½rootå¯†ç  é…ç½®Mysqlè¿è¡Œå®‰å…¨è„šæœ¬ 1$ mysql_secure_installation å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒDisallow root login remotely?ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨rootè´¦å·è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œè¯·é€‰æ‹©No éªŒè¯æ¥ä¸‹æ¥æµ‹è¯•ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸäº† è¿è¡ŒçŠ¶æ€ 12345678910$ systemctl status mysql.serviceâ— mysql.service - MySQL Community Server Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled) Active: active (running) since Thu 2019-07-18 23:38:43 PDT; 11min ago Main PID: 2948 (mysqld) Tasks: 28 Memory: 142.6M CPU: 545ms CGroup: /system.slice/mysql.service â””â”€2948 /usr/sbin/mysqld ç™»å½•æŸ¥çœ‹ç‰ˆæœ¬ 123456789101112131415$ mysqladmin -p -u root versionmysqladmin Ver 8.42 Distrib 5.7.26, for Linux on x86_64Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Server version 5.7.26-0ubuntu0.16.04.1Protocol version 10Connection Localhost via UNIX socketUNIX socket /var/run/mysqld/mysqld.sockUptime: 12 min 18 secThreads: 1 Questions: 36 Slow queries: 0 Opens: 121 Flush tables: 1 Open tables: 40 Queries per second avg: 0.048 åˆ°è¿™é‡Œï¼ŒMysqlå®‰è£…å®Œæˆï¼ å‚è€ƒ Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡","tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://gcdd1993.github.io/tags/Ubuntu/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://gcdd1993.github.io/tags/%E8%BF%90%E7%BB%B4/"}]},{"title":"Javaå®‰å…¨ç¬”è®°","date":"2019-04-10T12:13:10.000Z","path":"p/10700/","text":"å‰è¨€åç«¯æ¥å£å¼€å‘ä¸­ï¼Œæ¶‰åŠåˆ°ç”¨æˆ·ç§å¯†ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ç­‰ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ è¾“æ˜æ–‡ï¼Œå¿…é¡»ä½¿ç”¨åŠ å¯†æ–¹å¼ä¼ è¾“ã€‚è¿™æ¬¡æ”¿åºœé¡¹ç›®ä¸­ï¼Œå®‰å…¨æµ‹è¯•ç»„æå‡ºäº†æ˜æ–‡ä¼ è¾“æ¼æ´ï¼ŒæŠ½ç©ºç ”ç©¶äº†ä¸‹JavaåŠ è§£å¯†ç›¸å…³çŸ¥è¯†ï¼Œè®°å½•ä¸‹ã€‚ æ•£åˆ—å‡½æ•°Javaæä¾›äº†ä¸€ä¸ªåä¸ºMessageDigestçš„ç±»ï¼Œå®ƒå±äºjava.securityåŒ…ã€‚ æ­¤ç±»æ”¯æŒè¯¸å¦‚SHA-1ï¼ŒSHA 256ï¼ŒMD5ä¹‹ç±»çš„ç®—æ³•ï¼Œä»¥å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯è½¬æ¢ä¸ºä¿¡æ¯æ‘˜è¦ã€‚ æ•£åˆ—å‡½æ•°è¿”å›çš„å€¼ç§°ä¸ºä¿¡æ¯æ‘˜è¦æˆ–ç®€ç§°æ•£åˆ—å€¼ã€‚ ä¸‹å›¾è¯´æ˜äº†æ•£åˆ—å‡½æ•°ã€‚ è¦ä½¿ç”¨æ•£åˆ—å‡½æ•°åŠ å¯†æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š åˆ›å»ºMessageDigestå¯¹è±¡1MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;); MessageDigestæä¾›äº†getInstanceé™æ€æ–¹æ³•æ¥è·å¾—MessageDigestå®ä¾‹ï¼Œæ”¯æŒçš„ç±»å‹å¯å‚è€ƒWiki-SHAå®¶æ— å°†æ•°æ®ä¼ é€’ç»™åˆ›å»ºçš„MessageDigestå¯¹è±¡1md.update(&quot;gcdd1993&quot;.getBytes()); ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦1byte[] digest = md.digest(); é€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶è½¬æ¢ä¸ºHexå­—ç¬¦ä¸²123456StringBuffer hexString = new StringBuffer();for (byte aDigest : digest) &#123; hexString.append(Integer.toHexString(0xFF &amp; aDigest));&#125;System.out.println(&quot;Hex format : &quot; + hexString.toString()); æ¶ˆæ¯è®¤è¯ç  MAC(æ¶ˆæ¯è®¤è¯ç )ç®—æ³•æ˜¯ä¸€ç§å¯¹ç§°å¯†é’¥åŠ å¯†æŠ€æœ¯ï¼Œç”¨äºæä¾›æ¶ˆæ¯è®¤è¯ã€‚è¦å»ºç«‹MACè¿‡ç¨‹ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹å…±äº«å¯¹ç§°å¯†é’¥Kã€‚ å®è´¨ä¸Šï¼ŒMACæ˜¯åœ¨åŸºç¡€æ¶ˆæ¯ä¸Šç”Ÿæˆçš„åŠ å¯†æ ¡éªŒå’Œï¼Œå®ƒä¸æ¶ˆæ¯ä¸€èµ·å‘é€ä»¥ç¡®ä¿æ¶ˆæ¯éªŒè¯ã€‚ ä½¿ç”¨MACè¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º åœ¨Javaä¸­ï¼Œjavax.cryptoåŒ…çš„Macç±»æä¾›äº†æ¶ˆæ¯è®¤è¯ä»£ç çš„åŠŸèƒ½ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨æ­¤ç±»åˆ›å»ºæ¶ˆæ¯èº«ä»½éªŒè¯ä»£ç ã€‚ åˆ›å»ºKeyGeneratorå¯¹è±¡1KeyGenerator keyGen = KeyGenerator.getInstance(&quot;DES&quot;); KeyGeneratoræ”¯æŒä»¥ä¸‹ç±»å‹ï¼š AES (128) DES (56) DESede (168) HmacSHA1 HmacSHA256 åˆ›å»ºSecureRandomå¯¹è±¡1SecureRandom secureRandom = new SecureRandom(); åˆå§‹åŒ–KeyGenerator1keyGen.init(secureRandom); ç”Ÿæˆå¯†é’¥1Key key = keyGen.generateKey(); ä½¿ç”¨å¯†é’¥åˆå§‹åŒ–Macå¯¹è±¡12Mac mac = Mac.getInstance(&quot;HmacMD5&quot;);mac.init(key); Macæ”¯æŒä»¥ä¸‹ç±»å‹ï¼š HmacMD5 HmacSHA1 HmacSHA256 å®Œæˆmacæ“ä½œ123String msg = &quot;gcdd1993&quot;;byte[] bytes = msg.getBytes();byte[] macResult = mac.doFinal(bytes); æ•°å­—ç­¾å æ•°å­—ç­¾åå…è®¸éªŒè¯ç­¾åçš„ä½œè€…ï¼Œæ—¥æœŸå’Œæ—¶é—´ï¼ŒéªŒè¯æ¶ˆæ¯å†…å®¹ã€‚ å®ƒè¿˜åŒ…æ‹¬ç”¨äºå…¶ä»–åŠŸèƒ½çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚ ä¼˜ç‚¹ è®¤è¯ æ•°å­—ç­¾åæœ‰åŠ©äºéªŒè¯æ¶ˆæ¯æ¥æºã€‚ å®Œæ•´æ€§ é‚®ä»¶ç­¾ååï¼Œé‚®ä»¶ä¸­çš„ä»»ä½•æ›´æ”¹éƒ½å°†ä½¿ç­¾åæ— æ•ˆã€‚ ä¸å¯å¦è®¤ é€šè¿‡æ­¤å±æ€§ï¼Œä»»ä½•å·²ç­¾ç½²æŸäº›ä¿¡æ¯çš„å®ä½“éƒ½ä¸èƒ½åœ¨ä»¥åæ‹’ç»ç­¾åã€‚ åˆ›å»ºæ•°å­—ç­¾ååˆ›å»ºKeyPairGeneratorå¯¹è±¡ KeyPairGeneratorç±»æä¾›getInstance()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€å¯†é’¥ç”Ÿæˆç®—æ³•çš„Stringå˜é‡ï¼Œå¹¶è¿”å›ç”Ÿæˆå¯†é’¥çš„KeyPairGeneratorå¯¹è±¡ã€‚ 1KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(&quot;DSA&quot;); åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡ KeyPairGeneratorç±»æä¾›äº†ä¸€ä¸ªåä¸ºinitialize()çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆå§‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨ã€‚ æ­¤æ–¹æ³•æ¥å—è¡¨ç¤ºå¯†é’¥å¤§å°çš„æ•´æ•°å€¼ã€‚ 1keyPairGen.initialize(2048); ç”ŸæˆKeyPair ä½¿ç”¨generateKeyPair()æ–¹æ³•ç”Ÿæˆå¯†é’¥å¯¹ 1KeyPair pair = keyPairGen.generateKeyPair(); ä»å¯†é’¥å¯¹ä¸­è·å–ç§é’¥1PrivateKey privateKey = pair.getPrivate(); åˆ›å»ºç­¾åå¯¹è±¡ Signatureç±»çš„getInstance()æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€ç­¾åç®—æ³•çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶è¿”å›ç›¸åº”çš„Signatureå¯¹è±¡ã€‚ Signatureæ”¯æŒä»¥ä¸‹ç±»å‹ï¼š SHA1withDSA SHA1withRSA SHA256withRSA 1Signature sign = Signature.getInstance(&quot;SHA256withDSA&quot;); åˆå§‹åŒ–ç­¾åå¯¹è±¡1sign.initSign(privateKey); å°†æ•°æ®æ·»åŠ åˆ°Signatureå¯¹è±¡12String msg = &quot;gcdd1993&quot;;sign.update(msg.getBytes()); è®¡ç®—ç­¾å1byte[] signature = sign.sign(); éªŒè¯ç­¾å æˆ‘ä»¬åˆ›å»ºç­¾ååï¼Œé€šå¸¸å¯ä»¥å°†ç§é’¥å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä»¥è¿›è¡Œç­¾åæ“ä½œã€‚æœåŠ¡ç«¯ä¿å­˜å…¬é’¥ï¼Œä»¥è¿›è¡Œç­¾åéªŒè¯ åˆå§‹åŒ–ç­¾åå¯¹è±¡ä»¥è¿›è¡ŒéªŒè¯ ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–ç­¾åå¯¹è±¡ 1sign.initVerify(pair.getPublic()); æ›´æ–°è¦éªŒè¯çš„æ•°æ®1sign.update(msg.getBytes()); éªŒè¯ç­¾å12boolean verify = sign.verify(signature);Assert.assertTrue(verify); å…¬ç§é’¥åŠ è§£å¯†æ•°æ® å¯ä»¥ä½¿ç”¨javax.cryptoåŒ…çš„Cipherç±»åŠ å¯†ç»™å®šæ•°æ®ã€‚ è·å–å…¬ç§é’¥çš„æ­¥éª¤ï¼Œä¸ç­¾åç±»ä¼¼ 1234KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(&quot;RSA&quot;);keyPairGen.initialize(2048);KeyPair pair = keyPairGen.generateKeyPair();PublicKey publicKey = pair.getPublic(); åŠ å¯†æ•°æ®åˆ›å»ºä¸€ä¸ªCipherå¯¹è±¡ Cipherç±»çš„getInstance()æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€è½¬æ¢çš„Stringå˜é‡ï¼Œå¹¶è¿”å›å®ç°ç»™å®šè½¬æ¢çš„Cipherå¯¹è±¡ã€‚ Cipheræ”¯æŒä»¥ä¸‹ç±»å‹ï¼š AES/CBC/NoPadding (128) AES/CBC/PKCS5Padding (128) AES/ECB/NoPadding (128) AES/ECB/PKCS5Padding (128) DES/CBC/NoPadding (56) DES/CBC/PKCS5Padding (56) DES/ECB/NoPadding (56) DES/ECB/PKCS5Padding (56) DESede/CBC/NoPadding (168) DESede/CBC/PKCS5Padding (168) DESede/ECB/NoPadding (168) DESede/ECB/PKCS5Padding (168) RSA/ECB/PKCS1Padding (1024, 2048) RSA/ECB/OAEPWithSHA-1AndMGF1Padding (1024, 2048) RSA/ECB/OAEPWithSHA-256AndMGF1Padding (1024, 2048) 1Cipher cipher = Cipher.getInstance(&quot;RSA/ECB/PKCS1Padding&quot;); ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–Cipherå¯¹è±¡ Cipherç±»çš„init()æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªè¡¨ç¤ºæ“ä½œæ¨¡å¼çš„æ•´æ•°å‚æ•°(åŠ å¯†/è§£å¯†)å’Œä¸€ä¸ªè¡¨ç¤ºå…¬é’¥çš„Keyå¯¹è±¡ã€‚ 1cipher.init(Cipher.ENCRYPT_MODE, publicKey); å°†æ•°æ®æ·»åŠ åˆ°Cipherå¯¹è±¡ Cipherç±»çš„update()æ–¹æ³•æ¥å—è¡¨ç¤ºè¦åŠ å¯†çš„æ•°æ®çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„æ•°æ®æ›´æ–°å½“å‰å¯¹è±¡ã€‚ 12String msg = &quot;gcdd1993&quot;;cipher.update(msg.getBytes()); åŠ å¯†æ•°æ®1byte[] cipherText = cipher.doFinal(); è§£å¯†æ•°æ®ä½¿ç”¨ç§é’¥åˆå§‹åŒ–Cipherå¯¹è±¡1cipher.init(Cipher.DECRYPT_MODE, pair.getPrivate()); è§£å¯†æ•°æ®12byte[] decipheredText = cipher.doFinal(cipherText);Assert.assertEquals(msg, new String(decipheredText)); ç¬¬ä¸‰æ–¹ç±»åº“ å‰åç«¯é€‚ç”¨ä¸”åº”ç”¨å¹¿æ³›çš„æ˜¯Crypto-JS,ä½¿ç”¨ Crypto-JS å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨ JavaScript è¿›è¡Œ MD5ã€SHA1ã€SHA2ã€SHA3ã€RIPEMD-160 å“ˆå¸Œæ•£åˆ—ï¼Œè¿›è¡Œ AESã€DESã€Rabbitã€RC4ã€Triple DES åŠ è§£å¯†ã€‚ AESåŠ å¯† é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆè‹±è¯­ï¼šAdvanced Encryption Standardï¼Œç¼©å†™ï¼šAESï¼‰ï¼Œåœ¨å¯†ç å­¦ä¸­åˆç§°RijndaelåŠ å¯†æ³•ï¼Œæ˜¯ç¾å›½è”é‚¦æ”¿åºœé‡‡ç”¨çš„ä¸€ç§åŒºå—åŠ å¯†æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†ç”¨æ¥æ›¿ä»£åŸå…ˆçš„DESï¼Œå·²ç»è¢«å¤šæ–¹åˆ†æä¸”å¹¿ä¸ºå…¨ä¸–ç•Œæ‰€ä½¿ç”¨ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯éšæœºç”Ÿæˆå¯†é’¥ï¼Œç„¶åå°†å¯†é’¥å‘é€ç»™å®¢æˆ·ç«¯è¿›è¡ŒåŠ å¯†ï¼Œä¸Šä¼ å¯†æ–‡åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¿›è¡Œè§£å¯†ã€‚ æœ¬æ–‡åªè®¨è®ºJavaçš„AESåŠ è§£å¯†æ–¹å¼ã€‚ å¼•å…¥JaråŒ…1compile group: &#x27;org.webjars.npm&#x27;, name: &#x27;crypto-js&#x27;, version: &#x27;3.1.8&#x27; ç”Ÿæˆå¯†é’¥1234Random random = new Random();byte[] key = new byte[16];random.nextBytes(key);SecretKeySpec keySpec = new SecretKeySpec(key, &quot;AES&quot;); ç”Ÿæˆåç§»é‡123byte[] iv = new byte[16];random.nextBytes(iv);IvParameterSpec ivSpec = new IvParameterSpec(iv); åˆ›å»ºCipherå¯¹è±¡1Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;); åˆå§‹åŒ–Cipherä¸ºåŠ å¯†å·¥ä½œè¿‡ç¨‹1cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivSpec); åŠ å¯†1byte[] original = cipher.doFinal(encrypted1); AESè§£å¯†åˆå§‹åŒ–Cipherä¸ºè§£å¯†å·¥ä½œè¿‡ç¨‹1cipher.init(Cipher.DECRYPT_MODE, keySpec, ivSpec); è§£å¯†12byte[] bytes = cipher.doFinal(original);Assert.assertEquals(data, new String(bytes, StandardCharsets.UTF_8)); AESåŠ è§£å¯†æ€»ç»“å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®ç°å¯¹ç§°åŠ å¯† æœåŠ¡ç«¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£è´Ÿè´£éšæœºç”Ÿæˆkeyï¼ˆå¯†ç ï¼‰å’Œivï¼ˆåç§»é‡ï¼‰ï¼Œå¹¶å°†å…¶å­˜å…¥redisï¼ˆè®¾ç½®è¶…æ—¶æ—¶é—´ï¼‰ å®¢æˆ·ç«¯è°ƒç”¨æ¥å£ï¼Œè·å¾—keyå’Œivä»¥åŠä¸€ä¸ªredis_keyï¼Œè¿›è¡Œæ•°æ®åŠ å¯†ï¼Œå°†åŠ å¯†åçš„æ•°æ®ä»¥åŠredis_keyä¼ åˆ°æœåŠ¡ç«¯ æœåŠ¡ç«¯ä½¿ç”¨redis_keyè·å¾—keyå’Œivï¼Œè¿›è¡Œè§£å¯† æ€»ç»“åœ¨Java EEå®‰å…¨é‡Œï¼Œä¸»è¦æ˜¯è¿›è¡Œå®¢æˆ·ç«¯åŠ å¯†ï¼Œä»¥åŠæœåŠ¡ç«¯è§£å¯†çš„è¿‡ç¨‹æ¥å®ç°æ•°æ®å®‰å…¨ä¼ è¾“çš„ç›®çš„ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š éšæœºæ€§ï¼šåŠ å¯†æ–¹å¼ä¸å¯å•ä¸€ï¼Œå¯é€šè¿‡æ›´æ¢Cipher.getInstance()çš„Stringå€¼æ¥éšæœºç”ŸæˆåŠ å¯†å·¥äººè¿›è¡ŒåŠ å¯†ã€‚ ä¿å¯†æ€§ï¼šåŠ å¯†ä½¿ç”¨çš„å¯†é’¥æˆ–è€…åç§»é‡ç­‰ï¼Œéœ€è¦ä½¿ç”¨è¶…æ—¶ã€æ¨¡ç³Šç›®çš„ç­‰æ‰‹æ®µè¿›è¡Œéšè—ï¼ŒåŠ å¤§ç ´è§£æˆæœ¬ã€‚ æ²¡æœ‰å®Œå…¨æœ‰æ•ˆçš„åŠ å¯†ï¼Œä½†æ˜¯åªè¦åšåˆ°ç ´è§£æˆæœ¬å¤§äºåŠ å¯†æˆæœ¬ï¼Œå°±æ˜¯æœ‰æ•ˆçš„åŠ å¯†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­åœ°æ›´æ¢åŠ å¯†æ–¹å¼è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ ğŸ‘‰ ä»£ç ä»“åº“","tags":[{"name":"Java","slug":"Java","permalink":"https://gcdd1993.github.io/tags/Java/"},{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"https://gcdd1993.github.io/tags/%E5%AE%89%E5%85%A8/"}]},{"title":"Lombok è¯¦è§£","date":"2019-04-05T13:19:26.000Z","path":"p/12232/","text":"ç®€ä»‹lombokæ˜¯ä¸€ä¸ªç¼–è¯‘çº§åˆ«çš„æ’ä»¶ï¼Œå®ƒå¯ä»¥åœ¨é¡¹ç›®ç¼–è¯‘çš„æ—¶å€™ç”Ÿæˆä¸€äº›ä»£ç ã€‚é€šä¿—çš„è¯´ï¼Œlombokå¯ä»¥é€šè¿‡æ³¨è§£æ¥æ ‡ç¤ºç”Ÿæˆgetter settterç­‰ä»£ç ã€‚ å¼•å…¥åˆ›å»ºgradleé¡¹ç›® 1compile group: &#x27;org.projectlombok&#x27;, name: &#x27;lombok&#x27;, version: &#x27;1.16.20&#x27; æ³¨è§£@NonNull æ ‡è®°å­—æ®µä¸å¯ä¸ºnull 1234567@Setterpublic class Person &#123; @NonNull private String name; @NonNull private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š 12345678910111213141516171819202122232425public class Person &#123; @NonNull private String name; @NonNull private Integer age; public Person() &#123; &#125; public void setName(@NonNull String name) &#123; if (name == null) &#123; throw new NullPointerException(&quot;name&quot;); &#125; else &#123; this.name = name; &#125; &#125; public void setAge(@NonNull Integer age) &#123; if (age == null) &#123; throw new NullPointerException(&quot;age&quot;); &#125; else &#123; this.age = age; &#125; &#125;&#125; @Getter/@Setter è‡ªåŠ¨ç”Ÿæˆgetterå’Œsetteræ–¹æ³• 123456public class Person &#123; @Getter private String name; @Setter private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š 123456789101112131415public class Person &#123; private String name; private Integer age; public Person() &#123; &#125; public String getName() &#123; return this.name; &#125; public void setAge(Integer age) &#123; this.age = age; &#125;&#125; @Cleanup è‡ªåŠ¨å…³é—­æµä»£ç  12@CleanupInputStream in = new FileInputStream(args[0]); å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š 1234InputStream in = new FileInputStream(args[0]);if (Collections.singletonList(in).get(0) != null) &#123; in.close();&#125; @AllArgsConstructor/@NoArgsConstructor/@RequiredArgsConstructor è‡ªåŠ¨ç”Ÿæˆå…¨å‚æ„é€ å‡½æ•°å’Œæ— å‚æ„é€ å‡½æ•° 123456@AllArgsConstructor@NoArgsConstructorpublic class Person &#123; private String name; private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 123456789101112public class Person &#123; private String name; private Integer age; public Person(String name, Integer age) &#123; this.name = name; this.age = age; &#125; public Person() &#123; &#125;&#125; @Builder è‡ªåŠ¨ç”Ÿæˆå»ºé€ è€…æ¨¡å¼çš„bean 12345@Builderpublic class Person &#123; private String name; private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839public class Person &#123; private String name; private Integer age; Person(String name, Integer age) &#123; this.name = name; this.age = age; &#125; public static Person.PersonBuilder builder() &#123; return new Person.PersonBuilder(); &#125; public static class PersonBuilder &#123; private String name; private Integer age; PersonBuilder() &#123; &#125; public Person.PersonBuilder name(String name) &#123; this.name = name; return this; &#125; public Person.PersonBuilder age(Integer age) &#123; this.age = age; return this; &#125; public Person build() &#123; return new Person(this.name, this.age); &#125; public String toString() &#123; return &quot;Person.PersonBuilder(name=&quot; + this.name + &quot;, age=&quot; + this.age + &quot;)&quot;; &#125; &#125;&#125; @EqualsAndHashCode è‡ªåŠ¨ç”Ÿæˆequalså’Œhashcodeæ–¹æ³• 12345@EqualsAndHashCodepublic class Person &#123; private String name; private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public class Person &#123; private String name; private Integer age; public Person() &#123; &#125; public boolean equals(Object o) &#123; if (o == this) &#123; return true; &#125; else if (!(o instanceof Person)) &#123; return false; &#125; else &#123; Person other = (Person)o; if (!other.canEqual(this)) &#123; return false; &#125; else &#123; Object this$name = this.name; Object other$name = other.name; if (this$name == null) &#123; if (other$name != null) &#123; return false; &#125; &#125; else if (!this$name.equals(other$name)) &#123; return false; &#125; Object this$age = this.age; Object other$age = other.age; if (this$age == null) &#123; if (other$age != null) &#123; return false; &#125; &#125; else if (!this$age.equals(other$age)) &#123; return false; &#125; return true; &#125; &#125; &#125; protected boolean canEqual(Object other) &#123; return other instanceof Person; &#125; public int hashCode() &#123; int PRIME = true; int result = 1; Object $name = this.name; int result = result * 59 + ($name == null ? 43 : $name.hashCode()); Object $age = this.age; result = result * 59 + ($age == null ? 43 : $age.hashCode()); return result; &#125;&#125; @ToString è‡ªåŠ¨ç”ŸæˆtoString()æ–¹æ³• 12345@ToStringpublic class Person &#123; private String name; private Integer age;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 1234567891011public class Person &#123; private String name; private Integer age; public Person() &#123; &#125; public String toString() &#123; return &quot;Person(name=&quot; + this.name + &quot;, age=&quot; + this.age + &quot;)&quot;; &#125;&#125; @Value è‡ªåŠ¨ç”Ÿæˆå…¨å‚æ„é€ å‡½æ•°ã€Getteræ–¹æ³•ã€equalsæ–¹æ³•ã€hashCodeæ³•ã€toStringæ–¹æ³• 12345@Valuepublic class Person &#123; private String name; private Integer age;&#125; æ³¨æ„ï¼š@Valueä¸ä¼šç”ŸæˆSetteræ–¹æ³• @Synchronized è‡ªåŠ¨ä¸ºè¢«æ ‡è®°çš„æ–¹æ³•æ·»åŠ synchronizedé” 123456789101112131415161718public class SynchronizedExample &#123; private final Object readLock = new Object(); @Synchronized public static void hello() &#123; System.out.println(&quot;world&quot;); &#125; @Synchronized public int answerToLife() &#123; return 42; &#125; @Synchronized(&quot;readLock&quot;) public void foo() &#123; System.out.println(&quot;bar&quot;); &#125;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 1234567891011121314151617181920212223public class SynchronizedExample &#123; private static final Object $LOCK = new Object[0]; private final Object $lock = new Object[0]; private final Object readLock = new Object(); public static void hello() &#123; synchronized($LOCK) &#123; System.out.println(&quot;world&quot;); &#125; &#125; public int answerToLife() &#123; synchronized($lock) &#123; return 42; &#125; &#125; public void foo() &#123; synchronized(readLock) &#123; System.out.println(&quot;bar&quot;); &#125; &#125;&#125; @Delegate ä¸ºæ ‡è®°å±æ€§ç”Ÿæˆå§”æ‰˜æ–¹æ³• 12345678910public class DelegateExample &#123; public void show() &#123; System.out.println(&quot;show...&quot;); &#125;&#125;@AllArgsConstructorpublic class Demo &#123; @Delegate private final DelegateExample delegateExample;&#125; å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ 1234567891011121314151617181920public class DelegateExample &#123; public DelegateExample() &#123; &#125; public void show() &#123; System.out.println(&quot;show...&quot;); &#125;&#125;public class Demo &#123; private final DelegateExample delegateExample; public Demo(DelegateExample delegateExample) &#123; this.delegateExample = delegateExample; &#125; // å§”æ‰˜æ–¹æ³• public void show() &#123; this.delegateExample.show(); &#125;&#125;","tags":[{"name":"Lombok","slug":"Lombok","permalink":"https://gcdd1993.github.io/tags/Lombok/"}]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸‰ï¼‰Apache ActiveMQ","date":"2019-04-02T03:33:26.000Z","path":"p/32495/","text":"åœ¨Ubuntuä¸Šå®‰è£…ActiveMQç³»ç»Ÿåˆå§‹åŒ–1234$ sudo apt update$ sudo apt dist-upgrade$ sudo apt autoremove$ sudo apt clean æ­å»ºactivemqæœåŠ¡1234567891011$ mkdir /home/active-mq$ cd /home/active-mq$ wget http://www.apache.org/dist/activemq/5.15.9/apache-activemq-5.15.9-bin.tar.gz# å…·ä½“ç‰ˆæœ¬è¯·æŸ¥çœ‹http://www.apache.org/dist/activemq$ tar -zxvf apache-activemq-5.15.9-bin.tar.gz# å¦‚æœæœªå®‰è£…jdkï¼Œæ‰§è¡Œ sudo apt-get install openjdk-8-jdk$ ./activemq startINFO: Loading &#x27;/home/active-mq/apache-activemq-5.15.9//bin/env&#x27;INFO: Using java &#x27;/usr/bin/java&#x27;INFO: Starting - inspect logfiles specified in logging.properties and log4j.properties to get detailsINFO: pidfile created : &#x27;/home/active-mq/apache-activemq-5.15.9//data/activemq.pid&#x27; (pid &#x27;6356&#x27;) ç›‘æ§æµè§ˆå™¨æ‰“å¼€http://localhost:8161/admin/ï¼Œè¾“å…¥adminï¼Œadmin è‡³æ­¤ï¼ŒActiveMQæ­å»ºå®Œæˆã€‚ ç†è§£JMS( Java Message Service)Javaæ¶ˆæ¯æœåŠ¡æŒ‡çš„æ˜¯ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œå¼‚æ­¥é€šä¿¡çš„APIï¼Œå®ƒä¸ºæ ‡å‡†æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æœåŠ¡æä¾›äº†ä¸€ç»„é€šç”¨æ¥å£ï¼ŒåŒ…æ‹¬åˆ›å»ºã€å‘é€ã€è¯»å–æ¶ˆæ¯ç­‰ï¼Œç”¨äºæ”¯æŒJAVAåº”ç”¨ç¨‹åºå¼€å‘ã€‚ JMSæ¨¡å‹ ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰æˆ–é˜Ÿåˆ—æ¨¡å‹ åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å°†è·å¾—æ¶ˆæ¯ ç”Ÿäº§è€…ä¸éœ€è¦åœ¨æ¥æ”¶è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯æœŸé—´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ¥æ”¶è€…ä¹ŸåŒæ ·ä¸éœ€è¦åœ¨æ¶ˆæ¯å‘é€æ—¶å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ æ¯ä¸€ä¸ªæˆåŠŸå¤„ç†çš„æ¶ˆæ¯éƒ½ç”±æ¥æ”¶è€…ç­¾æ”¶ å‘å¸ƒ/è®¢é˜…æ¨¡å‹ å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è·å¾—æ¶ˆæ¯ åœ¨å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´å­˜åœ¨æ—¶é—´ä¾èµ–æ€§ã€‚å‘å¸ƒè€…éœ€è¦åˆ›å»ºä¸€ä¸ªè®¢é˜…ï¼ˆsubscriptionï¼‰ï¼Œä»¥ä¾¿å®¢æˆ·èƒ½å¤Ÿè´­è®¢é˜…ã€‚è®¢é˜…è€…å¿…é¡»ä¿æŒæŒç»­çš„æ´»åŠ¨çŠ¶æ€ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œé™¤éè®¢é˜…è€…åˆ›å»ºäº†æŒä¹…çš„è®¢é˜…ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œåœ¨è®¢é˜…è€…æœªè¿æ¥æ—¶å‘å¸ƒçš„æ¶ˆæ¯å°†åœ¨è®¢é˜…è€…é‡æ–°è¿æ¥æ—¶é‡æ–°å‘å¸ƒã€‚ ä¼ ç»ŸAPIä¼ ç»ŸAPIæä¾›çš„ä¸»è¦æ¥å£å¦‚ä¸‹ï¼š ConnectionFactoryï¼šå®¢æˆ·ç«¯ç”¨æ¥åˆ›å»ºè¿æ¥çš„å—ç®¡å¯¹è±¡ã€‚ç®€åŒ–APIä¹Ÿä¼šä½¿ç”¨æ­¤æ¥å£ã€‚ Connectionï¼šå®¢æˆ·ç«¯åˆ°JMSæä¾›è€…ä¹‹é—´çš„æ´»åŠ¨è¿æ¥ã€‚ Sessionï¼šå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚ MessageProducerï¼šç”±Sessionåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºå‘é€æ¶ˆæ¯åˆ°Queueæˆ–Topic MessageConsumerï¼šç”±Sessionåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶Queueæˆ–Topicä¸­çš„æ¶ˆæ¯ ç®€åŒ–APIç®€åŒ–APIä¸ä¼ ç»ŸAPIæä¾›çš„æ¶ˆæ¯åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒéœ€è¦çš„æ¥å£æ›´å°‘ã€ä½¿ç”¨æ›´æ–¹ä¾¿ã€‚ ç®€åŒ–APIæä¾›çš„ä¸»è¦æ¥å£å¦‚ä¸‹ï¼š ConnectionFactoryï¼šå®¢æˆ·ç«¯ç”¨æ¥åˆ›å»ºè¿æ¥çš„å—ç®¡å¯¹è±¡ã€‚ä¼ ç»ŸAPIä¹Ÿä¼šä½¿ç”¨æ­¤æ¥å£ã€‚ JMSContextï¼šå®¢æˆ·ç«¯åˆ°JMSæä¾›è€…ä¹‹é—´çš„æ´»åŠ¨è¿æ¥ï¼Œä»¥åŠå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚ JMSProducerï¼šç”±JMSContextåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºå‘é€æ¶ˆæ¯åˆ°Queueæˆ–Topic JMSConsumerï¼šç”±JMSContextåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶Queueæˆ–Topicä¸­çš„æ¶ˆæ¯ åœ¨ç®€åŒ–APIä¸­ï¼Œä¸€ä¸ªJMSContextå¯¹è±¡å°è£…äº†ä¼ ç»ŸAPIä¸­Connectionå’ŒSessionä¸¤ä¸ªå¯¹è±¡çš„è¡Œä¸ºã€‚ å¼€å‘ä¸€ä¸ªJMSå®¢æˆ·ç«¯ä¸€ä¸ªä½¿ç”¨ä¼ ç»ŸAPIçš„JMSå®¢æˆ·ç«¯å…¸å‹çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š ä½¿ç”¨JNDIæŸ¥æ‰¾ä¸€ä¸ªConnectionFactoryå¯¹è±¡ ä½¿ç”¨JNDIæŸ¥æ‰¾ä¸€ä¸ªæˆ–å¤šä¸ªDestinationå¯¹è±¡ ä½¿ç”¨ConnectionFactoryåˆ›å»ºä¸€ä¸ªJMS Connectionå¯¹è±¡ ä½¿ç”¨Connectionåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªJMS Sessionå¯¹è±¡ ä½¿ç”¨Sessionå’ŒDestinationå¯¹è±¡åˆ›å»ºéœ€è¦çš„MessageProducerå’ŒMessageConsumerå¯¹è±¡ é€šçŸ¥Connectionå¯¹è±¡å¼€å§‹æŠ•é€’æ¶ˆæ¯ Active MQæ˜¯å®Œå…¨å®ç°JMSè§„èŒƒçš„JMSå®¢æˆ·ç«¯ Hello Worldåˆ›å»ºHello Worldé¡¹ç›®åˆ›å»ºgradleé¡¹ç›®ï¼Œå¹¶ç¼–è¾‘build.gradle 12compile group: &#x27;org.apache.activemq&#x27;, name: &#x27;activemq-all&#x27;, version: &#x27;5.15.9&#x27;compile group: &#x27;com.fasterxml.jackson.core&#x27;, name: &#x27;jackson-databind&#x27;, version: &#x27;2.9.8&#x27; åˆ›å»ºç”Ÿäº§è€…12345678910111213141516171819202122232425262728293031public class HelloWorldProducer implements Runnable &#123; @Override public void run() &#123; try &#123; // 1. åˆ›å»ºè¿æ¥å·¥å‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&quot;vm://localhost&quot;); // 2. åˆ›å»ºè¿æ¥ Connection connection = connectionFactory.createConnection(); connection.start(); // 3. åˆ›å»ºä¼šè¯ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); // 4. åˆ›å»ºç›®çš„åœ°ï¼ˆä¸»é¢˜æˆ–é˜Ÿåˆ—ï¼‰ Destination destination = session.createQueue(&quot;TEST.FOO&quot;); // 5. ä»ä¼šè¯åˆ›å»ºåˆ°ç›®çš„åœ°çš„æ¶ˆæ¯å‘å¸ƒè€… MessageProducer producer = session.createProducer(destination); producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT); // 6. åˆ›å»ºå¹¶å‘å¸ƒæ¶ˆæ¯ String text = &quot;Hello world! From: &quot; + Thread.currentThread().getName() + &quot; : &quot; + this.hashCode(); TextMessage message = session.createTextMessage(text); System.out.println(&quot;Sent message: &quot; + message.hashCode() + &quot; : &quot; + Thread.currentThread().getName()); producer.send(message); // 7. é”€æ¯èµ„æº session.close(); connection.close(); &#125; catch (JMSException e) &#123; System.out.println(&quot;Caught: &quot; + e); e.printStackTrace(); &#125; &#125;&#125; åˆ›å»ºæ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940public class HelloWorldConsumer implements Runnable, ExceptionListener &#123; @Override public void run() &#123; try &#123; // 1. åˆ›å»ºè¿æ¥å·¥å‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&quot;vm://localhost&quot;); // 2. åˆ›å»ºè¿æ¥ Connection connection = connectionFactory.createConnection(); connection.start(); // 3. åˆ›å»ºä¼šè¯ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); // 4. åˆ›å»ºç›®çš„åœ°ï¼ˆä¸»é¢˜æˆ–é˜Ÿåˆ—ï¼‰ Destination destination = session.createQueue(&quot;TEST.FOO&quot;); // 5. ä»ä¼šè¯åˆ›å»ºåˆ°ç›®çš„åœ°çš„æ¶ˆæ¯æ¶ˆè´¹è€… MessageConsumer consumer = session.createConsumer(destination); // 6. ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ Message message = consumer.receive(1000); if (message instanceof TextMessage) &#123; TextMessage textMessage = (TextMessage) message; String text = textMessage.getText(); System.out.println(&quot;Received: &quot; + text); &#125; else &#123; System.out.println(&quot;Received: &quot; + message); &#125; // 7. é”€æ¯èµ„æº consumer.close(); session.close(); connection.close(); &#125; catch (JMSException e) &#123; System.out.println(&quot;Caught: &quot; + e); e.printStackTrace(); &#125; &#125; @Override public synchronized void onException(JMSException exception) &#123; System.out.println(&quot;JMS Exception occured. Shutting down client.&quot;); &#125;&#125; æµ‹è¯•ç±»12345678910111213141516171819202122232425262728293031323334353637public class App &#123; public static void main(String[] args) throws InterruptedException &#123; thread(new HelloWorldProducer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); Thread.sleep(1000); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); Thread.sleep(1000); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldProducer(), false); Thread.sleep(1000); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldConsumer(), false); thread(new HelloWorldProducer(), false); &#125; public static void thread(Runnable runnable, boolean daemon) &#123; Thread brokerThread = new Thread(runnable); brokerThread.setDaemon(daemon); brokerThread.start(); &#125;&#125; è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ç¨‹åºï¼Œæ§åˆ¶å°å°†ä¼šæ‰“å°ï¼š 12345678910111213Sent message: 507732978 : Thread-6Sent message: 2056557229 : Thread-0Sent message: 39234146 : Thread-8Sent message: 1100925878 : Thread-13Sent message: 1566392082 : Thread-17Sent message: 1329793151 : Thread-1Sent message: 988436874 : Thread-16Received: Hello world! From: Thread-6 : 1442537083Received: Hello world! From: Thread-1 : 1531760310Received: Hello world! From: Thread-0 : 1817576164Received: Hello world! From: Thread-8 : 262381200Received: Hello world! From: Thread-17 : 1647178742Received: Hello world! From: Thread-13 : 1610404140","tags":[{"name":"æ¶ˆæ¯ä¸­é—´ä»¶","slug":"æ¶ˆæ¯ä¸­é—´ä»¶","permalink":"https://gcdd1993.github.io/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"ActiveMQ","slug":"ActiveMQ","permalink":"https://gcdd1993.github.io/tags/ActiveMQ/"}]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆäºŒï¼‰RabbitMQ","date":"2019-04-01T10:20:18.000Z","path":"p/45284/","text":"åœ¨Ubuntuä¸Šå®‰è£…RabbitMQç³»ç»Ÿåˆå§‹åŒ–12345678$ sudo apt update$ sudo apt dist-upgrade$ sudo apt autoremove$ sudo apt clean$ echo 127.0.0.1 mq &gt; /etc/hosts$ echo rabbitmq &gt; /etc/hostname$ export HOSTNAME=mq æ­å»ºrabbitmqæœåŠ¡1234$ echo &#x27;deb http://www.rabbitmq.com/debian/ testing main&#x27;| sudo tee /etc/apt/sources.list.d/rabbitmq.list$ wget -O- https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | sudo apt-key add -$ sudo apt-get update$ sudo apt-get install rabbitmq-server åˆ›å»ºç®¡ç†è´¦æˆ·1234567$ sudo rabbitmqctl add_user test test$ sudo rabbitmqctl add_vhost /test$ sudo rabbitmqctl set_user_tags test administrator$ sudo rabbitmqctl set_permissions -p /test test &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;$ sudo rabbitmq-plugins enable rabbitmq_management AMQPè§„èŒƒAMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œåè®®ã€‚å®ƒæ”¯æŒç¬¦åˆè¦æ±‚çš„å®¢æˆ·ç«¯åº”ç”¨ï¼ˆapplicationï¼‰å’Œæ¶ˆæ¯ä¸­é—´ä»¶ä»£ç†ï¼ˆmessaging middleware brokerï¼‰ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ æ¶ˆæ¯ä»£ç†å’Œä»–ä»¬æ‰€æ‰®æ¼”çš„è§’è‰²æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokersï¼‰ä»å‘å¸ƒè€…ï¼ˆpublishersï¼‰äº¦ç§°ç”Ÿäº§è€…ï¼ˆproducersï¼‰é‚£å„¿æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®æ—¢å®šçš„è·¯ç”±è§„åˆ™æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯å‘é€ç»™å¤„ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚ ç”±äºAMQPæ˜¯ä¸€ä¸ªç½‘ç»œåè®®ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¸­çš„å‘å¸ƒè€…ï¼Œæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä»£ç† å¯ä»¥å­˜åœ¨äºä¸åŒçš„è®¾å¤‡ä¸Šã€‚ AMQP 0-9-1 æ¨¡å‹ç®€ä»‹AMQP 0-9-1çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼šæ¶ˆæ¯ï¼ˆmessageï¼‰è¢«å‘å¸ƒè€…ï¼ˆpublisherï¼‰å‘é€ç»™äº¤æ¢æœºï¼ˆexchangeï¼‰ï¼Œäº¤æ¢æœºå¸¸å¸¸è¢«æ¯”å–»æˆé‚®å±€æˆ–è€…é‚®ç®±ã€‚ç„¶åäº¤æ¢æœºå°†æ”¶åˆ°çš„æ¶ˆæ¯æ ¹æ®è·¯ç”±è§„åˆ™åˆ†å‘ç»™ç»‘å®šçš„é˜Ÿåˆ—ï¼ˆqueueï¼‰ã€‚æœ€åAMQPä»£ç†ä¼šå°†æ¶ˆæ¯æŠ•é€’ç»™è®¢é˜…äº†æ­¤é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…æ¶ˆè´¹è€…æŒ‰ç…§éœ€æ±‚è‡ªè¡Œè·å–ã€‚ é˜Ÿåˆ—ï¼Œäº¤æ¢æœºå’Œç»‘å®šç»Ÿç§°ä¸ºAMQPå®ä½“ï¼ˆAMQP entitiesï¼‰ã€‚ äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹äº¤æ¢æœºæ˜¯ç”¨æ¥å‘é€æ¶ˆæ¯çš„AMQPå®ä½“ã€‚äº¤æ¢æœºæ‹¿åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¹‹åå°†å®ƒè·¯ç”±ç»™ä¸€ä¸ªæˆ–é›¶ä¸ªé˜Ÿåˆ—ã€‚å®ƒä½¿ç”¨å“ªç§è·¯ç”±ç®—æ³•æ˜¯ç”±äº¤æ¢æœºç±»å‹å’Œè¢«ç§°ä½œç»‘å®šï¼ˆbindingsï¼‰çš„è§„åˆ™æ‰€å†³å®šçš„ã€‚AMQP 0-9-1çš„ä»£ç†æä¾›äº†å››ç§äº¤æ¢æœº Nameï¼ˆäº¤æ¢æœºç±»å‹ï¼‰ Default pre-declared namesï¼ˆé¢„å£°æ˜çš„é»˜è®¤åç§°ï¼‰ Direct exchangeï¼ˆç›´è¿äº¤æ¢æœºï¼‰ (Empty string) and amq.direct Fanout exchangeï¼ˆæ‰‡å‹äº¤æ¢æœºï¼‰ amq.fanout Topic exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ amq.topic Headers exchangeï¼ˆå¤´äº¤æ¢æœºï¼‰ amq.match (and amq.headers in RabbitMQ) é™¤äº¤æ¢æœºç±»å‹å¤–ï¼Œåœ¨å£°æ˜äº¤æ¢æœºæ—¶è¿˜å¯ä»¥é™„å¸¦è®¸å¤šå…¶ä»–çš„å±æ€§ï¼Œå…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªåˆ†åˆ«æ˜¯ï¼š Name Durability ï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œäº¤æ¢æœºæ˜¯å¦è¿˜å­˜åœ¨ï¼‰ Auto-delete ï¼ˆå½“æ‰€æœ‰ä¸ä¹‹ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½å®Œæˆäº†å¯¹æ­¤äº¤æ¢æœºçš„ä½¿ç”¨åï¼Œåˆ æ‰å®ƒï¼‰ Argumentsï¼ˆä¾èµ–ä»£ç†æœ¬èº«ï¼‰ äº¤æ¢æœºå¯ä»¥æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šæŒä¹…ï¼ˆdurableï¼‰ã€æš‚å­˜ï¼ˆtransientï¼‰ã€‚æŒä¹…åŒ–çš„äº¤æ¢æœºä¼šåœ¨æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰é‡å¯åä¾æ—§å­˜åœ¨ï¼Œè€Œæš‚å­˜çš„äº¤æ¢æœºåˆ™ä¸ä¼šï¼ˆå®ƒä»¬éœ€è¦åœ¨ä»£ç†å†æ¬¡ä¸Šçº¿åé‡æ–°è¢«å£°æ˜ï¼‰ã€‚ é˜Ÿåˆ—AMQPä¸­çš„é˜Ÿåˆ—ï¼ˆqueueï¼‰è·Ÿå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„é˜Ÿåˆ—æ˜¯å¾ˆç›¸ä¼¼çš„ï¼šå®ƒä»¬å­˜å‚¨ç€å³å°†è¢«åº”ç”¨æ¶ˆè´¹æ‰çš„æ¶ˆæ¯ã€‚ é˜Ÿåˆ—è·Ÿäº¤æ¢æœºå…±äº«æŸäº›å±æ€§ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¹Ÿæœ‰ä¸€äº›å¦å¤–çš„å±æ€§ã€‚ Name Durableï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œé˜Ÿåˆ—ä¾æ—§å­˜åœ¨ï¼‰ Exclusiveï¼ˆåªè¢«ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰ä½¿ç”¨ï¼Œè€Œä¸”å½“è¿æ¥å…³é—­åé˜Ÿåˆ—å³è¢«åˆ é™¤ï¼‰ Auto-deleteï¼ˆå½“æœ€åä¸€ä¸ªæ¶ˆè´¹è€…é€€è®¢åå³è¢«åˆ é™¤ï¼‰ Argumentsï¼ˆä¸€äº›æ¶ˆæ¯ä»£ç†ç”¨ä»–æ¥å®Œæˆç±»ä¼¼ä¸TTLçš„æŸäº›é¢å¤–åŠŸèƒ½ï¼‰ é˜Ÿåˆ—åœ¨å£°æ˜ï¼ˆdeclareï¼‰åæ‰èƒ½è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—å°šä¸å­˜åœ¨ï¼Œå£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ä¼šåˆ›å»ºå®ƒã€‚å¦‚æœå£°æ˜çš„é˜Ÿåˆ—å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å±æ€§å®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆæ­¤æ¬¡å£°æ˜ä¸ä¼šå¯¹åŸæœ‰é˜Ÿåˆ—äº§ç”Ÿä»»ä½•å½±å“ã€‚å¦‚æœå£°æ˜ä¸­çš„å±æ€§ä¸å·²å­˜åœ¨é˜Ÿåˆ—çš„å±æ€§æœ‰å·®å¼‚ï¼Œé‚£ä¹ˆä¸€ä¸ªé”™è¯¯ä»£ç ä¸º406çš„é€šé“çº§å¼‚å¸¸å°±ä¼šè¢«æŠ›å‡ºã€‚ ç»‘å®šç»‘å®šï¼ˆBindingï¼‰æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰å°†æ¶ˆæ¯ï¼ˆmessageï¼‰è·¯ç”±ç»™é˜Ÿåˆ—ï¼ˆqueueï¼‰æ‰€éœ€éµå¾ªçš„è§„åˆ™ã€‚ æ¶ˆè´¹è€… å°†æ¶ˆæ¯æŠ•é€’ç»™åº”ç”¨ (â€œpush APIâ€) åº”ç”¨æ ¹æ®éœ€è¦ä¸»åŠ¨è·å–æ¶ˆæ¯ (â€œpull APIâ€) æ¶ˆæ¯ç¡®è®¤ è‡ªåŠ¨ç¡®è®¤ï¼šå½“æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰å°†æ¶ˆæ¯å‘é€ç»™åº”ç”¨åç«‹å³åˆ é™¤ã€‚ æ˜¾å¼ç¡®è®¤ï¼šå¾…åº”ç”¨ï¼ˆapplicationï¼‰å‘é€ä¸€ä¸ªç¡®è®¤å›æ‰§ï¼ˆacknowledgementï¼‰åå†åˆ é™¤æ¶ˆæ¯ã€‚ æ‹’ç»æ¶ˆæ¯å½“æ‹’ç»ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ é”€æ¯æ¶ˆæ¯ é‡æ–°æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ— å½“æ­¤é˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œè¯·ç¡®è®¤ä¸è¦ç”±äºæ‹’ç»æ¶ˆæ¯å¹¶ä¸”é€‰æ‹©äº†é‡æ–°æ”¾å…¥é˜Ÿåˆ—çš„è¡Œä¸ºè€Œå¼•èµ·æ¶ˆæ¯åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…èº«ä¸Šæ— é™å¾ªç¯çš„æƒ…å†µå‘ç”Ÿã€‚ Hello World ç”Ÿäº§(Producing)çš„æ„æ€å°±æ˜¯å‘é€ã€‚å‘é€æ¶ˆæ¯çš„ç¨‹åºå°±æ˜¯ä¸€ä¸ªç”Ÿäº§è€…(producer)ã€‚æˆ‘ä»¬ä¸€èˆ¬ç”¨â€Pâ€æ¥è¡¨ç¤º: é˜Ÿåˆ—(queue)å°±æ˜¯å­˜åœ¨äºRabbitMQä¸­é‚®ç®±çš„åç§°ã€‚è™½ç„¶æ¶ˆæ¯çš„ä¼ è¾“ç»è¿‡äº†RabbitMQå’Œä½ çš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å®ƒåªèƒ½è¢«å­˜å‚¨äºé˜Ÿåˆ—å½“ä¸­ã€‚å®è´¨ä¸Šé˜Ÿåˆ—å°±æ˜¯ä¸ªå·¨å¤§çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå®ƒçš„å¤§å°åªå—ä¸»æœºå†…å­˜å’Œç¡¬ç›˜é™åˆ¶ã€‚å¤šä¸ªç”Ÿäº§è€…ï¼ˆproducersï¼‰å¯ä»¥æŠŠæ¶ˆæ¯å‘é€ç»™åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒæ ·ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ä¹Ÿèƒ½å¤Ÿä»åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰ä¸­è·å–æ•°æ®ã€‚é˜Ÿåˆ—å¯ä»¥ç»˜åˆ¶æˆè¿™æ ·ï¼ˆå›¾ä¸Šæ˜¯é˜Ÿåˆ—çš„åç§°ï¼‰ï¼š åœ¨è¿™é‡Œï¼Œæ¶ˆè´¹ï¼ˆConsumingï¼‰å’Œæ¥æ”¶(receiving)æ˜¯åŒä¸€ä¸ªæ„æ€ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰å°±æ˜¯ä¸€ä¸ªç­‰å¾…è·å–æ¶ˆæ¯çš„ç¨‹åºã€‚æˆ‘ä»¬æŠŠå®ƒç»˜åˆ¶ä¸ºâ€Câ€ï¼š éœ€è¦æŒ‡å‡ºçš„æ˜¯ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ä»£ç†éœ€ä¸è¦å¾…åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šï¼›äº‹å®ä¸Šå¤§å¤šæ•°åº”ç”¨ä¹Ÿç¡®å®ä¸åœ¨ä¼šå°†ä»–ä»¬æ”¾åœ¨ä¸€å°æœºå™¨ä¸Šã€‚ åˆ›å»ºgradleé¡¹ç›®ï¼Œå¹¶é…ç½®build.gradleï¼š 1compile group: &#x27;com.rabbitmq&#x27;, name: &#x27;amqp-client&#x27;, version: &#x27;5.6.0&#x27; åˆ›å»ºç”Ÿäº§è€…12345678910111213141516171819public class Send &#123; private final static String QUEUE_NAME = &quot;hello&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; // 1. åˆ›å»ºRabbitMQè¿æ¥å·¥å‚ ConnectionFactory factory = new ConnectionFactory(); // 2. è®¾ç½®host,rabbitmq-serverçš„ç›‘å¬åœ°å€ factory.setHost(&quot;localhost&quot;); Connection connection = factory.newConnection(); // 4. åˆ›å»ºé¢‘é“ Channel channel = connection.createChannel(); // 5. è¿æ¥åˆ°å…·ä½“é¢‘é“ channel.queueDeclare(QUEUE_NAME, false, false, false, null); String message = &quot;Hello World!&quot;; // 6. å‘å¸ƒæ¶ˆæ¯ channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes()); System.out.println(&quot; [x] Sent &#x27;&quot; + message + &quot;&#x27;&quot;); &#125;&#125; åˆ›å»ºæ¶ˆè´¹è€…1234567891011121314151617181920public class Recv &#123; private final static String QUEUE_NAME = &quot;hello&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; ConnectionFactory factory = new ConnectionFactory(); factory.setHost(&quot;localhost&quot;); Connection connection = factory.newConnection(); // 4. åˆ›å»ºé¢‘é“ Channel channel = connection.createChannel(); channel.queueDeclare(QUEUE_NAME, false, false, false, null); System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;); DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123; String message = new String(delivery.getBody(), &quot;UTF-8&quot;); System.out.println(&quot; [x] Received &#x27;&quot; + message + &quot;&#x27;&quot;); &#125;; channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -&gt; &#123; &#125;); &#125;&#125; å¯ä»¥çœ‹å‡ºï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éœ€è¦å£°æ˜æ˜¯åŒä¸€ä¸ªé˜Ÿåˆ— æµ‹è¯•æˆ‘ä»¬å…ˆæ‰§è¡ŒSend.mainï¼Œæ§åˆ¶å°å°†æ‰“å°ï¼š 1[x] Sent &#x27;Hello World!&#x27; ç„¶åæ‰§è¡ŒRecv.mainï¼Œæ§åˆ¶å°å°†æ‰“å°ï¼š 12[*] Waiting for messages. To exit press CTRL+C[x] Received &#x27;Hello World!&#x27; ä»»åŠ¡é˜Ÿåˆ— å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆç§°ï¼šä»»åŠ¡é˜Ÿåˆ—â€”â€”Task Queuesï¼‰æ˜¯ä¸ºäº†é¿å…ç­‰å¾…ä¸€äº›å ç”¨å¤§é‡èµ„æºã€æ—¶é—´çš„æ“ä½œã€‚å½“æˆ‘ä»¬æŠŠä»»åŠ¡ï¼ˆTaskï¼‰å½“ä½œæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªè¿è¡Œåœ¨åå°çš„å·¥ä½œè€…ï¼ˆworkerï¼‰è¿›ç¨‹å°±ä¼šå–å‡ºä»»åŠ¡ç„¶åå¤„ç†ã€‚å½“ä½ è¿è¡Œå¤šä¸ªå·¥ä½œè€…ï¼ˆworkersï¼‰ï¼Œä»»åŠ¡å°±ä¼šåœ¨å®ƒä»¬ä¹‹é—´å…±äº«ã€‚ è¿™ä¸ªæ¦‚å¿µåœ¨ç½‘ç»œåº”ç”¨ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒå¯ä»¥åœ¨çŸ­æš‚çš„HTTPè¯·æ±‚ä¸­å¤„ç†ä¸€äº›å¤æ‚çš„ä»»åŠ¡ã€‚ ä¿®æ”¹Send.javaä»£ç ï¼Œæ¥é—´éš”10ç§’å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼š 1234567for (int i = 1; i &lt;= 100; i++) &#123; String message = String.format(&quot;å‘é€ç¬¬%dæ¡æ¶ˆæ¯&quot;, i); // 6. å‘å¸ƒæ¶ˆæ¯ channel.basicPublish(&quot;&quot;, &quot;hello&quot;, null, message.getBytes()); System.out.println(&quot; [x] Sent &#x27;&quot; + message + &quot;&#x27;&quot;); Thread.sleep(10000);&#125; ä¿®æ”¹Recv.javaï¼Œæ¥å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œè¿™é‡Œï¼Œå‡è£…ä»»åŠ¡æ‰§è¡Œéœ€è¦è€—æ—¶1sï¼š 1234567891011121314151617181920DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123; String message = new String(delivery.getBody(), &quot;UTF-8&quot;); System.out.println(&quot; [x] Received &#x27;&quot; + message + &quot;&#x27;&quot;); try &#123; doWork(message); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; System.out.println(&quot; [x] Done&quot;); &#125;&#125;;channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -&gt; &#123;&#125;);private static void doWork(String task) throws InterruptedException &#123; for (char ch : task.toCharArray()) &#123; if (ch == &#x27;-&#x27;) &#123; Thread.sleep(1000); &#125; &#125;&#125; æˆ‘ä»¬å…ˆå¼€å¯Recv.javaï¼Œç„¶åå¼€å¯Send.javaï¼Œæ§åˆ¶å°å°†ä¼šæ‰“å° Send.java 123[x] Sent &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;[x] Sent &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;[x] Sent &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27; Recv.java 123456[*] Waiting for messages. To exit press CTRL+C[x] Received &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;[x] Done[x] Received &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;[x] Done[x] Received &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27; å¾ªç¯è°ƒåº¦ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å®ƒèƒ½å¤Ÿå¹¶è¡Œçš„å¤„ç†é˜Ÿåˆ—ã€‚å¦‚æœå †ç§¯äº†å¾ˆå¤šä»»åŠ¡ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ æ›´å¤šçš„å·¥ä½œè€…ï¼ˆworkersï¼‰å°±å¯ä»¥äº†ï¼Œæ‰©å±•å¾ˆç®€å•ã€‚ è®©æˆ‘ä»¬å°è¯•åŒæ—¶è¿è¡Œä¸¤ä¸ªworkerå®ä¾‹ï¼Œä»–ä»¬éƒ½ä¼šä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼š Send.java 123[x] Sent &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;[x] Sent &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;[x] Sent &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27; Recv.java-1 12345[*] Waiting for messages. To exit press CTRL+C[x] Received &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;[x] Done[x] Received &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27;[x] Done Recv.java-2 123[*] Waiting for messages. To exit press CTRL+C[x] Received &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;[x] Done é»˜è®¤æ¥è¯´ï¼ŒRabbitMQä¼šæŒ‰é¡ºåºå¾—æŠŠæ¶ˆæ¯å‘é€ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚å¹³å‡æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°åŒç­‰æ•°é‡å¾—æ¶ˆæ¯ã€‚è¿™ç§å‘é€æ¶ˆæ¯å¾—æ–¹å¼å«åšâ€”â€”è½®è¯¢ï¼ˆround-robinï¼‰ã€‚è¯•ç€æ·»åŠ ä¸‰ä¸ªæˆ–æ›´å¤šå¾—å·¥ä½œè€…ï¼ˆworkersï¼‰ã€‚ æ¶ˆæ¯ç¡®è®¤å½“å¤„ç†ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶å¾—ä»»åŠ¡çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸æƒ³çŸ¥é“æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰æ˜¯å¦è¿è¡Œåˆ°ä¸€åŠå°±æŒ‚æ‰ã€‚å½“å‰çš„ä»£ç ä¸­ï¼Œå½“æ¶ˆæ¯è¢«RabbitMQå‘é€ç»™æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ä¹‹åï¼Œé©¬ä¸Šå°±ä¼šåœ¨å†…å­˜ä¸­ç§»é™¤ã€‚è¿™ç§æƒ…å†µï¼Œä½ åªè¦æŠŠä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰åœæ­¢ï¼Œæ­£åœ¨å¤„ç†çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚åŒæ—¶ï¼Œæ‰€æœ‰å‘é€åˆ°è¿™ä¸ªå·¥ä½œè€…çš„è¿˜æ²¡æœ‰å¤„ç†çš„æ¶ˆæ¯éƒ½ä¼šä¸¢å¤±ã€‚ æˆ‘ä»¬ä¸æƒ³ä¸¢å¤±ä»»ä½•ä»»åŠ¡æ¶ˆæ¯ã€‚å¦‚æœä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ä»»åŠ¡ä¼šé‡æ–°å‘é€ç»™å…¶ä»–çš„å·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚ ä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼ŒRabbitMQæä¾›äº†æ¶ˆæ¯å“åº”ï¼ˆacknowledgmentsï¼‰ã€‚æ¶ˆè´¹è€…ä¼šé€šè¿‡ä¸€ä¸ªackï¼ˆå“åº”ï¼‰ï¼Œå‘Šè¯‰RabbitMQå·²ç»æ”¶åˆ°å¹¶å¤„ç†äº†æŸæ¡æ¶ˆæ¯ï¼Œç„¶åRabbitMQå°±ä¼šé‡Šæ”¾å¹¶åˆ é™¤è¿™æ¡æ¶ˆæ¯ã€‚ å¦‚æœæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æŒ‚æ‰äº†ï¼Œæ²¡æœ‰å‘é€å“åº”ï¼ŒRabbitMQå°±ä¼šè®¤ä¸ºæ¶ˆæ¯æ²¡æœ‰è¢«å®Œå…¨å¤„ç†ï¼Œç„¶åé‡æ–°å‘é€ç»™å…¶ä»–æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚è¿™æ ·ï¼ŒåŠæ—¶å·¥ä½œè€…ï¼ˆworkersï¼‰å¶å°”çš„æŒ‚æ‰ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚ æ¶ˆæ¯æ˜¯æ²¡æœ‰è¶…æ—¶è¿™ä¸ªæ¦‚å¿µçš„ï¼›å½“å·¥ä½œè€…ä¸å®ƒæ–­å¼€è¿çš„æ—¶å€™ï¼ŒRabbitMQä¼šé‡æ–°å‘é€æ¶ˆæ¯ã€‚è¿™æ ·åœ¨å¤„ç†ä¸€ä¸ªè€—æ—¶éå¸¸é•¿çš„æ¶ˆæ¯ä»»åŠ¡çš„æ—¶å€™å°±ä¸ä¼šå‡ºé—®é¢˜äº†ã€‚ æ¶ˆæ¯å“åº”é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ä¹‹å‰çš„ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨no_ack=Trueæ ‡è¯†æŠŠå®ƒå…³é—­ã€‚æ˜¯æ—¶å€™ç§»é™¤è¿™ä¸ªæ ‡è¯†äº†ï¼Œå½“å·¥ä½œè€…ï¼ˆworkerï¼‰å®Œæˆäº†ä»»åŠ¡ï¼Œå°±å‘é€ä¸€ä¸ªå“åº”ã€‚ ä¿®æ”¹Worker.java 12345678910111213141516// ä¸€æ¬¡åªæ¥å—ä¸€æ¡æ¶ˆæ¯channel.basicQos(1);DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123; String message = new String(delivery.getBody(), &quot;UTF-8&quot;); System.out.println(&quot; [x] Received &#x27;&quot; + message + &quot;&#x27;&quot;); try &#123; doWork(message); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false); &#125;&#125;;boolean autoAck = false;channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, consumerTag -&gt; &#123;&#125;); è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å‘ç°å³ä½¿ä½¿ç”¨CTRL+Cæ€æ‰äº†ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰è¿›ç¨‹ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚å½“å·¥ä½œè€…ï¼ˆworkerï¼‰æŒ‚æ‰è¿™åï¼Œæ‰€æœ‰æ²¡æœ‰å“åº”çš„æ¶ˆæ¯éƒ½ä¼šé‡æ–°å‘é€ã€‚ æ¶ˆæ¯æŒä¹…åŒ–å¦‚æœä½ æ²¡æœ‰ç‰¹æ„å‘Šè¯‰RabbitMQï¼Œé‚£ä¹ˆåœ¨å®ƒé€€å‡ºæˆ–è€…å´©æºƒçš„æ—¶å€™ï¼Œå°†ä¼šä¸¢å¤±æ‰€æœ‰é˜Ÿåˆ—å’Œæ¶ˆæ¯ã€‚ä¸ºäº†ç¡®ä¿ä¿¡æ¯ä¸ä¼šä¸¢å¤±ï¼Œæœ‰ä¸¤ä¸ªäº‹æƒ…æ˜¯éœ€è¦æ³¨æ„çš„ï¼šæˆ‘ä»¬å¿…é¡»æŠŠâ€œé˜Ÿåˆ—â€å’Œâ€œæ¶ˆæ¯â€è®¾ä¸ºæŒä¹…åŒ–ã€‚ é¦–å…ˆï¼Œä¸ºäº†ä¸è®©é˜Ÿåˆ—æ¶ˆå¤±ï¼Œéœ€è¦æŠŠé˜Ÿåˆ—å£°æ˜ä¸ºæŒä¹…åŒ–ï¼ˆdurableï¼‰ï¼š 12boolean durable = true;channel.queueDeclare(QUEUE_NAME, durable, false, false, null); å°½ç®¡è¿™è¡Œä»£ç æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä»ç„¶ä¸ä¼šæ­£ç¡®è¿è¡Œã€‚å› ä¸ºæˆ‘ä»¬å·²ç»å®šä¹‰è¿‡ä¸€ä¸ªå«helloçš„éæŒä¹…åŒ–é˜Ÿåˆ—ã€‚RabbitMqä¸å…è®¸ä½ ä½¿ç”¨ä¸åŒçš„å‚æ•°é‡æ–°å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ä½†æˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸ªå¿«æ·çš„è§£å†³æ–¹æ³•â€”â€”ç”¨ä¸åŒçš„åå­—ï¼Œä¾‹å¦‚task_queueã€‚ 12boolean durable = true;channel.queueDeclare(&quot;task_queue&quot;, durable, false, false, null); è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®ä¿åœ¨RabbitMqé‡å¯ä¹‹åqueue_declareé˜Ÿåˆ—ä¸ä¼šä¸¢å¤±ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…æ€§ - é€šè¿‡å°†MessagePropertiesï¼ˆå®ç°BasicPropertiesï¼‰è®¾ç½®ä¸ºå€¼PERSISTENT_TEXT_PLAINã€‚ 12345import com.rabbitmq.client.MessageProperties;channel.basicPublish(&quot;&quot;, &quot;task_queue&quot;, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes()); å…¬å¹³è°ƒåº¦ä½ åº”è¯¥å·²ç»å‘ç°ï¼Œå®ƒä»æ—§æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬æœŸæœ›çš„é‚£æ ·è¿›è¡Œåˆ†å‘ã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå·¥ä½œè€…ï¼ˆworkersï¼‰ï¼Œå¤„ç†å¥‡æ•°æ¶ˆæ¯çš„æ¯”è¾ƒç¹å¿™ï¼Œå¤„ç†å¶æ•°æ¶ˆæ¯çš„æ¯”è¾ƒè½»æ¾ã€‚ç„¶è€ŒRabbitMQå¹¶ä¸çŸ¥é“è¿™äº›ï¼Œå®ƒä»ç„¶ä¸€å¦‚æ—¢å¾€çš„æ´¾å‘æ¶ˆæ¯ã€‚ è¿™æ—¶å› ä¸ºRabbitMQåªç®¡åˆ†å‘è¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¸ä¼šå…³å¿ƒæœ‰å¤šå°‘æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ²¡æœ‰ä½œå‡ºå“åº”ã€‚å®ƒç›²ç›®çš„æŠŠç¬¬n-thæ¡æ¶ˆæ¯å‘ç»™ç¬¬n-thä¸ªæ¶ˆè´¹è€…ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨basicQosæ–¹æ³•ï¼Œå¹¶è®¾ç½®prefetchCount = 1ã€‚è¿™æ ·æ˜¯å‘Šè¯‰RabbitMQï¼Œå†åŒä¸€æ—¶åˆ»ï¼Œä¸è¦å‘é€è¶…è¿‡1æ¡æ¶ˆæ¯ç»™ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰ï¼Œç›´åˆ°å®ƒå·²ç»å¤„ç†äº†ä¸Šä¸€æ¡æ¶ˆæ¯å¹¶ä¸”ä½œå‡ºäº†å“åº”ã€‚è¿™æ ·ï¼ŒRabbitMQå°±ä¼šæŠŠæ¶ˆæ¯åˆ†å‘ç»™ä¸‹ä¸€ä¸ªç©ºé—²çš„å·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚ 12int prefetchCount = 1;channel.basicQos(prefetchCount); å‘å¸ƒï¼è®¢é˜…åœ¨ä¸Šç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡åªåˆ†å‘ç»™ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚åœ¨æœ¬ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦åšçš„è·Ÿä¹‹å‰å®Œå…¨ä¸ä¸€æ · â€”â€” åˆ†å‘ä¸€ä¸ªæ¶ˆæ¯ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä¸ºâ€œå‘å¸ƒï¼è®¢é˜…â€ã€‚ ä¸ºäº†æè¿°è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å°†ä¼šæ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚ äº¤æ¢æœºï¼ˆExchangesï¼‰RabbitMQä¸­å®Œæ•´çš„æ¶ˆæ¯æ¨¡å‹ï¼š å‘å¸ƒè€…ï¼ˆproducerï¼‰æ˜¯å‘å¸ƒæ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ é˜Ÿåˆ—ï¼ˆqueueï¼‰ç”¨äºæ¶ˆæ¯å­˜å‚¨çš„ç¼“å†²ã€‚ æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ˜¯æ¥æ”¶æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ RabbitMQæ¶ˆæ¯æ¨¡å‹çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼šå‘å¸ƒè€…ï¼ˆproducerï¼‰ä¸ä¼šç›´æ¥å‘é€ä»»ä½•æ¶ˆæ¯ç»™é˜Ÿåˆ—ã€‚äº‹å®ä¸Šï¼Œå‘å¸ƒè€…ï¼ˆproducerï¼‰ç”šè‡³ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦å·²ç»è¢«æŠ•é€’åˆ°é˜Ÿåˆ—ã€‚ å‘å¸ƒè€…ï¼ˆproducerï¼‰åªéœ€è¦æŠŠæ¶ˆæ¯å‘é€ç»™ä¸€ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰ã€‚äº¤æ¢æœºéå¸¸ç®€å•ï¼Œå®ƒä¸€è¾¹ä»å‘å¸ƒè€…æ–¹æ¥æ”¶æ¶ˆæ¯ï¼Œä¸€è¾¹æŠŠæ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯åº”è¯¥æ¨é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—è¿˜æ˜¯æ˜¯å¤šä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ˜¯ç›´æ¥å¿½ç•¥æ¶ˆæ¯ã€‚è¿™äº›è§„åˆ™æ˜¯é€šè¿‡äº¤æ¢æœºç±»å‹ï¼ˆexchange typeï¼‰æ¥å®šä¹‰çš„ã€‚ æœ‰å‡ ä¸ªå¯ä¾›é€‰æ‹©çš„äº¤æ¢æœºç±»å‹ï¼šç›´è¿äº¤æ¢æœºï¼ˆdirectï¼‰, ä¸»é¢˜äº¤æ¢æœºï¼ˆtopicï¼‰, ï¼ˆå¤´äº¤æ¢æœºï¼‰headerså’Œ æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¸»è¦è¯´æ˜æœ€åä¸€ä¸ª â€”â€” æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰ã€‚å…ˆåˆ›å»ºä¸€ä¸ªfanoutç±»å‹çš„äº¤æ¢æœºï¼Œå‘½åä¸ºlogsï¼š 1channel.exchangeDeclare(&quot;logs&quot;, &quot;fanout&quot;); æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰å¾ˆç®€å•ï¼Œä½ å¯èƒ½ä»åå­—ä¸Šå°±èƒ½çŒœæµ‹å‡ºæ¥ï¼Œå®ƒæŠŠæ¶ˆæ¯å‘é€ç»™å®ƒæ‰€çŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªå…·åäº¤æ¢æœºäº†ï¼š 1channel.basicPublish( &quot;logs&quot;, &quot;&quot;, null, message.getBytes()); ä¸´æ—¶é˜Ÿåˆ—è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š å½“æˆ‘ä»¬è¿æ¥ä¸ŠRabbitMQçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ã€ç©ºçš„é˜Ÿåˆ—ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªéšæœºçš„é˜Ÿåˆ—åï¼Œæˆ–è€…è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºçš„é˜Ÿåˆ—åï¼ˆæ¨èï¼‰ã€‚ å½“ä¸æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ–­å¼€è¿æ¥çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—åº”å½“è¢«ç«‹å³åˆ é™¤ã€‚ åœ¨Javaå®¢æˆ·ç«¯ä¸­ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰å‘queueDeclareï¼ˆï¼‰æä¾›å‚æ•°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆçš„åç§°åˆ›å»ºä¸€ä¸ªéæŒä¹…çš„ï¼Œç‹¬å çš„è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—ï¼š 12// æœåŠ¡å™¨åˆ†é…çš„éšæœºé˜Ÿåˆ—åï¼Œå¯èƒ½åƒè¿™æ · amq.gen-U0srCoW8TsaXjNh73pnVAw==String queueName = channel.queueDeclare().getQueue(); ç»‘å®šï¼ˆBindingsï¼‰ æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰å’Œä¸€ä¸ªé˜Ÿåˆ—ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰äº¤æ¢æœºå¦‚ä½•å‘é€æ¶ˆæ¯ç»™æˆ‘ä»¬çš„é˜Ÿåˆ—ã€‚äº¤æ¢å™¨å’Œé˜Ÿåˆ—ä¹‹é—´çš„è”ç³»æˆ‘ä»¬ç§°ä¹‹ä¸ºç»‘å®šï¼ˆbindingï¼‰ã€‚ 1channel.queueBind(queueName, &quot;logs&quot;, &quot;&quot;); è·¯ç”±(Routing)å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºè¿‡ç»‘å®šï¼ˆbindingsï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š 1channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;); ç»‘å®šï¼ˆbindingï¼‰æ˜¯æŒ‡äº¤æ¢æœºï¼ˆexchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆqueueï¼‰çš„å…³ç³»ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šè¿™ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰å¯¹è¿™ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰çš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚ ç»‘å®šçš„æ—¶å€™å¯ä»¥å¸¦ä¸Šä¸€ä¸ªé¢å¤–çš„routing_keyå‚æ•°ã€‚ä¸ºäº†é¿å…ä¸basic_publishçš„å‚æ•°æ··æ·†ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšç»‘å®šé”®ï¼ˆbinding keyï¼‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¸¦ç»‘å®šé”®çš„ç»‘å®šã€‚ 1channel.queueBind(queueName, EXCHANGE_NAME, &quot;black&quot;); ç»‘å®šé”®çš„æ„ä¹‰å–å†³äºäº¤æ¢æœºï¼ˆexchangeï¼‰çš„ç±»å‹ã€‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡çš„æ‰‡å‹äº¤æ¢æœºï¼ˆfanout exchangesï¼‰ä¼šå¿½ç•¥è¿™ä¸ªå€¼ã€‚ ç›´è¿äº¤æ¢æœºï¼ˆDirect exchangeï¼‰æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå¹¿æ’­æ‰€æœ‰çš„æ¶ˆæ¯ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚æˆ‘ä»¬æ‰“ç®—æ‰©å±•å®ƒï¼Œä½¿å…¶åŸºäºæ—¥å¿—çš„ä¸¥é‡ç¨‹åº¦è¿›è¡Œæ¶ˆæ¯è¿‡æ»¤ã€‚ æˆ‘ä»¬ä½¿ç”¨çš„æ‰‡å‹äº¤æ¢æœºï¼ˆfanout exchangeï¼‰æ²¡æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ â€”â€” å®ƒèƒ½åšçš„ä»…ä»…æ˜¯å¹¿æ’­ã€‚ æˆ‘ä»¬å°†ä¼šä½¿ç”¨ç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰æ¥ä»£æ›¿ã€‚è·¯ç”±çš„ç®—æ³•å¾ˆç®€å• â€”â€” äº¤æ¢æœºå°†ä¼šå¯¹ç»‘å®šé”®ï¼ˆbinding keyï¼‰å’Œè·¯ç”±é”®ï¼ˆrouting keyï¼‰è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä»è€Œç¡®å®šæ¶ˆæ¯è¯¥åˆ†å‘åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚ ä¸‹å›¾èƒ½å¤Ÿå¾ˆå¥½çš„æè¿°è¿™ä¸ªåœºæ™¯ï¼š åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´è¿äº¤æ¢æœº Xå’Œä¸¤ä¸ªé˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®šã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä½¿ç”¨orangeä½œä¸ºç»‘å®šé”®ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—æœ‰ä¸¤ä¸ªç»‘å®šï¼Œä¸€ä¸ªä½¿ç”¨blackä½œä¸ºç»‘å®šé”®ï¼Œå¦å¤–ä¸€ä¸ªä½¿ç”¨greenã€‚ è¿™æ ·ä»¥æ¥ï¼Œå½“è·¯ç”±é”®ä¸ºorangeçš„æ¶ˆæ¯å‘å¸ƒåˆ°äº¤æ¢æœºï¼Œå°±ä¼šè¢«è·¯ç”±åˆ°é˜Ÿåˆ—Q1ã€‚è·¯ç”±é”®ä¸ºblackæˆ–è€…greençš„æ¶ˆæ¯å°±ä¼šè·¯ç”±åˆ°Q2ã€‚å…¶ä»–çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å°†ä¼šè¢«ä¸¢å¼ƒã€‚ å¤šä¸ªç»‘å®šï¼ˆMultiple bindingsï¼‰ å¤šä¸ªé˜Ÿåˆ—ä½¿ç”¨ç›¸åŒçš„ç»‘å®šé”®æ˜¯åˆæ³•çš„ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªXå’ŒQ1ä¹‹é—´çš„ç»‘å®šï¼Œä½¿ç”¨blackç»‘å®šé”®ã€‚è¿™æ ·ä¸€æ¥ï¼Œç›´è¿äº¤æ¢æœºå°±å’Œæ‰‡å‹äº¤æ¢æœºçš„è¡Œä¸ºä¸€æ ·ï¼Œä¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ã€‚å¸¦æœ‰blackè·¯ç”±é”®çš„æ¶ˆæ¯ä¼šåŒæ—¶å‘é€åˆ°Q1å’ŒQ2ã€‚ å‘é€æ—¥å¿—æˆ‘ä»¬å°†ä¼šå‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ŒæŠŠæ—¥å¿—çº§åˆ«ä½œä¸ºè·¯ç”±é”®ã€‚è¿™æ ·æ¥æ”¶æ—¥å¿—çš„è„šæœ¬å°±å¯ä»¥æ ¹æ®ä¸¥é‡çº§åˆ«æ¥é€‰æ‹©å®ƒæƒ³è¦å¤„ç†çš„æ—¥å¿—ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹å‘é€æ—¥å¿—ã€‚ æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰ï¼š 1channel.exchangeDeclare(EXCHANGE_NAME, &quot;direct&quot;); ç„¶åæˆ‘ä»¬å‘é€ä¸€åˆ™æ¶ˆæ¯ï¼š 1channel.basicPublish(EXCHANGE_NAME, severity, null, message.getBytes()); è®¢é˜…å¤„ç†æ¥æ”¶æ¶ˆæ¯çš„æ–¹å¼å’Œä¹‹å‰å·®ä¸å¤šï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œæˆ‘ä»¬å°†ä¼šä¸ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ¯ä¸ªä¸¥é‡çº§åˆ«åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæ–°çš„ç»‘å®šã€‚ 12345String queueName = channel.queueDeclare().getQueue();for(String severity : argv)&#123; channel.queueBind(queueName, EXCHANGE_NAME, severity);&#125; ç¤ºä¾‹ä»£ç  Routing ä¸»é¢˜äº¤æ¢æœºç›´è¿äº¤æ¢æœºçš„é™åˆ¶ â€”â€” æ²¡åŠæ³•åŸºäºå¤šä¸ªæ ‡å‡†æ‰§è¡Œè·¯ç”±æ“ä½œã€‚ å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºï¼ˆtopic exchangeï¼‰çš„æ¶ˆæ¯ä¸å¯ä»¥æºå¸¦éšæ„ä»€ä¹ˆæ ·å­çš„è·¯ç”±é”®ï¼ˆrouting_keyï¼‰ï¼Œå®ƒçš„è·¯ç”±é”®å¿…é¡»æ˜¯ä¸€ä¸ªç”±.åˆ†éš”å¼€çš„è¯è¯­åˆ—è¡¨ã€‚è¿™äº›å•è¯éšä¾¿æ˜¯ä»€ä¹ˆéƒ½å¯ä»¥ï¼Œä½†æ˜¯æœ€å¥½æ˜¯è·Ÿæºå¸¦å®ƒä»¬çš„æ¶ˆæ¯æœ‰å…³ç³»çš„è¯æ±‡ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªæ¨èçš„ä¾‹å­ï¼šâ€stock.usd.nyseâ€, â€œnyse.vmwâ€, â€œquick.orange.rabbitâ€ã€‚è¯è¯­çš„ä¸ªæ•°å¯ä»¥éšæ„ï¼Œä½†æ˜¯ä¸è¦è¶…è¿‡255å­—èŠ‚ã€‚ ç»‘å®šé”®ä¹Ÿå¿…é¡»æ‹¥æœ‰åŒæ ·çš„æ ¼å¼ã€‚ä¸»é¢˜äº¤æ¢æœºèƒŒåçš„é€»è¾‘è·Ÿç›´è¿äº¤æ¢æœºå¾ˆç›¸ä¼¼ â€”â€” ä¸€ä¸ªæºå¸¦ç€ç‰¹å®šè·¯ç”±é”®çš„æ¶ˆæ¯ä¼šè¢«ä¸»é¢˜äº¤æ¢æœºæŠ•é€’ç»™ç»‘å®šé”®ä¸ä¹‹æƒ³åŒ¹é…çš„é˜Ÿåˆ—ã€‚ä½†æ˜¯å®ƒçš„ç»‘å®šé”®å’Œè·¯ç”±é”®æœ‰ä¸¤ä¸ªç‰¹æ®Šåº”ç”¨æ–¹å¼ï¼š * (æ˜Ÿå·) ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå•è¯. # (äº•å·) ç”¨æ¥è¡¨ç¤ºä»»æ„æ•°é‡ï¼ˆé›¶ä¸ªæˆ–å¤šä¸ªï¼‰å•è¯ã€‚ ä¸‹è¾¹ç”¨å›¾è¯´æ˜ï¼š æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªç»‘å®šï¼šQ1çš„ç»‘å®šé”®ä¸º *.orange.*ï¼ŒQ2çš„ç»‘å®šé”®ä¸º *.*.rabbit å’Œ lazy.# ã€‚ è¿™ä¸‰ä¸ªç»‘å®šé”®è¢«å¯ä»¥æ€»ç»“ä¸ºï¼š Q1 å¯¹æ‰€æœ‰çš„æ¡”é»„è‰²åŠ¨ç‰©éƒ½æ„Ÿå…´è¶£ã€‚ Q2 åˆ™æ˜¯å¯¹æ‰€æœ‰çš„å…”å­å’Œæ‰€æœ‰æ‡’æƒ°çš„åŠ¨ç‰©æ„Ÿå…´è¶£ã€‚ ä¸»é¢˜äº¤æ¢æœºæ˜¯å¾ˆå¼ºå¤§çš„ï¼Œå®ƒå¯ä»¥è¡¨ç°å‡ºè·Ÿå…¶ä»–äº¤æ¢æœºç±»ä¼¼çš„è¡Œä¸º å½“ä¸€ä¸ªé˜Ÿåˆ—çš„ç»‘å®šé”®ä¸º â€œ#â€ï¼ˆäº•å·ï¼‰ çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°†ä¼šæ— è§†æ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œæ¥æ”¶æ‰€æœ‰çš„æ¶ˆæ¯ã€‚ å½“ * (æ˜Ÿå·) å’Œ # (äº•å·) è¿™ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦éƒ½æœªåœ¨ç»‘å®šé”®ä¸­å‡ºç°çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»é¢˜äº¤æ¢æœºå°±æ‹¥æœ‰çš„ç›´è¿äº¤æ¢æœºçš„è¡Œä¸ºã€‚ è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰å¦‚æœæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå‡½æ•°è¿è¡Œåœ¨è¿œç¨‹è®¡ç®—æœºä¸Šå¹¶ä¸”ç­‰å¾…ä»é‚£å„¿è·å–ç»“æœæ—¶ï¼Œè¿™ç§æ¨¡å¼é€šå¸¸è¢«ç§°ä¸ºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼‰æˆ–è€…RPCã€‚ æˆ‘ä»¬ä¼šä½¿ç”¨RabbitMQæ¥æ„å»ºä¸€ä¸ªRPCç³»ç»Ÿï¼šåŒ…å«ä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªRPCæœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯æ¥å£ä¸ºäº†å±•ç¤ºRPCæœåŠ¡å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ç±»ã€‚å®ƒä¼šæš´éœ²å‡ºä¸€ä¸ªåä¸ºâ€œcallâ€çš„æ–¹æ³•ç”¨æ¥å‘é€ä¸€ä¸ªRPCè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æ”¶åˆ°å›åº”å‰ä¿æŒé˜»å¡ã€‚ 123FibonacciRpcClient fibonacciRpc = new FibonacciRpcClient();String result = fibonacciRpc.call(&quot;4&quot;);System.out.println( &quot;fib(4) is &quot; + result); å›è°ƒé˜Ÿåˆ—ä¸€èˆ¬æ¥è¯´é€šè¿‡RabbitMQæ¥å®ç°RPCæ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€è¯·æ±‚ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ç«¯å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ªå›å¤ä¿¡æ¯ä¸­ã€‚ä¸ºäº†æ¥æ”¶åˆ°å›å¤ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯éœ€è¦åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™åŒæ—¶å‘é€ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼ˆcallback queueï¼‰çš„åœ°å€ã€‚ 12345678callbackQueueName = channel.queueDeclare().getQueue();BasicProperties props = new BasicProperties .Builder() .replyTo(callbackQueueName) .build();channel.basicPublish(&quot;&quot;, &quot;rpc_queue&quot;, props, message.getBytes()); æ¶ˆæ¯å±æ€§AMQPåè®®ç»™æ¶ˆæ¯é¢„å®šä¹‰äº†ä¸€ç³»åˆ—çš„14ä¸ªå±æ€§ã€‚å¤§å¤šæ•°å±æ€§å¾ˆå°‘ä¼šç”¨åˆ°ï¼Œé™¤äº†ä»¥ä¸‹å‡ ä¸ªï¼š delivery_modeï¼ˆæŠ•é€’æ¨¡å¼ï¼‰ï¼šå°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…çš„ï¼ˆå€¼ä¸º2ï¼‰æˆ–æš‚å­˜çš„ï¼ˆé™¤äº†2ä¹‹å¤–çš„å…¶ä»–ä»»ä½•å€¼ï¼‰ã€‚ç¬¬äºŒç¯‡æ•™ç¨‹é‡Œæ¥è§¦è¿‡è¿™ä¸ªå±æ€§ï¼Œè®°å¾—å§ï¼Ÿ content_typeï¼ˆå†…å®¹ç±»å‹ï¼‰:ç”¨æ¥æè¿°ç¼–ç çš„mime-typeã€‚ä¾‹å¦‚åœ¨å®é™…ä½¿ç”¨ä¸­å¸¸å¸¸ä½¿ç”¨application/jsonæ¥æè¿°JOSNç¼–ç ç±»å‹ã€‚ reply_toï¼ˆå›å¤ç›®æ ‡ï¼‰ï¼šé€šå¸¸ç”¨æ¥å‘½åå›è°ƒé˜Ÿåˆ—ã€‚ correlation_idï¼ˆå…³è”æ ‡è¯†ï¼‰ï¼šç”¨æ¥å°†RPCçš„å“åº”å’Œè¯·æ±‚å…³è”èµ·æ¥ã€‚ å…³è”æ ‡è¯†ä¸Šè¾¹ä»‹ç»çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å»ºè®®ç»™æ¯ä¸€ä¸ªRPCè¯·æ±‚æ–°å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„åšæ³•ï¼Œå¹¸å¥½è¿™å„¿æœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³• â€”â€” æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åªå»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„å›è°ƒé˜Ÿåˆ—ã€‚ è¿™å°±å¸¦æ¥ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå½“æ­¤é˜Ÿåˆ—æ¥æ”¶åˆ°ä¸€ä¸ªå“åº”çš„æ—¶å€™å®ƒæ— æ³•è¾¨åˆ«å‡ºè¿™ä¸ªå“åº”æ˜¯å±äºå“ªä¸ªè¯·æ±‚çš„ã€‚correlation_id å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæ¥çš„ã€‚æˆ‘ä»¬ç»™æ¯ä¸ªè¯·æ±‚è®¾ç½®ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ã€‚ç¨åï¼Œå½“æˆ‘ä»¬ä»å›è°ƒé˜Ÿåˆ—ä¸­æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹è¿™æ¡å±æ€§ä»è€Œå°†å“åº”å’Œè¯·æ±‚åŒ¹é…èµ·æ¥ã€‚å¦‚æœæˆ‘ä»¬æ¥æ‰‹åˆ°çš„æ¶ˆæ¯çš„correlation_idæ˜¯æœªçŸ¥çš„ï¼Œé‚£å°±ç›´æ¥é”€æ¯æ‰å®ƒï¼Œå› ä¸ºå®ƒä¸å±äºæˆ‘ä»¬çš„ä»»ä½•ä¸€æ¡è¯·æ±‚ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¥æ”¶åˆ°æœªçŸ¥æ¶ˆæ¯çš„æ—¶å€™ä¸æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€Œæ˜¯è¦å°†å®ƒå¿½ç•¥æ‰ï¼Ÿè¿™æ˜¯ä¸ºäº†è§£å†³æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½å‘ç”Ÿçš„ç«äº‰æƒ…å†µã€‚å°½ç®¡å¯èƒ½æ€§ä¸å¤§ï¼Œä½†RPCæœåŠ¡å™¨è¿˜æ˜¯æœ‰å¯èƒ½åœ¨å·²å°†åº”ç­”å‘é€ç»™æˆ‘ä»¬ä½†è¿˜æœªå°†ç¡®è®¤æ¶ˆæ¯å‘é€ç»™è¯·æ±‚çš„æƒ…å†µä¸‹æ­»æ‰ã€‚å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒRPCåœ¨é‡å¯åä¼šé‡æ–°å¤„ç†è¯·æ±‚ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨å®¢æˆ·ç«¯ä¼˜é›…çš„å¤„ç†é‡å¤å“åº”ï¼ŒåŒæ—¶RPCä¹Ÿéœ€è¦å°½å¯èƒ½ä¿æŒå¹‚ç­‰æ€§ã€‚ æ€»ç»“ æˆ‘ä»¬çš„RPCå¦‚æ­¤å·¥ä½œ: å½“å®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªåŒ¿åç‹¬äº«çš„å›è°ƒé˜Ÿåˆ—ã€‚ åœ¨RPCè¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€å¸¦æœ‰ä¸¤ä¸ªå±æ€§çš„æ¶ˆæ¯ï¼šä¸€ä¸ªæ˜¯è®¾ç½®å›è°ƒé˜Ÿåˆ—çš„ reply_to å±æ€§ï¼Œå¦ä¸€ä¸ªæ˜¯è®¾ç½®å”¯ä¸€å€¼çš„ correlation_id å±æ€§ã€‚ å°†è¯·æ±‚å‘é€åˆ°ä¸€ä¸ª rpc_queue é˜Ÿåˆ—ä¸­ã€‚ RPCå·¥ä½œè€…ï¼ˆåˆåï¼šæœåŠ¡å™¨ï¼‰ç­‰å¾…è¯·æ±‚å‘é€åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­æ¥ã€‚å½“è¯·æ±‚å‡ºç°çš„æ—¶å€™ï¼Œå®ƒæ‰§è¡Œä»–çš„å·¥ä½œå¹¶ä¸”å°†å¸¦æœ‰æ‰§è¡Œç»“æœçš„æ¶ˆæ¯å‘é€ç»™reply_toå­—æ®µæŒ‡å®šçš„é˜Ÿåˆ—ã€‚ å®¢æˆ·ç«¯ç­‰å¾…å›è°ƒé˜Ÿåˆ—é‡Œçš„æ•°æ®ã€‚å½“æœ‰æ¶ˆæ¯å‡ºç°çš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æŸ¥correlation_idå±æ€§ã€‚å¦‚æœæ­¤å±æ€§çš„å€¼ä¸è¯·æ±‚åŒ¹é…ï¼Œå°†å®ƒè¿”å›ç»™åº”ç”¨ã€‚","tags":[{"name":"æ¶ˆæ¯ä¸­é—´ä»¶","slug":"æ¶ˆæ¯ä¸­é—´ä»¶","permalink":"https://gcdd1993.github.io/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"https://gcdd1993.github.io/tags/RabbitMQ/"}]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸€ï¼‰ç®€ä»‹","date":"2019-04-01T10:01:43.000Z","path":"p/27791/","text":"æ¶ˆæ¯é˜Ÿåˆ—(MQ)æ¦‚è¿°æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ï¼Œå…¶é€šç”¨çš„ä½¿ç”¨åœºæ™¯å¯ä»¥ç®€å•åœ°æè¿°ä¸ºï¼š å½“ä¸éœ€è¦ç«‹å³è·å¾—ç»“æœï¼Œä½†æ˜¯å¹¶å‘é‡åˆéœ€è¦è¿›è¡Œæ§åˆ¶çš„æ—¶å€™ï¼Œå·®ä¸å¤šå°±æ˜¯éœ€è¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦è§£å†³äº†åº”ç”¨è€¦åˆã€å¼‚æ­¥å¤„ç†ã€æµé‡å‰Šé”‹ç­‰é—®é¢˜ã€‚ å½“å‰ä½¿ç”¨è¾ƒå¤šçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰RabbitMQã€RocketMQã€ActiveMQã€Kafkaã€ZeroMQã€MetaMqç­‰ï¼Œè€Œéƒ¨åˆ†æ•°æ®åº“å¦‚Redisã€Mysqlä»¥åŠphxsqlä¹Ÿå¯å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯æ¶ˆæ¯é˜Ÿåˆ—åœ¨å®é™…åº”ç”¨ä¸­åŒ…æ‹¬å¦‚ä¸‹å››ä¸ªåœºæ™¯ï¼š åº”ç”¨è€¦åˆï¼šå¤šåº”ç”¨é—´é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé¿å…è°ƒç”¨æ¥å£å¤±è´¥å¯¼è‡´æ•´ä¸ªè¿‡ç¨‹å¤±è´¥ï¼› å¼‚æ­¥å¤„ç†ï¼šå¤šåº”ç”¨å¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œåº”ç”¨é—´å¹¶å‘å¤„ç†æ¶ˆæ¯ï¼Œç›¸æ¯”ä¸²è¡Œå¤„ç†ï¼Œå‡å°‘å¤„ç†æ—¶é—´ï¼› é™æµå‰Šå³°ï¼šå¹¿æ³›åº”ç”¨äºç§’æ€æˆ–æŠ¢è´­æ´»åŠ¨ä¸­ï¼Œé¿å…æµé‡è¿‡å¤§å¯¼è‡´åº”ç”¨ç³»ç»ŸæŒ‚æ‰çš„æƒ…å†µï¼› æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿï¼šç³»ç»Ÿåˆ†ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ã€æ¶ˆæ¯ç”Ÿäº§è€…ã€æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…è´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…(å¯èƒ½æœ‰å¤šä¸ª)è´Ÿè´£å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼› ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸Šè¿°å››ä¸ªåœºæ™¯ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•åœ¨ä¸Šè¿°å››ä¸ªåœºæ™¯ä¸­ä½¿ç”¨ï¼š å¼‚æ­¥å¤„ç†å…·ä½“åœºæ™¯ï¼šç”¨æˆ·ä¸ºäº†ä½¿ç”¨æŸä¸ªåº”ç”¨ï¼Œè¿›è¡Œæ³¨å†Œï¼Œç³»ç»Ÿéœ€è¦å‘é€æ³¨å†Œé‚®ä»¶å¹¶éªŒè¯çŸ­ä¿¡ã€‚å¯¹è¿™ä¸¤ä¸ªæ“ä½œçš„å¤„ç†æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸²è¡ŒåŠå¹¶è¡Œã€‚ ä¸²è¡Œæ–¹å¼æ–°æ³¨å†Œä¿¡æ¯ç”Ÿæˆåï¼Œå…ˆå‘é€æ³¨å†Œé‚®ä»¶ï¼Œå†å‘é€éªŒè¯çŸ­ä¿¡ï¼› åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œéœ€è¦æœ€ç»ˆå‘é€éªŒè¯çŸ­ä¿¡åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å¹¶è¡Œå¤„ç†æ–°æ³¨å†Œä¿¡æ¯å†™å…¥åï¼Œç”±å‘çŸ­ä¿¡å’Œå‘é‚®ä»¶å¹¶è¡Œå¤„ç†ï¼› åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå‘çŸ­ä¿¡å’Œå‘é‚®ä»¶ éœ€å¤„ç†å®Œæˆåå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å‡è®¾ä»¥ä¸Šä¸‰ä¸ªå­ç³»ç»Ÿå¤„ç†çš„æ—¶é—´å‡ä¸º50msï¼Œä¸”ä¸è€ƒè™‘ç½‘ç»œå»¶è¿Ÿï¼Œåˆ™æ€»çš„å¤„ç†æ—¶é—´ï¼š ä¸²è¡Œï¼š50+50+50=150ms å¹¶è¡Œï¼š50+50 = 100ms ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ— å¹¶åœ¨å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—åç«‹å³è¿”å›æˆåŠŸç»™å®¢æˆ·ç«¯ï¼Œåˆ™æ€»çš„å“åº”æ—¶é—´ä¾èµ–äºå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´ï¼Œè€Œå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´æœ¬èº«æ˜¯å¯ä»¥å¾ˆå¿«çš„ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤æ€»çš„å¤„ç†æ—¶é—´ç›¸æ¯”ä¸²è¡Œæé«˜äº†2å€ï¼Œç›¸æ¯”å¹¶è¡Œæé«˜äº†ä¸€å€ï¼› åº”ç”¨è€¦åˆå…·ä½“åœºæ™¯ï¼šç”¨æˆ·ä½¿ç”¨QQç›¸å†Œä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œäººè„¸è¯†åˆ«ç³»ç»Ÿä¼šå¯¹è¯¥å›¾ç‰‡è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°å›¾ç‰‡åï¼Œå›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿç«‹å³è°ƒç”¨äººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œè°ƒç”¨å®Œæˆåå†è¿”å›æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š äººè„¸è¯†åˆ«ç³»ç»Ÿè¢«è°ƒå¤±è´¥ï¼Œå¯¼è‡´å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼› å»¶è¿Ÿé«˜ï¼Œéœ€è¦äººè„¸è¯†åˆ«ç³»ç»Ÿå¤„ç†å®Œæˆåï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå³ä½¿ç”¨æˆ·å¹¶ä¸éœ€è¦ç«‹å³çŸ¥é“ç»“æœï¼› å›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿä¸äººè„¸è¯†åˆ«ç³»ç»Ÿä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œéœ€è¦åšè€¦åˆï¼› è‹¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼š å®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡åï¼Œå›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿå°†å›¾ç‰‡ä¿¡æ¯å¦‚uinã€æ‰¹æ¬¡å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›´æ¥è¿”å›æˆåŠŸï¼›è€Œäººè„¸è¯†åˆ«ç³»ç»Ÿåˆ™å®šæ—¶ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œå®Œæˆå¯¹æ–°å¢å›¾ç‰‡çš„è¯†åˆ«ã€‚ æ­¤æ—¶å›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿå¹¶ä¸éœ€è¦å…³å¿ƒäººè„¸è¯†åˆ«ç³»ç»Ÿæ˜¯å¦å¯¹è¿™äº›å›¾ç‰‡ä¿¡æ¯çš„å¤„ç†ã€ä»¥åŠä½•æ—¶å¯¹è¿™äº›å›¾ç‰‡ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚äº‹å®ä¸Šï¼Œç”±äºç”¨æˆ·å¹¶ä¸éœ€è¦ç«‹å³çŸ¥é“äººè„¸è¯†åˆ«ç»“æœï¼Œäººè„¸è¯†åˆ«ç³»ç»Ÿå¯ä»¥é€‰æ‹©ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼ŒæŒ‰ç…§é—²æ—¶ã€å¿™æ—¶ã€æ­£å¸¸æ—¶é—´ï¼Œå¯¹é˜Ÿåˆ—ä¸­çš„å›¾ç‰‡ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚ é™æµå‰Šå³°å…·ä½“åœºæ™¯ï¼šè´­ç‰©ç½‘ç«™å¼€å±•ç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ç”±äºç¬æ—¶è®¿é—®é‡è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¿‡å¤§ï¼Œä¼šå¯¼è‡´æµé‡æš´å¢ï¼Œç›¸å…³ç³»ç»Ÿæ— æ³•å¤„ç†è¯·æ±‚ç”šè‡³å´©æºƒã€‚è€ŒåŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç³»ç»Ÿå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œç›¸å½“äºæ¶ˆæ¯é˜Ÿåˆ—åšäº†ä¸€æ¬¡ç¼“å†²ã€‚ è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š è¯·æ±‚å…ˆå…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç”±ä¸šåŠ¡å¤„ç†ç³»ç»Ÿç›´æ¥å¤„ç†ï¼Œåšäº†ä¸€æ¬¡ç¼“å†²,æå¤§åœ°å‡å°‘äº†ä¸šåŠ¡å¤„ç†ç³»ç»Ÿçš„å‹åŠ›ï¼› é˜Ÿåˆ—é•¿åº¦å¯ä»¥åšé™åˆ¶ï¼Œäº‹å®ä¸Šï¼Œç§’æ€æ—¶ï¼Œåå…¥é˜Ÿåˆ—çš„ç”¨æˆ·æ— æ³•ç§’æ€åˆ°å•†å“ï¼Œè¿™äº›è¯·æ±‚å¯ä»¥ç›´æ¥è¢«æŠ›å¼ƒï¼Œè¿”å›æ´»åŠ¨å·²ç»“æŸæˆ–å•†å“å·²å”®å®Œä¿¡æ¯ï¼› æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿå…·ä½“åœºæ™¯ï¼šç”¨æˆ·æ–°ä¸Šä¼ äº†ä¸€æ‰¹ç…§ç‰‡ï¼Œ äººè„¸è¯†åˆ«ç³»ç»Ÿéœ€è¦å¯¹è¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ç…§ç‰‡è¿›è¡Œèšç±»ï¼Œèšç±»å®Œæˆåç”±å¯¹è´¦ç³»ç»Ÿé‡æ–°ç”Ÿæˆç”¨æˆ·çš„äººè„¸ç´¢å¼•(åŠ å¿«æŸ¥è¯¢)ã€‚è¿™ä¸‰ä¸ªå­ç³»ç»Ÿé—´ç”±æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥ï¼Œå‰ä¸€ä¸ªé˜¶æ®µçš„å¤„ç†ç»“æœæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œåä¸€ä¸ªé˜¶æ®µä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ç»§ç»­å¤„ç†ã€‚ è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š é¿å…äº†ç›´æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªç³»ç»Ÿå¯¼è‡´å½“å‰ç³»ç»Ÿå¤±è´¥ï¼› æ¯ä¸ªå­ç³»ç»Ÿå¯¹äºæ¶ˆæ¯çš„å¤„ç†æ–¹å¼å¯ä»¥æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥é€‰æ‹©æ”¶åˆ°æ¶ˆæ¯æ—¶å°±å¤„ç†ï¼Œå¯ä»¥é€‰æ‹©å®šæ—¶å¤„ç†ï¼Œä¹Ÿå¯ä»¥åˆ’åˆ†æ—¶é—´æ®µæŒ‰ä¸åŒå¤„ç†é€Ÿåº¦å¤„ç†ï¼› æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼æ¶ˆæ¯é˜Ÿåˆ—åŒ…æ‹¬ä¸¤ç§æ¨¡å¼ï¼Œç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆpoint to pointï¼Œ queueï¼‰å’Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆpublish/subscribeï¼Œtopicï¼‰ã€‚ ç‚¹å¯¹ç‚¹æ¨¡å¼ æ¶ˆæ¯é˜Ÿåˆ— å‘é€è€… (ç”Ÿäº§è€…) æ¥æ”¶è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ æ¶ˆæ¯å‘é€è€…ç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°queueä¸­ï¼Œç„¶åæ¶ˆæ¯æ¥æ”¶è€…ä»queueä¸­å–å‡ºå¹¶ä¸”æ¶ˆè´¹æ¶ˆæ¯ã€‚æ¶ˆæ¯è¢«æ¶ˆè´¹ä»¥åï¼Œqueueä¸­ä¸å†æœ‰å­˜å‚¨ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¥æ”¶è€…ä¸å¯èƒ½æ¶ˆè´¹åˆ°å·²ç»è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚ ç‚¹å¯¹ç‚¹æ¨¡å¼ç‰¹ç‚¹ï¼š æ¯ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼ˆConsumerï¼‰(å³ä¸€æ—¦è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯å°±ä¸å†åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­)ï¼› å‘é€è€…å’Œæ¥æ”¶è€…é—´æ²¡æœ‰ä¾èµ–æ€§ï¼Œå‘é€è€…å‘é€æ¶ˆæ¯ä¹‹åï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ¥æ”¶è€…åœ¨è¿è¡Œï¼Œéƒ½ä¸ä¼šå½±å“åˆ°å‘é€è€…ä¸‹æ¬¡å‘é€æ¶ˆæ¯ï¼› æ¥æ”¶è€…åœ¨æˆåŠŸæ¥æ”¶æ¶ˆæ¯ä¹‹åéœ€å‘é˜Ÿåˆ—åº”ç­”æˆåŠŸï¼Œä»¥ä¾¿æ¶ˆæ¯é˜Ÿåˆ—åˆ é™¤å½“å‰æ¥æ”¶çš„æ¶ˆæ¯ï¼› å‘å¸ƒ/è®¢é˜…æ¨¡å¼å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä¸‹åŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š è§’è‰²ä¸»é¢˜ï¼ˆTopicï¼‰ å‘å¸ƒè€…(Publisher) è®¢é˜…è€…(Subscriber) å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°Topic,ç³»ç»Ÿå°†è¿™äº›æ¶ˆæ¯ä¼ é€’ç»™å¤šä¸ªè®¢é˜…è€…ã€‚ å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç‰¹ç‚¹ï¼š æ¯ä¸ªæ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªè®¢é˜…è€…ï¼› å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æœ‰æ—¶é—´ä¸Šçš„ä¾èµ–æ€§ã€‚é’ˆå¯¹æŸä¸ªä¸»é¢˜ï¼ˆTopicï¼‰çš„è®¢é˜…è€…ï¼Œå®ƒå¿…é¡»åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…ä¹‹åï¼Œæ‰èƒ½æ¶ˆè´¹å‘å¸ƒè€…çš„æ¶ˆæ¯ï¼› ä¸ºäº†æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¢é˜…è€…éœ€è¦æå‰è®¢é˜…è¯¥è§’è‰²ä¸»é¢˜ï¼Œå¹¶ä¿æŒåœ¨çº¿è¿è¡Œï¼› å¸¸ç”¨æ¶ˆæ¯é˜Ÿåˆ— RabbitMQ ActiveMQ RocketMQ Apache Kafka","tags":[{"name":"mq","slug":"mq","permalink":"https://gcdd1993.github.io/tags/mq/"},{"name":"æ¶ˆæ¯ä¸­é—´ä»¶","slug":"æ¶ˆæ¯ä¸­é—´ä»¶","permalink":"https://gcdd1993.github.io/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"Spring IoC Containeræºç åˆ†æï¼ˆäºŒï¼‰-beanåˆå§‹åŒ–æµç¨‹","date":"2019-03-29T02:11:12.000Z","path":"p/60483/","text":"å‡†å¤‡Personå®ä¾‹ 12345@Datapublic class Person &#123; private String name; private int age;&#125; xml beané…ç½® 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;bean id=&quot;person&quot; class=&quot;com.gcdd1993.spring.framework.base.domain.Person&quot;/&gt;&lt;/beans&gt; å…¥å£ 12AbstractApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;config.xml&quot;);applicationContext.getBean(&quot;person&quot;); ä½¿ç”¨Debugè¿›å…¥ClassPathXmlApplicationContextæ„é€ å‡½æ•°ï¼Œæºç å¦‚ä¸‹ 123456789public ClassPathXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent) throws BeansException &#123; super(parent); setConfigLocations(configLocations); if (refresh) &#123; refresh(); &#125;&#125; super(parent)ä¸€æ­¥æ­¥å‘ä¸Šè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œè·¯å¾„ä¸º ClassPathXmlApplicationContext -&gt; AbstractXmlApplicationContext -&gt; AbstractRefreshableConfigApplicationContext -&gt; AbstractRefreshableApplicationContext -&gt; AbstractApplicationContext å†ç»æ•´ä¸ªç»§æ‰¿ä½“ç³»ï¼Œæœ€ç»ˆåˆ°è¾¾AbstractApplicationContext: 1234public AbstractApplicationContext(ApplicationContext parent) &#123; this(); setParent(parent);&#125; æœ€åä¼šè®¾ç½®å½“å‰ApplicationContextçš„çˆ¶çº§ApplicationContext setConfigLocations(configLocations)è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œè§£æçš„ç»†èŠ‚å‚ç…§å®˜æ–¹æ–‡æ¡£Resourceä¸€èŠ‚ï¼Œä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ï¼Œåœ¨æ­¤ç•¥è¿‡ã€‚ 123456789101112public void setConfigLocations(String... locations) &#123; if (locations != null) &#123; Assert.noNullElements(locations, &quot;Config locations must not be null&quot;); this.configLocations = new String[locations.length]; for (int i = 0; i &lt; locations.length; i++) &#123; this.configLocations[i] = resolvePath(locations[i]).trim(); &#125; &#125; else &#123; this.configLocations = null; &#125;&#125; refresh()æ­¤æ–¹æ³•æ˜¯Springå®¹å™¨çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæºç (ç²¾ç®€äº†try catchéƒ¨åˆ†)å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637public void refresh() throws BeansException, IllegalStateException &#123; // Prepare this context for refreshing. prepareRefresh(); // Tell the subclass to refresh the internal bean factory. ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context. prepareBeanFactory(beanFactory); // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // Invoke factory processors registered as beans in the context. invokeBeanFactoryPostProcessors(beanFactory); // Register bean processors that intercept bean creation. registerBeanPostProcessors(beanFactory); // Initialize message source for this context. initMessageSource(); // Initialize event multicaster for this context. initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. onRefresh(); // Check for listener beans and register them. registerListeners(); // Instantiate all remaining (non-lazy-init) singletons. finishBeanFactoryInitialization(beanFactory); // Last step: publish corresponding event. finishRefresh();&#125; æ­¤å¤„å¯ä»¥çœ‹åˆ°Springç¼–ç æ–¹å¼è¿‘ä¼¼äºæµç¨‹å›¾çš„ï¼Œé‡ç‚¹éƒ¨åˆ†éƒ½æŠ½å‡ºä¸ºäº†å•ç‹¬çš„æ–¹æ³•ï¼Œæµç¨‹æ¸…æ™°ï¼Œæ˜“äºç†è§£ã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹ï¼š prepareRefresh() ä¸Šä¸‹æ–‡åˆ·æ–°å‰é¢„çƒ­ 1234567891011121314151617181920protected void prepareRefresh() &#123; this.startupDate = System.currentTimeMillis(); this.closed.set(false); this.active.set(true); if (logger.isInfoEnabled()) &#123; logger.info(&quot;Refreshing &quot; + this); &#125; // Initialize any placeholder property sources in the context environment initPropertySources(); // Validate that all properties marked as required are resolvable // see ConfigurablePropertyResolver#setRequiredProperties getEnvironment().validateRequiredProperties(); // Allow for the collection of early ApplicationEvents, // to be published once the multicaster is available... this.earlyApplicationEvents = new LinkedHashSet&lt;ApplicationEvent&gt;();&#125; è®¾ç½®ä¸Šä¸‹æ–‡åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚startupDate(å¯åŠ¨æ—¶åˆ»)ã€closed(æ˜¯å¦å…³é—­)ã€active(æ˜¯å¦å­˜æ´»)ç­‰ç­‰ã€‚ è§£æå ä½ç¬¦èµ„æºï¼Œå¹¶éªŒè¯æ ‡è®°ä¸ºrequiredçš„èµ„æºæ˜¯å¦å¯ç”¨ obtainFreshBeanFactory() åˆå§‹åŒ–beanFactory(beanå·¥å‚ï¼Œå®é™…å­˜æ”¾beançš„å°±æ˜¯å®ƒäº†) 12345678protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123; refreshBeanFactory(); ConfigurableListableBeanFactory beanFactory = getBeanFactory(); if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Bean factory for &quot; + getDisplayName() + &quot;: &quot; + beanFactory); &#125; return beanFactory;&#125; æ ¸å¿ƒæ–¹æ³•refreshBeanFactory() 123456789101112131415161718protected final void refreshBeanFactory() throws BeansException &#123; if (hasBeanFactory()) &#123; destroyBeans(); closeBeanFactory(); &#125; try &#123; DefaultListableBeanFactory beanFactory = createBeanFactory(); beanFactory.setSerializationId(getId()); customizeBeanFactory(beanFactory); loadBeanDefinitions(beanFactory); synchronized (this.beanFactoryMonitor) &#123; this.beanFactory = beanFactory; &#125; &#125; catch (IOException ex) &#123; throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + getDisplayName(), ex); &#125;&#125; createBeanFactory(); è®¾ç½®beanFactoryå±æ€§ loadBeanDefinitions(beanFactory); loadBeanDefinitions(beanFactory) è§£æbeanå®šä¹‰ï¼Œæœ‰å‡ ä¸ªbeanå°±æœ‰å‡ ä¸ªBeanDefinitionã€‚æ³¨æ„ï¼ŒSpringå¹¶ä¸æ˜¯æ‹¿åˆ°é…ç½®å°±ç›´æ¥ç”¨åå°„å®ä¾‹åŒ–beanï¼Œè€Œæ˜¯å…ˆå°†beané…ç½®è§£æä¸ºBeanDefinitionã€‚ BeanDefinitionä¿å­˜äº†å®ä¾‹åŒ–beanéœ€è¦çš„ä¸€åˆ‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å±æ€§ï¼Œä¾èµ–ç­‰ã€‚ä»¥ConcurrentHashMap&lt;String, BeanDefinition&gt;ä¿å­˜åœ¨DefaultListableBeanFactoryçš„beanDefinitionMapé‡Œã€‚ prepareBeanFactory(beanFactory) è®¾ç½®beanFactoryçš„å…¶ä½™å±æ€§ postProcessBeanFactory(beanFactory) ç©ºå®ç°ï¼Œç»™å­ç±»ä¸€ä¸ªæœºä¼šï¼Œè‡ªå®šä¹‰beanFactoryåç½®å¤„ç†å™¨ BeanFactoryPostProcessorå®šä¹‰ï¼š 12345public interface BeanFactoryPostProcessor &#123; void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;&#125; invokeBeanFactoryPostProcessors(beanFactory) æ‰§è¡Œä¸Šä¸€æ­¥ä¸­çš„beanFactoryåç½®å¤„ç†å™¨çš„å›è°ƒæ–¹æ³•void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) registerBeanPostProcessors(beanFactory) æ³¨å†Œbeanåç½®å¤„ç†å™¨ï¼Œå®ç°beanåˆå§‹åŒ–å‰åçš„è‡ªå®šä¹‰é€»è¾‘ BeanPostProcessorå®šä¹‰ï¼š 123456public interface BeanPostProcessor &#123; // åœ¨beanå®ä¾‹åŒ–å‰è°ƒç”¨ Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; // åœ¨beanå®ä¾‹åŒ–åè°ƒç”¨ Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;&#125; initMessageSource() æ³¨å†Œå›½é™…åŒ–ç›¸å…³bean initApplicationEventMulticaster() åˆå§‹åŒ–Springäº‹ä»¶å‘å¸ƒç›¸å…³bean onRefresh() ç©ºå®ç°ï¼Œç»™å­ç±»ä¸€ä¸ªæœºä¼šï¼Œåˆå§‹åŒ–ç‰¹æ®Šbean registerListeners() æ³¨å†Œç›‘å¬å™¨ finishBeanFactoryInitialization(beanFactory) å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„bean ç›´åˆ°è¿™é‡Œï¼Œæ‰å¼€å§‹çœŸæ­£å®ä¾‹åŒ–bean 123456789101112131415161718192021222324252627282930313233protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) &#123; // 1. å®ä¾‹åŒ–beançš„ç±»å‹è½¬æ¢å™¨ if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123; beanFactory.setConversionService( beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)); &#125; // 2. å®ä¾‹åŒ–å±æ€§å ä½ç¬¦è§£æå™¨ if (!beanFactory.hasEmbeddedValueResolver()) &#123; beanFactory.addEmbeddedValueResolver(new StringValueResolver() &#123; @Override public String resolveStringValue(String strVal) &#123; return getEnvironment().resolvePlaceholders(strVal); &#125; &#125;); &#125; // 3. å®ä¾‹åŒ–LoadTimeWeaverAware String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false); for (String weaverAwareName : weaverAwareNames) &#123; getBean(weaverAwareName); &#125; // 4. åœæ­¢ä½¿ç”¨ä¸´æ—¶ClassLoaderè¿›è¡Œç±»å‹åŒ¹é… beanFactory.setTempClassLoader(null); // 5. ç¦æ­¢å†ä¿®æ”¹beanå®šä¹‰ beanFactory.freezeConfiguration(); // 6. å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½å•ä¾‹bean beanFactory.preInstantiateSingletons();&#125; preInstantiateSingletons() æ ¹æ®æ¯ä¸€ä¸ªbeanå®šä¹‰ï¼Œå®ä¾‹åŒ–bean ä¸ºæ¯ä¸€ä¸ªå®ç°SmartInitializingSingletonçš„beanæ‰§è¡Œå›è°ƒæ–¹æ³• å®ä¾‹åŒ–beanéƒ¨åˆ†çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132for (String beanName : beanNames) &#123; // è·å–beanå®šä¹‰ RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); // åªæœ‰ä¸æ˜¯abstractã€å•ä¾‹ä¸”ä¸æ˜¯æ‡’åŠ è½½çš„beanæ‰åœ¨è¿™é‡Œå®ä¾‹åŒ– if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; // å¦‚æœæ˜¯FactoryBean if (isFactoryBean(beanName)) &#123; // å…ˆå®ä¾‹åŒ–å®ä¾‹å¯¹åº”çš„FactoryBean final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) getBean(FACTORY_BEAN_PREFIX + beanName); boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) &#123; isEagerInit = AccessController.doPrivileged(new PrivilegedAction&lt;Boolean&gt;() &#123; @Override public Boolean run() &#123; return ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit(); &#125; &#125;, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; if (isEagerInit) &#123; // ä½¿ç”¨FactoryBeançš„getObject()æ–¹æ³•è¿”å›çœŸæ­£çš„å®ä¾‹ getBean(beanName); &#125; &#125; else &#123; getBean(beanName); &#125; &#125;&#125; getBean(String name)è¯¥æ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ªdoGetBeanï¼ŒdoGetBeanä»£ç è¾ƒé•¿ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†ä»£ç æ˜¯ä¸ºäº†è§£å†³å¹¶å‘åœºæ™¯ä¸‹å•ä¾‹çš„ç”Ÿæˆï¼Œæˆ‘ä»¬æŒ‘å‡ºé‡ç‚¹çš„çœ‹ï¼š ä»çˆ¶BeanFactoryæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥beançš„å®šä¹‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œå§”æ‰˜çˆ¶BeanFactoryæ¥å®ä¾‹åŒ– 12345678910111213BeanFactory parentBeanFactory = getParentBeanFactory();if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) &#123; // Not found -&gt; check parent. String nameToLookup = originalBeanName(name); if (args != null) &#123; // Delegation to parent with explicit args. return (T) parentBeanFactory.getBean(nameToLookup, args); &#125; else &#123; // No args -&gt; delegate to standard getBean method. return parentBeanFactory.getBean(nameToLookup, requiredType); &#125;&#125; è·å¾—beanå®šä¹‰ï¼Œå¦‚æœå­˜åœ¨ä¾èµ–ï¼Œå…ˆå®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–beanï¼Œæ³¨æ„ï¼šä¸å…è®¸å¾ªç¯ä¾èµ– 12345678910111213141516171819202122232425final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);checkMergedBeanDefinition(mbd, beanName, args);// Guarantee initialization of beans that the current bean depends on.String[] dependsOn = mbd.getDependsOn();//å¦‚æœå­˜åœ¨ä¾èµ–ï¼Œå…ˆå®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–beanif (dependsOn != null) &#123; // å®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–bean for (String dep : dependsOn) &#123; // æ£€æŸ¥å¾ªç¯ä¾èµ– if (isDependent(beanName, dep)) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;Circular depends-on relationship between &#x27;&quot; + beanName + &quot;&#x27; and &#x27;&quot; + dep + &quot;&#x27;&quot;); &#125; // å®ä¾‹åŒ–ä¾èµ–bean registerDependentBean(dep, beanName); try &#123; getBean(dep); &#125; catch (NoSuchBeanDefinitionException ex) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;&#x27;&quot; + beanName + &quot;&#x27; depends on missing bean &#x27;&quot; + dep + &quot;&#x27;&quot;, ex); &#125; &#125;&#125; å®ä¾‹åŒ–bean æ–¹æ³•è°ƒç”¨æµç¨‹ï¼š createBean &gt; doCreateBean &gt; populateBean å…¶ä¸­doCreateBeanï¼š ä»BeanDefinitionç”ŸæˆBeanWrapper å°†BeanWrapperå’ŒBeanDefinition.getPropertyValues() ä¼ ç»™populateBeanï¼Œå®ä¾‹åŒ–bean finishRefresh()12345678910111213protected void finishRefresh() &#123; // åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ initLifecycleProcessor(); // åˆ·æ–°ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨çŠ¶æ€ running = true getLifecycleProcessor().onRefresh(); // å‘å¸ƒä¸Šä¸‹æ–‡åˆå§‹åŒ–å®Œæˆäº‹ä»¶ContextRefreshedEvent publishEvent(new ContextRefreshedEvent(this)); // å¦‚æœå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ°LiveBeans LiveBeansView.registerApplicationContext(this);&#125; æ€»ç»“Spring IoC Containeræ—¶åºå›¾","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"FastDFS å•æœºéƒ¨ç½²æŒ‡å—","date":"2019-03-22T07:39:17.000Z","path":"p/56864/","text":"ç®€ä»‹FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®˜æ–¹ä»‹ç»æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œä¸å¤šèµ˜è¿°ã€‚æœ¬æ–‡ä¸»è¦æ˜¯FastDFSçš„æ­å»ºåŠé‡‡å‘æŒ‡å—ã€‚ Step By Step Guideç³»ç»Ÿ é˜¿é‡Œäº‘ECS Ubuntu 16.04 ç¼–è¯‘ç¯å¢ƒæŒ‰éœ€å®‰è£…ï¼Œè¿™é‡Œæ˜¯é’ˆå¯¹æ–°çš„ubuntuç³»ç»Ÿ 1$ apt-get install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim ç£ç›˜ç›®å½• è¯´æ˜ ä½ç½® æ‰€æœ‰å®‰è£…åŒ… /usr/local/src æ•°æ®å­˜å‚¨ä½ç½® /data/dfs/ 12$ mkdir /data/dfs #åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•ï¼ˆå¯¹äºé˜¿é‡Œäº‘ECSï¼Œæœ€å¥½å»ºç«‹åœ¨æ•°æ®ç›˜ä¸Šï¼Œæ˜¯ç”¨æ¥å­˜æ”¾æ–‡ä»¶çš„ï¼‰$ cd /usr/local/src #åˆ‡æ¢åˆ°å®‰è£…ç›®å½•å‡†å¤‡ä¸‹è½½å®‰è£…åŒ… å®‰è£…libfatscommon1234$ wget https://github.com/happyfish100/libfastcommon/archive/master.zip$ unzip master.zip$ cd libfastcommon-1.0.39/$ ./make.sh &amp;&amp; ./make.sh install #ç¼–è¯‘å®‰è£… å®‰è£…FastDFS1234567891011$ cd ../ #è¿”å›ä¸Šä¸€çº§ç›®å½•$ wget https://github.com/happyfish100/fastdfs/archive/master.zip$ unzip master.zip$ cd fastdfs-master/$ ./make.sh &amp;&amp; ./make.sh install #ç¼–è¯‘å®‰è£…#é…ç½®æ–‡ä»¶å‡†å¤‡$ cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf$ cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf$ cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œæµ‹è¯•ç”¨$ cp /usr/local/src/fastdfs-master/conf/http.conf /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨$ cp /etc/nginx/mime.types /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨ å®‰è£…fastdfs-nginx-moduleå®˜ç½‘çš„æ–‡æ¡£ï¼Œæ˜¯é’ˆå¯¹æ²¡æœ‰å®‰è£…è¿‡Nginxçš„æœºå™¨ï¼Œé‡æ–°ç¼–è¯‘äº†ä¸€éNginxï¼ŒæŠŠmoduleç›´æ¥ç¼–è¯‘è¿›Nginxäº†ã€‚ä½†æ˜¯é’ˆå¯¹å·²ç»å®‰è£…Nginxçš„æœåŠ¡å™¨æ¥è¯´ï¼Œæ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚ æ ¹æ®Nginxå®˜æ–¹æ–‡æ¡£-ç¼–è¯‘ç¬¬ä¸‰æ–¹åŠ¨æ€æ¨¡å—ï¼Œç¼–è¯‘äº†fastdfs-nginx-moduleï¼Œä»¥ä¾›å·²å­˜åœ¨çš„Nginxä½¿ç”¨ã€‚ æˆ‘å·²ç»ç¼–è¯‘å¥½äº†fastdfs-nginx-moduleï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œå¹¶è·³åˆ°åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—ï¼Œå¦‚æœæƒ³çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œå¯ä»¥å¾€ä¸‹çœ‹ã€‚ å‡†å¤‡fastdfs-nginx-moduleæºç åŒ…123$ cd ../ #è¿”å›ä¸Šä¸€çº§ç›®å½•$ wget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zip$ unzip master.zip è·å–å¯¹åº”ç‰ˆæœ¬çš„Nginxæºç åŒ…1234$ nginx -v # ç¡®è®¤æœåŠ¡å™¨çš„Nginxç‰ˆæœ¬nginx version: nginx/1.14.2$ wget http://nginx.org/download/nginx-1.14.2.tar.gz$ tar -xzvf nginx-1.14.2.tar.gz ç¼–è¯‘åŠ¨æ€æ¨¡å—123$ cd nginx-1.14.2/$ ./configure --with-compat --add-dynamic-module=/usr/local/src/fastdfs-nginx-module-master/src$ make modules å°†æ¨¡å—åº“ï¼ˆ.soæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°/etc/nginx/modules1$ cp ngx_http_fastdfs_module.so /etc/nginx/modules/ åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—Tips: è¦å°†æ¨¡å—åŠ è½½åˆ°Nginx,åœ¨nginx.confæ–‡ä»¶å¼€å¤´æ·»åŠ load_moduleå‘½ä»¤ 1234$ vim /etc/nginx/nginx.conf# æ·»åŠ å¦‚ä¸‹å‘½ä»¤load_module modules/ngx_http_fastdfs_module.so;# ä¿å­˜é€€å‡º æ·»åŠ FastDFSé…ç½®ä½¿æ¨¡å—ç”Ÿæ•ˆ12345678910111213$ vim /etc/nginx/conf.d/fastdfs.conf# æ·»åŠ å¦‚ä¸‹é…ç½®server &#123; listen 8888; ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çš„http.server_portç›¸åŒ server_name &#123;your_domain&#125;; location ~/group[0-9]/ &#123; ngx_fastdfs_module; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125;&#125; å•æœºéƒ¨ç½²è¿™é‡Œåªæè¿°ä¸‹å•æœºç¯å¢ƒçš„éƒ¨ç½²æ–¹å¼ï¼Œé›†ç¾¤åœ¨å®˜æ–¹æ–‡æ¡£æœ‰ï¼Œæ²¡æœ‰å®é™…ä½¿ç”¨è¿‡ã€‚ trackeré…ç½®123456$ vim /etc/fdfs/tracker.conf# å»ºè®®ä¿®æ”¹ä»¥ä¸‹å†…å®¹bind_addr=&#123;ä½ çš„å†…ç½‘IP&#125;base_path=/data/dfs # å»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®# å¯é€‰ä¿®æ”¹port=22122 # trackeræœåŠ¡å™¨ç«¯å£ storageé…ç½®12345678$ vim /etc/fdfs/storage.conf# å»ºè®®ä¿®æ”¹base_path=/data/dfs # æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•ï¼ˆå»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®ï¼‰store_path0=/data/dfs # ç¬¬ä¸€ä¸ªå­˜å‚¨ç›®å½•ï¼ˆå»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®ï¼‰tracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125; # trackeræœåŠ¡å™¨IPå’Œç«¯å£http.server_port=8888 # httpè®¿é—®æ–‡ä»¶çš„ç«¯å£ï¼ˆé»˜è®¤8888,çœ‹æƒ…å†µä¿®æ”¹,å’Œnginxä¸­ä¿æŒä¸€è‡´ï¼‰# å¯é€‰ä¿®æ”¹port=23000 # storageæœåŠ¡ç«¯å£ï¼ˆé»˜è®¤23000,ä¸€èˆ¬ä¸ä¿®æ”¹ï¼‰ clientæµ‹è¯•12345678$ vim /etc/fdfs/client.conf# å»ºè®®ä¿®æ”¹base_path=/data/dfstracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125; # trackeræœåŠ¡å™¨IPå’Œç«¯å£# ä¿å­˜åæµ‹è¯•$ fdfs_upload_file /etc/fdfs/client.conf /usr/local/src/nginx-1.14.2.tar.gzgroup1/M00/00/00/CgoKvlyUmi-AMVKDAA9-WL9wzEw.tar.gz # ä¸‹è½½æ—¶é€šè¿‡è¯¥IDä¸‹è½½# è¿”å›IDè¡¨ç¤ºæˆåŠŸ å¦‚ï¼šgroup1/M00/00/00/xx.tar.gz é…ç½®nginxè®¿é—®12345678910vim /etc/fdfs/mod_fastdfs.conf# å»ºè®®ä¿®æ”¹tracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125; # trackeræœåŠ¡å™¨IPå’Œç«¯å£url_have_group_name=truestore_path0=/data/dfs# ä¿®æ”¹å®Œä¿å­˜$ nginx -s reloadngx_http_fastdfs_set pid=8364 # çœ‹è§è¿™æ¡æ¶ˆæ¯è¯´æ˜nginxæ¨¡å—å¯åŠ¨æˆåŠŸäº†$ lsof -i:8888 # æŸ¥çœ‹Nginxä¸‹è½½ç«¯å£æ˜¯å¦æ­£å¸¸å¯åŠ¨nginx 31061 root 10u IPv4 20389985 0t0 TCP *:8888 (LISTEN) æµ‹è¯•ä¸‹è½½åœ¨æµè§ˆå™¨è¾“å…¥ 1http://&#123;IP&#125;:8888/group1/M00/00/00/CgoKvlyUmi-AMVKDAA9-WL9wzEw.tar.gz?filename=nginx-1.14.2.tar.gz //åˆšæ‰ä¸Šä¼ è¿”å›çš„ID å¼¹å‡ºä¸‹è½½æ–‡ä»¶æ¡†ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼ ç›¸å…³å‘½ä»¤é˜²ç«å¢™1$ sudo ufw enable|disable tracker1234$ /etc/init.d/fdfs_trackerd start # å¯åŠ¨trackeræœåŠ¡$ /etc/init.d/fdfs_trackerd restart # é‡å¯åŠ¨trackeræœåŠ¡$ /etc/init.d/fdfs_trackerd stop # åœæ­¢trackeræœåŠ¡$ update-rc.d fdfs_trackerd enable # è‡ªå¯åŠ¨trackeræœåŠ¡ storage1234$ /etc/init.d/fdfs_storaged start # å¯åŠ¨storageæœåŠ¡$ /etc/init.d/fdfs_storaged restart # é‡åŠ¨storageæœåŠ¡$ /etc/init.d/fdfs_storaged stop # åœæ­¢åŠ¨storageæœåŠ¡$ update-rc.d fdfs_storaged enable # è‡ªå¯åŠ¨storageæœåŠ¡ nginx123$ service nginx start # å¯åŠ¨nginx$ nginx -s reload # é‡å¯nginx$ nginx -s stop # åœæ­¢nginx é—®é¢˜æ‰§è¡Œnginx -s reload åï¼Œè®¿é—®50212# æŸ¥çœ‹nginxæ—¥å¿—$ vim /var/log/nginx/error.log å¦‚æœå‘ç°é”™è¯¯æ—¥å¿—ï¼šinclude file &quot;http.conf&quot; not exists, line: &quot;#include http.conf&quot;ï¼Œfastdfs nginxæ¨¡å—ç¼ºå°‘é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¡¥å…¨é…ç½®æ–‡ä»¶å³å¯ã€‚ 12$ cp /usr/local/src/fastdfs-master/conf/http.conf /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨$ cp /etc/nginx/mime.types /etc/fdfs/ #ä¾›nginxè®¿é—®ä½¿ç”¨","tags":[{"name":"FastDFS","slug":"FastDFS","permalink":"https://gcdd1993.github.io/tags/FastDFS/"}]},{"title":"Spring-Framework-å®˜æ–¹æ–‡æ¡£é˜…è¯»ï¼ˆä¸€ï¼‰Spring IoC Container","date":"2019-03-20T10:53:06.000Z","path":"p/433/","text":"å‰è¨€é€šè¯»Spring IoCå®¹å™¨å®˜æ–¹æ–‡æ¡£ï¼Œå¯¹IoCå®¹å™¨æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚ ç¯å¢ƒ JDK1.8 Spring Framework Version ï¼š4.3.18.RELEASE å®¹å™¨æ¦‚è¿° æ¥å£org.springframework.context.ApplicationContextä»£è¡¨Spring IoCå®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…beanã€‚åœ¨ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªClassPathXmlApplicationContextæˆ–è€… FileSystemXmlApplicationContextçš„å®ä¾‹ã€‚ Springå·¥ä½œåŸç†çš„é«˜çº§è§†å›¾ 1.é…ç½®å…ƒæ•°æ®åˆ›å»ºSimpleBean 12345public class SimpleBean &#123; public void send() &#123; System.out.println(&quot;Hello Spring Bean!&quot;); &#125;&#125; config.xml 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;bean id=&quot;simple&quot; class=&quot;base.SimpleBeanFactoryBean&quot;/&gt;&lt;/beans&gt; 2.å®ä¾‹åŒ–å®¹å™¨ 1ApplicationContext context = new ClassPathXmlApplicationContext(&quot;config.xml&quot;); 3.ä½¿ç”¨å®¹å™¨ 1234// æ£€ç´¢Springå®¹å™¨ä¸­çš„beanSimpleBean simpleBean = context.getBean(SimpleBean.class);// ä½¿ç”¨beansimpleBean.send(); è¿˜æœ‰æ›´çµæ´»çš„æ–¹å¼æ¥ä»é…ç½®æ–‡ä»¶è·å–beanï¼Œä½¿ç”¨GenericApplicationContextä¸BeanDefinitionReaderç»“åˆï¼Œç›´æ¥è¯»å–beanå®šä¹‰ 12345GenericApplicationContext context = new GenericApplicationContext();new XmlBeanDefinitionReader(context).loadBeanDefinitions(&quot;config.xml&quot;);context.refresh();SimpleBean simpleBean = (SimpleBean) context.getBean(&quot;simple&quot;);simpleBean.send(); Beanæ¦‚è¿° Spring IoCå®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚è¿™äº›beanæ˜¯ä½¿ç”¨æ‚¨æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼Œä¾‹å¦‚ï¼Œä»¥XML &lt;bean/&gt;å®šä¹‰çš„å½¢å¼ ã€‚ åœ¨å®¹å™¨æœ¬èº«å†…ï¼Œè¿™äº›beanå®šä¹‰è¡¨ç¤ºä¸ºBeanDefinitionå¯¹è±¡ã€‚ é™¤äº†åˆ›å»ºé…ç½®å¥½çš„beanä¹‹å¤–ï¼ŒApplicationContextè¿˜å…è®¸ç”¨æˆ·æ³¨å†Œåœ¨å®¹å™¨å¤–éƒ¨åˆ›å»ºçš„ç°æœ‰å¯¹è±¡ã€‚é€šè¿‡getBeanFactory()è·å¾—DefaultListableBeanFactoryï¼Œç„¶åä½¿ç”¨registerSingleton()æˆ–è€…registerBeanDefinition()æ¥æ³¨å†Œbeanã€‚ 123456789DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;config.xml&quot;);User user = new User();user.setId(1L);user.setName(&quot;xiaoming&quot;);beanFactory.registerSingleton(&quot;user&quot;, user);User bean = (User) applicationContext.getBean(&quot;user&quot;);System.out.println(bean); æˆ–è€…æ˜¯ä»¥ä¸‹åšæ³•ï¼š 12345678910ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;config.xml&quot;);DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory) applicationContext.getBeanFactory();BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(User.class);builder.addPropertyValue(&quot;id&quot;, 1);builder.addPropertyValue(&quot;name&quot;, &quot;xiaoming&quot;);AbstractBeanDefinition beanDefinition = builder.getBeanDefinition();beanFactory.registerBeanDefinition(&quot;user&quot;, beanDefinition);User bean = (User) applicationContext.getBean(&quot;user&quot;);System.out.println(bean); å‘½åbeanæ¯ä¸ªbeanéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ã€‚è¿™äº›æ ‡è¯†ç¬¦åœ¨æ‰˜ç®¡beançš„å®¹å™¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚beané€šå¸¸åªæœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä½†å¦‚æœå®ƒéœ€è¦å¤šä¸ªæ ‡è¯†ç¬¦ï¼Œåˆ™é¢å¤–çš„æ ‡è¯†ç¬¦å¯ä»¥è¢«è§†ä¸ºåˆ«åã€‚ åœ¨åŸºäºXMLçš„é…ç½®å…ƒæ•°æ®ä¸­ï¼Œä½¿ç”¨idå’Œ/æˆ–nameå±æ€§æŒ‡å®šbeanæ ‡è¯†ç¬¦ã€‚ å®ä¾‹åŒ–bean1.æ„é€ å‡½æ•°å®ä¾‹åŒ– 12&lt;bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;/&gt;&lt;bean name=&quot;anotherExample&quot; class=&quot;examples.ExampleBeanTwo&quot;/&gt; 2.é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ– 123&lt;bean id=&quot;clientService&quot; class=&quot;examples.ClientService&quot; factory-method=&quot;createInstance&quot;/&gt; 12345678public class ClientService &#123; private static ClientService clientService = new ClientService(); private ClientService() &#123;&#125; public static ClientService createInstance() &#123; return clientService; &#125;&#125; 3.å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ– 123456789&lt;!-- the factory bean, which contains a method called createInstance() --&gt;&lt;bean id=&quot;serviceLocator&quot; class=&quot;examples.DefaultServiceLocator&quot;&gt; &lt;!-- inject any dependencies required by this locator bean --&gt;&lt;/bean&gt;&lt;!-- the bean to be created via the factory bean --&gt;&lt;bean id=&quot;clientService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createClientServiceInstance&quot;/&gt; 12345678public class DefaultServiceLocator &#123; private static ClientService clientService = new ClientServiceImpl(); public ClientService createClientServiceInstance() &#123; return clientService; &#125;&#125; ä¸€ä¸ªå·¥å‚ç±»ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå·¥å‚æ–¹æ³•: 1234567891011&lt;bean id=&quot;serviceLocator&quot; class=&quot;examples.DefaultServiceLocator&quot;&gt; &lt;!-- inject any dependencies required by this locator bean --&gt;&lt;/bean&gt;&lt;bean id=&quot;clientService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createClientServiceInstance&quot;/&gt;&lt;bean id=&quot;accountService&quot; factory-bean=&quot;serviceLocator&quot; factory-method=&quot;createAccountServiceInstance&quot;/&gt; 1234567891011121314public class DefaultServiceLocator &#123; private static ClientService clientService = new ClientServiceImpl(); private static AccountService accountService = new AccountServiceImpl(); public ClientService createClientServiceInstance() &#123; return clientService; &#125; public AccountService createAccountServiceInstance() &#123; return accountService; &#125;&#125; ä¾èµ–æ³¨å…¥æ„é€ å™¨æ³¨å…¥ åŸºäºæ„é€ å‡½æ•°çš„ DIç”±å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚ 123456789101112public class SimpleMovieLister &#123; // SimpleMovieListerä¾èµ–äºMovieFinder private MovieFinder movieFinder; // ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»¥ä¾¿Springå®¹å™¨å¯ä»¥æ³¨å…¥ä¸€ä¸ªMovieFinder public SimpleMovieLister(MovieFinder movieFinder) &#123; this.movieFinder = movieFinder; &#125; // business logic that actually uses the injected MovieFinder is omitted...&#125; æ„é€ å‡½æ•°å‚æ•°è§£æ 12345678package x.y;public class Foo &#123; public Foo(Bar bar, Baz baz) &#123; // ... &#125;&#125; 12345678910&lt;beans&gt; &lt;bean id=&quot;foo&quot; class=&quot;x.y.Foo&quot;&gt; &lt;constructor-arg ref=&quot;bar&quot;/&gt; &lt;constructor-arg ref=&quot;baz&quot;/&gt; &lt;/bean&gt; &lt;bean id=&quot;bar&quot; class=&quot;x.y.Bar&quot;/&gt; &lt;bean id=&quot;baz&quot; class=&quot;x.y.Baz&quot;/&gt;&lt;/beans&gt; æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç±»å‹ï¼š 1234&lt;bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;&gt; &lt;constructor-arg type=&quot;int&quot; value=&quot;7500000&quot;/&gt; &lt;constructor-arg type=&quot;java.lang.String&quot; value=&quot;42&quot;/&gt;&lt;/bean&gt; ä½¿ç”¨indexå±æ€§æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç´¢å¼•ï¼š 1234&lt;bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;&gt; &lt;constructor-arg index=&quot;0&quot; value=&quot;7500000&quot;/&gt; &lt;constructor-arg index=&quot;1&quot; value=&quot;42&quot;/&gt;&lt;/bean&gt; æˆ–è€…æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°åç§°ï¼š 1234&lt;bean id=&quot;exampleBean&quot; class=&quot;examples.ExampleBean&quot;&gt; &lt;constructor-arg name=&quot;years&quot; value=&quot;7500000&quot;/&gt; &lt;constructor-arg name=&quot;ultimateAnswer&quot; value=&quot;42&quot;/&gt;&lt;/bean&gt; setteræ³¨å…¥ åŸºäºsetterçš„ DIæ˜¯åœ¨è°ƒç”¨æ— å‚æ•°æ„é€ å‡½æ•°æˆ–æ— å‚æ•°staticå·¥å‚æ–¹æ³•æ¥å®ä¾‹åŒ–beanä¹‹åï¼Œé€šè¿‡å®¹å™¨è°ƒç”¨beanä¸Šçš„setteræ–¹æ³•æ¥å®Œæˆçš„ã€‚ 123456789101112public class SimpleMovieLister &#123; // SimpleMovieListerä¾èµ–äºMovieFinder private MovieFinder movieFinder; // ä¸€ä¸ªsetteræ–¹æ³•ï¼Œä»¥ä¾¿Springå®¹å™¨å¯ä»¥æ³¨å…¥ä¸€ä¸ªMovieFinder public void setMovieFinder(MovieFinder movieFinder) &#123; this.movieFinder = movieFinder; &#125; // business logic that actually uses the injected MovieFinder is omitted...&#125; å°ç»“ApplicationContextçš„ä¾èµ–æ³¨å…¥æ”¯æŒæ„é€ å™¨æ³¨å…¥å’Œsetteræ³¨å…¥ä¸¤ç§æ–¹å¼ã€‚åœ¨é€šè¿‡æ„é€ å‡½æ•°æ–¹æ³•æ³¨å…¥äº†ä¸€äº›ä¾èµ–é¡¹ä¹‹åï¼Œå®ƒè¿˜æ”¯æŒåŸºäºsetterçš„ä¾èµ–æ³¨å…¥ã€‚å¯ä»¥ç”¨BeanDefinitionä¸PropertyEditorå®ä¾‹ç»“åˆä½¿ç”¨çš„æ–¹å¼æ¥é…ç½®ä¾èµ–é¡¹ã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨BeanDefinitionä¸PropertyEditorï¼Œè€Œæ˜¯ç”¨XML å®šä¹‰beanæˆ–è€…æ˜¯æ³¨è§£æ–¹å¼ï¼ˆ@Componentï¼Œ @Controllerç­‰ç­‰ï¼‰ï¼Œæˆ–è€…æ˜¯ç›´æ¥ç¼–å†™@Configurationç±»ã€‚ç„¶åï¼Œè¿™äº›ç±»åœ¨å†…éƒ¨è½¬æ¢ä¸ºå®ä¾‹BeanDefinitionå¹¶ç”¨äºåŠ è½½æ•´ä¸ªSpring IoCå®¹å™¨å®ä¾‹ã€‚ è§£å†³å¾ªç¯ä¾èµ–å¦‚æœä¸»è¦ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œåˆ™å¯èƒ½å‡ºç°æ— æ³•è§£æçš„å¾ªç¯ä¾èµ–å…³ç³»åœºæ™¯ã€‚ä¾‹å¦‚ï¼šç±»Aé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥éœ€è¦ç±»Bçš„å®ä¾‹ï¼Œè€Œç±»Bé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ç±»Açš„å®ä¾‹ã€‚å¦‚æœå°†Aç±»å’ŒBç±»çš„beané…ç½®ä¸ºç›¸äº’æ³¨å…¥ï¼Œåˆ™Spring IoCå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°æ­¤å¾ªç¯å¼•ç”¨ï¼Œå¹¶æŠ›å‡ºBeanCurrentlyInCreationExceptionå¼‚å¸¸ã€‚ä¸€ç§å¯è¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ä»…ä½¿ç”¨setteræ³¨å…¥ã€‚ä¸å…¸å‹æƒ…å†µï¼ˆæ²¡æœ‰å¾ªç¯ä¾èµ–ï¼‰ä¸åŒï¼Œbean Aå’Œbean Bä¹‹é—´çš„å¾ªç¯ä¾èµ–å¼ºåˆ¶å…¶ä¸­ä¸€ä¸ªbeanåœ¨å®Œå…¨åˆå§‹åŒ–ä¹‹å‰è¢«æ³¨å…¥å¦ä¸€ä¸ªbeanï¼ˆä¸€ä¸ªç»å…¸çš„é¸¡/è›‹åœºæ™¯ï¼‰ã€‚ ä½¿ç”¨ depends-ondepends-onå¯ä»¥åœ¨åˆå§‹åŒ–beanä¹‹å‰ï¼Œæ˜¾å¼åœ°å¼ºåˆ¶åˆå§‹åŒ–ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚ä¸‹é¢çš„ä¾‹å­ï¼Œåœ¨åˆå§‹åŒ–beanOneä¹‹å‰ï¼Œå°†å¼ºåˆ¶åˆå§‹åŒ–manager 12&lt;bean id=&quot;beanOne&quot; class=&quot;ExampleBean&quot; depends-on=&quot;manager&quot;/&gt;&lt;bean id=&quot;manager&quot; class=&quot;ManagerBean&quot; /&gt; æ‡’åŠ è½½çš„beané»˜è®¤æƒ…å†µä¸‹ï¼ŒApplicationContextä¼šç«‹å³é…ç½®å¹¶åˆå§‹åŒ–æ‰€æœ‰å•ä¾‹beanï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨lazy-init=&quot;true&quot;å°†å…¶è®¾ç½®ä¸ºæŒ‰éœ€åŠ è½½ã€‚ 12&lt;bean id=&quot;lazy&quot; class=&quot;com.foo.ExpensiveToCreateBean&quot; lazy-init=&quot;true&quot;/&gt;&lt;bean name=&quot;not.lazy&quot; class=&quot;com.foo.AnotherBean&quot;/&gt; æ³¨æ„ï¼šæ‡’åŠ è½½ä¸è¦ä½¿ç”¨åœ¨æ•°æ®åº“è¿æ¥æ± ä¸Šï¼Œå› ä¸ºæ— æ³•ç«‹å³è·çŸ¥æ•°æ®åº“è¿æ¥çŠ¶æ€ï¼Œå°†å¯¼è‡´è¿è¡Œæ—¶åˆ›å»ºè¿æ¥æ± å¤±è´¥ï¼Œä¸å¯é¢„çŸ¥çš„åæœã€‚ è‡ªåŠ¨è£…é…åä½œè€…Springå®¹å™¨å¯ä»¥è‡ªåŠ¨è¿æ¥åä½œbeanä¹‹é—´çš„å…³ç³»ã€‚æ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥ApplicationContextçš„å†…å®¹ï¼Œå…è®¸Springè‡ªåŠ¨ä¸ºæ‚¨çš„beanè§£æåä½œè€…ï¼ˆå…¶ä»–beanï¼‰ã€‚ è‡ªåŠ¨è£…é…æ¨¡å¼ noï¼šæ— è‡ªåŠ¨è£…é…ï¼Œå¿…é¡»ä½¿ç”¨refæ¥å®šä¹‰Beanå¼•ç”¨ã€‚ byNameï¼šæŒ‰å±æ€§åç§°è‡ªåŠ¨è£…é…ã€‚ byTypeï¼šæŒ‰å±æ€§ç±»å‹è‡ªåŠ¨è£…é…ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªåŒç±»å‹Beanï¼Œåˆ™æŠ›å‡ºè‡´å‘½å¼‚å¸¸ã€‚ constructorï¼šç±»ä¼¼äºbyTypeï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ„é€ å‡½æ•°å‚æ•°ç±»å‹çš„ä¸€ä¸ªbeanï¼Œåˆ™æŠ›å‡ºè‡´å‘½å¼‚å¸¸ã€‚ Bean ä½œç”¨åŸŸsingleton Spring IoCå®¹å™¨åªåˆ›å»ºè¯¥beanå®šä¹‰çš„å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ã€‚æ­¤å•ä¸ªå®ä¾‹å­˜å‚¨åœ¨æ­¤ç±»å•ä¾‹beançš„ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”è¯¥Beançš„æ‰€æœ‰åç»­è¯·æ±‚å’Œå¼•ç”¨éƒ½å°†è¿”å›ç¼“å­˜å¯¹è±¡ã€‚ 1234&lt;bean id=&quot;accountService&quot; class=&quot;com.foo.DefaultAccountService&quot;/&gt;&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;&lt;bean id=&quot;accountService&quot; class=&quot;com.foo.DefaultAccountService&quot; scope=&quot;singleton&quot;/&gt; prototype å’Œå•ä¾‹å¯¹ç«‹ï¼Œé€šå¸¸ï¼Œå¯¹æ‰€æœ‰æœ‰çŠ¶æ€beanä½¿ç”¨åŸå‹èŒƒå›´ï¼Œå¯¹æ— çŠ¶æ€beanä½¿ç”¨å•ä¾‹èŒƒå›´ã€‚ 1&lt;bean id=&quot;accountService&quot; class=&quot;com.foo.DefaultAccountService&quot; scope=&quot;prototype&quot;/&gt; Request, session, global session, application, and WebSocket åœ¨webç¨‹åºä¸­ä½¿ç”¨ï¼Œå¯¹åº”äºHTTPè¯·æ±‚ä½œç”¨åŸŸ è‡ªå®šä¹‰beançš„æ€§è´¨ç”Ÿå‘½å‘¨æœŸå›è°ƒåˆå§‹åŒ–å›è°ƒå®ç°org.springframework.beans.factory.InitializingBeanæ¥å£ï¼Œå¯ä»¥ä¸ºbeanè®¾ç½®åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š 1void afterPropertiesSet() throws Exception; å®˜æ–¹ä¸å»ºè®®ä½¿ç”¨è¯¥æ¥å£ï¼Œå› ä¸ºä¼šå¢åŠ ä¸Springçš„è€¦åˆåº¦ã€‚å¯ä»¥ä½¿ç”¨@PostConstructæˆ–æŒ‡å®šbeançš„åˆå§‹åŒ–æ–¹æ³•ã€‚ ä½¿ç”¨xmlé…ç½®æ–‡ä»¶ 1&lt;bean id=&quot;exampleInitBean&quot; class=&quot;examples.ExampleBean&quot; init-method=&quot;init&quot;/&gt; ä½¿ç”¨Java @Beanæ³¨è§£ 1@Bean(initMethod = &quot;init&quot;) é”€æ¯å›è°ƒå®ç°org.springframework.beans.factory.DisposableBeanå¯ä»¥ä¸ºbeanè®¾ç½®é”€æ¯å›è°ƒæ–¹æ³•ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š 1void destroy() throws Exception; åŒæ ·çš„ï¼Œä¸å»ºè®®å®ç°è¯¥æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨@PreDestroyæˆ–æŒ‡å®šbeançš„åˆå§‹åŒ–æ–¹æ³•ã€‚ ä½¿ç”¨xmlé…ç½®æ–‡ä»¶ 1&lt;bean id=&quot;exampleInitBean&quot; class=&quot;examples.ExampleBean&quot; destroy-method=&quot;cleanup&quot;/&gt; ä½¿ç”¨Java @Beanæ³¨è§£ 1@Bean(destroyMethod = &quot;cleanup&quot;) ä»Spring 2.5å¼€å§‹ï¼Œæ‚¨æœ‰ä¸‰ä¸ªæ§åˆ¶beanç”Ÿå‘½å‘¨æœŸè¡Œä¸ºçš„é€‰é¡¹ï¼š InitializingBeanå’Œ DisposableBeanå›è°ƒæ¥å£ init()å’Œdestroy()æ–¹æ³• @PostConstructå’Œ@PreDestroyæ³¨è§£ å¦‚æœä¸ºä¸€ä¸ªbeanåŒæ—¶é…ç½®äº†ä¸Šè¿°æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œæ–¹æ³•é¡ºåºä¸ºï¼š @PostConstructå®šä¹‰çš„æ–¹æ³• InitializingBeanå›è°ƒæ¥å£å®šä¹‰çš„afterPropertiesSet() è‡ªå®šä¹‰é…ç½®çš„init()æ–¹æ³• é”€æ¯ï¼š @PreDestroyå®šä¹‰çš„æ–¹æ³• DisposableBeanå›è°ƒæ¥å£ å®šä¹‰çš„destroy() è‡ªå®šä¹‰é…ç½®çš„destroy()æ–¹æ³• ApplicationContextAwareå’ŒBeanNameAware ApplicationContextAwareï¼šå®ç°è¯¥æ¥å£ï¼Œå°†æ³¨å…¥ApplicationContextå®ä¾‹çš„å¼•ç”¨ BeanNameAwareï¼šå®ç°è¯¥æ¥å£ï¼Œå°†æ³¨å…¥BeanName é™¤äº†ApplicationContextAwareå’ŒBeanNameAwareï¼ŒSpringè¿˜æä¾›äº†ä¸€ç³»åˆ—Awareæ¥å£ï¼Œè¿™äº›æ¥å£å°†ä¸ºå®ç°ç±»æ³¨å…¥å¯¹åº”çš„å®ä¾‹ã€‚ ApplicationContextAwareï¼šå£°æ˜ ApplicationContext ApplicationEventPublisherAwareï¼šApplicationContextçš„äº‹ä»¶å‘å¸ƒè€… BeanClassLoaderAwareï¼šç”¨äºåŠ è½½beanç±»çš„ç±»åŠ è½½å™¨ã€‚ BeanFactoryAwareï¼šå£°æ˜ BeanFactory BeanNameAwareï¼šå£°æ˜beançš„åç§° BootstrapContextAware LoadTimeWeaverAware MessageSourceAware NotificationPublisherAwareï¼šSpring JMXé€šçŸ¥å‘å¸ƒè€… PortletConfigAwareï¼šå½“å‰PortletConfigå®¹å™¨ PortletContextAwareï¼šå½“å‰PortletContextå®¹å™¨ ResourceLoaderAwareï¼šé…ç½®çš„åŠ è½½ç¨‹åºï¼Œç”¨äºå¯¹èµ„æºè¿›è¡Œä½çº§è®¿é—® ServletConfigAwareï¼šå½“å‰ServletConfigå®¹å™¨ ServletContextAwareï¼šå½“å‰ServletContextå®¹å™¨ Beançš„ç»§æ‰¿åœ¨xmlé…ç½®æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰beançš„ç»§æ‰¿ä½“ç³»ï¼Œä½¿ç”¨parentå±æ€§å®šä¹‰çˆ¶ç±»ã€‚ 123456789101112&lt;bean id=&quot;inheritedTestBean&quot; abstract=&quot;true&quot; class=&quot;org.springframework.beans.TestBean&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;parent&quot;/&gt; &lt;property name=&quot;age&quot; value=&quot;1&quot;/&gt;&lt;/bean&gt;&lt;bean id=&quot;inheritsWithDifferentClass&quot; class=&quot;org.springframework.beans.DerivedTestBean&quot; parent=&quot;inheritedTestBean&quot; init-method=&quot;initialize&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;override&quot;/&gt; &lt;!-- the age property value of 1 will be inherited from parent --&gt;&lt;/bean&gt; åœ¨æºç é‡Œï¼Œå­ç±»æ˜¯é€šè¿‡ChildBeanDefinitionæ¥å®šä¹‰çš„ã€‚ å®¹å™¨æ‰©å±•ç‚¹ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»ç»§æ‰¿ApplicationContextå®ç°ç±»ï¼Œä¸è¿‡Springé¢„ç•™äº†ä¸€äº›æ¥å£ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ‰©å±•Spring IoCå®¹å™¨ã€‚ BeanPostProcessor12345678910111213public interface BeanPostProcessor &#123; //åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; //åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–å®Œæ¯•åè°ƒç”¨ Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;&#125;å¯ä»¥å®šä¹‰å¤šä¸ª`BeanPostProcessor`ï¼Œç„¶åå®ç°`Ordered`æ¥å£å¹¶ä¿®æ”¹å±æ€§orderæ¥æ§åˆ¶`BeanPostProcessor`çš„æ‰§è¡Œé¡ºåºã€‚æ³¨æ„ï¼š`ConfigurableBeanFactory`æä¾›â€‹```javavoid addBeanPostProcessor(BeanPostProcessor beanPostProcessor); æ¥æ‰‹åŠ¨æ³¨å†ŒBeanPostProcessorï¼Œè¿™äº›BeanPostProcessorä¸éœ€è¦éµå¾ªOrderdæ’åºè§„åˆ™ï¼Œæ€»æ˜¯åœ¨è‡ªåŠ¨æ³¨å…¥çš„BeanPostProcessorä¹‹å‰æ‰§è¡Œã€‚ ä¸€ä¸ªBeanPostProcessorçš„å®ç°ä¾‹å­RequiredAnnotationBeanPostProcessor ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®123public interface BeanFactoryPostProcessor &#123; void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;&#125; ç±»ä¼¼äºBeanPostProcessorï¼Œä¸åŒçš„æ˜¯ï¼ŒBeanFactoryPostProcessoræ“ä½œé…ç½®å…ƒæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpringå®¹å™¨å…è®¸BeanFactoryPostProcessorè¯»å–é…ç½®å¹¶æ›´æ”¹ã€‚ è¿™äº›BeanPostProcessorå°†åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä¾¿å°†æ›´æ”¹åº”ç”¨äºå®šä¹‰å®¹å™¨çš„é…ç½®å…ƒæ•°æ®ã€‚SpringåŒ…å«è®¸å¤šé¢„å®šä¹‰çš„BeanPostProcessor,ä¾‹å¦‚PropertyOverrideConfigurerå’ŒPropertyPlaceholderConfigurerã€‚ ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘123456public interface FactoryBean&lt;T&gt; &#123; // è‡ªå®šä¹‰beançš„åˆå§‹åŒ–é€»è¾‘ T getObject() throws Exception; Class&lt;?&gt; getObjectType(); boolean isSingleton();&#125; é…ç½®å®ç°FactoryBean&lt;T&gt;çš„beanæ˜¯ï¼Œè¿”å›çš„æ˜¯getObject()ç”Ÿæˆçš„beanï¼Œå¦‚æœè¦è¿”å› FactoryBeanå®ä¾‹æœ¬èº«ï¼Œåº”è¯¥ä½¿ç”¨getBean(&quot;&amp;myBean&quot;) åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½® @Required @Autowired @Resource @Qualifier @PostConstruct and @PreDestroy ç±»è·¯å¾„æ‰«æå’Œæ‰˜ç®¡ç»„ä»¶ @Component,@Controller,@Repository,@Service @Scope,@SessionScope @ComponentScan JSR 330æ ‡å‡†æ³¨è§£å’ŒSpringæ³¨è§£å¯¹ç…§ Spring javax.inject.* @Autowired @Inject @Component @Named / @ManagedBean @Scope(â€œsingletonâ€) @Singleton @Qualifier @Qualifier / @Named @Value - @Required - @Lazy - ObjectFactory Provider Environment æŠ½è±¡ä¸»è¦åŒ…å«ä¸¤ä¸ªæ–¹é¢ï¼šprofilesï¼ˆå¤šç¯å¢ƒï¼‰ and propertiesï¼ˆé…ç½®ï¼‰. å¤šç¯å¢ƒé…ç½® ä»£ç æ–¹å¼ 1234AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();ctx.getEnvironment().setActiveProfiles(&quot;development&quot;);ctx.register(SomeConfig.class, StandaloneDataConfig.class, JndiDataConfig.class);ctx.refresh(); é…ç½®æ–¹å¼ 1spring.profiles.active é…ç½®æŠ½è±¡ä»£ç æ¼”ç¤ºä¸‹ï¼š 12345678ApplicationContext ctx = new GenericApplicationContext();Environment env = ctx.getEnvironment();// æ˜¯å¦åŒ…å«fooçš„é…ç½®boolean containsFoo = env.containsProperty(&quot;foo&quot;);System.out.println(&quot;Does my environment contain the &#x27;foo&#x27; property? &quot; + containsFoo);// å‘ç¯å¢ƒä¸­æ·»åŠ é…ç½®MutablePropertySources sources = ctx.getEnvironment().getPropertySources();sources.addFirst(new MyPropertySource()); ä½¿ç”¨@PropertySourceæ·»åŠ é…ç½® 1234567891011121314@Configuration@PropertySource(&quot;classpath:/com/myco/app.properties&quot;)public class AppConfig &#123; @Autowired Environment env; @Bean public TestBean testBean() &#123; TestBean testBean = new TestBean(); testBean.setName(env.getProperty(&quot;testbean.name&quot;)); return testBean; &#125;&#125; BeanFactoryè¿˜æ˜¯ApplicationContextï¼Ÿå°½é‡ä½¿ç”¨ApplicationContextï¼Œå› ä¸ºApplicationContextåŒ…å«BeanFactoryçš„æ‰€æœ‰åŠŸèƒ½ï¼š åŠŸèƒ½ BeanFactory ApplicationContext beanåˆå§‹åŒ–/ç¼–è¾‘ æ”¯æŒ æ”¯æŒ è‡ªåŠ¨æ³¨å†ŒBeanPostProcessor ä¸æ”¯æŒ æ”¯æŒ è‡ªåŠ¨æ³¨å†ŒBeanFactoryPostProcessor ä¸æ”¯æŒ æ”¯æŒ æ–¹ä¾¿çš„MessageSourceè®¿é—®ï¼ˆé€‚ç”¨äºi18nï¼‰ ä¸æ”¯æŒ æ”¯æŒ å‘å¸ƒApplicationEvent ä¸æ”¯æŒ æ”¯æŒ è¦ä½¿ç”¨BeanFactoryå®ç°æ˜¾å¼æ³¨å†Œbeanåç½®å¤„ç†å™¨ï¼Œæ‚¨éœ€è¦ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š 12345678DefaultListableBeanFactory factory = new DefaultListableBeanFactory();// populate the factory with bean definitions// now register any needed BeanPostProcessor instancesMyBeanPostProcessor postProcessor = new MyBeanPostProcessor();factory.addBeanPostProcessor(postProcessor);// now start using the factory è¦ä½¿ç”¨BeanFactoryå®ç°æ—¶æ˜¾å¼æ³¨å†ŒBeanFactoryPostProcessorï¼Œæ‚¨å¿…é¡»ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š 12345678910DefaultListableBeanFactory factory = new DefaultListableBeanFactory();XmlBeanDefinitionReader reader = new XmlBeanDefinitionReader(factory);reader.loadBeanDefinitions(new FileSystemResource(&quot;beans.xml&quot;));// bring in some property values from a Properties filePropertyPlaceholderConfigurer cfg = new PropertyPlaceholderConfigurer();cfg.setLocation(new FileSystemResource(&quot;jdbc.properties&quot;));// now actually do the replacementcfg.postProcessBeanFactory(factory);","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Spring Boot Starter å¼€å‘æŒ‡å—","date":"2019-03-18T09:16:07.000Z","path":"p/20136/","text":"Spring Boot Starteræ˜¯ä»€ä¹ˆï¼Ÿä¾èµ–ç®¡ç†æ˜¯ä»»ä½•å¤æ‚é¡¹ç›®çš„å…³é”®éƒ¨åˆ†ã€‚ä»¥æ‰‹åŠ¨çš„æ–¹å¼æ¥å®ç°ä¾èµ–ç®¡ç†ä¸å¤ªç°å®ï¼Œä½ å¾—èŠ±æ›´å¤šæ—¶é—´ï¼ŒåŒæ—¶ä½ åœ¨é¡¹ç›®çš„å…¶ä»–é‡è¦æ–¹é¢èƒ½ä»˜å‡ºçš„æ—¶é—´å°±ä¼šå˜å¾—è¶Šå°‘ã€‚ Spring Boot starter å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè¯ç”Ÿçš„ã€‚Starter POM æ˜¯ä¸€ç»„æ–¹ä¾¿çš„ä¾èµ–æè¿°ç¬¦ï¼Œæ‚¨å¯ä»¥å°†å…¶åŒ…å«åœ¨åº”ç”¨ç¨‹åºä¸­ã€‚æ‚¨å¯ä»¥è·å¾—æ‰€éœ€çš„æ‰€æœ‰ Spring å’Œç›¸å…³æŠ€æœ¯çš„ä¸€ç«™å¼æœåŠ¡ï¼Œæ— éœ€é€šè¿‡ç¤ºä¾‹ä»£ç æœç´¢å’Œå¤åˆ¶ç²˜è´´ä¾èµ–ã€‚ æ­å¼€Spring Bootè‡ªåŠ¨è£…é…çš„ç¥ç§˜é¢çº±Auto Configuration ç±»å½“Spring Bootå¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åä¸ºspring.factoriesçš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½äºMETA-INFç›®å½•ä¸­ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹spring-boot-autoconfigureé¡¹ç›®ä¸­è¿™ä¸ªæ–‡ä»¶çš„ç‰‡æ®µï¼š 12345org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\\org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\\org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\\org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration æ­¤æ–‡ä»¶å®šä¹‰äº†ä¸€äº›Spring Bootå°†å°è¯•è¿è¡Œçš„è‡ªåŠ¨è£…é…ç±»ã€‚ä¾‹å¦‚ä»¥ä¸Šçš„ä»£ç ç‰‡æ®µï¼ŒSpring Bootå°†å°è¯•è¿è¡ŒRabbitMQï¼ŒCassandraï¼ŒMongoDBå’ŒHibernateçš„æ‰€æœ‰é…ç½®ç±»ã€‚è¿™äº›ç±»æ˜¯å¦å®é™…è¿è¡Œå°†å–å†³äºç±»è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨ä¾èµ–ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç±»è·¯å¾„ä¸­æ‰¾åˆ°MongoDBçš„ç±»ï¼Œåˆ™å°†è¿è¡ŒMongoAutoConfigurationï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰ä¸mongoç›¸å…³çš„beanã€‚æ­¤æ¡ä»¶åˆå§‹åŒ–ç”±@ConditionalOnClassæ³¨é‡Šå¯ç”¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹MongoAutoConfigurationç±»çš„ä»£ç ç‰‡æ®µï¼Œçœ‹çœ‹å®ƒçš„ç”¨æ³•ï¼š 1234567@Configuration@ConditionalOnClass(MongoClient.class)@EnableConfigurationProperties(MongoProperties.class)@ConditionalOnMissingBean(type = &quot;org.springframework.data.mongodb.MongoDbFactory&quot;)public class MongoAutoConfiguration &#123; // configuration code&#125; å¦‚æœå­˜åœ¨MongoClientç±»ï¼Œå°†è¿è¡Œè¯¥è‡ªåŠ¨è£…é…ç±»åˆå§‹åŒ–MongoClientç›¸å…³beanã€‚ åœ¨application.propertiesè‡ªå®šä¹‰é…ç½®Spring Bootä½¿ç”¨ä¸€äº›é¢„å…ˆé…ç½®çš„é»˜è®¤å€¼åˆå§‹åŒ–beanã€‚è¦è¦†ç›–è¿™äº›é»˜è®¤å€¼ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨application.propertiesæ–‡ä»¶ä¸­ä½¿ç”¨æŸä¸ªç‰¹å®šåç§°å£°æ˜å®ƒä»¬ã€‚Spring Bootå®¹å™¨ä¼šè‡ªåŠ¨è·å–è¿™äº›å±æ€§ã€‚åœ¨MongoAutoConfigurationçš„ä»£ç ç‰‡æ®µä¸­ï¼Œ@EnableConfigurationProperties(MongoProperties.class)è¡¨ç¤ºï¼Œä½¿ç”¨MongoPropertiesç±»æ¥å£°æ˜è‡ªå®šä¹‰å±æ€§ï¼š 1234567@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)public class MongoProperties &#123; private String host; // other fields with standard getters and setters&#125; @ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)å®šä¹‰äº†é…ç½®å‰ç¼€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨application.propertiesè¿™æ ·æ¥ä½¿ç”¨å®ƒï¼š 1spring.data.mongodb.host = localhost è¿™æ ·ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œlocalhostå°†è¢«æ³¨å…¥åˆ°hostå±æ€§ä¸­ è‡ªå®šä¹‰Spring Boot StarterSpring Bootè‡ªåŠ¨è£…é…è™½ç„¶ç¥å¥‡ï¼Œä½†æ˜¯ç¼–å†™èµ·æ¥å´å¼‚å¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰éƒ¨å°±ç­çš„æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªæµç¨‹ï¼š ç¼–å†™å±æ€§å®¹å™¨*Propertiesï¼Œå¹¶ç¼–å†™å¯¹åº”çš„*AutoConfigurationè‡ªåŠ¨è£…é…ç±» ä¸€ä¸ªpomæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å¼•å…¥åº“å’Œè‡ªåŠ¨è£…é…ç±»çš„ä¾èµ–é¡¹ æ¦‚å¿µè§£æç”¨äº*Propertiesçš„æ³¨è§£ @ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;) ï¼šç”¨äºæŒ‡å®šé…ç½®å‰ç¼€ ç”¨äº*AutoConfigurationçš„æ³¨è§£ @Configurationï¼šæ ‡è®°ä¸ºé…ç½®ç±»ï¼Œç”±Springå®¹å™¨åˆå§‹åŒ–å¹¶æ¥ç®¡ @EnableConfigurationPropertiesï¼šæ³¨å…¥é…ç½®å±æ€§å®¹å™¨ @ConditionalOnBeanï¼šæ¡ä»¶è£…é… é‡ç‚¹è¯´ä¸‹æ¡ä»¶è£…é…ï¼Œä»¥@ConditionalOnBeanä¸ºä¾‹ï¼Œå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeançš„æ—¶å€™è£…é… 1234567@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Conditional(OnBeanCondition.class)public @interface ConditionalOnBean&#123; //properties&#125; @Conditional(OnBeanCondition.class)æŒ‡å®šäº†å®ç°æ¡ä»¶è£…é…çš„é€»è¾‘ä»£ç  OnBeanConditionå£°æ˜å¦‚ä¸‹ï¼š 1class OnBeanCondition extends SpringBootCondition implements ConfigurationCondition&#123;&#125; æ‰€ä»¥ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥ç»§æ‰¿SpringBootConditionå¹¶å®ç°ConfigurationConditionæ¥è‡ªå®šä¹‰æ¡ä»¶è£…é…æ³¨è§£ã€‚ æ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªæ¡ä»¶è£…é…æ³¨è§£ï¼š @ConditionalOnBeanï¼šå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanæ—¶è£…é… @ConditionalOnClassï¼šå½“å­˜åœ¨æŒ‡å®šClassæ—¶è£…é… @ConditionalOnMissingBeanï¼šå½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanæ—¶è£…é… @ConditionalOnMissingClassï¼šå½“ä¸å­˜åœ¨æŒ‡å®šClassæ—¶è£…é… å°è¯•ç‰›åˆ€ æˆ‘ä»¬å°†è‡ªåŠ¨é…ç½®æ¨¡å—ç§°ä¸ºgreeter-spring-boot-autoconfigureã€‚è¯¥æ¨¡å—å°†æœ‰ä¸¤ä¸ªä¸»è¦ç±»ï¼Œå³GreeterPropertiesï¼Œå®ƒå°†é€šè¿‡application.propertiesæ–‡ä»¶å’ŒGreeterAutoConfiguartionè®¾ç½®è‡ªå®šä¹‰å±æ€§ï¼Œå¹¶ä¸ºgreeteråº“åˆ›å»ºbeanã€‚ å‡†å¤‡ï¼Œåˆ›å»ºå‡æƒ³çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥ç¨‹ï¼šGreet 123456789101112131415161718192021222324252627282930313233343536373839public class Greeter &#123; private GreetingConfig greetingConfig; public Greeter(GreetingConfig greetingConfig) &#123; this.greetingConfig = greetingConfig; &#125; public String greet(LocalDateTime localDateTime) &#123; String name = greetingConfig.getProperty(USER_NAME); int hourOfDay = localDateTime.getHour(); if (hourOfDay &gt;= 5 &amp;&amp; hourOfDay &lt; 12) &#123; return String.format(&quot;Hello %s, %s&quot;, name, greetingConfig.get(MORNING_MESSAGE)); &#125; else if (hourOfDay &gt;= 12 &amp;&amp; hourOfDay &lt; 17) &#123; return String.format(&quot;Hello %s, %s&quot;, name, greetingConfig.get(AFTERNOON_MESSAGE)); &#125; else if (hourOfDay &gt;= 17 &amp;&amp; hourOfDay &lt; 20) &#123; return String.format(&quot;Hello %s, %s&quot;, name, greetingConfig.get(EVENING_MESSAGE)); &#125; else &#123; return String.format(&quot;Hello %s, %s&quot;, name, greetingConfig.get(NIGHT_MESSAGE)); &#125; &#125; public String greet() &#123; return greet(LocalDateTime.now()); &#125;&#125;public class GreeterConfigParams &#123; public static final String USER_NAME = &quot;user.name&quot;; public static final String MORNING_MESSAGE = &quot;morning.message&quot;; public static final String AFTERNOON_MESSAGE = &quot;afternoon.message&quot;; public static final String EVENING_MESSAGE = &quot;evening.message&quot;; public static final String NIGHT_MESSAGE = &quot;night.message&quot;;&#125;public class GreetingConfig extends Properties &#123; private static final long serialVersionUID = 5662570853707247891L;&#125; ç¼–å†™Propertieså’ŒAutoConfigurationï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@ConfigurationProperties(prefix = &quot;gcdd1993.greeter&quot;)public class GreeterProperties &#123; private String userName; private String morningMessage; private String afternoonMessage; private String eveningMessage; private String nightMessage; // getter and setter&#125;@Configuration@ConditionalOnClass(Greeter.class)@EnableConfigurationProperties(GreeterProperties.class)public class GreeterAutoConfiguration &#123; @Autowired private GreeterProperties greeterProperties; @Bean @ConditionalOnMissingBean public GreetingConfig greeterConfig() &#123; String userName = greeterProperties.getUserName() == null ? System.getProperty(&quot;user.name&quot;) : greeterProperties.getUserName(); GreetingConfig greetingConfig = new GreetingConfig(); greetingConfig.put(USER_NAME, userName); if (greeterProperties.getMorningMessage() != null) &#123; greetingConfig.put(MORNING_MESSAGE, greeterProperties.getMorningMessage()); &#125; if (greeterProperties.getAfternoonMessage() != null) &#123; greetingConfig.put(AFTERNOON_MESSAGE, greeterProperties.getAfternoonMessage()); &#125; if (greeterProperties.getEveningMessage() != null) &#123; greetingConfig.put(EVENING_MESSAGE, greeterProperties.getEveningMessage()); &#125; if (greeterProperties.getNightMessage() != null) &#123; greetingConfig.put(NIGHT_MESSAGE, greeterProperties.getNightMessage()); &#125; return greetingConfig; &#125; @Bean @ConditionalOnMissingBean public Greeter greeter(GreetingConfig greetingConfig) &#123; return new Greeter(greetingConfig); &#125;&#125; ç„¶ååœ¨src/main/resources/META-INFç›®å½•ä¸‹åˆ›å»ºspring.factoriesæ–‡ä»¶ 12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\ com.gcdd.autoconfigure.GreeterAutoConfiguration æµ‹è¯•ä¸€ä¸‹ï¼š åˆ›å»ºé…ç½®æ–‡ä»¶application.propertiesï¼š 12gcdd1993.greeter.userName=gcdd1993gcdd1993.greeter.eveningMessage=good evening ä½¿ç”¨Greeter bean 123456789101112131415@SpringBootApplicationpublic class GreeterSampleApplication implements CommandLineRunner &#123; @Autowired private Greeter greeter; public static void main(String[] args) &#123; SpringApplication.run(GreeterSampleApplication.class, args); &#125; @Override public void run(String... args) throws Exception &#123; String message = greeter.greet(); System.out.println(message); &#125;&#125; æ‰§è¡Œmainæ–¹æ³•ï¼Œå°†ä¼šè¾“å‡ºä¸€è¡Œï¼š 1Hello gcdd1993, good evening ä¸ºé…ç½®ç±»æ·»åŠ æç¤ºæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Ideaä¸­ï¼Œç¼–å†™é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œæœ‰æ™ºèƒ½æç¤º å…¶å®è¿™ä¸æ˜¯Ideaæçš„é¬¼ï¼Œæ˜¯ç”±META-INF/spring-configuration-metadata.jsonæ–‡ä»¶é…ç½®å¥½çš„ï¼ŒIdeaåªæ˜¯è´Ÿè´£è§£æè¿™ä¸ªæ–‡ä»¶ï¼Œæä¾›æˆ‘ä»¬æ™ºèƒ½åŒ–çš„æç¤ºä¿¡æ¯ã€‚ æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„å¾ˆç®€å•ï¼Œæ·»åŠ ä¾èµ–org.springframework.boot:spring-boot-configuration-processorå°±è¡Œäº†ã€‚ Maven 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;&lt;/dependency&gt; Gradle 1compile group: &#x27;org.springframework.boot&#x27;, name: &#x27;spring-boot-configuration-processor&#x27;, version: &#x27;2.1.6.RELEASE&#x27; æ€»ç»“ä»¥ä¸Šå°±æ˜¯Spring Boot Starterçš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœè¦å‘å¸ƒåˆ°mavenä»“åº“ï¼Œä¾›åˆ«äººä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨mvn installæ‰“åŒ…å‘å¸ƒè‡³mavenä»“åº“ã€‚ ğŸ‘‰ æœ¬æ–‡ä»£ç åœ°å€","tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"https://gcdd1993.github.io/tags/Spring-Boot/"}]},{"title":"Ubuntu å®‰è£…MongoDB","date":"2019-03-15T03:38:31.000Z","path":"p/49357/","text":"Ubuntu16.04å®‰è£…MongoDBæŒ‡å— ç³»ç»Ÿåˆå§‹åŒ–1234$ sudo apt update$ sudo apt dist-upgrade$ sudo apt autoremove$ sudo apt clean å®‰è£…mongodb1sudo apt-get install mongodb mongodbé»˜è®¤æ˜¯ç›‘å¬åœ¨127.0.0.1ç«¯å£çš„ï¼Œè¦å¼€å¯å¤–ç½‘è¿æ¥ï¼Œéœ€è¦ä¿®æ”¹mongodbé…ç½®æ–‡ä»¶ï¼š 1vim /etc/mongodb.conf bind_ip = 127.0.0.1 ä¿®æ”¹ä¸ºbind_ip = 0.0.0.0 è¿æ¥mongodbä½¿ç”¨å·¥å…·robo 3tï¼Œæ·»åŠ è¿æ¥ä¿¡æ¯ å¯ç”¨å¯†ç è®¿é—®mongodbé»˜è®¤æ˜¯ä¸å¼€å¯å¯†ç ç™»å½•çš„ï¼Œå¦‚æœè¦å¼€å¯ï¼Œä¿®æ”¹mongodbé…ç½®æ–‡ä»¶ï¼š å–æ¶ˆ#auth = trueå‰é¢çš„æ³¨é‡Šï¼Œå¹¶é‡å¯mongodbservice mongodb restart æ·»åŠ ç”¨æˆ·ä¿¡æ¯: 12use test_db;db.createUser(&#123;user:&#x27;cool&#x27;, pwd:&#x27;cool&#x27;, roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;test_db&quot; &#125; ]&#125;); è¿æ¥è¿æ¥æ–¹å¼è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¦æ·»åŠ authenticationï¼ŒæŒ‡å®šdatabaseï¼Œusernameï¼Œpasswordï¼Œä»¥åŠé€‰æ‹©Mongodb-CRéªŒè¯æ–¹å¼","tags":[{"name":"NoSql","slug":"NoSql","permalink":"https://gcdd1993.github.io/tags/NoSql/"},{"name":"MongoDB","slug":"MongoDB","permalink":"https://gcdd1993.github.io/tags/MongoDB/"}]},{"title":"Spring Eventäº‹ä»¶é©±åŠ¨","date":"2019-03-14T05:15:01.000Z","path":"p/18285/","text":"Springäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œç®€å•æ¥è¯´ç±»ä¼¼äºMessage-Queueæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„Pub/Subå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œä¹Ÿç±»ä¼¼äºJavaè®¾è®¡æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚ è‡ªå®šä¹‰äº‹ä»¶Springçš„äº‹ä»¶æ¥å£ä½äºorg.springframework.context.ApplicationEventï¼Œæºç å¦‚ä¸‹ï¼š 1234567891011public abstract class ApplicationEvent extends EventObject &#123; private static final long serialVersionUID = 7099057708183571937L; private final long timestamp; public ApplicationEvent(Object source) &#123; super(source); this.timestamp = System.currentTimeMillis(); &#125; public final long getTimestamp() &#123; return this.timestamp; &#125;&#125; ç»§æ‰¿äº†Javaçš„äº‹ä»¶å¯¹è±¡EventObjectï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨getSource()æ–¹æ³•æ¥è·å–åˆ°äº‹ä»¶ä¼ æ’­å¯¹è±¡ã€‚ è‡ªå®šä¹‰Springäº‹ä»¶123456789101112public class CustomSpringEvent extends ApplicationEvent &#123; private String message; public CustomSpringEvent(Object source, String message) &#123; super(source); this.message = message; &#125; public String getMessage() &#123; return message; &#125;&#125; ç„¶åå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ï¼Œè¯¥ç›‘å¬å™¨å®é™…ä¸Šç­‰åŒäºæ¶ˆè´¹è€…ï¼Œéœ€è¦äº¤ç»™Springå®¹å™¨ç®¡ç†ã€‚ 1234567@Componentpublic class CustomSpringEventListener implements ApplicationListener&lt;CustomSpringEvent&gt; &#123; @Override public void onApplicationEvent(CustomSpringEvent event) &#123; System.out.println(&quot;Received spring custom event - &quot; + event.getMessage()); &#125;&#125; æœ€åå®šä¹‰äº‹ä»¶å‘å¸ƒè€… 1234567891011@Componentpublic class CustomSpringEventPublisher &#123; @Autowired private ApplicationEventPublisher applicationEventPublisher; public void doStuffAndPublishAnEvent(final String message) &#123; System.out.println(&quot;Publishing custom event. &quot;); CustomSpringEvent customSpringEvent = new CustomSpringEvent(this, message); applicationEventPublisher.publishEvent(customSpringEvent); &#125;&#125; åˆ›å»ºæµ‹è¯•ç±» 123456789101112@RunWith(SpringRunner.class)@SpringBootTestpublic class CustomSpringEventPublisherTest &#123; @Autowired private CustomSpringEventPublisher publisher; @Test public void publishStringEventTest() &#123; publisher.doStuffAndPublishAnEvent(&quot;111&quot;); &#125;&#125; è¿è¡Œæµ‹è¯•ç±»ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº†ä¸¤æ¡é‡è¦ä¿¡æ¯ 1234//å‘å¸ƒäº‹ä»¶Publishing custom event. //ç›‘å¬å™¨å¾—åˆ°äº†äº‹ä»¶ï¼Œå¹¶ç›¸åº”å¤„ç†Received spring custom event - 111 ç”±äºSpringäº‹ä»¶æ˜¯å‘å¸ƒ/è®¢é˜…çš„æ¨¡å¼,è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µ 1ç”Ÿäº§è€… - 1æ¶ˆè´¹è€… 1ç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€… å¤šç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€… ä¸Šé¢ä¸¾çš„ä¾‹å­æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬æ¥è¯•è¯•å…¶ä»–ä¸¤ä¸ªæƒ…å†µ ç»§ç»­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ä½œä¸ºæ¶ˆè´¹è€…ï¼š 1234567@Componentpublic class CustomSpringEventListener2 implements ApplicationListener&lt;CustomSpringEvent&gt; &#123; @Override public void onApplicationEvent(CustomSpringEvent event) &#123; System.out.println(&quot;CustomSpringEventListener2 Received spring custom event - &quot; + event.getMessage()); &#125;&#125; è¿è¡Œæµ‹è¯•ç±»åï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ§åˆ¶å°é¡ºåºæ‰“å°äº†ä¸¤æ¡æ¶ˆè´¹ä¿¡æ¯ï¼š 123Publishing custom event. CustomSpringEventListener1 Received spring custom event - 111CustomSpringEventListener2 Received spring custom event - 111 è¯´æ˜ï¼ŒSpringçš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯å¹¿æ’­æ¨¡å¼ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ¥å—åˆ°æ¶ˆæ¯ï¼Œå¹¶æ­£å¸¸æ¶ˆè´¹ å†è¯•è¯•ç¬¬ä¸‰ç§å¤šç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€…çš„æƒ…å†µ ç»§ç»­åˆ›å»ºä¸€ä¸ªå‘å¸ƒè€…ï¼Œ 1234567891011@Componentpublic class CustomSpringEventPublisher2 &#123; @Autowired private ApplicationEventPublisher applicationEventPublisher; public void doStuffAndPublishAnEvent(final String message) &#123; System.out.println(&quot;CustomSpringEventPublisher2 Publishing custom event. &quot;); CustomSpringEvent customSpringEvent = new CustomSpringEvent(this, message); applicationEventPublisher.publishEvent(customSpringEvent); &#125;&#125; æ§åˆ¶å°è¾“å‡ºï¼š 123456CustomSpringEventPublisher Publishing custom event. CustomSpringEventListener1 Received spring custom event - 111CustomSpringEventListener2 Received spring custom event - 111CustomSpringEventPublisher2 Publishing custom event. CustomSpringEventListener1 Received spring custom event - 222CustomSpringEventListener2 Received spring custom event - 222 ä»ä»¥ä¸Šè¾“å‡ºå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹åˆ°ï¼ŒSpringçš„äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶å¿…é¡»è¢«æ‰€æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹å®Œæˆä¹‹åï¼Œå‘å¸ƒè€…çš„ä»£ç æ‰èƒ½ç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œé‚£æœ‰æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œçš„äº‹ä»¶å‘¢ï¼Ÿ Springä¸­çš„å¼‚æ­¥äº‹ä»¶è¦ä½¿ç”¨Spring çš„å¼‚æ­¥äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚æ­¥äº‹ä»¶é…ç½®ç±» 1234567891011@Configurationpublic class AsynchronousSpringEventsConfig &#123; @Bean(name = &quot;applicationEventMulticaster&quot;) public ApplicationEventMulticaster simpleApplicationEventMulticaster() &#123; SimpleApplicationEventMulticaster eventMulticaster = new SimpleApplicationEventMulticaster(); eventMulticaster.setTaskExecutor(new SimpleAsyncTaskExecutor()); return eventMulticaster; &#125;&#125; å‘å¸ƒå’Œè®¢é˜…çš„ä»£ç ä¸ç”¨å˜åŠ¨ï¼Œç›´æ¥è¿è¡Œæµ‹è¯•ç±»ï¼Œæ§åˆ¶å°å°†æ‰“å°å‡ºï¼š 123456CustomSpringEventPublisher Publishing custom event. CustomSpringEventPublisher2 Publishing custom event. CustomSpringEventListener1 Received spring custom event - 111CustomSpringEventListener2 Received spring custom event - 111CustomSpringEventListener2 Received spring custom event - 222CustomSpringEventListener1 Received spring custom event - 222 å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå‘å¸ƒè€…å‡ ä¹åŒæ—¶è¿è¡Œï¼Œè¯æ˜ç›‘å¬å™¨æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ²¡æœ‰é˜»å¡ä½å‘å¸ƒè€…çš„ä»£ç ã€‚å‡†ç¡®çš„è¯´ï¼Œç›‘å¬å™¨å°†åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­å¼‚æ­¥å¤„ç†äº‹ä»¶ã€‚ Springè‡ªå¸¦çš„äº‹ä»¶ç±»å‹äº‹ä»¶é©±åŠ¨åœ¨Springä¸­æ˜¯è¢«å¹¿æ³›é‡‡ç”¨çš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹ApplicationEventçš„å­ç±»å¯ä»¥å‘ç°è®¸å¤šEventäº‹ä»¶ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚ æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨ä»Spring 4.2å¼€å§‹ï¼Œäº‹ä»¶ç›‘å¬å™¨ä¸éœ€è¦æ˜¯å®ç°ApplicationListeneræ¥å£çš„beanï¼Œå®ƒå¯ä»¥é€šè¿‡@EventListeneræ³¨è§£åœ¨ä»»ä½•è¢«Springå®¹å™¨ç®¡ç†çš„beançš„å…¬å…±æ–¹æ³•ä¸Šã€‚ 1234567@Componentpublic class AnnotationDrivenContextStartedListener &#123; @EventListener public void handleContextStart(CustomSpringEvent cse) &#123; System.out.println(&quot;Handling Custom Spring Event.&quot;); &#125;&#125; æ§åˆ¶å°è¾“å‡ºç»“æœï¼š 1234CustomSpringEventPublisher Publishing custom event.Handling Custom Spring Event.CustomSpringEventPublisher2 Publishing custom event. Handling Custom Spring Event. åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœè¦æ”¹ä¸ºå¼‚æ­¥ç›‘å¬å™¨ï¼Œåœ¨äº‹ä»¶æ–¹æ³•ä¸ŠåŠ ä¸Š@Asyncï¼Œå¹¶ä¸”åœ¨Springåº”ç”¨ä¸­å¼€å¯å¼‚æ­¥æ”¯æŒ(åœ¨SpringBootApplicationä¸Šæ·»åŠ @EnableAsync)ã€‚ 12345678@Componentpublic class AnnotationDrivenContextStartedListener &#123; @Async @EventListener public void handleContextStart(CustomSpringEvent cse) &#123; System.out.println(&quot;Handling Custom Spring Event.&quot;); &#125;&#125; å†æ¬¡è¿è¡Œæµ‹è¯•ç±»: 1234CustomSpringEventPublisher Publishing custom event. CustomSpringEventPublisher2 Publishing custom event. Handling Custom Spring Event.Handling Custom Spring Event. æ³›å‹æ”¯æŒåˆ›å»ºä¸€ä¸ªé€šç”¨æ³›å‹äº‹ä»¶æ¨¡å‹ 12345678910@Datapublic class GenericSpringEvent&lt;T&gt; &#123; private T message; protected boolean success; public GenericSpringEvent(T what, boolean success) &#123; this.message = what; this.success = success; &#125;&#125; æ³¨æ„GenericSpringEventå’ŒCustomSpringEventä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥çµæ´»åœ°å‘å¸ƒä»»ä½•ä»»æ„äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†éœ€è¦ä»ApplicationEventæ‰©å±•ã€‚ è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æ— æ³•åƒä¹‹å‰ä¸€æ ·ï¼Œé€šè¿‡ç»§æ‰¿ApplicationListenerçš„æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œå› ä¸ºApplicationListenerå®šä¹‰äº†äº‹ä»¶å¿…é¡»æ˜¯ApplicationEventçš„å­ç±»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨ã€‚ é€šè¿‡åœ¨@EventListeneræ³¨é‡Šä¸Šå®šä¹‰å¸ƒå°”SpELè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥ä½¿äº‹ä»¶ç›‘å¬å™¨æˆä¸ºæ¡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªä¼šä¸ºæˆåŠŸçš„Stringçš„GenericSpringEventè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼š 1234567@Componentpublic class AnnotationDrivenEventListener &#123; @EventListener(condition = &quot;#event.success&quot;) public void handleSuccessful(GenericSpringEvent&lt;String&gt; event) &#123; System.out.println(&quot;Handling generic event (conditional).&quot;); &#125;&#125; å®šä¹‰å…·ä½“ç±»å‹çš„äº‹ä»¶: 12345public class StringGenericSpringEvent extends GenericSpringEvent&lt;String&gt; &#123; public StringGenericSpringEvent(String message, boolean success) &#123; super(message, success); &#125;&#125; å®šä¹‰å‘å¸ƒè€…ï¼š 1234567891011@Componentpublic class StringGenericSpringEventPublisher &#123; @Autowired private ApplicationEventPublisher applicationEventPublisher; public void doStuffAndPublishAnEvent(final String message, final boolean success) &#123; System.out.println(&quot;CustomSpringEventPublisher Publishing custom event. &quot;); StringGenericSpringEvent springEvent = new StringGenericSpringEvent(message, success); applicationEventPublisher.publishEvent(springEvent); &#125;&#125; æµ‹è¯•ç±»ï¼š 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestpublic class CustomSpringEventPublisherTest &#123; @Autowired private StringGenericSpringEventPublisher publisher; @Test public void publishStringEventTest() &#123; publisher.doStuffAndPublishAnEvent(&quot;success&quot;, true); publisher.doStuffAndPublishAnEvent(&quot;failed&quot;, false); &#125;&#125; è¿è¡Œç»“æœï¼š 123CustomSpringEventPublisher Publishing custom event. Handling generic event (conditional) successCustomSpringEventPublisher Publishing custom event. ç›‘å¬å™¨åªå¤„ç†äº†æˆåŠŸçš„äº‹ä»¶ï¼ŒæˆåŠŸå¿½ç•¥æ‰äº†å¤±è´¥çš„äº‹ä»¶ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ä¸ºåŒä¸€ä¸ªäº‹ä»¶å®šä¹‰æˆåŠŸå’Œå¤±è´¥ä¸åŒçš„æ“ä½œã€‚ Springäº‹ä»¶çš„äº‹åŠ¡ç»‘å®šä»Spring 4.2å¼€å§‹ï¼Œæ¡†æ¶æä¾›äº†ä¸€ä¸ªæ–°çš„@TransactionalEventListeneræ³¨è§£ï¼Œå®ƒæ˜¯@EventListenerçš„æ‰©å±•ï¼Œå…è®¸å°†äº‹ä»¶çš„ä¾¦å¬å™¨ç»‘å®šåˆ°äº‹åŠ¡çš„ä¸€ä¸ªé˜¶æ®µã€‚ç»‘å®šå¯ä»¥è¿›è¡Œä»¥ä¸‹äº‹åŠ¡é˜¶æ®µï¼š AFTER_COMMIT(é»˜è®¤çš„)ï¼šåœ¨äº‹åŠ¡æˆåŠŸåè§¦å‘ AFTER_ROLLBACK:äº‹åŠ¡å›æ»šæ—¶è§¦å‘ AFTER_COMPLETIONï¼šäº‹åŠ¡å®Œæˆåè§¦å‘ï¼Œä¸è®ºæ˜¯å¦æˆåŠŸ BEFORE_COMMITï¼šäº‹åŠ¡æäº¤ä¹‹å‰è§¦å‘ æ€»ç»“ Springä¸­å¤„ç†äº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå‘å¸ƒå®ƒï¼Œç„¶ååœ¨ç›‘å¬å™¨ä¸­å¤„ç†å®ƒã€‚ åœ¨é…ç½®ä¸­å¯ç”¨äº‹ä»¶çš„å¼‚æ­¥å¤„ç†ã€‚ Spring 4.2ä¸­å¼•å…¥çš„æ”¹è¿›ï¼Œä¾‹å¦‚æ³¨é‡Šé©±åŠ¨çš„ä¾¦å¬å™¨ï¼Œæ›´å¥½çš„æ³›å‹æ”¯æŒä»¥åŠç»‘å®šåˆ°äº‹åŠ¡é˜¶æ®µçš„äº‹ä»¶ã€‚ ğŸ‘‰ æœ¬æ–‡ä»£ç åœ°å€","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Springçš„BeanFactoryå’ŒFactoryBean","date":"2019-03-12T09:01:29.000Z","path":"p/17046/","text":"å®˜æ–¹å®šä¹‰ BeanFactoryï¼šSpring Beanå®¹å™¨çš„æ ¹æ¥å£ FactoryBeanï¼šå„ä¸ªå¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå¦‚æœbeanå®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå®ƒå°†è¢«ç”¨ä½œå¯¹è±¡çš„å·¥å‚ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½œä¸ºbeanå®ä¾‹ã€‚ æºç è§£æBeanFactory12345678910111213141516public interface BeanFactory &#123; //æ ‡æ³¨æ˜¯è·å–FactoryBeançš„å®ç°ç±»ï¼Œè€Œä¸æ˜¯è°ƒç”¨getObject()è·å–çš„å®ä¾‹ String FACTORY_BEAN_PREFIX = &quot;&amp;&quot;; Object getBean(String name) throws BeansException; &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) throws BeansException; Object getBean(String name, Object... args) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType, Object... args) throws BeansException; boolean containsBean(String name); boolean isSingleton(String name) throws NoSuchBeanDefinitionException; boolean isPrototype(String name) throws NoSuchBeanDefinitionException; boolean isTypeMatch(String name, ResolvableType typeToMatch) throws NoSuchBeanDefinitionException; boolean isTypeMatch(String name, Class&lt;?&gt; typeToMatch) throws NoSuchBeanDefinitionException; Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException; String[] getAliases(String name);&#125; ä»æºç çš„æ–¹æ³•å®šä¹‰ä¸Šï¼Œå°±å¯ä»¥çœ‹å‡ºï¼ŒBeanFactoryä½œä¸ºbeançš„å®¹å™¨ç®¡ç†å™¨ï¼Œæä¾›äº†ä¸€ç³»åˆ—è·å–beanä»¥åŠè·å–beanå±æ€§çš„æ–¹æ³•ã€‚ å†™ä¸€ä¸ªå°ä¾‹å­è¯•éªŒä¸‹ï¼š SimpleBeanï¼š 12345public class SimpleBean &#123; public void send() &#123; System.out.println(&quot;Hello Spring Bean!&quot;); &#125;&#125; Springé…ç½®æ–‡ä»¶config.xmlï¼š 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;bean id=&quot;simpleBean&quot; class=&quot;base.SimpleBeanFactoryBean&quot;/&gt;&lt;/beans&gt; æµ‹è¯•æ–¹æ³•ï¼š 12345678910111213141516171819202122232425public static void main(String[] args) throws Exception &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;config.xml&quot;); BeanFactory beanFactory = context.getAutowireCapableBeanFactory(); System.out.println(&quot;é€šè¿‡åç§°è·å–bean&quot;); SimpleBean simpleBean = (SimpleBean) beanFactory.getBean(&quot;simpleBean&quot;); simpleBean.send(); System.out.println(&quot;é€šè¿‡åç§°å’Œç±»å‹è·å–bean&quot;); simpleBean = beanFactory.getBean(&quot;simpleBean&quot;, SimpleBean.class); simpleBean.send(); System.out.println(&quot;é€šè¿‡ç±»å‹è·å–bean&quot;); simpleBean = beanFactory.getBean(SimpleBean.class); simpleBean.send(); boolean containsBean = beanFactory.containsBean(&quot;simpleBean&quot;); System.out.println(&quot;æ˜¯å¦åŒ…å« simpleBean ? &quot; + containsBean); boolean singleton = beanFactory.isSingleton(&quot;simpleBean&quot;); System.out.println(&quot;æ˜¯å¦æ˜¯å•ä¾‹? &quot; + singleton); boolean match = beanFactory.isTypeMatch(&quot;simpleBean&quot;, ResolvableType.forClass(SimpleBean.class)); System.out.println(&quot;æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? &quot; + match); match = beanFactory.isTypeMatch(&quot;simpleBean&quot;, SimpleBean.class); System.out.println(&quot;æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? &quot; + match); Class&lt;?&gt; aClass = beanFactory.getType(&quot;simpleBean&quot;); System.out.println(&quot;simpleBean çš„ç±»å‹æ˜¯ &quot; + aClass.getName()); String[] aliases = beanFactory.getAliases(&quot;simpleBean&quot;); System.out.println(&quot;simpleBean çš„åˆ«å : &quot; + Arrays.toString(aliases));&#125; æ§åˆ¶å°ç»“æœï¼š 123456789101112é€šè¿‡åç§°è·å–beanHello Spring Bean!é€šè¿‡åç§°å’Œç±»å‹è·å–beanHello Spring Bean!é€šè¿‡ç±»å‹è·å–beanHello Spring Bean!æ˜¯å¦åŒ…å« simpleBean ? trueæ˜¯å¦æ˜¯å•ä¾‹? trueæ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? trueæ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? truesimpleBean çš„ç±»å‹æ˜¯ base.SimpleBeansimpleBean çš„åˆ«å : [] FactoryBean123456789101112131415161718public interface FactoryBean&lt;T&gt; &#123; /** * è·å–ä¸€ä¸ªbeanï¼Œå¦‚æœé…ç½®äº†å·¥å‚beanï¼Œåœ¨getBeançš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œè·å–ä¸€ä¸ªbean */ T getObject() throws Exception; /** * è·å–beançš„ç±»å‹ */ Class&lt;?&gt; getObjectType(); /** * æ˜¯å¦æ˜¯å•ä¾‹ */ boolean isSingleton();&#125; æ¥å£æ˜¯æ³›å‹ï¼Œå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­getObject()æ˜¯å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œå°†ä¼šé€šè¿‡æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªbeançš„å®ä¾‹ã€‚ ä¸€ä¸ªå°ä¾‹å­ï¼š 123456789101112131415161718public class SimpleBeanFactoryBean implements FactoryBean&lt;SimpleBean&gt; &#123; @Override public SimpleBean getObject() throws Exception &#123; System.out.println(&quot;MyFactoryBean getObject&quot;); return new SimpleBean(); &#125; @Override public Class&lt;?&gt; getObjectType() &#123; System.out.println(&quot;MyFactoryBean getObjectType&quot;); return SimpleBean.class; &#125; @Override public boolean isSingleton() &#123; return false; &#125;&#125; ä»¥ä¸Šå¯ä»¥ä¿®æ”¹ä¸ºå•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥åšæˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼Œå¯å¡‘æ€§è¾ƒé«˜ã€‚ é…ç½®æ–‡ä»¶config.xml: 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;bean id=&quot;simple&quot; class=&quot;base.SimpleBeanFactoryBean&quot;/&gt;&lt;/beans&gt; æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªé…ç½®äº†SimpleBeanFactoryBeanï¼Œå¹¶æ²¡æœ‰é…ç½®SimpleBeanï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹getBeanæ–¹æ³•çš„è¾“å‡ºã€‚ 123ApplicationContext context = new ClassPathXmlApplicationContext(&quot;config.xml&quot;);SimpleBean simpleBean = context.getBean(SimpleBean.class);simpleBean.send(); æ§åˆ¶å°è¾“å‡ºï¼š 123MyFactoryBean getObjectTypeMyFactoryBean getObjectHello Spring Bean! ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡ºFactoryBeançš„æ‰§è¡Œæµç¨‹ é€šè¿‡getObjectTypeè·å–beançš„ç±»å‹ è°ƒç”¨getObjectæ–¹æ³•è·å–beançš„å®ä¾‹ æ€»ç»“BeanFactoryå’ŒFactoryBeanå…¶å®æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯åç§°æ¯”è¾ƒåƒè€Œå·²ã€‚ BeanFactoryæ˜¯IOCæœ€åŸºæœ¬çš„å®¹å™¨ï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†beanï¼Œå®ƒä¸ºå…¶ä»–å…·ä½“çš„IOCå®¹å™¨æä¾›äº†æœ€åŸºæœ¬çš„è§„èŒƒã€‚ FactoryBeanæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå½“åœ¨IOCå®¹å™¨ä¸­çš„Beanå®ç°äº†FactoryBeanåï¼Œé€šè¿‡getBean(String BeanName)è·å–åˆ°çš„Beanå¯¹è±¡å¹¶ä¸æ˜¯FactoryBeançš„å®ç°ç±»å¯¹è±¡ï¼Œè€Œæ˜¯è¿™ä¸ªå®ç°ç±»ä¸­çš„getObject()æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚è¦æƒ³è·å–FactoryBeançš„å®ç°ç±»ï¼Œå°±è¦getBean(&amp;BeanName)ï¼Œåœ¨BeanNameä¹‹å‰åŠ ä¸Š&amp;ã€‚","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Jacksonä½¿ç”¨æŒ‡å—","date":"2019-01-21T12:12:32.000Z","path":"p/56384/","text":"ä»äº‹JAVAå¼€å‘å·¥ä½œä»¥æ¥,ä¸€ç›´éƒ½ç¦»ä¸å¼€Jacksonçš„åºåˆ—åŒ–ååºåˆ—åŒ–,å¯¹äºJacksonçš„ä½¿ç”¨ä¹Ÿä¸€ç›´å¤„äºå¤Ÿç”¨ä½†ä¸æ·±å…¥çš„çŠ¶æ€ï¼Œä¸‹é¢æ˜¯æ—¥å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­å¯¹Jacksonçš„æ€»ç»“ã€‚ Jacksonå¸¸ç”¨æ³¨è§£åºåˆ—åŒ–æ³¨è§£@JsonAnyGetter åƒæ™®é€šå±æ€§ä¸€æ ·åºåˆ—åŒ–Map 123456789public class ExtendableBean &#123; public String name; private Map&lt;String, String&gt; properties; @JsonAnyGetter public Map&lt;String, String&gt; getProperties() &#123; return properties; &#125;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 12345&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;attr2&quot;:&quot;val2&quot;, &quot;attr1&quot;:&quot;val1&quot;&#125; @JsonGetter å°†æŒ‡å®šçš„æ–¹æ³•æ ‡è®°ä¸ºgetteræ–¹æ³•ã€‚å¯ä»¥ç”¨æ¥ä»£æ›¿@JsonProperty 123456789public class MyBean &#123; public int id; private String name; @JsonGetter(&quot;name&quot;) public String getTheName() &#123; return name; &#125;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 1234&#123; &quot;id&quot;: 1, &quot;name&quot;:&quot;My bean&quot;&#125; @JsonPropertyOrder ç”¨åœ¨ç±»ä¸Šï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™è‡ªå®šä¹‰å±æ€§è¾“å‡ºé¡ºåº 12345@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot; &#125;)public class MyBean &#123; public int id; public String name;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 1234&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;id&quot;: 1&#125; @JsonRawValue å®Œå…¨æŒ‰ç…§åŸæ ·åºåˆ—åŒ–å±æ€§çš„å€¼ 123456public class RawBean &#123; public String name; @JsonRawValue public String json;&#125; ä¾‹å¦‚ï¼š 1RawBean bean = new RawBean(&quot;My bean&quot;, &quot;&#123;\\&quot;attr\\&quot;:false&#125;&quot;); å°†åºåˆ—åŒ–ä¸ºï¼š 123456&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;json&quot;:&#123; &quot;attr&quot;:false &#125;&#125; è€Œä¸æ˜¯ï¼š 1234&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;json&quot;:&quot;&#123;\\&quot;attr\\&quot;:false&#125;&quot;&#125; @JsonValue å®šä¹‰æ•´ä¸ªå®ä½“çš„åºåˆ—åŒ–æ–¹æ³•ï¼ŒJacksonå°†ä¼šä½¿ç”¨è¯¥æ–¹æ³•çš„è¾“å‡ºä½œä¸ºåºåˆ—åŒ–è¾“å‡ºã€‚ 12345678910111213public enum TypeEnumWithValue &#123; TYPE1(1, &quot;Type A&quot;), TYPE2(2, &quot;Type 2&quot;); private Integer id; private String name; // standard constructors @JsonValue public String getName() &#123; return name; &#125;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 123&#123; &quot;name&quot;: &quot;Type 2&quot;&#125; @JsonRootName å¦‚æœéœ€è¦å°†å®ä½“åŒ…è£…ä¸€å±‚ï¼Œå¯ä»¥ä½¿ç”¨@JsonRootNameæ¥æŒ‡å®šæ ¹åŒ…è£…å™¨çš„åç§° 12345@JsonRootName(value = &quot;user&quot;)public class UserWithRoot &#123; public int id; public String name;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 123456&#123; &quot;user&quot;: &#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;John&quot; &#125;&#125; å¦‚æœä¸ç”¨è¯¥æ³¨è§£ï¼Œå°†ä¼šåºåˆ—åŒ–ä¸ºï¼š 1234&#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;John&quot;&#125; @JsonSerialize ç”¨äºæŒ‡å®šè‡ªå®šä¹‰åºåˆ—åŒ–å™¨æ¥åºåˆ—åŒ–å®ä½“ 123456public class Event &#123; public String name; @JsonSerialize(using = CustomDateSerializer.class) public Date eventDate;&#125; è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class CustomDateSerializer extends StdSerializer&lt;Date&gt; &#123; private static SimpleDateFormat formatter = new SimpleDateFormat(&quot;dd-MM-yyyy hh:mm:ss&quot;); public CustomDateSerializer() &#123; this(null); &#125; public CustomDateSerializer(Class&lt;Date&gt; t) &#123; super(t); &#125; @Override public void serialize( Date value, JsonGenerator gen, SerializerProvider arg2) throws IOException, JsonProcessingException &#123; gen.writeString(formatter.format(value)); &#125;&#125; è¾“å‡ºç¤ºä¾‹ï¼š 1234&#123; &quot;name&quot;: &quot;test&quot;, &quot;eventDate&quot;: &quot;20-12-2014 02:30:00&quot;&#125; ååºåˆ—åŒ–æ³¨è§£@JsonCreator æŒ‡å®šååºåˆ—åŒ–ä½¿ç”¨çš„æ„é€ å‡½æ•°æˆ–æ–¹æ³• å¾…ååºåˆ—åŒ–Jsonç¤ºä¾‹ï¼š 1234&#123; &quot;id&quot;:1, &quot;theName&quot;:&quot;My bean&quot;&#125; 12345678910public class BeanWithCreator &#123; public int id; public String name; @JsonCreator public BeanWithCreator(@JsonProperty(&quot;id&quot;) int id, @JsonProperty(&quot;theName&quot;) String name) &#123; this.id = id; this.name = name; &#125;&#125; @JacksonInject æŒ‡å®šæŸä¸ªå­—æ®µä»æ³¨å…¥èµ‹å€¼ï¼Œè€Œä¸æ˜¯ä»Json 123456public class BeanWithInject &#123; @JacksonInject public int id; public String name;&#125; ç¤ºä¾‹ç”¨æ³•ï¼š 1234567String json = &quot;&#123;\\&quot;name\\&quot;:\\&quot;My bean\\&quot;&#125;&quot;; InjectableValues inject = new InjectableValues.Std() .addValue(int.class, 1);BeanWithInject bean = new ObjectMapper().reader(inject) .forType(BeanWithInject.class) .readValue(json); @JsonAnySetter åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå°†Mapå½“æˆæ™®é€šå±æ€§ å¾…ååºåˆ—åŒ–Jsonï¼š 12345&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;attr2&quot;:&quot;val2&quot;, &quot;attr1&quot;:&quot;val1&quot;&#125; 123456789public class ExtendableBean &#123; public String name; private Map&lt;String, String&gt; properties; @JsonAnySetter public void add(String key, String value) &#123; properties.put(key, value); &#125;&#125; propertieså­—æ®µçš„å€¼å°†ä¼šæ˜¯ç”± attr2 -&gt; val2,attr1 -&gt; val1ç»„æˆçš„é”®å€¼å¯¹ã€‚ @JsonSetter å°†æ–¹æ³•æ ‡è®°ä¸ºsetteræ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šå±æ€§åç§° 123456789public class MyBean &#123; public int id; private String name; @JsonSetter(&quot;name&quot;) public void setTheName(String name) &#123; this.name = name; &#125;&#125; @JsonDeserialize ç”¨äºæŒ‡å®šè‡ªå®šä¹‰ååºåˆ—åŒ–å™¨æ¥ååºåˆ—åŒ–å®ä½“ 123456public class Event &#123; public String name; @JsonDeserialize(using = CustomDateDeserializer.class) public Date eventDate;&#125; å¯¹åº”çš„ååºåˆ—åŒ–å™¨ï¼š 123456789101112131415161718192021222324252627public class CustomDateDeserializer extends StdDeserializer&lt;Date&gt; &#123; private static SimpleDateFormat formatter = new SimpleDateFormat(&quot;dd-MM-yyyy hh:mm:ss&quot;); public CustomDateDeserializer() &#123; this(null); &#125; public CustomDateDeserializer(Class&lt;?&gt; vc) &#123; super(vc); &#125; @Override public Date deserialize( JsonParser jsonparser, DeserializationContext context) throws IOException &#123; String date = jsonparser.getText(); try &#123; return formatter.parse(date); &#125; catch (ParseException e) &#123; throw new RuntimeException(e); &#125; &#125;&#125; Jacksonè®¾ç½®å±æ€§æ˜¯å¦å‚ä¸åºåˆ—åŒ–@JsonIgnoreProperties åœ¨ç±»ä¸ŠæŒ‡å®šè¦å¿½ç•¥çš„å±æ€§ 12345@JsonIgnoreProperties(&#123; &quot;id&quot; &#125;)public class BeanWithIgnore &#123; public int id; public String name;&#125; @JsonIgnore åœ¨å…·ä½“å±æ€§ä¸Šå¿½ç•¥ï¼Œä½¿å…¶ä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹ 123456public class BeanWithIgnore &#123; @JsonIgnore public int id; public String name;&#125; ä¸@JsonIgnorePropertiesæ˜¯ç­‰æ•ˆçš„ã€‚ @JsonIgnoreType ç”¨åœ¨ç±»ä¸Šï¼Œå°†å¿½ç•¥è¯¥ç±»æ‰€æœ‰å±æ€§ 12345678910public class User &#123; public int id; public Name name; @JsonIgnoreType public static class Name &#123; public String firstName; public String lastName; &#125;&#125; @JsonInclude ç”¨äºæ’é™¤å€¼ä¸ºempty/null/defaultçš„å±æ€§ 12345@JsonInclude(Include.NON_NULL)public class MyBean &#123; public int id; public String name;&#125; @JsonAutoDetect å¼ºåˆ¶åºåˆ—åŒ–ç§æœ‰å±æ€§ï¼Œä¸ç®¡å®ƒæœ‰æ²¡æœ‰getteræ–¹æ³• 12345@JsonAutoDetect(fieldVisibility = Visibility.ANY)public class PrivateBean &#123; private int id; private String name;&#125; Jacksonå¤„ç†å¤šæ€ä¸€èˆ¬éƒ½æ˜¯ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œæœ‰ä¸‹é¢ä¸‰ä¸ªæ³¨è§£ï¼š @JsonTypeInfo æŒ‡å®šåºåˆ—åŒ–ä¸­åŒ…å«çš„ç±»å‹ä¿¡æ¯çš„è¯¦ç»†ä¿¡æ¯ @JsonSubTypes æŒ‡å®šå¸¦æ³¨é‡Šç±»å‹çš„å­ç±»å‹ @JsonTypeName æŒ‡å®šç”¨äºå¸¦æ³¨é‡Šçš„ç±»çš„é€»è¾‘ç±»å‹åç§° 1234567891011121314151617181920212223242526public class Zoo &#123; public Animal animal; @JsonTypeInfo( use = JsonTypeInfo.Id.NAME, include = As.PROPERTY, property = &quot;type&quot;) @JsonSubTypes(&#123; @JsonSubTypes.Type(value = Dog.class, name = &quot;dog&quot;), @JsonSubTypes.Type(value = Cat.class, name = &quot;cat&quot;) &#125;) public static class Animal &#123; public String name; &#125; @JsonTypeName(&quot;dog&quot;) public static class Dog extends Animal &#123; public double barkVolume; &#125; @JsonTypeName(&quot;cat&quot;) public static class Cat extends Animal &#123; boolean likesCream; public int lives; &#125;&#125; ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒæŒ‡å®šå±æ€§typeä¸ºåˆ¤æ–­å…·ä½“å­ç±»çš„ä¾æ®ï¼Œä¾‹å¦‚ï¼štype=dogï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºDogç±»å‹ã€‚ Jacksoné€šç”¨æ³¨è§£ï¼ˆåºåˆ—åŒ–ååºåˆ—åŒ–éƒ½ç”Ÿæ•ˆï¼‰@JsonProperty æŒ‡å®šJSONä¸­çš„å±æ€§åç§° 1234567891011121314public class MyBean &#123; public int id; private String name; @JsonProperty(&quot;name&quot;) public void setTheName(String name) &#123; this.name = name; &#125; @JsonProperty(&quot;name&quot;) public String getTheName() &#123; return name; &#125;&#125; @JsonFormat ç”¨äºåœ¨åºåˆ—åŒ–æ—¥æœŸ/æ—¶é—´å€¼æ—¶æŒ‡å®šæ ¼å¼ã€‚ 12345678public class Event &#123; public String name; @JsonFormat( shape = JsonFormat.Shape.STRING, pattern = &quot;dd-MM-yyyy hh:mm:ss&quot;) public Date eventDate;&#125; @JsonUnwrapped å°†å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§ä¸å½“å‰å¹³çº§ï¼Œä¸å¤ªå¥½æè¿°ï¼Œç®€å•è¯´å°±æ˜¯æ‹†å¼€åŒ…è£…ã€‚ 1234567891011public class UnwrappedUser &#123; public int id; @JsonUnwrapped public Name name; public static class Name &#123; public String firstName; public String lastName; &#125;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 12345&#123; &quot;id&quot;:1, &quot;firstName&quot;:&quot;John&quot;, &quot;lastName&quot;:&quot;Doe&quot;&#125; å¦‚æœä¸åŠ @JsonUnwrappedæ³¨è§£ï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºï¼š 1234567&#123; &quot;id&quot;:1, &quot;name&quot;: &#123; &quot;firstName&quot;:&quot;John&quot;, &quot;lastName&quot;:&quot;Doe&quot; &#125;&#125; @JsonView æŒ‡å®šè§†å›¾ï¼Œç±»ä¼¼åˆ†ç»„è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ– å®šä¹‰è§†å›¾ï¼š 1234public class Views &#123; public static class Public &#123;&#125; public static class Internal extends Public &#123;&#125;&#125; å®šä¹‰å®ä½“ï¼š 12345678910public class Item &#123; @JsonView(Views.Public.class) public int id; @JsonView(Views.Public.class) public String itemName; @JsonView(Views.Internal.class) public String ownerName;&#125; åºåˆ—åŒ–ç¤ºä¾‹ï¼š 123String result = new ObjectMapper() .writerWithView(Views.Public.class) .writeValueAsString(item); è¿™æ—¶ï¼Œå°†åªä¼šåºåˆ—åŒ–idå’ŒitemNameå­—æ®µ @JsonManagedReference, @JsonBackReference @JsonManagedReferenceå’Œ@JsonBackReferenceæ³¨é‡Šç”¨äºå¤„ç†çˆ¶/å­å…³ç³»å¹¶è§£å†³å¾ªç¯é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ªç›¸äº’å¼•ç”¨çš„ç±»ï¼š 1234567public class ItemWithRef &#123; public int id; public String itemName; @JsonManagedReference public UserWithRef owner;&#125; 1234567public class UserWithRef &#123; public int id; public String name; @JsonBackReference public List&lt;ItemWithRef&gt; userItems;&#125; ä¸åŠ æ³¨è§£ï¼Œä¼šå¾ªç¯è°ƒç”¨ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨@JsonManagedReferenceå’Œ@JsonBackReferenceæ¥é¿å…å†…å­˜æº¢å‡ºã€‚ @JsonIdentityInfo ç”¨äºæŒ‡å®šåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–å€¼æ—¶ä½¿ç”¨å¯¹è±¡æ ‡è¯†ï¼Œä¾‹å¦‚ï¼Œå¤„ç†æ— é™é€’å½’ç±»å‹çš„é—®é¢˜ã€‚ 12345678@JsonIdentityInfo( generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)public class ItemWithIdentity &#123; public int id; public String itemName; public UserWithIdentity owner;&#125; @JsonFilter æŒ‡å®šåºåˆ—åŒ–æœŸé—´è¦ä½¿ç”¨çš„è¿‡æ»¤å™¨ã€‚ 12345@JsonFilter(&quot;myFilter&quot;)public class BeanWithFilter &#123; public int id; public String name;&#125; ç¤ºä¾‹ä»£ç ï¼š 12345678910BeanWithFilter bean = new BeanWithFilter(1, &quot;My bean&quot;);FilterProvider filters = new SimpleFilterProvider().addFilter( &quot;myFilter&quot;, SimpleBeanPropertyFilter.filterOutAllExcept(&quot;name&quot;));String result = new ObjectMapper() .writer(filters) .writeValueAsString(bean); è‡ªå®šä¹‰Jacksonæ³¨è§£å¯ä»¥ä½¿ç”¨@JacksonAnnotationsInsideæ¥å¼€å‘è‡ªå®šä¹‰æ³¨è§£ 12345@Retention(RetentionPolicy.RUNTIME) @JacksonAnnotationsInside @JsonInclude(Include.NON_NULL) @JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot;, &quot;dateCreated&quot; &#125;) public @interface CustomAnnotation &#123;&#125; å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ï¼š 123456@CustomAnnotationpublic class BeanWithCustomAnnotation &#123; public int id; public String name; public Date dateCreated;&#125; è‡ªå®šä¹‰æ³¨è§£å¯ä»¥å¢å¼ºä»£ç å¤ç”¨ï¼ŒæŠŠä¸€äº›é€šç”¨çš„Jacksonæ³¨è§£ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°æ³¨è§£ï¼Œæ–°æ³¨è§£å¯ä»¥ä»£æ›¿ç»„åˆçš„æ³¨è§£ã€‚ Jackson MixIn æ³¨è§£ åŠ¨æ€åœ°ä¸ºæŸäº›ç±»å‹å¢åŠ ç»Ÿä¸€çš„Jacksonæ³¨è§£ å®ä½“ï¼š 12345public class Item &#123; public int id; public String itemName; public User owner;&#125; MixInç±»ï¼š 12@JsonIgnoreTypepublic class MyMixInForIgnoreType &#123;&#125; æˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°è®©Userç±»å‹ä¸å‚ä¸åºåˆ—åŒ–ï¼š 1234Item item = new Item(1, &quot;book&quot;, null);ObjectMapper mapper = new ObjectMapper();mapper.addMixIn(User.class, MyMixInForIgnoreType.class);result = mapper.writeValueAsString(item); ç¦ç”¨Jacksonæ³¨è§£å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦Jacksonæ³¨è§£çš„å®ä½“ï¼š 123456@JsonInclude(Include.NON_NULL)@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot; &#125;)public class MyBean &#123; public int id; public String name;&#125; æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç¦ç”¨è¯¥å®ä½“ä¸Šçš„æ‰€æœ‰Jacksonæ³¨è§£ï¼š 123MyBean bean = new MyBean(1, null);ObjectMapper mapper = new ObjectMapper();mapper.disable(MapperFeature.USE_ANNOTATIONS); Jacksonçš„ObjectMapperç”¨æ³•javaç±» è½¬æ¢ä¸º jsonå¯ä»¥ç›´æ¥åºåˆ—åŒ–ä¸ºJsonå­—ç¬¦ä¸²ï¼š 1objectMapper.writeValueAsString(car); æˆ–è€…ï¼Œå¯ä»¥åºåˆ—åŒ–åˆ°æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯Jsonå­—ç¬¦ä¸²ï¼š 1objectMapper.writeValue(new File(&quot;target/car.json&quot;), car); json è½¬æ¢ä¸º javaç±»ä»å­—ç¬¦ä¸²ï¼š 12String json = &quot;&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;&quot;;objectMapper.readValue(json, Car.class); ä»æ–‡ä»¶ï¼š 1objectMapper.readValue(new File(&quot;target/json_car.json&quot;), Car.class); ä»URLï¼š 1objectMapper.readValue(new URL(&quot;target/json_car.json&quot;), Car.class); jsonè½¬æ¢ä¸ºJackson JsonNode1234String json = &quot;&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;&quot;;JsonNode jsonNode = objectMapper.readTree(json);String color = jsonNode.get(&quot;color&quot;).asText();// Output: color -&gt; Black json è½¬æ¢ä¸º javaé›†åˆ123String jsonCarArray = &quot;[&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;, &#123; \\&quot;color\\&quot; : \\&quot;Red\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;]&quot;;List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, new TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;); json è½¬æ¢ä¸º Map12String json = &quot;&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;&quot;;Map&lt;String, Object&gt; map = objectMapper.readValue(json, new TypeReference&lt;Map&lt;String,Object&gt;&gt;()&#123;&#125;); ObjectMapperçš„å¸¸ç”¨é…ç½®å¿½ç•¥ä¸è¯†åˆ«çš„å­—æ®µï¼ˆjsonå±æ€§ä¸ç›®æ ‡å®ä½“å­˜åœ¨å±æ€§ä¸Šçš„å·®å¼‚ï¼‰ï¼š 1objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); å…è®¸åŸå§‹å€¼ä¸ºnullï¼š 1objectMapper.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, false); å…è®¸å°†æšä¸¾åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸ºæ•°å­—ï¼š 1objectMapper.configure(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS, false); é…ç½®è‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨å‡è®¾æœ‰ä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼š 123456789101112131415161718public class CustomCarSerializer extends StdSerializer&lt;Car&gt; &#123; public CustomCarSerializer() &#123; this(null); &#125; public CustomCarSerializer(Class&lt;Car&gt; t) &#123; super(t); &#125; @Override public void serialize( Car car, JsonGenerator jsonGenerator, SerializerProvider serializer) &#123; jsonGenerator.writeStartObject(); jsonGenerator.writeStringField(&quot;car_brand&quot;, car.getType()); jsonGenerator.writeEndObject(); &#125;&#125; ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼š 1234567891011121314151617181920212223public class CustomCarDeserializer extends StdDeserializer&lt;Car&gt; &#123; public CustomCarDeserializer() &#123; this(null); &#125; public CustomCarDeserializer(Class&lt;?&gt; vc) &#123; super(vc); &#125; @Override public Car deserialize(JsonParser parser, DeserializationContext deserializer) &#123; Car car = new Car(); ObjectCodec codec = parser.getCodec(); JsonNode node = codec.readTree(parser); // try catch block JsonNode colorNode = node.get(&quot;color&quot;); String color = colorNode.asText(); car.setColor(color); return car; &#125;&#125; ç”¨ObjectMapperä½¿ç”¨ä»–ä»¬ï¼š 1234//æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨module.addSerializer(Car.class, new CustomCarSerializer());//æ·»åŠ è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨module.addDeserializer(Car.class, new CustomCarDeserializer()); å¤„ç†æ—¥æœŸæ ¼å¼åŒ–123ObjectMapper objectMapper = new ObjectMapper();DateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm a z&quot;);objectMapper.setDateFormat(df); å¤„ç†é›†åˆååºåˆ—åŒ–ä¸ºæ•°ç»„ï¼š 12345String jsonCarArray = &quot;[&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;, &#123; \\&quot;color\\&quot; : \\&quot;Red\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;]&quot;;ObjectMapper objectMapper = new ObjectMapper();objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, true);Car[] cars = objectMapper.readValue(jsonCarArray, Car[].class); ååºåˆ—åŒ–ä¸ºé›†åˆï¼š 1234String jsonCarArray = &quot;[&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;, &#123; \\&quot;color\\&quot; : \\&quot;Red\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;]&quot;;ObjectMapper objectMapper = new ObjectMapper();List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, new TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;); ObjectMapperçš„åŸºæœ¬ç”¨æ³•ObjectMapperå¯ä»¥é€šè¿‡configureæ–¹æ³•è®¾ç½®å…¨å±€åºåˆ—åŒ–/ååºåˆ—åŒ–è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š1objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); å¸¸ç”¨çš„ä¸€äº›è®¾ç½®ï¼š DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIESï¼šå¿½ç•¥ä¸è¯†åˆ«çš„å­—æ®µ DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVESï¼šå…è®¸ä½¿ç”¨å±æ€§çš„é»˜è®¤å€¼è¿›è¡Œååºåˆ—åŒ– DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMSï¼šå…è®¸å°†æšä¸¾å€¼åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸ºæ•°å­— æ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–ç¨‹åº1234567//åˆ›å»ºä¸€ä¸ªæ¨¡å—SimpleModule module = new SimpleModule(&quot;CustomCarSerializer&quot;, new Version(1, 0, 0, null, null, null));//å°†è‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–ç¨‹åºæ³¨å†Œåˆ°æ¨¡å—module.addSerializer(Car.class, new CustomCarSerializer());//module.addDeserializer(Car.class, new CustomCarDeserializer());//æ³¨å†Œæ¨¡å—mapper.registerModule(module); å¤„ç†æ—¥æœŸæ ¼å¼12DateFormat df = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm a z&quot;);mapper.setDateFormat(df); å¤„ç†é›†åˆå¤„ç†æ•°ç»„1234String jsonCarArray = &quot;[&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;, &#123; \\&quot;color\\&quot; : \\&quot;Red\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;]&quot;;ObjectMapper objectMapper = new ObjectMapper();objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, true);Car[] cars = objectMapper.readValue(jsonCarArray, Car[].class); å¤„ç†é›†åˆ123String jsonCarArray = &quot;[&#123; \\&quot;color\\&quot; : \\&quot;Black\\&quot;, \\&quot;type\\&quot; : \\&quot;BMW\\&quot; &#125;, &#123; \\&quot;color\\&quot; : \\&quot;Red\\&quot;, \\&quot;type\\&quot; : \\&quot;FIAT\\&quot; &#125;]&quot;;ObjectMapper objectMapper = new ObjectMapper();List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, new TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;); Jacksonæ³¨è§£æ‰©å±•@JsonIdentityReference ä½¿ç”¨æŒ‡å®šçš„æ ‡è¯†æ¥åºåˆ—åŒ–Javaå¯¹è±¡ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ ä¾‹å¦‚ï¼š 123456@JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)@JsonIdentityReference(alwaysAsId = true)public class BeanWithoutIdentityReference &#123; private int id; private String name;&#125; å°†è¢«åºåˆ—åŒ–ä¸ºï¼š 11 @JsonAppend è¿è¡Œåœ¨åºåˆ—åŒ–æ—¶æ·»åŠ é¢å¤–çš„å±æ€§ 123456789@JsonAppend(attrs = &#123; @JsonAppend.Attr(value = &quot;version&quot;) &#125;)public class BeanWithAppend &#123; private int id; private String name; // constructor, getters and setters&#125; ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–æ—¶æ‰‹åŠ¨å¢åŠ version = 1.0çš„å±æ€§ 123BeanWithAppend bean = new BeanWithAppend(2, &quot;Bean With Append Annotation&quot;);ObjectWriter writer = mapper.writerFor(BeanWithAppend.class).withAttribute(&quot;version&quot;, &quot;1.0&quot;);String jsonString = writer.writeValueAsString(bean); åºåˆ—åŒ–ç»“æœï¼š 12345&#123; &quot;id&quot;: 2, &quot;name&quot;: &quot;Bean With Append Annotation&quot;, &quot;version&quot;: &quot;1.0&quot;&#125; @JsonNaming æŒ‡å®šåºåˆ—åŒ–çš„æ—¶å€™å±æ€§å‘½åæ–¹å¼ æœ‰å››ç§é€‰é¡¹ï¼š KEBAB_CASE ç”±è¿å­—ç¬¦åˆ†å‰²ï¼Œä¾‹å¦‚ï¼škebab-case LOWER_CASE æ‰€æœ‰çš„å­—æ¯éƒ½è½¬æ¢ä¸ºå°å†™ï¼Œä¾‹å¦‚ï¼šlowercase SNAKE_CASE æ‰€æœ‰çš„å­—æ¯éƒ½è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶ä¸”ç”±ä¸‹åˆ’çº¿åˆ†å‰²ï¼Œä¾‹å¦‚ï¼šsnake_case UPPER_CAMEL_CASE æ‰€æœ‰åç§°å…ƒç´ ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œåè·Ÿå°å†™å­—æ¯ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ï¼šUpperCamelCase ä½¿ç”¨ä¸¾ä¾‹ï¼š 12345@JsonNaming(PropertyNamingStrategy.SnakeCaseStrategy.class)public class NamingBean &#123; private int id; private String beanName;&#125; @JsonPropertyDescription ç”¨äºç”Ÿæˆå­—æ®µçš„æè¿°ä¿¡æ¯ ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢ä¸€ä¸ªå®ä½“ï¼š 12345public class PropertyDescriptionBean &#123; private int id; @JsonPropertyDescription(&quot;This is a description of the name property&quot;) private String name;&#125; æˆ‘ä»¬å¯ä»¥è¾“å‡ºè¯¥ç±»çš„ä¿¡æ¯ï¼š 1234SchemaFactoryWrapper wrapper = new SchemaFactoryWrapper();mapper.acceptJsonFormatVisitor(PropertyDescriptionBean.class, wrapper);JsonSchema jsonSchema = wrapper.finalSchema();String jsonString = mapper.writeValueAsString(jsonSchema); ç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617&#123; &quot;type&quot;: &quot;object&quot;, &quot;id&quot;: &quot;urn:jsonschema:com:baeldung:jackson:annotation:extra:PropertyDescriptionBean&quot;, &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;This is a description of the name property&quot; &#125;, &quot;id&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125; &#125;&#125; @JsonPOJOBuilder è‡ªå®šä¹‰ç”Ÿæˆå™¨ç±»ï¼Œæ¥æ§åˆ¶jsonçš„ååºåˆ—åŒ–è¡Œä¸º @JsonPOJOBuilderæœ‰ä¸¤ä¸ªå±æ€§ï¼š buildMethodName å°†JSONå­—æ®µç»‘å®šåˆ°beançš„å±æ€§åï¼Œç”¨äºå®ä¾‹åŒ–é¢„æœŸbeançš„æ— å‚æ„é€ çš„åç§°ã€‚é»˜è®¤åç§°ä¸ºbuildã€‚ withPrefix ç”¨äºè‡ªåŠ¨æ£€æµ‹JSONå’Œbeanå±æ€§ä¹‹é—´åŒ¹é…çš„åç§°å‰ç¼€ã€‚é»˜è®¤å‰ç¼€ä¸ºwithã€‚ å‡è®¾æˆ‘ä»¬è¦ååºåˆ—åŒ–çš„jsonå¦‚ä¸‹ï¼š 1234&#123; &quot;id&quot;: 5, &quot;name&quot;: &quot;POJO Builder Bean&quot;&#125; å¯¹åº”çš„pojoï¼š 1234567@JsonDeserialize(builder = BeanBuilder.class)public class POJOBuilderBean &#123; private int identity; private String beanName; // constructor, getters and setters&#125; å¯¹åº”çš„ç”Ÿæˆå™¨ï¼š 12345678910111213141516171819@JsonPOJOBuilder(buildMethodName = &quot;createBean&quot;, withPrefix = &quot;construct&quot;)public class BeanBuilder &#123; private int idValue; private String nameValue; public BeanBuilder constructId(int id) &#123; idValue = id; return this; &#125; public BeanBuilder constructName(String name) &#123; nameValue = name; return this; &#125; public POJOBuilderBean createBean() &#123; return new POJOBuilderBean(idValue, nameValue); &#125;&#125; ä½¿ç”¨ObjectMapperååºåˆ—åŒ–ï¼š 12String jsonString = &quot;&#123;\\&quot;id\\&quot;:5,\\&quot;name\\&quot;:\\&quot;POJO Builder Bean\\&quot;&#125;&quot;;POJOBuilderBean bean = mapper.readValue(jsonString, POJOBuilderBean.class); ğŸ‘‰ ä»£ç ä»“åº“ğŸ‘‰ Jackson JSON Tutorial","tags":[{"name":"jackson","slug":"jackson","permalink":"https://gcdd1993.github.io/tags/jackson/"}]},{"title":"åç«¯è·¨åŸŸçš„Nç§æ–¹æ³•","date":"2019-01-21T11:11:31.000Z","path":"p/34331/","text":"ç®€å•æ¥è¯´ï¼ŒCORSæ˜¯ä¸€ç§è®¿é—®æœºåˆ¶ï¼Œè‹±æ–‡å…¨ç§°æ˜¯Cross-Origin Resource Sharingï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸèµ„æºå…±äº«ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®å“åº”å¤´ï¼ŒæŠŠå‘èµ·è·¨åŸŸçš„åŸå§‹åŸŸåæ·»åŠ åˆ°Access-Control-Allow-Origin å³å¯ã€‚ è¿”å›æ–°çš„CorsFilter(å…¨å±€è·¨åŸŸ) åœ¨ä»»æ„é…ç½®ç±»ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„CorsFilter Beanï¼Œå¹¶æ·»åŠ æ˜ å°„è·¯å¾„å’Œå…·ä½“çš„CORSé…ç½®ä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425@Configurationpublic class GlobalCorsConfig &#123; @Bean public CorsFilter corsFilter() &#123; //1.æ·»åŠ CORSé…ç½®ä¿¡æ¯ CorsConfiguration config = new CorsConfiguration(); //æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ config.addAllowedOrigin(&quot;*&quot;); //æ˜¯å¦å‘é€Cookieä¿¡æ¯ config.setAllowCredentials(true); //æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ(è¯·æ±‚æ–¹å¼) config.addAllowedMethod(&quot;*&quot;); //æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ(å¤´éƒ¨ä¿¡æ¯) config.addAllowedHeader(&quot;*&quot;); //æš´éœ²å“ªäº›å¤´éƒ¨ä¿¡æ¯(å› ä¸ºè·¨åŸŸè®¿é—®é»˜è®¤ä¸èƒ½è·å–å…¨éƒ¨å¤´éƒ¨ä¿¡æ¯) config.addExposedHeader(&quot;*&quot;); //2.æ·»åŠ æ˜ å°„è·¯å¾„ UrlBasedCorsConfigurationSource configSource = new UrlBasedCorsConfigurationSource(); configSource.registerCorsConfiguration(&quot;/**&quot;, config); //3.è¿”å›æ–°çš„CorsFilter. return new CorsFilter(configSource); &#125;&#125; ä½¿ç”¨æ³¨è§£(å±€éƒ¨è·¨åŸŸ)åœ¨æ–¹æ³•ä¸Š(@RequestMapping)ä½¿ç”¨æ³¨è§£ @CrossOrigin123456@RequestMapping(&quot;/hello&quot;)@ResponseBody@CrossOrigin(&quot;http://localhost:8080&quot;) public String index()&#123; return &quot;Hello World&quot;;&#125; åœ¨æ§åˆ¶å™¨(@Controller)ä¸Šä½¿ç”¨æ³¨è§£ @CrossOrigin12345678910@Controller@CrossOrigin(origins = &quot;http://domain.com&quot;, maxAge = 3600)public class AccountController &#123; @RequestMapping(&quot;/hello&quot;) @ResponseBody public String index()&#123; return &quot;Hello World&quot;; &#125;&#125; æ‰‹å·¥è®¾ç½®å“åº”å¤´(å±€éƒ¨è·¨åŸŸ) ä½¿ç”¨HttpServletResponseå¯¹è±¡æ·»åŠ å“åº”å¤´ï¼ˆAccess-Control-Allow-Originï¼‰æ¥æˆæƒåŸå§‹åŸŸï¼Œè¿™é‡ŒOriginçš„å€¼ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºâ€*â€ ï¼Œè¡¨ç¤ºå…¨éƒ¨æ”¾è¡Œã€‚ 123456@RequestMapping(&quot;/hello&quot;)@ResponseBodypublic String index(HttpServletResponse response)&#123; response.addHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;); return &quot;Hello World&quot;;&#125; Nginxé…ç½®è·¨åŸŸ1234567891011121314151617181920upstream server &#123; server 127.0.0.1:8091;&#125;server &#123; listen 80; server_name domain.com; location ^~/api &#123; //æ·»åŠ è·¨åŸŸè¯·æ±‚å¤´ proxy_set_header Access-Control-Allow-Origin *; proxy_set_header Access-Control-Allow-Methods *; proxy_set_header Access-Control-Allow-Headers *; if ($request_method = &#x27;OPTIONS&#x27;) &#123; return 204; &#125; rewrite ^/api/(.+?)$ /$1 break; proxy_pass http://server; &#125;&#125;","tags":[{"name":"è·¨åŸŸ","slug":"è·¨åŸŸ","permalink":"https://gcdd1993.github.io/tags/%E8%B7%A8%E5%9F%9F/"}]},{"title":"è§£å†³Spring Securityè‡ªå®šä¹‰filteré‡å¤æ‰§è¡Œé—®é¢˜","date":"2019-01-14T11:29:51.000Z","path":"p/356/","text":"ä»Šå¤©åšé¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°æ¯æ¬¡æ‹¦æˆªå™¨æ—¥å¿—éƒ½ä¼šæ‰“ä¸¤éï¼Œå¾ˆçº³é—·ï¼Œæ€€ç–‘æ˜¯Filterè¢«æ‰§è¡Œäº†ä¸¤éã€‚ç»“æœdebugä¹‹åå‘ç°è¿˜çœŸæ˜¯ï¼è®°å½•ä¸€ä¸‹è¿™ä¸ªç¥å¥‡çš„BUGï¼ é—®é¢˜æè¿°é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Spring-securityä½œä¸ºæƒé™æ¡†æ¶ï¼Œç„¶ååšäº†ä¸€ä¸ªJwtAuthenticationTokenFilterä½œä¸ºæ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚ï¼Œæ ¡éªŒTokenï¼Œä½†æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰“ä¸¤éæ—¥å¿—ã€‚ä¸‹é¢æ˜¯ç²¾ç®€çš„æºä»£ç : è‡ªå®šä¹‰çš„Filterç±» 1234567891011121314151617@Slf4j@Componentpublic class JwtAuthenticationTokenFilter extends OncePerRequestFilter &#123; @Override protected void doFilterInternal( HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException &#123; //...çœç•¥ //æ‰“å‡ºä¸¤éæ—¥å¿—çš„åœ°æ–¹ log.info(&quot;User:&#123;&#125; request path:&#123;&#125;, method:&#123;&#125;, param:&#123;&#125;&quot;, username, request.getServletPath(), request.getMethod(), request.getParameterMap() == null ? null : OBJECT_MAPPER.writeValueAsString(request.getParameterMap())); //...çœç•¥ chain.doFilter(request, response); &#125;&#125; WebSecurityConfigé…ç½®ç±» 123456789101112131415161718@Configuration@EnableWebSecurity@EnableGlobalMethodSecurity(prePostEnabled = true)public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123; //...çœç•¥ @Bean public JwtAuthenticationTokenFilter authenticationTokenFilterBean() throws Exception &#123; return new JwtAuthenticationTokenFilter(); &#125; @Override protected void configure(HttpSecurity httpSecurity) throws Exception &#123; //...çœç•¥ //æŠŠJwtAuthenticationTokenFilteråŠ å…¥åˆ°RememberMeAuthenticationFilterä¹‹å‰ httpSecurity.addFilterBefore(authenticationTokenFilterBean(), RememberMeAuthenticationFilter.class); &#125; //...çœç•¥&#125; è¯·æ±‚æ—¥å¿—å¦‚ä¸‹: é—®é¢˜è§£å†³æŠŠè‡ªå®šä¹‰FilterJwtAuthenticationTokenFilterçš„@Componentå–æ¶ˆæ‰å°±å¯ä»¥äº†ï¼Œä¸è®©å®ƒè¢«Springå®¹å™¨ç®¡ç†ã€‚ åŸå› åœ¨springå®¹å™¨æ‰˜ç®¡çš„OncePerRequestFilterçš„beanï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ å…¥åˆ°servletçš„filter chainï¼Œè€Œä¸Šé¢çš„å®šä¹‰ï¼Œè¿˜é¢å¤–æŠŠfilteråŠ å…¥åˆ°äº†spring securityçš„ememberMeAuthenticationFilterä¹‹å‰ã€‚è€Œspring securityä¹Ÿæ˜¯ä¸€ç³»åˆ—çš„filterï¼Œåœ¨mvcçš„filterä¹‹å‰æ‰§è¡Œã€‚å› æ­¤åœ¨é‰´æƒé€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå…ˆåå„æ‰§è¡Œä¸€æ¬¡ã€‚ å‚è€ƒèµ„æ–™è§£å†³spring securityè‡ªå®šä¹‰filteré‡å¤æ‰§è¡Œé—®é¢˜","tags":[{"name":"Spring-Security","slug":"Spring-Security","permalink":"https://gcdd1993.github.io/tags/Spring-Security/"}]},{"title":"Spring Cloud feignä½¿ç”¨okhttp3","date":"2019-01-13T16:13:04.000Z","path":"p/7382/","text":"spring cloud feignä½¿ç”¨okhttp3 æŒ‡å—maven 1234&lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®æ–‡ä»¶ 12feign.httpclient.enabled=falsefeign.okhttp.enabled=true é…ç½® 12345678910111213141516171819@Configuration@ConditionalOnClass(Feign.class)@AutoConfigureBefore(FeignAutoConfiguration.class)public class FeignOkHttpConfig &#123; @Autowired OkHttpLoggingInterceptor okHttpLoggingInterceptor; @Bean public okhttp3.OkHttpClient okHttpClient()&#123; return new okhttp3.OkHttpClient.Builder() .readTimeout(60, TimeUnit.SECONDS) .connectTimeout(60, TimeUnit.SECONDS) .writeTimeout(120, TimeUnit.SECONDS) .connectionPool(new ConnectionPool()) // .addInterceptor(); .build(); &#125;&#125; å®è·µä¸éœ€è¦é¢å¤–ç¼–å†™FeignOkHttpConfigï¼Œfeignæœ¬èº«å·²ç»å­˜åœ¨FeignOkHttpAutoConfigurationäº†ï¼Œä¸éœ€è¦é¢å¤–é…ç½®ã€‚","tags":[{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://gcdd1993.github.io/tags/Spring-Cloud/"}]},{"title":"Spring-Cloudå¾®æœåŠ¡è¸©å‘è®°å½•","date":"2019-01-13T16:08:58.000Z","path":"p/61811/","text":"è®°å½•åœ¨å¼€å‘å¾®æœåŠ¡è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚ No Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-netflix-ribbon?@feignclientå’Œ@requestmappingæ··ç”¨çš„æ—¶å€™å‡ºé”™é‡å†™springmvcæ‰«æcontrolleræ—¶ä¸å¸¦æœ‰@feignclientæ‰å®ä¾‹åŒ– 123456789101112131415161718192021@Configuration@ConditionalOnClass(&#123;Feign.class&#125;)public class FeignConfiguration &#123; @Bean public WebMvcRegistrations feignWebRegistrations() &#123; return new WebMvcRegistrationsAdapter() &#123; @Override public RequestMappingHandlerMapping getRequestMappingHandlerMapping() &#123; return new FeignRequestMappingHandlerMapping(); &#125; &#125;; &#125; private static class FeignRequestMappingHandlerMapping extends RequestMappingHandlerMapping &#123; @Override protected boolean isHandler(Class&lt;?&gt; beanType) &#123; return super.isHandler(beanType) &amp;&amp; !AnnotatedElementUtils.hasAnnotation(beanType, FeignClient.class); &#125; &#125;&#125; SpringCloudä½¿ç”¨Zuulå‡ºç°â€œForwarding errorâ€é”™è¯¯è§£å†³æ–¹æ³•åœ¨application.ymlä¸­æ·»åŠ ribbonçš„è¶…æ—¶æ—¶é—´è®¾ç½®ï¼š 1234567891011121314ribbon: ReadTimeout: 3000 ConnectTimeout: 3000zuul: host: connect-timeout-millis: 3000 socket-timeout-millis: 3000hystrix: command: default: execution: isolation: thread: timeout-in-milliseconds: 3000","tags":[{"name":"Spring-Cloud","slug":"Spring-Cloud","permalink":"https://gcdd1993.github.io/tags/Spring-Cloud/"}]},{"title":"æˆ‘çš„JAVAç¯å¢ƒæ­å»º","date":"2019-01-12T17:15:13.000Z","path":"p/12106/","text":"æ¯æ¬¡é‡è£…ç³»ç»Ÿåçš„å¼€å‘ç¯å¢ƒæ­å»ºï¼Œæ€»æ˜¯ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ç²¾åŠ›ï¼Œè½¯ä»¶ä¸‹è½½å®‰è£…å•¦ï¼Œé…ç½®ä¿®æ”¹å•¦ç­‰ç­‰ï¼Œç´¢æ€§æŠŠè¿™äº›æµç¨‹è®°å½•ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæ—¶é—´å°±æ˜¯é‡‘é’±ã€‚ è½¯ä»¶åˆ—è¡¨ JDK1.8 IntelliJ IDEA Navicatæ•°æ®åº“ç®¡ç†å·¥å…· Postman Git SourceTree XShell5 DevCenter(cassandraæ•°æ®åº“ç®¡ç†å·¥å…·) RedisDesktopManager(redisç®¡ç†å·¥å…·) è¿™äº›å·¥å…·å·²ç»å¯ä»¥æ»¡è¶³æˆ‘çš„æ—¥å¸¸å·¥ä½œäº†ï¼Œä»€ä¹ˆå°è±¡ç¬”è®°ï¼ŒmarkdownPad2ç­‰ç­‰ä¸åŒ…å«äºæ­¤ã€‚è¿™äº›éƒ½å¯ä»¥åœ¨æˆ‘çš„åšå®¢ä¸‹è½½åˆ° -&gt; å¸¸ç”¨è½¯ä»¶é›†åˆ è½¯ä»¶é…ç½®IntelliJ IDEAç ´è§£IntelliJ IDEA æ³¨å†Œç  ä¸»é¢˜å½“ç„¶æ˜¯é€‰é»‘è‰²ä¸»é¢˜äº†ï¼Œæ¯•ç«Ÿæå€¡ä¿æŠ¤çœ¼ç›ã€‚ å­—ä½“æˆ‘ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å­—ä½“+14å·å¤§å°ã€‚ è®¾ç½®ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯keymapç”±äºä»¥å‰ç”¨æƒ¯äº†Eclipse,æ‰€ä»¥è¿˜å¾—æ”¹ä¸ºEclipseçš„å¿«æ·é”® ä»£ç è‡ªåŠ¨æç¤ºä¸åŒºåˆ†å¤§å°å†™è¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼Œæ¯•ç«Ÿè°ä¹Ÿä¸å¯èƒ½æ— æ—¶æ— åˆ»æ³¨æ„å¤§å°å†™ï¼Œåˆ°æ—¶å€™ä¸å¿«æ·æç¤ºå°±æµªè´¹å¤ªå¤šæ—¶é—´äº†ï¼Œä¹Ÿå½±å“å¼€å‘ä½“éªŒã€‚ è‡ªåŠ¨å¯¼å…¥åŒ…å’Œå¯¼å…¥åŒ…ä¼˜åŒ–çš„è®¾ç½® Javaä»£ç é»˜è®¤æ³¨é‡Šä¸€èˆ¬åˆ›å»ºä¸€ä¸ªjavaç±»çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šåˆ›å»ºè€…ä»¥åŠåˆ›å»ºæ—¶é—´ æ³¨é‡Šä»£ç å¯ä»¥è‡ªå·±å†³å®šï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­: 1234/** * @author gaochen * @date $&#123;DATE&#125; */ ç„¶ååˆ›å»ºçš„ç±»æ˜¯è¿™æ ·çš„: 1234/** * @author gaochen * @date 2019/1/31 */ IntelliJ IDEAå¯åŠ¨è®¾ç½®ä¸é»˜è®¤æ‰“å¼€å‰ä¸€ä¸ªé¡¹ç›® IntelliJ IDEAå¸¸ç”¨æ’ä»¶ .ignore:è‡ªåŠ¨ç”Ÿæˆ.ignoreæ–‡ä»¶ï¼Œå¹¶æ”¯æŒä¸€é”®æ·»åŠ æ–‡ä»¶åˆ°.ignoreåˆ—è¡¨ Grep Console:åœ¨æ§åˆ¶å°æ”¯æŒç­›é€‰ï¼Œç±»ä¼¼shellå‘½ä»¤çš„cat 1.txt | grep â€˜11â€™ Lombok plugin:ä½¿ç”¨lombokå¿…é¡»è¦è£…çš„ä¸€ä¸ªæ’ä»¶ CodeGlance:ä»£ç ç¼–è¾‘åŒºè¿·ä½ ç¼©æ”¾å›¾æ’ä»¶ï¼Œéå¸¸å¥½ç”¨ HighlightBracketPair:è‡ªåŠ¨åŒ–é«˜äº®æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨ä»£ç å—å¯¹åº”çš„æ‹¬å·ï¼Œå¯ä»¥å®šåˆ¶é¢œè‰²å’Œå½¢çŠ¶ï¼Œå†ä¹Ÿä¸æ€•çœ‹ä»£ç çœ‹åˆ°çœ¼èŠ±äº† Rainbow Brackets:å½©è‰²æ˜¾ç¤ºæ‰€æœ‰æ‹¬å·,æœ‰ç‚¹ç±»ä¼¼ä¸Šä¸€ä¸ª Alibaba Java Coding Guidelines:é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œé…å¥—æ’ä»¶ï¼Œä¸€é”®æ‰«æå¸®ä½ ä¼˜åŒ–ä»£ç ã€‚ Codotaï¼šè®©ä»£ç æç¤ºæ›´åŠ æ™ºèƒ½ï¼ˆåªæ”¯æŒJavaï¼‰ Navicatç ´è§£Navicat Premium 12.0.18 / 12.0.24å®‰è£…ä¸æ¿€æ´» å‚è€ƒèµ„æ–™ Intellij IDEAæ’ä»¶æ¨è","tags":[{"name":"Java","slug":"Java","permalink":"https://gcdd1993.github.io/tags/Java/"}]},{"title":"EntityManagerçš„Clearæ–¹æ³•çš„ä½¿ç”¨","date":"2019-01-11T14:37:28.000Z","path":"p/12153/","text":"åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœä½¿ç”¨hibernateçš„è¯ï¼Œå¸¸å¸¸ä¼šè¢«hibernateçš„äº‹åŠ¡æå¾—ç„¦å¤´çƒ‚é¢ã€‚ä»Šå¤©è§£å†³äº†ä¹‹å‰é¡¹ç›®ä¸­ä¸€ç›´å­˜åœ¨çš„é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ã€‚ é—®é¢˜æè¿°æœ‰ä¸€å¼ è¡¨TemplateCopy,å¦‚ä¸‹ 12345678910111213141516public class TemplateCopy &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; private String name; private String description; @OneToMany(mappedBy = &quot;template&quot;) private Set&lt;SubDomainWeightsCopy&gt; subDomainWeights; @OneToMany(mappedBy = &quot;template&quot;) private Set&lt;QuestionWeightsCopy&gt; questionWeights;&#125; å…³è”äº†ä¸¤å¼ è¡¨: 1234567891011121314151617181920212223public class SubDomainWeightsCopy &#123; @JsonIgnore @Id @ManyToOne @JoinColumn(name = &quot;template_id&quot;) private TemplateCopy template; @Id @ManyToOne @JoinColumn(name = &quot;sub_domain_id&quot;) private SubDomainCopy subDomain; private BigDecimal weights; //æƒé‡ private BigDecimal score; @Data public static class RelationId implements Serializable &#123; private Integer template; private Integer subDomain; &#125;&#125; 1234567891011121314151617181920212223public class QuestionWeightsCopy implements IWeightsValue &#123; @JsonIgnore @Id @ManyToOne @JoinColumn(name = &quot;template_id&quot;) private TemplateCopy template; @Id @ManyToOne @JoinColumn(name = &quot;question_id&quot;) private QuestionCopy question; private BigDecimal weights; private BigDecimal score; @Data public static class RelationId implements Serializable &#123; private Integer template; private Integer question; &#125;&#125; ç®€å•çš„çœ‹ä¸€ä¸‹ï¼ŒTemplateCopyä¸­æœ‰ä¸€å †SubDomainWeightsCopyï¼Œå’Œä¸€å †QuestionWeightsCopyï¼Œæˆ‘ä»¬åœ¨ä¿å­˜TemplateCopyçš„æ—¶å€™ï¼Œé€šå¸¸æŒ‰ç…§å¦‚ä¸‹æ¥ä¿å­˜ 123451. templateCopy = save(TemplateCopy)2. QuestionWeightsCopy.setTemplateCopy(templateCopy)3. save(QuestionWeightsCopy)4. SubDomainWeightsCopy.setTemplateCopy(templateCopy)5. save(SubDomainWeightsCopy) åˆ°è¿™å°±å¥½äº†ï¼Œæ•°æ®åº“å·²ç»ä¿å­˜äº†å…³è”å…³ç³»ã€‚ä½†æ˜¯ï¼Œè¿™æ—¶å€™å¦‚æœè¿”å›saveå¥½çš„templateCopyï¼ŒsubDomainWeightså’ŒquestionWeightså°†ä¼šæ˜¯nullã€‚ é—®é¢˜è§£å†³ä½¿ç”¨EntityManagerçš„clearæ–¹æ³• ä¿å­˜å®Œæ¯•åï¼Œæ‰§è¡ŒentityManager.clear(); ç„¶åå†æ¬¡æŸ¥è¯¢è¯¥å¯¹è±¡ï¼Œå³å¯å®Œæ•´è¿”å›è¯¥å¯¹è±¡ã€‚ EntityManager clearçš„ä½œç”¨ï¼ŸEntityManager clearæ–¹æ³•ä¼šæ¸…ç©ºå…¶å…³è”çš„ç¼“å­˜ï¼Œä»è€Œå¼ºåˆ¶åœ¨äº‹åŠ¡ä¸­ç¨åæ‰§è¡Œæ–°çš„æ•°æ®åº“æŸ¥è¯¢ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨EntityManager clear åœ¨è¿›è¡Œæ‰¹å¤„ç†æ—¶ï¼Œä¸ºäº†é¿å…å·¨å¤§çš„ç¼“å­˜å ç”¨å†…å­˜å¹¶å› é•¿æ—¶é—´çš„è„æ£€æŸ¥è€Œå¢åŠ åˆ·æ–°çš„æ—¶é—´ åœ¨è¿›è¡ŒDMLæˆ–SQLæŸ¥è¯¢æ—¶ï¼Œå®ƒå°†å®Œå…¨ç»•è¿‡å®ä½“ç®¡ç†å™¨ç¼“å­˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºç¼“å­˜ï¼Œå°†ä¸ä¼šå®é™…å»æ•°æ®åº“æŸ¥ï¼Œä¼šç›´æ¥å°†ç¼“å­˜è¿”å›ã€‚æ‰€ä»¥é€ æˆäº†æ•°æ®åº“å·²ç»ä¿å­˜äº†ï¼Œä½†æ˜¯æŸ¥å‡ºæ¥è¿˜æ˜¯æœªä¿å­˜çš„çŠ¶æ€ã€‚è¿™æ—¶å€™éœ€è¦æ¸…é™¤ç¼“å­˜ä»¥é¿å…è¿™ç§ä¸ä¸€è‡´ã€‚(æœ¬æ¡ˆä¾‹å°±æ˜¯è¿™ç§æƒ…å†µçš„å®é™…ä¾‹å­) å‚è€ƒStackOverFlowå¤§ç¥å›ç­”","tags":[{"name":"Spring","slug":"Spring","permalink":"https://gcdd1993.github.io/tags/Spring/"}]},{"title":"Postmanä½¿ç”¨æŠ€å·§","date":"2019-01-11T06:13:35.000Z","path":"p/4537/","text":"Postmanæ˜¯ä»€ä¹ˆPostmanæ˜¯chromeçš„ä¸€æ¬¾æ’ä»¶,ç”¨äºåšæ¥å£è¯·æ±‚æµ‹è¯•,æ— è®ºæ˜¯å‰ç«¯,åå°è¿˜æ˜¯æµ‹è¯•äººå‘˜,éƒ½å¯ä»¥ç”¨postmanæ¥æµ‹è¯•æ¥å£,ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚ Postmanå®‰è£…å®˜ç½‘ä¸‹è½½(ç¿»å¢™)https://www.getpostman.com/downloads/ è“å¥äº‘https://www.lanzous.com/i2en5xc Postmanå¸¸ç”¨åŠŸèƒ½å®‰è£…å¥½ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€Postmanï¼Œå¯ä»¥çœ‹åˆ°ç•Œé¢åˆ†æˆå·¦å³ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³è¾¹æ˜¯æˆ‘ä»¬åå¤´è¦è®²çš„collectionï¼Œå·¦è¾¹æ˜¯ç°åœ¨è¦è®²çš„request builderã€‚åœ¨request builderä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Postmanå¿«é€Ÿçš„éšæ„ç»„è£…å‡ºæˆ‘ä»¬å¸Œæœ›çš„requestã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€æœ‰çš„HTTP Requestéƒ½åˆ†æˆ4ä¸ªéƒ¨åˆ†ï¼ŒURL, method, headerså’Œbodyã€‚è€ŒPostmané’ˆå¯¹è¿™å‡ éƒ¨åˆ†éƒ½æœ‰é’ˆå¯¹æ€§çš„å·¥å…·ã€‚ URLè¦ç»„è£…ä¸€æ¡Request, URLæ°¸è¿œæ˜¯ä½ é¦–å…ˆè¦å¡«çš„å†…å®¹ï¼Œåœ¨Postmané‡Œé¢ä½ æ›¾è¾“å…¥è¿‡çš„URLæ˜¯å¯ä»¥é€šè¿‡ä¸‹æ‹‰è‡ªåŠ¨è¡¥å…¨çš„å“¦ã€‚å¦‚æœä½ ç‚¹å‡»ParamsæŒ‰é’®ï¼ŒPostmanä¼šå¼¹å‡ºä¸€ä¸ªé”®å€¼ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥åœ¨å“ªé‡Œè¾“å…¥URLçš„Parameterï¼ŒPostmanä¼šå¸®ä½ è‡ªåŠ¨åŠ å…¥åˆ°URLå½“ä¸­ï¼Œåä¹‹ï¼Œå¦‚æœä½ çš„URLå½“ä¸­å·²ç»æœ‰äº†å‚æ•°ï¼Œé‚£Postmanä¼šåœ¨ä½ æ‰“å¼€é”®å€¼ç¼–è¾‘å™¨çš„æ—¶å€™æŠŠå‚æ•°è‡ªåŠ¨è½½å…¥ Headersç‚¹å‡»â€™Headersâ€™æŒ‰é’®ï¼ŒPostmanåŒæ ·ä¼šå¼¹å‡ºä¸€ä¸ªé”®å€¼ç¼–è¾‘å™¨ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥éšæ„æ·»åŠ ä½ æƒ³è¦çš„Header attributeï¼ŒåŒæ ·Postmanä¸ºæˆ‘ä»¬é€šè¿‡äº†å¾ˆè´´å¿ƒçš„auto-completeåŠŸèƒ½ï¼Œæ•²å…¥ä¸€ä¸ªå­—æ¯ï¼Œä½ å¯ä»¥ä»ä¸‹æ‹‰èœå•é‡Œé€‰æ‹©ä½ æƒ³è¦çš„æ ‡å‡†atrribute Methodè¦é€‰æ‹©Requestçš„Methodæ˜¯å¾ˆç®€å•çš„ï¼ŒPostmanæ”¯æŒæ‰€æœ‰çš„Methodï¼Œè€Œä¸€æ—¦ä½ é€‰æ‹©äº†Methodï¼ŒPostmançš„request bodyç¼–è¾‘å™¨ä¼šæ ¹æ®çš„ä½ é€‰æ‹©ï¼Œè‡ªåŠ¨çš„å‘ç”Ÿæ”¹å˜ã€‚ Request Bodyå¦‚æœæˆ‘ä»¬è¦åˆ›å»ºçš„requestæ˜¯ç±»ä¼¼äºPOSTï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç¼–è¾‘Request Bodyï¼ŒPostmanæ ¹æ®body typeçš„ä¸åŒï¼Œæä¾›äº†4ä¸­ç¼–è¾‘æ–¹å¼ï¼š form-data x-www-form-urlencoded raw binary ï¼ˆæˆ‘ä»¬è¿™é‡Œæ˜¯å¯ä»¥ä¼ æ–‡ä»¶çš„å“¦ï¼‰ postmané«˜çº§ç”¨æ³•colletions(æ¥å£é›†åˆ)åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¤šé¡¹ç›®åŒæ—¶å¼€å‘ç»´æŠ¤çš„æƒ…å†µï¼ŒPostmanå‹å¥½çš„æä¾›äº†colletionsåŠŸèƒ½ï¼Œç±»ä¼¼ä¸é¡¹ç›®æ–‡ä»¶å¤¹ä¸€æ ·ï¼Œå¯ä»¥æŠŠå½’å±äºåŒä¸€ç±»çš„æ¥å£åˆ†ç±»åˆ°ä¸€èµ·ï¼Œä¾¿äºç®¡ç†ç»´æŠ¤ã€‚ ç‚¹å‡»NEW -&gt; é€‰æ‹©collectionï¼Œåˆ›å»ºä¸€ä¸ªé¡¹ç›®ç©ºé—´ã€‚ è¾“å…¥é¡¹ç›®åç§°ï¼Œç‚¹å‡»createã€‚ colletions folder(é›†åˆä¸­çš„æ–‡ä»¶å¤¹)æ¯ä¸ªé¡¹ç›®ä¼šæœ‰å¤šä¸ªæ¥å£ï¼Œæœ‰äº›æ˜¯ä¸€ç±»åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·ç®¡ç†æ¥å£ï¼Œæ–‡ç« åˆ—è¡¨æ¥å£ï¼ŒPostmanæä¾›folderç›®å½•æ¥è¿›è¡Œç»†è‡´çš„åˆ†ç±»ã€‚ é€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œç‚¹å‡»Add Folder è¾“å…¥ç›®å½•åç§°ï¼Œç‚¹å‡»create æ¯ä¸ªæ¥å£éƒ½å¯ä»¥å½’ç±»åˆ°æŸä¸ªé¡¹ç›®ï¼Œæˆ–æŸä¸ªé¡¹ç›®çš„å­ç›®å½•ä¸­ã€‚ Environment(ç¯å¢ƒå˜é‡)Postmanå…è®¸å®šä¹‰è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼ˆEnvironmentï¼‰ï¼Œæœ€å¸¸è§çš„æ˜¯å°†æµ‹è¯• URL è¿›è¡Œå®šä¹‰æˆå˜é‡çš„å½¢å¼ï¼Œè¿™æ ·éšç€ä½ çš„åŸŸåæ€ä¹ˆå˜ï¼ŒURL å°±ä¸ç”¨å˜æ›´ï¼Œéå¸¸æ–¹ä¾¿ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›æ•æ„Ÿçš„æµ‹è¯•å€¼å®šä¹‰ä¸ºç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚å¯†ç ã€‚æ¥ä¸‹æ¥ï¼Œæ¥çœ‹ä¸‹æ€ä¹ˆæ–°å»ºä¸€ç»„ç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹æ“ä½œæ‰“å¼€ç¯å¢ƒå˜é‡çš„ç®¡ç†å…¥å£ï¼š æ‰“å¼€ç®¡ç†ç¯å¢ƒå˜é‡çš„çª—å£ï¼Œè¾“å…¥åç§°ï¼Œæ·»åŠ ä¸€ç»„é”®å€¼å¯¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¯å¢ƒå˜é‡è¦ä»¥åŒå¤§æ‹¬å·çš„æ–¹å¼æ¥å¼•ç”¨ï¼Œå¯ä»¥åœ¨å³ä¸Šæ–¹ä¸‹æ‹‰æ¡†å¤„é€‰æ‹©ç›¸åº”çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å®æµ‹ä¸€ä¸‹åˆšæ‰æ·»åŠ çš„Urlçš„å˜é‡ï¼š é€šè¿‡è„šæœ¬è®¾ç½®å˜é‡Postmanå…è®¸ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ï¼Œå¹¶æä¾›äº†ä¸¤ç§ç±»å‹çš„è„šæœ¬ï¼š Pre-request Scriptï¼šæ‰§è¡Œrequestè¯·æ±‚å‰å…ˆè¿è¡Œï¼Œå¯ä»¥åœ¨é‡Œé¢é¢„å…ˆè®¾ç½®äº›æ‰€éœ€å˜é‡ Testsï¼šrequestè¿”å›åæ‰§è¡Œçš„,å¯ä»¥å¯¹è¿”å›ä¿¡æ¯è¿›è¡Œæå–è¿‡æ»¤ï¼Œæˆ–è€…æ‰§è¡Œä¸€äº›éªŒè¯æ“ä½œ ä¾‹å­è·å–å¦‚ä¸‹è¿”å›ä¿¡æ¯ä¸­çš„user_idå€¼: 123456789101112// å‡è®¾æœåŠ¡ç«¯è¿”å›çš„Bodyå†…å®¹å¦‚ä¸‹:&#123; &quot;token&quot;: &#123; &quot;user_id&quot;: &quot;2079876912&quot;, &quot;access_token&quot;: &quot;26A90E317DBC1AD363B2E2CE53F76F2DD85CB172DF7D813099477BAACB69DC49C794BAECEDC68331&quot;, &quot;expires_at&quot;: &quot;2016-06-22T12:46:51.637+0800&quot;, &quot;refresh_token&quot;: &quot;26A90E317DBC1AD3CD1556CF2B3923DD60AEBADDCBC1D9D899262A55D15273F735E407A6BEC56B84&quot;, &quot;mac_key&quot;: &quot;4FAhd4OpfC&quot;, &quot;mac_algorithm&quot;: &quot;hmac-sha-256&quot;, &quot;server_time&quot;: &quot;2016-06-15T12:46:51.649+0800&quot; &#125;&#125; åœ¨Testsä¸­å¯¹user_idå€¼è¿›è¡Œæå–å¹¶èµ‹å€¼æˆå…¨å±€å˜é‡: 1234567891011// åˆ¤æ–­æ˜¯å¦å­˜åœ¨&#x27;user_id&#x27;å€¼tests[&quot;Body contains user_id&quot;] = responseBody.has(&quot;user_id&quot;);if(tests[&quot;Body contains user_id&quot;])&#123; // å°†è¿”å›ä¿¡æ¯è§£ææˆå¯¹è±¡ var responseData = JSON.parse(responseBody); tests[&quot;value_user_id&quot;]=responseData.token.user_id // è®¾ç½®å…¨å±€å˜é‡ postman.setGlobalVariable(&quot;user_id&quot;,tests[&quot;value_user_id&quot;]);&#125;else&#123; postman.setGlobalVariable(&quot;user_id&quot;,&quot;é»˜è®¤user_id&quot;);&#125; å®è·µæ¡ˆä¾‹é¡¹ç›®æ¥å£åˆ†ç±»ç®¡ç† ç™»å½•è·å–tokenå¹¶è®¾ç½®ä¸ºå…¨å±€å˜é‡ æ¥å£ä½¿ç”¨ç™»å½•åçš„token","tags":[{"name":"å·¥å…·æŠ€å·§","slug":"å·¥å…·æŠ€å·§","permalink":"https://gcdd1993.github.io/tags/%E5%B7%A5%E5%85%B7%E6%8A%80%E5%B7%A7/"}]},{"title":"Java8æ–°ç‰¹æ€§ä¸€è§ˆè¡¨","date":"2019-01-09T12:16:58.000Z","path":"p/55630/","text":"æ€»è§ˆ forEach() method in Iterable interface(Iterableæ¥å£ä¸­çš„forEach()æ–¹æ³•) default and static methods in Interfaces(æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•) Functional Interfaces and Lambda Expressions(functionæ¥å£å’ŒLambdaè¡¨è¾¾å¼) Java Stream API for Bulk Data Operations on Collections(ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java Stream API) Java Time API Collection API improvements Concurrency API improvements Java IO improvements 1.forEach() method in Iterable interface(Iterableæ¥å£ä¸­çš„forEach()æ–¹æ³•)æ¯å½“æˆ‘ä»¬éœ€è¦éå†Collectionæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªIteratorï¼Œå…¶ç›®çš„æ˜¯è¿­ä»£ï¼Œç„¶åæˆ‘ä»¬åœ¨å¾ªç¯ä¸­ä¸ºCollectionä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ConcurrentModificationExceptionã€‚ Java 8åœ¨java.lang.Iterableæ¥å£ä¸­å¼•å…¥äº†forEachæ–¹æ³•ï¼Œè¿™æ ·åœ¨ç¼–å†™ä»£ç æ—¶æˆ‘ä»¬åªå…³æ³¨ä¸šåŠ¡é€»è¾‘ã€‚ forEachæ–¹æ³•å°†java.util.function.Consumerå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå› æ­¤å®ƒæœ‰åŠ©äºå°†æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨æˆ‘ä»¬å¯ä»¥é‡ç”¨çš„å•ç‹¬ä½ç½®ã€‚è®©æˆ‘ä»¬é€šè¿‡ç®€å•çš„ä¾‹å­çœ‹çœ‹æ¯ä¸ªç”¨æ³•ã€‚ 12345678910111213141516171819202122232425List&lt;IntegermyList = new ArrayList&lt;Integer&gt;();for(int i=0; i&lt;10; i++) myList.add(i);//ä½¿ç”¨iteratorIterator&lt;Integeriterator = myList.iterator();while (iterator.hasNext()) &#123; Integer next = iterator.next(); System.out.println(&quot;Iterator Value::&quot; + next);&#125;//foreach + åŒ¿åç±»myList.forEach(new Consumer&lt;Integer&gt;() &#123; public void accept(Integer t) &#123; System.out.println(&quot;forEach anonymous class Value::&quot;+t); &#125;&#125;);//ä½¿ç”¨consumer æ¥å£MyConsumer action = new MyConsumer();myList.forEach(action);//ä½¿ç”¨lambdaè¡¨è¾¾å¼myList.forEach(System.out::println); 2.default and static methods in Interfaces(æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•)jdk8ä¹‹å‰ï¼Œinterfaceæ–¹æ³•ä¸èƒ½æœ‰å®ç°ï¼Œä½†æ˜¯ä»Java 8å¼€å§‹ï¼Œæ¥å£è¢«å¢å¼ºä¸ºå…·æœ‰å®ç°æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨defaultå’Œstaticå…³é”®å­—æ¥åˆ›å»ºå…·æœ‰æ–¹æ³•å®ç°çš„æ¥å£ã€‚ä¾‹å¦‚Iterableæ¥å£ä¸­çš„forEachæ–¹æ³•å®ç°æ˜¯ 123456default void forEach(Consumer&lt;? super Taction) &#123; Objects.requireNonNull(action); for (T t : this) &#123; action.accept(t); &#125;&#125; ç¤ºä¾‹ä»£ç åˆ›å»ºä¸€ä¸ªæ¥å£ 123456789101112public interface MyInterface &#123; void show(); default void showA() &#123; System.out.println(&quot;æˆ‘æ˜¯æ¥å£é»˜è®¤æ–¹æ³•&quot;); &#125; static void showB() &#123; System.out.println(&quot;æˆ‘æ˜¯æ¥å£é™æ€æ–¹æ³•&quot;); &#125;&#125; åˆ›å»ºè¯¥æ¥å£å®ç°ç±» 1234567891011121314public class MyClass implements MyInterface &#123; @Override public void show() &#123; System.out.println(&quot;æˆ‘æ˜¯å®ç°æ–¹æ³•&quot;); &#125; //é»˜è®¤æ–¹æ³•æ”¯æŒé‡å†™,ä¸è¦†ç›–åˆ™æ‰§è¡Œæ¥å£çš„é»˜è®¤æ–¹æ³• @Override public void showA() &#123; System.out.println(&quot;æˆ‘è¦†ç›–äº†æ¥å£çš„é»˜è®¤æ–¹æ³•&quot;); &#125; //é™æ€æ–¹æ³•ä¸å¯ä»¥é‡å†™&#125; æµ‹è¯• 123456789public class Test &#123; public static void main(String[] args) &#123; MyClass myClass = new MyClass(); myClass.show(); myClass.showA(); //é€šè¿‡ç±»å.æ–¹æ³•åè°ƒç”¨æ¥å£é™æ€æ–¹æ³• MyInterface.showB(); &#125;&#125; 3.Functional Interfaces and Lambda Expressionsï¼ˆfunctionæ¥å£å’ŒLambdaè¡¨è¾¾å¼ï¼‰å¦‚æœä½ æ³¨æ„åˆ°ä¸Šé¢çš„æ¥å£ä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ°@FunctionalInterfaceæ³¨é‡Šã€‚åŠŸèƒ½æ¥å£æ˜¯Java 8ä¸­å¼•å…¥çš„æ–°æ¦‚å¿µã€‚åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å°±å˜æˆäº†åŠŸèƒ½æ¥å£ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨@FunctionalInterfaceæ³¨é‡Šå°†æ¥å£æ ‡è®°ä¸ºåŠŸèƒ½æ¥å£ã€‚ @FunctionalInterfaceæ³¨é‡Šæ˜¯ä¸€ç§é¿å…åœ¨åŠŸèƒ½ç•Œé¢ä¸­æ„å¤–æ·»åŠ æŠ½è±¡æ–¹æ³•çš„å·¥å…·ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸º@Overrideæ³¨é‡Šï¼Œå¹¶ä¸”æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å®ƒã€‚å®ä¾‹ï¼šjava8 çš„runnable runæ¥å£ï¼Œå¸¦æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•: 1234@FunctionalInterfacepublic interface Runnable &#123; public abstract void run();&#125; åŠŸèƒ½æ¥å£çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥å®ä¾‹åŒ–å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ¿åç±»å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£ï¼Œä½†ä»£ç çœ‹èµ·æ¥å¾ˆç¬¨é‡ã€‚ 1234567//ä½¿ç”¨åŒ¿åç±»å®ä¾‹åŒ–Runnable runnable = new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;My Runnable&quot;); &#125;&#125;; ç”±äºåŠŸèƒ½æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤lambdaè¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°æä¾›æ–¹æ³•å®ç°ã€‚æˆ‘ä»¬åªéœ€è¦æä¾›æ–¹æ³•å‚æ•°å’Œä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼å°†ä¸Šé¢çš„å®ç°ç¼–å†™ä¸ºï¼š 1234//ä½¿ç”¨lambdaè¡¨è¾¾å¼Runnable runnable1 = () -System.out.println(&quot;My Runnable&quot;);runnable.run();runnable1.run(); å¦‚æœåœ¨æ–¹æ³•å®ç°ä¸­æœ‰å•ä¸ªè¯­å¥ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦èŠ±æ‹¬å·ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„Interface1åŒ¿åç±»å¯ä»¥ä½¿ç”¨lambdaå®ä¾‹åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12Interface1 interface1 = (s) -System.out.println(s);interface1.method1(&quot;interface1 method&quot;); lambdaè¡¨è¾¾å¼æ‰©å±•Java ä¸­çš„ Lambda è¡¨è¾¾å¼é€šå¸¸ä½¿ç”¨ (argument) -(body) è¯­æ³•ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š12(arg1, arg2...) -&gt; &#123; body &#125;(type1 arg1, type2 arg2...) -&gt; &#123; body &#125; Lambda è¡¨è¾¾å¼çš„ç»“æ„ ä¸€ä¸ªLambdaè¡¨è¾¾å¼å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•° å‚æ•°çš„ç±»å‹æ—¢å¯ä»¥æ˜ç¡®å£°æ˜ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡æ¥æ¨æ–­ã€‚ä¾‹å¦‚ï¼š(int a)ä¸(a)æ•ˆæœç›¸åŒ æ‰€æœ‰å‚æ•°éœ€åŒ…å«åœ¨åœ†æ‹¬å·å†…ï¼Œå‚æ•°ä¹‹é—´ç”¨é€—å·ç›¸éš”ã€‚ä¾‹å¦‚ï¼š(a, b) æˆ– (int a, int b) æˆ– (String a, int b, float c) ç©ºåœ†æ‹¬å·ä»£è¡¨å‚æ•°é›†ä¸ºç©ºã€‚ä¾‹å¦‚ï¼š() -&gt; 42 å½“åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸”å…¶ç±»å‹å¯æ¨å¯¼æ—¶ï¼Œåœ†æ‹¬å·ï¼ˆï¼‰å¯çœç•¥ã€‚ä¾‹å¦‚ï¼ša -&gt; return a * a Lambdaè¡¨è¾¾å¼çš„ä¸»ä½“å¯åŒ…å«é›¶æ¡æˆ–å¤šæ¡è¯­å¥ å¦‚æœLambdaè¡¨è¾¾å¼çš„ä¸»ä½“åªæœ‰ä¸€æ¡è¯­å¥ï¼ŒèŠ±æ‹¬å·{}å¯çœç•¥ã€‚åŒ¿åå‡½æ•°çš„è¿”å›ç±»å‹ä¸è¯¥ä¸»ä½“è¡¨è¾¾å¼ä¸€è‡´ å¦‚æœLambdaè¡¨è¾¾å¼çš„ä¸»ä½“åŒ…å«ä¸€æ¡ä»¥ä¸Šè¯­å¥ï¼Œåˆ™è¡¨è¾¾å¼å¿…é¡»åŒ…å«åœ¨èŠ±æ‹¬å·{}ä¸­ï¼ˆå½¢æˆä»£ç å—ï¼‰ã€‚åŒ¿åå‡½æ•°çš„è¿”å›ç±»å‹ä¸ä»£ç å—çš„è¿”å›ç±»å‹ä¸€è‡´ï¼Œè‹¥æ²¡æœ‰è¿”å›åˆ™ä¸ºç©º å‡½æ•°å¼æ¥å£æ‰©å±•å‡½æ•°å¼æ¥å£æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜çš„æ¥å£,å¯ä»¥ä½¿ç”¨@FunctionalInterfaceæ ‡è®° JDK8ä¹‹å‰å·²æœ‰çš„å‡½æ•°å¼æ¥å£ java.lang.Runnable java.util.concurrent.Callable java.security.PrivilegedAction java.util.Comparator java.io.FileFilter java.nio.file.PathMatcher java.lang.reflect.InvocationHandler java.beans.PropertyChangeListener java.awt.event.ActionListener javax.swing.event.ChangeListener æ–°å®šä¹‰çš„å‡½æ•°å¼æ¥å£java.util.functionä¸­å®šä¹‰äº†å‡ ç»„ç±»å‹çš„å‡½æ•°å¼æ¥å£ä»¥åŠé’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å­æ¥å£ã€‚ Predicate:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªboolç»“æœï¼Œæ–¹æ³•ä¸ºboolean test(T t) Consumer:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ— è¿”å›å€¼ï¼Œçº¯æ¶ˆè´¹ã€‚æ–¹æ³•ä¸ºvoid accept(T t) Function:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸ºR apply(T t) Supplier:æ— å‚æ•°ä¼ å…¥ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸ºT get() UnaryOperator:ä¸€å…ƒæ“ä½œç¬¦ï¼Œç»§æ‰¿Function,ä¼ å…¥å‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒã€‚ BinaryOperator:äºŒå…ƒæ“ä½œç¬¦ï¼Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒï¼Œç»§æ‰¿BiFunctionã€‚ ã€ç¤ºä¾‹ã€‘ 12345678910111213Predicate&lt;Integer&gt; predicate = (i) -&gt; i &gt; 0;Consumer&lt;Integer&gt; consumer = (i) -&gt; System.out.println(&quot;consumer : &quot; + i);Function&lt;Integer,Boolean&gt; function = (i) -&gt; i &gt; 0;Supplier&lt;Integer&gt; supplier = () -&gt; 1;UnaryOperator&lt;Integer&gt; unaryOperator = (i) -&gt; i * i;BinaryOperator&lt;Integer&gt; binaryOperator = (i1,i2) -&gt; i1 * i2;System.out.println(predicate.test(10));consumer.accept(10);System.out.println(function.apply(10));System.out.println(supplier.get());System.out.println(unaryOperator.apply(100));System.out.println(binaryOperator.apply(100,200)); 4.Java Stream API for Bulk Data Operations on Collections(ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java Stream API)ç¤ºä¾‹ä»£ç 123456789101112131415161718192021222324252627282930313233//ä» Collection å’Œæ•°ç»„List&lt;Integerlist = new ArrayList&lt;&gt;();for(int i=0;i&lt;100;i++) &#123; list.add(i);&#125;Stream&lt;Integerstream = list.stream(); //ä¸²è¡ŒæµStream&lt;Integerstream1 = list.parallelStream(); //å¹¶è¡ŒæµStream&lt;Integerstream2 = Arrays.stream(list.toArray(new Integer[0]));Stream&lt;Integerstream3 = Stream.of(list.toArray(new Integer[0]));//ä» BufferedReaderBufferedReader bufferedReader = new BufferedReader(new FileReader(new File(&quot;path&quot;)));Stream&lt;Stringstream4 = bufferedReader.lines();//é™æ€å·¥å‚IntStream stream5 = IntStream.rangeClosed(1, 100);//ç”Ÿæˆ1-100 çš„int streamStream&lt;Pathstream6 = Files.walk(Paths.get(&quot;path&quot;), 100);//è‡ªå·±æ„å»º é€šè¿‡StreamSupportè¾…åŠ©ç±»ä»spliteratoräº§ç”ŸæµStream&lt;Integerstream7 = StreamSupport.stream(list.spliterator(), false);//å…¶å®ƒRandom random = new Random();IntStream stream8 = random.ints();BitSet bitSet = BitSet.valueOf(new long[]&#123;1L, 2L, 3L&#125;);IntStream stream9 = bitSet.stream();Pattern pattern = Pattern.compile(&quot;\\\\d+&quot;);Stream&lt;Stringstream10 = pattern.splitAsStream(&quot;111sda123sda&quot;);JarFile jarFile = new JarFile(&quot;xxx.jar&quot;);Stream&lt;JarEntrystream11 = jarFile.stream(); 5.Java Time API(Javaæ—¶é—´API)Java 8é€šè¿‡å‘å¸ƒæ–°çš„Date-Time API (JSR 310)æ¥è¿›ä¸€æ­¥åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚å¯¹æ—¥æœŸä¸æ—¶é—´çš„æ“ä½œä¸€ç›´æ˜¯Javaç¨‹åºå‘˜æœ€ç—›è‹¦çš„åœ°æ–¹ä¹‹ä¸€ã€‚æ ‡å‡†çš„ java.util.Dateä»¥åŠåæ¥çš„java.util.Calendarä¸€ç‚¹æ²¡æœ‰æ”¹å–„è¿™ç§æƒ…å†µï¼ˆå¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®ƒä»¬ä¸€å®šç¨‹åº¦ä¸Šæ›´åŠ å¤æ‚ï¼‰ã€‚ Clockç±»å®ƒé€šè¿‡æŒ‡å®šä¸€ä¸ªæ—¶åŒºï¼Œç„¶åå°±å¯ä»¥è·å–åˆ°å½“å‰çš„æ—¶åˆ»ï¼Œæ—¥æœŸä¸æ—¶é—´ã€‚Clockå¯ä»¥æ›¿æ¢System.currentTimeMillis()ä¸TimeZone.getDefault()ã€‚ 1234// Get the system clock as UTC offset final Clock clock = Clock.systemUTC();System.out.println(clock.instant());System.out.println(clock.millis()); ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡º: 122019-01-09T14:52:50.111Z1547045570335 LocaleDateä¸LocalTimeLocaleDateåªæŒæœ‰ISO-8601æ ¼å¼ä¸”æ— æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸéƒ¨åˆ†ã€‚ç›¸åº”çš„ï¼ŒLocaleTimeåªæŒæœ‰ISO-8601æ ¼å¼ä¸”æ— æ—¶åŒºä¿¡æ¯çš„æ—¶é—´éƒ¨åˆ†ã€‚LocaleDateä¸LocalTimeéƒ½å¯ä»¥ä»Clockä¸­å¾—åˆ°ã€‚ 12345678910111213// Get the local date and local timefinal LocalDate date = LocalDate.now();final LocalDate dateFromClock = LocalDate.now(clock);System.out.println(date);System.out.println(dateFromClock);// Get the local date and local timefinal LocalTime time = LocalTime.now();final LocalTime timeFromClock = LocalTime.now(clock);System.out.println(time);System.out.println(timeFromClock); ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š 12342019-01-092019-01-0922:52:50.38314:52:50.383 LocaleDateTimeLocaleDateTimeæŠŠLocaleDateä¸LocaleTimeçš„åŠŸèƒ½åˆå¹¶èµ·æ¥ï¼Œå®ƒæŒæœ‰çš„æ˜¯ISO-8601æ ¼å¼æ— æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸä¸æ—¶é—´ã€‚ 123456// Get the local date/timefinal LocalDateTime datetime = LocalDateTime.now();final LocalDateTime datetimeFromClock = LocalDateTime.now(clock);System.out.println(datetime);System.out.println(datetimeFromClock); ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡º: 122019-01-09T22:55:05.1942019-01-09T14:55:05.194 ZonedDateTimeå¦‚æœä½ éœ€è¦ç‰¹å®šæ—¶åŒºçš„æ—¥æœŸ/æ—¶é—´ï¼Œé‚£ä¹ˆZonedDateTimeæ˜¯ä½ çš„é€‰æ‹©ã€‚å®ƒæŒæœ‰ISO-8601æ ¼å¼å…·å…·æœ‰æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸä¸æ—¶é—´ã€‚ 12345678// Get the zoned date/timefinal ZonedDateTime zonedDatetime = ZonedDateTime.now();final ZonedDateTime zonedDatetimeFromClock = ZonedDateTime.now(clock);final ZonedDateTime zonedDatetimeFromZone = ZonedDateTime.now(ZoneId.of(&quot;America/Los_Angeles&quot;));System.out.println(zonedDatetime);System.out.println(zonedDatetimeFromClock);System.out.println(zonedDatetimeFromZone); ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š 1232019-01-09T22:56:34.033+08:00[Asia/Shanghai]2019-01-09T14:56:34.033Z2019-01-09T06:56:34.035-08:00[America/Los_Angeles] Durationåœ¨ç§’ä¸çº³ç§’çº§åˆ«ä¸Šçš„ä¸€æ®µæ—¶é—´ã€‚Durationä½¿è®¡ç®—ä¸¤ä¸ªæ—¥æœŸé—´çš„ä¸åŒå˜çš„ååˆ†ç®€å•ã€‚ 1234567// Get duration between two datesfinal LocalDateTime from = LocalDateTime.of(2018, Month.APRIL, 16, 0, 0, 0);final LocalDateTime to = LocalDateTime.of(2019, Month.APRIL, 16, 23, 59, 59);final Duration duration = Duration.between(from, to);System.out.println(&quot;Duration in days: &quot; + duration.toDays());System.out.println(&quot;Duration in hours: &quot; + duration.toHours()); ä¸Šé¢çš„ä¾‹å­è®¡ç®—äº†ä¸¤ä¸ªæ—¥æœŸ2018å¹´4æœˆ16å·ä¸2019å¹´4æœˆ16å·ä¹‹é—´çš„è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š 12Duration in days: 365Duration in hours: 8783 Collection API improvements(é›†åˆAPIæ”¹è¿›)ä¸Šé¢å·²ç»å±•ç¤ºäº†forEach()æ–¹æ³•å’ŒStream APIåœ¨é›†åˆä¸Šçš„ä½¿ç”¨ã€‚java8çš„Collection APIä¸­æ·»åŠ äº†ä¸€äº›æ–°æ–¹æ³•ï¼š Iterator default method forEachRemaining(Consumer action)ä¸ºæ¯ä¸ªå…ƒç´ æ‰§è¡Œç»™å®šæ“ä½œï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½å·²å¤„ç†æˆ–æ“ä½œå¼•å‘å¼‚å¸¸ã€‚ æºç 1234567default void forEachRemaining(Consumer&lt;? super E&gt; action) &#123; //ä¼ å…¥ä¸€ä¸ªéç©ºæ¶ˆè´¹è€… Objects.requireNonNull(action); //éå†æ‰§è¡Œæ¶ˆè´¹è€…å‡½æ•° while (hasNext()) action.accept(next());&#125; ç¤ºä¾‹ä»£ç 123456List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);Iterator&lt;Integer&gt; iterator = list.iterator();//åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…Consumer&lt;Integer&gt; consumer = i -&gt; System.out.println(&quot;consumer print &quot; + i);//iteratorçš„forEachRemainingå°†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ¶ˆè´¹iterator.forEachRemaining(consumer); æ§åˆ¶å°è¾“å‡º1234consumer print 1consumer print 2consumer print 3... Collection default method removeIf(Predicate filter)åˆ é™¤æ»¡è¶³ç»™å®šæ¡ä»¶çš„æ­¤é›†åˆçš„æ‰€æœ‰å…ƒç´ ã€‚ æºç 1234567891011121314default boolean removeIf(Predicate&lt;? super E&gt; filter) &#123; //ä¼ å…¥ä¸€ä¸ªéç©ºè°“è¯­ Objects.requireNonNull(filter); boolean removed = false; final Iterator&lt;E&gt; each = iterator(); while (each.hasNext()) &#123; //éå†å…ƒç´ ï¼Œæ‰§è¡Œè°“è¯­çš„æ ¡éªŒï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™åˆ é™¤è¯¥å…ƒç´  if (filter.test(each.next())) &#123; each.remove(); removed = true; &#125; &#125; return removed;&#125; ç¤ºä¾‹ä»£ç 12345678List&lt;Integer&gt; list = new ArrayList&lt;&gt;();list.add(1);list.add(2);list.add(3);list.add(4);Predicate&lt;Integer&gt; predicate = i -&gt; i &gt; 1;list.removeIf(predicate);System.out.println(&quot;remove if left items : &quot; + list); æ§åˆ¶å°è¾“å‡º12//2,3,4æ»¡è¶³æ¡ä»¶è¢«åˆ é™¤äº†remove if left items : [1] Collection spliterator()è¿”å›Spliteratorå®ä¾‹çš„æ–¹æ³•ï¼Œè¯¥å®ä¾‹å¯ç”¨äºé¡ºåºæˆ–å¹¶è¡Œéå†å…ƒç´ ã€‚ æºç 1234//è¯¥æ–¹æ³•æ˜¯æ¥å£é»˜è®¤æ–¹æ³•default Spliterator&lt;E&gt; spliterator() &#123; return Spliterators.spliterator(this, Spliterator.ORDERED);&#125; ç¤ºä¾‹ä»£ç 123456List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);Spliterator&lt;Integer&gt; spliterator = list.spliterator();//åˆ›å»ºé¡ºåºæµStream&lt;Integer&gt; stream = StreamSupport.stream(spliterator, false);//åˆ›å»ºå¹¶è¡ŒæµStream&lt;Integer&gt; parallelStream = StreamSupport.stream(spliterator, true); Map replaceAll(), compute(), merge() methodsreplaceAll()æ›¿æ¢Mapä¸­æ‰€æœ‰Entryçš„valueå€¼ï¼Œè¿™ä¸ªå€¼ç”±æ—§çš„keyå’Œvalueè®¡ç®—å¾—å‡ºï¼Œæ¥æ”¶å‚æ•° (K, V) -&gt; V æºç 12345678910111213141516public void replaceAll(BiFunction&lt;? super K, ? super V, ? extends V&gt; function) &#123; Node&lt;K,V&gt;[] tab; if (function == null) throw new NullPointerException(); if (size &gt; 0 &amp;&amp; (tab = table) != null) &#123; int mc = modCount; for (int i = 0; i &lt; tab.length; ++i) &#123; for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) &#123; //ä½¿ç”¨ç»™å®šçš„å‡½æ•°æ›¿æ¢åŸæ¥çš„valueå€¼ï¼Œkeyä¸å˜ e.value = function.apply(e.key, e.value); &#125; &#125; if (modCount != mc) throw new ConcurrentModificationException(); &#125;&#125; ç¤ºä¾‹ä»£ç 123456789Map&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put(&quot;1&quot;, &quot;A&quot;);map.put(&quot;2&quot;, &quot;B&quot;);map.put(&quot;3&quot;, &quot;C&quot;);map.put(&quot;4&quot;, &quot;D&quot;);map.put(&quot;5&quot;, &quot;E&quot;);//replaceAllæ–¹æ³•map.replaceAll((s, s2) -&gt; s + s2);System.out.println(map); æ§åˆ¶å°è¾“å‡º12//åŸæ¥çš„valueç”±key + valueæ›¿æ¢æ‰äº†&#123;1=1A, 2=2B, 3=3C, 4=4D, 5=5E&#125; compute()æ˜¯computeIfPresentå’ŒcomputeIfAbsentæ–¹æ³•çš„ç»„åˆä½“ computeIfPresent:å¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡æŒ‡å®šçš„K -&gt; Vè®¡ç®—å‡ºæ–°çš„å€¼è®¾ç½®ä¸ºkeyçš„å€¼ã€‚ computeIfPresent:å¦‚æœæŒ‡å®šçš„keyå­˜åœ¨ï¼Œåˆ™æ ¹æ®æ—§çš„keyå’Œvalueè®¡ç®—æ–°çš„å€¼newValue, å¦‚æœnewValueä¸ä¸ºnullï¼Œåˆ™è®¾ç½®keyæ–°çš„å€¼ä¸ºnewValue, å¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyçš„å€¼ã€‚ ç¤ºä¾‹ä»£ç 123456789101112131415Map&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put(&quot;1&quot;, &quot;A&quot;);map.put(&quot;2&quot;, &quot;B&quot;);map.put(&quot;3&quot;, &quot;C&quot;);map.put(&quot;4&quot;, &quot;D&quot;);map.put(&quot;5&quot;, &quot;E&quot;);//keyå­˜åœ¨ï¼Œæ ¹æ®æ—§çš„keyå’Œvalueè®¡ç®—æ–°çš„å€¼newValuemap.compute(&quot;1&quot;, (k, v) -&gt; v + &quot; computed&quot;);System.out.println(&quot;keyå­˜åœ¨&quot; + map.get(&quot;1&quot;));//keyä¸å­˜åœ¨ï¼Œé€šè¿‡æŒ‡å®šçš„K -&gt; Vè®¡ç®—å‡ºæ–°çš„å€¼è®¾ç½®ä¸ºkeyçš„å€¼map.compute(&quot;6&quot;, (k, v) -&gt; &quot;F&quot;);System.out.println(&quot;keyä¸å­˜åœ¨&quot; + map.get(&quot;6&quot;));//keyå­˜åœ¨ï¼Œå¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyçš„å€¼map.compute(&quot;1&quot;, (k, v) -&gt; null);System.out.println(&quot;keyå­˜åœ¨ï¼Œè®¾ç½®ä¸ºnull &quot; + map.get(&quot;1&quot;)); æ§åˆ¶å°è¾“å‡º123keyå­˜åœ¨A computedkeyä¸å­˜åœ¨Fkeyå­˜åœ¨ï¼Œè®¾ç½®ä¸ºnull null merge()å¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®æŒ‡å®šçš„valueå€¼ï¼Œå¦åˆ™æ ¹æ®keyçš„æ—§çš„å€¼oldvalueï¼Œvalueè®¡ç®—å‡ºæ–°çš„å€¼newValue, å¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyï¼Œå¦åˆ™è®¾ç½®keyçš„æ–°å€¼newValueã€‚ ç¤ºä¾‹ä»£ç 123456789101112Map&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put(&quot;1&quot;, &quot;A&quot;);map.put(&quot;2&quot;, &quot;B&quot;);map.put(&quot;3&quot;, &quot;C&quot;);map.put(&quot;4&quot;, &quot;D&quot;);map.put(&quot;5&quot;, &quot;E&quot;);//å­˜åœ¨keyä¸º1,è¾“å‡º AmergeSystem.out.println(map.merge(&quot;1&quot;, &quot;merge&quot;, (k, v) -&gt; k + v));//æ–°å€¼ä¸ºnullï¼Œåˆ é™¤keyï¼Œè¾“å‡º nullSystem.out.println(map.merge(&quot;1&quot;, &quot;merge&quot;, (k, v) -&gt; null));//ä¸å­˜åœ¨keyä¸º6ï¼Œè¾“å‡º &quot;merge&quot;System.out.println(map.merge(&quot;6&quot;, &quot;merge&quot;, (k, v) -&gt; k + v)); æ§åˆ¶å°è¾“å‡º123Amergenullmerge Performance Improvement for HashMap class with Key Collisionså…·æœ‰é”®å†²çªçš„HashMapç±»çš„æ€§èƒ½æ”¹è¿› Concurrency API improvements(å¹¶å‘APIæ”¹è¿›)ConcurrentHashMapJDK8æä¾›çš„å¹¶å‘å‹å¥½çš„HashMap CompletableFutureæä¾›äº†éå¸¸å¼ºå¤§çš„ Future çš„æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œå¹¶ä¸”æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å›è°ƒçš„æ–¹å¼å¤„ç†è®¡ç®—ç»“æœï¼Œä¹Ÿæä¾›äº†è½¬æ¢å’Œç»„åˆ CompletableFuture çš„æ–¹æ³•ã€‚ Executors newWorkStealingPool()åˆ›å»ºæŒæœ‰è¶³å¤Ÿçº¿ç¨‹çš„çº¿ç¨‹æ± æ¥æ”¯æŒç»™å®šçš„å¹¶è¡Œçº§åˆ«ï¼Œå¹¶é€šè¿‡ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ï¼Œå‡å°‘ç«äº‰ï¼Œå®ƒéœ€è¦ä¼ ä¸€ä¸ªå¹¶è¡Œçº§åˆ«çš„å‚æ•°ï¼Œå¦‚æœä¸ä¼ ï¼Œåˆ™è¢«è®¾å®šä¸ºé»˜è®¤çš„CPUæ•°é‡ã€‚ Java IO improvements(Java IO APIçš„æ”¹è¿›)Files.list(Path dir)è¿”å›ä¸€ä¸ªå»¶è¿Ÿå¡«å……çš„Streamï¼Œå…¶ä¸­çš„å…ƒç´ æ˜¯ç›®å½•ä¸­çš„æ¡ç›®ã€‚ 123//è¿”å›ç›®å½•ä¸‹çš„å…ƒç´ é›†åˆæµStream&lt;Path&gt; list = Files.list(new File(&quot;C:\\\\Users\\\\Administrator\\\\Desktop&quot;).toPath());list.forEach(System.out::println); Files.lines(Path path)ä»æ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰è¡Œä½œä¸ºæµã€‚ 123//è¿”å›æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œæ•°Stream&lt;String&gt; lines = Files.lines(new File(&quot;C:\\\\Users\\\\Administrator\\\\Desktop\\\\new 3.txt&quot;).toPath());lines.forEach(System.out::println); Files.find()é€šè¿‡æœç´¢ä»¥ç»™å®šèµ·å§‹æ–‡ä»¶ä¸ºæ ¹çš„æ–‡ä»¶æ ‘ä¸­çš„æ–‡ä»¶ï¼Œè¿”å›ä½¿ç”¨Pathå»¶è¿Ÿå¡«å……çš„Streamã€‚ 12345//è¿”å›ç¬¦åˆåˆ¤æ–­æ¡ä»¶çš„PathæµStream&lt;Path&gt; stream = Files.find(new File(&quot;C:\\\\Users\\\\Administrator\\\\Desktop&quot;).toPath(), 1, (path, basicFileAttributes) -&gt; basicFileAttributes.isDirectory());stream.forEach(System.out::println); BufferedReader.lines()è¿”å›ä¸€ä¸ªStreamï¼Œå…¶å…ƒç´ æ˜¯ä»è¿™ä¸ªBufferedReaderè¯»å–çš„è¡Œã€‚ 1234//è¿”å›æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œæ•°,ç±»ä¼¼Files.lines()BufferedReader br = new BufferedReader(new FileReader(&quot;C:\\\\Users\\\\Administrator\\\\Desktop\\\\new 3.txt&quot;));Stream&lt;String&gt; stringStream = br.lines();stringStream.forEach(System.out::println); å‚è€ƒèµ„æº Java 8 Features with Examples ä¸ºå¹¶å‘è€Œç”Ÿçš„ ConcurrentHashMapï¼ˆJava 8ï¼‰ é€šè¿‡å®ä¾‹ç†è§£ JDK8 çš„ CompletableFuture","tags":[{"name":"Java","slug":"Java","permalink":"https://gcdd1993.github.io/tags/Java/"}]},{"title":"PGæ•°æ®åº“å¸¸ç”¨æ“ä½œ","date":"2019-01-09T11:36:07.000Z","path":"p/59866/","text":"è®°å½•ä¸€ä¸‹ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æ¥è§¦åˆ°çš„ä¸€äº›PGæ•°æ®åº“å¸¸ç”¨æ“ä½œï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚ å…¨é‡è¿ç§» å¤‡ä»½æ•°æ® 1$ pg_dump -h 172.19.235.145 -U &lt;username&gt; -d &lt;database&gt; &gt; 20180704_dbpe.sql æ­£å¼è¿ç§» é¦–å…ˆè¦ä¿®æ”¹å¤‡ä»½æ–‡ä»¶*.sqlçš„ownerï¼Œé˜²æ­¢æƒé™å‡ºç°é”™è¯¯ã€‚ 1$ psql -h &lt;ip&gt; -U &lt;username&gt; -d &lt;database&gt; -f 20180704_dbpe.sql ã€æ³¨æ„ç‚¹ã€‘è¯¥è¿ç§»æ“ä½œä¼šè¦†ç›–åŸæ¥çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æœ€å¥½åˆ›å»ºä¸€ä¸ªæ–°åº“ã€‚ åˆ—å‡ºæ‰€æœ‰è¡¨åå’Œæ•°æ®åº“å1select tablename from pg_tables where schemaname =&#x27;public&#x27;; PostgreSQL ä¸­ æœ‰æ—¶å€™æƒ³åˆ é™¤æ•°æ®åº“ï¼ˆdrop database swiftliveqaapi;ï¼‰ï¼Œå‘ç°æç¤ºâ€œERROR: database â€œxxxxxxâ€ is being accessed by other users DETAIL: There are 30 other sessions using the database.â€123ç”¨psql ç™»å½•è¿›å…¥ï¼Œ æ‰§è¡Œè¯­å¥ï¼šSELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname=&#x27;æ•°æ®åº“å&#x27; AND pid&lt;&gt;pg_backend_pid();ç„¶åå°±å¯ä»¥åˆ é™¤æ•°æ®åº“äº† ä¿®æ”¹è¡¨çš„åºåˆ—ä¸ºidæœ€å¤§å€¼1SELECT setval(&#x27;è¡¨å_id_seq&#x27;, (SELECT MAX(id) FROM è¡¨å)); æŸ¥è¯¢è¡¨ç»“æ„1234567891011SELECT COLUMN_NAME AS åˆ—å, DATA_TYPE AS å­—æ®µç±»å‹, CHARACTER_MAXIMUM_LENGTH AS é•¿åº¦, IS_NULLABLE AS æ˜¯å¦ä¸ºç©º, COLUMN_DEFAULT AS é»˜è®¤å€¼ FROM INFORMATION_SCHEMA.COLUMNS WHERE table_schema = &#x27;public&#x27; AND TABLE_NAME = &#x27;è¡¨å&#x27;; PG æ•°æ®åº“çŠ¶æ€ï¼Œå¯åŠ¨ï¼Œåœæ­¢123$ pg_ctlcluster 9.5 main status$ pg_ctlcluster 9.5 main start$ pg_ctlcluster 9.5 main stop","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://gcdd1993.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"Spring-Securityæ— æ³•æ­£å¸¸æ•æ‰åˆ°UsernameNotFoundExceptionå¼‚å¸¸","date":"2019-01-08T13:25:54.000Z","path":"p/31514/","text":"å‰è¨€åœ¨Webåº”ç”¨å¼€å‘ä¸­,å®‰å…¨ä¸€ç›´æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæ–¹é¢ã€‚åœ¨åºå¤§çš„springç”Ÿæ€åœˆä¸­ï¼Œæƒé™æ ¡éªŒæ¡†æ¶ä¹Ÿæ˜¯éå¸¸å®Œå–„çš„ã€‚å…¶ä¸­ï¼Œspring securityæ˜¯éå¸¸å¥½ç”¨çš„ã€‚ä»Šå¤©è®°å½•ä¸€ä¸‹åœ¨å¼€å‘ä¸­é‡åˆ°çš„ä¸€ä¸ªspring-securityç›¸å…³çš„é—®é¢˜ã€‚ é—®é¢˜æè¿°ä½¿ç”¨spring securityè¿›è¡Œæˆæƒç™»å½•çš„æ—¶å€™ï¼Œå‘ç°ç™»å½•æ¥å£æ— æ³•æ­£å¸¸æ•æ‰UsernameNotFoundExceptionå¼‚å¸¸ï¼Œæ•æ‰åˆ°çš„ä¸€ç›´æ˜¯BadCredentialsExceptionå¼‚å¸¸ã€‚æˆ‘ä»¬çš„é¢„æœŸæ˜¯ï¼š UsernameNotFoundException -&gt; ç”¨æˆ·åé”™è¯¯ BadCredentialsException -&gt; å¯†ç é”™è¯¯ è´´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä»£ç ï¼š 1. ç™»å½•ä¸šåŠ¡é€»è¾‘12345678910111213141516171819202122232425@Servicepublic class AuthServiceImpl implements AuthService &#123; @Autowired private UserDetailsService userDetailsService; @Autowired private AuthenticationManager authenticationManager; @Autowired private JwtTokenUtil jwtTokenUtil; @Override public JwtAuthenticationResponse login(String username, String password) &#123; //æ„é€ spring securityéœ€è¦çš„UsernamePasswordAuthenticationToken UsernamePasswordAuthenticationToken upToken = new UsernamePasswordAuthenticationToken(username, password); //è°ƒç”¨authenticationManager.authenticate(upToken)æ–¹æ³•éªŒè¯ //è¯¥æ–¹æ³•å°†ä¼šæ‰§è¡ŒUserDetailsServiceçš„loadUserByUsernameéªŒè¯ç”¨æˆ·å //ä»¥åŠPasswordEncoderçš„matchesæ–¹æ³•éªŒè¯å¯†ç  val authenticate = authenticationManager.authenticate(upToken); JwtUser userDetails = (JwtUser) authenticate.getPrincipal(); val token = jwtTokenUtil.generateToken(userDetails); return new JwtAuthenticationResponse(token, userDetails.getId(), userDetails.getUsername()); &#125;&#125; 2. spring security çš„UserDetailsService å®ç°ç±»12345678910111213141516@Servicepublic class JwtUserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserRepository userRepository; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; AbstractUser abstractUser = userRepository.findByUsername(username); //å¦‚æœé€šè¿‡ç”¨æˆ·åæ‰¾ä¸åˆ°ç”¨æˆ·ï¼Œåˆ™æŠ›å‡ºUsernameNotFoundExceptionå¼‚å¸¸ if (abstractUser == null) &#123; throw new UsernameNotFoundException(String.format(&quot;No abstractUser found with username &#x27;%s&#x27;.&quot;, username)); &#125; else &#123; return JwtUserFactory.create(abstractUser); &#125; &#125;&#125; 3. ç™»å½•æ¥å£123456789101112try &#123; final JwtAuthenticationResponse jsonResponse = authService.login(authenticationRequest.getUsername(), authenticationRequest.getPassword()); //å­˜å…¥redis redisService.setToken(jsonResponse.getToken()); return ok(jsonResponse);&#125; catch (BadCredentialsException e) &#123; //æ•æ‰åˆ°BadCredentialsExceptionï¼Œå¯†ç ä¸æ­£ç¡® return forbidden(LOGIN_PASSWORD_ERROR, request);&#125; catch (UsernameNotFoundException e) &#123; //æ•æ‰åˆ°UsernameNotFoundExceptionï¼Œç”¨æˆ·åä¸æ­£ç¡® return forbidden(LOGIN_USERNAME_ERROR, request);&#125; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·åé”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ123catch (UsernameNotFoundException e) &#123; return forbidden(LOGIN_USERNAME_ERROR, request);&#125; å¦‚æœå¯†ç é”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ123catch (BadCredentialsException e) &#123; return forbidden(LOGIN_PASSWORD_ERROR, request);&#125; å®é™…ä¸Šï¼Œä¸ç®¡æ˜¯æŠ›å‡ºä»€ä¹ˆé”™ï¼Œæœ€åæŠ“åˆ°çš„éƒ½æ˜¯BadCredentialsException é—®é¢˜å®šä½debugå¤§æ³•æ–­ç‚¹ è·Ÿè¸ªç»è¿‡æ­¥è¿›æ³•è·Ÿè¸ªä»£ç ï¼Œå‘ç°é—®é¢˜æ‰€åœ¨ï¼Œä½äº 12AbstractUserDetailsAuthenticationProviderpublic Authentication authenticate(Authentication authentication) ç»“è®º loadUserByUsernameæ–¹æ³•ç¡®å®æŠ›å‡ºäº†UsernameNotFoundException èµ°åˆ°AbstractUserDetailsAuthenticationProviderçš„authenticateæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœhideUserNotFoundExceptions = trueï¼Œç›´æ¥å°±è¦†ç›–äº†UsernameNotFoundExceptionå¼‚å¸¸å¹¶æŠ›å‡ºBadCredentialsExceptionå¼‚å¸¸ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆæ€»æ˜¯æ•æ‰åˆ°BadCredentialsExceptionå¼‚å¸¸ é—®é¢˜è§£å†³æ—¢ç„¶å·²ç»æ‰¾åˆ°äº†æ˜¯å› ä¸ºhideUserNotFoundExceptions = trueå¯¼è‡´çš„é—®é¢˜ï¼Œé‚£æŠŠhideUserNotFoundExceptions = falseä¸å°±å®Œäº‹äº†å—ï¼Ÿ æ–¹æ¡ˆ1å‚è€ƒstackoverflowå¤§ç¥å›ç­” ä¿®æ”¹WebSecurityConfigé…ç½®ï¼Œæ·»åŠ AuthenticationProvider Bean12345678@Beanpublic AuthenticationProvider daoAuthenticationProvider() &#123; DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider(); daoAuthenticationProvider.setUserDetailsService(userDetailsService); daoAuthenticationProvider.setPasswordEncoder(passwordEncoder()); daoAuthenticationProvider.setHideUserNotFoundExceptions(false); return daoAuthenticationProvider;&#125; é…ç½®AuthenticationProvider Bean12345@Autowiredpublic void configureAuthentication(AuthenticationManagerBuilder authenticationManagerBuilder) throws Exception &#123; authenticationManagerBuilder .authenticationProvider(daoAuthenticationProvider());&#125; æ–¹æ¡ˆ2ç”±äºä»¥å‰é¡¹ç›®ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„æŠ€æœ¯æ ˆï¼Œè€Œä¸”ä»£ç ä¹Ÿå·®ä¸å¤šï¼Œç™»å½•è¿™æ®µé€»è¾‘å¯ä»¥è¯´æ˜¯å®Œå…¨ç›¸åŒï¼Œä¸è¿‡ä¹‹å‰å°±ä¸€ç›´éƒ½æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚åå¤æŸ¥çœ‹ä¹‹åå‘ç°ï¼Œåœ¨loginçš„ä»£ç æœ‰äº›ä¸åŒ åœ¨ 1val authenticate = authenticationManager.authenticate(upToken); å‰é¢è¿˜æœ‰ä¸€ä¸ª 12//æ‰§è¡ŒUserDetailsServiceçš„loadUserByUsernameéªŒè¯ç”¨æˆ·åuserDetailsService.loadUserByUsername(authenticationRequest.getUsername()); è¯¥æ–¹æ³•ä¼šç›´æ¥æŠ›å‡ºUsernameNotFoundExceptionï¼Œè€Œä¸èµ°spring securityçš„AbstractUserDetailsAuthenticationProviderï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¢«è½¬æ¢ä¸ºBadCredentialsExceptionäº†ã€‚ ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸ªç¼ºç‚¹ï¼Œ å¦‚æœéªŒè¯ç”¨æˆ·åé€šè¿‡ä»¥åï¼Œå†æ¬¡è°ƒç”¨ 1val authenticate = authenticationManager.authenticate(upToken); è¿˜ä¼šå†æ‰§è¡Œä¸€é 1userDetailsService.loadUserByUsername(authenticationRequest.getUsername()); è¯¥æ“ä½œæ˜¯å†—ä½™çš„ï¼Œäº§ç”Ÿäº†ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢å·¥ä½œã€‚ æ¨èä½¿ç”¨æ–¹æ¡ˆ1","tags":[{"name":"Spring-Security","slug":"Spring-Security","permalink":"https://gcdd1993.github.io/tags/Spring-Security/"}]},{"title":"å¸¸ç”¨è½¯ä»¶é›†åˆ","date":"2019-01-08T08:37:14.000Z","path":"p/37491/","text":"å¸¸ç”¨è½¯ä»¶å·¥å…·æ”¶è—é›†ï¼Œæ”¶è—äº†åœ¨å·¥ä½œç”Ÿæ´»ä¸­é‡åˆ°çš„å¥½ç”¨å®ç”¨çš„è½¯ä»¶ã€‚ å¼€å‘å·¥å…· BeyondCompareç ´è§£ç‰ˆ Navicat Premium 12ç ´è§£ç‰ˆ markdown pad2ç ´è§£ç‰ˆ å¯†ç :23w2 RedisDesktopManager å…è´¹ç‰ˆ å¯†ç :ciq1 QTransateç¿»è¯‘å·¥å…· æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å·¥å…· draw.ioæ‹“æ‰‘å›¾å·¥å…· DevCenter cassandraç®¡ç†å·¥å…· PostManä¾¿æºç‰ˆ Git SourceTree(Git Guiå·¥å…·) XShell5ç ´è§£ç‰ˆ å®ç”¨å·¥å…· RSSè®¢é˜…å·¥å…·(åªé™windows) ç§‘å­¦ä¸Šç½‘ShadowSocks win10æ¿€æ´»å·¥å…· Officeå®‰è£…å·¥å…· OCRæ–‡å­—è¯†åˆ«å·¥å…· GIFå½•åˆ¶å·¥å…· å†°ç‚¹æ–‡åº“ä¸‹è½½å™¨ç ´è§£ç‰ˆ æ¨èå·¥å…· ç°ä»£åŒ–Markdownç¼–è¾‘å·¥å…·","tags":[{"name":"è½¯ä»¶","slug":"è½¯ä»¶","permalink":"https://gcdd1993.github.io/tags/%E8%BD%AF%E4%BB%B6/"}]},{"title":"BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»","date":"2019-01-08T07:28:49.000Z","path":"p/14256/","text":"å‰è¨€åœ¨å®é™…å¼€å‘ä¸­ï¼Œé‡åˆ°ä¾‹å¦‚è´§å¸ï¼Œç»Ÿè®¡ç­‰å•†ä¸šè®¡ç®—çš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦é‡‡ç”¨java.math.BigDecimalç±»æ¥è¿›è¡Œç²¾ç¡®è®¡ç®—ã€‚è€Œè¿™ç±»æ“ä½œé€šå¸¸éƒ½æ˜¯å¯é¢„çŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯é€šç”¨çš„ã€‚æ‰€ä»¥ï¼Œå†™äº†ä¸ªå·¥å…·ç±»æ¥æ–¹ä¾¿ä»¥åçš„å·¥ä½œã€‚è¿™æ˜¯ä»“åº“åœ°å€ï¼šä»“åº“åœ°å€ BigDecimalçš„æ„å»ºä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä¸»è¦ä»int,long,double,floatæ¥è¿›è¡Œè®¡ç®—ï¼Œåœ¨æ„å»ºçš„æ—¶å€™æ¨èä½¿ç”¨ 1BigDecimal BigDecimal(String s); å› ä¸ºé€šè¿‡doubleæ„é€ ä¼šæŸå¤±ç²¾åº¦ï¼Œè€ŒStringæ„é€ æ˜¯å›ºå®šçš„å€¼ã€‚åˆ›å»ºä»¥ä¸‹æ–¹æ³•ä½œä¸ºé€šç”¨BigDecimalè½¬åŒ–å™¨ï¼š 123456789101112131415161718/** * Number -&gt; BigDecimal */public static &lt;T extends Number&gt; BigDecimal transform(T v) &#123; if (v instanceof Double) &#123; return new BigDecimal(Double.toString((Double) v)); &#125; else if (v instanceof Integer) &#123; return new BigDecimal(Integer.toString((Integer) v)); &#125; else if (v instanceof Long) &#123; return new BigDecimal(Long.toString((Long) v)); &#125; else if (v instanceof Short) &#123; return new BigDecimal(Short.toString((Short) v)); &#125; else if (v instanceof Float) &#123; return new BigDecimal(Float.toString((Float) v)); &#125; else &#123; return (BigDecimal) v; &#125;&#125; BigDecimalæ–¹æ³•è®¡ç®—ç±»å‹åŠ å‡ä¹˜é™¤å››ç§ï¼ŒBigDecimalæä¾›çš„æ–¹æ³•ä¹Ÿæ˜¯å›´ç»•è¿™å››ç§è®¡ç®—ç±»å‹è®¾è®¡çš„ã€‚ 1234BigDecimal add(BigDecimal augend) //åŠ BigDecimal subtract(BigDecimal subtrahend) //å‡BigDecimal multiply(BigDecimal multiplicand) //ä¹˜BigDecimal divide(BigDecimal divisor, int scale, RoundingMode roundingMode) //é™¤ å·¥å…·ç±»åœ¨åŠ å‡ä¹˜é™¤åŸºç¡€ä¸Šï¼Œæä¾›äº† é“¾å¼è®¡ç®—ï¼Œç±»ä¼¼JDK8 lamada apiï¼Œçˆ½å¿«ä¸æ»‘çš„ç¼–ç¨‹ä½“éªŒ æ”¯æŒé›†åˆæ±‚å’Œã€æ±‚å¹³å‡ æ”¯æŒå¤åˆè®¡ç®—ï¼Œä¾‹å¦‚2*(2+8) BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»å®ç”¨æ¡ˆä¾‹ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼Œä¸æŒ‡å®šç²¾åº¦12345System.out.println(PreciseCalculations.transform(121.11)); //è½¬åŒ–double -&gt; 121.11System.out.println(PreciseCalculations.transform(Integer.MAX_VALUE)); //è½¬åŒ–int -&gt; 2147483647System.out.println(PreciseCalculations.transform(Short.MAX_VALUE)); //è½¬åŒ–Short -&gt; 32767System.out.println(PreciseCalculations.transform(Long.MAX_VALUE)); //è½¬åŒ–long -&gt; 9223372036854775807System.out.println(PreciseCalculations.transform(121.19F)); //è½¬åŒ–float -&gt; 121.19 ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼ŒæŒ‡å®šç²¾åº¦12System.out.println(PreciseCalculations.transform(121.1111111111, 5)); //ç²¾åº¦å¤§äºæŒ‡å®šç²¾åº¦ -&gt; 121.11111System.out.println(PreciseCalculations.transform(121.11, 5)); //ç²¾åº¦å°äºæŒ‡å®šç²¾åº¦ï¼Œè¡¥é›¶ -&gt; 121.11000 åŠ å‡ä¹˜é™¤1234System.out.println(PreciseCalculations.add(12.11, 12.11)); //åŠ æ³• -&gt; 24.22System.out.println(PreciseCalculations.subtract(12.11, 12.11)); //å‡æ³• -&gt; 0.00System.out.println(PreciseCalculations.multiply(12.11, 12.11)); //ä¹˜æ³• -&gt; 146.6521System.out.println(PreciseCalculations.divide(12.11, 2.35, 5)); //é™¤æ³• -&gt; 5.15319 è´Ÿæ•°è®¡ç®—1234// -1.11 * 13 - 90 = -104.43System.out.println(new PreciseCalculation(-1.11).multiply(13).add(-90).getValue()); // -11.11111111 + 90 = 78.88888889System.out.println(PreciseCalculations.add(-11.11111111,90)); é›†åˆ æ±‚å’Œ æ±‚å¹³å‡å€¼1234List&lt;Double&gt; list = Arrays.asList(12.11D, 13.11D, 14.11D, 15.321312D);System.out.println(PreciseCalculations.sum(list)); //æ±‚å’Œ -&gt; Optional[54.651312]System.out.println(PreciseCalculations.average(list)); //å¹³å‡å€¼ -&gt; Optional[13.66283]System.out.println(PreciseCalculations.average(Collections.emptyList())); //ç©ºé›†åˆ -&gt; Optional.empty å¤åˆè®¡ç®—12345// è®¡ç®— 121.11 * 13 / 60 + 100 - 12 = 114.24050System.out.println(new PreciseCalculation(121.11).multiply(13).divide(60, 5).add(100).subtract(12).getValue());//è®¡ç®— 121.11 * 128.59 / (100 + 12) - 100 = 39.04942System.out.println(new PreciseCalculation(121.11).multiply(128.59).divide( new PreciseCalculation(100).add(12), 5).subtract(100).getValue()); æ³¨æ„äº‹é¡¹ PreciseCalculation æ ¸å¿ƒç±»ï¼Œæä¾›åŠ å‡ä¹˜é™¤ã€é›†åˆç²¾ç¡®è®¡ç®—æ–¹æ³•ï¼Œå†…éƒ¨ç»´æŠ¤valueå€¼ï¼Œæ¯æ¬¡è®¡ç®—è¯¥valueéƒ½ä¼šæ”¹å˜ã€‚ PreciseCalculations åŸºäºä¸Šè¿°çš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿ç®€å•è®¡ç®—æ—¶ä½¿ç”¨ã€‚","tags":[{"name":"JAVA","slug":"JAVA","permalink":"https://gcdd1993.github.io/tags/JAVA/"}]}]
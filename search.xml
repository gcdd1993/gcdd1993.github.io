<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Dell å·¥ä½œç«™M4800 å®‰è£…macOs Mojave</title>
    <url>/p/62106/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘ï¼Œå…¥æ‰‹äº†ä¸€å°äºŒæ‰‹Dellå·¥ä½œç«™M4800ï¼Œä»·æ ¼ä¸º3600ï¼Œé…ç½®å¦‚ä¸‹</p>
<p><img data-src="https://i.loli.net/2019/10/01/Fhne1JBNAqUXGmM.png"></p>
<span id="more"></span>

<p>ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œé…ç½®å¤Ÿç”¨ï¼Œå…³é”®æ˜¯ç”¨æ–™çœŸçš„è¶³ï¼è™½ç„¶æ˜¯16å¹´çš„æœºå™¨ï¼Œä½†æ˜¯åšå·¥åŠæ‰“ä¸€ä¼—æ¸¸æˆæœ¬ã€‚</p>
<p>ç„¶åï¼Œé‡ç‚¹æ¥äº†ï¼Œæˆ‘å®‰è£…ä¸Šäº†é»‘è‹¹æœmacOs Mojaveï¼Œç­‰äºè¯´èŠ±äº†3600ä¹°äº†å°MBPï¼Œè€Œä¸”æ˜¯éå¸¸çš„é«˜é…ã€‚</p>
<p><img data-src="https://i.loli.net/2019/10/01/dUagmkJoTqQic5P.png"></p>
<p><img data-src="https://i.loli.net/2019/10/01/YqyRE68VKmMgtSe.png"></p>
<p>ç›®å‰ä½¿ç”¨ä¸ŠåŸºæœ¬å®Œç¾ï¼Œé™¤äº†æ— çº¿ç½‘å¡ï¼ˆä¹°äº†å…é©±å†…ç½®æ— çº¿ç½‘å¡åœ¨è·¯ä¸Šï¼‰ï¼ŒHDMIï¼ˆæš‚æ—¶ä¸æ€ä¹ˆç”¨ï¼Œä¸è¿‡ä¸æ˜¯æ— è§£ï¼‰ã€‚</p>
<h1 id="é»‘è‹¹æœå®‰è£…è®°å½•"><a href="#é»‘è‹¹æœå®‰è£…è®°å½•" class="headerlink" title="é»‘è‹¹æœå®‰è£…è®°å½•"></a>é»‘è‹¹æœå®‰è£…è®°å½•</h1><blockquote>
<p>ä»¥ä¸‹å†…å®¹ä»…ä½œè®°å½•ï¼Œä¸ä¿è¯èƒ½å®‰è£…æˆåŠŸã€‚</p>
</blockquote>
<p>å®‰è£…æ•™ç¨‹éƒ½å¤§å·®ä¸å·®ï¼Œä¸»è¦æ˜¯è¦æ‰¾åˆ°é€‚ç”¨æœºå‹çš„EFIæ–‡ä»¶ï¼Œç„¶åæ›¿æ¢å°±å¯ä»¥ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœä½ æœ‰èƒ½åŠ›ï¼Œå¯ä»¥è‡ªå·±é€‚é…EFIï¼Œç„¶åè´¡çŒ®ç»™å¤§å®¶ğŸ‘ğŸ‘ğŸ‘ã€‚</p>
<p>å¦‚æœæœºå‹è·Ÿæˆ‘ä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘æ•´ç†å¥½çš„ï¼š<a href="https://github.com/gcdd1993/Dell-M4800-Hackintosh">https://github.com/gcdd1993/Dell-M4800-Hackintosh</a></p>
<h2 id="æ•™ç¨‹"><a href="#æ•™ç¨‹" class="headerlink" title="æ•™ç¨‹"></a>æ•™ç¨‹</h2><blockquote>
<p>æˆ‘ä¹Ÿæ˜¯å°ç™½ï¼Œä¸ç­é—¨å¼„æ–§ï¼Œæ”¾ä¸Šæˆ‘è£…çš„æ—¶å€™çš„å‚è€ƒé“¾æ¥ï¼Œç…§ç€è£…ï¼Œä¸€èˆ¬éƒ½èƒ½æå®š</p>
</blockquote>
<ul>
<li><a href="https://zhih.me/hackintosh-install-guide/">å•ç¡¬ç›˜å•ç³»ç»Ÿï¼ˆæ¨èï¼‰</a></li>
<li><a href="http://ju.outofmemory.cn/entry/369297">å•ç¡¬ç›˜åŒç³»ç»Ÿï¼ˆä¸æ¨èï¼Œå¯èƒ½å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼‰</a></li>
</ul>
<div class="note warning"><p>å¯åŠ¨Uç›˜è£…å¥½åï¼Œä¸è¦å¿˜è®°æ›¿æ¢é€‚é…æœºå‹çš„EFI </p>
</div>

<p>ç„¶åæ­£å¼è¿›å…¥é»‘è‹¹æœçš„å®‰è£…ã€‚</p>
<h2 id="ä¿®æ”¹BIOSè®¾ç½®ï¼ˆå¼€æœºæŒ‰F2ï¼‰"><a href="#ä¿®æ”¹BIOSè®¾ç½®ï¼ˆå¼€æœºæŒ‰F2ï¼‰" class="headerlink" title="ä¿®æ”¹BIOSè®¾ç½®ï¼ˆå¼€æœºæŒ‰F2ï¼‰"></a>ä¿®æ”¹BIOSè®¾ç½®ï¼ˆå¼€æœºæŒ‰F2ï¼‰</h2><ul>
<li><p>Advanced Boot Options = Enable Legacy</p>
</li>
<li><p>Integrated NIC = Enable</p>
</li>
<li><p>Parallel Ports = AT</p>
</li>
<li><p>Serial Ports = Disabled ( If you are using Dock station then Enable it - Expermental )</p>
</li>
<li><p>Sata Operation = AHCI</p>
</li>
<li><p>Drivers = Check all</p>
</li>
<li><p>Switchable Graphics = Enable Switchable Graphics</p>
</li>
<li><p>Secure Boot = Disabled</p>
</li>
<li><p>Virtualization = Disable</p>
</li>
</ul>
<p>å®Œæˆåé€€å‡ºé‡å¯</p>
<h2 id="é‡å¯é€‰æ‹©ä»Uç›˜å¯åŠ¨ï¼ˆå¼€æœºæŒ‰F12ï¼‰"><a href="#é‡å¯é€‰æ‹©ä»Uç›˜å¯åŠ¨ï¼ˆå¼€æœºæŒ‰F12ï¼‰" class="headerlink" title="é‡å¯é€‰æ‹©ä»Uç›˜å¯åŠ¨ï¼ˆå¼€æœºæŒ‰F12ï¼‰"></a>é‡å¯é€‰æ‹©ä»Uç›˜å¯åŠ¨ï¼ˆå¼€æœºæŒ‰F12ï¼‰</h2><p>æŒ‰ç…§æ•™ç¨‹ï¼ŒæŠ¹ç›˜â€“å®‰è£…â€“è¿›å…¥ç³»ç»Ÿ</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…ä¼šç»å†3æ¬¡é‡å¯</p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ˜¯å®‰è£…å‰©ä½™2åˆ†é’Ÿçš„æ—¶å€™ï¼Œè¿™é‡Œè¦é€‰æ‹©<strong>ç¡¬ç›˜å¯åŠ¨ï¼ˆCloverç•Œé¢ä¼šå‡ºç°Boot install macos from ç¡¬ç›˜åˆ†åŒºåï¼‰</strong>ï¼Œå¦‚æœä½ é€‰äº†Uç›˜å¯åŠ¨ï¼Œé‚£å°±è¦å†æ¥ä¸€æ¬¡äº†ã€‚</li>
<li>ç¬¬äºŒæ¬¡é‡å¯ï¼Œè¿˜æ˜¯é€‰æ‹©ç¡¬ç›˜å¯åŠ¨</li>
<li>ç¬¬ä¸‰æ¬¡é‡å¯ï¼Œå¯ä»¥é€‰æ‹©<strong>Boot macos from ç¡¬ç›˜åˆ†åŒºå</strong>ï¼Œå¯åŠ¨macOsäº†</li>
</ul>
<p>æˆåŠŸè¿›å…¥ç³»ç»Ÿåï¼Œæ‰§è¡Œæœ€åä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œé‚£å°±æ˜¯å®‰è£…é©±åŠ¨</p>
<h2 id="æ›¿æ¢é©±åŠ¨æ–‡ä»¶"><a href="#æ›¿æ¢é©±åŠ¨æ–‡ä»¶" class="headerlink" title="æ›¿æ¢é©±åŠ¨æ–‡ä»¶"></a>æ›¿æ¢é©±åŠ¨æ–‡ä»¶</h2><p>è¿™é‡Œè¦ç”¨åˆ°<a href="https://pan.baidu.com/s/1yFDn_w5y2pdC5EYhhB7Y_w">Clover Configurator</a>å¯†ç :zcyj</p>
<ul>
<li>æ‰“å¼€Clover Configuratorï¼Œé€‰æ‹©æŒ‚è½½åˆ†åŒºï¼Œç„¶åæ‰“å¼€åˆ†åŒº</li>
</ul>
<p><img data-src="https://i.loli.net/2019/10/01/HMcTaAL9jCvGUEN.png"></p>
<ul>
<li>æ›¿æ¢EFIæ–‡ä»¶å¤¹ï¼ˆå…ˆç§»é™¤åŸå…ˆçš„ï¼Œå°†å¤§ä½¬ä»¬æä¾›çš„EFIå¤åˆ¶è¿›å»ï¼‰</li>
</ul>
<p><img data-src="https://i.loli.net/2019/10/01/uNq51A3lDJMpx2d.png"></p>
<ul>
<li>æ›¿æ¢é©±åŠ¨æ–‡ä»¶ï¼ˆkextsï¼‰</li>
</ul>
<p><img data-src="https://i.loli.net/2019/10/01/49IG2XpBxtQWdOR.png"></p>
<p><img data-src="https://i.loli.net/2019/10/01/wmtiFH9qBCfQWpv.png"></p>
<p>æœ€åé‡å¯è¯•ä¸‹å§ï¼Œå¯ä»¥æ‘†è„±Uç›˜äº†</p>
<h1 id="Cloverä¸»é¢˜ä¿®æ”¹"><a href="#Cloverä¸»é¢˜ä¿®æ”¹" class="headerlink" title="Cloverä¸»é¢˜ä¿®æ”¹"></a>Cloverä¸»é¢˜ä¿®æ”¹</h1><p>é»‘è‹¹æœæ¯æ¬¡å¼€æœºéƒ½ä¼šè¿›å…¥Cloverå¼•å¯¼ç•Œé¢ï¼Œä½†æ˜¯é»˜è®¤çš„Cloverä¸»é¢˜æ˜¯é»‘é»‘çš„ï¼Œä¸‘ä¸‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ›¿æ¢æ‰ï¼Œæ¢ä¸€ä¸ªé«˜å¤§ä¸Šçš„å¼•å¯¼ç•Œé¢ã€‚</p>
<p>è¿™é‡Œæ¨èå·¥å…·<a href="https://mac.softpedia.com/get/System-Utilities/Clover-Theme-Manager.shtml">CloverThemeManager</a></p>
<p><img data-src="https://i.loli.net/2019/10/01/FqUTSyxY3QncR2H.png"></p>
<p><img data-src="https://i.loli.net/2019/10/01/ZKd3kNiwYc4EnWz.png"></p>
<hr>
<h1 id="WIFI"><a href="#WIFI" class="headerlink" title="WIFI"></a>WIFI</h1><p>ç½‘å¡å·²å®‰è£…ä¸Šï¼Œä½¿ç”¨çš„æ˜¯BCM43224ï¼Œä¸å¸¦è“ç‰™ï¼Œå…é©±ï¼Œæ·˜å®25å—é’±å·¦å³ï¼ŒmSataæ¥å£ï¼Œä½¿ç”¨æ— å¼‚å¸¸ã€‚</p>
<p><img data-src="https://i.loli.net/2019/10/11/Q1Wzw83uKBlkaod.png"></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="https://zuiyu1818.cn/posts/Hac_Clover.html">Clover æ›´æ–°å’Œç•Œé¢ç¾åŒ–</a></li>
<li><a href="https://osxlatitude.com/forums/topic/11182-final-dell-precision-m6800-m4800-fully-working-high-sierra-or-mojave/">macOs Mojave on M4800</a></li>
<li><a href="https://github.com/daliansky/Hackintosh">Hackintoshé»‘è‹¹æœé•¿æœŸç»´æŠ¤æœºå‹EFIåŠå®‰è£…æ•™ç¨‹æ•´ç†</a></li>
<li><a href="https://www.chajian110.com/97.html">Mojaveç¡¬ä»¶æ”¯æŒåˆ—è¡¨ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰</a></li>
<li><a href="https://zhih.me/hackintosh-install-guide/">é»‘è‹¹æœå®‰è£…æ•™ç¨‹</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>é»‘è‹¹æœ</tag>
      </tags>
  </entry>
  <entry>
    <title>Dubboä½¿ç”¨Kryoåºåˆ—åŒ–åè®®çš„æ€è€ƒ</title>
    <url>/p/13982/</url>
    <content><![CDATA[<p>æœ¬æ–‡æ˜¯ä½¿ç”¨<code>Dubbo</code>è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒï¼Œä¸è¶³ä»¥ä½œä¸ºå‚è€ƒï¼Œåªä¸ºç•™å­˜è®°å½•ã€‚</p>
<span id="more"></span>

<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>Dubbo</code>å®˜æ–¹æ¨èä½¿ç”¨<code>kryo</code>æˆ–è€…<code>fst</code>ä½œä¸º<code>RPC</code>åºåˆ—åŒ–åè®®ï¼ŒåŸå› æ˜¯è¿™ä¸¤æ¬¾åºåˆ—åŒ–åè®®ï¼Œæ€§èƒ½æ˜¾è‘—ä¼˜äºå…¶ä»–åºåˆ—åŒ–åè®®ã€‚è™½ç„¶é«˜æ•ˆï¼Œä½†å…¶å®<code>Dubbo</code>å¯¹è¿™ä¸¤æ¬¾çš„æ”¯æŒå´ä¸æ˜¯é‚£ä¹ˆç†æƒ³ï¼Œå¯¼è‡´ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›é—®é¢˜</p>
<h1 id="å¤šæœåŠ¡ä¸‹kryoåºåˆ—åŒ–é—®é¢˜"><a href="#å¤šæœåŠ¡ä¸‹kryoåºåˆ—åŒ–é—®é¢˜" class="headerlink" title="å¤šæœåŠ¡ä¸‹kryoåºåˆ—åŒ–é—®é¢˜"></a>å¤šæœåŠ¡ä¸‹<code>kryo</code>åºåˆ—åŒ–é—®é¢˜</h1><h2 id="Q1ã€æ— æ³•ä½¿ç”¨kryoç±»ç´¢å¼•çº¢åˆ©"><a href="#Q1ã€æ— æ³•ä½¿ç”¨kryoç±»ç´¢å¼•çº¢åˆ©" class="headerlink" title="Q1ã€æ— æ³•ä½¿ç”¨kryoç±»ç´¢å¼•çº¢åˆ©"></a>Q1ã€æ— æ³•ä½¿ç”¨<code>kryo</code>ç±»ç´¢å¼•çº¢åˆ©</h2><blockquote>
<p>åœ¨å¤šæ¨¡å—åä½œçš„ç³»ç»Ÿä¸­ï¼Œæ— æ³•ä¿è¯æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹<code>DTO</code>æ•°é‡ä»¥åŠæ³¨å†Œé¡ºåºçš„ä¸€è‡´ï¼Œå¯èƒ½Aä½œä¸ºæœåŠ¡æä¾›æ–¹ï¼Œæä¾›äº†<code>DTO</code>ï¼Œè€ŒBä½œä¸ºæ¶ˆè´¹æ–¹ï¼Œå¯èƒ½åŒæ—¶æ¶ˆè´¹Aã€Cçš„æœåŠ¡ï¼ŒåŒæ—¶è‡ªèº«ä¹Ÿå¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨ä½¿ç”¨<code>Kryo</code>åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åŒæ—¶æ³¨å†ŒAã€Bã€CæœåŠ¡çš„<code>DTO</code>ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚Aç³»ç»Ÿçš„<code>SerializationOptimizer</code>å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ASerializationOptimizerImpl</span> <span class="keyword">implements</span> <span class="title">SerializationOptimizer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> A1.class;</span><br><span class="line">        <span class="keyword">return</span> A2.class;</span><br><span class="line">        <span class="keyword">return</span> A3.class;</span><br><span class="line">        <span class="keyword">return</span> A4.class;</span><br><span class="line">        <span class="keyword">return</span> C1.class;</span><br><span class="line">        <span class="keyword">return</span> C2.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bç³»ç»Ÿçš„<code>SerializationOptimizer</code>å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BSerializationOptimizerImpl</span> <span class="keyword">implements</span> <span class="title">SerializationOptimizer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> A1.class;</span><br><span class="line">        <span class="keyword">return</span> A2.class;</span><br><span class="line">        <span class="keyword">return</span> A3.class;</span><br><span class="line">        <span class="keyword">return</span> A4.class;</span><br><span class="line">        <span class="keyword">return</span> B1.class;</span><br><span class="line">        <span class="keyword">return</span> B2.class;</span><br><span class="line">        <span class="keyword">return</span> C1.class;</span><br><span class="line">        <span class="keyword">return</span> C2.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>kryo</code>ä¹‹æ‰€ä»¥é«˜æ•ˆï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå…¶äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ›´ç”±äºå…¶å¯ä»¥é¢„å…ˆä¸ºå¾…åºåˆ—åŒ–çš„ç±»æŒ‡å®šç´¢å¼•ï¼Œåœ¨<code>RPC</code>ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä½¿ç”¨ç´¢å¼•ä»£æ›¿å…¨ç±»åï¼Œåœ¨ç±»ä½¿ç”¨éå¸¸é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥èŠ‚çœå¤§é‡å­—èŠ‚ï¼Œä»è€Œå¤§å¤§æå‡ä¼ è¾“æ•ˆç‡ã€‚</p>
<p>è€Œ<code>Dubbo</code>ä¼¼ä¹ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å°†ä¸€äº›ä½¿ç”¨é¢‘ç¹çš„ç±»è¿›è¡Œäº†é¢„å¤„ç†ï¼Œè§<code>org.apache.dubbo.common.serialize.kryo.utils.AbstractKryoFactory#create</code></p>
<p>ä½†æ˜¯å…¶ä¸­å¾ˆé‡è¦çš„ä¸€å¤„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SerializableClassRegistry.getRegisteredClasses().forEach((clazz, ser) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ser == <span class="keyword">null</span>) &#123;</span><br><span class="line">        kryo.register(clazz);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        kryo.register(clazz, (Serializer) ser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„æ˜¯<code>kryo.register(clazz)</code>ï¼Œæ— æ³•æŒ‡å®š<code>kryo class index</code>ï¼Œè¿™é‡Œæˆ‘åˆ†æäº†ä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹è€çš„åºåˆ—åŒ–åè®®ï¼Œæ¯”å¦‚<code>json</code>ç­‰ï¼Œè€Œä¸”<code>SerializableClassRegistry</code>æ˜¯å¾ˆæ—©å°±æœ‰çš„æ¥å£ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°ç±»ç´¢å¼•çš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œè¦æ³¨å†Œçš„è¯ï¼Œåªèƒ½å°†é¡¹ç›®å†…æ‰€æœ‰ç±»éƒ½å†™åˆ°åŒä¸€ä¸ª<code>jar</code>ä¸­ï¼Œç„¶åå†™ä¸€ä¸ªç»Ÿä¸€çš„<code>SerializationOptimizer</code>å®ç°ã€‚</p>
<p>è¿™åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡å¿…ç„¶ä¼šæä¾›è‡ªå·±çš„<code>dto.jar</code>å’Œ<code>dubbo-service.jar</code>ï¼Œè€Œä¸”æœåŠ¡ä¹‹é—´ä¹Ÿä¸å¯èƒ½ä¾èµ–å…¶ä»–æ‰€æœ‰çš„æœåŠ¡ï¼Œæ‰€ä»¥è¿™ä¸€æ¡æ— æ³•æ»¡è¶³ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œç±»çš„æ³¨å†Œé¡ºåºä¸èƒ½ä¿è¯ï¼Œç±»çš„æ•°é‡ä¹Ÿæ— æ³•ä¿è¯ï¼Œæ‰€ä»¥<code>Dubbo</code>çš„<code>kryo</code>åºåˆ—åŒ–åªèƒ½è¯´åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡äº†æ•ˆç‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨å‘æŒ¥å‡º<code>kryo</code>çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<h2 id="Q2ã€ç¤¾åŒºä¸æ´»è·ƒ"><a href="#Q2ã€ç¤¾åŒºä¸æ´»è·ƒ" class="headerlink" title="Q2ã€ç¤¾åŒºä¸æ´»è·ƒ"></a>Q2ã€ç¤¾åŒºä¸æ´»è·ƒ</h2><blockquote>
<p>è™½ç„¶é˜¿é‡Œé‡å¯äº†<code>Dubbo</code>ï¼Œå¹¶ä¸”åŠ å…¥äº†<code>Apache</code>è¿›è¡Œå­µåŒ–ï¼Œä½†æ˜¯ç¤¾åŒºç›¸è¾ƒäº<code>Spring Cloud</code>ï¼Œè¿˜æ˜¯ä¸å¤Ÿæ´»è·ƒï¼Œè€Œä¸”é˜¿é‡Œçš„å¼€æºäº§å“ï¼Œå¤šå¤šå°‘å°‘å¸¦äº†ç‚¹é˜¿é‡Œå†…éƒ¨çš„å‘³é“ï¼Œä¸å¦‚<code>Spring Cloud</code>é€šç”¨å’Œè€ƒè™‘å‘¨å…¨ã€‚ä¸€äº›åŠŸèƒ½æˆ‘ä»¬ä¸éœ€è¦ï¼ˆæ¯”å¦‚<code>dubbo</code>æ³¨å†Œæ—¶çš„ä¸€å †å‚æ•°ï¼Œå¾ˆå¤šéƒ½æ˜¯éœ€è¦é˜¿é‡Œçš„ä¸€å¥—å¼€å‘ä½“ç³»æ‰èƒ½ä½¿ç”¨åˆ°ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦çš„åˆè¿Ÿè¿Ÿä¸æ·»åŠ ï¼ˆ<code>kryo</code>çš„<code>ClassId</code>æ”¯æŒï¼‰ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ç›®å‰é¡¹ç›®å·²ç»å…¨é¢åˆ‡æ¢åˆ°<code>Spring Cloud Kubernetes</code>ï¼Œæœ‰æ—¶é—´ä¹Ÿä¼šæ€»ç»“ä¸€ä¸‹<code>Dubbo</code>åˆ‡æ¢åˆ°<code>Spring Cloud</code>çš„ç»éªŒï¼Œä»¥åŠåœ¨äº‘åŸç”Ÿæ—¶ä»£<code>Spring Cloud</code>æ‰€åšå‡ºçš„åŠªåŠ›ã€‚</p>
<h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ul>
<li><a href="https://github.com/apache/dubbo/issues/7015">Dubbo Issue</a></li>
<li><a href="https://dubbo.apache.org/zh/docs/v2.7/user/serialization/">Kryo å’Œ FST åºåˆ—åŒ–</a></li>
<li><a href="https://github.com/EsotericSoftware/kryo">Kryoåºåˆ—åŒ–åè®®</a></li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title>FastDFS å•æœºéƒ¨ç½²æŒ‡å—</title>
    <url>/p/56864/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œ<a href="https://www.oschina.net/p/fastdfs">å®˜æ–¹ä»‹ç»</a>æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œä¸å¤šèµ˜è¿°ã€‚æœ¬æ–‡ä¸»è¦æ˜¯FastDFSçš„æ­å»ºåŠé‡‡å‘æŒ‡å—ã€‚</p>
<span id="more"></span>

<h1 id="Step-By-Step-Guide"><a href="#Step-By-Step-Guide" class="headerlink" title="Step By Step Guide"></a>Step By Step Guide</h1><h2 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h2><ul>
<li>é˜¿é‡Œäº‘ECS Ubuntu 16.04</li>
</ul>
<h2 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h2><p>æŒ‰éœ€å®‰è£…ï¼Œè¿™é‡Œæ˜¯é’ˆå¯¹æ–°çš„ubuntuç³»ç»Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ apt-get install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim</span><br></pre></td></tr></table></figure>

<h2 id="ç£ç›˜ç›®å½•"><a href="#ç£ç›˜ç›®å½•" class="headerlink" title="ç£ç›˜ç›®å½•"></a>ç£ç›˜ç›®å½•</h2><table>
<thead>
<tr>
<th>è¯´æ˜</th>
<th>ä½ç½®</th>
</tr>
</thead>
<tbody><tr>
<td>æ‰€æœ‰å®‰è£…åŒ…</td>
<td>/usr/local/src</td>
</tr>
<tr>
<td>æ•°æ®å­˜å‚¨ä½ç½®</td>
<td>/data/dfs/</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir /data/dfs <span class="comment">#åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•ï¼ˆå¯¹äºé˜¿é‡Œäº‘ECSï¼Œæœ€å¥½å»ºç«‹åœ¨æ•°æ®ç›˜ä¸Šï¼Œæ˜¯ç”¨æ¥å­˜æ”¾æ–‡ä»¶çš„ï¼‰</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src <span class="comment">#åˆ‡æ¢åˆ°å®‰è£…ç›®å½•å‡†å¤‡ä¸‹è½½å®‰è£…åŒ…</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…libfatscommon"><a href="#å®‰è£…libfatscommon" class="headerlink" title="å®‰è£…libfatscommon"></a>å®‰è£…libfatscommon</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ wget https://github.com/happyfish100/libfastcommon/archive/master.zip</span><br><span class="line">$ unzip master.zip</span><br><span class="line">$ <span class="built_in">cd</span> libfastcommon-1.0.39/</span><br><span class="line">$ ./make.sh &amp;&amp; ./make.sh install <span class="comment">#ç¼–è¯‘å®‰è£…</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…FastDFS"><a href="#å®‰è£…FastDFS" class="headerlink" title="å®‰è£…FastDFS"></a>å®‰è£…FastDFS</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../ <span class="comment">#è¿”å›ä¸Šä¸€çº§ç›®å½•</span></span><br><span class="line">$ wget https://github.com/happyfish100/fastdfs/archive/master.zip</span><br><span class="line">$ unzip master.zip</span><br><span class="line">$ <span class="built_in">cd</span> fastdfs-master/</span><br><span class="line">$ ./make.sh &amp;&amp; ./make.sh install <span class="comment">#ç¼–è¯‘å®‰è£…</span></span><br><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶å‡†å¤‡</span></span><br><span class="line">$ cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf</span><br><span class="line">$ cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf</span><br><span class="line">$ cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf <span class="comment">#å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œæµ‹è¯•ç”¨</span></span><br><span class="line">$ cp /usr/<span class="built_in">local</span>/src/fastdfs-master/conf/http.conf /etc/fdfs/ <span class="comment">#ä¾›nginxè®¿é—®ä½¿ç”¨</span></span><br><span class="line">$ cp /etc/nginx/mime.types /etc/fdfs/ <span class="comment">#ä¾›nginxè®¿é—®ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…fastdfs-nginx-module"><a href="#å®‰è£…fastdfs-nginx-module" class="headerlink" title="å®‰è£…fastdfs-nginx-module"></a>å®‰è£…fastdfs-nginx-module</h2><p>å®˜ç½‘çš„æ–‡æ¡£ï¼Œæ˜¯é’ˆå¯¹æ²¡æœ‰å®‰è£…è¿‡Nginxçš„æœºå™¨ï¼Œé‡æ–°ç¼–è¯‘äº†ä¸€éNginxï¼ŒæŠŠmoduleç›´æ¥ç¼–è¯‘è¿›Nginxäº†ã€‚ä½†æ˜¯é’ˆå¯¹å·²ç»å®‰è£…Nginxçš„æœåŠ¡å™¨æ¥è¯´ï¼Œæ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚</p>
<p>æ ¹æ®<a href="https://www.nginx.com/blog/compiling-dynamic-modules-nginx-plus/">Nginxå®˜æ–¹æ–‡æ¡£-ç¼–è¯‘ç¬¬ä¸‰æ–¹åŠ¨æ€æ¨¡å—</a>ï¼Œç¼–è¯‘äº†<code>fastdfs-nginx-module</code>ï¼Œä»¥ä¾›å·²å­˜åœ¨çš„Nginxä½¿ç”¨ã€‚</p>
<p>æˆ‘å·²ç»ç¼–è¯‘å¥½äº†<code>fastdfs-nginx-module</code>ï¼Œå¯ä»¥<a href="https://github.com/gcdd1993/fastDFS-ubuntu-guide/blob/master/ngx_http_fastdfs_module.so">ç›´æ¥ä¸‹è½½</a>ï¼Œå¹¶è·³åˆ°<a href="#use-module">åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—</a>ï¼Œå¦‚æœæƒ³çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œå¯ä»¥å¾€ä¸‹çœ‹ã€‚</p>
<h3 id="å‡†å¤‡fastdfs-nginx-moduleæºç åŒ…"><a href="#å‡†å¤‡fastdfs-nginx-moduleæºç åŒ…" class="headerlink" title="å‡†å¤‡fastdfs-nginx-moduleæºç åŒ…"></a>å‡†å¤‡<code>fastdfs-nginx-module</code>æºç åŒ…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../ <span class="comment">#è¿”å›ä¸Šä¸€çº§ç›®å½•</span></span><br><span class="line">$ wget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zip</span><br><span class="line">$ unzip master.zip</span><br></pre></td></tr></table></figure>

<h3 id="è·å–å¯¹åº”ç‰ˆæœ¬çš„Nginxæºç åŒ…"><a href="#è·å–å¯¹åº”ç‰ˆæœ¬çš„Nginxæºç åŒ…" class="headerlink" title="è·å–å¯¹åº”ç‰ˆæœ¬çš„Nginxæºç åŒ…"></a>è·å–å¯¹åº”ç‰ˆæœ¬çš„Nginxæºç åŒ…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nginx -v <span class="comment"># ç¡®è®¤æœåŠ¡å™¨çš„Nginxç‰ˆæœ¬</span></span><br><span class="line">nginx version: nginx/1.14.2</span><br><span class="line">$ wget http://nginx.org/download/nginx-1.14.2.tar.gz</span><br><span class="line">$ tar -xzvf nginx-1.14.2.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘åŠ¨æ€æ¨¡å—"><a href="#ç¼–è¯‘åŠ¨æ€æ¨¡å—" class="headerlink" title="ç¼–è¯‘åŠ¨æ€æ¨¡å—"></a>ç¼–è¯‘åŠ¨æ€æ¨¡å—</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> nginx-1.14.2/</span><br><span class="line">$ ./configure --with-compat --add-dynamic-module=/usr/<span class="built_in">local</span>/src/fastdfs-nginx-module-master/src</span><br><span class="line">$ make modules</span><br></pre></td></tr></table></figure>

<h3 id="å°†æ¨¡å—åº“ï¼ˆ-soæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°-etc-nginx-modules"><a href="#å°†æ¨¡å—åº“ï¼ˆ-soæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°-etc-nginx-modules" class="headerlink" title="å°†æ¨¡å—åº“ï¼ˆ.soæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°/etc/nginx/modules"></a>å°†æ¨¡å—åº“ï¼ˆ.soæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°/etc/nginx/modules</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cp ngx_http_fastdfs_module.so /etc/nginx/modules/</span><br></pre></td></tr></table></figure>

<h3 id="åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—"><a href="#åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—" class="headerlink" title="åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—"></a>åŠ è½½å¹¶ä½¿ç”¨æ¨¡å—<a name="use-module"/></h3><p>Tips: è¦å°†æ¨¡å—åŠ è½½åˆ°Nginx,åœ¨nginx.confæ–‡ä»¶å¼€å¤´æ·»åŠ <code>load_module</code>å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/nginx.conf</span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">load_module modules/ngx_http_fastdfs_module.so;</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ FastDFSé…ç½®ä½¿æ¨¡å—ç”Ÿæ•ˆ"><a href="#æ·»åŠ FastDFSé…ç½®ä½¿æ¨¡å—ç”Ÿæ•ˆ" class="headerlink" title="æ·»åŠ FastDFSé…ç½®ä½¿æ¨¡å—ç”Ÿæ•ˆ"></a>æ·»åŠ FastDFSé…ç½®ä½¿æ¨¡å—ç”Ÿæ•ˆ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf.d/fastdfs.conf</span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8888;    <span class="comment">## è¯¥ç«¯å£ä¸ºstorage.confä¸­çš„http.server_portç›¸åŒ</span></span><br><span class="line">    server_name &#123;your_domain&#125;;</span><br><span class="line">    location ~/group[0-9]/ &#123;</span><br><span class="line">        ngx_fastdfs_module;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å•æœºéƒ¨ç½²"><a href="#å•æœºéƒ¨ç½²" class="headerlink" title="å•æœºéƒ¨ç½²"></a>å•æœºéƒ¨ç½²</h2><p>è¿™é‡Œåªæè¿°ä¸‹å•æœºç¯å¢ƒçš„éƒ¨ç½²æ–¹å¼ï¼Œé›†ç¾¤åœ¨å®˜æ–¹æ–‡æ¡£æœ‰ï¼Œæ²¡æœ‰å®é™…ä½¿ç”¨è¿‡ã€‚</p>
<h3 id="trackeré…ç½®"><a href="#trackeré…ç½®" class="headerlink" title="trackeré…ç½®"></a>trackeré…ç½®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/fdfs/tracker.conf</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">bind_addr=&#123;ä½ çš„å†…ç½‘IP&#125;</span><br><span class="line">base_path=/data/dfs <span class="comment"># å»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®</span></span><br><span class="line"><span class="comment"># å¯é€‰ä¿®æ”¹</span></span><br><span class="line">port=22122  <span class="comment"># trackeræœåŠ¡å™¨ç«¯å£</span></span><br></pre></td></tr></table></figure>

<h3 id="storageé…ç½®"><a href="#storageé…ç½®" class="headerlink" title="storageé…ç½®"></a>storageé…ç½®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/fdfs/storage.conf</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹</span></span><br><span class="line">base_path=/data/dfs  <span class="comment"># æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•ï¼ˆå»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®ï¼‰</span></span><br><span class="line">store_path0=/data/dfs  <span class="comment"># ç¬¬ä¸€ä¸ªå­˜å‚¨ç›®å½•ï¼ˆå»ºè®®ä¿®æ”¹ä¸ºæ•°æ®ç›˜ä½ç½®ï¼‰</span></span><br><span class="line">tracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125;  <span class="comment"># trackeræœåŠ¡å™¨IPå’Œç«¯å£</span></span><br><span class="line">http.server_port=8888  <span class="comment"># httpè®¿é—®æ–‡ä»¶çš„ç«¯å£ï¼ˆé»˜è®¤8888,çœ‹æƒ…å†µä¿®æ”¹,å’Œnginxä¸­ä¿æŒä¸€è‡´ï¼‰</span></span><br><span class="line"><span class="comment"># å¯é€‰ä¿®æ”¹</span></span><br><span class="line">port=23000  <span class="comment"># storageæœåŠ¡ç«¯å£ï¼ˆé»˜è®¤23000,ä¸€èˆ¬ä¸ä¿®æ”¹ï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="clientæµ‹è¯•"><a href="#clientæµ‹è¯•" class="headerlink" title="clientæµ‹è¯•"></a>clientæµ‹è¯•</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/fdfs/client.conf</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹</span></span><br><span class="line">base_path=/data/dfs</span><br><span class="line">tracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125;  <span class="comment"># trackeræœåŠ¡å™¨IPå’Œç«¯å£</span></span><br><span class="line"><span class="comment"># ä¿å­˜åæµ‹è¯•</span></span><br><span class="line">$ fdfs_upload_file /etc/fdfs/client.conf /usr/<span class="built_in">local</span>/src/nginx-1.14.2.tar.gz</span><br><span class="line">group1/M00/00/00/CgoKvlyUmi-AMVKDAA9-WL9wzEw.tar.gz <span class="comment"># ä¸‹è½½æ—¶é€šè¿‡è¯¥IDä¸‹è½½</span></span><br><span class="line"><span class="comment"># è¿”å›IDè¡¨ç¤ºæˆåŠŸ å¦‚ï¼šgroup1/M00/00/00/xx.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®nginxè®¿é—®"><a href="#é…ç½®nginxè®¿é—®" class="headerlink" title="é…ç½®nginxè®¿é—®"></a>é…ç½®nginxè®¿é—®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/fdfs/mod_fastdfs.conf</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹</span></span><br><span class="line">tracker_server=&#123;tracker.bind_addr&#125;:&#123;tracker.port&#125;  <span class="comment"># trackeræœåŠ¡å™¨IPå’Œç«¯å£</span></span><br><span class="line">url_have_group_name=<span class="literal">true</span></span><br><span class="line">store_path0=/data/dfs</span><br><span class="line"><span class="comment"># ä¿®æ”¹å®Œä¿å­˜</span></span><br><span class="line">$ nginx -s reload</span><br><span class="line">ngx_http_fastdfs_set pid=8364 <span class="comment"># çœ‹è§è¿™æ¡æ¶ˆæ¯è¯´æ˜nginxæ¨¡å—å¯åŠ¨æˆåŠŸäº†</span></span><br><span class="line">$ lsof -i:8888 <span class="comment"># æŸ¥çœ‹Nginxä¸‹è½½ç«¯å£æ˜¯å¦æ­£å¸¸å¯åŠ¨</span></span><br><span class="line">nginx   31061  root   10u  IPv4 20389985      0t0  TCP *:8888 (LISTEN)</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•ä¸‹è½½"><a href="#æµ‹è¯•ä¸‹è½½" class="headerlink" title="æµ‹è¯•ä¸‹è½½"></a>æµ‹è¯•ä¸‹è½½</h3><p>åœ¨æµè§ˆå™¨è¾“å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://&#123;IP&#125;:8888/group1/M00/00/00/CgoKvlyUmi-AMVKDAA9-WL9wzEw.tar.gz?filename=nginx-1.14.2.tar.gz //åˆšæ‰ä¸Šä¼ è¿”å›çš„ID</span><br></pre></td></tr></table></figure>

<p>å¼¹å‡ºä¸‹è½½æ–‡ä»¶æ¡†ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼</p>
<p><img data-src="https://i.loli.net/2019/03/22/5c94a6b526a52.png"></p>
<h2 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h2><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">enable</span>|<span class="built_in">disable</span></span><br></pre></td></tr></table></figure>

<h3 id="tracker"><a href="#tracker" class="headerlink" title="tracker"></a>tracker</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /etc/init.d/fdfs_trackerd start <span class="comment"># å¯åŠ¨trackeræœåŠ¡</span></span><br><span class="line">$ /etc/init.d/fdfs_trackerd restart <span class="comment"># é‡å¯åŠ¨trackeræœåŠ¡</span></span><br><span class="line">$ /etc/init.d/fdfs_trackerd stop <span class="comment"># åœæ­¢trackeræœåŠ¡</span></span><br><span class="line">$ update-rc.d fdfs_trackerd <span class="built_in">enable</span> <span class="comment"># è‡ªå¯åŠ¨trackeræœåŠ¡</span></span><br></pre></td></tr></table></figure>

<h3 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /etc/init.d/fdfs_storaged start <span class="comment"># å¯åŠ¨storageæœåŠ¡</span></span><br><span class="line">$ /etc/init.d/fdfs_storaged restart <span class="comment"># é‡åŠ¨storageæœåŠ¡</span></span><br><span class="line">$ /etc/init.d/fdfs_storaged stop <span class="comment"># åœæ­¢åŠ¨storageæœåŠ¡</span></span><br><span class="line">$ update-rc.d fdfs_storaged <span class="built_in">enable</span> <span class="comment"># è‡ªå¯åŠ¨storageæœåŠ¡</span></span><br></pre></td></tr></table></figure>

<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ service nginx start <span class="comment"># å¯åŠ¨nginx</span></span><br><span class="line">$ nginx -s reload <span class="comment"># é‡å¯nginx</span></span><br><span class="line">$ nginx -s stop <span class="comment"># åœæ­¢nginx</span></span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="æ‰§è¡Œnginx-s-reload-åï¼Œè®¿é—®502"><a href="#æ‰§è¡Œnginx-s-reload-åï¼Œè®¿é—®502" class="headerlink" title="æ‰§è¡Œnginx -s reload åï¼Œè®¿é—®502"></a>æ‰§è¡Œnginx -s reload åï¼Œè®¿é—®502</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹nginxæ—¥å¿—</span></span><br><span class="line">$ vim /var/<span class="built_in">log</span>/nginx/error.log</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‘ç°é”™è¯¯æ—¥å¿—ï¼š<code>include file &quot;http.conf&quot; not exists, line: &quot;#include http.conf&quot;</code>ï¼Œfastdfs nginxæ¨¡å—ç¼ºå°‘é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¡¥å…¨é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cp /usr/<span class="built_in">local</span>/src/fastdfs-master/conf/http.conf /etc/fdfs/ <span class="comment">#ä¾›nginxè®¿é—®ä½¿ç”¨</span></span><br><span class="line">$ cp /etc/nginx/mime.types /etc/fdfs/ <span class="comment">#ä¾›nginxè®¿é—®ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>FastDFS</tag>
      </tags>
  </entry>
  <entry>
    <title>EntityManagerçš„Clearæ–¹æ³•çš„ä½¿ç”¨</title>
    <url>/p/12153/</url>
    <content><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœä½¿ç”¨hibernateçš„è¯ï¼Œå¸¸å¸¸ä¼šè¢«hibernateçš„äº‹åŠ¡æå¾—ç„¦å¤´çƒ‚é¢ã€‚ä»Šå¤©è§£å†³äº†ä¹‹å‰é¡¹ç›®ä¸­ä¸€ç›´å­˜åœ¨çš„é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ã€‚<span id="more"></span></p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>æœ‰ä¸€å¼ è¡¨TemplateCopy,å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplateCopy</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;template&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;SubDomainWeightsCopy&gt; subDomainWeights;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;template&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;QuestionWeightsCopy&gt; questionWeights;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³è”äº†ä¸¤å¼ è¡¨:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubDomainWeightsCopy</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;template_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> TemplateCopy template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;sub_domain_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> SubDomainCopy subDomain;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal weights; <span class="comment">//æƒé‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal score;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RelationId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Integer template;</span><br><span class="line">        <span class="keyword">private</span> Integer subDomain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuestionWeightsCopy</span> <span class="keyword">implements</span> <span class="title">IWeightsValue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;template_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> TemplateCopy template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;question_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> QuestionCopy question;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal weights;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal score;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RelationId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Integer template;</span><br><span class="line">        <span class="keyword">private</span> Integer question;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•çš„çœ‹ä¸€ä¸‹ï¼ŒTemplateCopyä¸­æœ‰ä¸€å †SubDomainWeightsCopyï¼Œå’Œä¸€å †QuestionWeightsCopyï¼Œæˆ‘ä»¬åœ¨ä¿å­˜TemplateCopyçš„æ—¶å€™ï¼Œé€šå¸¸æŒ‰ç…§å¦‚ä¸‹æ¥ä¿å­˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> templateCopy = save(TemplateCopy)</span><br><span class="line"><span class="number">2.</span> QuestionWeightsCopy.setTemplateCopy(templateCopy)</span><br><span class="line"><span class="number">3.</span> save(QuestionWeightsCopy)</span><br><span class="line"><span class="number">4.</span> SubDomainWeightsCopy.setTemplateCopy(templateCopy)</span><br><span class="line"><span class="number">5.</span> save(SubDomainWeightsCopy)</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™å°±å¥½äº†ï¼Œæ•°æ®åº“å·²ç»ä¿å­˜äº†å…³è”å…³ç³»ã€‚ä½†æ˜¯ï¼Œè¿™æ—¶å€™å¦‚æœè¿”å›saveå¥½çš„templateCopyï¼ŒsubDomainWeightså’ŒquestionWeightså°†ä¼šæ˜¯nullã€‚</p>
<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><h2 id="ä½¿ç”¨EntityManagerçš„clearæ–¹æ³•"><a href="#ä½¿ç”¨EntityManagerçš„clearæ–¹æ³•" class="headerlink" title="ä½¿ç”¨EntityManagerçš„clearæ–¹æ³•"></a>ä½¿ç”¨EntityManagerçš„clearæ–¹æ³•</h2><ol>
<li>ä¿å­˜å®Œæ¯•åï¼Œæ‰§è¡ŒentityManager.clear();</li>
<li>ç„¶åå†æ¬¡æŸ¥è¯¢è¯¥å¯¹è±¡ï¼Œå³å¯å®Œæ•´è¿”å›è¯¥å¯¹è±¡ã€‚</li>
</ol>
<h3 id="EntityManager-clearçš„ä½œç”¨ï¼Ÿ"><a href="#EntityManager-clearçš„ä½œç”¨ï¼Ÿ" class="headerlink" title="EntityManager clearçš„ä½œç”¨ï¼Ÿ"></a>EntityManager clearçš„ä½œç”¨ï¼Ÿ</h3><p>EntityManager clearæ–¹æ³•ä¼šæ¸…ç©ºå…¶å…³è”çš„ç¼“å­˜ï¼Œä»è€Œå¼ºåˆ¶åœ¨äº‹åŠ¡ä¸­ç¨åæ‰§è¡Œæ–°çš„æ•°æ®åº“æŸ¥è¯¢ã€‚</p>
<h3 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨EntityManager-clear"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨EntityManager-clear" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨EntityManager clear"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨EntityManager clear</h3><ol>
<li>åœ¨è¿›è¡Œæ‰¹å¤„ç†æ—¶ï¼Œä¸ºäº†é¿å…å·¨å¤§çš„ç¼“å­˜å ç”¨å†…å­˜å¹¶å› é•¿æ—¶é—´çš„è„æ£€æŸ¥è€Œå¢åŠ åˆ·æ–°çš„æ—¶é—´</li>
<li>åœ¨è¿›è¡ŒDMLæˆ–SQLæŸ¥è¯¢æ—¶ï¼Œå®ƒå°†å®Œå…¨ç»•è¿‡å®ä½“ç®¡ç†å™¨ç¼“å­˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºç¼“å­˜ï¼Œå°†ä¸ä¼šå®é™…å»æ•°æ®åº“æŸ¥ï¼Œä¼šç›´æ¥å°†ç¼“å­˜è¿”å›ã€‚æ‰€ä»¥é€ æˆäº†æ•°æ®åº“å·²ç»ä¿å­˜äº†ï¼Œä½†æ˜¯æŸ¥å‡ºæ¥è¿˜æ˜¯æœªä¿å­˜çš„çŠ¶æ€ã€‚è¿™æ—¶å€™éœ€è¦æ¸…é™¤ç¼“å­˜ä»¥é¿å…è¿™ç§ä¸ä¸€è‡´ã€‚(æœ¬æ¡ˆä¾‹å°±æ˜¯è¿™ç§æƒ…å†µçš„å®é™…ä¾‹å­)</li>
</ol>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://stackoverflow.com/questions/13886608/when-to-use-entitymanager-clear" title="StackOverFlowå¤§ç¥å›ç­”">StackOverFlowå¤§ç¥å›ç­”</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Gradle é…ç½®ç‰‡æ®µ</title>
    <url>/p/9306/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»<code>Gradle</code>å¸¸ç”¨é…ç½®ï¼Œæœ¬äººå¾ˆæ—©å°±å¼€å§‹ä½¿ç”¨<code>Gradle</code>ä»£æ›¿<code>Maven</code>ä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ï¼Œ<code>Gradle</code>ç›¸è¾ƒäº<code>Maven</code>ç¹ççš„XMLé…ç½®æ¥è¯´ï¼Œç¡®å®æ›´ä¸ºå…ˆè¿›ï¼Œä¾æ‰˜äº<code>Groovy</code>è„šæœ¬çš„å¼ºå¤§ï¼Œä¹Ÿæ›´åŠ çµæ´»ã€‚</p>
<span id="more"></span>

<h1 id="1ã€Jetbrains-IDEAè®¾ç½®Gradleä¸è‡ªåŠ¨åˆ›å»ºæ¨¡å—"><a href="#1ã€Jetbrains-IDEAè®¾ç½®Gradleä¸è‡ªåŠ¨åˆ›å»ºæ¨¡å—" class="headerlink" title="1ã€Jetbrains IDEAè®¾ç½®Gradleä¸è‡ªåŠ¨åˆ›å»ºæ¨¡å—"></a>1ã€<code>Jetbrains IDEA</code>è®¾ç½®<code>Gradle</code>ä¸è‡ªåŠ¨åˆ›å»ºæ¨¡å—</h1><blockquote>
<p>åœ¨IDEAæŸä¸ªç‰ˆæœ¬ä¹‹åï¼Œåˆ›å»ºæˆ–å¯¼å…¥Gradleé¡¹ç›®çš„æ—¶å€™ï¼Œæ— æ³•å†å–æ¶ˆå‹¾é€‰<code>Create separate module per source set</code>ï¼Œå¤šå°‘æœ‰ç‚¹å¼ºåŠ çš„æ„æ€ï¼Œå› ä¸ºè‡ªåŠ¨ä¸ºæ¯ä¸ªèµ„æºæ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ¨¡å—å¤šäº†ä»¥åï¼Œä¼šå‡ºç°æ„æ–™ä¹‹å¤–çš„é”™è¯¯ï¼Œæ¯”å¦‚æŸä¸ªä¾èµ–æ— æ³•åŠ è½½ç­‰é—®é¢˜</p>
</blockquote>
<p><img data-src="https://i.loli.net/2021/06/20/B7wOGUqHK62mQ9C.png"></p>
<p>ç¼–è¾‘<code>.idea/gradle.xml</code>ï¼ŒåŠ ä¸Šä¸€è¡Œ<code>&lt;option name=&quot;resolveModulePerSourceSet&quot; value=&quot;false&quot; /&gt;</code>å°±è¡Œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">version</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;GradleMigrationSettings&quot;</span> <span class="attr">migrationVersion</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;GradleSettings&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;linkedExternalProjectsSettings&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">GradleProjectSettings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;delegatedBuild&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;testRunner&quot;</span> <span class="attr">value</span>=<span class="string">&quot;GRADLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;distributionType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOCAL&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;externalProjectPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$PROJECT_DIR$&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;gradleHome&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$PROJECT_DIR$/../../../../DevTools/Gradle/gradle-6.8.3&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;gradleJvm&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#JAVA_HOME&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;resolveModulePerSourceSet&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">GradleProjectSettings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°å¯¼å…¥<code>Gradle</code>é¡¹ç›®</p>
<h1 id="2ã€ä½¿ç”¨é˜¿é‡Œäº‘Mavenä»“åº“åŠ é€Ÿä¾èµ–ä¸‹è½½"><a href="#2ã€ä½¿ç”¨é˜¿é‡Œäº‘Mavenä»“åº“åŠ é€Ÿä¾èµ–ä¸‹è½½" class="headerlink" title="2ã€ä½¿ç”¨é˜¿é‡Œäº‘Mavenä»“åº“åŠ é€Ÿä¾èµ–ä¸‹è½½"></a>2ã€ä½¿ç”¨é˜¿é‡Œäº‘<code>Maven</code>ä»“åº“åŠ é€Ÿä¾èµ–ä¸‹è½½</h1><blockquote>
<p><code>Gradle 6.8.3</code>å³ä»¥ä¸Šé€‚ç”¨</p>
</blockquote>
<p>ç¼–è¾‘<code>settings.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">pluginManagement &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        repositories &#123;</span><br><span class="line">            maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> &#125;</span><br><span class="line">            maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/gradle-plugin&#x27;</span> &#125;</span><br><span class="line">            maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/public/&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mavenCentral()</span><br><span class="line">        gradlePluginPortal()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencyResolutionManagement &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/central&quot;</span>) &#125; <span class="comment">// central</span></span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/public&quot;</span>) &#125; <span class="comment">// jcenter &amp; public</span></span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/google&quot;</span>) &#125; <span class="comment">// google</span></span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/spring&quot;</span>) &#125; <span class="comment">// spring</span></span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/spring-plugin&quot;</span>) &#125; <span class="comment">// spring plugin</span></span><br><span class="line">        maven &#123; url = uri(<span class="string">&quot;https://maven.aliyun.com/repository/grails-core&quot;</span>) &#125; <span class="comment">// spring plugin</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">rootProject.name = <span class="string">&#x27;my-prject&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="3ã€maven-publish-gradle"><a href="#3ã€maven-publish-gradle" class="headerlink" title="3ã€maven-publish.gradle"></a>3ã€<code>maven-publish.gradle</code></h1><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// jaræ·»åŠ ä»¥ä¸‹æ’ä»¶</span></span><br><span class="line"><span class="comment">//plugins &#123;</span></span><br><span class="line"><span class="comment">//    id &#x27;java-library&#x27;</span></span><br><span class="line"><span class="comment">//    id &#x27;maven-publish&#x27;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">// bomæ·»åŠ ä»¥ä¸‹æ’ä»¶</span></span><br><span class="line"><span class="comment">//plugins &#123;</span></span><br><span class="line"><span class="comment">//    id &#x27;java-platform&#x27;</span></span><br><span class="line"><span class="comment">//    id &#x27;maven-publish&#x27;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> artifactory = <span class="string">&#x27;https://packages.aliyun.com/maven/repository/&#x27;</span></span><br><span class="line"><span class="keyword">def</span> releasePath = <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="keyword">def</span> snapshotsPath = <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="keyword">def</span> mavenName = <span class="string">&#x27;my-project&#x27;</span></span><br><span class="line">afterEvaluate &#123; Project project -&gt;</span><br><span class="line">    <span class="keyword">if</span> (project.plugins.hasPlugin(<span class="string">&quot;maven-publish&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (project.plugins.hasPlugin(<span class="string">&quot;java&quot;</span>)) &#123;</span><br><span class="line">            java &#123;</span><br><span class="line">                withSourcesJar()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        publishing &#123;</span><br><span class="line">            repositories &#123;</span><br><span class="line">                maven &#123;</span><br><span class="line">                    name <span class="string">&quot;$&#123;mavenName&#125;&quot;</span></span><br><span class="line">                    url = <span class="string">&quot;$&#123;artifactory&#125;$&#123;(version.endsWith(&#x27;SNAPSHOT&#x27;) ? snapshotsPath : releasePath)&#125;&quot;</span></span><br><span class="line">                    credentials &#123;</span><br><span class="line">                        username <span class="string">&quot;$&#123;maven_username&#125;&quot;</span></span><br><span class="line">                        password <span class="string">&quot;$&#123;maven_password&#125;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    authentication &#123;</span><br><span class="line">                        basic(BasicAuthentication)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            publications &#123;</span><br><span class="line">                omac(MavenPublication) &#123;</span><br><span class="line">                    from components.java</span><br><span class="line">                    versionMapping &#123;</span><br><span class="line">                        usage(<span class="string">&#x27;java-api&#x27;</span>) &#123;</span><br><span class="line">                            fromResolutionOf(<span class="string">&#x27;runtimeClasspath&#x27;</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                        usage(<span class="string">&#x27;java-runtime&#x27;</span>) &#123;</span><br><span class="line">                            fromResolutionResult()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>build.gradle</code>å¼•å…¥å³å¯</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">apply <span class="attr">from:</span> <span class="string">&quot;$&#123;rootDir&#125;/gradle/maven-publish.gradle&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="4ã€docker-gradle"><a href="#4ã€docker-gradle" class="headerlink" title="4ã€docker.gradle"></a>4ã€<code>docker.gradle</code></h1><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">afterEvaluate &#123;</span><br><span class="line">    <span class="keyword">if</span> (pluginManager.hasPlugin(<span class="string">&quot;application&quot;</span>)) &#123;</span><br><span class="line">        task archiveDeps(<span class="attr">type:</span> Tar) &#123; task -&gt;</span><br><span class="line">            <span class="keyword">def</span> dependencies = task.project.configurations.runtimeClasspath.fileCollection &#123; <span class="literal">true</span> &#125;</span><br><span class="line">            from dependencies.sort()</span><br><span class="line">            compression = Compression.GZIP</span><br><span class="line">            archiveFileName = <span class="string">&quot;dep-libs.tar.gz&quot;</span></span><br><span class="line">            from jar.archiveFile</span><br><span class="line">            destinationDirectory = file(<span class="string">&quot;$buildDir/docker&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        task copyDeps(<span class="attr">type:</span> Copy) &#123;</span><br><span class="line">            dependsOn(archiveDeps)</span><br><span class="line">            from tarTree(resources.gzip(<span class="string">&quot;$buildDir/docker/dep-libs.tar.gz&quot;</span>))</span><br><span class="line">            into <span class="string">&quot;$buildDir/docker/libs/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        task copyApp(<span class="attr">type:</span> Copy) &#123;</span><br><span class="line">            dependsOn(jar, startScripts)</span><br><span class="line">            from <span class="string">&quot;$buildDir/scripts/&quot;</span></span><br><span class="line">            from jar.outputs</span><br><span class="line">            into <span class="string">&quot;$buildDir/docker/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        task prepare() &#123;</span><br><span class="line">            dependsOn(copyApp, copyDeps)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ’ä»¶<code>application</code></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&quot;application&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶é…åˆä»¥ä¸‹<code>Dockerfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># First stage: complete build environment</span></span><br><span class="line"><span class="keyword">FROM</span> registry.cn-shanghai.aliyuncs.com/halmawork/gradle:<span class="number">6.8</span>.<span class="number">3</span>-jdk11-openj9 AS builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> MAVEN_USERNAME</span><br><span class="line"><span class="keyword">ARG</span> MAVEN_PASSWORD</span><br><span class="line"><span class="keyword">ARG</span> MODULE</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;org.gradle.daemon=false&quot;</span> &gt;&gt; ~/.gradle/gradle.properties \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;org.gradle.parallel=true&quot;</span> &gt;&gt; ~/.gradle/gradle.properties \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;maven_username=<span class="variable">$MAVEN_USERNAME</span>&quot;</span> &gt;&gt; ~/.gradle/gradle.properties \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;maven_password=<span class="variable">$MAVEN_PASSWORD</span>&quot;</span> &gt;&gt; ~/.gradle/gradle.properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /builder</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /builder</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># package jar</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> gradle :<span class="variable">$MODULE</span>:clean :<span class="variable">$MODULE</span>:prepare</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Second stage: minimal runtime environment</span></span><br><span class="line"><span class="keyword">FROM</span> adoptopenjdk/openjdk11:jre</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MODULE <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> name=<span class="variable">$MODULE</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -fs /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime \</span></span><br><span class="line"><span class="bash">    &amp;&amp; dpkg-reconfigure -f noninteractive tzdata</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /builder/build/docker/libs/*.jar /app/lib/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /builder/build/docker/<span class="variable">$MODULE</span> /app/bin/run</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /builder/build/docker/<span class="variable">$MODULE</span>-*.jar /app/lib/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/app/bin/run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…<code>docker</code>é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -f gradle/Dockerfile -t gcdd1993/demo:latest-snapshot .</span><br></pre></td></tr></table></figure>

<h1 id="5ã€æ”¯æŒkotlin"><a href="#5ã€æ”¯æŒkotlin" class="headerlink" title="5ã€æ”¯æŒkotlin"></a>5ã€æ”¯æŒ<code>kotlin</code></h1><p><code>gradle.properties</code></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">kotlin_version</span>=<span class="string">1.5.10</span></span><br></pre></td></tr></table></figure>

<p><code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&quot;org.jetbrains.kotlin.jvm&quot;</span> version <span class="string">&quot;$&#123;kotlin_version&#125;&quot;</span> apply <span class="literal">false</span> <span class="comment">// jvm æ’ä»¶</span></span><br><span class="line">    id <span class="string">&quot;org.jetbrains.kotlin.plugin.spring&quot;</span> version <span class="string">&quot;$&#123;kotlin_version&#125;&quot;</span> apply <span class="literal">false</span> <span class="comment">// spring æ’ä»¶ï¼Œallopen æ’ä»¶</span></span><br><span class="line">    id <span class="string">&quot;org.jetbrains.kotlin.kapt&quot;</span> version <span class="string">&quot;$&#123;kotlin_version&#125;&quot;</span> apply <span class="literal">false</span> <span class="comment">// kaptï¼Œä»£æ›¿annotationProcessor</span></span><br><span class="line">    id <span class="string">&quot;org.jetbrains.kotlin.plugin.noarg&quot;</span> version <span class="string">&quot;$&#123;kotlin_version&#125;&quot;</span> apply <span class="literal">false</span> <span class="comment">// ç”¨äºè‡ªå®šä¹‰æ³¨è§£ç”Ÿæˆno arg constructor</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.jetbrains.kotlin.jvm&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.jetbrains.kotlin.plugin.spring&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.jetbrains.kotlin.kapt&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.jetbrains.kotlin.plugin.noarg&quot;</span></span><br><span class="line"></span><br><span class="line">compileKotlin &#123;</span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        freeCompilerArgs = [<span class="string">&quot;-Xjsr305=warn&quot;</span>]</span><br><span class="line">        jvmTarget = <span class="string">&quot;11&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">noArg &#123;</span><br><span class="line">    annotation(<span class="string">&quot;io.github.gcdd1993.NoArg&quot;</span>) <span class="comment">// è¯¥æ³¨è§£æ³¨é‡Šçš„classï¼Œä¼šç”ŸæˆNoArg Constructor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6ã€é™åˆ¶é¡¹ç›®JDKç‰ˆæœ¬"><a href="#6ã€é™åˆ¶é¡¹ç›®JDKç‰ˆæœ¬" class="headerlink" title="6ã€é™åˆ¶é¡¹ç›®JDKç‰ˆæœ¬"></a>6ã€é™åˆ¶é¡¹ç›®<code>JDK</code>ç‰ˆæœ¬</h1><blockquote>
<p>å¯¹äºå¤šäººååŒæ—¶ï¼Œå¾ˆæœ‰ç”¨ï¼Œé¿å…å› ä¸º<code>JDK</code>ç‰ˆæœ¬ä¸ä¸€å¯¼è‡´çš„å„ç§é—®é¢˜</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> javaVersion = System.getProperty(<span class="string">&quot;java.version&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (!javaVersion.startsWith(<span class="string">&quot;11&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Incompatible JRE version: &quot;</span> + javaVersion + <span class="string">&quot;. Use JRE 11 instead.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7ã€ä¸ºé¡¹ç›®ç¼–è¯‘jaræ–‡ä»¶æ·»åŠ é¡¹ç›®ç¼–è¯‘ä¿¡æ¯"><a href="#7ã€ä¸ºé¡¹ç›®ç¼–è¯‘jaræ–‡ä»¶æ·»åŠ é¡¹ç›®ç¼–è¯‘ä¿¡æ¯" class="headerlink" title="7ã€ä¸ºé¡¹ç›®ç¼–è¯‘jaræ–‡ä»¶æ·»åŠ é¡¹ç›®ç¼–è¯‘ä¿¡æ¯"></a>7ã€ä¸ºé¡¹ç›®ç¼–è¯‘<code>jar</code>æ–‡ä»¶æ·»åŠ é¡¹ç›®ç¼–è¯‘ä¿¡æ¯</h1><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&quot;org.springframework.boot&quot;</span> version <span class="string">&quot;$&#123;spring_boot_version&#125;&quot;</span> apply <span class="literal">false</span></span><br><span class="line">    id <span class="string">&quot;com.gorylenko.gradle-git-properties&quot;</span> version <span class="string">&quot;2.2.4&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;io.spring.dependency-management&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.springframework.boot&quot;</span></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes(</span><br><span class="line">            <span class="string">&quot;Implementation-Title&quot;</span>: project.name,</span><br><span class="line">            <span class="string">&quot;Implementation-Version&quot;</span>: project.version,</span><br><span class="line">            <span class="string">&quot;Built-By&quot;</span>: System.properties[<span class="string">&quot;user.name&quot;</span>],</span><br><span class="line">            <span class="string">&quot;Build-Timestamp&quot;</span>: <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSZ&quot;</span>).format(<span class="keyword">new</span> Date()),</span><br><span class="line">            <span class="string">&quot;Created-By&quot;</span>: <span class="string">&quot;Gradle $&#123;gradle.gradleVersion&#125;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Build-Jdk&quot;</span>: <span class="string">&quot;$&#123;System.properties[&quot;</span>java.version<span class="string">&quot;]&#125; ($&#123;System.properties[&quot;</span>java.vendor<span class="string">&quot;]&#125; $&#123;System.properties[&quot;</span>java.vm.version<span class="string">&quot;]&#125;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Build-OS&quot;</span>: <span class="string">&quot;$&#123;System.properties[&quot;</span>os.name<span class="string">&quot;]&#125; $&#123;System.properties[&quot;</span>os.arch<span class="string">&quot;]&#125; $&#123;System.properties[&quot;</span>os.version<span class="string">&quot;]&#125;&quot;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">springBoot &#123;</span><br><span class="line">    buildInfo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯<code>Spring Boot</code>é¡¹ç›®ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ‰“å°å‡ºç¼–è¯‘ä¿¡æ¯</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‰“å°åº”ç”¨åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gcdd1993</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppInfoPreviewAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> log = LoggerFactory.getLogger(javaClass)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> gitProperties: GitProperties? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> buildProperties: BuildProperties? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">&quot;\$&#123;spring.application.name&#125;&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> name: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener(ApplicationStartedEvent::class)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onBootUp</span><span class="params">(event: <span class="type">ApplicationStartedEvent</span>?)</span></span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125; Started.&quot;</span>, name)</span><br><span class="line">        <span class="keyword">if</span> (buildProperties != <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;build.name : &#123;&#125;&quot;</span>, buildProperties.name)</span><br><span class="line">            log.info(<span class="string">&quot;build.artifact : &#123;&#125;&quot;</span>, buildProperties.artifact)</span><br><span class="line">            log.info(<span class="string">&quot;build.group : &#123;&#125;&quot;</span>, buildProperties.group)</span><br><span class="line">            log.info(<span class="string">&quot;build.version : &#123;&#125;&quot;</span>, buildProperties.version)</span><br><span class="line">            log.info(<span class="string">&quot;build.time : &#123;&#125;&quot;</span>, buildProperties.time.atZone(ZoneId.systemDefault()).toLocalDateTime())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;cannot find any build properties file from this project. please reference: https://stackoverflow.com/questions/47283048/how-to-capture-build-info-using-gradle-and-spring-boot.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (gitProperties != <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;commit.branch : &#123;&#125;&quot;</span>, gitProperties.branch)</span><br><span class="line">            log.info(<span class="string">&quot;commit.commit.id : &#123;&#125;&quot;</span>, gitProperties.commitId)</span><br><span class="line">            log.info(<span class="string">&quot;commit.commit.time : &#123;&#125;&quot;</span>, gitProperties.commitTime.atZone(ZoneId.systemDefault()).toLocalDateTime())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;cannot find any git properties file from this project. please add gradle plugin: https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Gradle</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®‰å…¨ç¬”è®°</title>
    <url>/p/10700/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åç«¯æ¥å£å¼€å‘ä¸­ï¼Œæ¶‰åŠåˆ°ç”¨æˆ·ç§å¯†ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ç­‰ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ è¾“æ˜æ–‡ï¼Œå¿…é¡»ä½¿ç”¨åŠ å¯†æ–¹å¼ä¼ è¾“ã€‚è¿™æ¬¡æ”¿åºœé¡¹ç›®ä¸­ï¼Œå®‰å…¨æµ‹è¯•ç»„æå‡ºäº†æ˜æ–‡ä¼ è¾“æ¼æ´ï¼ŒæŠ½ç©ºç ”ç©¶äº†ä¸‹JavaåŠ è§£å¯†ç›¸å…³çŸ¥è¯†ï¼Œè®°å½•ä¸‹ã€‚</p>
<span id="more"></span>

<h1 id="æ•£åˆ—å‡½æ•°"><a href="#æ•£åˆ—å‡½æ•°" class="headerlink" title="æ•£åˆ—å‡½æ•°"></a>æ•£åˆ—å‡½æ•°</h1><p>Javaæä¾›äº†ä¸€ä¸ªåä¸º<code>MessageDigest</code>çš„ç±»ï¼Œå®ƒå±äº<code>java.security</code>åŒ…ã€‚ æ­¤ç±»æ”¯æŒè¯¸å¦‚<code>SHA-1</code>ï¼Œ<code>SHA 256</code>ï¼Œ<code>MD5</code>ä¹‹ç±»çš„ç®—æ³•ï¼Œä»¥å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯è½¬æ¢ä¸ºä¿¡æ¯æ‘˜è¦ã€‚</p>
<p>æ•£åˆ—å‡½æ•°è¿”å›çš„å€¼ç§°ä¸ºä¿¡æ¯æ‘˜è¦æˆ–ç®€ç§°æ•£åˆ—å€¼ã€‚ ä¸‹å›¾è¯´æ˜äº†æ•£åˆ—å‡½æ•°ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/10/5cade05f6faf5.png"></p>
<p>è¦ä½¿ç”¨æ•£åˆ—å‡½æ•°åŠ å¯†æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š</p>
<h2 id="åˆ›å»ºMessageDigestå¯¹è±¡"><a href="#åˆ›å»ºMessageDigestå¯¹è±¡" class="headerlink" title="åˆ›å»ºMessageDigestå¯¹è±¡"></a>åˆ›å»ºMessageDigestå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>MessageDigest</code>æä¾›äº†<code>getInstance</code>é™æ€æ–¹æ³•æ¥è·å¾—<code>MessageDigest</code>å®ä¾‹ï¼Œæ”¯æŒçš„ç±»å‹å¯å‚è€ƒ<a href="https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F">Wiki-SHAå®¶æ—</a></p>
</blockquote>
<h2 id="å°†æ•°æ®ä¼ é€’ç»™åˆ›å»ºçš„MessageDigestå¯¹è±¡"><a href="#å°†æ•°æ®ä¼ é€’ç»™åˆ›å»ºçš„MessageDigestå¯¹è±¡" class="headerlink" title="å°†æ•°æ®ä¼ é€’ç»™åˆ›å»ºçš„MessageDigestå¯¹è±¡"></a>å°†æ•°æ®ä¼ é€’ç»™åˆ›å»ºçš„MessageDigestå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">md.update(<span class="string">&quot;gcdd1993&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦"><a href="#ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦" class="headerlink" title="ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦"></a>ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] digest = md.digest();</span><br></pre></td></tr></table></figure>

<h2 id="é€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶è½¬æ¢ä¸ºHexå­—ç¬¦ä¸²"><a href="#é€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶è½¬æ¢ä¸ºHexå­—ç¬¦ä¸²" class="headerlink" title="é€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶è½¬æ¢ä¸ºHexå­—ç¬¦ä¸²"></a>é€šå¸¸æˆ‘ä»¬ä¼šå°†å…¶è½¬æ¢ä¸ºHexå­—ç¬¦ä¸²</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuffer hexString = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">byte</span> aDigest : digest) &#123;</span><br><span class="line">    hexString.append(Integer.toHexString(<span class="number">0xFF</span> &amp; aDigest));</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;Hex format : &quot;</span> + hexString.toString());</span><br></pre></td></tr></table></figure>

<h1 id="æ¶ˆæ¯è®¤è¯ç "><a href="#æ¶ˆæ¯è®¤è¯ç " class="headerlink" title="æ¶ˆæ¯è®¤è¯ç "></a>æ¶ˆæ¯è®¤è¯ç </h1><blockquote>
<p>MAC(æ¶ˆæ¯è®¤è¯ç )ç®—æ³•æ˜¯ä¸€ç§å¯¹ç§°å¯†é’¥åŠ å¯†æŠ€æœ¯ï¼Œç”¨äºæä¾›æ¶ˆæ¯è®¤è¯ã€‚è¦å»ºç«‹MACè¿‡ç¨‹ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹å…±äº«å¯¹ç§°å¯†é’¥Kã€‚</p>
</blockquote>
<p>å®è´¨ä¸Šï¼ŒMACæ˜¯åœ¨åŸºç¡€æ¶ˆæ¯ä¸Šç”Ÿæˆçš„åŠ å¯†æ ¡éªŒå’Œï¼Œå®ƒä¸æ¶ˆæ¯ä¸€èµ·å‘é€ä»¥ç¡®ä¿æ¶ˆæ¯éªŒè¯ã€‚</p>
<p>ä½¿ç”¨MACè¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img data-src="https://i.loli.net/2019/04/10/5cade5aaeaede.png"></p>
<p>åœ¨Javaä¸­ï¼Œ<code>javax.crypto</code>åŒ…çš„Macç±»æä¾›äº†æ¶ˆæ¯è®¤è¯ä»£ç çš„åŠŸèƒ½ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨æ­¤ç±»åˆ›å»ºæ¶ˆæ¯èº«ä»½éªŒè¯ä»£ç ã€‚</p>
<h2 id="åˆ›å»ºKeyGeneratorå¯¹è±¡"><a href="#åˆ›å»ºKeyGeneratorå¯¹è±¡" class="headerlink" title="åˆ›å»ºKeyGeneratorå¯¹è±¡"></a>åˆ›å»ºKeyGeneratorå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">KeyGenerator keyGen = KeyGenerator.getInstance(<span class="string">&quot;DES&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>KeyGenerator</code>æ”¯æŒä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li>AES (128)</li>
<li>DES (56)</li>
<li>DESede (168)</li>
<li>HmacSHA1</li>
<li>HmacSHA256</li>
</ul>
</blockquote>
<h2 id="åˆ›å»ºSecureRandomå¯¹è±¡"><a href="#åˆ›å»ºSecureRandomå¯¹è±¡" class="headerlink" title="åˆ›å»ºSecureRandomå¯¹è±¡"></a>åˆ›å»ºSecureRandomå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SecureRandom secureRandom = <span class="keyword">new</span> SecureRandom();</span><br></pre></td></tr></table></figure>

<h2 id="åˆå§‹åŒ–KeyGenerator"><a href="#åˆå§‹åŒ–KeyGenerator" class="headerlink" title="åˆå§‹åŒ–KeyGenerator"></a>åˆå§‹åŒ–KeyGenerator</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">keyGen.init(secureRandom);</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå¯†é’¥"><a href="#ç”Ÿæˆå¯†é’¥" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Key key = keyGen.generateKey();</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨å¯†é’¥åˆå§‹åŒ–Macå¯¹è±¡"><a href="#ä½¿ç”¨å¯†é’¥åˆå§‹åŒ–Macå¯¹è±¡" class="headerlink" title="ä½¿ç”¨å¯†é’¥åˆå§‹åŒ–Macå¯¹è±¡"></a>ä½¿ç”¨å¯†é’¥åˆå§‹åŒ–Macå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Mac mac = Mac.getInstance(<span class="string">&quot;HmacMD5&quot;</span>);</span><br><span class="line">mac.init(key);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Mac</code>æ”¯æŒä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li>HmacMD5</li>
<li>HmacSHA1</li>
<li>HmacSHA256</li>
</ul>
</blockquote>
<h2 id="å®Œæˆmacæ“ä½œ"><a href="#å®Œæˆmacæ“ä½œ" class="headerlink" title="å®Œæˆmacæ“ä½œ"></a>å®Œæˆmacæ“ä½œ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String msg = <span class="string">&quot;gcdd1993&quot;</span>;</span><br><span class="line"><span class="keyword">byte</span>[] bytes = msg.getBytes();</span><br><span class="line"><span class="keyword">byte</span>[] macResult = mac.doFinal(bytes);</span><br></pre></td></tr></table></figure>

<h1 id="æ•°å­—ç­¾å"><a href="#æ•°å­—ç­¾å" class="headerlink" title="æ•°å­—ç­¾å"></a>æ•°å­—ç­¾å</h1><blockquote>
<p>æ•°å­—ç­¾åå…è®¸éªŒè¯ç­¾åçš„ä½œè€…ï¼Œæ—¥æœŸå’Œæ—¶é—´ï¼ŒéªŒè¯æ¶ˆæ¯å†…å®¹ã€‚ å®ƒè¿˜åŒ…æ‹¬ç”¨äºå…¶ä»–åŠŸèƒ½çš„èº«ä»½éªŒè¯åŠŸèƒ½ã€‚</p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/04/10/5cade8c25ab4c.png"></p>
<h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul>
<li><p>è®¤è¯</p>
<blockquote>
<p>æ•°å­—ç­¾åæœ‰åŠ©äºéªŒè¯æ¶ˆæ¯æ¥æºã€‚ </p>
</blockquote>
</li>
<li><p>å®Œæ•´æ€§</p>
<blockquote>
<p>é‚®ä»¶ç­¾ååï¼Œé‚®ä»¶ä¸­çš„ä»»ä½•æ›´æ”¹éƒ½å°†ä½¿ç­¾åæ— æ•ˆã€‚</p>
</blockquote>
</li>
<li><p>ä¸å¯å¦è®¤</p>
<blockquote>
<p>é€šè¿‡æ­¤å±æ€§ï¼Œä»»ä½•å·²ç­¾ç½²æŸäº›ä¿¡æ¯çš„å®ä½“éƒ½ä¸èƒ½åœ¨ä»¥åæ‹’ç»ç­¾åã€‚</p>
</blockquote>
</li>
</ul>
<h2 id="åˆ›å»ºæ•°å­—ç­¾å"><a href="#åˆ›å»ºæ•°å­—ç­¾å" class="headerlink" title="åˆ›å»ºæ•°å­—ç­¾å"></a>åˆ›å»ºæ•°å­—ç­¾å</h2><h3 id="åˆ›å»ºKeyPairGeneratorå¯¹è±¡"><a href="#åˆ›å»ºKeyPairGeneratorå¯¹è±¡" class="headerlink" title="åˆ›å»ºKeyPairGeneratorå¯¹è±¡"></a>åˆ›å»ºKeyPairGeneratorå¯¹è±¡</h3><blockquote>
<p><code>KeyPairGenerator</code>ç±»æä¾›<code>getInstance()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€å¯†é’¥ç”Ÿæˆç®—æ³•çš„Stringå˜é‡ï¼Œå¹¶è¿”å›ç”Ÿæˆå¯†é’¥çš„<code>KeyPairGenerator</code>å¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡"><a href="#åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡" class="headerlink" title="åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡"></a>åˆå§‹åŒ–KeyPairGeneratorå¯¹è±¡</h3><blockquote>
<p><code>KeyPairGenerator</code>ç±»æä¾›äº†ä¸€ä¸ªåä¸º<code>initialize()</code>çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆå§‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨ã€‚ æ­¤æ–¹æ³•æ¥å—è¡¨ç¤ºå¯†é’¥å¤§å°çš„æ•´æ•°å€¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">keyPairGen.initialize(<span class="number">2048</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ç”ŸæˆKeyPair"><a href="#ç”ŸæˆKeyPair" class="headerlink" title="ç”ŸæˆKeyPair"></a>ç”ŸæˆKeyPair</h3><blockquote>
<p>ä½¿ç”¨<code>generateKeyPair()</code>æ–¹æ³•ç”Ÿæˆå¯†é’¥å¯¹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">KeyPair pair = keyPairGen.generateKeyPair();</span><br></pre></td></tr></table></figure>

<h3 id="ä»å¯†é’¥å¯¹ä¸­è·å–ç§é’¥"><a href="#ä»å¯†é’¥å¯¹ä¸­è·å–ç§é’¥" class="headerlink" title="ä»å¯†é’¥å¯¹ä¸­è·å–ç§é’¥"></a>ä»å¯†é’¥å¯¹ä¸­è·å–ç§é’¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PrivateKey privateKey = pair.getPrivate();</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç­¾åå¯¹è±¡"><a href="#åˆ›å»ºç­¾åå¯¹è±¡" class="headerlink" title="åˆ›å»ºç­¾åå¯¹è±¡"></a>åˆ›å»ºç­¾åå¯¹è±¡</h3><blockquote>
<p><code>Signature</code>ç±»çš„<code>getInstance()</code>æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€ç­¾åç®—æ³•çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶è¿”å›ç›¸åº”çš„<code>Signature</code>å¯¹è±¡ã€‚</p>
<p>Signatureæ”¯æŒä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li>SHA1withDSA</li>
<li>SHA1withRSA</li>
<li>SHA256withRSA</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Signature sign = Signature.getInstance(<span class="string">&quot;SHA256withDSA&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–ç­¾åå¯¹è±¡"><a href="#åˆå§‹åŒ–ç­¾åå¯¹è±¡" class="headerlink" title="åˆå§‹åŒ–ç­¾åå¯¹è±¡"></a>åˆå§‹åŒ–ç­¾åå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sign.initSign(privateKey);</span><br></pre></td></tr></table></figure>

<h3 id="å°†æ•°æ®æ·»åŠ åˆ°Signatureå¯¹è±¡"><a href="#å°†æ•°æ®æ·»åŠ åˆ°Signatureå¯¹è±¡" class="headerlink" title="å°†æ•°æ®æ·»åŠ åˆ°Signatureå¯¹è±¡"></a>å°†æ•°æ®æ·»åŠ åˆ°Signatureå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String msg = <span class="string">&quot;gcdd1993&quot;</span>;</span><br><span class="line">sign.update(msg.getBytes());</span><br></pre></td></tr></table></figure>

<h3 id="è®¡ç®—ç­¾å"><a href="#è®¡ç®—ç­¾å" class="headerlink" title="è®¡ç®—ç­¾å"></a>è®¡ç®—ç­¾å</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] signature = sign.sign();</span><br></pre></td></tr></table></figure>

<h2 id="éªŒè¯ç­¾å"><a href="#éªŒè¯ç­¾å" class="headerlink" title="éªŒè¯ç­¾å"></a>éªŒè¯ç­¾å</h2><blockquote>
<p>æˆ‘ä»¬åˆ›å»ºç­¾ååï¼Œé€šå¸¸å¯ä»¥å°†ç§é’¥å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œä»¥è¿›è¡Œç­¾åæ“ä½œã€‚æœåŠ¡ç«¯ä¿å­˜å…¬é’¥ï¼Œä»¥è¿›è¡Œç­¾åéªŒè¯</p>
</blockquote>
<h3 id="åˆå§‹åŒ–ç­¾åå¯¹è±¡ä»¥è¿›è¡ŒéªŒè¯"><a href="#åˆå§‹åŒ–ç­¾åå¯¹è±¡ä»¥è¿›è¡ŒéªŒè¯" class="headerlink" title="åˆå§‹åŒ–ç­¾åå¯¹è±¡ä»¥è¿›è¡ŒéªŒè¯"></a>åˆå§‹åŒ–ç­¾åå¯¹è±¡ä»¥è¿›è¡ŒéªŒè¯</h3><blockquote>
<p>ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–ç­¾åå¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sign.initVerify(pair.getPublic());</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°è¦éªŒè¯çš„æ•°æ®"><a href="#æ›´æ–°è¦éªŒè¯çš„æ•°æ®" class="headerlink" title="æ›´æ–°è¦éªŒè¯çš„æ•°æ®"></a>æ›´æ–°è¦éªŒè¯çš„æ•°æ®</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sign.update(msg.getBytes());</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯ç­¾å-1"><a href="#éªŒè¯ç­¾å-1" class="headerlink" title="éªŒè¯ç­¾å"></a>éªŒè¯ç­¾å</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> verify = sign.verify(signature);</span><br><span class="line">Assert.assertTrue(verify);</span><br></pre></td></tr></table></figure>

<h1 id="å…¬ç§é’¥åŠ è§£å¯†æ•°æ®"><a href="#å…¬ç§é’¥åŠ è§£å¯†æ•°æ®" class="headerlink" title="å…¬ç§é’¥åŠ è§£å¯†æ•°æ®"></a>å…¬ç§é’¥åŠ è§£å¯†æ•°æ®</h1><blockquote>
<p>å¯ä»¥ä½¿ç”¨<code>javax.crypto</code>åŒ…çš„Cipherç±»åŠ å¯†ç»™å®šæ•°æ®ã€‚ </p>
</blockquote>
<p>è·å–å…¬ç§é’¥çš„æ­¥éª¤ï¼Œä¸ç­¾åç±»ä¼¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">keyPairGen.initialize(<span class="number">2048</span>);</span><br><span class="line">KeyPair pair = keyPairGen.generateKeyPair();</span><br><span class="line">PublicKey publicKey = pair.getPublic();</span><br></pre></td></tr></table></figure>

<h2 id="åŠ å¯†æ•°æ®"><a href="#åŠ å¯†æ•°æ®" class="headerlink" title="åŠ å¯†æ•°æ®"></a>åŠ å¯†æ•°æ®</h2><h3 id="åˆ›å»ºä¸€ä¸ªCipherå¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ªCipherå¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªCipherå¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ªCipherå¯¹è±¡</h3><blockquote>
<p><code>Cipher</code>ç±»çš„<code>getInstance()</code>æ–¹æ³•æ¥å—è¡¨ç¤ºæ‰€éœ€è½¬æ¢çš„Stringå˜é‡ï¼Œå¹¶è¿”å›å®ç°ç»™å®šè½¬æ¢çš„<code>Cipher</code>å¯¹è±¡ã€‚</p>
<p>Cipheræ”¯æŒä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li>AES/CBC/NoPadding (128)</li>
<li>AES/CBC/PKCS5Padding (128)</li>
<li>AES/ECB/NoPadding (128)</li>
<li>AES/ECB/PKCS5Padding (128)</li>
<li>DES/CBC/NoPadding (56)</li>
<li>DES/CBC/PKCS5Padding (56)</li>
<li>DES/ECB/NoPadding (56)</li>
<li>DES/ECB/PKCS5Padding (56)</li>
<li>DESede/CBC/NoPadding (168)</li>
<li>DESede/CBC/PKCS5Padding (168)</li>
<li>DESede/ECB/NoPadding (168)</li>
<li>DESede/ECB/PKCS5Padding (168)</li>
<li>RSA/ECB/PKCS1Padding (1024, 2048)</li>
<li>RSA/ECB/OAEPWithSHA-1AndMGF1Padding (1024, 2048)</li>
<li>RSA/ECB/OAEPWithSHA-256AndMGF1Padding (1024, 2048)</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cipher cipher = Cipher.getInstance(<span class="string">&quot;RSA/ECB/PKCS1Padding&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–Cipherå¯¹è±¡"><a href="#ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–Cipherå¯¹è±¡" class="headerlink" title="ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–Cipherå¯¹è±¡"></a>ä½¿ç”¨å…¬é’¥åˆå§‹åŒ–Cipherå¯¹è±¡</h3><blockquote>
<p><code>Cipher</code>ç±»çš„<code>init()</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªè¡¨ç¤ºæ“ä½œæ¨¡å¼çš„æ•´æ•°å‚æ•°(åŠ å¯†/è§£å¯†)å’Œä¸€ä¸ªè¡¨ç¤ºå…¬é’¥çš„Keyå¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cipher.init(Cipher.ENCRYPT_MODE, publicKey);</span><br></pre></td></tr></table></figure>

<h3 id="å°†æ•°æ®æ·»åŠ åˆ°Cipherå¯¹è±¡"><a href="#å°†æ•°æ®æ·»åŠ åˆ°Cipherå¯¹è±¡" class="headerlink" title="å°†æ•°æ®æ·»åŠ åˆ°Cipherå¯¹è±¡"></a>å°†æ•°æ®æ·»åŠ åˆ°Cipherå¯¹è±¡</h3><blockquote>
<p><code>Cipher</code>ç±»çš„<code>update()</code>æ–¹æ³•æ¥å—è¡¨ç¤ºè¦åŠ å¯†çš„æ•°æ®çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„æ•°æ®æ›´æ–°å½“å‰å¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String msg = <span class="string">&quot;gcdd1993&quot;</span>;</span><br><span class="line">cipher.update(msg.getBytes());</span><br></pre></td></tr></table></figure>

<h3 id="åŠ å¯†æ•°æ®-1"><a href="#åŠ å¯†æ•°æ®-1" class="headerlink" title="åŠ å¯†æ•°æ®"></a>åŠ å¯†æ•°æ®</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] cipherText = cipher.doFinal();</span><br></pre></td></tr></table></figure>

<h2 id="è§£å¯†æ•°æ®"><a href="#è§£å¯†æ•°æ®" class="headerlink" title="è§£å¯†æ•°æ®"></a>è§£å¯†æ•°æ®</h2><h3 id="ä½¿ç”¨ç§é’¥åˆå§‹åŒ–Cipherå¯¹è±¡"><a href="#ä½¿ç”¨ç§é’¥åˆå§‹åŒ–Cipherå¯¹è±¡" class="headerlink" title="ä½¿ç”¨ç§é’¥åˆå§‹åŒ–Cipherå¯¹è±¡"></a>ä½¿ç”¨ç§é’¥åˆå§‹åŒ–Cipherå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cipher.init(Cipher.DECRYPT_MODE, pair.getPrivate());</span><br></pre></td></tr></table></figure>

<h3 id="è§£å¯†æ•°æ®-1"><a href="#è§£å¯†æ•°æ®-1" class="headerlink" title="è§£å¯†æ•°æ®"></a>è§£å¯†æ•°æ®</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] decipheredText = cipher.doFinal(cipherText);</span><br><span class="line">Assert.assertEquals(msg, <span class="keyword">new</span> String(decipheredText));</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬ä¸‰æ–¹ç±»åº“"><a href="#ç¬¬ä¸‰æ–¹ç±»åº“" class="headerlink" title="ç¬¬ä¸‰æ–¹ç±»åº“"></a>ç¬¬ä¸‰æ–¹ç±»åº“</h1><blockquote>
<p>å‰åç«¯é€‚ç”¨ä¸”åº”ç”¨å¹¿æ³›çš„æ˜¯<a href="https://github.com/brix/crypto-js"><code>Crypto-JS</code></a>,ä½¿ç”¨ <code>Crypto-JS </code>å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨ JavaScript è¿›è¡Œ MD5ã€SHA1ã€SHA2ã€SHA3ã€RIPEMD-160 å“ˆå¸Œæ•£åˆ—ï¼Œè¿›è¡Œ AESã€DESã€Rabbitã€RC4ã€Triple DES åŠ è§£å¯†ã€‚</p>
</blockquote>
<h2 id="AESåŠ å¯†"><a href="#AESåŠ å¯†" class="headerlink" title="AESåŠ å¯†"></a>AESåŠ å¯†</h2><blockquote>
<p><strong>é«˜çº§åŠ å¯†æ ‡å‡†</strong>ï¼ˆè‹±è¯­ï¼š<strong>A</strong>dvanced <strong>E</strong>ncryption <strong>S</strong>tandardï¼Œç¼©å†™ï¼š<a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">AES</a>ï¼‰ï¼Œåœ¨å¯†ç å­¦ä¸­åˆç§°<strong>RijndaelåŠ å¯†æ³•</strong>ï¼Œæ˜¯ç¾å›½è”é‚¦æ”¿åºœé‡‡ç”¨çš„ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E5%8D%80%E5%A1%8A%E5%8A%A0%E5%AF%86">åŒºå—åŠ å¯†</a>æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†ç”¨æ¥æ›¿ä»£åŸå…ˆçš„<a href="https://zh.wikipedia.org/wiki/DES">DES</a>ï¼Œå·²ç»è¢«å¤šæ–¹åˆ†æä¸”å¹¿ä¸ºå…¨ä¸–ç•Œæ‰€ä½¿ç”¨ã€‚</p>
</blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯éšæœºç”Ÿæˆå¯†é’¥ï¼Œç„¶åå°†å¯†é’¥å‘é€ç»™å®¢æˆ·ç«¯è¿›è¡ŒåŠ å¯†ï¼Œä¸Šä¼ å¯†æ–‡åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¿›è¡Œè§£å¯†ã€‚</p>
<p>æœ¬æ–‡åªè®¨è®ºJavaçš„AESåŠ è§£å¯†æ–¹å¼ã€‚</p>
<h3 id="å¼•å…¥JaråŒ…"><a href="#å¼•å…¥JaråŒ…" class="headerlink" title="å¼•å…¥JaråŒ…"></a>å¼•å…¥JaråŒ…</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">compile group: &#x27;org.webjars.npm&#x27;, name: &#x27;crypto-js&#x27;, version: &#x27;3.1.8&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆå¯†é’¥-1"><a href="#ç”Ÿæˆå¯†é’¥-1" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line"><span class="keyword">byte</span>[] key = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">random.nextBytes(key);</span><br><span class="line">SecretKeySpec keySpec = <span class="keyword">new</span> SecretKeySpec(key, <span class="string">&quot;AES&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆåç§»é‡"><a href="#ç”Ÿæˆåç§»é‡" class="headerlink" title="ç”Ÿæˆåç§»é‡"></a>ç”Ÿæˆåç§»é‡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] iv = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">random.nextBytes(iv);</span><br><span class="line">IvParameterSpec ivSpec = <span class="keyword">new</span> IvParameterSpec(iv);</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºCipherå¯¹è±¡"><a href="#åˆ›å»ºCipherå¯¹è±¡" class="headerlink" title="åˆ›å»ºCipherå¯¹è±¡"></a>åˆ›å»ºCipherå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–Cipherä¸ºåŠ å¯†å·¥ä½œè¿‡ç¨‹"><a href="#åˆå§‹åŒ–Cipherä¸ºåŠ å¯†å·¥ä½œè¿‡ç¨‹" class="headerlink" title="åˆå§‹åŒ–Cipherä¸ºåŠ å¯†å·¥ä½œè¿‡ç¨‹"></a>åˆå§‹åŒ–Cipherä¸ºåŠ å¯†å·¥ä½œè¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivSpec);</span><br></pre></td></tr></table></figure>

<h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] original = cipher.doFinal(encrypted1);</span><br></pre></td></tr></table></figure>

<h2 id="AESè§£å¯†"><a href="#AESè§£å¯†" class="headerlink" title="AESè§£å¯†"></a>AESè§£å¯†</h2><h3 id="åˆå§‹åŒ–Cipherä¸ºè§£å¯†å·¥ä½œè¿‡ç¨‹"><a href="#åˆå§‹åŒ–Cipherä¸ºè§£å¯†å·¥ä½œè¿‡ç¨‹" class="headerlink" title="åˆå§‹åŒ–Cipherä¸ºè§£å¯†å·¥ä½œè¿‡ç¨‹"></a>åˆå§‹åŒ–Cipherä¸ºè§£å¯†å·¥ä½œè¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cipher.init(Cipher.DECRYPT_MODE, keySpec, ivSpec);</span><br></pre></td></tr></table></figure>

<h3 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = cipher.doFinal(original);</span><br><span class="line">Assert.assertEquals(data, <span class="keyword">new</span> String(bytes, StandardCharsets.UTF_8));</span><br></pre></td></tr></table></figure>

<h2 id="AESåŠ è§£å¯†æ€»ç»“"><a href="#AESåŠ è§£å¯†æ€»ç»“" class="headerlink" title="AESåŠ è§£å¯†æ€»ç»“"></a>AESåŠ è§£å¯†æ€»ç»“</h2><p>å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®ç°å¯¹ç§°åŠ å¯†</p>
<ol>
<li>æœåŠ¡ç«¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£è´Ÿè´£éšæœºç”Ÿæˆkeyï¼ˆå¯†ç ï¼‰å’Œivï¼ˆåç§»é‡ï¼‰ï¼Œå¹¶å°†å…¶å­˜å…¥redisï¼ˆè®¾ç½®è¶…æ—¶æ—¶é—´ï¼‰</li>
<li>å®¢æˆ·ç«¯è°ƒç”¨æ¥å£ï¼Œè·å¾—keyå’Œivä»¥åŠä¸€ä¸ªredis_keyï¼Œè¿›è¡Œæ•°æ®åŠ å¯†ï¼Œå°†åŠ å¯†åçš„æ•°æ®ä»¥åŠredis_keyä¼ åˆ°æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯ä½¿ç”¨redis_keyè·å¾—keyå’Œivï¼Œè¿›è¡Œè§£å¯†</li>
</ol>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨Java EEå®‰å…¨é‡Œï¼Œä¸»è¦æ˜¯è¿›è¡Œå®¢æˆ·ç«¯åŠ å¯†ï¼Œä»¥åŠæœåŠ¡ç«¯è§£å¯†çš„è¿‡ç¨‹æ¥å®ç°æ•°æ®å®‰å…¨ä¼ è¾“çš„ç›®çš„ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>éšæœºæ€§ï¼šåŠ å¯†æ–¹å¼ä¸å¯å•ä¸€ï¼Œå¯é€šè¿‡æ›´æ¢<code>Cipher.getInstance()</code>çš„Stringå€¼æ¥éšæœºç”ŸæˆåŠ å¯†å·¥äººè¿›è¡ŒåŠ å¯†ã€‚</li>
<li>ä¿å¯†æ€§ï¼šåŠ å¯†ä½¿ç”¨çš„å¯†é’¥æˆ–è€…åç§»é‡ç­‰ï¼Œéœ€è¦ä½¿ç”¨è¶…æ—¶ã€æ¨¡ç³Šç›®çš„ç­‰æ‰‹æ®µè¿›è¡Œéšè—ï¼ŒåŠ å¤§ç ´è§£æˆæœ¬ã€‚</li>
</ul>
<p>æ²¡æœ‰å®Œå…¨æœ‰æ•ˆçš„åŠ å¯†ï¼Œä½†æ˜¯åªè¦åšåˆ°ç ´è§£æˆæœ¬å¤§äºåŠ å¯†æˆæœ¬ï¼Œå°±æ˜¯æœ‰æ•ˆçš„åŠ å¯†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­åœ°æ›´æ¢åŠ å¯†æ–¹å¼è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p>
<p>ğŸ‘‰ <a href="https://github.com/gcdd1993/java-security-sample">ä»£ç ä»“åº“</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰UMLæ€»ç»“</title>
    <url>/p/63230/</url>
    <content><![CDATA[<h1 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h1><p>ç»Ÿä¸€å»ºæ¨¡è¯­è¨€(è‹±è¯­: Unified Modeling Language ï¼Œç¼©å†™UML)æ˜¯éä¸“åˆ©çš„ç¬¬ä¸‰ä»£å»ºæ¨¡å’Œè§„çº¦è¯­è¨€ã€‚</p>
<span id="more"></span>

<h1 id="UMLç‰¹ç‚¹"><a href="#UMLç‰¹ç‚¹" class="headerlink" title="UMLç‰¹ç‚¹"></a>UMLç‰¹ç‚¹</h1><ul>
<li>UMLæ˜¯ä¸€ç§å¼€æ”¾çš„æ–¹æ³•</li>
<li>ç”¨äºè¯´æ˜ã€å¯è§†åŒ–ã€æ„å»ºå’Œç¼–å†™ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„é¢å‘å¯¹è±¡çš„ã€è½¯ä»¶å¯†é›†ç³»ç»Ÿçš„åˆ¶å“çš„å¼€æ”¾æ–¹æ³•ã€‚</li>
<li>UMLå±•ç°äº†ä¸€ç³»åˆ—æœ€ä½³å·¥ç¨‹å®è·µï¼Œè¿™äº›æœ€ä½³å®è·µåœ¨å¯¹å¤§è§„æ¨¡ï¼Œå¤æ‚ç³»ç»Ÿè¿›è¡Œå»ºæ¨¡æ–¹é¢ï¼Œç‰¹åˆ«æ˜¯åœ¨è½¯ä»¶æ¶æ„å±‚æ¬¡å·²ç»è¢«éªŒè¯æœ‰æ•ˆã€‚</li>
</ul>
<h1 id="UML2-2åˆ†ç±»"><a href="#UML2-2åˆ†ç±»" class="headerlink" title="UML2.2åˆ†ç±»"></a>UML2.2åˆ†ç±»</h1><p>UML2.2ä¸­ä¸€å…±å®šä¹‰äº†14ç§å›¾ç¤ºï¼Œåˆ†ç±»å¦‚ä¸‹:</p>
<ul>
<li>ç»“æ„å¼å›¾å½¢ï¼šå¼ºè°ƒçš„æ˜¯ç³»ç»Ÿå¼çš„å»ºæ¨¡<ul>
<li>é™æ€å›¾(ç±»å›¾ï¼Œå¯¹è±¡å›¾ï¼ŒåŒ…å›¾)</li>
<li>å®ç°å›¾(ç»„ä»¶å›¾ï¼Œéƒ¨ç½²å›¾)</li>
<li>å‰–é¢å›¾</li>
<li>å¤åˆç»“æ„å›¾</li>
</ul>
</li>
<li>è¡Œä¸ºå¼å›¾å½¢ï¼šå¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­è§¦å‘çš„äº‹ä»¶<ul>
<li>æ´»åŠ¨å›¾</li>
<li>çŠ¶æ€å›¾</li>
<li>ç”¨ä¾‹å›¾</li>
</ul>
</li>
<li>äº¤äº’å¼å›¾å½¢ï¼šå±äºè¡Œä¸ºå¼å›¾å½¢å­é›†åˆï¼Œå¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­çš„èµ„æ–™æµç¨‹<ul>
<li>é€šä¿¡å›¾</li>
<li>äº¤äº’æ¦‚è¿°å›¾(UML2.0)</li>
<li>æ—¶åºå›¾(UML2.0)</li>
<li>æ—¶é—´å›¾(UML2.0)</li>
</ul>
</li>
</ul>
<h1 id="UMLç±»å›¾"><a href="#UMLç±»å›¾" class="headerlink" title="UMLç±»å›¾"></a>UMLç±»å›¾</h1><h2 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Class Diagram:ç”¨äºè¡¨ç¤ºç±»ã€æ¥å£ã€å®ä¾‹ç­‰ä¹‹é—´ç›¸äº’çš„é™æ€å…³ç³»ã€‚è™½ç„¶åå­—å«ç±»å›¾ï¼Œä½†ç±»å›¾ä¸­å¹¶ä¸åªæœ‰ç±»ï¼ˆä¹ŸåŒ…æ‹¬æƒé™ï¼Œå±æ€§ï¼Œæ–¹æ³•ç­‰ï¼‰ã€‚</p>
<h2 id="è®°å¿†æŠ€å·§"><a href="#è®°å¿†æŠ€å·§" class="headerlink" title="è®°å¿†æŠ€å·§"></a>è®°å¿†æŠ€å·§</h2><h3 id="ç®­å¤´æ–¹å‘"><a href="#ç®­å¤´æ–¹å‘" class="headerlink" title="ç®­å¤´æ–¹å‘"></a>ç®­å¤´æ–¹å‘</h3><ul>
<li>å®šä¹‰å­ç±»æ—¶éœ€è¦é€šè¿‡extendså…³é”®å­—æŒ‡å®šçˆ¶ç±»</li>
<li>å­ç±»ä¸€å®šæ˜¯çŸ¥é“çˆ¶ç±»å®šä¹‰çš„ï¼Œä½†çˆ¶ç±»å¹¶ä¸çŸ¥é“å­ç±»çš„å®šä¹‰</li>
<li>åªæœ‰çŸ¥é“å¯¹æ–¹ä¿¡æ¯æ—¶æ‰èƒ½æŒ‡å‘å¯¹æ–¹</li>
<li>æ‰€ä»¥ç®­å¤´æ–¹å‘æ˜¯<strong>ä»å­ç±»æŒ‡å‘çˆ¶ç±»</strong></li>
</ul>
<h3 id="å®çº¿-ç»§æ‰¿-è™šçº¿-å®ç°"><a href="#å®çº¿-ç»§æ‰¿-è™šçº¿-å®ç°" class="headerlink" title="å®çº¿-ç»§æ‰¿|è™šçº¿-å®ç°"></a>å®çº¿-ç»§æ‰¿|è™šçº¿-å®ç°</h3><p><img data-src="https://i.loli.net/2019/07/28/5d3c7b0d81dbf76419.png"></p>
<ul>
<li>ç©ºå¿ƒä¸‰è§’ç®­å¤´:ç»§æ‰¿æˆ–å®ç°</li>
<li>å®çº¿ç»§æ‰¿ï¼Œ is aå…³ç³»ï¼Œæ‰©å±•ç›®çš„ï¼Œä¸è™šï¼Œå¾ˆç»“å®</li>
<li>è™šçº¿-å®ç°ï¼Œè™šçº¿ä»£è¡¨â€œè™šâ€ï¼Œæ— å®ä½“</li>
</ul>
<h3 id="å®çº¿-å…³è”-è™šçº¿-ä¾èµ–"><a href="#å®çº¿-å…³è”-è™šçº¿-ä¾èµ–" class="headerlink" title="å®çº¿-å…³è”|è™šçº¿-ä¾èµ–"></a>å®çº¿-å…³è”|è™šçº¿-ä¾èµ–</h3><p><img data-src="https://i.loli.net/2019/07/28/5d3c7b7e556e646414.png"></p>
<ul>
<li>å®çº¿-å…³è”å…³ç³»:å…³ç³»ç¨³å®šï¼Œå®æ‰“å®çš„å…³ç³»ï¼Œé“å“¥ä»¬</li>
<li>è¡¨ç¤ºä¸€ä¸ªç±»å¯¹è±¡å’Œå¦ä¸€ä¸ªç±»å¯¹è±¡æœ‰å…³è”</li>
<li>é€šå¸¸æ˜¯ä¸€ä¸ªç±»ä¸­æœ‰å¦ä¸€ä¸ªç±»å¯¹è±¡åšä¸ºå±æ€§</li>
</ul>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c7b8f3d0d786176.png"></p>
<ul>
<li>è™šçº¿-ä¾èµ–å…³ç³»:ä¸´æ—¶ç”¨ä¸€ä¸‹ï¼Œè‹¥å³è‹¥ç¦»ï¼Œè™šæ— ç¼¥ç¼ˆï¼Œè‹¥æœ‰è‹¥æ— </li>
<li>è¡¨ç¤ºä¸€ç§ä½¿ç”¨å…³ç³»ï¼Œä¸€ä¸ªç±»éœ€è¦å€ŸåŠ©å¦ä¸€ä¸ªç±»æ¥å®ç°åŠŸèƒ½</li>
<li>ä¸€èˆ¬æ˜¯ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»åšä¸ºå‚æ•°ä½¿ç”¨ï¼Œæˆ–ä½œä¸ºè¿”å›å€¼</li>
</ul>
<h3 id="ç©ºå¿ƒè±å½¢-èšåˆ-å®å¿ƒè±å½¢-ç»„åˆ"><a href="#ç©ºå¿ƒè±å½¢-èšåˆ-å®å¿ƒè±å½¢-ç»„åˆ" class="headerlink" title="ç©ºå¿ƒè±å½¢-èšåˆ|å®å¿ƒè±å½¢-ç»„åˆ"></a>ç©ºå¿ƒè±å½¢-èšåˆ|å®å¿ƒè±å½¢-ç»„åˆ</h3><ul>
<li>è±å½¢å°±æ˜¯ä¸€ä¸ªç››ä¸œè¥¿çš„å™¨çš¿(ä¾‹å¦‚ç›˜å­)</li>
<li>èšåˆ:ä»£è¡¨ç©ºå™¨çš¿é‡Œå¯ä»¥æ”¾å¾ˆå¤šç›¸åŒä¸œè¥¿ï¼Œèšåœ¨ä¸€èµ·(ç®­å¤´æ–¹å‘æ‰€æŒ‡çš„ç±»)</li>
<li>ç»„åˆ:ä»£è¡¨æ»¡å™¨çš¿é‡Œå·²ç»æœ‰å®ä½“ç»“æ„çš„å­˜åœ¨ï¼Œç”Ÿæ­»ä¸å…±</li>
</ul>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c7eaf0d25040127.png"></p>
<ul>
<li>æ•´ä½“å’Œå±€éƒ¨çš„å…³ç³»ï¼Œä¸¤è€…æœ‰ç€ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯has açš„å…³ç³»</li>
<li>å¼±å…³ç³»</li>
<li>æ¶ˆæçš„è¯:å¼±-ç©º</li>
</ul>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c7ed2ce90136239.png"></p>
<ul>
<li>æ•´ä½“ä¸å±€éƒ¨çš„å…³ç³»ï¼Œå’Œèšåˆçš„å…³ç³»ç›¸æ¯”ï¼Œå…³ç³»æ›´åŠ å¼ºçƒˆ</li>
<li>ä¸¤è€…æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œ contains-açš„å…³ç³»</li>
<li>å¼ºå…³ç³»</li>
<li>ç§¯æçš„è¯:å¼º-æ»¡</li>
</ul>
<h4 id="å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§"><a href="#å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§" class="headerlink" title="å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§"></a>å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§</h4><ul>
<li>0..1:0æˆ–1ä¸ªå®ä¾‹.</li>
<li>0..*:0æˆ–å¤šä¸ªå®ä¾‹.</li>
<li>1..1:1ä¸ªå®ä¾‹.</li>
<li>1:åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹.</li>
<li>1..*:è‡³å°‘æœ‰ä¸€ä¸ªå®ä¾‹.</li>
</ul>
<h2 id="ç±»å›¾è¯¦è§£"><a href="#ç±»å›¾è¯¦è§£" class="headerlink" title="ç±»å›¾è¯¦è§£"></a>ç±»å›¾è¯¦è§£</h2><p><img data-src="https://i.loli.net/2019/07/28/5d3c82bc3713e90509.png"></p>
<p>ç±»å›¾ä»ä¸Šåˆ°ä¸‹åŒ…å«ï¼š</p>
<ul>
<li>ç±»åï¼šæŠ½è±¡ç±»ä½¿ç”¨æ–œä½“è¡¨ç¤ºï¼Œæ¥å£ç”¨&lt;<interface xxx>&gt;è¡¨ç¤º</li>
<li>å±æ€§ï¼šè®¿é—®æƒé™+å±æ€§åï¼šå±æ€§ç±»å‹<ul>
<li><code>+ï¼špublic</code></li>
<li><code>-ï¼šprivate</code></li>
<li><code>#ï¼šprotected</code></li>
<li><code>~ï¼šdefault</code></li>
<li>ä¸‹æ¨ªçº¿è¡¨ç¤ºstatic</li>
</ul>
</li>
<li>æ–¹æ³•: è®¿é—®æƒé™+æ–¹æ³•åï¼šè¿”å›å€¼ç±»å‹<ul>
<li><code>+ï¼špublic</code></li>
<li><code>-ï¼šprivate</code></li>
<li><code>#ï¼šprotected</code></li>
<li><code>~ï¼šdefault</code></li>
<li>ä¸‹æ¨ªçº¿è¡¨ç¤ºstatic</li>
<li>æ–œä½“è¡¨ç¤ºæŠ½è±¡æ–¹æ³•</li>
</ul>
</li>
</ul>
<p>å…¸å‹çš„ç±»å›¾è¡¨ç¤ºï¼š</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c8422bfd5d69590.png"></p>
<h1 id="UMLæ—¶åºå›¾"><a href="#UMLæ—¶åºå›¾" class="headerlink" title="UMLæ—¶åºå›¾"></a>UMLæ—¶åºå›¾</h1><p>Sequence Diagram :æ˜¯æ˜¾ç¤ºå¯¹è±¡ä¹‹é—´äº¤äº’çš„å›¾ï¼Œè¿™äº›å¯¹è±¡æ˜¯æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„ã€‚</p>
<p>æ—¶åºå›¾ä¸­åŒ…æ‹¬çš„å»ºæ¨¡å…ƒç´ ä¸»è¦æœ‰:</p>
<ul>
<li>å¯¹è±¡(Actor)</li>
<li>ç”Ÿå‘½çº¿(Lifeline)</li>
<li>æ§åˆ¶ç„¦ç‚¹(Focus of control)</li>
<li>æ¶ˆæ¯(Message)ç­‰</li>
</ul>
<p>å…¸å‹çš„ä¸€ä¸ªæ—¶åºå›¾å¦‚ä¸‹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c82384ae5224680.png"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>UML</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰ç®€å•å·¥å‚æ¨¡å¼</title>
    <url>/p/21710/</url>
    <content><![CDATA[<h1 id="å®šä¹‰ä¸ç±»å‹"><a href="#å®šä¹‰ä¸ç±»å‹" class="headerlink" title="å®šä¹‰ä¸ç±»å‹"></a>å®šä¹‰ä¸ç±»å‹</h1><ul>
<li>å®šä¹‰:ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹</li>
<li>ç±»å‹:åˆ›å»ºå‹ï¼Œä½†ä¸å±äºGOF23ç§è®¾è®¡æ¨¡å¼</li>
</ul>
<span id="more"></span>

<h1 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h1><ul>
<li>å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘</li>
<li>å®¢æˆ·ç«¯(åº”ç”¨å±‚)åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡(é€»è¾‘)ä¸å…³å¿ƒ</li>
</ul>
<h1 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h1><p>åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ï¼Œå°±å¯ä»¥è·å–ä½ æ‰€éœ€è¦çš„å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“å…¶åˆ›å»ºç»†èŠ‚</p>
<h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><p>å·¥å‚ç±»çš„<strong>èŒè´£ç›¸å¯¹è¿‡é‡</strong>ï¼Œå¢åŠ æ–°çš„äº§å“ï¼Œéœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„åˆ¤æ–­é€»è¾‘ï¼Œ<strong>è¿èƒŒå¼€é—­åŸåˆ™</strong></p>
<h1 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h1><p>åˆ›å»ºä¸€ä¸ªæŠ½è±¡äº§å“ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº§å“å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVideo</span> <span class="keyword">extends</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonVideo</span> <span class="keyword">extends</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Pythonè§†é¢‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº§å“å¯¹åº”çš„ç®€å•å·¥å‚ï¼Œé€šè¿‡äº§å“ç±»å‹æ¥åˆ›å»ºäº§å“ï¼Œåº”ç”¨æ–¹æ— éœ€çŸ¥é“åˆ›å»ºäº§å“çš„ç»†èŠ‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">getVideo</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;java&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JavaVideo();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;python&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PythonVideo();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        VideoFactory videoFactory = <span class="keyword">new</span> VideoFactory();</span><br><span class="line">        Video video = videoFactory.getVideo(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        video.produce();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">å½•åˆ¶Javaè¯¾ç¨‹</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¢åŠ äº§å“ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦ä¿®æ”¹äº§å“å¯¹åº”çš„äº§å“ç±»ï¼Œè¿˜éœ€è¦ä¿®æ”¹å·¥å‚ç±»ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æ¥ä¼˜åŒ–ä¸‹æˆ‘ä»¬çš„å·¥å‚ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">getVideo</span><span class="params">(Class&lt;? extends Video&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥ï¼Œæ·»åŠ äº§å“çš„æ—¶å€™ä¸ç”¨å†ä¿®æ”¹æˆ‘ä»¬çš„å·¥å‚ç±»ï¼Œè€Œæ˜¯ç›´æ¥æ·»åŠ äº§å“å³å¯ã€‚</p>
<p>æœ€ç»ˆçš„UMLç±»å›¾</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3dc0457904825584.png"></p>
<h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><h2 id="JDKæºç "><a href="#JDKæºç " class="headerlink" title="JDKæºç "></a><code>JDK</code>æºç </h2><p>åœ¨JDKä¸­ï¼Œä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼çš„ä¾‹å­å¦‚<code>java.util.Calendar</code>ï¼Œä¸€ç»„<code>getInstance</code>çš„é‡è½½æ–¹æ³•ï¼Œæä¾›äº†åˆ›å»º<code>Calendar</code>äº§å“çš„ç®€å•å·¥å‚æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getInstance</span><span class="params">(TimeZone zone)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getInstance</span><span class="params">(Locale aLocale)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getInstance</span><span class="params">(TimeZone zoneï¼ŒLocale aLocale)</span></span></span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ–¹æ³•ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Calendar <span class="title">createCalendar</span><span class="params">(TimeZone zoneï¼ŒLocale aLocale)</span></span></span><br></pre></td></tr></table></figure>

<p>æºç è¾ƒé•¿ï¼Œä¸è´´äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹ä¸‹æºç ã€‚</p>
<p><code>Calendar</code>çš„UMLç±»å›¾å¦‚ä¸‹</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3dc14d34d8244148.png"></p>
<h2 id="Logbackæºç "><a href="#Logbackæºç " class="headerlink" title="Logbackæºç "></a><code>Logback</code>æºç </h2><p><code>logback</code>ç±»ä¸­çš„ç®€å•å·¥å‚æ¨¡å¼ä¸»è¦ä½“ç°åœ¨<code>ch.qos.logback.classic.LoggerContext#getLogger(String)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Logger <span class="title">getLogger</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;name argument cannot be null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­logç±»å‹è¿”å›rootèŠ‚ç‚¹çš„logger</span></span><br><span class="line">    <span class="keyword">if</span> (Logger.ROOT_LOGGER_NAME.equalsIgnoreCase(name)) &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    Logger logger = root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœç¼“å­˜ä¸­å·²ç»å­˜åœ¨çš„æŒ‡å®šçš„loggerï¼Œç›´æ¥è¿”å›childLogger</span></span><br><span class="line">    Logger childLogger = (Logger) loggerCache.get(name);</span><br><span class="line">    <span class="comment">// if we have the childï¼Œ then let us return it without wasting time</span></span><br><span class="line">    <span class="keyword">if</span> (childLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> childLogger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹æ˜¯åˆ›å»ºloggerçš„é€»è¾‘</span></span><br><span class="line">    String childName;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> h = LoggerNameUtil.getSeparatorIndexOf(nameï¼Œ i);</span><br><span class="line">        <span class="keyword">if</span> (h == -<span class="number">1</span>) &#123;</span><br><span class="line">            childName = name;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            childName = name.substring(<span class="number">0</span>ï¼Œ h);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// move i left of the last point</span></span><br><span class="line">        i = h + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (logger) &#123;</span><br><span class="line">            childLogger = logger.getChildByName(childName);</span><br><span class="line">            <span class="keyword">if</span> (childLogger == <span class="keyword">null</span>) &#123;</span><br><span class="line">                childLogger = logger.createChildByName(childName);</span><br><span class="line">                loggerCache.put(childNameï¼Œ childLogger);</span><br><span class="line">                incSize();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        logger = childLogger;</span><br><span class="line">        <span class="keyword">if</span> (h == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> childLogger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸€ä¸ªå…¸å‹çš„ç®€å•å·¥å‚æ–¹æ³•</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰è®¾è®¡æ¨¡å¼åŸåˆ™</title>
    <url>/p/64818/</url>
    <content><![CDATA[<p>å­¦ä¹ Javaè®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£è®¾è®¡æ¨¡å¼åŸåˆ™ã€‚<span id="more"></span></p>
<h1 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li><p>ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</p>
</li>
<li><p>ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚</p>
</li>
<li><p>ä¼˜ç‚¹ï¼šæé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯å¤ç”¨æ€§åŠå¯ç»´æŠ¤æ€§</p>
</li>
</ul>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>åˆ›å»ºæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line">    <span class="function">Integer <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Double <span class="title">getPrice</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCourse</span> <span class="keyword">implements</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ICourse iCourse = <span class="keyword">new</span> JavaCourse(<span class="number">96</span>ï¼Œ <span class="string">&quot;æˆ‘çš„Javaè¯¾ç¨‹&quot;</span>ï¼Œ <span class="number">348d</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯¾ç¨‹ID: &quot;</span> + iCourse.getId() + <span class="string">&quot; è¯¾ç¨‹åç§°ï¼š &quot;</span> + iCourse.getName() + <span class="string">&quot;è¯¾ç¨‹ä»·æ ¼ï¼š &quot;</span> + iCourse.getPrice());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹ä»·æ ¼ï¼š 348.0</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç°åœ¨è¦æ‰“æŠ˜å‡ºå”®è¯¾ç¨‹ï¼ŒæŒ‰ç…§å¼€é—­åŸåˆ™æ¥è®¾è®¡ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<p>åˆ›å»ºæ‰“æŠ˜ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaDiscountCourse</span> <span class="keyword">extends</span> <span class="title">JavaCourse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JavaDiscountCourse</span><span class="params">(Integer idï¼Œ String nameï¼Œ Double price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(idï¼Œ nameï¼Œ price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getOriginPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getPrice() * <span class="number">0.8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åº”ç”¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ICourse javaCourse = <span class="keyword">new</span> JavaDiscountCourse(<span class="number">96</span>ï¼Œ <span class="string">&quot;æˆ‘çš„Javaè¯¾ç¨‹&quot;</span>ï¼Œ <span class="number">348d</span>);</span><br><span class="line"></span><br><span class="line">        JavaDiscountCourse iCourse = (JavaDiscountCourse) javaCourse;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯¾ç¨‹ID: &quot;</span> + iCourse.getId() + <span class="string">&quot; è¯¾ç¨‹åç§°ï¼š &quot;</span> + iCourse.getName() + <span class="string">&quot;è¯¾ç¨‹åŸä»·ï¼š &quot;</span> + iCourse.getOriginPrice() + <span class="string">&quot; è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š &quot;</span> + iCourse.getPrice());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹åŸä»·ï¼š 348.0 è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š 278.40000000000003</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œ<code>Double * 0.8</code>åè¾“å‡ºçš„æµ®ç‚¹æ•°ç²¾åº¦æœ‰ä¸¢å¤±çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨<code>BigDecimal</code>çš„<code>String</code>æ„é€ å™¨<code>public BigDecimal(String val)</code>æ¥è§£å†³ã€‚</p>
<p>ä¿®æ”¹<code>JavaDiscountCourse</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaDiscountCourse</span> <span class="keyword">extends</span> <span class="title">JavaCourse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JavaDiscountCourse</span><span class="params">(Integer idï¼Œ String nameï¼Œ Double price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(idï¼Œ nameï¼Œ price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getOriginPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="keyword">super</span>.getPrice().toString()).multiply(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;0.8&quot;</span>)).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è¯¾ç¨‹ID: 96 è¯¾ç¨‹åç§°ï¼š æˆ‘çš„Javaè¯¾ç¨‹è¯¾ç¨‹åŸä»·ï¼š 348.0 è¯¾ç¨‹æŠ˜åä»·æ ¼ï¼š 278.4</span><br></pre></td></tr></table></figure>

<h1 id="ä¾èµ–å€’ç½®åŸåˆ™"><a href="#ä¾èµ–å€’ç½®åŸåˆ™" class="headerlink" title="ä¾èµ–å€’ç½®åŸåˆ™"></a>ä¾èµ–å€’ç½®åŸåˆ™</h1><h2 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡</li>
<li>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚;ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡</li>
<li>é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹</li>
<li>ä¼˜ç‚¹:å¯ä»¥å‡å°‘ç±»é—´çš„è€¦åˆæ€§ã€æé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¯é™ä½ä¿®æ”¹ç¨‹åºæ‰€é€ æˆçš„é£é™©</li>
</ul>
<h2 id="Coding-1"><a href="#Coding-1" class="headerlink" title="Coding"></a>Coding</h2><h3 id="åä¾‹"><a href="#åä¾‹" class="headerlink" title="åä¾‹"></a>åä¾‹</h3><p>åˆ›å»ºç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Geely</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyJavaCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyFECourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyPythonCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ Pythonè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="comment">// v1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Geely geely = <span class="keyword">new</span> Geely();</span><br><span class="line">        geely.studyFECourse();</span><br><span class="line">        geely.studyJavaCourse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹</span><br><span class="line">Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è¦è®©Geelyå­¦ä¹ Rubyè¯¾ç¨‹ï¼Œæˆ‘ä»¬åªèƒ½åœ¨<code>Geely</code>ç±»ä¸­æ·»åŠ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyRubyCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ Rubyè¯¾ç¨‹&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œåœ¨Testç±»ä¸­æ·»åŠ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">geely.studyRubyCourse();</span><br></pre></td></tr></table></figure>

<div class="note warning"><p>ä¸ç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™</p>
</div>

<h3 id="æ­£ä¾‹"><a href="#æ­£ä¾‹" class="headerlink" title="æ­£ä¾‹"></a>æ­£ä¾‹</h3><p>åˆ›å»ºæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºç±»ï¼Œå¸¦æœ‰æˆå‘˜å˜é‡<code>ICourse course</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Geely</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> ICourse course;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyImoocCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        course.studyCourse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FECourse</span> <span class="keyword">implements</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCourse</span> <span class="keyword">implements</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonCourse</span> <span class="keyword">implements</span> <span class="title">ICourse</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Geelyåœ¨å­¦ä¹ Pythonè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Geely geely = <span class="keyword">new</span> Geely(<span class="keyword">new</span> JavaCourse());</span><br><span class="line">        geely.studyImoocCourse();</span><br><span class="line"></span><br><span class="line">        geely.setCourse(<span class="keyword">new</span> FECourse());</span><br><span class="line">        geely.studyImoocCourse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Geelyåœ¨å­¦ä¹ Javaè¯¾ç¨‹</span><br><span class="line">Geelyåœ¨å­¦ä¹ FEè¯¾ç¨‹</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœè¦æ·»åŠ æ–°çš„è¯¾ç¨‹ï¼Œåªéœ€è¦åˆ›å»ºå®ç°ç±»å³å¯ã€‚ç„¶ååº”ç”¨ç±»è®¾ç½®å®ç°ç±»ï¼Œæ— éœ€æ”¹åŠ¨å…¶ä»–ä»£ç ï¼Œç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ã€‚</p>
<h1 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h1><h2 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>ä¸è¦å­˜åœ¨å¤šäºä¸€ä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå› </li>
<li>ä¸€ä¸ªç±»/æ¥å£/æ–¹æ³•åªè´Ÿè´£ä¸€é¡¹èŒè´£</li>
<li>ä¼˜ç‚¹:é™ä½ç±»çš„å¤æ‚åº¦ã€æé«˜ç±»çš„å¯è¯»æ€§ã€æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€é™ä½å˜æ›´å¼•èµ·çš„é£é™©</li>
</ul>
<h2 id="Coding-2"><a href="#Coding-2" class="headerlink" title="Coding"></a>Coding</h2><h3 id="åä¾‹-1"><a href="#åä¾‹-1" class="headerlink" title="åä¾‹"></a>åä¾‹</h3><p>åˆ›å»ºç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mainMoveMode</span><span class="params">(String birdName)</span> </span>&#123;</span><br><span class="line">        System.out.println(birdName + <span class="string">&quot; ç”¨ç¿…è†€é£&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Bird bird = <span class="keyword">new</span> Bird();</span><br><span class="line">        bird.mainMoveMode(<span class="string">&quot;å¤§é›&quot;</span>);</span><br><span class="line">        bird.mainMoveMode(<span class="string">&quot;é¸µé¸Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å¤§é› ç”¨ç¿…è†€é£</span><br><span class="line">é¸µé¸Ÿ ç”¨ç¿…è†€é£</span><br></pre></td></tr></table></figure>

<p>é¸µé¸Ÿæ˜¯ç”¨è„šèµ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹Birdç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mainMoveMode</span><span class="params">(String birdName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;é¸µé¸Ÿ&quot;</span>.equals(birdName)) &#123;</span><br><span class="line">            System.out.println(birdName + <span class="string">&quot; ç”¨è„šèµ°&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(birdName + <span class="string">&quot; ç”¨ç¿…è†€é£&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰æ›´å¤šçš„é¸Ÿç±»ï¼Œæˆ‘ä»¬è¿˜è¦å†™æ›´å¤šçš„elseä»£ç ã€‚</p>
<h3 id="æ­£ä¾‹-1"><a href="#æ­£ä¾‹-1" class="headerlink" title="æ­£ä¾‹"></a>æ­£ä¾‹</h3><p>æˆ‘ä»¬ä¿®æ”¹ä¸‹åä¾‹ä¸­çš„ä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyBird</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mainMoveMode</span><span class="params">(String birdName)</span> </span>&#123;</span><br><span class="line">        System.out.println(birdName + <span class="string">&quot; ç”¨ç¿…è†€é£&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WalkBird</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mainMoveMode</span><span class="params">(String birdName)</span> </span>&#123;</span><br><span class="line">        System.out.println(birdName + <span class="string">&quot; ç”¨è„šèµ°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FlyBird flyBird = <span class="keyword">new</span> FlyBird();</span><br><span class="line">        flyBird.mainMoveMode(<span class="string">&quot;å¤§é›&quot;</span>);</span><br><span class="line"></span><br><span class="line">        WalkBird walkBird = <span class="keyword">new</span> WalkBird();</span><br><span class="line">        walkBird.mainMoveMode(<span class="string">&quot;é¸µé¸Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">å¤§é› ç”¨ç¿…è†€é£</span><br><span class="line">é¸µé¸Ÿ ç”¨è„šèµ°</span><br></pre></td></tr></table></figure>

<p>å†ä¸¾ä¸€ä¸ªä¾‹å­</p>
<p>åˆ›å»ºæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯¾ç¨‹å†…å®¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * Created on 2019/7/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICourseContent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getCoursName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[] getCourseVideo();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯¾ç¨‹ç®¡ç†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * Created on 2019/7/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICourseManager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refundCourse</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®ç°ç±»ï¼Œæœ‰ç€è¯¾ç¨‹å†…å®¹å’Œè¯¾ç¨‹ç®¡ç†ä¸¤ç§èŒèƒ½</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseImpl</span> <span class="keyword">implements</span> <span class="title">ICourseContent</span>ï¼Œ <span class="title">ICourseManager</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCoursName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getCourseVideo() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studyCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refundCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ¥å£éš”ç¦»åŸåˆ™"><a href="#æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™"></a>æ¥å£éš”ç¦»åŸåˆ™</h1><h2 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£</li>
<li>ä¸€ä¸ªç±»å¯¹ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š</li>
<li>å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£</li>
<li>å°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘</li>
<li>ä¼˜ç‚¹:ç¬¦åˆæˆ‘ä»¬å¸¸è¯´çš„é«˜å†…èšä½è€¦åˆçš„è®¾è®¡æ€æƒ³ï¼Œä»è€Œä½¿å¾—ç±»å…·æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<div class="note warning"><p>æ³¨æ„é€‚åº¦åŸåˆ™ï¼Œä¸€å®šè¦é€‚åº¦</p>
</div>

<h2 id="Coding-3"><a href="#Coding-3" class="headerlink" title="Coding"></a>Coding</h2><h3 id="åä¾‹-2"><a href="#åä¾‹-2" class="headerlink" title="åä¾‹"></a>åä¾‹</h3><p>åˆ›å»ºæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAnimalAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="keyword">implements</span> <span class="title">IAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¸Ÿ åƒé¥­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¸Ÿ é£&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é¸Ÿä¸ä¼šæ¸¸æ³³ï¼Œç©ºå®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">IAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹— åƒé¥­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç‹—ä¸ä¼šé£ï¼Œç©ºå®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹— æ¸¸æ³³&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé¸Ÿå’Œç‹—å®ç°äº†æ¥å£åï¼Œå„è‡ªéƒ½æœ‰æ— ç”¨çš„æ¥å£ï¼Œæ‰€ä»¥è¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œåªèƒ½é‡‡å–ç©ºå®ç°çš„æ–¹å¼ã€‚ä½†æ˜¯å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ï¼Œè¿˜æ˜¯å¯ä»¥è°ƒç”¨ç‹—çš„flyæ–¹æ³•ï¼Œå¾—åˆ°ç©ºçš„å®ç°ã€‚</p>
<h3 id="æ­£ä¾‹-2"><a href="#æ­£ä¾‹-2" class="headerlink" title="æ­£ä¾‹"></a>æ­£ä¾‹</h3><p>å°†åä¾‹ä¸­çš„æ¥å£æ¥å£æ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEatAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IFlyAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISwimAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Dog</code>æ”¹ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">IEatAnimalAction</span>ï¼Œ<span class="title">ISwimAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹— åƒé¥­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹— æ¸¸æ³³&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Bird</code>æ”¹ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="keyword">implements</span> <span class="title">IEatAnimalAction</span>ï¼Œ<span class="title">IFlyAnimalAction</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¸Ÿ åƒé¥­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¸Ÿ é£&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±æˆåŠŸçš„å°†ä¸€ä¸ªå¤§æ¥å£ï¼Œä¼˜åŒ–ä¸ºåˆ†æ‘ŠèŒè´£çš„å°æ¥å£ï¼Œå®ç°ç±»å¯ä»¥æ ¹æ®éœ€è¦å®ç°å¤šä¸ªèŒèƒ½æ¥å£ã€‚</p>
<h1 id="è¿ªç±³ç‰¹åŸåˆ™"><a href="#è¿ªç±³ç‰¹åŸåˆ™" class="headerlink" title="è¿ªç±³ç‰¹åŸåˆ™"></a>è¿ªç±³ç‰¹åŸåˆ™</h1><h2 id="å®šä¹‰-4"><a href="#å®šä¹‰-4" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚åˆå«æœ€å°‘çŸ¥é“åŸåˆ™</li>
<li>å°½é‡é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆ</li>
<li>ä¼˜ç‚¹:é™ä½ç±»ä¹‹é—´çš„è€¦åˆ</li>
</ul>
<h2 id="Coding-4"><a href="#Coding-4" class="headerlink" title="Coding"></a>Coding</h2><h3 id="åä¾‹-3"><a href="#åä¾‹-3" class="headerlink" title="åä¾‹"></a>åä¾‹</h3><p>åˆ›å»ºè¯¾ç¨‹ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºé¡¹ç›®ç»ç†ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamLeader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkNumberOfCourse</span><span class="params">(List&lt;Course&gt; courseList)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š&quot;</span> + courseList.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºè€æ¿ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commandCheckNumber</span><span class="params">(TeamLeader teamLeader)</span> </span>&#123;</span><br><span class="line">        List&lt;Course&gt; courseList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            courseList.add(<span class="keyword">new</span> Course());</span><br><span class="line">        &#125;</span><br><span class="line">        teamLeader.checkNumberOfCourse(courseList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š<span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œå…¶å®è€æ¿å¹¶ä¸éœ€è¦çŸ¥é“è¯¾ç¨‹çš„ç»†èŠ‚ï¼Œåªéœ€è¦é—®ä¸€ä¸‹é¡¹ç›®ç»ç†ï¼Œæœ‰å¤šå°‘è¯¾ç¨‹ï¼Œé¡¹ç›®ç»ç†ç›´æ¥å‘Šè¯‰è€æ¿æœ‰20èŠ‚åœ¨çº¿è¯¾ç¨‹ã€‚è€Œä¸æ˜¯è€æ¿å°†è¯¾ç¨‹åˆ—å‡ºï¼Œè®©é¡¹ç›®ç»ç†ç»Ÿè®¡ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸‹UMLç±»å›¾</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c9e390ca6837252.png"></p>
<h3 id="æ­£ä¾‹-3"><a href="#æ­£ä¾‹-3" class="headerlink" title="æ­£ä¾‹"></a>æ­£ä¾‹</h3><p>é¡¹ç›®ç»ç†ç±»ä¿®æ”¹ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamLeader</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkNumberOfCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Course&gt; courseList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            courseList.add(<span class="keyword">new</span> Course());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;åœ¨çº¿è¯¾ç¨‹çš„æ•°é‡æ˜¯ ï¼š&quot;</span> + courseList.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€æ¿ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commandCheckNumber</span><span class="params">(TeamLeader teamLeader)</span> </span>&#123;</span><br><span class="line">        teamLeader.checkNumberOfCourse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™è¿è¡Œä¸€ä¸‹ï¼Œç»“æœä¸€æ ·ã€‚ä½†æ˜¯ä»UMLç±»å›¾ä¸Šæ¥çœ‹ï¼Œæ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŒ–çš„ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/28/5d3c9cf88cb0392036.png"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>UML</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰å·¥å‚æ–¹æ³•æ¨¡å¼</title>
    <url>/p/30626/</url>
    <content><![CDATA[<h1 id="å®šä¹‰ä¸ç±»å‹"><a href="#å®šä¹‰ä¸ç±»å‹" class="headerlink" title="å®šä¹‰ä¸ç±»å‹"></a>å®šä¹‰ä¸ç±»å‹</h1><ul>
<li>å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†è®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œå·¥å‚æ–¹æ³•<strong>è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œã€‚</strong></li>
<li>ç±»å‹ï¼šåˆ›å»ºå‹</li>
</ul>
<h1 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h1><ul>
<li>åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç </li>
<li>å®¢æˆ·ç«¯(åº”ç”¨å±‚)ä¸ä¾èµ–äºäº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€å®ç°ç­‰ç»†èŠ‚</li>
<li>ä¸€ä¸ªç±»é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå“ªä¸ªå¯¹è±¡</li>
</ul>
<h1 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h1><ul>
<li>ç”¨æˆ·åªéœ€è¦å…³å¿ƒæ‰€éœ€äº§å“å¯¹åº”çš„å·¥å‚ï¼Œæ— é¡»å…³å¿ƒåˆ›å»ºç»†èŠ‚</li>
<li>åŠ å…¥æ–°äº§å“ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæé«˜å¯æ‰©å±•æ€§</li>
</ul>
<h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><ul>
<li>ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦</li>
<li>å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦</li>
</ul>
<h1 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h1><p>å·¥å‚æ–¹æ³•æ¨¡å¼ä»ä¸€å®šæ„ä¹‰ä¸Šè®²æ˜¯ä»ç®€å•å·¥å‚æ¨¡å¼è¡ç”Ÿè¿‡æ¥çš„ï¼Œåˆ›å»ºäº§å“æŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå…·ä½“äº§å“</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVideo</span> <span class="keyword">extends</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonVideo</span> <span class="keyword">extends</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Pythonè§†é¢‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº§å“å·¥å‚æ–¹æ³•æŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Video <span class="title">getVideo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº§å“å·¥å‚æ–¹æ³•å®ç°ç±»ï¼ˆæ¯ä¸ªäº§å“éƒ½æœ‰å¯¹åº”çš„å®ç°ç±»ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVideoFactory</span> <span class="keyword">extends</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">getVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JavaVideo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonVideoFactory</span> <span class="keyword">extends</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">getVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PythonVideo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        VideoFactory javaVideoFactory = <span class="keyword">new</span> JavaVideoFactory();</span><br><span class="line">        VideoFactory pythonVideoFactory = <span class="keyword">new</span> PythonVideoFactory();</span><br><span class="line">        Video video = javaVideoFactory.getVideo();</span><br><span class="line">        video.produce();</span><br><span class="line"></span><br><span class="line">        video = pythonVideoFactory.getVideo();</span><br><span class="line">        video.produce();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">å½•åˆ¶Javaè¯¾ç¨‹</span><br><span class="line">å½•åˆ¶Pythonè§†é¢‘</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬ç°åœ¨æ–°å¢ä¸€ä¸ªäº§å“â€“å‰ç«¯è¯¾ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºäº§å“ç±»ï¼Œäº§å“å·¥å‚ç±»ï¼Œä½†æ˜¯æ— éœ€æ”¹åŠ¨å…¶ä»–ä»£ç ï¼Œåšåˆ°äº†å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FEVideo</span> <span class="keyword">extends</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶å‰ç«¯è¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FEVideoFactory</span> <span class="keyword">extends</span> <span class="title">VideoFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">getVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FEVideo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾çœ‹å‡ºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ç¼ºç‚¹â€“ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚</p>
<p>å› ä¸ºä¸€æ—¦æˆ‘ä»¬éœ€è¦ç°åœ¨äº§å“ï¼Œå°±éœ€è¦åˆ›å»ºäº§å“å¯¹åº”çš„äº§å“å®ç°ç±»ï¼Œä»¥åŠäº§å“å·¥å‚æ–¹æ³•ç±»ï¼Œæ— ç–‘å¢åŠ äº†ç±»çš„ä¸ªæ•°å’Œç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p>
<p>å®Œæ•´çš„UMLç±»å›¾</p>
<p><img data-src="https://i.loli.net/2019/07/29/5d3dcbfabe70f65083.png"></p>
<h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><h2 id="Collectionæºç "><a href="#Collectionæºç " class="headerlink" title="Collectionæºç "></a><code>Collection</code>æºç </h2><p>jdkä¸­å…¸å‹çš„å·¥å‚æ–¹æ³•æ¨¡å¼ä½“ç°ä¸º<code>java.util.Collection</code></p>
<p>æŠ½è±¡äº§å“ä¸º<code>java.util.Iterator</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠ½è±¡å·¥å‚å®šä¹‰äº†åˆ›å»ºäº§å“æ—çš„æ–¹æ³•<code>java.util.Collection.#iterator</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>ç”±å­ç±»æ¥å®šä¹‰å…·ä½“åˆ›å»ºäº§å“çš„é€»è¾‘ï¼Œå¦‚<code>java.util.ArrayList.#iterator</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œå…·ä½“çš„äº§å“å®šä¹‰ä¸º<code>java.util.ArrayList$Itr</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UMLç±»å›¾</p>
<p><img data-src="https://i.loli.net/2019/07/29/5d3dcda8d25df62223.png"></p>
<h2 id="URLStreamHandlerFactoryæºç "><a href="#URLStreamHandlerFactoryæºç " class="headerlink" title="URLStreamHandlerFactoryæºç "></a><code>URLStreamHandlerFactory</code>æºç </h2><p>å†æ¥çœ‹ä¸€ä¸ªå…¸å‹ä¾‹å­ï¼Œ<code>java.net.URLStreamHandlerFactory</code>ä½œä¸ºå·¥å‚æ–¹æ³•æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†åˆ›å»ºäº§å“çš„æŠ½è±¡æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">URLStreamHandlerFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">URLStreamHandler <span class="title">createURLStreamHandler</span><span class="params">(String protocol)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº§å“æŠ½è±¡ç±»å°±æ˜¯<code>java.net.URLStreamHandler</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">URLStreamHandler</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº§å“çš„å·¥å‚æ–¹æ³•å®ç°ç±»ä¸º<code>sun.misc.Launcher$Factory</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">URLStreamHandlerFactory</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> URLStreamHandler <span class="title">createURLStreamHandler</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> String PREFIX = <span class="string">&quot;sun.net.www.protocol&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Factory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> URLStreamHandler <span class="title">createURLStreamHandler</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">            String var2 = PREFIX + <span class="string">&quot;.&quot;</span> + var1 + <span class="string">&quot;.Handler&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// é€šè¿‡åå°„åˆ›å»ºæŒ‡å®šç±»å‹çš„äº§å“</span></span><br><span class="line">                Class var3 = Class.forName(var2);</span><br><span class="line">                <span class="keyword">return</span> (URLStreamHandler)var3.newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ReflectiveOperationException var4) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(<span class="string">&quot;could not load &quot;</span> + var1 + <span class="string">&quot;system protocol handler&quot;</span>ï¼Œ var4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œå·¥å‚å®ç°ç±»é€šè¿‡åå°„ç±»åˆ›å»ºå…·ä½“çš„äº§å“å®ç°ç±»ï¼Œè€Œäº§å“å®ç°ç±»éå¸¸å¤š</p>
<p><img data-src="https://i.loli.net/2019/07/29/5d3dcf7262c4150474.png"></p>
<p>è¿™æ ·æ»¡è¶³äº†å¼€é—­åŸåˆ™ï¼Œä¹Ÿæ²¡æœ‰è¿‡å¤šçš„å¢åŠ ç±»çš„æ•°é‡ï¼Œå€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Kuberneteséƒ¨ç½²csi-driver</title>
    <url>/p/20900/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»åœ¨<code>k8s</code>é›†ç¾¤ä¸­éƒ¨ç½²<code>nfs-csi-driver</code></p>
<span id="more"></span>

<h1 id="ç¯å¢ƒä¾èµ–"><a href="#ç¯å¢ƒä¾èµ–" class="headerlink" title="ç¯å¢ƒä¾èµ–"></a>ç¯å¢ƒä¾èµ–</h1><ul>
<li>Docker</li>
<li>Kubernetesï¼ˆæœ¬æ–‡æ˜¯åŸºäºRancherçš„RKEé›†ç¾¤ï¼‰</li>
</ul>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>csi-driver</code>æ˜¯éå¸¸ä¸°å¯Œçš„ï¼Œæ–°æ­å»ºçš„é›†ç¾¤ï¼Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘çš„<code>NAS</code>ä½œä¸ºå­˜å‚¨åç«¯ï¼ˆ<code>NAS</code>å¯¹æ¯”äº‘ç›˜ï¼Œæ‰©å±•æ€§é«˜ã€è´¹ç”¨ä½ã€å®¹é”™å¥½ï¼‰ï¼Œä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„<a href="https://github.com/kubernetes-sigs/alibaba-cloud-csi-driver/blob/master/docs/nas.md">NAS CSI Plugin</a>è¿›è¡Œ<code>csi-driver</code>çš„å®‰è£…ã€‚</p>
<p>å¯¹äºæœ‰äº‘ç›˜çš„<code>ECS</code>æˆ–è€…æœ¬åœ°æœåŠ¡å™¨æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨<code>NFS</code>ä½œä¸ºå­˜å‚¨åç«¯ï¼Œk8så®˜æ–¹æä¾›äº†<a href="https://github.com/kubernetes-csi/csi-driver-nfs">nfs-csi-driver</a></p>
<p>å¦‚æœæ˜¯é˜¿é‡Œçš„<code>ECS</code>ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é˜¿é‡Œæä¾›çš„<a href="https://github.com/kubernetes-sigs/alibaba-cloud-csi-driver/blob/master/docs/disk.md">disk-csi-driver</a>ï¼Œä½¿ç”¨äº‘ç›˜ä½œä¸ºå­˜å‚¨åç«¯ï¼ˆæœ‰<strong>å•æœºæ•…éšœ</strong>çš„é£é™©ï¼‰</p>
<h1 id="éƒ¨ç½²nfs-csi-driver"><a href="#éƒ¨ç½²nfs-csi-driver" class="headerlink" title="éƒ¨ç½²nfs-csi-driver"></a>éƒ¨ç½²<code>nfs-csi-driver</code></h1><h2 id="1ã€å®‰è£…nfs-server"><a href="#1ã€å®‰è£…nfs-server" class="headerlink" title="1ã€å®‰è£…nfs-server"></a>1ã€å®‰è£…<code>nfs-server</code></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹©ä¸€å°ä¸»æœºï¼Œå®‰è£…nfs-server</span></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install nfs-kernel-server</span><br><span class="line">$ mkdir -p /data/nfs</span><br><span class="line">$ sudo vim /etc/fstab</span><br><span class="line">172.16.1.23:/data/nfs /data/nfs    nfs defaults,timeo=900,retrans=5,_netdev    0 0</span><br><span class="line">$ sudo vim /etc/exports</span><br><span class="line">/data/nfs    172.16.1.23/12(rw,sync,all_squash,anonuid=1001,anongid=1001,no_subtree_check) <span class="comment"># è¿™é‡Œè®¾ç½®anonuidå’Œanongidï¼Œæ˜¯ä¸ºäº†ä¾¿äºéƒ¨ç½²bitnamiæä¾›çš„helm charts</span></span><br><span class="line">$ sudo exportfs -ra</span><br><span class="line"><span class="comment"># bitnamiæä¾›çš„helm-chartçš„fsGroupé»˜è®¤æ˜¯1001ï¼Œå¦‚æœ1001çš„ç”¨æˆ·è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ç”¨æˆ·çš„uidå’Œgidï¼Œå°†1001ç©ºå‡ºæ¥ç»™bitnamiä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶ä»–ä¸»æœºï¼Œé…ç½®nfs-client</span></span><br><span class="line">$ apt install nfs-common</span><br><span class="line">$ sudo mount -t nfs -o vers=4 172.16.1.23:/data/nfs /data/nfs</span><br><span class="line"></span><br><span class="line">$ sudo vim /etc/fstab</span><br><span class="line">172.16.1.23:/data/nfs /data/nfs    nfs defaults,timeo=900,retrans=5,_netdev    0 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•nfsè®¿é—®</span></span><br><span class="line"><span class="comment"># åœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šä¼šå¯¹åº”åˆ—å‡ºä¿®æ”¹</span></span><br></pre></td></tr></table></figure>

<h2 id="2ã€å®‰è£…nfs-csi-driver"><a href="#2ã€å®‰è£…nfs-csi-driver" class="headerlink" title="2ã€å®‰è£…nfs-csi-driver"></a>2ã€å®‰è£…<code>nfs-csi-driver</code></h2><p>è¿™é‡Œæœ‰ä¸ªå°æ’æ›²ï¼Œç”±äºå›½å†…çš„ç½‘ç»œç¯å¢ƒï¼Œæ— æ³•ä¸‹è½½è°·æ­Œçš„dockeré•œåƒï¼Œæ‰€ä»¥åªèƒ½ä¸€ä¸ªä¸ªçš„æŠŠå®ƒä»¬è½¬åˆ°dockerhubä¸Š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull k8s.gcr.io/sig-storage/livenessprobe:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker tag k8s.gcr.io/sig-storage/livenessprobe:v2.1.0 qq1398371419/gcr.sig-storage.livenessprobe:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker push qq1398371419/gcr.sig-storage.livenessprobe:v2.1.0</span><br><span class="line"></span><br><span class="line">docker pull k8s.gcr.io/sig-storage/csi-provisioner:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker tag k8s.gcr.io/sig-storage/csi-provisioner:v2.1.0 qq1398371419/gcr.sig-storage.csi-provisioner:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker push qq1398371419/gcr.sig-storage.csi-provisioner:v2.1.0</span><br><span class="line">    </span><br><span class="line">docker pull k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker tag k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.1.0 qq1398371419/gcr.sig-storage.csi-node-driver-registrar:v2.1.0 \</span><br><span class="line">    &amp;&amp; docker push qq1398371419/gcr.sig-storage.csi-node-driver-registrar:v2.1.0</span><br></pre></td></tr></table></figure>

<p>å®‰è£…<code>nfs-csi-driver</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -skSL https://gitee.com/qq1398371419/csi-driver-nfs/raw/master/deploy/install-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2021/06/20/lLBaReX3HkDdiur.png" alt="Image"></p>
<h2 id="3ã€å®‰è£…StorageClass"><a href="#3ã€å®‰è£…StorageClass" class="headerlink" title="3ã€å®‰è£…StorageClass"></a>3ã€å®‰è£…<code>StorageClass</code></h2><p><code>nfs-sc.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-csi</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">nfs.csi.k8s.io</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.23</span> <span class="comment"># è¿™é‡Œæ”¹æˆè‡ªå·±çš„å†…ç½‘IP</span></span><br><span class="line">  <span class="attr">share:</span> <span class="string">/data/nfs</span> <span class="comment"># è¿™é‡Œæ”¹æˆè‡ªå·±çš„nfså…±äº«ç›®å½•</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span></span><br><span class="line"><span class="attr">mountOptions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hard</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nfsvers=4.1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl create -f nfs-sc.yaml</span><br></pre></td></tr></table></figure>

<h2 id="4ã€æµ‹è¯•éƒ¨ç½²Redis"><a href="#4ã€æµ‹è¯•éƒ¨ç½²Redis" class="headerlink" title="4ã€æµ‹è¯•éƒ¨ç½²Redis"></a>4ã€æµ‹è¯•éƒ¨ç½²<code>Redis</code></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim redis-test.yaml</span><br><span class="line">---</span><br><span class="line">master:</span><br><span class="line">  persistence:</span><br><span class="line">    storageClass: nfs-csi</span><br><span class="line">  service:</span><br><span class="line">    nodePort: 30001</span><br><span class="line">    <span class="built_in">type</span>: NodePort</span><br><span class="line">replica:</span><br><span class="line">  persistence:</span><br><span class="line">    storageClass: nfs-csi</span><br><span class="line">auth:</span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">$ helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">$ helm install my-release bitnami/redis -f redis-test.yaml</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2021/06/20/dDX954OPA3nBKmi.png" alt="image-20210620031253181"></p>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><blockquote>
<p>å‰é¢æåˆ°çš„è®¾ç½®anonuidå’Œanongidï¼Œæ˜¯å› ä¸ºéƒ¨ç½²<code>bitnami</code>æä¾›çš„<code>helm charts</code>é‡åˆ°äº†æ— æ³•å†™å…¥æ–‡ä»¶çš„é—®é¢˜ï¼Œä¹‹æ‰€ä»¥è®¾ç½®ä¸º1001ï¼Œå› ä¸ºbitnamié»˜è®¤çš„uidæ˜¯1001</p>
</blockquote>
<p><img data-src="https://i.loli.net/2021/06/20/ybG6rDFjchtZHla.png" alt="Image"></p>
<p>å®¹å™¨å¯¹äºmountçš„è·¯å¾„çš„è®¿é—®æƒé™é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/sammyliu/p/10129670.html">https://www.cnblogs.com/sammyliu/p/10129670.html</a></p>
<h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ul>
<li><a href="https://kubernetes-csi.github.io/docs/drivers.html">Kubernetes CSI Developer Documentation</a></li>
<li><a href="https://github.com/kubernetes-sigs/alibaba-cloud-csi-driver">alibaba-cloud-csi-driver</a></li>
<li><a href="https://github.com/kubernetes-csi">Kubernetes CSI</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Lombok è¯¦è§£</title>
    <url>/p/12232/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>lombokæ˜¯ä¸€ä¸ªç¼–è¯‘çº§åˆ«çš„æ’ä»¶ï¼Œå®ƒå¯ä»¥åœ¨é¡¹ç›®ç¼–è¯‘çš„æ—¶å€™ç”Ÿæˆä¸€äº›ä»£ç ã€‚é€šä¿—çš„è¯´ï¼Œlombokå¯ä»¥é€šè¿‡æ³¨è§£æ¥æ ‡ç¤ºç”Ÿæˆ<code>getter</code> <code>settter</code>ç­‰ä»£ç ã€‚</p>
<span id="more"></span>

<h1 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h1><p>åˆ›å»ºgradleé¡¹ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">compile group: &#x27;org.projectlombok&#x27;, name: &#x27;lombok&#x27;, version: &#x27;1.16.20&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h1><h2 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h2><blockquote>
<p>æ ‡è®°å­—æ®µä¸å¯ä¸ºnull</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="meta">@NonNull</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="meta">@NonNull</span> Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (age == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Getter-Setter"><a href="#Getter-Setter" class="headerlink" title="@Getter/@Setter"></a>@Getter/@Setter</h2><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆgetterå’Œsetteræ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h2><blockquote>
<p>è‡ªåŠ¨å…³é—­æµä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cleanup</span></span><br><span class="line">InputStream in = <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream in = <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">if</span> (Collections.singletonList(in).get(<span class="number">0</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">    in.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AllArgsConstructor-NoArgsConstructor-RequiredArgsConstructor"><a href="#AllArgsConstructor-NoArgsConstructor-RequiredArgsConstructor" class="headerlink" title="@AllArgsConstructor/@NoArgsConstructor/@RequiredArgsConstructor"></a>@AllArgsConstructor/@NoArgsConstructor/@RequiredArgsConstructor</h2><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆå…¨å‚æ„é€ å‡½æ•°å’Œæ— å‚æ„é€ å‡½æ•°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h2><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆå»ºé€ è€…æ¨¡å¼çš„bean</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    Person(String name, Integer age) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Person.<span class="function">PersonBuilder <span class="title">builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person.PersonBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">        PersonBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person.<span class="function">PersonBuilder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person.<span class="function">PersonBuilder <span class="title">age</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Person <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="keyword">this</span>.name, <span class="keyword">this</span>.age);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Person.PersonBuilder(name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;, age=&quot;</span> + <span class="keyword">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h2><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆequalså’Œhashcodeæ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Person &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line"></span><br><span class="line">    public Person() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (o == this) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else if (!(o instanceof Person)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Person other = (Person)o;</span><br><span class="line">            if (!other.canEqual(this)) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Object this$name = this.name;</span><br><span class="line">                Object other$name = other.name;</span><br><span class="line">                if (this$name == null) &#123;</span><br><span class="line">                    if (other$name != null) &#123;</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else if (!this$name.equals(other$name)) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Object this$age = this.age;</span><br><span class="line">                Object other$age = other.age;</span><br><span class="line">                if (this$age == null) &#123;</span><br><span class="line">                    if (other$age != null) &#123;</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else if (!this$age.equals(other$age)) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected boolean canEqual(Object other) &#123;</span><br><span class="line">        return other instanceof Person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        int PRIME = true;</span><br><span class="line">        int result = 1;</span><br><span class="line">        Object $name = this.name;</span><br><span class="line">        int result = result * 59 + ($name == null ? 43 : $name.hashCode());</span><br><span class="line">        Object $age = this.age;</span><br><span class="line">        result = result * 59 + ($age == null ? 43 : $age.hashCode());</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h2><blockquote>
<p>è‡ªåŠ¨ç”ŸæˆtoString()æ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person(name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;, age=&quot;</span> + <span class="keyword">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h2><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆå…¨å‚æ„é€ å‡½æ•°ã€Getteræ–¹æ³•ã€equalsæ–¹æ³•ã€hashCodeæ³•ã€toStringæ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š@Valueä¸ä¼šç”ŸæˆSetteræ–¹æ³•</p>
<h2 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h2><blockquote>
<p>è‡ªåŠ¨ä¸ºè¢«æ ‡è®°çš„æ–¹æ³•æ·»åŠ synchronizedé”</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized(&quot;readLock&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object $LOCK = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>($LOCK) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>($lock) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(readLock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Delegate"><a href="#Delegate" class="headerlink" title="@Delegate"></a>@Delegate</h2><blockquote>
<p>ä¸ºæ ‡è®°å±æ€§ç”Ÿæˆå§”æ‰˜æ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegateExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Delegate</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DelegateExample delegateExample;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegateExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelegateExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DelegateExample delegateExample;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo</span><span class="params">(DelegateExample delegateExample)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delegateExample = delegateExample;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å§”æ‰˜æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delegateExample.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Lombok</tag>
      </tags>
  </entry>
  <entry>
    <title>MacOsç§‘å­¦ä¸Šç½‘</title>
    <url>/p/709/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰ä½¿ç”¨Windowsçš„æ—¶å€™ï¼Œæœ‰éå¸¸ä¼˜ç§€çš„å…¨å±€ä»£ç†è½¯ä»¶<a href="https://www.sockscap64.com/forums/forum/sstap/">SSTap</a>ç”¨æ¥ç¿»å¢™ï¼Œä½†æ˜¯åˆ°äº†MacOsä¸Šï¼Œæ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼SSTapçš„å…¨å±€ç¿»å¢™ç¥å™¨ã€‚</p>
<p>æœ€ç»ˆé‡‡å–çš„æ–¹æ¡ˆæ˜¯<a href="https://github.com/shadowsocks/ShadowsocksX-NG">ShadowsocksX-NG R8</a>+<a href="">Proxifier</a>çš„æ–¹å¼æ¥å®ç°ã€‚</p>
<span id="more"></span>

<h1 id="è½¯ä»¶"><a href="#è½¯ä»¶" class="headerlink" title="è½¯ä»¶"></a>è½¯ä»¶</h1><h2 id="ShadowsocksX-NG-R8"><a href="#ShadowsocksX-NG-R8" class="headerlink" title="ShadowsocksX-NG R8"></a>ShadowsocksX-NG R8</h2><blockquote>
<p>ShadowsocksX-NGæ˜¯Macä¸‹çš„SSRå·¥å…·ï¼Œå…·æœ‰å’ŒWindowsä¸‹åŒæ ·çš„ä½“éªŒï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œæ”¯æŒæœåŠ¡å™¨è®¢é˜…ã€‚</p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/10/06/FZbVImyYedEHQvl.png"></p>
<p>é…ç½®å°±ä¸å¤šè¯´äº†ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼ŒSocks5çš„ç›‘å¬åœ°å€æ˜¯ï¼š<code>127.0.0.1:1086</code>ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€ä¼šè¦ç”¨åˆ°ã€‚</p>
<p><img data-src="https://i.loli.net/2019/10/07/cCX4p8debKNvYrG.png"></p>
<h2 id="Proxifier"><a href="#Proxifier" class="headerlink" title="Proxifier"></a>Proxifier</h2><blockquote>
<p>Proxifieræ˜¯Macä¸‹çš„å…¨å±€ä»£ç†å·¥å…·ï¼Œå¯ä»¥å°†æµé‡ç»Ÿç»Ÿéƒ½è½¬åˆ°ä»£ç†ä¸Šï¼Œé…åˆShadowsocksX-NGï¼Œæˆ‘ä»¬å¾ˆè½»æ¾çš„å°±å¯ä»¥å®ç°å…¨å±€ç¿»å¢™</p>
</blockquote>
<p>è½¯ä»¶æœ¬èº«æ˜¯æ”¶è´¹çš„ï¼Œå½“ç„¶äº†ï¼Œåœ¨<code>Xclient.info</code>ä¸Šå¯ä»¥æ‰¾åˆ°ç ´è§£ç‰ˆï¼š<a href="https://xclient.info/s/proxifier.html">https://xclient.info/s/proxifier.html</a></p>
<p>å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„é…ç½®ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°å…¨å±€ç§‘å­¦ä¸Šç½‘äº†ï¼</p>
<h2 id="æ·»åŠ Socks5ä»£ç†"><a href="#æ·»åŠ Socks5ä»£ç†" class="headerlink" title="æ·»åŠ Socks5ä»£ç†"></a>æ·»åŠ Socks5ä»£ç†</h2><ol>
<li>ç‚¹å‡»Proxies</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/tebRvEfDKZN16JA.png"></p>
<ol start="2">
<li>ç‚¹å‡»Addï¼Œæ·»åŠ ä»£ç†</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/iLXBoKFwah4HuWP.png"></p>
<ol start="3">
<li>æ·»åŠ å®Œæ¯•åï¼Œå›åˆ°ä¸»ç•Œé¢ï¼Œç‚¹å‡»Rulesï¼Œä¿®æ”¹é»˜è®¤è§„åˆ™ï¼Œå°†åŠ¨ä½œæŒ‡å‘æˆ‘ä»¬æ–°æ·»åŠ çš„Socks5ä»£ç†</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/JRd6ekxHYwan4um.png"></p>
<ol start="4">
<li>æµ‹è¯•</li>
</ol>
<p>æ‰“å¼€ITerm2æµ‹è¯•ä¸‹ï¼Œåœ¨ç»ˆç«¯è¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl www.google.com</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/10/07/xEgSoUw9Bk6ODT5.png"></p>
<p>åŒæ—¶ï¼ŒProxifierä¹Ÿæ‰“å°å‡ºäº†ITerm2çš„æµé‡ä¿¡æ¯</p>
<p><img data-src="https://i.loli.net/2019/10/07/WNVMbpnF3OiZmkQ.png"></p>
<p>å¦å¤–ï¼ŒProxifierä¹Ÿæ”¯æŒæŒ‡å®šè½¯ä»¶èµ°ä»£ç†ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>åœ¨Rulesæ ‡ç­¾ä¸­ç‚¹å‡»Addï¼Œæ–°å»ºä¸€ä¸ªè§„åˆ™</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/u2keChKzrvGdoZF.png"></p>
<ol start="2">
<li>æ·»åŠ å®Œæˆåå‹¾é€‰ä½¿ç”¨ï¼ŒåŒæ—¶ï¼Œä¸è¦å¿˜è®°æŠŠDefaultè§„åˆ™çš„åŠ¨ä½œè®¾ç½®ä¸ºDirectï¼Œä¸ç„¶çš„è¯ï¼Œè¿˜æ˜¯å…¨å±€éƒ½èµ°ä»£ç†çš„ã€‚</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/6z2jaPkOGN4QVnc.png"></p>
<h1 id="ç›¸å…³è½¯ä»¶"><a href="#ç›¸å…³è½¯ä»¶" class="headerlink" title="ç›¸å…³è½¯ä»¶"></a>ç›¸å…³è½¯ä»¶</h1><ul>
<li>ShadowsocksX-NGï¼šé“¾æ¥:<a href="https://pan.baidu.com/s/10i6PZZIParFRkvaVu5KhxA">https://pan.baidu.com/s/10i6PZZIParFRkvaVu5KhxA</a>  å¯†ç :jvzx</li>
<li>Proxifierï¼šé“¾æ¥:<a href="https://pan.baidu.com/s/1ymZZRDJrjrIXXFrYfIxV_w">https://pan.baidu.com/s/1ymZZRDJrjrIXXFrYfIxV_w</a>  å¯†ç :exns</li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>ç§‘å­¦ä¸Šç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>PGæ•°æ®åº“å¸¸ç”¨æ“ä½œ</title>
    <url>/p/59866/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æ¥è§¦åˆ°çš„ä¸€äº›PGæ•°æ®åº“å¸¸ç”¨æ“ä½œï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚<span id="more"></span></p>
<h1 id="å…¨é‡è¿ç§»"><a href="#å…¨é‡è¿ç§»" class="headerlink" title="å…¨é‡è¿ç§»"></a>å…¨é‡è¿ç§»</h1><ul>
<li>å¤‡ä»½æ•°æ®</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pg_dump -h 172.19.235.145 -U &lt;username&gt; -d &lt;database&gt; &gt; 20180704_dbpe.sql</span><br></pre></td></tr></table></figure>

<ul>
<li>æ­£å¼è¿ç§»</li>
</ul>
<p>é¦–å…ˆè¦ä¿®æ”¹å¤‡ä»½æ–‡ä»¶*.sqlçš„ownerï¼Œé˜²æ­¢æƒé™å‡ºç°é”™è¯¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ psql -h &lt;ip&gt; -U &lt;username&gt; -d &lt;database&gt; -f 20180704_dbpe.sql</span><br></pre></td></tr></table></figure>

<p>ã€æ³¨æ„ç‚¹ã€‘è¯¥è¿ç§»æ“ä½œä¼šè¦†ç›–åŸæ¥çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æœ€å¥½åˆ›å»ºä¸€ä¸ªæ–°åº“ã€‚</p>
<h1 id="åˆ—å‡ºæ‰€æœ‰è¡¨åå’Œæ•°æ®åº“å"><a href="#åˆ—å‡ºæ‰€æœ‰è¡¨åå’Œæ•°æ®åº“å" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰è¡¨åå’Œæ•°æ®åº“å"></a>åˆ—å‡ºæ‰€æœ‰è¡¨åå’Œæ•°æ®åº“å</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> tablename <span class="keyword">from</span> pg_tables <span class="keyword">where</span> schemaname <span class="operator">=</span><span class="string">&#x27;public&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="PostgreSQL-ä¸­-æœ‰æ—¶å€™æƒ³åˆ é™¤æ•°æ®åº“ï¼ˆdrop-database-swiftliveqaapi-ï¼‰ï¼Œå‘ç°æç¤ºâ€œERROR-database-â€œxxxxxxâ€-is-being-accessed-by-other-users-DETAIL-There-are-30-other-sessions-using-the-database-â€"><a href="#PostgreSQL-ä¸­-æœ‰æ—¶å€™æƒ³åˆ é™¤æ•°æ®åº“ï¼ˆdrop-database-swiftliveqaapi-ï¼‰ï¼Œå‘ç°æç¤ºâ€œERROR-database-â€œxxxxxxâ€-is-being-accessed-by-other-users-DETAIL-There-are-30-other-sessions-using-the-database-â€" class="headerlink" title="PostgreSQL ä¸­ æœ‰æ—¶å€™æƒ³åˆ é™¤æ•°æ®åº“ï¼ˆdrop database swiftliveqaapi;ï¼‰ï¼Œå‘ç°æç¤ºâ€œERROR:  database â€œxxxxxxâ€ is being accessed by other users DETAIL:  There are 30 other sessions using the database.â€"></a>PostgreSQL ä¸­ æœ‰æ—¶å€™æƒ³åˆ é™¤æ•°æ®åº“ï¼ˆdrop database swiftliveqaapi;ï¼‰ï¼Œå‘ç°æç¤ºâ€œERROR:  database â€œxxxxxxâ€ is being accessed by other users DETAIL:  There are 30 other sessions using the database.â€</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ç”¨psql ç™»å½•è¿›å…¥ï¼Œ æ‰§è¡Œè¯­å¥ï¼š</span><br><span class="line">SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname=<span class="string">&#x27;æ•°æ®åº“å&#x27;</span> AND pid&lt;&gt;pg_backend_pid();</span><br><span class="line">ç„¶åå°±å¯ä»¥åˆ é™¤æ•°æ®åº“äº†</span><br></pre></td></tr></table></figure>

<h1 id="ä¿®æ”¹è¡¨çš„åºåˆ—ä¸ºidæœ€å¤§å€¼"><a href="#ä¿®æ”¹è¡¨çš„åºåˆ—ä¸ºidæœ€å¤§å€¼" class="headerlink" title="ä¿®æ”¹è¡¨çš„åºåˆ—ä¸ºidæœ€å¤§å€¼"></a>ä¿®æ”¹è¡¨çš„åºåˆ—ä¸ºidæœ€å¤§å€¼</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT setval(<span class="string">&#x27;è¡¨å_id_seq&#x27;</span>, (SELECT MAX(id) FROM è¡¨å));</span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥è¯¢è¡¨ç»“æ„"><a href="#æŸ¥è¯¢è¡¨ç»“æ„" class="headerlink" title="æŸ¥è¯¢è¡¨ç»“æ„"></a>æŸ¥è¯¢è¡¨ç»“æ„</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	COLUMN_NAME <span class="keyword">AS</span> åˆ—å,</span><br><span class="line">	DATA_TYPE <span class="keyword">AS</span> å­—æ®µç±»å‹,</span><br><span class="line">	CHARACTER_MAXIMUM_LENGTH <span class="keyword">AS</span> é•¿åº¦,</span><br><span class="line">	IS_NULLABLE <span class="keyword">AS</span> æ˜¯å¦ä¸ºç©º,</span><br><span class="line">	COLUMN_DEFAULT <span class="keyword">AS</span> é»˜è®¤å€¼ </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	INFORMATION_SCHEMA.COLUMNS </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	table_schema <span class="operator">=</span> <span class="string">&#x27;public&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;è¡¨å&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="PG-æ•°æ®åº“çŠ¶æ€ï¼Œå¯åŠ¨ï¼Œåœæ­¢"><a href="#PG-æ•°æ®åº“çŠ¶æ€ï¼Œå¯åŠ¨ï¼Œåœæ­¢" class="headerlink" title="PG æ•°æ®åº“çŠ¶æ€ï¼Œå¯åŠ¨ï¼Œåœæ­¢"></a>PG æ•°æ®åº“çŠ¶æ€ï¼Œå¯åŠ¨ï¼Œåœæ­¢</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pg_ctlcluster 9.5 main status</span><br><span class="line">$ pg_ctlcluster 9.5 main start</span><br><span class="line">$ pg_ctlcluster 9.5 main stop</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxé…ç½®HttpsæŒ‡å—</title>
    <url>/p/17023/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡æ˜¯å¯¹Nginxé…ç½®SSLè¯ä¹¦çš„æ€»ç»“ã€‚<span id="more"></span></p>
<h1 id="ç”³è¯·SSLè¯ä¹¦"><a href="#ç”³è¯·SSLè¯ä¹¦" class="headerlink" title="ç”³è¯·SSLè¯ä¹¦"></a>ç”³è¯·SSLè¯ä¹¦</h1><blockquote>
<p>ä½ å¯ä»¥ä»ä»»ä½•è¯ä¹¦æä¾›å•†å¤„ç”³è¯·è¯ä¹¦ï¼Œè¿™é‡Œä»¥<a href="https://console.aliyun.com/">é˜¿é‡Œäº‘</a>ä¸ºä¾‹ã€‚</p>
</blockquote>
<h2 id="æ‰“å¼€é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°ï¼Œç‚¹å‡»è´­ä¹°è¯ä¹¦"><a href="#æ‰“å¼€é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°ï¼Œç‚¹å‡»è´­ä¹°è¯ä¹¦" class="headerlink" title="æ‰“å¼€é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°ï¼Œç‚¹å‡»è´­ä¹°è¯ä¹¦"></a>æ‰“å¼€é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°ï¼Œç‚¹å‡»è´­ä¹°è¯ä¹¦</h2><p><img data-src="https://i.loli.net/2019/07/24/5d381c3210a9e21599.png"></p>
<h2 id="é€‰æ‹©å…è´¹å‹ä¸€å¹´æœŸçš„è¯ä¹¦ï¼Œç‚¹å‡»ç«‹å³è´­ä¹°"><a href="#é€‰æ‹©å…è´¹å‹ä¸€å¹´æœŸçš„è¯ä¹¦ï¼Œç‚¹å‡»ç«‹å³è´­ä¹°" class="headerlink" title="é€‰æ‹©å…è´¹å‹ä¸€å¹´æœŸçš„è¯ä¹¦ï¼Œç‚¹å‡»ç«‹å³è´­ä¹°"></a>é€‰æ‹©å…è´¹å‹ä¸€å¹´æœŸçš„è¯ä¹¦ï¼Œç‚¹å‡»ç«‹å³è´­ä¹°</h2><div class="note warning"><p>æ³¨æ„ï¼Œ1å¹´åˆ°æœŸååˆ«å¿˜è®°é‡æ–°ç”³è¯·è¯ä¹¦ï¼</p>
</div>

<p><img data-src="https://i.loli.net/2019/07/24/5d381c61c4d0546560.png"></p>
<h2 id="æ”¯ä»˜"><a href="#æ”¯ä»˜" class="headerlink" title="æ”¯ä»˜"></a>æ”¯ä»˜</h2><p>æ”¾å¿ƒå¤§èƒ†çš„æ”¯ä»˜å§ï¼Œä¸ç”¨é’±ï¼</p>
<p><img data-src="https://i.loli.net/2019/07/24/5d381d0b2668081706.png"></p>
<h1 id="éªŒè¯SSLè¯ä¹¦"><a href="#éªŒè¯SSLè¯ä¹¦" class="headerlink" title="éªŒè¯SSLè¯ä¹¦"></a>éªŒè¯SSLè¯ä¹¦</h1><h2 id="è´­ä¹°å®Œæˆä¹‹åï¼Œè¿”å›SSLè¯ä¹¦æ§åˆ¶å°ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšæ‰è´­ä¹°çš„è¯ä¹¦ã€‚æˆ‘ä»¬ç‚¹å‡»ç”³è¯·"><a href="#è´­ä¹°å®Œæˆä¹‹åï¼Œè¿”å›SSLè¯ä¹¦æ§åˆ¶å°ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšæ‰è´­ä¹°çš„è¯ä¹¦ã€‚æˆ‘ä»¬ç‚¹å‡»ç”³è¯·" class="headerlink" title="è´­ä¹°å®Œæˆä¹‹åï¼Œè¿”å›SSLè¯ä¹¦æ§åˆ¶å°ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšæ‰è´­ä¹°çš„è¯ä¹¦ã€‚æˆ‘ä»¬ç‚¹å‡»ç”³è¯·"></a>è´­ä¹°å®Œæˆä¹‹åï¼Œè¿”å›SSLè¯ä¹¦æ§åˆ¶å°ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšæ‰è´­ä¹°çš„è¯ä¹¦ã€‚æˆ‘ä»¬ç‚¹å‡»ç”³è¯·</h2><p><img data-src="https://i.loli.net/2019/07/24/5d381d59ca32b79031.png"></p>
<h2 id="å¡«å†™åŸŸåï¼ˆå¿…é¡»æ˜¯ä½ è‡ªå·±çš„æˆ–è€…æœ‰ç®¡ç†æƒçš„åŸŸåï¼‰å’Œç›¸å…³ä¿¡æ¯ï¼Œå®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚"><a href="#å¡«å†™åŸŸåï¼ˆå¿…é¡»æ˜¯ä½ è‡ªå·±çš„æˆ–è€…æœ‰ç®¡ç†æƒçš„åŸŸåï¼‰å’Œç›¸å…³ä¿¡æ¯ï¼Œå®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚" class="headerlink" title="å¡«å†™åŸŸåï¼ˆå¿…é¡»æ˜¯ä½ è‡ªå·±çš„æˆ–è€…æœ‰ç®¡ç†æƒçš„åŸŸåï¼‰å’Œç›¸å…³ä¿¡æ¯ï¼Œå®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚"></a>å¡«å†™åŸŸåï¼ˆå¿…é¡»æ˜¯ä½ è‡ªå·±çš„æˆ–è€…æœ‰ç®¡ç†æƒçš„åŸŸåï¼‰å’Œç›¸å…³ä¿¡æ¯ï¼Œå®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚</h2><div class="note warning"><p>æ³¨æ„ï¼Œå…è´¹å‹è¯ä¹¦åªæ”¯æŒå•ä¸ªåŸŸåï¼ä¾‹å¦‚ä½ è¦ä¸º<a href="http://www.example.comç”³è¯·è¯ä¹¦,ä½ å¿…é¡»å¡«å†™www.example.com,è€Œä¸èƒ½æ˜¯example.com./">www.example.comç”³è¯·è¯ä¹¦ï¼Œä½ å¿…é¡»å¡«å†™www.example.comï¼Œè€Œä¸èƒ½æ˜¯example.comã€‚</a></p>
</div>

<p><img data-src="https://i.loli.net/2019/07/24/5d381dd8a4b6091205.png"></p>
<h2 id="åœ¨DNSæœåŠ¡å•†å¤„é…ç½®é˜¿é‡Œäº‘æä¾›çš„éªŒè¯ä¿¡æ¯ã€‚"><a href="#åœ¨DNSæœåŠ¡å•†å¤„é…ç½®é˜¿é‡Œäº‘æä¾›çš„éªŒè¯ä¿¡æ¯ã€‚" class="headerlink" title="åœ¨DNSæœåŠ¡å•†å¤„é…ç½®é˜¿é‡Œäº‘æä¾›çš„éªŒè¯ä¿¡æ¯ã€‚"></a>åœ¨DNSæœåŠ¡å•†å¤„é…ç½®é˜¿é‡Œäº‘æä¾›çš„éªŒè¯ä¿¡æ¯ã€‚</h2><p>ä¾‹å¦‚<a href="https://www.dnspod.cn/console/dashboard">DNSPod</a>ï¼Œå¡«å†™ä¸»æœºè®°å½•ï¼Œè®°å½•å€¼å’Œè®°å½•ç±»å‹ï¼Œç„¶åç‚¹å‡»ä¿å­˜ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/24/5d381f607ee9d69062.png"></p>
<div class="note info"><p>è€å¿ƒç­‰å¾…TTLåˆ·æ–°ï¼ˆä¸€èˆ¬ä¸º10åˆ†é’Ÿï¼Œä¹Ÿå¯èƒ½èŠ±ä¸äº†10åˆ†é’Ÿï¼‰ã€‚</p>
</div>

<p>å›åˆ°é˜¿é‡Œäº‘SSLè¯ä¹¦ç”³è¯·é¡µé¢ï¼Œç‚¹å‡»éªŒè¯ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/24/5d381ebc2cb3f86338.png"></p>
<h2 id="ç­¾å‘åŸŸå"><a href="#ç­¾å‘åŸŸå" class="headerlink" title="ç­¾å‘åŸŸå"></a>ç­¾å‘åŸŸå</h2><p>éªŒè¯é€šè¿‡åï¼Œè¯ä¹¦æä¾›å•†å°†ä¼šä¸ºä½ çš„åŸŸåé¢å‘è¯ä¹¦ã€‚åœ¨é˜¿é‡Œäº‘SSLè¯ä¹¦æ§åˆ¶å°çš„å·²ç­¾å‘åˆ—è¡¨ä¸‹å¯ä»¥æ‰¾åˆ°ä½ çš„åŸŸåå¯¹åº”çš„SSLè¯ä¹¦ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/24/5d382048c586e43053.png"></p>
<h2 id="ä¸‹è½½è¯ä¹¦"><a href="#ä¸‹è½½è¯ä¹¦" class="headerlink" title="ä¸‹è½½è¯ä¹¦"></a>ä¸‹è½½è¯ä¹¦</h2><p>ä¸‹è½½Nginxå¯¹åº”çš„SSLè¯ä¹¦<code>xx_nginx.zip</code>ï¼Œå‡†å¤‡é…ç½®Nginxã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/24/5d3821f82182787100.png"></p>
<h1 id="é…ç½®Nginx"><a href="#é…ç½®Nginx" class="headerlink" title="é…ç½®Nginx"></a>é…ç½®Nginx</h1><div class="note info"><p>å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…Nginxï¼Œå¯ä»¥å‚è€ƒ<a href="https://gcdd1993.github.io/p/8505/#Nginx">éƒ¨ç½²Nginx</a></p>
</div>

<h2 id="ä¸Šä¼ è¯ä¹¦"><a href="#ä¸Šä¼ è¯ä¹¦" class="headerlink" title="ä¸Šä¼ è¯ä¹¦"></a>ä¸Šä¼ è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mkdir /etc/nginx/certs</span><br><span class="line">$ sudo <span class="built_in">cd</span> /etc/nginx/certs</span><br><span class="line"><span class="comment">## ä¸Šä¼ ä½ çš„è¯ä¹¦è‡³æ­¤ç›®å½•</span></span><br><span class="line">$ sudo ls -l</span><br><span class="line">drwxr-xr-x 2 root root 4096 Jul 24 17:15 ./</span><br><span class="line">drwxr-xr-x 7 root root 4096 Jul 24 17:15 ../</span><br><span class="line">-rw-r--r-- 1 root root 4053 Jul 24 16:49 xx_nginx.zip</span><br><span class="line">$ sudo unzip xx_nginx.zip</span><br><span class="line">$ sudo ls -l</span><br><span class="line">-rw-r--r-- 1 root root 1679 Jul 24 16:48 xx.key <span class="comment">## ssl cert key</span></span><br><span class="line">-rw-r--r-- 1 root root 3667 Jul 24 16:48 xx.pem <span class="comment">## ssl cert</span></span><br></pre></td></tr></table></figure>

<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œå¯ä»¥å¼€å§‹ä¿®æ”¹æˆ‘ä»¬çš„<code>Nginx</code>é…ç½®æ–‡ä»¶äº†ã€‚</p>
<h2 id="ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶</h2><p>å°†Httpä¿®æ”¹ä¸ºHttpséå¸¸ç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€å¤„å†…å®¹ï¼Œå¹¶æ·»åŠ è‹¥å¹²ä»£ç ã€‚</p>
<ol>
<li>å°†<code>listen 80;</code>ä¿®æ”¹ä¸º<code>listen 443;</code></li>
<li>åœ¨<code>server</code>å—ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </li>
</ol>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">ssl_certificate</span> certs/xx.pem;</span><br><span class="line"><span class="attribute">ssl_certificate_key</span> certs/xx.key;</span><br><span class="line"><span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯Nginx</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo service nginx reload</span><br><span class="line">$ sudo service nginx restart</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œä½¿ç”¨Httpsè®¿é—®ä½ çš„ç½‘ç«™å§ã€‚</p>
<h2 id="Httpå¼ºåˆ¶è½¬å‘Https"><a href="#Httpå¼ºåˆ¶è½¬å‘Https" class="headerlink" title="Httpå¼ºåˆ¶è½¬å‘Https"></a>Httpå¼ºåˆ¶è½¬å‘Https</h2><div class="note warning"><p>æ³¨æ„ï¼Œä»¥ä¸Šä¿®æ”¹å®Œæˆåï¼Œåªèƒ½ä½¿ç”¨Httpsè®¿é—®äº†ï¼Œä½†æ˜¯å¾€å¾€æˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·ä½¿ç”¨Httpè®¿é—®çš„æ—¶å€™å‡ºç°404çš„æƒ…å†µã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å°†80ç«¯å£çš„ç”¨æˆ·è½¬å‘åˆ°443ç«¯å£ï¼Œæ¥è¾¾åˆ°Httpå’ŒHttpså…±å­˜çš„çŠ¶æ€ã€‚</p>
</div>

<p>åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­æ·»åŠ </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> xx.xx.com;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¯Nginx</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis å¸¸ç”¨å‘½ä»¤</title>
    <url>/p/1091/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Redisæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤ï¼ˆcommandï¼‰å¯¹æ•°æ®åº“å’Œå„ç§æ•°æ®ç±»å‹è¿›è¡Œæ“ä½œï¼Œè¿™äº›commandå¯ä»¥åœ¨Linuxç»ˆç«¯ä½¿ç”¨ã€‚åœ¨ç¼–ç¨‹æ—¶ï¼Œæ¯”å¦‚å„ç±»è¯­è¨€åŒ…ï¼Œè¿™äº›å‘½ä»¤éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚ä¸‹é¢å°†Redisæä¾›çš„å‘½ä»¤åšä¸€æ€»ç»“ã€‚</p>
<span id="more"></span> 

<h1 id="é”®å€¼ç›¸å…³å‘½ä»¤"><a href="#é”®å€¼ç›¸å…³å‘½ä»¤" class="headerlink" title="é”®å€¼ç›¸å…³å‘½ä»¤"></a>é”®å€¼ç›¸å…³å‘½ä»¤</h1><h2 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h2><blockquote>
<p>è¿”å›æ»¡è¶³ç»™å®špatternçš„æ‰€æœ‰key</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line"> 1) <span class="string">&quot;mylist4&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;myset7&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;name1&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;myset3&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;myset2&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;mylist2&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;mylist6&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;name&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;myhash&quot;</span></span><br><span class="line">10) <span class="string">&quot;mylist7&quot;</span></span><br><span class="line">11) <span class="string">&quot;key1&quot;</span></span><br><span class="line">12) <span class="string">&quot;mylist5&quot;</span></span><br><span class="line">13) <span class="string">&quot;mylist8&quot;</span></span><br><span class="line">14) <span class="string">&quot;myzset2&quot;</span></span><br><span class="line">15) <span class="string">&quot;myzset3&quot;</span></span><br><span class="line">16) <span class="string">&quot;myzset&quot;</span></span><br><span class="line">17) <span class="string">&quot;myset5&quot;</span></span><br><span class="line">18) <span class="string">&quot;myset4&quot;</span></span><br><span class="line">19) <span class="string">&quot;mylist3&quot;</span></span><br><span class="line">20) <span class="string">&quot;myset&quot;</span></span><br><span class="line">21) <span class="string">&quot;myset6&quot;</span></span><br><span class="line">22) <span class="string">&quot;age&quot;</span></span><br><span class="line">23) <span class="string">&quot;mylist&quot;</span></span><br><span class="line">24) <span class="string">&quot;key2&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç”¨è¡¨è¾¾å¼*ï¼Œä»£è¡¨å–å‡ºæ‰€æœ‰çš„keyã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys mylist*</span><br><span class="line">1) <span class="string">&quot;mylist4&quot;</span></span><br><span class="line">2) <span class="string">&quot;mylist2&quot;</span></span><br><span class="line">3) <span class="string">&quot;mylist6&quot;</span></span><br><span class="line">4) <span class="string">&quot;mylist7&quot;</span></span><br><span class="line">5) <span class="string">&quot;mylist5&quot;</span></span><br><span class="line">6) <span class="string">&quot;mylist8&quot;</span></span><br><span class="line">7) <span class="string">&quot;mylist3&quot;</span></span><br><span class="line">8) <span class="string">&quot;mylist&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç”¨è¡¨è¾¾å¼mylist*ï¼Œä»£è¡¨å–å‡ºæ‰€æœ‰ä»¥mylistå¼€å¤´çš„keyã€‚</p>
<h2 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h2><blockquote>
<p>ç¡®è®¤ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists HongWan</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœæ¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨HongWanè¿™ä¸ªkeyï¼Œä½†æ˜¯ageè¿™ä¸ªkeyæ˜¯å­˜åœ¨çš„ã€‚</p>
<h2 id="del"><a href="#del" class="headerlink" title="del"></a>del</h2><blockquote>
<p>åˆ é™¤ä¸€ä¸ªkey</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; del age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<h2 id="expire"><a href="#expire" class="headerlink" title="expire"></a>expire</h2><blockquote>
<p>è®¾ç½®ä¸€ä¸ªkeyçš„è¿‡æœŸæ—¶é—´(å•ä½:ç§’)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists addr</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br><span class="line">127.0.0.1:6379&gt; expire addr 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; ttl addr</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">127.0.0.1:6379&gt; exists addr</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæœªè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œttlå€¼ä¸º-1ï¼Œè®¾ç½®10sè¿‡æœŸåï¼Œä¸æ–­åœ°ä½¿ç”¨ttlè·å–keyçš„æœ‰æ•ˆæ—¶é•¿ï¼Œå½“å€¼ä¸º-2æ—¶ï¼Œè¡¨ç¤ºå·²è¿‡æœŸå¹¶è¢«åˆ é™¤ã€‚</p>
<h2 id="move"><a href="#move" class="headerlink" title="move"></a>move</h2><blockquote>
<p>å°†å½“å‰æ•°æ®åº“ä¸­çš„keyè½¬ç§»åˆ°å…¶å®ƒæ•°æ®åº“ä¸­</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 30</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;30&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; move age 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; get age</span><br><span class="line"><span class="string">&quot;30&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘å…ˆæ˜¾å¼çš„é€‰æ‹©äº†æ•°æ®åº“0ï¼Œç„¶ååœ¨è¿™ä¸ªåº“ä¸­è®¾ç½®ä¸€ä¸ªkeyï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™ä¸ªkeyä»æ•°æ®åº“0ç§»åˆ°æ•°æ®åº“1ï¼Œä¹‹åæˆ‘ä»¬ç¡®è®¤åœ¨æ•°æ®åº“0ä¸­æ— æ­¤keyäº†, ä½†åœ¨æ•°æ®åº“1ä¸­å­˜åœ¨è¿™ä¸ªkeyï¼Œè¯´æ˜æˆ‘ä»¬è½¬ç§»æˆåŠŸäº† ã€‚</p>
<h2 id="persist"><a href="#persist" class="headerlink" title="persist"></a>persist</h2><blockquote>
<p>ç§»é™¤ç»™å®škeyçš„è¿‡æœŸæ—¶é—´</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; expire age 300</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 296</span><br><span class="line">127.0.0.1:6379[1]&gt; persist age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨çš„å°†æœªåˆ°è¿‡æœŸæ—¶é—´çš„keyï¼ŒæˆåŠŸè®¾ç½®ä¸ºè¿‡æœŸã€‚</p>
<h2 id="randomkey"><a href="#randomkey" class="headerlink" title="randomkey"></a>randomkey</h2><blockquote>
<p>éšæœºè¿”å›keyç©ºé—´çš„ä¸€ä¸ªkey</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; randomkey</span><br><span class="line"><span class="string">&quot;mylist5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; randomkey</span><br><span class="line"><span class="string">&quot;myzset2&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ç»“æœå¯ä»¥çœ‹åˆ°å–keyçš„è§„åˆ™æ˜¯éšæœºçš„ã€‚</p>
<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h2><blockquote>
<p>é‡å‘½åkey</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379[1]&gt; rename age age_new</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age_new&quot;</span></span><br></pre></td></tr></table></figure>

<p>ageæˆåŠŸçš„è¢«æˆ‘ä»¬æ”¹åä¸ºage_newäº†ã€‚</p>
<h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><blockquote>
<p>è¿”å›å€¼çš„ç±»å‹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> name</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> myset</span><br><span class="line"><span class="built_in">set</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> myzset</span><br><span class="line">zset</span><br></pre></td></tr></table></figure>

<h1 id="æœåŠ¡å™¨ç›¸å…³å‘½ä»¤"><a href="#æœåŠ¡å™¨ç›¸å…³å‘½ä»¤" class="headerlink" title="æœåŠ¡å™¨ç›¸å…³å‘½ä»¤"></a>æœåŠ¡å™¨ç›¸å…³å‘½ä»¤</h1><h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><blockquote>
<p>æµ‹è¯•è¿æ¥æ˜¯å¦å­˜æ´»</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">// æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬åœæ­¢redisæœåŠ¡å™¨</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">Could not connect to Redis at 127.0.0.1:6379: Connection refused</span><br><span class="line">// æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯åŠ¨redisæœåŠ¡å™¨</span><br><span class="line">not connected&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>

<h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><blockquote>
<p>åœ¨å‘½ä»¤è¡Œæ‰“å°ä¸€äº›å†…å®¹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">echo</span> HongWan</span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><blockquote>
<p>é€‰æ‹©æ•°æ®åº“ã€‚Redisæ•°æ®åº“ç¼–å·ä»0~15ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°æ®åº“æ¥è¿›è¡Œæ•°æ®çš„å­˜å–</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; select 16</span><br><span class="line">(error) ERR invalid DB index</span><br></pre></td></tr></table></figure>

<h2 id="quit"><a href="#quit" class="headerlink" title="quit"></a>quit</h2><blockquote>
<p>é€€å‡ºè¿æ¥</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; quit</span><br><span class="line">root@test01:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<h2 id="dbsize"><a href="#dbsize" class="headerlink" title="dbsize"></a>dbsize</h2><blockquote>
<p>è¿”å›å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›®</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 23</span><br></pre></td></tr></table></figure>

<p>ç»“æœè¯´æ˜æ­¤åº“ä¸­æœ‰23ä¸ªkeyã€‚</p>
<h2 id="info"><a href="#info" class="headerlink" title="info"></a>info</h2><blockquote>
<p>è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:3.0.6</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:28b6715d3583bf8e</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 4.4.0-148-generic x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">gcc_version:5.4.0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æ­¤ç»“æœç”¨äºè¯´æ˜æœåŠ¡å™¨çš„åŸºç¡€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€å¯åŠ¨æ—¶é—´ç­‰ã€‚</p>
<h2 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h2><blockquote>
<p>å®æ—¶è½¬å‚¨æ”¶åˆ°çš„è¯·æ±‚</p>
</blockquote>
<p>å…ˆåœ¨ç»ˆç«¯1è¾“å…¥monitorå‘½ä»¤ï¼Œå°†ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; monitor</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>æ–°å»ºä¸€ä¸ªç»ˆç«¯ï¼Œè¾“å…¥ä¸€äº›rediså‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line"> 1) <span class="string">&quot;myset3&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;myset2&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;mylist7&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;mylist4&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;key1&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;myset7&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;name1&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;mylist6&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;myzset&quot;</span></span><br><span class="line">10) <span class="string">&quot;mylist2&quot;</span></span><br><span class="line">11) <span class="string">&quot;myset&quot;</span></span><br><span class="line">12) <span class="string">&quot;mylist&quot;</span></span><br><span class="line">13) <span class="string">&quot;myhash&quot;</span></span><br><span class="line">14) <span class="string">&quot;myset4&quot;</span></span><br><span class="line">15) <span class="string">&quot;name&quot;</span></span><br><span class="line">16) <span class="string">&quot;myset5&quot;</span></span><br><span class="line">17) <span class="string">&quot;myzset3&quot;</span></span><br><span class="line">18) <span class="string">&quot;mylist3&quot;</span></span><br><span class="line">19) <span class="string">&quot;mylist5&quot;</span></span><br><span class="line">20) <span class="string">&quot;myzset2&quot;</span></span><br><span class="line">21) <span class="string">&quot;mylist8&quot;</span></span><br><span class="line">22) <span class="string">&quot;key2&quot;</span></span><br><span class="line">23) <span class="string">&quot;myset6&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get addr</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p>å›åˆ°ç»ˆç«¯1ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ‰“å°å‡ºäº†åˆšæ‰æˆ‘ä»¬åœ¨ç»ˆç«¯2ä¸­æ•²å…¥çš„rediså‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; monitor</span><br><span class="line">OK</span><br><span class="line">1558844434.297954 [0 127.0.0.1:34926] <span class="string">&quot;keys&quot;</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">1558844444.673315 [0 127.0.0.1:34926] <span class="string">&quot;get&quot;</span> <span class="string">&quot;addr&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="config-get"><a href="#config-get" class="headerlink" title="config get"></a>config get</h2><blockquote>
<p>è·å–æœåŠ¡å™¨é…ç½®ä¿¡æ¯</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/var/lib/redis&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­æˆ‘ä»¬è·å–äº†dirè¿™ä¸ªå‚æ•°é…ç½®çš„å€¼ï¼Œå¦‚æœæƒ³è·å–å…¨éƒ¨å‚æ•°æ®çš„é…ç½®å€¼ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€<br>æ‰§è¡Œâ€config get *â€å³å¯å°†å…¨éƒ¨çš„å€¼éƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<h2 id="flushdb"><a href="#flushdb" class="headerlink" title="flushdb"></a>flushdb</h2><blockquote>
<p>åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 23</span><br><span class="line">127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†0å·æ•°æ®åº“ä¸­çš„keyéƒ½æ¸…é™¤äº†ã€‚</p>
<h2 id="flushall"><a href="#flushall" class="headerlink" title="flushall"></a>flushall</h2><blockquote>
<p>åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; select 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å…ˆæŸ¥çœ‹äº†ä¸€ä¸ª1å·æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªkeyï¼Œç„¶åæˆ‘åˆ‡æ¢åˆ°0å·åº“æ‰§è¡Œflushallå‘½ä»¤ï¼Œç»“æœ1å·åº“ä¸­çš„keyä¹Ÿè¢«æ¸…é™¤äº†ï¼Œè¯´æ˜æ­¤å‘½ä»¤å·¥ä½œæ­£å¸¸ã€‚</p>
<h1 id="æ•°æ®ç›¸å…³å‘½ä»¤"><a href="#æ•°æ®ç›¸å…³å‘½ä»¤" class="headerlink" title="æ•°æ®ç›¸å…³å‘½ä»¤"></a>æ•°æ®ç›¸å…³å‘½ä»¤</h1><p>ğŸ‘‰<a href="https://gcdd1993.github.io/Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E6%93%8D%E4%BD%9C/">Redis-æ•°æ®ç±»å‹åŠæ“ä½œ</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>NoSql</tag>
      </tags>
  </entry>
  <entry>
    <title>Scalaå­¦ä¹ ç¬”è®°</title>
    <url>/p/37757/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>Scalaæ˜¯ä¸€é—¨ä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€é—¨çº¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä¸”æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ã€‚</p>
<p>Scalaè¿è¡ŒäºJvmï¼Œæ‰€æœ‰Scalaçš„ä»£ç ï¼Œéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œç„¶åäº¤ç”±Javaè™šæ‹Ÿæœºæ¥è¿è¡Œã€‚<strong>Scalaå’ŒJavaæ˜¯å¯ä»¥æ— ç¼äº’æ“ä½œçš„ã€‚Scalaå¯ä»¥ä»»æ„è°ƒç”¨Javaçš„ä»£ç </strong>ã€‚</p>
<span id="more"></span>

<h1 id="å®‰è£…Scala"><a href="#å®‰è£…Scala" class="headerlink" title="å®‰è£…Scala"></a>å®‰è£…Scala</h1><ol>
<li><p>ä»Scalaå®˜æ–¹ç½‘ç«™ä¸‹è½½ï¼Œ<a href="http://www.scala-lang.org/download/%EF%BC%8Cwindows%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%89%E8%A3%85%E5%8C%85%E6%98%AF%60scala-2.11.7.msi%60%E3%80%82">http://www.scala-lang.org/download/ï¼Œwindowsç‰ˆæœ¬çš„å®‰è£…åŒ…æ˜¯`scala-2.11.7.msi`ã€‚</a></p>
</li>
<li><p>ä½¿ç”¨ä¸‹è½½ä¸‹æ¥çš„å®‰è£…åŒ…å®‰è£…Scalaã€‚</p>
</li>
<li><p>åœ¨PATHç¯å¢ƒå˜é‡ä¸­ï¼Œé…ç½®$SCALA_HOME/binç›®å½•ã€‚</p>
</li>
</ol>
<p><img data-src="https://i.loli.net/2020/02/02/Zmrv5iPFe2N3hwu.png"></p>
<ol start="2">
<li>åœ¨windowså‘½ä»¤è¡Œå†…å³å¯ç›´æ¥é”®å…¥scalaï¼Œæ‰“å¼€scalaå‘½ä»¤è¡Œï¼Œè¿›è¡Œscalaç¼–ç¨‹ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ scala</span><br><span class="line">Welcome to Scala 2.11.12 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_231).</span><br><span class="line">Type <span class="keyword">in</span> expressions <span class="keyword">for</span> evaluation. Or try :<span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">scala&gt;</span><br></pre></td></tr></table></figure>

<h1 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h1><h2 id="Scalaè§£é‡Šå™¨çš„ä½¿ç”¨"><a href="#Scalaè§£é‡Šå™¨çš„ä½¿ç”¨" class="headerlink" title="Scalaè§£é‡Šå™¨çš„ä½¿ç”¨"></a>Scalaè§£é‡Šå™¨çš„ä½¿ç”¨</h2><h3 id="REPL"><a href="#REPL" class="headerlink" title="REPL"></a>REPL</h3><blockquote>
<p>scalaè§£é‡Šå™¨ä¹Ÿè¢«ç§°ä¸ºREPLï¼Œä¼šå¿«é€Ÿç¼–è¯‘scalaä»£ç ä¸ºå­—èŠ‚ç ï¼Œç„¶åäº¤ç»™JVMæ¥æ‰§è¡Œã€‚</p>
</blockquote>
<p>Readï¼ˆå–å€¼ï¼‰-&gt; Evaluationï¼ˆæ±‚å€¼ï¼‰-&gt; Printï¼ˆæ‰“å°ï¼‰-&gt; Loopï¼ˆå¾ªç¯ï¼‰ã€‚</p>
<h3 id="è®¡ç®—è¡¨è¾¾å¼"><a href="#è®¡ç®—è¡¨è¾¾å¼" class="headerlink" title="è®¡ç®—è¡¨è¾¾å¼"></a>è®¡ç®—è¡¨è¾¾å¼</h3><blockquote>
<p>åœ¨scala&gt;å‘½ä»¤è¡Œå†…ï¼Œé”®å…¥scalaä»£ç ï¼Œè§£é‡Šå™¨ä¼šç›´æ¥è¿”å›ç»“æœç»™ä½ ã€‚å¦‚æœä½ æ²¡æœ‰æŒ‡å®šå˜é‡æ¥å­˜æ”¾è¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆå€¼é»˜è®¤çš„åç§°ä¸ºresï¼Œè€Œä¸”ä¼šæ˜¾ç¤ºç»“æœçš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚Intã€Doubleã€Stringç­‰ç­‰ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œè¾“å…¥1 + 1ï¼Œä¼šçœ‹åˆ°res0: Int = 2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; 1 + 1</span><br><span class="line">res0: Int = 2</span><br></pre></td></tr></table></figure>

<h3 id="å†…ç½®å˜é‡"><a href="#å†…ç½®å˜é‡" class="headerlink" title="å†…ç½®å˜é‡"></a>å†…ç½®å˜é‡</h3><blockquote>
<p>åœ¨åé¢å¯ä»¥ç»§ç»­ä½¿ç”¨resè¿™ä¸ªå˜é‡ï¼Œä»¥åŠå®ƒå­˜æ”¾çš„å€¼ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œ2.0 * res0ï¼Œè¿”å›res1: Double = 4.0</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; 2.0 * res0</span><br><span class="line">res1: Double = 4.0</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œâ€Hi, â€œ + res0ï¼Œè¿”å›res2: String = Hi, 2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; <span class="string">&quot;Hi, &quot;</span> + res0</span><br><span class="line">res2: String = Hi, 2</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªåŠ¨è¡¥å…¨"><a href="#è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨"></a>è‡ªåŠ¨è¡¥å…¨</h3><blockquote>
<p>åœ¨scala&gt;å‘½ä»¤è¡Œå†…ï¼Œå¯ä»¥ä½¿ç”¨Tabé”®è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œè¾“å…¥res2.toï¼Œæ•²å‡»Tabé”®ï¼Œè§£é‡Šå™¨ä¼šæ˜¾ç¤ºå‡ºä»¥ä¸‹é€‰é¡¹ï¼ŒtoCharArrayï¼ŒtoLowerCaseï¼ŒtoStringï¼ŒtoUpperCaseã€‚å› ä¸ºæ­¤æ—¶æ— æ³•åˆ¤å®šä½ éœ€è¦è¡¥å…¨çš„æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¼šæä¾›ç»™ä½ æ‰€æœ‰çš„é€‰é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; res2.to</span><br><span class="line">to          toCharArray    toIterable    toMap ...</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œè¾“å…¥res2.toUï¼Œæ•²å‡»Tabé”®ï¼Œç›´æ¥ä¼šç»™ä½ è¡¥å…¨ä¸ºres2.toUpperCaseã€‚</p>
<h2 id="å£°æ˜å˜é‡"><a href="#å£°æ˜å˜é‡" class="headerlink" title="å£°æ˜å˜é‡"></a>å£°æ˜å˜é‡</h2><h3 id="å£°æ˜valå˜é‡"><a href="#å£°æ˜valå˜é‡" class="headerlink" title="å£°æ˜valå˜é‡"></a>å£°æ˜valå˜é‡</h3><blockquote>
<p>å¯ä»¥å£°æ˜valå˜é‡æ¥å­˜æ”¾è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœã€‚</p>
</blockquote>
<ul>
<li>ä¾‹å¦‚ï¼Œval result = 1 + 1</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; val result = 1 + 1</span><br><span class="line">result: Int = 2</span><br></pre></td></tr></table></figure>

<ul>
<li>åç»­è¿™äº›å¸¸é‡æ˜¯å¯ä»¥ç»§ç»­ä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œ2 * result</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; 2 * result</span><br><span class="line">res6: Int = 4</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½†æ˜¯å¸¸é‡å£°æ˜åï¼Œæ˜¯æ— æ³•æ”¹å˜å®ƒçš„å€¼çš„ï¼Œä¾‹å¦‚ï¼Œresult = 1ï¼Œä¼šè¿”å›error: reassignment to valçš„é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scala&gt; result = 1</span><br><span class="line">&lt;console&gt;:12: error: reassignment to val</span><br><span class="line">       result = 1</span><br><span class="line">              ^</span><br></pre></td></tr></table></figure>

<h3 id="å£°æ˜varå˜é‡"><a href="#å£°æ˜varå˜é‡" class="headerlink" title="å£°æ˜varå˜é‡"></a>å£°æ˜varå˜é‡</h3><blockquote>
<p>å¦‚æœè¦å£°æ˜å€¼å¯ä»¥æ”¹å˜çš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨varå˜é‡ã€‚</p>
</blockquote>
<ul>
<li><p>ä¾‹å¦‚ï¼Œ<code>val myresult = 1ï¼Œmyresult = 2</code></p>
</li>
<li><p>ä½†æ˜¯åœ¨Scalaç¨‹åºä¸­ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨valï¼Œä¹Ÿå°±æ˜¯å¸¸é‡ï¼Œ<strong>å› æ­¤æ¯”å¦‚ç±»ä¼¼äºsparkçš„å¤§å‹å¤æ‚ç³»ç»Ÿä¸­ï¼Œéœ€è¦å¤§é‡çš„ç½‘ç»œä¼ è¾“æ•°æ®ï¼Œå¦‚æœä½¿ç”¨varï¼Œå¯èƒ½ä¼šæ‹…å¿ƒå€¼è¢«é”™è¯¯çš„æ›´æ”¹ã€‚</strong></p>
</li>
<li><p>åœ¨Javaçš„å¤§å‹å¤æ‚ç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘ä¸­ï¼Œä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä¼ é€’ç»™å…¶ä»–æ¨¡å— / ç»„ä»¶ / æœåŠ¡çš„å¯¹è±¡ï¼Œè®¾è®¡æˆä¸å¯å˜ç±»ï¼ˆImmutable Classï¼‰ã€‚åœ¨é‡Œé¢ä¹Ÿä¼šä½¿ç”¨Javaçš„å¸¸é‡å®šä¹‰ï¼Œæ¯”å¦‚finalï¼Œé˜»æ­¢å˜é‡çš„å€¼è¢«æ”¹å˜ã€‚<strong>ä»è€Œæé«˜ç³»ç»Ÿçš„å¥å£®æ€§ï¼ˆrobustï¼Œé²æ£’æ€§ï¼‰ï¼Œå’Œå®‰å…¨æ€§</strong>ã€‚</p>
</li>
</ul>
<h2 id="æŒ‡å®šç±»å‹"><a href="#æŒ‡å®šç±»å‹" class="headerlink" title="æŒ‡å®šç±»å‹"></a>æŒ‡å®šç±»å‹</h2><blockquote>
<p>æ— è®ºå£°æ˜valå˜é‡ï¼Œè¿˜æ˜¯å£°æ˜varå˜é‡ï¼Œéƒ½å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå…¶ç±»å‹ï¼Œ<strong>å¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒScalaä¼šè‡ªåŠ¨æ ¹æ®å€¼ï¼Œè¿›è¡Œç±»å‹çš„æ¨æ–­</strong>ã€‚</p>
</blockquote>
<ul>
<li><p>ä¾‹å¦‚ï¼Œ<code>val name: String = null</code></p>
</li>
<li><p>ä¾‹å¦‚ï¼Œ<code>val name: Any = &quot;leo&quot;</code></p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Scala</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Cloud feignä½¿ç”¨okhttp3</title>
    <url>/p/7382/</url>
    <content><![CDATA[<p>spring cloud feignä½¿ç”¨okhttp3<span id="more"></span></p>
<h1 id="æŒ‡å—"><a href="#æŒ‡å—" class="headerlink" title="æŒ‡å—"></a>æŒ‡å—</h1><p>maven</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">feign.httpclient.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">feign.okhttp.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(Feign.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(FeignAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignOkHttpConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OkHttpLoggingInterceptor okHttpLoggingInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> okhttp3.<span class="function">OkHttpClient <span class="title">okHttpClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> okhttp3.OkHttpClient.Builder()</span><br><span class="line">            .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS) </span><br><span class="line">            .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS) </span><br><span class="line">            .writeTimeout(<span class="number">120</span>, TimeUnit.SECONDS) </span><br><span class="line">            .connectionPool(<span class="keyword">new</span> ConnectionPool())</span><br><span class="line">            <span class="comment">// .addInterceptor();</span></span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><p>ä¸éœ€è¦é¢å¤–ç¼–å†™FeignOkHttpConfigï¼Œfeignæœ¬èº«å·²ç»å­˜åœ¨FeignOkHttpAutoConfigurationäº†ï¼Œä¸éœ€è¦é¢å¤–é…ç½®ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring-Cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Boot Starter å¼€å‘æŒ‡å—</title>
    <url>/p/20136/</url>
    <content><![CDATA[<h1 id="Spring-Boot-Starteræ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Spring-Boot-Starteræ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Spring Boot Starteræ˜¯ä»€ä¹ˆï¼Ÿ"></a>Spring Boot Starteræ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ä¾èµ–ç®¡ç†æ˜¯ä»»ä½•å¤æ‚é¡¹ç›®çš„å…³é”®éƒ¨åˆ†ã€‚ä»¥æ‰‹åŠ¨çš„æ–¹å¼æ¥å®ç°ä¾èµ–ç®¡ç†ä¸å¤ªç°å®ï¼Œä½ å¾—èŠ±æ›´å¤šæ—¶é—´ï¼ŒåŒæ—¶ä½ åœ¨é¡¹ç›®çš„å…¶ä»–é‡è¦æ–¹é¢èƒ½ä»˜å‡ºçš„æ—¶é—´å°±ä¼šå˜å¾—è¶Šå°‘ã€‚</p>
<p>Spring Boot starter å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè¯ç”Ÿçš„ã€‚Starter POM æ˜¯ä¸€ç»„æ–¹ä¾¿çš„ä¾èµ–æè¿°ç¬¦ï¼Œæ‚¨å¯ä»¥å°†å…¶åŒ…å«åœ¨åº”ç”¨ç¨‹åºä¸­ã€‚æ‚¨å¯ä»¥è·å¾—æ‰€éœ€çš„æ‰€æœ‰ Spring å’Œç›¸å…³æŠ€æœ¯çš„ä¸€ç«™å¼æœåŠ¡ï¼Œæ— éœ€é€šè¿‡ç¤ºä¾‹ä»£ç æœç´¢å’Œå¤åˆ¶ç²˜è´´ä¾èµ–ã€‚</p>
<span id="more"></span>

<h1 id="æ­å¼€Spring-Bootè‡ªåŠ¨è£…é…çš„ç¥ç§˜é¢çº±"><a href="#æ­å¼€Spring-Bootè‡ªåŠ¨è£…é…çš„ç¥ç§˜é¢çº±" class="headerlink" title="æ­å¼€Spring Bootè‡ªåŠ¨è£…é…çš„ç¥ç§˜é¢çº±"></a>æ­å¼€Spring Bootè‡ªåŠ¨è£…é…çš„ç¥ç§˜é¢çº±</h1><h2 id="Auto-Configuration-ç±»"><a href="#Auto-Configuration-ç±»" class="headerlink" title="Auto Configuration ç±»"></a>Auto Configuration ç±»</h2><p>å½“Spring Bootå¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾åä¸º<code>spring.factories</code>çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½äº<code>META-INF</code>ç›®å½•ä¸­ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>spring-boot-autoconfigure</code>é¡¹ç›®ä¸­è¿™ä¸ªæ–‡ä»¶çš„ç‰‡æ®µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>æ­¤æ–‡ä»¶å®šä¹‰äº†ä¸€äº›Spring Bootå°†å°è¯•è¿è¡Œçš„è‡ªåŠ¨è£…é…ç±»ã€‚ä¾‹å¦‚ä»¥ä¸Šçš„ä»£ç ç‰‡æ®µï¼ŒSpring Bootå°†å°è¯•è¿è¡ŒRabbitMQï¼ŒCassandraï¼ŒMongoDBå’ŒHibernateçš„æ‰€æœ‰é…ç½®ç±»ã€‚è¿™äº›ç±»æ˜¯å¦å®é™…è¿è¡Œå°†å–å†³äºç±»è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨ä¾èµ–ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç±»è·¯å¾„ä¸­æ‰¾åˆ°<code>MongoDB</code>çš„ç±»ï¼Œåˆ™å°†è¿è¡Œ<code>MongoAutoConfiguration</code>ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰ä¸mongoç›¸å…³çš„beanã€‚æ­¤æ¡ä»¶åˆå§‹åŒ–ç”±<code>@ConditionalOnClass</code>æ³¨é‡Šå¯ç”¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>MongoAutoConfiguration</code>ç±»çš„ä»£ç ç‰‡æ®µï¼Œçœ‹çœ‹å®ƒçš„ç”¨æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(MongoClient.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MongoProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(type = &quot;org.springframework.data.mongodb.MongoDbFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">// configuration code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå­˜åœ¨<code>MongoClient</code>ç±»ï¼Œå°†è¿è¡Œè¯¥è‡ªåŠ¨è£…é…ç±»åˆå§‹åŒ–<code>MongoClient</code>ç›¸å…³beanã€‚</p>
<h2 id="åœ¨application-propertiesè‡ªå®šä¹‰é…ç½®"><a href="#åœ¨application-propertiesè‡ªå®šä¹‰é…ç½®" class="headerlink" title="åœ¨application.propertiesè‡ªå®šä¹‰é…ç½®"></a>åœ¨<code>application.properties</code>è‡ªå®šä¹‰é…ç½®</h2><p>Spring Bootä½¿ç”¨ä¸€äº›é¢„å…ˆé…ç½®çš„é»˜è®¤å€¼åˆå§‹åŒ–beanã€‚è¦è¦†ç›–è¿™äº›é»˜è®¤å€¼ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨<code>application.properties</code>æ–‡ä»¶ä¸­ä½¿ç”¨æŸä¸ªç‰¹å®šåç§°å£°æ˜å®ƒä»¬ã€‚Spring Bootå®¹å™¨ä¼šè‡ªåŠ¨è·å–è¿™äº›å±æ€§ã€‚<br>åœ¨<code>MongoAutoConfiguration</code>çš„ä»£ç ç‰‡æ®µä¸­ï¼Œ<code>@EnableConfigurationProperties(MongoProperties.class)</code>è¡¨ç¤ºï¼Œä½¿ç”¨<code>MongoProperties</code>ç±»æ¥å£°æ˜è‡ªå®šä¹‰å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoProperties</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// other fields with standard getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)</code>å®šä¹‰äº†é…ç½®å‰ç¼€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>application.properties</code>è¿™æ ·æ¥ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.data.mongodb.host = localhost</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>localhost</code>å°†è¢«æ³¨å…¥åˆ°<code>host</code>å±æ€§ä¸­</p>
<h1 id="è‡ªå®šä¹‰Spring-Boot-Starter"><a href="#è‡ªå®šä¹‰Spring-Boot-Starter" class="headerlink" title="è‡ªå®šä¹‰Spring Boot Starter"></a>è‡ªå®šä¹‰<code>Spring Boot Starter</code></h1><p>Spring Bootè‡ªåŠ¨è£…é…è™½ç„¶ç¥å¥‡ï¼Œä½†æ˜¯ç¼–å†™èµ·æ¥å´å¼‚å¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰éƒ¨å°±ç­çš„æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªæµç¨‹ï¼š</p>
<ol>
<li>ç¼–å†™å±æ€§å®¹å™¨<code>*Properties</code>ï¼Œå¹¶ç¼–å†™å¯¹åº”çš„<code>*AutoConfiguration</code>è‡ªåŠ¨è£…é…ç±»</li>
<li>ä¸€ä¸ªpomæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å¼•å…¥åº“å’Œè‡ªåŠ¨è£…é…ç±»çš„ä¾èµ–é¡¹</li>
</ol>
<h2 id="æ¦‚å¿µè§£æ"><a href="#æ¦‚å¿µè§£æ" class="headerlink" title="æ¦‚å¿µè§£æ"></a>æ¦‚å¿µè§£æ</h2><h3 id="ç”¨äº-Propertiesçš„æ³¨è§£"><a href="#ç”¨äº-Propertiesçš„æ³¨è§£" class="headerlink" title="ç”¨äº*Propertiesçš„æ³¨è§£"></a>ç”¨äº<code>*Properties</code>çš„æ³¨è§£</h3><ul>
<li><code>@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)</code> ï¼šç”¨äºæŒ‡å®šé…ç½®å‰ç¼€</li>
</ul>
<h3 id="ç”¨äº-AutoConfigurationçš„æ³¨è§£"><a href="#ç”¨äº-AutoConfigurationçš„æ³¨è§£" class="headerlink" title="ç”¨äº*AutoConfigurationçš„æ³¨è§£"></a>ç”¨äº<code>*AutoConfiguration</code>çš„æ³¨è§£</h3><ul>
<li>@Configurationï¼šæ ‡è®°ä¸ºé…ç½®ç±»ï¼Œç”±Springå®¹å™¨åˆå§‹åŒ–å¹¶æ¥ç®¡</li>
<li>@EnableConfigurationPropertiesï¼šæ³¨å…¥é…ç½®å±æ€§å®¹å™¨</li>
<li>@ConditionalOnBeanï¼šæ¡ä»¶è£…é…</li>
</ul>
<p>é‡ç‚¹è¯´ä¸‹æ¡ä»¶è£…é…ï¼Œä»¥<code>@ConditionalOnBean</code>ä¸ºä¾‹ï¼Œå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeançš„æ—¶å€™è£…é…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional(OnBeanCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ConditionalOnBean&#123;</span><br><span class="line">    <span class="comment">//properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Conditional(OnBeanCondition.class)</code>æŒ‡å®šäº†å®ç°æ¡ä»¶è£…é…çš„é€»è¾‘ä»£ç </p>
<p><code>OnBeanCondition</code>å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnBeanCondition</span> <span class="keyword">extends</span> <span class="title">SpringBootCondition</span> <span class="keyword">implements</span> <span class="title">ConfigurationCondition</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥ç»§æ‰¿<code>SpringBootCondition</code>å¹¶å®ç°<code>ConfigurationCondition</code>æ¥è‡ªå®šä¹‰æ¡ä»¶è£…é…æ³¨è§£ã€‚</p>
<p>æ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªæ¡ä»¶è£…é…æ³¨è§£ï¼š</p>
<ul>
<li>@ConditionalOnBeanï¼šå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanæ—¶è£…é…</li>
<li>@ConditionalOnClassï¼šå½“å­˜åœ¨æŒ‡å®šClassæ—¶è£…é…</li>
<li>@ConditionalOnMissingBeanï¼šå½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanæ—¶è£…é…</li>
<li>@ConditionalOnMissingClassï¼šå½“ä¸å­˜åœ¨æŒ‡å®šClassæ—¶è£…é…</li>
</ul>
<h2 id="å°è¯•ç‰›åˆ€"><a href="#å°è¯•ç‰›åˆ€" class="headerlink" title="å°è¯•ç‰›åˆ€"></a>å°è¯•ç‰›åˆ€</h2><blockquote>
<p>æˆ‘ä»¬å°†è‡ªåŠ¨é…ç½®æ¨¡å—ç§°ä¸º<code>greeter-spring-boot-autoconfigure</code>ã€‚è¯¥æ¨¡å—å°†æœ‰ä¸¤ä¸ªä¸»è¦ç±»ï¼Œå³<code>GreeterPropertie</code>sï¼Œå®ƒå°†é€šè¿‡<code>application.properties</code>æ–‡ä»¶å’Œ<code>GreeterAutoConfiguartion</code>è®¾ç½®è‡ªå®šä¹‰å±æ€§ï¼Œå¹¶ä¸ºgreeteråº“åˆ›å»ºbeanã€‚</p>
</blockquote>
<p>å‡†å¤‡ï¼Œåˆ›å»ºå‡æƒ³çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥ç¨‹ï¼šGreet</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GreetingConfig greetingConfig;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Greeter</span><span class="params">(GreetingConfig greetingConfig)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.greetingConfig = greetingConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">greet</span><span class="params">(LocalDateTime localDateTime)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String name = greetingConfig.getProperty(USER_NAME);</span><br><span class="line">        <span class="keyword">int</span> hourOfDay = localDateTime.getHour();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hourOfDay &gt;= <span class="number">5</span> &amp;&amp; hourOfDay &lt; <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s, %s&quot;</span>, name, greetingConfig.get(MORNING_MESSAGE));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hourOfDay &gt;= <span class="number">12</span> &amp;&amp; hourOfDay &lt; <span class="number">17</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s, %s&quot;</span>, name, greetingConfig.get(AFTERNOON_MESSAGE));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hourOfDay &gt;= <span class="number">17</span> &amp;&amp; hourOfDay &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s, %s&quot;</span>, name, greetingConfig.get(EVENING_MESSAGE));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s, %s&quot;</span>, name, greetingConfig.get(NIGHT_MESSAGE));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">greet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> greet(LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreeterConfigParams</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER_NAME = <span class="string">&quot;user.name&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MORNING_MESSAGE = <span class="string">&quot;morning.message&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AFTERNOON_MESSAGE = <span class="string">&quot;afternoon.message&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EVENING_MESSAGE = <span class="string">&quot;evening.message&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NIGHT_MESSAGE = <span class="string">&quot;night.message&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingConfig</span> <span class="keyword">extends</span> <span class="title">Properties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5662570853707247891L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™Propertieså’ŒAutoConfigurationï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;gcdd1993.greeter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreeterProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String morningMessage;</span><br><span class="line">    <span class="keyword">private</span> String afternoonMessage;</span><br><span class="line">    <span class="keyword">private</span> String eveningMessage;</span><br><span class="line">    <span class="keyword">private</span> String nightMessage;</span><br><span class="line">    <span class="comment">// getter and setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(Greeter.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(GreeterProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreeterAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GreeterProperties greeterProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GreetingConfig <span class="title">greeterConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String userName = greeterProperties.getUserName() == <span class="keyword">null</span></span><br><span class="line">                ? System.getProperty(<span class="string">&quot;user.name&quot;</span>)</span><br><span class="line">                : greeterProperties.getUserName();</span><br><span class="line">        GreetingConfig greetingConfig = <span class="keyword">new</span> GreetingConfig();</span><br><span class="line">        greetingConfig.put(USER_NAME, userName);</span><br><span class="line">        <span class="keyword">if</span> (greeterProperties.getMorningMessage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            greetingConfig.put(MORNING_MESSAGE, greeterProperties.getMorningMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (greeterProperties.getAfternoonMessage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            greetingConfig.put(AFTERNOON_MESSAGE, greeterProperties.getAfternoonMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (greeterProperties.getEveningMessage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            greetingConfig.put(EVENING_MESSAGE, greeterProperties.getEveningMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (greeterProperties.getNightMessage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            greetingConfig.put(NIGHT_MESSAGE, greeterProperties.getNightMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> greetingConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Greeter <span class="title">greeter</span><span class="params">(GreetingConfig greetingConfig)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Greeter(greetingConfig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>src/main/resources/META-INF</code>ç›®å½•ä¸‹åˆ›å»º<code>spring.factories</code>æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.gcdd.autoconfigure.GreeterAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºé…ç½®æ–‡ä»¶<code>application.properties</code>ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcdd1993.greeter.userName=gcdd1993</span><br><span class="line">gcdd1993.greeter.eveningMessage=good evening</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä½¿ç”¨Greeter bean</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreeterSampleApplication</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Greeter greeter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GreeterSampleApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String message = greeter.greet();</span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œmainæ–¹æ³•ï¼Œå°†ä¼šè¾“å‡ºä¸€è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hello gcdd1993, good evening</span><br></pre></td></tr></table></figure>

<h1 id="ä¸ºé…ç½®ç±»æ·»åŠ æç¤º"><a href="#ä¸ºé…ç½®ç±»æ·»åŠ æç¤º" class="headerlink" title="ä¸ºé…ç½®ç±»æ·»åŠ æç¤º"></a>ä¸ºé…ç½®ç±»æ·»åŠ æç¤º</h1><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Ideaä¸­ï¼Œç¼–å†™é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œæœ‰æ™ºèƒ½æç¤º</p>
<p><img data-src="https://i.loli.net/2019/08/06/MD7ZeTC6HVtYy3R.png"></p>
<p>å…¶å®è¿™ä¸æ˜¯Ideaæçš„é¬¼ï¼Œæ˜¯ç”±<code>META-INF/spring-configuration-metadata.json</code>æ–‡ä»¶é…ç½®å¥½çš„ï¼ŒIdeaåªæ˜¯è´Ÿè´£è§£æè¿™ä¸ªæ–‡ä»¶ï¼Œæä¾›æˆ‘ä»¬æ™ºèƒ½åŒ–çš„æç¤ºä¿¡æ¯ã€‚</p>
<p>æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„å¾ˆç®€å•ï¼Œæ·»åŠ ä¾èµ–<code>org.springframework.boot:spring-boot-configuration-processor</code>å°±è¡Œäº†ã€‚</p>
<p>Maven</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Gradle</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">compile</span> <span class="keyword">group</span>: <span class="string">&#x27;org.springframework.boot&#x27;</span>, name: <span class="string">&#x27;spring-boot-configuration-processor&#x27;</span>, version: <span class="string">&#x27;2.1.6.RELEASE&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå°±æ˜¯<code>Spring Boot Starter</code>çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœè¦å‘å¸ƒåˆ°mavenä»“åº“ï¼Œä¾›åˆ«äººä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>mvn install</code>æ‰“åŒ…å‘å¸ƒè‡³mavenä»“åº“ã€‚</p>
<p>ğŸ‘‰ <a href="https://github.com/gcdd1993/Spring-Boot-Starter-Sample">æœ¬æ–‡ä»£ç åœ°å€</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Eventäº‹ä»¶é©±åŠ¨</title>
    <url>/p/18285/</url>
    <content><![CDATA[<p>Springäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œç®€å•æ¥è¯´ç±»ä¼¼äºMessage-Queueæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„Pub/Subå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œä¹Ÿç±»ä¼¼äºJavaè®¾è®¡æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<span id="more"></span>

<h1 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h1><p>Springçš„äº‹ä»¶æ¥å£ä½äº<code>org.springframework.context.ApplicationEvent</code>ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationEvent</span> <span class="keyword">extends</span> <span class="title">EventObject</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7099057708183571937L</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> timestamp;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ApplicationEvent</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(source);</span><br><span class="line">		<span class="keyword">this</span>.timestamp = System.currentTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> <span class="title">getTimestamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.timestamp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§æ‰¿äº†Javaçš„äº‹ä»¶å¯¹è±¡<code>EventObject</code>ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>getSource()</code>æ–¹æ³•æ¥è·å–åˆ°äº‹ä»¶ä¼ æ’­å¯¹è±¡ã€‚</p>
<h2 id="è‡ªå®šä¹‰Springäº‹ä»¶"><a href="#è‡ªå®šä¹‰Springäº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰Springäº‹ä»¶"></a>è‡ªå®šä¹‰Springäº‹ä»¶</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomSpringEvent</span><span class="params">(Object source, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ï¼Œè¯¥ç›‘å¬å™¨å®é™…ä¸Šç­‰åŒäºæ¶ˆè´¹è€…ï¼Œéœ€è¦äº¤ç»™Springå®¹å™¨ç®¡ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">CustomSpringEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(CustomSpringEvent event)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Received spring custom event - &quot;</span> + event.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå®šä¹‰äº‹ä»¶å‘å¸ƒè€…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventPublisher</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doStuffAndPublishAnEvent</span><span class="params">(<span class="keyword">final</span> String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Publishing custom event. &quot;</span>);</span><br><span class="line">        CustomSpringEvent customSpringEvent = <span class="keyword">new</span> CustomSpringEvent(<span class="keyword">this</span>, message);</span><br><span class="line">        applicationEventPublisher.publishEvent(customSpringEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventPublisherTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomSpringEventPublisher publisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishStringEventTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        publisher.doStuffAndPublishAnEvent(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæµ‹è¯•ç±»ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº†ä¸¤æ¡é‡è¦ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å‘å¸ƒäº‹ä»¶</span><br><span class="line">Publishing custom event. </span><br><span class="line">//ç›‘å¬å™¨å¾—åˆ°äº†äº‹ä»¶ï¼Œå¹¶ç›¸åº”å¤„ç†</span><br><span class="line">Received spring custom event - 111</span><br></pre></td></tr></table></figure>

<p>ç”±äºSpringäº‹ä»¶æ˜¯å‘å¸ƒ/è®¢é˜…çš„æ¨¡å¼,è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µ</p>
<ol>
<li>1ç”Ÿäº§è€… - 1æ¶ˆè´¹è€…</li>
<li>1ç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€…</li>
<li>å¤šç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€…</li>
</ol>
<p>ä¸Šé¢ä¸¾çš„ä¾‹å­æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬æ¥è¯•è¯•å…¶ä»–ä¸¤ä¸ªæƒ…å†µ</p>
<p>ç»§ç»­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ä½œä¸ºæ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventListener2</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">CustomSpringEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(CustomSpringEvent event)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CustomSpringEventListener2 Received spring custom event - &quot;</span> + event.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæµ‹è¯•ç±»åï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ§åˆ¶å°é¡ºåºæ‰“å°äº†ä¸¤æ¡æ¶ˆè´¹ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Publishing custom event. </span><br><span class="line">CustomSpringEventListener1 Received spring custom event - 111</span><br><span class="line">CustomSpringEventListener2 Received spring custom event - 111</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼ŒSpringçš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯å¹¿æ’­æ¨¡å¼ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ¥å—åˆ°æ¶ˆæ¯ï¼Œå¹¶æ­£å¸¸æ¶ˆè´¹</p>
<p>å†è¯•è¯•ç¬¬ä¸‰ç§å¤šç”Ÿäº§è€… - å¤šæ¶ˆè´¹è€…çš„æƒ…å†µ</p>
<p>ç»§ç»­åˆ›å»ºä¸€ä¸ªå‘å¸ƒè€…ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventPublisher2</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doStuffAndPublishAnEvent</span><span class="params">(<span class="keyword">final</span> String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CustomSpringEventPublisher2 Publishing custom event. &quot;</span>);</span><br><span class="line">        CustomSpringEvent customSpringEvent = <span class="keyword">new</span> CustomSpringEvent(<span class="keyword">this</span>, message);</span><br><span class="line">        applicationEventPublisher.publishEvent(customSpringEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CustomSpringEventPublisher Publishing custom event. </span><br><span class="line">CustomSpringEventListener1 Received spring custom event - <span class="number">111</span></span><br><span class="line">CustomSpringEventListener2 Received spring custom event - <span class="number">111</span></span><br><span class="line">CustomSpringEventPublisher2 Publishing custom event. </span><br><span class="line">CustomSpringEventListener1 Received spring custom event - <span class="number">222</span></span><br><span class="line">CustomSpringEventListener2 Received spring custom event - <span class="number">222</span></span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šè¾“å‡ºå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹åˆ°ï¼ŒSpringçš„äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶å¿…é¡»è¢«æ‰€æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹å®Œæˆä¹‹åï¼Œå‘å¸ƒè€…çš„ä»£ç æ‰èƒ½ç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œé‚£æœ‰æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œçš„äº‹ä»¶å‘¢ï¼Ÿ</p>
<h1 id="Springä¸­çš„å¼‚æ­¥äº‹ä»¶"><a href="#Springä¸­çš„å¼‚æ­¥äº‹ä»¶" class="headerlink" title="Springä¸­çš„å¼‚æ­¥äº‹ä»¶"></a>Springä¸­çš„å¼‚æ­¥äº‹ä»¶</h1><p>è¦ä½¿ç”¨Spring çš„å¼‚æ­¥äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚æ­¥äº‹ä»¶é…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsynchronousSpringEventsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;applicationEventMulticaster&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationEventMulticaster <span class="title">simpleApplicationEventMulticaster</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleApplicationEventMulticaster eventMulticaster</span><br><span class="line">                = <span class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">        eventMulticaster.setTaskExecutor(<span class="keyword">new</span> SimpleAsyncTaskExecutor());</span><br><span class="line">        <span class="keyword">return</span> eventMulticaster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒå’Œè®¢é˜…çš„ä»£ç ä¸ç”¨å˜åŠ¨ï¼Œç›´æ¥è¿è¡Œæµ‹è¯•ç±»ï¼Œæ§åˆ¶å°å°†æ‰“å°å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CustomSpringEventPublisher Publishing custom event. </span><br><span class="line">CustomSpringEventPublisher2 Publishing custom event. </span><br><span class="line">CustomSpringEventListener1 Received spring custom event - 111</span><br><span class="line">CustomSpringEventListener2 Received spring custom event - 111</span><br><span class="line">CustomSpringEventListener2 Received spring custom event - 222</span><br><span class="line">CustomSpringEventListener1 Received spring custom event - 222</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå‘å¸ƒè€…å‡ ä¹åŒæ—¶è¿è¡Œï¼Œè¯æ˜ç›‘å¬å™¨æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ²¡æœ‰é˜»å¡ä½å‘å¸ƒè€…çš„ä»£ç ã€‚å‡†ç¡®çš„è¯´ï¼Œç›‘å¬å™¨å°†åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­å¼‚æ­¥å¤„ç†äº‹ä»¶ã€‚</p>
<h1 id="Springè‡ªå¸¦çš„äº‹ä»¶ç±»å‹"><a href="#Springè‡ªå¸¦çš„äº‹ä»¶ç±»å‹" class="headerlink" title="Springè‡ªå¸¦çš„äº‹ä»¶ç±»å‹"></a>Springè‡ªå¸¦çš„äº‹ä»¶ç±»å‹</h1><p>äº‹ä»¶é©±åŠ¨åœ¨Springä¸­æ˜¯è¢«å¹¿æ³›é‡‡ç”¨çš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹ApplicationEventçš„å­ç±»å¯ä»¥å‘ç°è®¸å¤šEventäº‹ä»¶ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚</p>
<p><img data-src="https://i.loli.net/2019/03/14/5c8a206832ffd.png"></p>
<h1 id="æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨"><a href="#æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨" class="headerlink" title="æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨"></a>æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨</h1><p>ä»Spring 4.2å¼€å§‹ï¼Œäº‹ä»¶ç›‘å¬å™¨ä¸éœ€è¦æ˜¯å®ç°<code>ApplicationListener</code>æ¥å£çš„beanï¼Œå®ƒå¯ä»¥é€šè¿‡<code>@EventListener</code>æ³¨è§£åœ¨ä»»ä½•è¢«Springå®¹å™¨ç®¡ç†çš„beançš„å…¬å…±æ–¹æ³•ä¸Šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDrivenContextStartedListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleContextStart</span><span class="params">(CustomSpringEvent cse)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Handling Custom Spring Event.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CustomSpringEventPublisher Publishing custom event.</span><br><span class="line">Handling Custom Spring Event.</span><br><span class="line">CustomSpringEventPublisher2 Publishing custom event. </span><br><span class="line">Handling Custom Spring Event.</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœè¦æ”¹ä¸ºå¼‚æ­¥ç›‘å¬å™¨ï¼Œåœ¨äº‹ä»¶æ–¹æ³•ä¸ŠåŠ ä¸Š<code>@Async</code>ï¼Œå¹¶ä¸”åœ¨Springåº”ç”¨ä¸­å¼€å¯å¼‚æ­¥æ”¯æŒ(åœ¨<code>SpringBootApplication</code>ä¸Šæ·»åŠ <code>@EnableAsync</code>)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDrivenContextStartedListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleContextStart</span><span class="params">(CustomSpringEvent cse)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Handling Custom Spring Event.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è¿è¡Œæµ‹è¯•ç±»:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CustomSpringEventPublisher Publishing custom event. </span><br><span class="line">CustomSpringEventPublisher2 Publishing custom event. </span><br><span class="line">Handling Custom Spring Event.</span><br><span class="line">Handling Custom Spring Event.</span><br></pre></td></tr></table></figure>

<h1 id="æ³›å‹æ”¯æŒ"><a href="#æ³›å‹æ”¯æŒ" class="headerlink" title="æ³›å‹æ”¯æŒ"></a>æ³›å‹æ”¯æŒ</h1><p>åˆ›å»ºä¸€ä¸ªé€šç”¨æ³›å‹äº‹ä»¶æ¨¡å‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericSpringEvent</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T message;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> success;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericSpringEvent</span><span class="params">(T what, <span class="keyword">boolean</span> success)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = what;</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„<code>GenericSpringEvent</code>å’Œ<code>CustomSpringEvent</code>ä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥çµæ´»åœ°å‘å¸ƒä»»ä½•ä»»æ„äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†éœ€è¦ä»<code>ApplicationEvent</code>æ‰©å±•ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æ— æ³•åƒä¹‹å‰ä¸€æ ·ï¼Œé€šè¿‡ç»§æ‰¿<code>ApplicationListener</code>çš„æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œå› ä¸º<code>ApplicationListener</code>å®šä¹‰äº†äº‹ä»¶å¿…é¡»æ˜¯<code>ApplicationEvent</code>çš„å­ç±»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨æ³¨è§£é©±åŠ¨çš„ç›‘å¬å™¨ã€‚</p>
<p>é€šè¿‡åœ¨<code>@EventListener</code>æ³¨é‡Šä¸Šå®šä¹‰å¸ƒå°”SpELè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥ä½¿äº‹ä»¶ç›‘å¬å™¨æˆä¸ºæ¡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªä¼šä¸ºæˆåŠŸçš„Stringçš„<code>GenericSpringEvent</code>è°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationDrivenEventListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@EventListener(condition = &quot;#event.success&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleSuccessful</span><span class="params">(GenericSpringEvent&lt;String&gt; event)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Handling generic event (conditional).&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å…·ä½“ç±»å‹çš„äº‹ä»¶:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringGenericSpringEvent</span> <span class="keyword">extends</span> <span class="title">GenericSpringEvent</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringGenericSpringEvent</span><span class="params">(String message, <span class="keyword">boolean</span> success)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, success);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å‘å¸ƒè€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringGenericSpringEventPublisher</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doStuffAndPublishAnEvent</span><span class="params">(<span class="keyword">final</span> String message, <span class="keyword">final</span> <span class="keyword">boolean</span> success)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CustomSpringEventPublisher Publishing custom event. &quot;</span>);</span><br><span class="line">        StringGenericSpringEvent springEvent = <span class="keyword">new</span> StringGenericSpringEvent(message, success);</span><br><span class="line">        applicationEventPublisher.publishEvent(springEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSpringEventPublisherTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringGenericSpringEventPublisher publisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishStringEventTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        publisher.doStuffAndPublishAnEvent(<span class="string">&quot;success&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">        publisher.doStuffAndPublishAnEvent(<span class="string">&quot;failed&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CustomSpringEventPublisher Publishing custom event. </span><br><span class="line">Handling generic event (conditional) success</span><br><span class="line">CustomSpringEventPublisher Publishing custom event. </span><br></pre></td></tr></table></figure>

<p>ç›‘å¬å™¨åªå¤„ç†äº†æˆåŠŸçš„äº‹ä»¶ï¼ŒæˆåŠŸå¿½ç•¥æ‰äº†å¤±è´¥çš„äº‹ä»¶ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ä¸ºåŒä¸€ä¸ªäº‹ä»¶å®šä¹‰æˆåŠŸå’Œå¤±è´¥ä¸åŒçš„æ“ä½œã€‚</p>
<h1 id="Springäº‹ä»¶çš„äº‹åŠ¡ç»‘å®š"><a href="#Springäº‹ä»¶çš„äº‹åŠ¡ç»‘å®š" class="headerlink" title="Springäº‹ä»¶çš„äº‹åŠ¡ç»‘å®š"></a>Springäº‹ä»¶çš„äº‹åŠ¡ç»‘å®š</h1><p>ä»Spring 4.2å¼€å§‹ï¼Œæ¡†æ¶æä¾›äº†ä¸€ä¸ªæ–°çš„<code>@TransactionalEventListener</code>æ³¨è§£ï¼Œå®ƒæ˜¯<code>@EventListener</code>çš„æ‰©å±•ï¼Œå…è®¸å°†äº‹ä»¶çš„ä¾¦å¬å™¨ç»‘å®šåˆ°äº‹åŠ¡çš„ä¸€ä¸ªé˜¶æ®µã€‚ç»‘å®šå¯ä»¥è¿›è¡Œä»¥ä¸‹äº‹åŠ¡é˜¶æ®µï¼š</p>
<ul>
<li>AFTER_COMMIT(é»˜è®¤çš„)ï¼šåœ¨äº‹åŠ¡æˆåŠŸåè§¦å‘</li>
<li>AFTER_ROLLBACK:äº‹åŠ¡å›æ»šæ—¶è§¦å‘</li>
<li>AFTER_COMPLETIONï¼šäº‹åŠ¡å®Œæˆåè§¦å‘ï¼Œä¸è®ºæ˜¯å¦æˆåŠŸ</li>
<li>BEFORE_COMMITï¼šäº‹åŠ¡æäº¤ä¹‹å‰è§¦å‘</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>Springä¸­å¤„ç†äº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå‘å¸ƒå®ƒï¼Œç„¶ååœ¨ç›‘å¬å™¨ä¸­å¤„ç†å®ƒã€‚</li>
<li>åœ¨é…ç½®ä¸­å¯ç”¨äº‹ä»¶çš„å¼‚æ­¥å¤„ç†ã€‚</li>
<li>Spring 4.2ä¸­å¼•å…¥çš„æ”¹è¿›ï¼Œä¾‹å¦‚æ³¨é‡Šé©±åŠ¨çš„ä¾¦å¬å™¨ï¼Œæ›´å¥½çš„æ³›å‹æ”¯æŒä»¥åŠç»‘å®šåˆ°äº‹åŠ¡é˜¶æ®µçš„äº‹ä»¶ã€‚</li>
</ol>
<p>ğŸ‘‰ <a href="https://github.com/gcdd1993/spring-event-demo">æœ¬æ–‡ä»£ç åœ°å€</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring IoC Containeræºç åˆ†æï¼ˆäºŒï¼‰-beanåˆå§‹åŒ–æµç¨‹</title>
    <url>/p/60483/</url>
    <content><![CDATA[<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>Personå®ä¾‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml beané…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.gcdd1993.spring.framework.base.domain.Person&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AbstractApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Debugè¿›å…¥<code>ClassPathXmlApplicationContext</code>æ„é€ å‡½æ•°ï¼Œæºç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="keyword">boolean</span> refresh, ApplicationContext parent)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>(parent);</span><br><span class="line">    setConfigLocations(configLocations);</span><br><span class="line">    <span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">        refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="super-parent"><a href="#super-parent" class="headerlink" title="super(parent)"></a>super(parent)</h1><p>ä¸€æ­¥æ­¥å‘ä¸Šè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œè·¯å¾„ä¸º</p>
<p>ClassPathXmlApplicationContext -&gt; AbstractXmlApplicationContext -&gt; AbstractRefreshableConfigApplicationContext -&gt; AbstractRefreshableApplicationContext -&gt; AbstractApplicationContext</p>
<p>å†ç»æ•´ä¸ªç»§æ‰¿ä½“ç³»ï¼Œæœ€ç»ˆåˆ°è¾¾<code>AbstractApplicationContext</code>:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AbstractApplicationContext</span><span class="params">(ApplicationContext parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    setParent(parent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¼šè®¾ç½®å½“å‰<code>ApplicationContext</code>çš„çˆ¶çº§<code>ApplicationContext</code></p>
<h1 id="setConfigLocations-configLocations"><a href="#setConfigLocations-configLocations" class="headerlink" title="setConfigLocations(configLocations)"></a>setConfigLocations(configLocations)</h1><p>è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œè§£æçš„ç»†èŠ‚å‚ç…§å®˜æ–¹æ–‡æ¡£Resourceä¸€èŠ‚ï¼Œä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ï¼Œåœ¨æ­¤ç•¥è¿‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigLocations</span><span class="params">(String... locations)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (locations != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Assert.noNullElements(locations, <span class="string">&quot;Config locations must not be null&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.configLocations = <span class="keyword">new</span> String[locations.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; locations.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.configLocations[i] = resolvePath(locations[i]).trim();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.configLocations = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="refresh"><a href="#refresh" class="headerlink" title="refresh()"></a>refresh()</h1><p>æ­¤æ–¹æ³•æ˜¯Springå®¹å™¨çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæºç (ç²¾ç®€äº†try catchéƒ¨åˆ†)å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">    <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">    prepareRefresh();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">    prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">    postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">    invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">    registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">    initMessageSource();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">    initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">    onRefresh();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">    registerListeners();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">    finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">    finishRefresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„å¯ä»¥çœ‹åˆ°Springç¼–ç æ–¹å¼è¿‘ä¼¼äºæµç¨‹å›¾çš„ï¼Œé‡ç‚¹éƒ¨åˆ†éƒ½æŠ½å‡ºä¸ºäº†å•ç‹¬çš„æ–¹æ³•ï¼Œæµç¨‹æ¸…æ™°ï¼Œæ˜“äºç†è§£ã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹ï¼š</p>
<h2 id="prepareRefresh"><a href="#prepareRefresh" class="headerlink" title="prepareRefresh()"></a>prepareRefresh()</h2><blockquote>
<p>ä¸Šä¸‹æ–‡åˆ·æ–°å‰é¢„çƒ­</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.startupDate = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">this</span>.closed.set(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">this</span>.active.set(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Refreshing &quot;</span> + <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize any placeholder property sources in the context environment</span></span><br><span class="line">    initPropertySources();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Validate that all properties marked as required are resolvable</span></span><br><span class="line">    <span class="comment">// see ConfigurablePropertyResolver#setRequiredProperties</span></span><br><span class="line">    getEnvironment().validateRequiredProperties();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allow for the collection of early ApplicationEvents,</span></span><br><span class="line">    <span class="comment">// to be published once the multicaster is available...</span></span><br><span class="line">    <span class="keyword">this</span>.earlyApplicationEvents = <span class="keyword">new</span> LinkedHashSet&lt;ApplicationEvent&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>è®¾ç½®ä¸Šä¸‹æ–‡åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚startupDate(å¯åŠ¨æ—¶åˆ»)ã€closed(æ˜¯å¦å…³é—­)ã€active(æ˜¯å¦å­˜æ´»)ç­‰ç­‰ã€‚</li>
<li>è§£æå ä½ç¬¦èµ„æºï¼Œå¹¶éªŒè¯æ ‡è®°ä¸ºrequiredçš„èµ„æºæ˜¯å¦å¯ç”¨</li>
</ol>
<h2 id="obtainFreshBeanFactory"><a href="#obtainFreshBeanFactory" class="headerlink" title="obtainFreshBeanFactory()"></a>obtainFreshBeanFactory()</h2><blockquote>
<p>åˆå§‹åŒ–beanFactory(beanå·¥å‚ï¼Œå®é™…å­˜æ”¾beançš„å°±æ˜¯å®ƒäº†)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ConfigurableListableBeanFactory <span class="title">obtainFreshBeanFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    refreshBeanFactory();</span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = getBeanFactory();</span><br><span class="line">    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Bean factory for &quot;</span> + getDisplayName() + <span class="string">&quot;: &quot;</span> + beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> beanFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ–¹æ³•<code>refreshBeanFactory()</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">refreshBeanFactory</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hasBeanFactory()) &#123;</span><br><span class="line">        destroyBeans();</span><br><span class="line">        closeBeanFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        DefaultListableBeanFactory beanFactory = createBeanFactory();</span><br><span class="line">        beanFactory.setSerializationId(getId());</span><br><span class="line">        customizeBeanFactory(beanFactory);</span><br><span class="line">        loadBeanDefinitions(beanFactory);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.beanFactoryMonitor) &#123;</span><br><span class="line">            <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;I/O error parsing bean definition source for &quot;</span> + getDisplayName(), ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>createBeanFactory();</li>
<li>è®¾ç½®beanFactoryå±æ€§</li>
<li>loadBeanDefinitions(beanFactory);</li>
</ol>
<h2 id="loadBeanDefinitions-beanFactory"><a href="#loadBeanDefinitions-beanFactory" class="headerlink" title="loadBeanDefinitions(beanFactory)"></a>loadBeanDefinitions(beanFactory)</h2><blockquote>
<p>è§£æbeanå®šä¹‰ï¼Œæœ‰å‡ ä¸ªbeanå°±æœ‰å‡ ä¸ªBeanDefinitionã€‚æ³¨æ„ï¼ŒSpringå¹¶ä¸æ˜¯æ‹¿åˆ°é…ç½®å°±ç›´æ¥ç”¨åå°„å®ä¾‹åŒ–beanï¼Œè€Œæ˜¯å…ˆå°†beané…ç½®è§£æä¸ºBeanDefinitionã€‚</p>
</blockquote>
<p>BeanDefinitionä¿å­˜äº†å®ä¾‹åŒ–beanéœ€è¦çš„ä¸€åˆ‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å±æ€§ï¼Œä¾èµ–ç­‰ã€‚ä»¥<code>ConcurrentHashMap&lt;String, BeanDefinition&gt;</code>ä¿å­˜åœ¨DefaultListableBeanFactoryçš„beanDefinitionMapé‡Œã€‚</p>
<p><img data-src="https://i.loli.net/2019/03/29/5c9dbcecdf9e1.png"></p>
<h2 id="prepareBeanFactory-beanFactory"><a href="#prepareBeanFactory-beanFactory" class="headerlink" title="prepareBeanFactory(beanFactory)"></a>prepareBeanFactory(beanFactory)</h2><blockquote>
<p>è®¾ç½®beanFactoryçš„å…¶ä½™å±æ€§</p>
</blockquote>
<h2 id="postProcessBeanFactory-beanFactory"><a href="#postProcessBeanFactory-beanFactory" class="headerlink" title="postProcessBeanFactory(beanFactory)"></a>postProcessBeanFactory(beanFactory)</h2><blockquote>
<p>ç©ºå®ç°ï¼Œç»™å­ç±»ä¸€ä¸ªæœºä¼šï¼Œè‡ªå®šä¹‰beanFactoryåç½®å¤„ç†å™¨</p>
</blockquote>
<p><code>BeanFactoryPostProcessor</code>å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="invokeBeanFactoryPostProcessors-beanFactory"><a href="#invokeBeanFactoryPostProcessors-beanFactory" class="headerlink" title="invokeBeanFactoryPostProcessors(beanFactory)"></a>invokeBeanFactoryPostProcessors(beanFactory)</h2><blockquote>
<p>æ‰§è¡Œä¸Šä¸€æ­¥ä¸­çš„beanFactoryåç½®å¤„ç†å™¨çš„å›è°ƒæ–¹æ³•<code>void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)</code></p>
</blockquote>
<h2 id="registerBeanPostProcessors-beanFactory"><a href="#registerBeanPostProcessors-beanFactory" class="headerlink" title="registerBeanPostProcessors(beanFactory)"></a>registerBeanPostProcessors(beanFactory)</h2><blockquote>
<p>æ³¨å†Œbeanåç½®å¤„ç†å™¨ï¼Œå®ç°beanåˆå§‹åŒ–å‰åçš„è‡ªå®šä¹‰é€»è¾‘</p>
</blockquote>
<p><code>BeanPostProcessor</code>å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨beanå®ä¾‹åŒ–å‰è°ƒç”¨</span></span><br><span class="line">    <span class="function">Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">    <span class="comment">// åœ¨beanå®ä¾‹åŒ–åè°ƒç”¨</span></span><br><span class="line">    <span class="function">Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="initMessageSource"><a href="#initMessageSource" class="headerlink" title="initMessageSource()"></a>initMessageSource()</h2><blockquote>
<p>æ³¨å†Œå›½é™…åŒ–ç›¸å…³bean</p>
</blockquote>
<h2 id="initApplicationEventMulticaster"><a href="#initApplicationEventMulticaster" class="headerlink" title="initApplicationEventMulticaster()"></a>initApplicationEventMulticaster()</h2><blockquote>
<p>åˆå§‹åŒ–Springäº‹ä»¶å‘å¸ƒç›¸å…³bean</p>
</blockquote>
<h2 id="onRefresh"><a href="#onRefresh" class="headerlink" title="onRefresh()"></a>onRefresh()</h2><blockquote>
<p>ç©ºå®ç°ï¼Œç»™å­ç±»ä¸€ä¸ªæœºä¼šï¼Œåˆå§‹åŒ–ç‰¹æ®Šbean</p>
</blockquote>
<h2 id="registerListeners"><a href="#registerListeners" class="headerlink" title="registerListeners()"></a>registerListeners()</h2><blockquote>
<p>æ³¨å†Œç›‘å¬å™¨</p>
</blockquote>
<h2 id="finishBeanFactoryInitialization-beanFactory"><a href="#finishBeanFactoryInitialization-beanFactory" class="headerlink" title="finishBeanFactoryInitialization(beanFactory)"></a>finishBeanFactoryInitialization(beanFactory)</h2><blockquote>
<p>å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„bean</p>
</blockquote>
<p>ç›´åˆ°è¿™é‡Œï¼Œæ‰å¼€å§‹çœŸæ­£å®ä¾‹åŒ–bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishBeanFactoryInitialization</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. å®ä¾‹åŒ–beançš„ç±»å‹è½¬æ¢å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;</span><br><span class="line">            beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;</span><br><span class="line">        beanFactory.setConversionService(</span><br><span class="line">                beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å®ä¾‹åŒ–å±æ€§å ä½ç¬¦è§£æå™¨</span></span><br><span class="line">    <span class="keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;</span><br><span class="line">        beanFactory.addEmbeddedValueResolver(<span class="keyword">new</span> StringValueResolver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">resolveStringValue</span><span class="params">(String strVal)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> getEnvironment().resolvePlaceholders(strVal);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å®ä¾‹åŒ–LoadTimeWeaverAware</span></span><br><span class="line">    String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;</span><br><span class="line">        getBean(weaverAwareName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åœæ­¢ä½¿ç”¨ä¸´æ—¶ClassLoaderè¿›è¡Œç±»å‹åŒ¹é…</span></span><br><span class="line">    beanFactory.setTempClassLoader(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. ç¦æ­¢å†ä¿®æ”¹beanå®šä¹‰</span></span><br><span class="line">    beanFactory.freezeConfiguration();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½å•ä¾‹bean</span></span><br><span class="line">    beanFactory.preInstantiateSingletons();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="preInstantiateSingletons"><a href="#preInstantiateSingletons" class="headerlink" title="preInstantiateSingletons()"></a>preInstantiateSingletons()</h3><ol>
<li>æ ¹æ®æ¯ä¸€ä¸ªbeanå®šä¹‰ï¼Œå®ä¾‹åŒ–bean</li>
<li>ä¸ºæ¯ä¸€ä¸ªå®ç°SmartInitializingSingletonçš„beanæ‰§è¡Œå›è°ƒæ–¹æ³•</li>
</ol>
<p>å®ä¾‹åŒ–beanéƒ¨åˆ†çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">    <span class="comment">// è·å–beanå®šä¹‰</span></span><br><span class="line">    RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">    <span class="comment">// åªæœ‰ä¸æ˜¯abstractã€å•ä¾‹ä¸”ä¸æ˜¯æ‡’åŠ è½½çš„beanæ‰åœ¨è¿™é‡Œå®ä¾‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯FactoryBean</span></span><br><span class="line">        <span class="keyword">if</span> (isFactoryBean(beanName)) &#123;</span><br><span class="line">            <span class="comment">// å…ˆå®ä¾‹åŒ–å®ä¾‹å¯¹åº”çš„FactoryBean</span></span><br><span class="line">            <span class="keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) getBean(FACTORY_BEAN_PREFIX + beanName);</span><br><span class="line">            <span class="keyword">boolean</span> isEagerInit;</span><br><span class="line">            <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span> &amp;&amp; factory <span class="keyword">instanceof</span> SmartFactoryBean) &#123;</span><br><span class="line">                isEagerInit = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Boolean&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Boolean <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, getAccessControlContext());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                isEagerInit = (factory <span class="keyword">instanceof</span> SmartFactoryBean &amp;&amp;</span><br><span class="line">                        ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (isEagerInit) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨FactoryBeançš„getObject()æ–¹æ³•è¿”å›çœŸæ­£çš„å®ä¾‹</span></span><br><span class="line">                getBean(beanName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            getBean(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="getBean-String-name"><a href="#getBean-String-name" class="headerlink" title="getBean(String name)"></a>getBean(String name)</h4><p>è¯¥æ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ªdoGetBeanï¼ŒdoGetBeanä»£ç è¾ƒé•¿ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†ä»£ç æ˜¯ä¸ºäº†è§£å†³å¹¶å‘åœºæ™¯ä¸‹å•ä¾‹çš„ç”Ÿæˆï¼Œæˆ‘ä»¬æŒ‘å‡ºé‡ç‚¹çš„çœ‹ï¼š</p>
<ol>
<li>ä»çˆ¶BeanFactoryæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥beançš„å®šä¹‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œå§”æ‰˜çˆ¶BeanFactoryæ¥å®ä¾‹åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BeanFactory parentBeanFactory = getParentBeanFactory();</span><br><span class="line"><span class="keyword">if</span> (parentBeanFactory != <span class="keyword">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;</span><br><span class="line">    <span class="comment">// Not found -&gt; check parent.</span></span><br><span class="line">    String nameToLookup = originalBeanName(name);</span><br><span class="line">    <span class="keyword">if</span> (args != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Delegation to parent with explicit args.</span></span><br><span class="line">        <span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// No args -&gt; delegate to standard getBean method.</span></span><br><span class="line">        <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å¾—beanå®šä¹‰ï¼Œå¦‚æœå­˜åœ¨ä¾èµ–ï¼Œå…ˆå®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–beanï¼Œæ³¨æ„ï¼šä¸å…è®¸å¾ªç¯ä¾èµ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Guarantee initialization of beans that the current bean depends on.</span></span><br><span class="line">String[] dependsOn = mbd.getDependsOn();</span><br><span class="line"><span class="comment">//å¦‚æœå­˜åœ¨ä¾èµ–ï¼Œå…ˆå®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–bean</span></span><br><span class="line"><span class="keyword">if</span> (dependsOn != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–æ¯ä¸€ä¸ªä¾èµ–bean</span></span><br><span class="line">    <span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¾ªç¯ä¾èµ–</span></span><br><span class="line">        <span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">                    <span class="string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–ä¾èµ–bean</span></span><br><span class="line">        registerDependentBean(dep, beanName);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getBean(dep);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">                    <span class="string">&quot;&#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å®ä¾‹åŒ–bean</li>
</ol>
<p>æ–¹æ³•è°ƒç”¨æµç¨‹ï¼š</p>
<p>createBean &gt; doCreateBean &gt; populateBean</p>
<p>å…¶ä¸­doCreateBeanï¼š</p>
<ol>
<li>ä»BeanDefinitionç”ŸæˆBeanWrapper</li>
<li>å°†BeanWrapperå’ŒBeanDefinition.getPropertyValues() ä¼ ç»™populateBeanï¼Œå®ä¾‹åŒ–bean</li>
</ol>
<h2 id="finishRefresh"><a href="#finishRefresh" class="headerlink" title="finishRefresh()"></a>finishRefresh()</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨</span></span><br><span class="line">    initLifecycleProcessor();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ·æ–°ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨çŠ¶æ€ running = true</span></span><br><span class="line">    getLifecycleProcessor().onRefresh();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘å¸ƒä¸Šä¸‹æ–‡åˆå§‹åŒ–å®Œæˆäº‹ä»¶ContextRefreshedEvent</span></span><br><span class="line">    publishEvent(<span class="keyword">new</span> ContextRefreshedEvent(<span class="keyword">this</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ°LiveBeans</span></span><br><span class="line">    LiveBeansView.registerApplicationContext(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Spring IoC Containeræ—¶åºå›¾</p>
<p><img data-src="https://i.loli.net/2019/03/29/5c9dd9c73cbe4.jpg"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Mvc Http 400 Bad Requesté—®é¢˜æ’æŸ¥</title>
    <url>/p/6604/</url>
    <content><![CDATA[<p>å¦‚æœé‡åˆ°äº†Spring MVCæŠ¥é”™400ï¼Œè€Œä¸”æ²¡æœ‰è¿”å›ä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹è¯¥å¦‚ä½•æ’æŸ¥é—®é¢˜ï¼Ÿ<span id="more"></span></p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>ä¸€ç›´éƒ½æ²¡æ¯›ç—…çš„æ¥å£ï¼Œä»Šå¤©æµ‹è¯•çš„æ—¶å€™çªç„¶æŠ¥é”™<code>400 Bad Request</code>ï¼Œè€Œä¸”Responseæ²¡æœ‰è¿”å›ä»»ä½•ä¿¡æ¯ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/26/5d3ae61b24ab372943.png"></p>
<p><img data-src="https://i.loli.net/2019/07/26/5d3ad97a0da2b22891.png"></p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>å°è¯•äº†ä¸€ä¸‹åˆï¼Œç»ˆäºæ‰¾åˆ°äº†æ’æŸ¥è¿™ç±»é—®é¢˜çš„åŠæ³•ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Spring MVCé‡Œé¢ï¼Œ<br><code>org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler</code><br>è´Ÿè´£æ‰€æœ‰å¼‚å¸¸çš„ç»Ÿä¸€å¤„ç†ã€‚æˆ‘ä»¬åªè¦åœ¨æ–¹æ³•<code>handleException</code>æ‰“ä¸Šæ–­ç‚¹å³å¯ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/26/5d3ada319940784853.png"></p>
<p>ç‚¹å¼€å‘ç°ï¼ŒåŸæ¥æ˜¯Lombokçš„é—®é¢˜ã€‚æŠ¥é”™å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Could not read JSON document: Can not construct instance of xxx: no suitable constructor found, can not deserialize from Object value (missing default constructor or creator, or perhaps need to add/enable type information?)</span><br><span class="line"> at [Source: java.io.PushbackInputStream@12544acd; line: 2, column: 5]</span><br></pre></td></tr></table></figure>

<p>Lombokæ²¡æœ‰ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆç±»çš„æ„é€ å‡½æ•°ã€‚æˆ‘ä»¬åœ¨ç›®æ ‡ç±»åŠ ä¸Š<code>@NoArgsConstructor</code>å³å¯è§£å†³ã€‚</p>
<h1 id="åˆ¨æ ¹é—®åº•"><a href="#åˆ¨æ ¹é—®åº•" class="headerlink" title="åˆ¨æ ¹é—®åº•"></a>åˆ¨æ ¹é—®åº•</h1><p>ä¸ºä»€ä¹ˆLombokè‡ªåŠ¨ç”Ÿæˆçš„ç±»ï¼Œæ²¡æœ‰å¯ä¾›Jacksonååºåˆ—åŒ–çš„æ„é€ å‡½æ•°å‘¢ï¼Ÿæˆ‘çœ‹äº†ä¸€ä¸‹ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé‡Œé¢ç¡®å®ä¸å­˜åœ¨æ— å‚æ„é€ å’Œå…¨å‚æ„é€ å‡½æ•°ï¼Œå”¯ä¸€çš„æ„é€ å‡½æ•°æ˜¯å¸¦ä¸€ä¸ªå‚æ•°çš„ã€‚</p>
<p>ç›®æ ‡ç±»ä½¿ç”¨äº†<code>@Data</code>æ³¨è§£ï¼Œè€Œ<code>@Data</code>æ³¨è§£çš„å£°æ˜å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generates getters for all fields, a useful toString method, and hashCode and equals implementations that check</span></span><br><span class="line"><span class="comment"> * all non-transient fields. Will also generate setters for all non-final fields, as well as a constructor.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Equivalent to &#123;<span class="doctag">@code</span> <span class="doctag">@Getter</span> <span class="doctag">@Setter</span> <span class="doctag">@RequiredArgsConstructor</span> <span class="doctag">@ToString</span> <span class="doctag">@EqualsAndHashCode</span>&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Complete documentation is found at &lt;a href=&quot;https://projectlombok.org/features/Data&quot;&gt;the project lombok features page for &amp;#64;Data&lt;/a&gt;.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Getter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Setter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequiredArgsConstructor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ToString</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EqualsAndHashCode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> lombok.Value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Data &#123;</span><br><span class="line">	<span class="function">String <span class="title">staticConstructor</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•æ¥è¯´ï¼Œ<code>@Data</code>åŒ…å«äº†ä»¥ä¸‹æ³¨è§£çš„åŠŸèƒ½</p>
<ul>
<li>@Getter</li>
<li>@Setter</li>
<li>@RequiredArgsConstructor</li>
<li>@ToString</li>
<li>@EqualsAndHashCode</li>
</ul>
<p>è€Œâ€œç½ªé­ç¥¸é¦–â€å°±æ˜¯<code>@RequiredArgsConstructor</code>äº†ï¼Œå®ƒçš„ä½œç”¨æ˜¯</p>
<blockquote>
<p>ä¸ºæ¯ä¸ªéœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µï¼ˆfinalä¿®é¥°çš„æˆ–è€…æ˜¯@NotNullæ³¨é‡Šçš„å­—æ®µï¼‰ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ã€‚</p>
</blockquote>
<p>è€Œç›®æ ‡ç±»æ°å·§æœ‰ä¸€ä¸ªå­—æ®µå°±æ˜¯<code>@NotNull</code>æ³¨è§£ä¿®é¥°çš„ï¼Œæ‰€ä»¥ç”Ÿæˆäº†å•å‚æ„é€ å‡½æ•°ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="https://projectlombok.org/features/all">Lombok Features</a></li>
<li><a href="https://www.baeldung.com/global-error-handler-in-a-spring-rest-api">Spring MVCè‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Securityæ— æ³•æ­£å¸¸æ•æ‰åˆ°UsernameNotFoundExceptionå¼‚å¸¸</title>
    <url>/p/31514/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨Webåº”ç”¨å¼€å‘ä¸­,å®‰å…¨ä¸€ç›´æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæ–¹é¢ã€‚åœ¨åºå¤§çš„springç”Ÿæ€åœˆä¸­ï¼Œæƒé™æ ¡éªŒæ¡†æ¶ä¹Ÿæ˜¯éå¸¸å®Œå–„çš„ã€‚å…¶ä¸­ï¼Œspring securityæ˜¯éå¸¸å¥½ç”¨çš„ã€‚ä»Šå¤©è®°å½•ä¸€ä¸‹åœ¨å¼€å‘ä¸­é‡åˆ°çš„ä¸€ä¸ªspring-securityç›¸å…³çš„é—®é¢˜ã€‚<span id="more"></span></p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>ä½¿ç”¨spring securityè¿›è¡Œæˆæƒç™»å½•çš„æ—¶å€™ï¼Œå‘ç°ç™»å½•æ¥å£æ— æ³•æ­£å¸¸æ•æ‰UsernameNotFoundExceptionå¼‚å¸¸ï¼Œæ•æ‰åˆ°çš„ä¸€ç›´æ˜¯BadCredentialsExceptionå¼‚å¸¸ã€‚æˆ‘ä»¬çš„é¢„æœŸæ˜¯ï¼š</p>
<ul>
<li>UsernameNotFoundException -&gt; ç”¨æˆ·åé”™è¯¯</li>
<li>BadCredentialsException -&gt; å¯†ç é”™è¯¯</li>
</ul>
<p>è´´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä»£ç ï¼š</p>
<h2 id="1-ç™»å½•ä¸šåŠ¡é€»è¾‘"><a href="#1-ç™»å½•ä¸šåŠ¡é€»è¾‘" class="headerlink" title="1. ç™»å½•ä¸šåŠ¡é€»è¾‘"></a>1. ç™»å½•ä¸šåŠ¡é€»è¾‘</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthServiceImpl</span> <span class="keyword">implements</span> <span class="title">AuthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtAuthenticationResponse <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//æ„é€ spring securityéœ€è¦çš„UsernamePasswordAuthenticationToken</span></span><br><span class="line">        UsernamePasswordAuthenticationToken upToken = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);</span><br><span class="line">		<span class="comment">//è°ƒç”¨authenticationManager.authenticate(upToken)æ–¹æ³•éªŒè¯</span></span><br><span class="line">		<span class="comment">//è¯¥æ–¹æ³•å°†ä¼šæ‰§è¡ŒUserDetailsServiceçš„loadUserByUsernameéªŒè¯ç”¨æˆ·å</span></span><br><span class="line">		<span class="comment">//ä»¥åŠPasswordEncoderçš„matchesæ–¹æ³•éªŒè¯å¯†ç </span></span><br><span class="line">        val authenticate = authenticationManager.authenticate(upToken);</span><br><span class="line">        JwtUser userDetails = (JwtUser) authenticate.getPrincipal();</span><br><span class="line">        val token = jwtTokenUtil.generateToken(userDetails);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtAuthenticationResponse(token, userDetails.getId(), userDetails.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-spring-security-çš„UserDetailsService-å®ç°ç±»"><a href="#2-spring-security-çš„UserDetailsService-å®ç°ç±»" class="headerlink" title="2. spring security çš„UserDetailsService å®ç°ç±»"></a>2. spring security çš„UserDetailsService å®ç°ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        AbstractUser abstractUser = userRepository.findByUsername(username);</span><br><span class="line">		<span class="comment">//å¦‚æœé€šè¿‡ç”¨æˆ·åæ‰¾ä¸åˆ°ç”¨æˆ·ï¼Œåˆ™æŠ›å‡ºUsernameNotFoundExceptionå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (abstractUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(String.format(<span class="string">&quot;No abstractUser found with username &#x27;%s&#x27;.&quot;</span>, username));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> JwtUserFactory.create(abstractUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ç™»å½•æ¥å£"><a href="#3-ç™»å½•æ¥å£" class="headerlink" title="3. ç™»å½•æ¥å£"></a>3. ç™»å½•æ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> JwtAuthenticationResponse jsonResponse = authService.login(authenticationRequest.getUsername(), authenticationRequest.getPassword());</span><br><span class="line">    <span class="comment">//å­˜å…¥redis</span></span><br><span class="line">    redisService.setToken(jsonResponse.getToken());</span><br><span class="line">    <span class="keyword">return</span> ok(jsonResponse);</span><br><span class="line">&#125; <span class="keyword">catch</span> (BadCredentialsException e) &#123;</span><br><span class="line">	<span class="comment">//æ•æ‰åˆ°BadCredentialsExceptionï¼Œå¯†ç ä¸æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">return</span> forbidden(LOGIN_PASSWORD_ERROR, request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UsernameNotFoundException e) &#123;</span><br><span class="line">	<span class="comment">//æ•æ‰åˆ°UsernameNotFoundExceptionï¼Œç”¨æˆ·åä¸æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">return</span> forbidden(LOGIN_USERNAME_ERROR, request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·åé”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ"><a href="#åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·åé”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ" class="headerlink" title="åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·åé”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ"></a>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·åé”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span> (UsernameNotFoundException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> forbidden(LOGIN_USERNAME_ERROR, request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚æœå¯†ç é”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ"><a href="#å¦‚æœå¯†ç é”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ" class="headerlink" title="å¦‚æœå¯†ç é”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ"></a>å¦‚æœå¯†ç é”™è¯¯ï¼Œåº”è¯¥æ‰§è¡Œ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span> (BadCredentialsException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> forbidden(LOGIN_PASSWORD_ERROR, request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œä¸ç®¡æ˜¯æŠ›å‡ºä»€ä¹ˆé”™ï¼Œæœ€åæŠ“åˆ°çš„éƒ½æ˜¯BadCredentialsException</p>
<h1 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h1><h2 id="debugå¤§æ³•"><a href="#debugå¤§æ³•" class="headerlink" title="debugå¤§æ³•"></a>debugå¤§æ³•</h2><h3 id="æ–­ç‚¹"><a href="#æ–­ç‚¹" class="headerlink" title="æ–­ç‚¹"></a>æ–­ç‚¹</h3><p><img data-src="https://i.imgur.com/eRNlVGd.png"></p>
<h3 id="è·Ÿè¸ª"><a href="#è·Ÿè¸ª" class="headerlink" title="è·Ÿè¸ª"></a>è·Ÿè¸ª</h3><p>ç»è¿‡æ­¥è¿›æ³•è·Ÿè¸ªä»£ç ï¼Œå‘ç°é—®é¢˜æ‰€åœ¨ï¼Œä½äº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">AbstractUserDetailsAuthenticationProvider</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span></span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.imgur.com/7somN4i.png"></p>
<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><ol>
<li>loadUserByUsernameæ–¹æ³•ç¡®å®æŠ›å‡ºäº†UsernameNotFoundException</li>
<li>èµ°åˆ°AbstractUserDetailsAuthenticationProviderçš„authenticateæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœhideUserNotFoundExceptions = trueï¼Œç›´æ¥å°±è¦†ç›–äº†UsernameNotFoundExceptionå¼‚å¸¸å¹¶æŠ›å‡ºBadCredentialsExceptionå¼‚å¸¸ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆæ€»æ˜¯æ•æ‰åˆ°BadCredentialsExceptionå¼‚å¸¸</li>
</ol>
<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>æ—¢ç„¶å·²ç»æ‰¾åˆ°äº†æ˜¯å› ä¸º<code>hideUserNotFoundExceptions = true</code>å¯¼è‡´çš„é—®é¢˜ï¼Œé‚£æŠŠ<code>hideUserNotFoundExceptions = false</code>ä¸å°±å®Œäº‹äº†å—ï¼Ÿ</p>
<h2 id="æ–¹æ¡ˆ1"><a href="#æ–¹æ¡ˆ1" class="headerlink" title="æ–¹æ¡ˆ1"></a>æ–¹æ¡ˆ1</h2><p><a href="https://stackoverflow.com/questions/17439628/spring-security-custom-exception-message-from-userdetailsservice" title="å‚è€ƒstackoverflowå¤§ç¥å›ç­”">å‚è€ƒstackoverflowå¤§ç¥å›ç­”</a></p>
<h3 id="ä¿®æ”¹WebSecurityConfigé…ç½®ï¼Œæ·»åŠ AuthenticationProvider-Bean"><a href="#ä¿®æ”¹WebSecurityConfigé…ç½®ï¼Œæ·»åŠ AuthenticationProvider-Bean" class="headerlink" title="ä¿®æ”¹WebSecurityConfigé…ç½®ï¼Œæ·»åŠ AuthenticationProvider Bean"></a>ä¿®æ”¹WebSecurityConfigé…ç½®ï¼Œæ·»åŠ AuthenticationProvider Bean</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AuthenticationProvider <span class="title">daoAuthenticationProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DaoAuthenticationProvider daoAuthenticationProvider = <span class="keyword">new</span> DaoAuthenticationProvider();</span><br><span class="line">    daoAuthenticationProvider.setUserDetailsService(userDetailsService);</span><br><span class="line">    daoAuthenticationProvider.setPasswordEncoder(passwordEncoder());</span><br><span class="line">    daoAuthenticationProvider.setHideUserNotFoundExceptions(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> daoAuthenticationProvider;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®AuthenticationProvider-Bean"><a href="#é…ç½®AuthenticationProvider-Bean" class="headerlink" title="é…ç½®AuthenticationProvider Bean"></a>é…ç½®AuthenticationProvider Bean</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureAuthentication</span><span class="params">(AuthenticationManagerBuilder authenticationManagerBuilder)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    authenticationManagerBuilder</span><br><span class="line">            .authenticationProvider(daoAuthenticationProvider());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ¡ˆ2"><a href="#æ–¹æ¡ˆ2" class="headerlink" title="æ–¹æ¡ˆ2"></a>æ–¹æ¡ˆ2</h2><p>ç”±äºä»¥å‰é¡¹ç›®ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„æŠ€æœ¯æ ˆï¼Œè€Œä¸”ä»£ç ä¹Ÿå·®ä¸å¤šï¼Œç™»å½•è¿™æ®µé€»è¾‘å¯ä»¥è¯´æ˜¯å®Œå…¨ç›¸åŒï¼Œä¸è¿‡ä¹‹å‰å°±ä¸€ç›´éƒ½æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚åå¤æŸ¥çœ‹ä¹‹åå‘ç°ï¼Œåœ¨loginçš„ä»£ç æœ‰äº›ä¸åŒ</p>
<p>åœ¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">val authenticate = authenticationManager.authenticate(upToken);</span><br></pre></td></tr></table></figure>

<p>å‰é¢è¿˜æœ‰ä¸€ä¸ª</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‰§è¡ŒUserDetailsServiceçš„loadUserByUsernameéªŒè¯ç”¨æˆ·å</span></span><br><span class="line">userDetailsService.loadUserByUsername(authenticationRequest.getUsername());</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•ä¼šç›´æ¥æŠ›å‡ºUsernameNotFoundExceptionï¼Œè€Œä¸èµ°spring securityçš„AbstractUserDetailsAuthenticationProviderï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¢«è½¬æ¢ä¸ºBadCredentialsExceptionäº†ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸ªç¼ºç‚¹ï¼Œ</p>
<p>å¦‚æœéªŒè¯ç”¨æˆ·åé€šè¿‡ä»¥åï¼Œå†æ¬¡è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">val authenticate = authenticationManager.authenticate(upToken);</span><br></pre></td></tr></table></figure>

<p>è¿˜ä¼šå†æ‰§è¡Œä¸€é</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">userDetailsService.loadUserByUsername(authenticationRequest.getUsername());</span><br></pre></td></tr></table></figure>

<p>è¯¥æ“ä½œæ˜¯å†—ä½™çš„ï¼Œäº§ç”Ÿäº†ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢å·¥ä½œã€‚</p>
<h2 id="æ¨èä½¿ç”¨æ–¹æ¡ˆ1"><a href="#æ¨èä½¿ç”¨æ–¹æ¡ˆ1" class="headerlink" title="æ¨èä½¿ç”¨æ–¹æ¡ˆ1"></a>æ¨èä½¿ç”¨æ–¹æ¡ˆ1</h2>]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring-Security</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringJpa CRUDä»£ç ç”Ÿæˆå™¨</title>
    <url>/p/30009/</url>
    <content><![CDATA[<p>åˆ©ç”¨ä¸šä½™æ—¶é—´æ’¸äº†ä¸€ä¸ªSpring Jpaä»£ç ç”Ÿæˆå™¨<a href="https://github.com/gcdd1993/jpa-codegen">jpa-codegen</a>ã€‚</p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è¿™æ˜¯ä¸€æ¬¾åŸºäº<code>Freemarker</code>æ¨¡æ¿é©±åŠ¨çš„ä»£ç ç”Ÿæˆå™¨ã€‚</p>
<p>ä¾æ®ç°æœ‰çš„å®ä½“ç±»ä»£ç ï¼Œè‡ªåŠ¨ç”ŸæˆCRUDä»£ç ï¼Œè§£æ”¾åŒæ‰‹ï¼ŒåŠ å¿«å¼€å‘é€Ÿåº¦ã€‚</p>
<p>ç”Ÿæˆçš„ä»£ç åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼ˆå¯ä»¥è‡ªå®šä¹‰ç”Ÿæˆæ¨¡å—ï¼‰</p>
<span id="more"></span>

<ul>
<li>Formè¡¨å•ä»£ç </li>
<li>Repositoryä»£ç </li>
<li>Serviceä»£ç </li>
<li>Controllerä»£ç </li>
</ul>
<h1 id="SpringBootä½¿ç”¨ç¤ºä¾‹"><a href="#SpringBootä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="SpringBootä½¿ç”¨ç¤ºä¾‹"></a>SpringBootä½¿ç”¨ç¤ºä¾‹</h1><p>å…‹éš†<a href="https://github.com/gcdd1993/jpa-codegen-sample">ç¤ºä¾‹é¡¹ç›®</a>ï¼Œä½“ä¼šè§£æ”¾åŒæ‰‹çš„ç¾å¦™æ„Ÿå—ï¼</p>
<h1 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h1><h2 id="å¯¼å…¥ä»“åº“"><a href="#å¯¼å…¥ä»“åº“" class="headerlink" title="å¯¼å…¥ä»“åº“"></a>å¯¼å…¥ä»“åº“</h2><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">maven &#123;</span><br><span class="line">    url <span class="string">&#x27;https://dl.bintray.com/gcdd1993/maven&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// jpa code generator</span></span><br><span class="line">    testCompile <span class="string">&#x27;io.github.gcdd1993:jpa-codegen:v1.0.1&#x27;</span></span><br><span class="line">    testCompile <span class="string">&#x27;org.freemarker:freemarker:2.3.28&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®ä»£ç ç”Ÿæˆå™¨"><a href="#é…ç½®ä»£ç ç”Ÿæˆå™¨" class="headerlink" title="é…ç½®ä»£ç ç”Ÿæˆå™¨"></a>é…ç½®ä»£ç ç”Ÿæˆå™¨</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">## ä½œè€…</span></span><br><span class="line"><span class="attr">author</span>=<span class="string">gcdd1993</span></span><br><span class="line"><span class="comment">## ä»£ç æ³¨é‡Š</span></span><br><span class="line"><span class="attr">comments</span>=<span class="string">code generated by jpa-codegen</span></span><br><span class="line"><span class="comment">## æ˜¯å¦è¦†ç›–åŸæ–‡ä»¶ï¼Œé™¤éç‰¹æ®Šæƒ…å†µï¼Œä¸ç„¶è¯·ä¸è¦è¦†ç›–</span></span><br><span class="line"><span class="attr">cover</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">## ä»£ç æ¨¡æ¿ç›®å½•</span></span><br><span class="line"><span class="meta">template.dir</span>=<span class="string">src/test/resources/template/</span></span><br><span class="line"><span class="comment">## å®ä½“ç±»åŒ…å Deprecatedä»v1.0.1å¼€å§‹ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤</span></span><br><span class="line"><span class="meta">-</span> <span class="string">entity.package=com.maxtropy.sample.entity</span></span><br><span class="line"><span class="comment">## å®ä½“ç±»æ ‡è¯†ç¬¦ Deprecatedä»v1.0.1å¼€å§‹ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤</span></span><br><span class="line"><span class="meta">-</span> <span class="string">entity.flag=entity</span></span><br><span class="line"><span class="comment">## ä»¥ä¸‹é…ç½®æ˜¯æ¨¡å—é…ç½®(æ ¼å¼ æ¨¡å—å.é…ç½®å)ï¼Œå¿…é¡»åœ¨æ¨¡æ¿ç›®å½•ä¸‹æä¾›ä¸æ¨¡å—åç›¸åŒçš„æ¨¡æ¿</span></span><br><span class="line"><span class="comment">## ç”Ÿæˆçš„ä»£ç åç¼€</span></span><br><span class="line"><span class="meta">repository.suffix</span>=<span class="string">Repository</span></span><br><span class="line"><span class="comment">## æ¨¡æ¿åç§°</span></span><br><span class="line"><span class="meta">repository.template</span>=<span class="string">repository.ftl</span></span><br><span class="line"><span class="comment">## æ¨¡å—æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="meta">repository.flag</span>=<span class="string">entity.repo</span></span><br><span class="line"></span><br><span class="line"><span class="meta">service.suffix</span>=<span class="string">Service</span></span><br><span class="line"><span class="meta">service.template</span>=<span class="string">service.ftl</span></span><br><span class="line"><span class="meta">service.flag</span>=<span class="string">service</span></span><br><span class="line"><span class="meta">form.suffix</span>=<span class="string">Form</span></span><br><span class="line"><span class="meta">form.template</span>=<span class="string">form.ftl</span></span><br><span class="line"><span class="meta">form.flag</span>=<span class="string">form</span></span><br><span class="line"><span class="meta">controller.suffix</span>=<span class="string">Controller</span></span><br><span class="line"><span class="meta">controller.template</span>=<span class="string">controller.ftl</span></span><br><span class="line"><span class="meta">controller.flag</span>=<span class="string">web</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">repository.suffix</span>=<span class="string">Repository</span></span><br><span class="line"><span class="meta">repository.template</span>=<span class="string">repository.ftl</span></span><br><span class="line"><span class="meta">repository.flag</span>=<span class="string">entity.repo</span></span><br></pre></td></tr></table></figure>

<p>æ˜¯æ¨¡å—é…ç½®ï¼Œ<a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%EF%BC%9F">ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ</a></p>
<h2 id="ç¼–å†™ä»£ç æ¨¡æ¿"><a href="#ç¼–å†™ä»£ç æ¨¡æ¿" class="headerlink" title="ç¼–å†™ä»£ç æ¨¡æ¿"></a>ç¼–å†™ä»£ç æ¨¡æ¿</h2><p>æ¨¡æ¿ä¸»è¦åŸºäº<code>Freemarker</code>ï¼Œå¦‚<code>Spring Boot2.x</code>ä»£ç æ¨¡æ¿å¯ä»¥åƒä¸‹é¢è¿™æ ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;packageName&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> $&#123;entity.packageName&#125;.$&#123;entity.className&#125;;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.querydsl.QuerydslPredicateExecutor;</span><br><span class="line">&lt;#list imports as <span class="keyword">import</span>&gt;</span><br><span class="line"><span class="keyword">import</span> $&#123;<span class="keyword">import</span>&#125;;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * repository for $&#123;entity.className&#125; generated by jpa-codegen</span></span><br><span class="line"><span class="comment"> * $&#123;comments&#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> $&#123;author&#125;</span></span><br><span class="line"><span class="comment"> * Created On $&#123;date&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> $</span>&#123;className&#125; extends JpaRepository&lt;$&#123;entity.className&#125;, $&#123;entity.id.className&#125;&gt;, QuerydslPredicateExecutor&lt;$&#123;entity.className&#125;&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><a href="https://github.com/gcdd1993/jpa-codegen/tree/master/src/main/resources/template/spring2">Spring Boot 2.xæ¨¡æ¿</a></p>
</li>
<li><p><a href="#%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF">å¦‚ä½•ç¼–å†™æ¨¡æ¿?</a></p>
</li>
</ul>
<h2 id="ç¼–å†™ç”Ÿæˆå™¨å…¥å£"><a href="#ç¼–å†™ç”Ÿæˆå™¨å…¥å£" class="headerlink" title="ç¼–å†™ç”Ÿæˆå™¨å…¥å£"></a>ç¼–å†™ç”Ÿæˆå™¨å…¥å£</h2><p>åœ¨testæ¨¡å—ä¸­ç¼–å†™ç”Ÿæˆå™¨å…¥å£ï¼Œå¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Codegen</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> CodeGenerator(<span class="string">&quot;src/test/resources/codegen.properties&quot;</span>)</span><br><span class="line">                .registerRender(<span class="string">&quot;repository&quot;</span>)</span><br><span class="line">                .generate();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œ<code>generate()</code>ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹å°†ä¼šç”Ÿæˆ</p>
<p><img data-src="https://i.imgur.com/WTg4qMx.png" alt="Imgur"></p>
<p><img data-src="https://i.imgur.com/yJJ1d59.png" alt="Imgur"></p>
<p>ç”Ÿæˆçš„ä»£ç å®Œå…¨ç”±æ¨¡æ¿ä»¥åŠå®ä½“ç±»ä¿¡æ¯å†³å®šã€‚</p>
<h1 id="å¦‚ä½•ç¼–å†™æ¨¡æ¿ï¼Ÿ"><a href="#å¦‚ä½•ç¼–å†™æ¨¡æ¿ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç¼–å†™æ¨¡æ¿ï¼Ÿ"></a>å¦‚ä½•ç¼–å†™æ¨¡æ¿ï¼Ÿ</h1><p>æ¨¡æ¿å®Œå…¨åŸºäº<code>FreeMarker</code>ä»¥åŠå®ä½“ç±»ä¿¡æ¯ï¼Œ<code>FreeMarker</code>å‚è€ƒ<a href="https://freemarker.apache.org/docs/index.html">FreeMarker Docs</a></p>
<p>æ”¯æŒçš„å…ƒç´ å®šä¹‰å¦‚ä¸‹</p>
<h2 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h2><table>
<thead>
<tr>
<th>Freemarkerå…ƒç´ </th>
<th>è§£é‡Š</th>
<th>ç¤ºä¾‹è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;ftlName&#125;</code></td>
<td>æ¨¡æ¿åç§°</td>
<td><code>controller.ftl</code></td>
</tr>
<tr>
<td><code>$&#123;ftlPath&#125;</code></td>
<td>æ¨¡æ¿ç›®å½•</td>
<td><code>src/main/resources/template/</code></td>
</tr>
<tr>
<td><code>$&#123;savePath&#125;</code></td>
<td>ä¿å­˜è·¯å¾„</td>
<td><code>src/main/resources/io/github/gcdd1993/controller</code></td>
</tr>
<tr>
<td><code>$&#123;packageName&#125;</code></td>
<td>javaæ–‡ä»¶åŒ…å</td>
<td><code>io.github.gcdd1993.controller</code></td>
</tr>
<tr>
<td><code>$&#123;className&#125;</code></td>
<td>javaæ–‡ä»¶ç±»å</td>
<td><code>UserController</code></td>
</tr>
<tr>
<td><code>$&#123;author&#125;</code></td>
<td>ä½œè€…</td>
<td><code>gaochen</code></td>
</tr>
<tr>
<td><code>$&#123;date&#125;</code></td>
<td>åˆ›å»ºæ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¥æœŸ</td>
<td><code>2019/6/23</code></td>
</tr>
<tr>
<td><code>$&#123;comments&#125;</code></td>
<td>æ³¨é‡Šä¿¡æ¯</td>
<td><code>generated by jpa-codegen</code></td>
</tr>
<tr>
<td><code>$&#123;imports&#125;</code></td>
<td>javaæ–‡ä»¶å¼•å…¥ä¿¡æ¯</td>
<td><code>org.springframework.beans.factory.annotation.Autowired</code></td>
</tr>
</tbody></table>
<h2 id="å®ä½“ä¿¡æ¯"><a href="#å®ä½“ä¿¡æ¯" class="headerlink" title="å®ä½“ä¿¡æ¯"></a>å®ä½“ä¿¡æ¯</h2><table>
<thead>
<tr>
<th>Freemarkerå…ƒç´ </th>
<th>è§£é‡Š</th>
<th>ç¤ºä¾‹è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;entity.className&#125;</code></td>
<td>å®ä½“ç±»åï¼Œ<code>class.getSimpleName()</code></td>
<td>User</td>
</tr>
<tr>
<td><code>$&#123;entity.packageName&#125;</code></td>
<td>å®ä½“åŒ…åï¼Œ<code>class.getPackage().getName()</code></td>
<td>io.github.gcdd1993</td>
</tr>
<tr>
<td><code>$&#123;entity.tableName&#125;</code></td>
<td>å®ä½“è¡¨åï¼Œ<code>@Table(name=&quot;&quot;)</code></td>
<td>sys_user</td>
</tr>
<tr>
<td><code>$&#123;entity.id.className&#125;</code></td>
<td>å®ä½“ä¸»é”®ç±»åï¼Œ<code>@Id</code>æ³¨é‡Šçš„å­—æ®µçš„ç±»å</td>
<td>Integer</td>
</tr>
<tr>
<td><code>$&#123;entity.id.packageName&#125;</code></td>
<td>å®ä½“ä¸»é”®åŒ…åï¼Œ<code>@Id</code>æ³¨é‡Šçš„å­—æ®µçš„åŒ…å</td>
<td>java.lang</td>
</tr>
<tr>
<td><code>$&#123;entity.fields.className&#125;</code></td>
<td>å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰ç±»å</td>
<td>String</td>
</tr>
<tr>
<td><code>$&#123;entity.fields.packageName&#125;</code></td>
<td>å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰åŒ…å</td>
<td>java.lang</td>
</tr>
<tr>
<td><code>$&#123;entity.fields.name&#125;</code></td>
<td>å®ä½“æ‰€æœ‰å­—æ®µï¼ˆåªæ”¯æŒåŸºæœ¬ç±»å‹ï¼‰å±æ€§å</td>
<td>name</td>
</tr>
<tr>
<td><code>$&#123;entity.fields.annotations.className&#125;</code></td>
<td>å®ä½“æ‰€æœ‰å­—æ®µæ³¨è§£çš„ç±»å</td>
<td>Id</td>
</tr>
<tr>
<td><code>$&#123;entity.fields.annotations.packageName&#125;</code></td>
<td>å®ä½“æ‰€æœ‰å­—æ®µæ³¨è§£çš„åŒ…å</td>
<td>javax.persistence</td>
</tr>
</tbody></table>
<h2 id="è‡ªå®šä¹‰é…ç½®"><a href="#è‡ªå®šä¹‰é…ç½®" class="headerlink" title="è‡ªå®šä¹‰é…ç½®"></a>è‡ªå®šä¹‰é…ç½®</h2><p>é™¤äº†ä»¥ä¸Šé»˜è®¤çš„ä¿¡æ¯ä¹‹å¤–ï¼Œå¯èƒ½ä¼šæœ‰é¢å¤–çš„ä¿¡æ¯éœ€è¦å¡«å…¥ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œjpa-codegenæä¾›ç›´æ¥å°†é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®æ¸²æŸ“åˆ°æ¨¡æ¿çš„èƒ½åŠ›ã€‚</p>
<p>ä¾‹å¦‚åœ¨é…ç½®æ–‡ä»¶<code>autogen.properties</code>å†™ä¸‹ä¸€è¡Œ</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">custom.additional.comment</span>=<span class="string">this is additional comment</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨<code>$&#123;otherParams.additional_comment&#125;</code>è·å–åˆ°è¯¥é…ç½®ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼šè‡ªå®šä¹‰é…ç½®<strong>ä½¿ç”¨<code>custom</code>å¼€å¤´</strong>ï¼Œåé¢çš„**é…ç½®ä¼šå°†.æ›¿æ¢ä¸º_**ä½œä¸º<code>FreeMarker</code>æ¨¡æ¿çš„keyï¼Œä¾‹å¦‚ä¸Šè¿°çš„<code>additional.comment</code>ä½¿ç”¨<code>$&#123;otherParams.additional_comment&#125;</code>è·å–ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ</h1><p>ç”±äºä»£ç åƒå˜ä¸‡åŒ–ï¼Œä¸ºäº†å°½å¯èƒ½çš„åšåˆ°é€šç”¨æ€§ï¼Œ<a href="https://github.com/gcdd1993/jpa-codegen">jpa-codegen</a>å°†æ¯ä¸€ç§ç±»å‹çš„ä»£ç æŠ½è±¡ä¸ºæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å°†ä½¿ç”¨å„è‡ªçš„æ¨¡æ¿ï¼Œä¾ç…§å®ä½“ä¿¡æ¯ç”Ÿæˆä»£ç ã€‚</p>
<p>éœ€è¦ä¸ºæ¨¡æ¿é…ç½®ä¸€ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>repository.suffix=Repository</li>
</ul>
<p>æ¨¡å—ç±»ååç¼€ï¼Œç”Ÿæˆçš„ç±»åè§„åˆ™ç”±<strong>å®ä½“ç±»å+åç¼€æ„æˆ</strong></p>
<ul>
<li>repository.template=repository.ftl</li>
</ul>
<p>æ¨¡å—ä½¿ç”¨çš„<code>Freemarker</code>æ¨¡æ¿</p>
<ul>
<li>repository.flag=entity.repo</li>
</ul>
<p>æ¨¡å—æ ‡è¯†ç¬¦ï¼Œç”Ÿæˆçš„ä»£ç åŒ…åç”±<strong>å®ä½“ç±»å°†å®ä½“æ ‡è¯†ç¬¦æ›¿æ¢ä¸ºæ¨¡å—æ ‡è¯†ç¬¦</strong>æ¥ç¡®è®¤ã€‚</p>
<p>å¦‚</p>
<ul>
<li>å®ä½“åŒ…åï¼š<code>io.github.gcdd1993.entity</code></li>
<li>å®ä½“æ ‡è¯†ç¬¦ï¼š<code>entity</code></li>
<li>æ¨¡å—æ ‡è¯†ç¬¦ï¼š<code>entity.repo</code></li>
</ul>
<p>åˆ™ç”Ÿæˆçš„<code>repository</code>ä»£ç åŒ…åä¸º  â€“&gt; <code>io.github.gcdd1993.entity.repo</code></p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Springçš„BeanFactoryå’ŒFactoryBean</title>
    <url>/p/17046/</url>
    <content><![CDATA[<h1 id="å®˜æ–¹å®šä¹‰"><a href="#å®˜æ–¹å®šä¹‰" class="headerlink" title="å®˜æ–¹å®šä¹‰"></a>å®˜æ–¹å®šä¹‰</h1><ul>
<li>BeanFactoryï¼šSpring Beanå®¹å™¨çš„æ ¹æ¥å£</li>
<li>FactoryBeanï¼šå„ä¸ªå¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå¦‚æœbeanå®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå®ƒå°†è¢«ç”¨ä½œå¯¹è±¡çš„å·¥å‚ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½œä¸ºbeanå®ä¾‹ã€‚</li>
</ul>
<span id="more"></span>

<h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><h2 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ ‡æ³¨æ˜¯è·å–FactoryBeançš„å®ç°ç±»ï¼Œè€Œä¸æ˜¯è°ƒç”¨getObject()è·å–çš„å®ä¾‹</span></span><br><span class="line">	String FACTORY_BEAN_PREFIX = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">	<span class="function">Object <span class="title">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">	&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name, Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">	<span class="function">Object <span class="title">getBean</span><span class="params">(String name, Object... args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">	&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">	&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; requiredType, Object... args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">containsBean</span><span class="params">(String name)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isPrototype</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isTypeMatch</span><span class="params">(String name, ResolvableType typeToMatch)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isTypeMatch</span><span class="params">(String name, Class&lt;?&gt; typeToMatch)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">	Class&lt;?&gt; getType(String name) <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line">	String[] getAliases(String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç çš„æ–¹æ³•å®šä¹‰ä¸Šï¼Œå°±å¯ä»¥çœ‹å‡ºï¼Œ<code>BeanFactory</code>ä½œä¸ºbeançš„å®¹å™¨ç®¡ç†å™¨ï¼Œæä¾›äº†ä¸€ç³»åˆ—è·å–beanä»¥åŠè·å–beanå±æ€§çš„æ–¹æ³•ã€‚</p>
<p>å†™ä¸€ä¸ªå°ä¾‹å­è¯•éªŒä¸‹ï¼š</p>
<p>SimpleBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Spring Bean!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Springé…ç½®æ–‡ä»¶config.xmlï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;simpleBean&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;base.SimpleBeanFactoryBean&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">    BeanFactory beanFactory = context.getAutowireCapableBeanFactory();</span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡åç§°è·å–bean&quot;</span>);</span><br><span class="line">    SimpleBean simpleBean = (SimpleBean) beanFactory.getBean(<span class="string">&quot;simpleBean&quot;</span>);</span><br><span class="line">    simpleBean.send();</span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡åç§°å’Œç±»å‹è·å–bean&quot;</span>);</span><br><span class="line">    simpleBean = beanFactory.getBean(<span class="string">&quot;simpleBean&quot;</span>, SimpleBean.class);</span><br><span class="line">    simpleBean.send();</span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡ç±»å‹è·å–bean&quot;</span>);</span><br><span class="line">    simpleBean = beanFactory.getBean(SimpleBean.class);</span><br><span class="line">    simpleBean.send();</span><br><span class="line">    <span class="keyword">boolean</span> containsBean = beanFactory.containsBean(<span class="string">&quot;simpleBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦åŒ…å« simpleBean ? &quot;</span> + containsBean);</span><br><span class="line">    <span class="keyword">boolean</span> singleton = beanFactory.isSingleton(<span class="string">&quot;simpleBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯å•ä¾‹? &quot;</span> + singleton);</span><br><span class="line">    <span class="keyword">boolean</span> match = beanFactory.isTypeMatch(<span class="string">&quot;simpleBean&quot;</span>, ResolvableType.forClass(SimpleBean.class));</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? &quot;</span> + match);</span><br><span class="line">    match = beanFactory.isTypeMatch(<span class="string">&quot;simpleBean&quot;</span>, SimpleBean.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? &quot;</span> + match);</span><br><span class="line">    Class&lt;?&gt; aClass = beanFactory.getType(<span class="string">&quot;simpleBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;simpleBean çš„ç±»å‹æ˜¯ &quot;</span> + aClass.getName());</span><br><span class="line">    String[] aliases = beanFactory.getAliases(<span class="string">&quot;simpleBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;simpleBean çš„åˆ«å : &quot;</span> + Arrays.toString(aliases));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é€šè¿‡åç§°è·å–bean</span><br><span class="line">Hello Spring Bean!</span><br><span class="line">é€šè¿‡åç§°å’Œç±»å‹è·å–bean</span><br><span class="line">Hello Spring Bean!</span><br><span class="line">é€šè¿‡ç±»å‹è·å–bean</span><br><span class="line">Hello Spring Bean!</span><br><span class="line">æ˜¯å¦åŒ…å« simpleBean ? true</span><br><span class="line">æ˜¯å¦æ˜¯å•ä¾‹? true</span><br><span class="line">æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? true</span><br><span class="line">æ˜¯å¦æ˜¯SimpleBeanç±»å‹ ? true</span><br><span class="line">simpleBean çš„ç±»å‹æ˜¯ base.SimpleBean</span><br><span class="line">simpleBean çš„åˆ«å : []</span><br></pre></td></tr></table></figure>

<h2 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FactoryBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸€ä¸ªbeanï¼Œå¦‚æœé…ç½®äº†å·¥å‚beanï¼Œåœ¨getBeançš„æ—¶å€™ï¼Œå°†ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œè·å–ä¸€ä¸ªbean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–beançš„ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯å•ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£æ˜¯æ³›å‹ï¼Œå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­<code>getObject()</code>æ˜¯å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œå°†ä¼šé€šè¿‡æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªbeançš„å®ä¾‹ã€‚</p>
<p>ä¸€ä¸ªå°ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBeanFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">SimpleBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleBean <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFactoryBean getObject&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyFactoryBean getObjectType&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> SimpleBean.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå¯ä»¥ä¿®æ”¹ä¸ºå•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥åšæˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼Œå¯å¡‘æ€§è¾ƒé«˜ã€‚</p>
<p>é…ç½®æ–‡ä»¶config.xml:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;simple&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;base.SimpleBeanFactoryBean&quot;</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªé…ç½®äº†<code>SimpleBeanFactoryBean</code>ï¼Œå¹¶æ²¡æœ‰é…ç½®<code>SimpleBean</code>ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹<code>getBean</code>æ–¹æ³•çš„è¾“å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">SimpleBean simpleBean = context.getBean(SimpleBean.class);</span><br><span class="line">simpleBean.send();</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyFactoryBean getObjectType</span><br><span class="line">MyFactoryBean getObject</span><br><span class="line">Hello Spring Bean!</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡º<code>FactoryBean</code>çš„æ‰§è¡Œæµç¨‹</p>
<ol>
<li>é€šè¿‡<code>getObjectType</code>è·å–beançš„ç±»å‹</li>
<li>è°ƒç”¨<code>getObject</code>æ–¹æ³•è·å–beançš„å®ä¾‹</li>
</ol>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><code>BeanFactory</code>å’Œ<code>FactoryBean</code>å…¶å®æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯åç§°æ¯”è¾ƒåƒè€Œå·²ã€‚</p>
<ul>
<li><code>BeanFactory</code>æ˜¯IOCæœ€åŸºæœ¬çš„å®¹å™¨ï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†beanï¼Œå®ƒä¸ºå…¶ä»–å…·ä½“çš„IOCå®¹å™¨æä¾›äº†æœ€åŸºæœ¬çš„è§„èŒƒã€‚</li>
<li><code>FactoryBean</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå½“åœ¨IOCå®¹å™¨ä¸­çš„Beanå®ç°äº†<code>FactoryBean</code>åï¼Œé€šè¿‡<code>getBean(String BeanName)</code>è·å–åˆ°çš„Beanå¯¹è±¡å¹¶ä¸æ˜¯<code>FactoryBean</code>çš„å®ç°ç±»å¯¹è±¡ï¼Œè€Œæ˜¯è¿™ä¸ªå®ç°ç±»ä¸­çš„<code>getObject()</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚è¦æƒ³è·å–<code>FactoryBean</code>çš„å®ç°ç±»ï¼Œå°±è¦<code>getBean(&amp;BeanName)</code>ï¼Œåœ¨<code>BeanName</code>ä¹‹å‰åŠ ä¸Š&amp;ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu å®‰è£…MongoDB</title>
    <url>/p/49357/</url>
    <content><![CDATA[<p>Ubuntu16.04å®‰è£…MongoDBæŒ‡å—</p>
<span id="more"></span>

<h1 id="ç³»ç»Ÿåˆå§‹åŒ–"><a href="#ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–"></a>ç³»ç»Ÿåˆå§‹åŒ–</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt dist-upgrade</span><br><span class="line">$ sudo apt autoremove</span><br><span class="line">$ sudo apt clean</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…mongodb"><a href="#å®‰è£…mongodb" class="headerlink" title="å®‰è£…mongodb"></a>å®‰è£…mongodb</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install mongodb</span><br></pre></td></tr></table></figure>

<p>mongodbé»˜è®¤æ˜¯ç›‘å¬åœ¨127.0.0.1ç«¯å£çš„ï¼Œè¦å¼€å¯å¤–ç½‘è¿æ¥ï¼Œéœ€è¦ä¿®æ”¹mongodbé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/mongodb.conf</span><br></pre></td></tr></table></figure>

<p><code>bind_ip = 127.0.0.1</code> ä¿®æ”¹ä¸º<code>bind_ip = 0.0.0.0</code></p>
<h1 id="è¿æ¥mongodb"><a href="#è¿æ¥mongodb" class="headerlink" title="è¿æ¥mongodb"></a>è¿æ¥mongodb</h1><p>ä½¿ç”¨å·¥å…·<a href="https://robomongo.org/">robo 3t</a>ï¼Œæ·»åŠ è¿æ¥ä¿¡æ¯</p>
<p><img data-src="https://i.loli.net/2019/03/15/5c8b2c0d28653.png"></p>
<h1 id="å¯ç”¨å¯†ç è®¿é—®"><a href="#å¯ç”¨å¯†ç è®¿é—®" class="headerlink" title="å¯ç”¨å¯†ç è®¿é—®"></a>å¯ç”¨å¯†ç è®¿é—®</h1><p>mongodbé»˜è®¤æ˜¯ä¸å¼€å¯å¯†ç ç™»å½•çš„ï¼Œå¦‚æœè¦å¼€å¯ï¼Œä¿®æ”¹mongodbé…ç½®æ–‡ä»¶ï¼š</p>
<p>å–æ¶ˆ<code>#auth = true</code>å‰é¢çš„æ³¨é‡Šï¼Œå¹¶é‡å¯mongodb<code>service mongodb restart</code></p>
<p>æ·»åŠ ç”¨æˆ·ä¿¡æ¯:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use test_db;</span><br><span class="line">db.createUser(&#123;user:<span class="string">&#x27;cool&#x27;</span>, <span class="built_in">pwd</span>:<span class="string">&#x27;cool&#x27;</span>, roles: [ &#123; role: <span class="string">&quot;readWrite&quot;</span>, db: <span class="string">&quot;test_db&quot;</span> &#125; ]&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h1><p>è¿æ¥æ–¹å¼è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¦æ·»åŠ authenticationï¼ŒæŒ‡å®šdatabaseï¼Œusernameï¼Œpasswordï¼Œä»¥åŠé€‰æ‹©Mongodb-CRéªŒè¯æ–¹å¼<br><img data-src="https://i.loli.net/2019/03/15/5c8b2c0d0f52e.png"></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>NoSql</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>TamperMonkey ä½¿ç”¨æŒ‡å—ä»¥åŠè„šæœ¬æ¨è</title>
    <url>/p/29031/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>Chromeæµè§ˆå™¨æ˜¯æœ€é€‚åˆå¼€å‘è€…ä½¿ç”¨çš„æµè§ˆå™¨ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºChromeå¯¹äºJsçš„å‹å¥½æ”¯æŒï¼Œæ›´æ˜¯ç”±äºChromeæ”¯æŒä¸°å¯Œä¸”åŠŸèƒ½å¼ºå¤§çš„æ’ä»¶ï¼Œæ‰©å±•äº†æµè§ˆå™¨çš„åŠŸèƒ½å’Œä½¿ç”¨ä½“éªŒã€‚</p>
<p>åœ¨è¿™äº›æ’ä»¶é‡Œé¢ï¼Œç›¸ä¿¡ä½ ä¸€å®šä½¿ç”¨è¿‡<a href="https://www.tampermonkey.net/">TamperMonkey</a>ï¼Œä»–å¯ä»¥è®©ä½ åŠ é€Ÿä¸‹è½½ç™¾åº¦ç½‘ç›˜ï¼Œè·Ÿç™¾åº¦é™é€Ÿè¯´æ‹œæ‹œï¼Œä¹Ÿå¯ä»¥è®©ä½ å…è´¹è§‚çœ‹VIPå½±è§†å’ŒéŸ³ä¹ï¼Œåæ­£ä¸€å¥è¯ï¼Œé»‘ç§‘æŠ€ï¼</p>
<span id="more"></span>

<h1 id="TamperMonkeyä½¿ç”¨"><a href="#TamperMonkeyä½¿ç”¨" class="headerlink" title="TamperMonkeyä½¿ç”¨"></a>TamperMonkeyä½¿ç”¨</h1><p>TamperMonkeyçš„å®˜ç½‘æ˜¯ï¼š<a href="https://www.tampermonkey.net,æ”¯æŒå„ç±»chromeå†…æ ¸çš„æµè§ˆå™¨ä»¥åŠç«ç‹æµè§ˆå™¨(firefox)./">https://www.tampermonkey.netï¼Œæ”¯æŒå„ç±»Chromeå†…æ ¸çš„æµè§ˆå™¨ä»¥åŠç«ç‹æµè§ˆå™¨ï¼ˆFireFoxï¼‰ã€‚</a></p>
<div class="note info"><p>ä»¥ä¸‹ä»¥Chromeæµè§ˆå™¨ä¸ºä¾‹ã€‚</p>
</div>

<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®‰è£…éå¸¸ç®€å•ï¼Œæ‰“å¼€<a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=zh-CN">Chromeå•†åº—</a>ï¼Œç‚¹å‡»â€æ·»åŠ åˆ°Chromeâ€</p>
<p><img data-src="https://i.loli.net/2019/10/07/KqbsVxP5To4HdQC.png"></p>
<h2 id="å®‰è£…è„šæœ¬"><a href="#å®‰è£…è„šæœ¬" class="headerlink" title="å®‰è£…è„šæœ¬"></a>å®‰è£…è„šæœ¬</h2><ol>
<li>ç‚¹å‡»â€è·å–æ–°è„šæœ¬â€</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/XLHZqzFdVToacyE.png"></p>
<ol start="2">
<li>é€‰æ‹©åˆé€‚çš„è„šæœ¬æºï¼Œè¿™é‡Œæ¨èGreasyFork</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/gkvSFHfrldBV5pD.png"></p>
<ol start="3">
<li>å®‰è£…è„šæœ¬ï¼Œä»¥VIPè§†é¢‘è§£æä¸ºä¾‹</li>
</ol>
<p><img data-src="https://i.loli.net/2019/10/07/yMhfdDBZJegvxE1.png"></p>
<p>æˆ‘ä»¬ç‚¹å‡»ç¬¬ä¸€ä¸ªè„šæœ¬ï¼ˆæœ‰æ—¶å€™ä¼šæ¯”è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ä¸‹ï¼‰ï¼Œç‚¹å‡»â€å®‰è£…æ­¤è„šæœ¬â€</p>
<p><img data-src="https://i.loli.net/2019/10/07/z9NQ21heM4YXJpT.png"></p>
<p>ç‚¹å‡»å®‰è£…</p>
<p><img data-src="https://i.loli.net/2019/10/07/Ffz6a1P7YehwcsS.png"></p>
<p>ä¸‹é¢å¯ä»¥ç›´æ¥çœ‹åˆ°è„šæœ¬çš„æºç ï¼Œæœ‰èƒ½åŠ›çš„è¯ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹æˆ–è€…ç¼–å†™è„šæœ¬ã€‚</p>
<ol start="4">
<li>çœ‹çœ‹è„šæœ¬çš„æ•ˆæœ</li>
</ol>
<p>æˆ‘ä»¬æ‰“å¼€çˆ±å¥‡è‰ºï¼Œæ‰¾ä¸ªvipç”µå½±ï¼Œæ¯”å¦‚æœ€è¿‘çƒ­æ’­çš„é“¶æ²³è¡¥ä¹ ç­</p>
<p><img data-src="https://i.loli.net/2019/10/07/bmUQz5aGqKrCu3L.png"></p>
<p><img data-src="https://i.loli.net/2019/10/07/Mqw8XZ1WeOpnYRA.png"></p>
<h1 id="TamperMonkeyè„šæœ¬æ¨è"><a href="#TamperMonkeyè„šæœ¬æ¨è" class="headerlink" title="TamperMonkeyè„šæœ¬æ¨è"></a>TamperMonkeyè„šæœ¬æ¨è</h1><p>åœ¨TamperMonkeyçš„ç®¡ç†é¢æ¿ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…çš„æ‰€æœ‰è„šæœ¬</p>
<p><img data-src="https://i.loli.net/2019/10/07/ctFHYj9ERJTg4eu.png"></p>
<p>ä¸‹é¢åˆ—ä¸¾å‡ºæˆ‘å¸¸ç”¨çš„è„šæœ¬</p>
<ul>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/373956-52pojie%E5%90%BE%E7%88%B1%E7%A0%B4%E8%A7%A3%E8%AE%BA%E5%9D%9B%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0%E5%8A%A9%E6%89%8B-%E5%85%8D%E6%89%93%E6%89%B0">52pojieå¾çˆ±ç ´è§£è®ºå›è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹-å…æ‰“æ‰°</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/30117-%E5%90%BE%E7%88%B1%E7%A0%B4%E8%A7%A3%E8%AE%BA%E5%9D%9B-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E9%93%BE%E6%8E%A5%E6%BF%80%E6%B4%BB-%E6%8F%90%E5%8F%96%E7%A0%81%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8">å¾çˆ±ç ´è§£è®ºå›-ç™¾åº¦ç½‘ç›˜é“¾æ¥æ¿€æ´»-æå–ç è‡ªåŠ¨è¡¥å…¨</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2-%E5%8E%BB%E5%B9%BF%E5%91%8A-favicon-%E5%8F%8C%E5%88%97">ac-baidu-é‡å®šå‘ä¼˜åŒ–ç™¾åº¦æœç‹—è°·æ­Œæœç´¢-å»å¹¿å‘Š-favicon-åŒåˆ—</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/368418-ac-baidu-%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6-%E6%90%9C%E7%8B%97-%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E4%B9%8B%E5%85%B3%E9%94%AE%E8%AF%8D%E8%87%AA%E5%8A%A8%E9%AB%98%E4%BA%AE">ac-baidu-ä¼˜åŒ–ç™¾åº¦-æœç‹—-è°·æ­Œæœç´¢ç»“æœä¹‹å…³é”®è¯è‡ªåŠ¨é«˜äº®</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/372452-csdn%E8%87%AA%E5%8A%A8%E5%B1%95%E5%BC%80-%E5%8E%BB%E5%B9%BF%E5%91%8A-%E5%87%80%E5%8C%96%E5%89%AA%E8%B4%B4%E6%9D%BF-%E5%85%8D%E7%99%BB%E9%99%86">csdnè‡ªåŠ¨å±•å¼€-å»å¹¿å‘Š-å‡€åŒ–å‰ªè´´æ¿-å…ç™»é™†</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/384538-%E4%B8%80%E9%94%AEvip%E8%A7%86%E9%A2%91%E8%A7%A3%E6%9E%90-%E5%8E%BB%E5%B9%BF%E5%91%8A-%E5%85%A8%E7%BD%91-%E4%B8%80%E7%AB%99%E5%BC%8F%E9%9F%B3%E4%B9%90%E6%90%9C%E7%B4%A2%E4%B8%8B%E8%BD%BD-%E7%99%BE%E5%BA%A6%E4%BA%91%E7%A6%BB%E7%BA%BF%E8%B7%B3%E8%BD%AC-%E8%8E%B7%E5%8F%96b%E7%AB%99%E5%B0%81%E9%9D%A2-%E6%B7%98%E5%AE%9D%E4%BA%AC%E4%B8%9C%E4%BC%98%E6%83%A0%E5%88%B8-2019-10-01-%E6%9B%B4%E6%96%B0-%E6%8A%A5%E9%94%99%E8%AF%B7%E5%8F%8A%E6%97%B6%E5%8F%8D%E9%A6%88">ä¸€é”®vipè§†é¢‘è§£æ-å»å¹¿å‘Š-å…¨ç½‘-ä¸€ç«™å¼éŸ³ä¹æœç´¢ä¸‹è½½-ç™¾åº¦äº‘ç¦»çº¿è·³è½¬-è·å–bç«™å°é¢-æ·˜å®äº¬ä¸œä¼˜æƒ åˆ¸-2019-10-01-æ›´æ–°-æŠ¥é”™è¯·åŠæ—¶åé¦ˆ</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/387360-%E5%9F%8E%E9%80%9A%E7%BD%91%E7%9B%98-%E7%9A%AE%E7%9A%AE%E7%9B%98-%E7%89%9B%E7%9B%98%E6%98%BE%E7%A4%BA%E6%AD%A3%E7%A1%AE%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80">åŸé€šç½‘ç›˜-çš®çš®ç›˜-ç‰›ç›˜æ˜¾ç¤ºæ­£ç¡®ä¸‹è½½åœ°å€</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/379893-%E7%99%BE%E5%BA%A6%E6%96%87%E5%BA%93%E6%96%87%E6%A1%A3%E5%85%8D%E8%B4%B9%E4%B8%8B%E8%BD%BD-%E5%8E%9F%E6%96%87%E6%A1%A3-%E8%BD%AC%E6%8D%A2%E6%8F%90%E5%8F%96%E6%96%87%E6%A1%A3-%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9%E8%87%AA%E7%94%B1%E5%A4%8D%E5%88%B6-%E7%A7%BB%E9%99%A4%E5%B9%BF%E5%91%8A-%E8%B1%86%E4%B8%81%E7%BD%91%E6%96%87%E6%A1%A3%E4%B8%8B%E8%BD%BD-%E8%A7%A3%E9%99%A4%E5%A4%A7%E9%83%A8%E5%88%86%E7%BD%91%E7%AB%99%E6%93%8D%E4%BD%9C%E9%99%90%E5%88%B6-%E5%85%A8%E7%BD%91vip%E8%A7%86%E9%A2%91%E5%85%8D%E8%B4%B9%E5%9C%A8%E7%BA%BF%E7%9C%8B-%E6%94%AF%E6%8C%81%E7%94%B5%E8%A7%86%E5%89%A7%E5%85%8D%E8%B7%B3%E5%87%BA%E9%80%89%E9%9B%86">ç™¾åº¦æ–‡åº“æ–‡æ¡£å…è´¹ä¸‹è½½-åŸæ–‡æ¡£-è½¬æ¢æå–æ–‡æ¡£-æ–‡æ¡£å†…å®¹è‡ªç”±å¤åˆ¶-ç§»é™¤å¹¿å‘Š-è±†ä¸ç½‘æ–‡æ¡£ä¸‹è½½-è§£é™¤å¤§éƒ¨åˆ†ç½‘ç«™æ“ä½œé™åˆ¶-å…¨ç½‘vipè§†é¢‘å…è´¹åœ¨çº¿çœ‹-æ”¯æŒç”µè§†å‰§å…è·³å‡ºé€‰é›†</a></p>
</li>
<li><p><a href="https://github.com/syhyz1990/baiduyun">ç™¾åº¦ç½‘ç›˜ç›´é“¾ä¸‹è½½åŠ©æ‰‹</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/384172-%E7%9F%A5%E4%B9%8E%E7%BD%91%E9%A1%B5%E5%8A%A9%E6%89%8B-5%E5%A4%A7%E5%8A%9F%E8%83%BD%E9%9B%86%E4%BA%8E%E4%B8%80%E8%BA%AB">çŸ¥ä¹ç½‘é¡µåŠ©æ‰‹-5å¤§åŠŸèƒ½é›†äºä¸€èº«</a></p>
</li>
<li><p><a href="https://greasyfork.org/zh-CN/scripts/26992-%E8%B4%B4%E5%90%A7%E5%85%A8%E8%83%BD%E5%8A%A9%E6%89%8B">è´´å§å…¨èƒ½åŠ©æ‰‹</a></p>
</li>
</ul>
<h1 id="TamperMonkeyè„šæœ¬åŒæ­¥"><a href="#TamperMonkeyè„šæœ¬åŒæ­¥" class="headerlink" title="TamperMonkeyè„šæœ¬åŒæ­¥"></a>TamperMonkeyè„šæœ¬åŒæ­¥</h1><p>TamperMonkeyæä¾›äº†éå¸¸æ–¹ä¾¿çš„æ–¹æ³•è®©æˆ‘ä»¬åŒæ­¥è„šæœ¬ï¼Œä»è€Œé¿å…æ¯æ¬¡å®‰è£…éƒ½è¦é‡æ–°å®‰è£…è„šæœ¬çš„çƒ¦æ¼ã€‚</p>
<p><img data-src="https://i.loli.net/2019/10/07/yRtBhKbsLzGdTXP.png"></p>
<ol>
<li>è¿›å…¥TamperMonkeyæ’ä»¶è®¾ç½®é¡µ</li>
<li>é…ç½®æ¨¡å¼é€‰æ‹©â€åˆå­¦è€…â€</li>
<li>å‹¾é€‰â€å¯ç”¨ TESLAâ€ï¼Œç±»å‹é€‰æ‹©â€æµè§ˆå™¨åŒæ­¥â€</li>
<li>ç‚¹å‡»ä¿å­˜</li>
</ol>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu æ­å»ºphpcms</title>
    <url>/p/5357/</url>
    <content><![CDATA[<h1 id="å®‰è£…Apache2"><a href="#å®‰è£…Apache2" class="headerlink" title="å®‰è£…Apache2"></a>å®‰è£…Apache2</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update -y</span><br><span class="line">$ sudo apt-get install apache2 -y</span><br><span class="line">$ sudo systemctl start apache2.service</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install mysql-server -y</span><br><span class="line">$ sudo /usr/bin/mysql_secure_installation</span><br><span class="line"><span class="comment">## éƒ½é€‰yå°±è¡Œ</span></span><br><span class="line">$ mysql -u root -p </span><br><span class="line">mysql&gt; CREATE DATABASE js_website;</span><br><span class="line"><span class="comment">## å¯¼å…¥æ•°æ®</span></span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/jskj.sql;</span><br><span class="line">mysql&gt; \q;</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…PHP"><a href="#å®‰è£…PHP" class="headerlink" title="å®‰è£…PHP"></a>å®‰è£…PHP</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install php -y;</span><br><span class="line">$ sudo apt-get install -y php-&#123;bcmath,bz2,intl,gd,mbstring,mcrypt,mysql,zip&#125; &amp;&amp; sudo apt-get install libapache2-mod-php -y;</span><br></pre></td></tr></table></figure>

<h1 id="éƒ¨ç½²PHPå®˜ç½‘"><a href="#éƒ¨ç½²PHPå®˜ç½‘" class="headerlink" title="éƒ¨ç½²PHPå®˜ç½‘"></a>éƒ¨ç½²PHPå®˜ç½‘</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir /var/www/html/phpcms</span><br><span class="line">$ <span class="built_in">cd</span> /var/www/html/phpcms</span><br><span class="line"><span class="comment"># ä¸Šä¼ phpcms.zipåŒ…è‡³æ­¤ç›®å½•</span></span><br><span class="line">$ unzip phpcms.zip</span><br><span class="line">$ ls -l</span><br><span class="line">drwxr-xr-x 11 root root      4096 Jun 24 17:21 ./</span><br><span class="line">drwxr-xr-x  3 root root      4096 Jun 24 17:21 ../</span><br><span class="line">-rw-r--r--  1 root root        48 Jun 24 15:53 admin.php</span><br><span class="line">drwxr-xr-x  3 root root      4096 Jun 24 15:53 api/</span><br><span class="line">-rw-r--r--  1 root root       991 Jun 24 15:53 api.php</span><br><span class="line">drwxr-xr-x 18 root root      4096 Jun 24 15:53 caches/</span><br><span class="line">-rw-r--r--  1 root root       104 Jun 24 15:53 crossdomain.xml</span><br><span class="line">drwxr-xr-x  6 root root      4096 Jun 24 15:53 custom/</span><br><span class="line">-rw-r--r--  1 root root      3158 Jun 24 15:53 favicon.ico</span><br><span class="line">drwxr-xr-x  2 root root      4096 Jun 24 15:53 html/</span><br><span class="line">-rw-r--r--  1 root root      4444 Jun 24 15:53 index.htm</span><br><span class="line">-rw-r--r--  1 root root     22758 Jun 24 15:53 index.html</span><br><span class="line">-rw-r--r--  1 root root       318 Jun 24 15:53 index.php</span><br><span class="line">-rw-r--r--  1 root root       523 Jun 24 15:53 js.html</span><br><span class="line">drwxr-xr-x  8 root root      4096 Jun 24 15:53 mes/</span><br><span class="line">drwxr-xr-x  8 root root      4096 Jun 24 15:53 phpcms/</span><br><span class="line">-rw-r--r--  1 root root 168191200 Jun 24 16:38 phpcms.zip</span><br><span class="line">drwxr-xr-x  7 root root      4096 Jun 24 15:53 phpsso_server/</span><br><span class="line">-rw-r--r--  1 root root      3621 Jun 24 15:53 plugin.php</span><br><span class="line">-rw-r--r--  1 root root       170 Jun 24 15:53 robots.txt</span><br><span class="line">drwxr-xr-x  6 root root      4096 Jun 24 15:53 statics/</span><br><span class="line">drwxr-xr-x  4 root root      4096 Jun 24 15:53 uploadfile/</span><br></pre></td></tr></table></figure>

<p>ğŸ‘‰è¿™é‡Œçš„zipå‹ç¼©åŒ…ï¼Œæ˜¯å·²ç»installåçš„phpcmsï¼Œå› ä¸ºé¡¹ç›®ç»ç†ç»™æˆ‘çš„å°±æ˜¯å®‰è£…å¥½çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨äº†ã€‚</p>
<p>åæ­£åŸç†éƒ½ä¸€æ ·ï¼Œé…ç½®Apacheè§£æåŸŸåæŒ‡å‘è·¯å¾„å°±è¡Œã€‚</p>
<h2 id="é…ç½®Apache"><a href="#é…ç½®Apache" class="headerlink" title="é…ç½®Apache"></a>é…ç½®Apache</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/phpcms.conf</span><br><span class="line">$ cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/phpcms-mes.conf</span><br><span class="line">$ ln -s /etc/apache2/sites-available/phpcms.conf /etc/apache2/sites-enabled/phpcms.conf</span><br><span class="line">$ ln -s /etc/apache2/sites-available/phpcms-mes.conf /etc/apache2/sites-enabled/phpcms-mes.conf</span><br><span class="line">$ vim /etc/apache2/sites-available/phpcms.conf</span><br><span class="line">ServerName js.dbpe-cps.com</span><br><span class="line"><span class="comment"># ServerAdmin webmaster@localhost</span></span><br><span class="line">DocumentRoot /var/www/html/phpcms</span><br><span class="line">$ vim /etc/apache2/sites-available/phpcms-mes.conf</span><br><span class="line">ServerName mes.js.dbpe-cps.com</span><br><span class="line"><span class="comment"># ServerAdmin webmaster@localhost</span></span><br><span class="line">DocumentRoot /var/www/html/phpcms/mes</span><br><span class="line"></span><br><span class="line">$ service apache2 restart</span><br></pre></td></tr></table></figure>

<h1 id="åŸŸåè§£æ"><a href="#åŸŸåè§£æ" class="headerlink" title="åŸŸåè§£æ"></a>åŸŸåè§£æ</h1><p>é…ç½®ä½ çš„åŸŸåæŒ‡å‘ä½ çš„æœåŠ¡å™¨å°±è¡Œã€‚è¿™é‡Œç•¥è¿‡ã€‚</p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="Apacheå¸¸ç”¨å‘½ä»¤"><a href="#Apacheå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Apacheå¸¸ç”¨å‘½ä»¤"></a>Apacheå¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## é‡å¯Apache2</span></span><br><span class="line">$ service apache2 restart </span><br><span class="line">$ service apache2 status</span><br><span class="line">$ service apache2 start</span><br></pre></td></tr></table></figure>

<h2 id="Apacheç›®å½•"><a href="#Apacheç›®å½•" class="headerlink" title="Apacheç›®å½•"></a>Apacheç›®å½•</h2><ul>
<li>é…ç½®ç›®å½•ï¼š<code>/etc/apache2</code></li>
<li>é»˜è®¤wwwç›®å½•ï¼š<code>/var/www/html</code></li>
</ul>
<p>è¿™ä¸€ç‚¹è·Ÿå…¶ä»–çš„ä¸ä¸€æ ·ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹åˆ°é…ç½®æ–‡ä»¶æ‰çŸ¥é“æ˜¯è¿™ä¸ªç›®å½•çš„</p>
<p><img data-src="https://i.loli.net/2019/06/24/5d109f0e7b96224648.png"></p>
<p>/etc/apache2/apache2.conf</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>phpcms</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuåˆ‡æ¢ä¸ºé˜¿é‡Œé•œåƒæº</title>
    <url>/p/12805/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨VMè™šæ‹Ÿæœºæ­å»ºUbuntuç³»ç»Ÿå­¦ä¹ æˆ–è€…æµ‹è¯•æ—¶ï¼Œå¸¸å¸¸è¦ä½¿ç”¨<code>apt</code>å®‰è£…æµ‹è¯•ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè‡ªå¸¦çš„ä¸‹è½½æºåœ¨å›½å¤–æœåŠ¡å™¨ä¸Šï¼Œä¸‹è½½é€Ÿåº¦æ…¢çš„æ— æ³•å¿å—ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ‡æ¢ä¸ºå›½å†…é•œåƒæºï¼Œèƒ½æ˜¾è‘—åŠ å¿«å®‰è£…åŒ…ä¸‹è½½é€Ÿåº¦ã€‚</p>
<span id="more"></span>

<h1 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /etc/apt/</span><br><span class="line">$ cp sources.list sources.list.bak <span class="comment">## å¤‡ä»½ç³»ç»Ÿè‡ªå¸¦çš„sourceåˆ—è¡¨</span></span><br><span class="line"><span class="comment">## é€‰æ‹©åˆé€‚çš„é•œåƒæºï¼Œå¦‚é˜¿é‡Œäº‘çš„é•œåƒ http://mirrors.aliyun.com/ubuntu</span></span><br><span class="line">$ sed -i <span class="string">&#x27;s/^\(deb\|deb-src\) \([^ ]*\) \(.*\)/\1 http:\/\/mirrors.aliyun.com\/ubuntu \3/&#x27;</span> sources.list</span><br><span class="line"><span class="comment">## æ›´æ–°apt</span></span><br><span class="line">$ apt-get update</span><br></pre></td></tr></table></figure>

<h1 id="å›½å†…é•œåƒæº"><a href="#å›½å†…é•œåƒæº" class="headerlink" title="å›½å†…é•œåƒæº"></a>å›½å†…é•œåƒæº</h1><table>
<thead>
<tr>
<th>åç§°</th>
<th>åœ°å€</th>
</tr>
</thead>
<tbody><tr>
<td>é˜¿é‡Œé•œåƒæº</td>
<td><a href="http://mirrors.aliyun.com/ubuntu">http://mirrors.aliyun.com/ubuntu</a></td>
</tr>
<tr>
<td>æ¸…åå¤§å­¦é•œåƒæº</td>
<td><a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a></td>
</tr>
<tr>
<td>ç½‘æ˜“é•œåƒæº</td>
<td><a href="https://mirrors.163.com/ubuntu/">https://mirrors.163.com/ubuntu/</a></td>
</tr>
<tr>
<td>ä¸œåŒ—å¤§å­¦é•œåƒæº</td>
<td><a href="http://mirror.neu.edu.cn/ubuntu/">http://mirror.neu.edu.cn/ubuntu/</a></td>
</tr>
</tbody></table>
<p>è‡³äºå“ªä¸ªæºæ¯”è¾ƒå¿«ï¼Œçœ‹ä¸ªäººçš„ç½‘ç»œå§ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•ä¸‹ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯é˜¿é‡Œé•œåƒæºã€‚</p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuç¦ç”¨rootè´¦å·ï¼Œå¼€å¯Ubuntuå¯†é’¥ç™»å½•</title>
    <url>/p/46186/</url>
    <content><![CDATA[<h1 id="æ–°å»ºæ™®é€šç”¨æˆ·"><a href="#æ–°å»ºæ™®é€šç”¨æˆ·" class="headerlink" title="æ–°å»ºæ™®é€šç”¨æˆ·"></a>æ–°å»ºæ™®é€šç”¨æˆ·</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## æ–°å»ºæ™®é€šç”¨æˆ·</span></span><br><span class="line">$ adduser ubuntu</span><br><span class="line">$ apt-get install sudo</span><br><span class="line"><span class="comment">## å°†ç”¨æˆ·åŠ å…¥sudoç»„</span></span><br><span class="line">$ usermod -a -G sudo ubuntu</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ å…¬é’¥"><a href="#ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ å…¬é’¥" class="headerlink" title="ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ å…¬é’¥"></a>ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ å…¬é’¥</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ su ubuntu</span><br><span class="line">$ mkdir -p ~/.ssh</span><br><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line"><span class="comment">## æ·»åŠ å…¬é’¥</span></span><br><span class="line">$ touch authorized_keys</span><br><span class="line">$ cat <span class="string">&#x27;ä½ çš„å…¬é’¥å­—ç¬¦ä¸²&#x27;</span> &gt;&gt; authorized_keys</span><br><span class="line"></span><br><span class="line">$ chmod 600 authorized_keys</span><br><span class="line">$ chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure>

<h1 id="è®¾ç½®-SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•"><a href="#è®¾ç½®-SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•" class="headerlink" title="è®¾ç½® SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•"></a>è®¾ç½® SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/ssh/sshd_config</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¦ç”¨rootè´¦å·ç™»å½•</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"><span class="comment">## ç¦ç”¨å¯†ç ç™»å½•</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line">$ service sshd restart</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuéƒ¨ç½²docker</title>
    <url>/p/42583/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»åœ¨<code>Ubuntu</code>ä¸Šéƒ¨ç½²docker</p>
<span id="more"></span>

<h1 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common &amp;&amp; curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - &amp;&amp; sudo apt-key fingerprint 0EBFCD88 &amp;&amp; sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> &amp;&amp; sudo apt-get update &amp;&amp; sudo apt-get -y install docker-ce docker-ce-cli containerd.io &amp;&amp; sudo docker --version</span><br><span class="line">...</span><br><span class="line">Docker version 19.03.12, build 48a66213fe</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a>å®‰è£…docker-compose</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.91chifun.workers.dev/https://github.com//docker/compose/releases/download/1.29.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose &amp;&amp; sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose &amp;&amp; docker-compose --version</span><br><span class="line">...</span><br><span class="line">docker-compose version 1.26.2, build eefe0d31</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®docker"><a href="#é…ç½®docker" class="headerlink" title="é…ç½®docker"></a>é…ç½®docker</h1><blockquote>
<p>å¯é€‰ï¼Œä½†æ˜¯ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒç­‰å› ç´ ï¼Œè¿˜æ˜¯å»ºè®®åšä¸€ä¸‹é…ç½®</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data-root&quot;</span>: <span class="string">&quot;/data/docker&quot;</span>, // å°†dockeré•œåƒç­‰å†…å®¹ç§»åŠ¨åˆ°æ•°æ®ç›˜ï¼Œæ³¨æ„ï¼šä¹‹å‰å¦‚æœæœ‰å¯åŠ¨è¿‡çš„å®¹å™¨ï¼Œæˆ–è€…æ‹‰å–çš„é•œåƒï¼Œä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå°†ä¼šå¤±æ•ˆï¼Œè°¨æ…ä¿®æ”¹</span><br><span class="line">    <span class="string">&quot;log-driver&quot;</span>:<span class="string">&quot;json-file&quot;</span>, // è®¾ç½®<span class="built_in">log</span>æ–‡ä»¶æ ¼å¼</span><br><span class="line">    <span class="string">&quot;log-opts&quot;</span>:&#123; // è®¾ç½®<span class="built_in">log</span>æ–‡ä»¶</span><br><span class="line">        <span class="string">&quot;max-size&quot;</span>:<span class="string">&quot;10m&quot;</span>,</span><br><span class="line">        <span class="string">&quot;max-file&quot;</span>:<span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;labels&quot;</span>:<span class="string">&quot;production_status&quot;</span>,</span><br><span class="line">        <span class="string">&quot;env&quot;</span>:<span class="string">&quot;os,customer&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;insecure-registries&quot;</span>:[ </span><br><span class="line">        <span class="string">&quot;registryhost:5000&quot;</span>,</span><br><span class="line">        <span class="string">&quot;10.0.0.0/8&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>:[ // é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</span><br><span class="line">        <span class="string">&quot;https://mubkcb81.mirror.aliyuncs.com&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®dockerå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ul>
<li><a href="https://docs.docker.com/engine/install/centos/">CentOS</a></li>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">Ubuntu</a></li>
<li><a href="https://docs.docker.com/engine/install/debian/">Debian</a></li>
<li><a href="https://docs.docker.com/engine/install/fedora/">Fedora</a></li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>é»˜è®¤</tag>
      </tags>
  </entry>
  <entry>
    <title>Postmanä½¿ç”¨æŠ€å·§</title>
    <url>/p/4537/</url>
    <content><![CDATA[<h1 id="Postmanæ˜¯ä»€ä¹ˆ"><a href="#Postmanæ˜¯ä»€ä¹ˆ" class="headerlink" title="Postmanæ˜¯ä»€ä¹ˆ"></a>Postmanæ˜¯ä»€ä¹ˆ</h1><p>Postmanæ˜¯chromeçš„ä¸€æ¬¾æ’ä»¶,ç”¨äºåšæ¥å£è¯·æ±‚æµ‹è¯•,æ— è®ºæ˜¯å‰ç«¯,åå°è¿˜æ˜¯æµ‹è¯•äººå‘˜,éƒ½å¯ä»¥ç”¨postmanæ¥æµ‹è¯•æ¥å£,ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚<span id="more"></span></p>
<h1 id="Postmanå®‰è£…"><a href="#Postmanå®‰è£…" class="headerlink" title="Postmanå®‰è£…"></a>Postmanå®‰è£…</h1><h2 id="å®˜ç½‘ä¸‹è½½-ç¿»å¢™"><a href="#å®˜ç½‘ä¸‹è½½-ç¿»å¢™" class="headerlink" title="å®˜ç½‘ä¸‹è½½(ç¿»å¢™)"></a>å®˜ç½‘ä¸‹è½½(ç¿»å¢™)</h2><p><a href="https://www.getpostman.com/downloads/">https://www.getpostman.com/downloads/</a></p>
<h2 id="è“å¥äº‘"><a href="#è“å¥äº‘" class="headerlink" title="è“å¥äº‘"></a>è“å¥äº‘</h2><p><a href="https://www.lanzous.com/i2en5xc">https://www.lanzous.com/i2en5xc</a></p>
<h1 id="Postmanå¸¸ç”¨åŠŸèƒ½"><a href="#Postmanå¸¸ç”¨åŠŸèƒ½" class="headerlink" title="Postmanå¸¸ç”¨åŠŸèƒ½"></a>Postmanå¸¸ç”¨åŠŸèƒ½</h1><p>å®‰è£…å¥½ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€Postmanï¼Œå¯ä»¥çœ‹åˆ°ç•Œé¢åˆ†æˆå·¦å³ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³è¾¹æ˜¯æˆ‘ä»¬åå¤´è¦è®²çš„collectionï¼Œå·¦è¾¹æ˜¯ç°åœ¨è¦è®²çš„request builderã€‚åœ¨request builderä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Postmanå¿«é€Ÿçš„éšæ„ç»„è£…å‡ºæˆ‘ä»¬å¸Œæœ›çš„requestã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€æœ‰çš„HTTP Requestéƒ½åˆ†æˆ4ä¸ªéƒ¨åˆ†ï¼ŒURL, method, headerså’Œbodyã€‚è€ŒPostmané’ˆå¯¹è¿™å‡ éƒ¨åˆ†éƒ½æœ‰é’ˆå¯¹æ€§çš„å·¥å…·ã€‚</p>
<p><img data-src="https://i.imgur.com/JHqfDbU.png"></p>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>è¦ç»„è£…ä¸€æ¡Request, URLæ°¸è¿œæ˜¯ä½ é¦–å…ˆè¦å¡«çš„å†…å®¹ï¼Œåœ¨Postmané‡Œé¢ä½ æ›¾è¾“å…¥è¿‡çš„URLæ˜¯å¯ä»¥é€šè¿‡ä¸‹æ‹‰è‡ªåŠ¨è¡¥å…¨çš„å“¦ã€‚å¦‚æœä½ ç‚¹å‡»ParamsæŒ‰é’®ï¼ŒPostmanä¼šå¼¹å‡ºä¸€ä¸ªé”®å€¼ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥åœ¨å“ªé‡Œè¾“å…¥URLçš„Parameterï¼ŒPostmanä¼šå¸®ä½ è‡ªåŠ¨åŠ å…¥åˆ°URLå½“ä¸­ï¼Œåä¹‹ï¼Œå¦‚æœä½ çš„URLå½“ä¸­å·²ç»æœ‰äº†å‚æ•°ï¼Œé‚£Postmanä¼šåœ¨ä½ æ‰“å¼€é”®å€¼ç¼–è¾‘å™¨çš„æ—¶å€™æŠŠå‚æ•°è‡ªåŠ¨è½½å…¥</p>
<p><img data-src="https://i.imgur.com/OyiHdls.png"></p>
<h2 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h2><p>ç‚¹å‡»â€™Headersâ€™æŒ‰é’®ï¼ŒPostmanåŒæ ·ä¼šå¼¹å‡ºä¸€ä¸ªé”®å€¼ç¼–è¾‘å™¨ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥éšæ„æ·»åŠ ä½ æƒ³è¦çš„Header attributeï¼ŒåŒæ ·Postmanä¸ºæˆ‘ä»¬é€šè¿‡äº†å¾ˆè´´å¿ƒçš„auto-completeåŠŸèƒ½ï¼Œæ•²å…¥ä¸€ä¸ªå­—æ¯ï¼Œä½ å¯ä»¥ä»ä¸‹æ‹‰èœå•é‡Œé€‰æ‹©ä½ æƒ³è¦çš„æ ‡å‡†atrribute</p>
<p><img data-src="https://i.imgur.com/N0KHlcZ.png"></p>
<h2 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h2><p>è¦é€‰æ‹©Requestçš„Methodæ˜¯å¾ˆç®€å•çš„ï¼ŒPostmanæ”¯æŒæ‰€æœ‰çš„Methodï¼Œè€Œä¸€æ—¦ä½ é€‰æ‹©äº†Methodï¼ŒPostmançš„request bodyç¼–è¾‘å™¨ä¼šæ ¹æ®çš„ä½ é€‰æ‹©ï¼Œè‡ªåŠ¨çš„å‘ç”Ÿæ”¹å˜ã€‚</p>
<p><img data-src="https://i.imgur.com/vJl711X.png"></p>
<h2 id="Request-Body"><a href="#Request-Body" class="headerlink" title="Request Body"></a>Request Body</h2><p>å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºçš„requestæ˜¯ç±»ä¼¼äºPOSTï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç¼–è¾‘Request Bodyï¼ŒPostmanæ ¹æ®body typeçš„ä¸åŒï¼Œæä¾›äº†4ä¸­ç¼–è¾‘æ–¹å¼ï¼š</p>
<ul>
<li>form-data</li>
<li>x-www-form-urlencoded</li>
<li>raw</li>
<li>binary</li>
</ul>
<p><img data-src="https://i.imgur.com/dgaY012.png"></p>
<p>ï¼ˆæˆ‘ä»¬è¿™é‡Œæ˜¯å¯ä»¥ä¼ æ–‡ä»¶çš„å“¦ï¼‰</p>
<h1 id="postmané«˜çº§ç”¨æ³•"><a href="#postmané«˜çº§ç”¨æ³•" class="headerlink" title="postmané«˜çº§ç”¨æ³•"></a>postmané«˜çº§ç”¨æ³•</h1><h2 id="colletions-æ¥å£é›†åˆ"><a href="#colletions-æ¥å£é›†åˆ" class="headerlink" title="colletions(æ¥å£é›†åˆ)"></a>colletions(æ¥å£é›†åˆ)</h2><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¤šé¡¹ç›®åŒæ—¶å¼€å‘ç»´æŠ¤çš„æƒ…å†µï¼ŒPostmanå‹å¥½çš„æä¾›äº†colletionsåŠŸèƒ½ï¼Œç±»ä¼¼ä¸é¡¹ç›®æ–‡ä»¶å¤¹ä¸€æ ·ï¼Œå¯ä»¥æŠŠå½’å±äºåŒä¸€ç±»çš„æ¥å£åˆ†ç±»åˆ°ä¸€èµ·ï¼Œä¾¿äºç®¡ç†ç»´æŠ¤ã€‚</p>
<ol>
<li>ç‚¹å‡»NEW -&gt; é€‰æ‹©collectionï¼Œåˆ›å»ºä¸€ä¸ªé¡¹ç›®ç©ºé—´ã€‚</li>
</ol>
<p><img data-src="https://i.imgur.com/RcYq3Ba.png"></p>
<ol start="2">
<li>è¾“å…¥é¡¹ç›®åç§°ï¼Œç‚¹å‡»createã€‚</li>
</ol>
<p><img data-src="https://i.imgur.com/zGFYC1F.png"></p>
<h2 id="colletions-folder-é›†åˆä¸­çš„æ–‡ä»¶å¤¹"><a href="#colletions-folder-é›†åˆä¸­çš„æ–‡ä»¶å¤¹" class="headerlink" title="colletions folder(é›†åˆä¸­çš„æ–‡ä»¶å¤¹)"></a>colletions folder(é›†åˆä¸­çš„æ–‡ä»¶å¤¹)</h2><p>æ¯ä¸ªé¡¹ç›®ä¼šæœ‰å¤šä¸ªæ¥å£ï¼Œæœ‰äº›æ˜¯ä¸€ç±»åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·ç®¡ç†æ¥å£ï¼Œæ–‡ç« åˆ—è¡¨æ¥å£ï¼ŒPostmanæä¾›folderç›®å½•æ¥è¿›è¡Œç»†è‡´çš„åˆ†ç±»ã€‚</p>
<ol>
<li>é€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œç‚¹å‡»Add Folder</li>
</ol>
<p><img data-src="https://i.imgur.com/v2qY1uW.png"></p>
<ol start="2">
<li>è¾“å…¥ç›®å½•åç§°ï¼Œç‚¹å‡»create</li>
</ol>
<p><img data-src="https://i.imgur.com/exymkyT.png"></p>
<p>æ¯ä¸ªæ¥å£éƒ½å¯ä»¥å½’ç±»åˆ°æŸä¸ªé¡¹ç›®ï¼Œæˆ–æŸä¸ªé¡¹ç›®çš„å­ç›®å½•ä¸­ã€‚</p>
<p><img data-src="https://i.imgur.com/pRltLVX.png"></p>
<h2 id="Environment-ç¯å¢ƒå˜é‡"><a href="#Environment-ç¯å¢ƒå˜é‡" class="headerlink" title="Environment(ç¯å¢ƒå˜é‡)"></a>Environment(ç¯å¢ƒå˜é‡)</h2><p>Postmanå…è®¸å®šä¹‰è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼ˆEnvironmentï¼‰ï¼Œæœ€å¸¸è§çš„æ˜¯å°†æµ‹è¯• URL è¿›è¡Œå®šä¹‰æˆå˜é‡çš„å½¢å¼ï¼Œè¿™æ ·éšç€ä½ çš„åŸŸåæ€ä¹ˆå˜ï¼ŒURL å°±ä¸ç”¨å˜æ›´ï¼Œéå¸¸æ–¹ä¾¿ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›æ•æ„Ÿçš„æµ‹è¯•å€¼å®šä¹‰ä¸ºç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚å¯†ç ã€‚æ¥ä¸‹æ¥ï¼Œæ¥çœ‹ä¸‹æ€ä¹ˆæ–°å»ºä¸€ç»„ç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹æ“ä½œæ‰“å¼€ç¯å¢ƒå˜é‡çš„ç®¡ç†å…¥å£ï¼š</p>
<p><img data-src="https://i.imgur.com/G8b6kTl.png"></p>
<p>æ‰“å¼€ç®¡ç†ç¯å¢ƒå˜é‡çš„çª—å£ï¼Œè¾“å…¥åç§°ï¼Œæ·»åŠ ä¸€ç»„é”®å€¼å¯¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://i.imgur.com/5oJhjWe.png"></p>
<p>ç¯å¢ƒå˜é‡è¦ä»¥åŒå¤§æ‹¬å·çš„æ–¹å¼æ¥å¼•ç”¨ï¼Œå¯ä»¥åœ¨å³ä¸Šæ–¹ä¸‹æ‹‰æ¡†å¤„é€‰æ‹©ç›¸åº”çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å®æµ‹ä¸€ä¸‹åˆšæ‰æ·»åŠ çš„Urlçš„å˜é‡ï¼š</p>
<p><img data-src="https://i.imgur.com/FAc6qME.png"></p>
<h2 id="é€šè¿‡è„šæœ¬è®¾ç½®å˜é‡"><a href="#é€šè¿‡è„šæœ¬è®¾ç½®å˜é‡" class="headerlink" title="é€šè¿‡è„šæœ¬è®¾ç½®å˜é‡"></a>é€šè¿‡è„šæœ¬è®¾ç½®å˜é‡</h2><p>Postmanå…è®¸ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ï¼Œå¹¶æä¾›äº†ä¸¤ç§ç±»å‹çš„è„šæœ¬ï¼š</p>
<ul>
<li>Pre-request Scriptï¼šæ‰§è¡Œrequestè¯·æ±‚å‰å…ˆè¿è¡Œï¼Œå¯ä»¥åœ¨é‡Œé¢é¢„å…ˆè®¾ç½®äº›æ‰€éœ€å˜é‡</li>
<li>Testsï¼šrequestè¿”å›åæ‰§è¡Œçš„,å¯ä»¥å¯¹è¿”å›ä¿¡æ¯è¿›è¡Œæå–è¿‡æ»¤ï¼Œæˆ–è€…æ‰§è¡Œä¸€äº›éªŒè¯æ“ä½œ</li>
</ul>
<h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>è·å–å¦‚ä¸‹è¿”å›ä¿¡æ¯ä¸­çš„user_idå€¼:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾æœåŠ¡ç«¯è¿”å›çš„Bodyå†…å®¹å¦‚ä¸‹:</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;token&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span>: <span class="string">&quot;2079876912&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;access_token&quot;</span>: <span class="string">&quot;26A90E317DBC1AD363B2E2CE53F76F2DD85CB172DF7D813099477BAACB69DC49C794BAECEDC68331&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;expires_at&quot;</span>: <span class="string">&quot;2016-06-22T12:46:51.637+0800&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;refresh_token&quot;</span>: <span class="string">&quot;26A90E317DBC1AD3CD1556CF2B3923DD60AEBADDCBC1D9D899262A55D15273F735E407A6BEC56B84&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mac_key&quot;</span>: <span class="string">&quot;4FAhd4OpfC&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mac_algorithm&quot;</span>: <span class="string">&quot;hmac-sha-256&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_time&quot;</span>: <span class="string">&quot;2016-06-15T12:46:51.649+0800&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨Testsä¸­å¯¹user_idå€¼è¿›è¡Œæå–å¹¶èµ‹å€¼æˆå…¨å±€å˜é‡:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨<span class="string">&#x27;user_id&#x27;</span>å€¼</span><br><span class="line">tests[<span class="string">&quot;Body contains user_id&quot;</span>] = responseBody.has(<span class="string">&quot;user_id&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(tests[<span class="string">&quot;Body contains user_id&quot;</span>])&#123;</span><br><span class="line">    // å°†è¿”å›ä¿¡æ¯è§£ææˆå¯¹è±¡</span><br><span class="line">    var responseData = JSON.parse(responseBody);</span><br><span class="line">    tests[<span class="string">&quot;value_user_id&quot;</span>]=responseData.token.user_id</span><br><span class="line">    // è®¾ç½®å…¨å±€å˜é‡</span><br><span class="line">    postman.setGlobalVariable(<span class="string">&quot;user_id&quot;</span>,tests[<span class="string">&quot;value_user_id&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    postman.setGlobalVariable(<span class="string">&quot;user_id&quot;</span>,<span class="string">&quot;é»˜è®¤user_id&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å®è·µæ¡ˆä¾‹"><a href="#å®è·µæ¡ˆä¾‹" class="headerlink" title="å®è·µæ¡ˆä¾‹"></a>å®è·µæ¡ˆä¾‹</h1><h2 id="é¡¹ç›®æ¥å£åˆ†ç±»ç®¡ç†"><a href="#é¡¹ç›®æ¥å£åˆ†ç±»ç®¡ç†" class="headerlink" title="é¡¹ç›®æ¥å£åˆ†ç±»ç®¡ç†"></a>é¡¹ç›®æ¥å£åˆ†ç±»ç®¡ç†</h2><p><img data-src="https://i.imgur.com/LXxBYdq.png"></p>
<h2 id="ç™»å½•è·å–tokenå¹¶è®¾ç½®ä¸ºå…¨å±€å˜é‡"><a href="#ç™»å½•è·å–tokenå¹¶è®¾ç½®ä¸ºå…¨å±€å˜é‡" class="headerlink" title="ç™»å½•è·å–tokenå¹¶è®¾ç½®ä¸ºå…¨å±€å˜é‡"></a>ç™»å½•è·å–tokenå¹¶è®¾ç½®ä¸ºå…¨å±€å˜é‡</h2><p><img data-src="https://i.imgur.com/gIXLd5c.png"></p>
<h2 id="æ¥å£ä½¿ç”¨ç™»å½•åçš„token"><a href="#æ¥å£ä½¿ç”¨ç™»å½•åçš„token" class="headerlink" title="æ¥å£ä½¿ç”¨ç™»å½•åçš„token"></a>æ¥å£ä½¿ç”¨ç™»å½•åçš„token</h2><p><img data-src="https://i.imgur.com/1RCOliR.png"></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>å·¥å…·æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Cloudå¾®æœåŠ¡è¸©å‘è®°å½•</title>
    <url>/p/61811/</url>
    <content><![CDATA[<p>è®°å½•åœ¨å¼€å‘å¾®æœåŠ¡è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚<span id="more"></span></p>
<h1 id="No-Feign-Client-for-loadBalancing-defined-Did-you-forget-to-include-spring-cloud-starter-netflix-ribbon"><a href="#No-Feign-Client-for-loadBalancing-defined-Did-you-forget-to-include-spring-cloud-starter-netflix-ribbon" class="headerlink" title="No Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-netflix-ribbon?"></a>No Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-netflix-ribbon?</h1><h1 id="feignclientå’Œ-requestmappingæ··ç”¨çš„æ—¶å€™å‡ºé”™"><a href="#feignclientå’Œ-requestmappingæ··ç”¨çš„æ—¶å€™å‡ºé”™" class="headerlink" title="@feignclientå’Œ@requestmappingæ··ç”¨çš„æ—¶å€™å‡ºé”™"></a>@feignclientå’Œ@requestmappingæ··ç”¨çš„æ—¶å€™å‡ºé”™</h1><p>é‡å†™springmvcæ‰«æcontrolleræ—¶ä¸å¸¦æœ‰@feignclientæ‰å®ä¾‹åŒ–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;Feign.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcRegistrations <span class="title">feignWebRegistrations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcRegistrationsAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> RequestMappingHandlerMapping <span class="title">getRequestMappingHandlerMapping</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> FeignRequestMappingHandlerMapping();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignRequestMappingHandlerMapping</span> <span class="keyword">extends</span> <span class="title">RequestMappingHandlerMapping</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHandler</span><span class="params">(Class&lt;?&gt; beanType)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.isHandler(beanType) &amp;&amp;</span><br><span class="line">                    !AnnotatedElementUtils.hasAnnotation(beanType, FeignClient.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SpringCloudä½¿ç”¨Zuulå‡ºç°â€œForwarding-errorâ€é”™è¯¯è§£å†³æ–¹æ³•"><a href="#SpringCloudä½¿ç”¨Zuulå‡ºç°â€œForwarding-errorâ€é”™è¯¯è§£å†³æ–¹æ³•" class="headerlink" title="SpringCloudä½¿ç”¨Zuulå‡ºç°â€œForwarding errorâ€é”™è¯¯è§£å†³æ–¹æ³•"></a>SpringCloudä½¿ç”¨Zuulå‡ºç°â€œForwarding errorâ€é”™è¯¯è§£å†³æ–¹æ³•</h1><p>åœ¨application.ymlä¸­æ·»åŠ ribbonçš„è¶…æ—¶æ—¶é—´è®¾ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span>  </span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">3000</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line">    <span class="attr">host:</span></span><br><span class="line">        <span class="attr">connect-timeout-millis:</span> <span class="number">3000</span></span><br><span class="line">        <span class="attr">socket-timeout-millis:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">            <span class="attr">execution:</span></span><br><span class="line">                <span class="attr">isolation:</span></span><br><span class="line">                    <span class="attr">thread:</span></span><br><span class="line">                        <span class="attr">timeout-in-milliseconds:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring-Cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>MacOsä½¿ç”¨CleanMyMac Xæ¸…é™¤å¯æ¸…é™¤ç©ºé—´</title>
    <url>/p/46997/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>CleanMyMac X</code>æ¸…é™¤å¯æ¸…é™¤çš„ç©ºé—´</p>
<p><img data-src="https://i.loli.net/2019/10/11/GdSBlzQMhTfY2Ha.png"></p>
<span id="more"></span>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯æ¸…é™¤çš„ç©ºé—´è¾¾åˆ°äº†125.79GBï¼Œè™½ç„¶è¯´ä¸å½±å“ç³»ç»Ÿçš„ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶é—´æœºå™¨è¿›è¡Œå¤‡ä»½çš„æ—¶å€™ï¼Œä»ç„¶ä¼šå°†å¯æ¸…é™¤ç©ºé—´å½“æˆå¤‡ä»½çš„ä¸€éƒ¨åˆ†ï¼Œé€ æˆå¤‡ä»½æ–‡ä»¶è¿‡å¤§ï¼Œé¦–æ¬¡å¤‡ä»½æ—¶é—´è¿‡é•¿ã€‚</p>
<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>æ¸…é™¤å¯æ¸…é™¤ç©ºé—´ï¼Œä½ åªéœ€è¦<strong>CleanMyMac X</strong>è¿™ä¸ªå·¥å…·å³å¯ï¼Œæˆ‘åˆ†äº«ä¸‹æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå½“ç„¶æœ‰èƒ½åŠ›çš„å»ºè®®ä½¿ç”¨æ­£ç‰ˆã€‚</p>
<p><a href="https://pan.baidu.com/s/1L05kBwZIghM73IRC8rMpMw">https://pan.baidu.com/s/1L05kBwZIghM73IRC8rMpMw</a></p>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><p>å®‰è£…å®Œæ¯•åï¼Œæ‰“å¼€<strong>CleanMyMac X</strong></p>
<p><img data-src="https://i.loli.net/2019/10/11/E8BRFzlvLo4bcZU.png"></p>
<p>ç‚¹å‡»â€ç»´æŠ¤â€œï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ<strong>é‡Šæ”¾å¯æ¸…é™¤ç©ºé—´</strong>â€æˆ–è€…æ˜¯â€œ<strong>æ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«</strong>â€ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯â€œæ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«â€</p>
<div class="note warning"><p>å»ºè®®å…ˆä½¿ç”¨â€œæ—¶é—´æœºå™¨å¿«ç…§ç˜¦èº«â€ï¼Œå¦‚æœä¸è¡Œï¼Œå†é‡Šæ”¾å¯æ¸…é™¤ç©ºé—´ï¼Œå› ä¸ºé‡Šæ”¾å¯æ¸…é™¤ç©ºé—´è€—æ—¶è¾ƒé•¿</p>
</div>

<p><img data-src="https://i.loli.net/2019/10/11/VTihB8LqlUebrJY.png"></p>
<p>ç‚¹å‡»è¿è¡Œï¼Œç¨ä½œç­‰å¾…å³å¯</p>
<p><img data-src="https://i.loli.net/2019/10/11/tUKvGurohTwY4fV.png"></p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å›åˆ°ç£ç›˜å·¥å…·ï¼Œå†æ¬¡æŸ¥çœ‹å¯æ¸…é™¤ç©ºé—´ï¼Œå¯ä»¥å‘ç°ï¼Œå¯æ¸…é™¤ç©ºé—´å°äº†ä¸å°‘ï¼</p>
<p><img data-src="https://i.loli.net/2019/10/11/fPV35Zvj8oznWqm.png"></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>macOs</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Hyper-Væ›¿ä»£VMware</title>
    <url>/p/14834/</url>
    <content><![CDATA[<h1 id="Hyper-Væ˜¯ä»€ä¹ˆ"><a href="#Hyper-Væ˜¯ä»€ä¹ˆ" class="headerlink" title="Hyper-Væ˜¯ä»€ä¹ˆ"></a>Hyper-Væ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>Hyper-Vç¡¬ä»¶è¦æ±‚ä¸ºWindows 10 ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Macæˆ–è€…Linuxçš„ç”µè„‘ï¼Œå¯ä»¥ä¸å¾€ä¸‹çœ‹äº†ã€‚</p>
</blockquote>
<p>è™šæ‹Ÿæœºå¤§å®¶éƒ½æ‡‚å§ï¼Œç®€å•æ¥è¯´ï¼ŒHyper-Vå°±æ˜¯è™šæ‹Ÿæœºç®¡ç†å·¥å…·ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡<a href="https://www.vmware.com/products/workstation-pro.html">VMware Workstation Pro</a>æˆ–è€…æ˜¯<a href="https://www.virtualbox.org/">VirtualBox</a>ï¼Œé‚£ä½ ä¸€å®šä¸é™Œç”Ÿäº†ã€‚</p>
<span id="more"></span>

<p>å…·ä½“æ¥è¯´ï¼ŒHyper-V æä¾›ç¡¬ä»¶è™šæ‹ŸåŒ–ã€‚ è¿™æ„å‘³ç€æ¯ä¸ªè™šæ‹Ÿæœºéƒ½åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œã€‚ Hyper-V å…è®¸ä½ åˆ›å»ºè™šæ‹Ÿç¡¬ç›˜é©±åŠ¨å™¨ã€è™šæ‹Ÿäº¤æ¢æœºä»¥åŠè®¸å¤šå…¶ä»–è™šæ‹Ÿè®¾å¤‡ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vè€Œä¸æ˜¯VMwareï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vè€Œä¸æ˜¯VMwareï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vè€Œä¸æ˜¯VMwareï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vè€Œä¸æ˜¯VMwareï¼Ÿ</h1><p>é¦–å…ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿæœºï¼Ÿ</p>
<ul>
<li>è¿è¡Œéœ€è¦æ—©æœŸç‰ˆæœ¬çš„Windows æ“ä½œç³»ç»Ÿæˆ–éWindows æ“ä½œç³»ç»Ÿçš„è½¯ä»¶ã€‚</li>
<li>å®éªŒå…¶ä»–æ“ä½œç³»ç»Ÿã€‚ é€šè¿‡è™šæ‹Ÿæœºï¼Œå¯è½»æ¾åˆ›å»ºå’Œåˆ é™¤ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚</li>
<li>ä½¿ç”¨å¤šä¸ªè™šæ‹Ÿæœºåœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šæµ‹è¯•è½¯ä»¶ã€‚ é€šè¿‡è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨ä¸€éƒ¨å°å¼æœºæˆ–ä¾¿æºå¼è®¡ç®—æœºä¸Šè¿è¡Œæ‰€æœ‰å†…å®¹ã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨Hyper-Vï¼Ÿ</p>
<ol>
<li>é¦–å…ˆï¼ŒHyper-Væ˜¯Windows 10 ä¸“ä¸šç‰ˆè‡ªå¸¦çš„åŠŸèƒ½ï¼Œæ— éœ€å®‰è£…å…¶ä»–ä»»ä½•å·¥å…·</li>
<li><a href="https://hub.docker.com/?overlay=onboarding">Docker for Windows</a>æ¨èä½¿ç”¨Hyper-Vä½œä¸ºè™šæ‹ŸåŒ–æ–¹æ¡ˆ</li>
<li>å…è´¹</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨Hyper-Vèƒ½èƒœä»»çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨Hyper-Vã€‚</p>
<h1 id="å¦‚ä½•ä½¿ç”¨Hyper-V"><a href="#å¦‚ä½•ä½¿ç”¨Hyper-V" class="headerlink" title="å¦‚ä½•ä½¿ç”¨Hyper-V"></a>å¦‚ä½•ä½¿ç”¨Hyper-V</h1><h2 id="æ£€æŸ¥ç³»ç»Ÿè¦æ±‚"><a href="#æ£€æŸ¥ç³»ç»Ÿè¦æ±‚" class="headerlink" title="æ£€æŸ¥ç³»ç»Ÿè¦æ±‚"></a>æ£€æŸ¥ç³»ç»Ÿè¦æ±‚</h2><ul>
<li>Windows 10 <strong>ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆ</strong>ã€‚</li>
<li>å…·æœ‰äºŒçº§åœ°å€è½¬æ¢ (SLAT) çš„ 64 ä½å¤„ç†å™¨ã€‚</li>
<li>è™šæ‹Ÿæœºç›‘è§†å™¨æ¨¡å¼æ‰©å±•çš„ CPU æ”¯æŒ (Intel Cpu ä¸Šçš„ VT-c)ã€‚</li>
<li>æœ€å° 4 GB å†…å­˜ã€‚</li>
</ul>
<div class="note warning"><p>æ³¨æ„ï¼šç³»ç»Ÿå¿…é¡»æ˜¯Windows 10ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆã€‚</p>
</div>

<h2 id="å¼€å¯Hyper-V"><a href="#å¼€å¯Hyper-V" class="headerlink" title="å¼€å¯Hyper-V"></a>å¼€å¯Hyper-V</h2><h3 id="ä½¿ç”¨-PowerShell-å¯ç”¨-Hyper-V"><a href="#ä½¿ç”¨-PowerShell-å¯ç”¨-Hyper-V" class="headerlink" title="ä½¿ç”¨ PowerShell å¯ç”¨ Hyper-V"></a>ä½¿ç”¨ PowerShell å¯ç”¨ Hyper-V</h3><ol>
<li>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æ§åˆ¶å°ã€‚</li>
<li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Enable-WindowsOptionalFeature</span> <span class="literal">-Online</span> <span class="literal">-FeatureName</span> Microsoft<span class="literal">-Hyper</span><span class="literal">-V</span> <span class="literal">-All</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ— æ³•æ‰¾åˆ°æ­¤å‘½ä»¤ï¼Œè¯·ç¡®ä¿ä½ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellã€‚</p>
<div class="note warning"><p>å®‰è£…å®Œæˆåï¼Œè¯·é‡å¯ã€‚</p>
</div>

<h3 id="ä½¿ç”¨-CMD-å’Œ-DISM-å¯ç”¨-Hyper-V"><a href="#ä½¿ç”¨-CMD-å’Œ-DISM-å¯ç”¨-Hyper-V" class="headerlink" title="ä½¿ç”¨ CMD å’Œ DISM å¯ç”¨ Hyper-V"></a>ä½¿ç”¨ CMD å’Œ DISM å¯ç”¨ Hyper-V</h3><p>éƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†å·¥å…· (DISM) å¯å¸®åŠ©é…ç½® Windows å’Œ Windows æ˜ åƒã€‚ åœ¨ä¼—å¤šåº”ç”¨ç¨‹åºä¸­ï¼ŒDISM å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿè¿è¡Œæ—¶å¯ç”¨ Windows åŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨ DISM å¯ç”¨ Hyper-V è§’è‰²ï¼š</p>
<ol>
<li>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æˆ– CMD ä¼šè¯ã€‚</li>
<li>é”®å…¥ä¸‹åˆ—å‘½ä»¤ï¼š</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">DISM /Online /<span class="built_in">Enable-Feature</span> /All /FeatureName:Microsoft<span class="literal">-Hyper</span><span class="literal">-V</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/07/19/5d316faceaaa555921.png"></p>
<h3 id="é€šè¿‡â€œè®¾ç½®â€å¯ç”¨-Hyper-V-è§’è‰²"><a href="#é€šè¿‡â€œè®¾ç½®â€å¯ç”¨-Hyper-V-è§’è‰²" class="headerlink" title="é€šè¿‡â€œè®¾ç½®â€å¯ç”¨ Hyper-V è§’è‰²"></a>é€šè¿‡â€œè®¾ç½®â€å¯ç”¨ Hyper-V è§’è‰²</h3><p>æ¨èä½¿ç”¨è¿™ç§æ–¹å¼</p>
<ol>
<li>å³é”®å•å‡» Windows æŒ‰é’®å¹¶é€‰æ‹©â€œåº”ç”¨å’ŒåŠŸèƒ½â€ã€‚</li>
<li>åœ¨ â€œç›¸å…³è®¾ç½®â€ ä¸‹çš„å³ä¾§é€‰æ‹© â€œ<strong>ç¨‹åºå’ŒåŠŸèƒ½</strong>â€œã€‚</li>
<li>é€‰æ‹©â€œ<strong>æ‰“å¼€æˆ–å…³é—­ Windows åŠŸèƒ½</strong>â€ã€‚</li>
<li>é€‰æ‹© <strong>Hyper-V</strong>ï¼Œç„¶åå•å‡»<strong>ç¡®å®š</strong>ã€‚</li>
</ol>
<p><img data-src="https://i.loli.net/2019/07/19/5d317018d187515264.png"></p>
<div class="note warning"><p>åŒæ ·çš„ï¼Œå®‰è£…å®Œæˆåï¼Œè¯·é‡å¯ã€‚</p>
</div>

<h2 id="åˆ›å»ºè™šæ‹Ÿæœº"><a href="#åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿæœº"></a>åˆ›å»ºè™šæ‹Ÿæœº</h2><p>åœ¨å¼€å§‹èœå•æ‰¾åˆ°å¹¶æ‰“å¼€<strong>Hyper-Vç®¡ç†å™¨</strong>ï¼Œå®ƒåº”è¯¥ä½äºWindowsç®¡ç†å·¥å…·æ–‡ä»¶å¤¹ä¸‹é¢ã€‚</p>
<p>æˆ–è€…ç›´æ¥æœç´¢<code>Hyper-V</code></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d317163c37fc46784.png"></p>
<p>æ‰“å¼€åç•Œé¢å¦‚ä¸‹ï¼Œæˆ‘è§‰å¾—æ¯”VMwareç•Œé¢å¥½çœ‹ç‚¹ã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d3171f62f3db74558.png"></p>
<h3 id="å¿«é€Ÿåˆ›å»º"><a href="#å¿«é€Ÿåˆ›å»º" class="headerlink" title="å¿«é€Ÿåˆ›å»º"></a>å¿«é€Ÿåˆ›å»º</h3><p>ç‚¹å‡»å¿«é€Ÿåˆ›å»ºï¼Œä½ å°†ä¼šçœ‹åˆ°</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31724c78a8053748.png"></p>
<p>ç±»ä¼¼äºåœ¨çº¿å®‰è£…ï¼Œæ¯”è¾ƒç®€å•ã€‚</p>
<p>æˆ‘å°è¯•äº†å¯¼å…¥æœ¬åœ°å®‰è£…æºå®‰è£…Ubuntu 16.04ï¼Œä½†æ˜¯å¯åŠ¨æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°Bootä¿¡æ¯ã€‚</p>
<div class="note info"><p>å¯èƒ½åŸå› æ˜¯ï¼šæˆ‘çš„ç”µè„‘ä¸æ”¯æŒç¬¬äºŒä»£è™šæ‹Ÿæœºä¸–ä»£ï¼ˆæ˜¯ä¸€ç§è¾ƒæ–°çš„è™šæ‹ŸåŒ–åŠŸèƒ½ï¼‰</p>
</div>

<h3 id="æ–°å»ºè™šæ‹Ÿæœº"><a href="#æ–°å»ºè™šæ‹Ÿæœº" class="headerlink" title="æ–°å»ºè™šæ‹Ÿæœº"></a>æ–°å»ºè™šæ‹Ÿæœº</h3><p>ç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœºï¼Œä½ å°†ä¼šè¿›å…¥ä¸€ä¸‹ç•Œé¢</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31739e288e621269.png"></p>
<p>è·Ÿç€ä¸€æ­¥æ­¥æ¥å§ï¼Œé¦–å…ˆä½ å¾—å‡†å¤‡å¥½ä¸€ä¸ªç³»ç»Ÿé•œåƒï¼ˆISOç»“å°¾çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ï¼‰</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31745826fc036003.png"></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d317487c047867319.png"></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d3174d7987ff97371.png"></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d317516e579835760.png"></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d317561c1c2357128.png"></p>
<p>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå®Œæˆã€‚</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31761f0c16026230.png"></p>
<p>æ¥ç€ï¼Œå°±è¿›å…¥äº†Ubuntuç³»ç»Ÿå®‰è£…ç¯èŠ‚ï¼Œçœç•¥äº†ï¼Œå¤§å®¶åº”è¯¥éƒ½ä¼šè£…çš„ã€‚</p>
<h3 id="å¯¼å…¥è™šæ‹Ÿæœº"><a href="#å¯¼å…¥è™šæ‹Ÿæœº" class="headerlink" title="å¯¼å…¥è™šæ‹Ÿæœº"></a>å¯¼å…¥è™šæ‹Ÿæœº</h3><p>é™¤äº†è‡ªå·±åˆ›å»ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥åˆ«äººåˆ›å»ºå¥½çš„è™šæ‹Ÿæœº</p>
<p>ç‚¹å‡»å¯¼å…¥è™šæ‹Ÿæœº</p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31781f6a53f37502.png"></p>
<p><img data-src="https://i.loli.net/2019/07/19/5d31785537ce278225.png"></p>
<p>ä»¥ä¸‹æ˜¯æˆ‘åˆ›å»ºçš„Ubuntu 16.04è™šæ‹Ÿæœºï¼Œä½ å¯ä»¥ç›´æ¥å¯¼å…¥ä½¿ç”¨ã€‚</p>
<p><a href="https://1drv.ms/f/s!AjfBPvEeW2r2hukqwAdOrPSMPpKZ4A">https://1drv.ms/f/s!AjfBPvEeW2r2hukqwAdOrPSMPpKZ4A</a></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://docs.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/about/">Windows 10 ä¸Šçš„ Hyper-V ç®€ä»‹</a></p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>Hyper-V</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Tesseract-Ocrè¯†åˆ«æ•°å­—</title>
    <url>/p/5479/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><a href="https://github.com/tesseract-ocr/tesseract">Tesseract-Ocr</a>æ˜¯æˆ‘åœ¨ç¼–å†™çˆ¬è™«é¡¹ç›®ä¸­ï¼Œç”¨æ¥è¯†åˆ«å›¾ç‰‡ï¼ˆä¸æ˜¯éªŒè¯ç ï¼‰çš„æœ¬åœ°è§£å†³æ–¹æ¡ˆï¼ˆå› ä¸ºå®¢æˆ·ä¸æƒ³ä½¿ç”¨APIè¯†åˆ«ï¼Œå¤ªè´µï¼‰ï¼Œè¯†åˆ«ç‡ç›®å‰è¾¾åˆ°äº†100%ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“äº†å¾—ï¼Œå½“ç„¶äº†ï¼Œè¿™å–å†³äºä½¿ç”¨çš„<code>traineddata</code>ã€‚</p>
<span id="more"></span>

<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>Tesseractæœ€åˆæ˜¯åœ¨1985å¹´è‡³1994å¹´é—´åœ¨Hewlett-Packard Laboratories Bristolå’ŒGreeley Coloradoçš„Hewlett-Packard Coå¼€å‘çš„ï¼Œ1996å¹´è¿›è¡Œäº†ä¸€äº›æ›´æ”¹ï¼Œç§»æ¤åˆ°Windowsï¼Œå¹¶ä¸”éšç€C++åœ¨1998å¹´å…´èµ·ã€‚2005å¹´Tesseractç”±æƒ æ™®å¼€æºï¼Œç„¶åä»2006å¹´è‡³ä»Šï¼Œç”±è°·æ­Œç»§ç»­å¼€å‘ã€‚</p>
</blockquote>
<p>Tesseract-Ocrå¹¶ä¸æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ŒåŒ…å«äº†ä¸€ä¸ªOCRå¼•æ“ã€libtesseractã€‘å’Œä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº ã€tesseractã€‘ã€‚Tesseract 4å¢åŠ äº†ä¸€ä¸ªåŸºäºOCRå¼•æ“çš„æ–°ç¥ç»ç½‘ç»œï¼ˆLSTMï¼‰ï¼Œè¯¥å¼•æ“ä¸“æ³¨äºè¡Œçº§è¯†åˆ«ï¼Œä½†ä»ç„¶æ”¯æŒTesseract 3çš„ä¼ ç»ŸTesseract OCRå¼•æ“ï¼Œè¯¥å¼•æ“é€šè¿‡è¯†åˆ«å­—ç¬¦æ¨¡å¼æ¥å·¥ä½œã€‚</p>
<p>è¦å¯ç”¨ä¸Tesseract 3çš„å…¼å®¹æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨Legacy OCR Engineæ¨¡å¼ï¼ˆâ€“oem 0ï¼‰ã€‚å®ƒè¿˜éœ€è¦æ”¯æŒä¼ ç»Ÿå¼•æ“çš„traineddataï¼ˆè®­ç»ƒå¥½çš„æ•°æ®æ–‡ä»¶ï¼‰ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥ä»<a href="https://github.com/tesseract-ocr/tessdata">tessdataå­˜å‚¨åº“</a>çš„æ–‡ä»¶è·å–ã€‚</p>
<p>Tesseractæ”¯æŒè¯†åˆ«unicodeï¼ˆUTF-8ï¼‰ï¼Œå¯ä»¥â€œå¼€ç®±å³ç”¨â€è¯†åˆ«100å¤šç§è¯­è¨€ã€‚</p>
<p>Tesseractæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼šçº¯æ–‡æœ¬ï¼ŒhOCRï¼ˆHTMLï¼‰ï¼ŒPDFï¼ŒTSVã€‚ä¸»åˆ†æ”¯è¿˜å…·æœ‰ALTOï¼ˆXMLï¼‰è¾“å‡ºçš„å®éªŒæ”¯æŒã€‚</p>
<p>â­ï¸â­ï¸â­ï¸ å…·ä½“ä»‹ç»å¯ä»¥ä¸Š<a href="https://github.com/tesseract-ocr/tesseract/wiki">tesseract-wiki</a>æŸ¥çœ‹ã€‚</p>
<h1 id="åœ¨Javaä¸Šä½¿ç”¨"><a href="#åœ¨Javaä¸Šä½¿ç”¨" class="headerlink" title="åœ¨Javaä¸Šä½¿ç”¨"></a>åœ¨Javaä¸Šä½¿ç”¨</h1><h2 id="åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å¼•å…¥JaråŒ…"><a href="#åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å¼•å…¥JaråŒ…" class="headerlink" title="åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å¼•å…¥JaråŒ…"></a>åˆ›å»ºé¡¹ç›®ï¼Œå¹¶å¼•å…¥JaråŒ…</h2><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.sourceforge.tess4j/tess4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sourceforge.tess4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tess4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">compile <span class="string">&#x27;net.sourceforge.tess4j:tess4j:4.3.1&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯¼å…¥traineddata"><a href="#å¯¼å…¥traineddata" class="headerlink" title="å¯¼å…¥traineddata"></a>å¯¼å…¥traineddata</h2><p><code>traineddata</code>æ˜¯ä½¿ç”¨<code>Tesseract-Ocr</code>è®­ç»ƒå¥½çš„æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è¿™äº›æ–‡ä»¶ä½ å¯ä»¥å»<a href="https://github.com/tesseract-ocr/tessdata">tessdataå­˜å‚¨åº“</a>æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥å»è°·æ­Œæœç´¢ï¼Œå½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±è®­ç»ƒğŸ˜‚ã€‚</p>
<p><code>traineddata</code>é€šå¸¸ä»¥<code>*.traineddata</code>å‘½åï¼Œå…¶ä¸­*æŒ‡çš„æ˜¯æ”¯æŒçš„è¯­è¨€ç±»å‹ã€‚åœ¨<a href="https://github.com/tesseract-ocr/tesseract/wiki/Data-Files#data-files-for-version-400-november-29-2016">è¿™é‡Œ</a>ä½ å¯ä»¥çœ‹åˆ°4.0.0ç‰ˆæœ¬æ”¯æŒçš„è¯­è¨€ä»¥åŠ<code>traineddata</code>åˆ—è¡¨ã€‚</p>
<p>è¿™æ¬¡ï¼Œæˆ‘ä»¬é€‰æ‹©<code>eng.traineddata</code>è¿›è¡Œæµ‹è¯•ã€‚ä¸‹è½½<a href="https://www.lanzous.com/i4en81a">eng.traineddata</a>æ”¾å…¥<code>/resources/traineddata</code>ç›®å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/02/5cf2c4189371f48480.png"></p>
<h2 id="ç¼–å†™æµ‹è¯•ä»£ç "><a href="#ç¼–å†™æµ‹è¯•ä»£ç " class="headerlink" title="ç¼–å†™æµ‹è¯•ä»£ç "></a>ç¼–å†™æµ‹è¯•ä»£ç </h2><h3 id="åˆå§‹åŒ–Tesseractå¼•æ“"><a href="#åˆå§‹åŒ–Tesseractå¼•æ“" class="headerlink" title="åˆå§‹åŒ–Tesseractå¼•æ“"></a>åˆå§‹åŒ–Tesseractå¼•æ“</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TesseractTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ITesseract tesseract;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tesseract = <span class="keyword">new</span> Tesseract();</span><br><span class="line">        System.out.println(<span class="string">&quot;tesseract init done...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œä¸Šé¢çš„ä»£ç æ˜¯æ— æ³•æ­£å¸¸è¿è¡Œçš„ï¼Œå› ä¸ºæ‰¾ä¸åˆ°æŒ‡å®šè¯­è¨€ç‰ˆæœ¬çš„<code>traineddata</code>æ–‡ä»¶ã€‚</p>
<p><code>net.sourceforge.tess4j:tess4j:4.1.1</code>æä¾›çš„APIå¹¶ä¸å¥½ï¼Œåœ¨<code>Tesseract</code>æ„é€ å‡½æ•°ä¸­ï¼Œæ²¡æœ‰æä¾›å¯é€‰å‚æ•°çš„æ„é€ å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tesseract</span> <span class="keyword">implements</span> <span class="title">ITesseract</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Tesseractä½¿ç”¨çš„è¯­è¨€ç‰ˆæœ¬ï¼Œç”¨ä»¥é€‰æ‹©traineddata</span></span><br><span class="line">    <span class="keyword">private</span> String language = <span class="string">&quot;eng&quot;</span>;</span><br><span class="line">    <span class="comment">// traineddataç›®å½•ï¼Œé‡Œé¢æ”¾*.traineddataæ•°æ®æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> String datapath;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tesseract</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é»˜è®¤ä»ç³»ç»Ÿç¯å¢ƒå˜é‡è·å–traineddataç›®å½•</span></span><br><span class="line">            datapath = System.getenv(<span class="string">&quot;TESSDATA_PREFIX&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// ignore</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (datapath == <span class="keyword">null</span>) &#123;</span><br><span class="line">                datapath = <span class="string">&quot;./&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets language for OCR.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> language the language code, which follows ISO 639-3 standard.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLanguage</span><span class="params">(String language)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.language = language;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets path to &lt;code&gt;tessdata&lt;/code&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datapath the tessdata path to set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDatapath</span><span class="params">(String datapath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.datapath = datapath;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è®¾ç½®ç¯å¢ƒå˜é‡<code>TESSDATA_PREFIX</code>ä¸ºæ•°æ®ç›®å½•ï¼Œæˆ–è€…é€šè¿‡Javaç¼–ç çš„æ–¹å¼æ¥è®¾ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">tesseract.setLanguage(<span class="string">&quot;eng&quot;</span>); <span class="comment">// é»˜è®¤å°±æ˜¯engï¼Œä½ å¯ä»¥é€‰æ‹©å…¶ä»–lang</span></span><br><span class="line">tesseract.setDatapath(TesseractTest.class.getResource(<span class="string">&quot;/traineddata&quot;</span>).getPath().substring(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<h3 id="OCRè¯†åˆ«æµ‹è¯•"><a href="#OCRè¯†åˆ«æµ‹è¯•" class="headerlink" title="OCRè¯†åˆ«æµ‹è¯•"></a>OCRè¯†åˆ«æµ‹è¯•</h3><p><code>tesseract</code>æä¾›äº†ä¸€ç³»åˆ—<code>doOcr</code>æ–¹æ³•çš„é‡è½½ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„è¿›è¡ŒOCRè¯†åˆ«ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(File imageFile)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(File imageFile, Rectangle rect)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(BufferedImage bi)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(BufferedImage bi, Rectangle rect)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(List&lt;IIOImage&gt; imageList, Rectangle rect)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(List&lt;IIOImage&gt; imageList, String filename, Rectangle rect)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(<span class="keyword">int</span> xsize, <span class="keyword">int</span> ysize, ByteBuffer buf, Rectangle rect, <span class="keyword">int</span> bpp)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">doOCR</span><span class="params">(<span class="keyword">int</span> xsize, <span class="keyword">int</span> ysize, ByteBuffer buf, String filename, Rectangle rect, <span class="keyword">int</span> bpp)</span> <span class="keyword">throws</span> TesseractException</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>doOcr</code>æ–¹æ³•æ”¯æŒå¤šç§å›¾ç‰‡è¯†åˆ«æ–¹å¼ï¼Œå¦‚å›¾ç‰‡æ–‡ä»¶ã€å¤šä¸ªå›¾ç‰‡æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶å±€éƒ¨å¤„ç†ç­‰ç­‰æ–¹å¼ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬é€‰å–æœ€ç®€å•çš„å›¾ç‰‡æ–‡ä»¶æ–¹å¼æµ‹è¯•ã€‚</p>
<p><a href="http://static8.ziroom.com/phoenix/pc/images/price/aacd14fbc53a106c7f0f0d667535683as.png">å›¾ç‰‡</a>æ˜¯ä¸ªURLé“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<p><img data-src="https://i.loli.net/2019/06/02/5cf2c992174bd56164.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOcr</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TesseractException </span>&#123;</span><br><span class="line">    BufferedImage image = ImageIO.read(<span class="keyword">new</span> URL(<span class="string">&quot;http://static8.ziroom.com/phoenix/pc/images/price/aacd14fbc53a106c7f0f0d667535683as.png&quot;</span>));</span><br><span class="line">    String ocr = tesseract.doOCR(image);</span><br><span class="line">    System.out.println(<span class="string">&quot;ocr result : &quot;</span> + ocr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tesseract init done...</span><br><span class="line">ocr result : 2710386495</span><br></pre></td></tr></table></figure>

<p>è¯†åˆ«å‡†ç¡®ç‡ï¼Œä¸»è¦åœ¨äº<strong>ä½ é€‰æ‹©çš„è®­ç»ƒæ•°æ®æ–‡ä»¶</strong>ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯æ•°æ®æ–‡ä»¶æ˜¯<a href="https://www.lanzous.com/i4en81a">è¿™ä¸ª</a>ï¼Œå¯¹äºæ•°å­—çš„å‡†ç¡®ç‡åŸºæœ¬ä¸Šæ˜¯100%ã€‚</p>
<h3 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>å¦‚æœä½ é­é‡<code>Invalid memory access</code>å¼‚å¸¸ï¼Œè¿™æ˜¯ç”±äºæ‰¾ä¸åˆ°å¯¹åº”langçš„<code>*.traineddata</code>æ–‡ä»¶ï¼Œè¯·ä¿®æ”¹<code>language</code>å’Œ<code>datapath</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Invalid memory access</span><br><span class="line">java.lang.Error: Invalid memory access</span><br><span class="line">	at com.sun.jna.Native.invokePointer(Native Method)</span><br><span class="line">	at com.sun.jna.Function.invokePointer(Function.java:470)</span><br><span class="line">	at com.sun.jna.Function.invoke(Function.java:404)</span><br><span class="line">	at com.sun.jna.Function.invoke(Function.java:315)</span><br><span class="line">	at com.sun.jna.Library<span class="variable">$Handler</span>.invoke(Library.java:212)</span><br><span class="line">	at com.sun.proxy.<span class="variable">$Proxy9</span>.TessBaseAPIGetUTF8Text(Unknown Source)</span><br><span class="line">	at net.sourceforge.tess4j.Tesseract.getOCRText(Tesseract.java:495)</span><br><span class="line">	at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:321)</span><br><span class="line">	at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:293)</span><br><span class="line">	at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:274)</span><br><span class="line">	at net.sourceforge.tess4j.Tesseract.doOCR(Tesseract.java:258)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h1 id="è®­ç»ƒå·¥å…·"><a href="#è®­ç»ƒå·¥å…·" class="headerlink" title="è®­ç»ƒå·¥å…·"></a>è®­ç»ƒå·¥å…·</h1><p><a href="https://github.com/tesseract-ocr/tesseract/wiki/AddOns">https://github.com/tesseract-ocr/tesseract/wiki/AddOns</a></p>
<h1 id="è®­ç»ƒæ•°æ®ä»“åº“"><a href="#è®­ç»ƒæ•°æ®ä»“åº“" class="headerlink" title="è®­ç»ƒæ•°æ®ä»“åº“"></a>è®­ç»ƒæ•°æ®ä»“åº“</h1><ul>
<li><a href="https://github.com/tesseract-ocr/tessdata_best">tessdata_best</a>ï¼šåŸºäºLSTMå¼•æ“çš„è®­ç»ƒæ•°æ®ï¼Œæœ€ä½³æœ€å‡†ç¡®çš„</li>
<li><a href="https://github.com/tesseract-ocr/tessdata_fast">tessdata_fast</a>ï¼šåŸºäºLSTMå¼•æ“çš„è®­ç»ƒæ•°æ®ï¼Œå¿«é€Ÿï¼ˆç²¾ç®€ï¼‰ç‰ˆæœ¬</li>
<li><a href="https://github.com/tesseract-ocr/tessdata">tessdata</a>ï¼šæ”¯æŒåŒå¼•æ“ï¼ˆLSTMå’Œä¼ ç»Ÿå¼•æ“ï¼‰ï¼Œä½†LSTMè®­ç»ƒæ•°æ®ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬</li>
</ul>
<p>æ¨èä½¿ç”¨<a href="https://github.com/tesseract-ocr/tessdata_best">tessdata_best</a>ï¼Œè™½ç„¶è¯†åˆ«é€Ÿåº¦ç›¸å¯¹äº<a href="https://github.com/tesseract-ocr/tessdata_fast">tessdata_fast</a>ç¨æ…¢ï¼Œä½†æ˜¯å‡†ç¡®ç‡å¯ä»¥ä¿è¯ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://github.com/tesseract-ocr/tesseract/wiki">tesseract-ocr-wiki</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Tesseract-Ocr</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨certbotç»™ç½‘ç«™ä¸Šå…è´¹çš„SSLè¯ä¹¦</title>
    <url>/p/16060/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»‹ç»ä½¿ç”¨<a href="">certbot</a>ä¸ºç½‘ç«™æ·»åŠ HTTPSæ”¯æŒï¼Œå¹¶è‡ªåŠ¨æ›´æ–°</p>
<span id="more"></span>

<h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><ul>
<li>docker</li>
<li>docker-compose</li>
</ul>
<h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><h2 id="å…‹éš†ä»“åº“"><a href="#å…‹éš†ä»“åº“" class="headerlink" title="å…‹éš†ä»“åº“"></a>å…‹éš†ä»“åº“</h2><blockquote>
<p>è¿™ä¸€æ­¥å¿…ä¸å¯å°‘ï¼Œä¸€å®šè¦æŒ‰ç…§ä½œè€…çš„ä»“åº“ç›®å½•ç»“æ„æ¥æ‰§è¡Œï¼Œå®Œæˆåï¼Œå¯ä»¥è‡ªè¡Œæ›´æ”¹<code>nginx/conf.d</code>ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>å…·ä½“åŸå› æˆ‘ä¹Ÿä¸çŸ¥ï¼Œä½†æ˜¯ä¸ç…§åšï¼Œä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir -p /data</span><br><span class="line">$ <span class="built_in">cd</span> /data</span><br><span class="line">$ git <span class="built_in">clone</span> https://ghproxy.com/https://github.com/gcdd1993/nginx-certbot</span><br><span class="line">$ <span class="built_in">cd</span> nginx-certbot</span><br><span class="line">$ ls -l</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jun  8 22:01 ./</span><br><span class="line">drwxr-xr-x 5 root root 4096 Jun  8 21:49 ../</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jun  8 21:53 data/</span><br><span class="line">-rw-r--r-- 1 root root  660 Jun  8 21:49 docker-compose.yml</span><br><span class="line">drwxr-xr-x 8 root root 4096 Jun  8 21:49 .git/</span><br><span class="line">-rw-r--r-- 1 root root   14 Jun  8 21:49 .gitignore</span><br><span class="line">-rwxr-xr-x 1 root root 2286 Jun  8 22:01 init-letsencrypt.sh*</span><br><span class="line">-rw-r--r-- 1 root root 1074 Jun  8 21:49 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root 1376 Jun  8 21:49 README.md</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ºåŸŸåæ·»åŠ è¯ä¹¦"><a href="#ä¸ºåŸŸåæ·»åŠ è¯ä¹¦" class="headerlink" title="ä¸ºåŸŸåæ·»åŠ è¯ä¹¦"></a>ä¸ºåŸŸåæ·»åŠ è¯ä¹¦</h2><blockquote>
<p>ğŸ’¡åœ¨è¿™ä¸€æ­¥æ‰§è¡Œå‰ï¼Œè¯·ç¡®è®¤å·²ç»å°†éœ€è¦æ·»åŠ è¯ä¹¦çš„åŸŸåæŒ‡å‘æœ¬æœºå…¬ç½‘IPï¼Œå› ä¸ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡ŒæœåŠ¡å™¨æ‰€å±æƒæ ¡éªŒï¼Œéœ€è¦è®¿é—®ä½ æ‰€æ“ä½œçš„åŸŸå</p>
</blockquote>
<h3 id="1ã€ä¿®æ”¹init-letsencrypt-shçš„emailä¸ºä½ çš„é‚®ç®±"><a href="#1ã€ä¿®æ”¹init-letsencrypt-shçš„emailä¸ºä½ çš„é‚®ç®±" class="headerlink" title="1ã€ä¿®æ”¹init-letsencrypt.shçš„emailä¸ºä½ çš„é‚®ç®±"></a>1ã€ä¿®æ”¹<code>init-letsencrypt.sh</code>çš„<code>email</code>ä¸ºä½ çš„é‚®ç®±</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim init-letsencrypt.sh</span><br><span class="line">...</span><br><span class="line">email=<span class="string">&quot;gcwm99@gmail.com&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="2ã€ä¿®æ”¹æ“ä½œåŸŸå"><a href="#2ã€ä¿®æ”¹æ“ä½œåŸŸå" class="headerlink" title="2ã€ä¿®æ”¹æ“ä½œåŸŸå"></a>2ã€ä¿®æ”¹æ“ä½œåŸŸå</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sed -i <span class="string">&#x27;s/example.org/your_domain/g&#x27;</span> data/nginx/app.conf \</span><br><span class="line">	&amp;&amp; sed -i <span class="string">&#x27;s/example.org/your_domain/g&#x27;</span> init-letsencrypt.sh</span><br></pre></td></tr></table></figure>

<h3 id="3ã€æ‰§è¡Œinit-letsencrypt-sh"><a href="#3ã€æ‰§è¡Œinit-letsencrypt-sh" class="headerlink" title="3ã€æ‰§è¡Œinit-letsencrypt.sh"></a>3ã€æ‰§è¡Œ<code>init-letsencrypt.sh</code></h3><blockquote>
<p>ç›´åˆ°å‡ºç°ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜å·²ç»å®Œæˆ</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./init-letsencrypt.sh</span><br><span class="line">...</span><br><span class="line">Requesting a certificate <span class="keyword">for</span> your_domain</span><br><span class="line"></span><br><span class="line">Successfully received certificate.</span><br><span class="line">Certificate is saved at: /etc/letsencrypt/live/your_domain/fullchain.pem</span><br><span class="line">Key is saved at:         /etc/letsencrypt/live/your_domain/privkey.pem</span><br><span class="line">This certificate expires on 2021-09-06.</span><br><span class="line">These files will be updated when the certificate renews.</span><br><span class="line"></span><br><span class="line">NEXT STEPS:</span><br><span class="line">- The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate <span class="keyword">in</span> the background, but you may need to take steps to <span class="built_in">enable</span> that functionality. See https://certbot.org/renewal-setup <span class="keyword">for</span> instructions.</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">If you like Certbot, please consider supporting our work by:</span><br><span class="line">* Donating to ISRG / Let<span class="string">&#x27;s Encrypt:   https://letsencrypt.org/donate</span></span><br><span class="line"><span class="string">* Donating to EFF:                    https://eff.org/donate-le</span></span><br><span class="line"><span class="string">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br></pre></td></tr></table></figure>

<h3 id="4ã€å¤šåŸŸåæ“ä½œ"><a href="#4ã€å¤šåŸŸåæ“ä½œ" class="headerlink" title="4ã€å¤šåŸŸåæ“ä½œ"></a>4ã€å¤šåŸŸåæ“ä½œ</h3><blockquote>
<p>æ­¥éª¤åŒä¸Šï¼Œå…ˆä¿®æ”¹åŸŸåä¸ºå¾…æ“ä½œåŸŸåï¼Œç„¶åæ‰§è¡Œ<code>init-letsencrypt.sh</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sed -i <span class="string">&#x27;s/your_domain/your_domain2/g&#x27;</span> data/nginx/app.conf \</span><br><span class="line">	&amp;&amp; sed -i <span class="string">&#x27;s/your_domain/your_domain2/g&#x27;</span> init-letsencrypt.sh</span><br><span class="line">$ ./init-letsencrypt.sh</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="5ã€å¯åŠ¨ä½ çš„ç½‘ç«™"><a href="#5ã€å¯åŠ¨ä½ çš„ç½‘ç«™" class="headerlink" title="5ã€å¯åŠ¨ä½ çš„ç½‘ç«™"></a>5ã€å¯åŠ¨ä½ çš„ç½‘ç«™</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Šapp.conf</span></span><br><span class="line">$ <span class="built_in">cd</span> data/nginx</span><br><span class="line">$ mv app.conf app.conf.bak</span><br><span class="line"><span class="comment"># æ·»åŠ ä½ çš„ç½‘ç«™é…ç½®</span></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹é…ç½®</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> my.site &#123;</span><br><span class="line">    <span class="attribute">server</span> localhost:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> your_domain;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">600s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">600s</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">add_header</span> X-Frame-Options deny;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://my.site;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your_domain/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your_domain/privkey.pem;</span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;</span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> ($host = your_domain) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://$host$request_uri;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> your_domain;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ›´æ–°è¯ä¹¦"><a href="#æ›´æ–°è¯ä¹¦" class="headerlink" title="æ›´æ–°è¯ä¹¦"></a>æ›´æ–°è¯ä¹¦</h1><blockquote>
<p>ä½œè€…ç»™å‡ºçš„<code>docker-compose.yml</code>å·²ç»é»˜è®¤12å°æ—¶æ£€æŸ¥å¹¶æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥éå¸¸çœå¿ƒ</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it nginx-certbot_certbot_1 certbot renew</span><br><span class="line">...</span><br><span class="line">The following certificates are not due <span class="keyword">for</span> renewal yet:</span><br><span class="line">  /etc/letsencrypt/live/your_domain/fullchain.pem expires on 2021-09-06 (skipped)</span><br><span class="line">No renewals were attempted.</span><br></pre></td></tr></table></figure>

<h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ul>
<li><a href="https://github.com/certbot/certbot">certbot</a></li>
<li><a href="https://github.com/gcdd1993/nginx-certbot">nginx-certbot</a></li>
</ul>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>é»˜è®¤</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦XXL-JOBåˆä½“éªŒ</title>
    <url>/p/29085/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><a href="http://www.xuxueli.com/xxl-job/#/">XXL-JOB</a>æ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚<span id="more"></span></p>
<p>å®˜æ–¹æ–‡æ¡£å¾ˆå®Œå–„ï¼Œä¸å¤šèµ˜è¿°ã€‚æœ¬æ–‡ä¸»è¦æ˜¯æ­å»º<code>XXL-JOB</code>å’Œç®€å•ä½¿ç”¨çš„è®°å½•ã€‚</p>
<h1 id="æ­å»ºxxl-job-adminç®¡ç†ç«¯"><a href="#æ­å»ºxxl-job-adminç®¡ç†ç«¯" class="headerlink" title="æ­å»ºxxl-job-adminç®¡ç†ç«¯"></a>æ­å»ºxxl-job-adminç®¡ç†ç«¯</h1><h2 id="è¿è¡Œç¯å¢ƒ"><a href="#è¿è¡Œç¯å¢ƒ" class="headerlink" title="è¿è¡Œç¯å¢ƒ"></a>è¿è¡Œç¯å¢ƒ</h2><ul>
<li>Ubuntu 16.04 64ä½</li>
<li>Mysql 5.7</li>
</ul>
<h3 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment">## è®¾ç½®mysqlï¼Œä¸»è¦æ˜¯å®‰å…¨æ–¹é¢çš„ï¼Œå¯†ç ç­–ç•¥ç­‰</span></span><br><span class="line">$ mysql_secure_installation</span><br><span class="line"><span class="comment">## é…ç½®è¿œç¨‹è®¿é—®</span></span><br><span class="line">$ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line">$ sudo service mysql restart</span><br><span class="line">$ sudo service mysql status</span><br><span class="line">â— mysql.service - MySQL Community Server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2019-06-05 13:23:41 HKT; 45s ago</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">mysql&gt; CREATE database <span class="keyword">if</span> NOT EXISTS `xxl-job` default character <span class="built_in">set</span> utf8 collate utf8_general_ci;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">mysql&gt; CREATE USER <span class="string">&#x27;xxl-job&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;xxlJob2019@&#x27;</span>;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON `xxl-job`.* TO <span class="string">&#x27;xxl-job&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="æœ¬åœ°æµ‹è¯•xxl-job-admin"><a href="#æœ¬åœ°æµ‹è¯•xxl-job-admin" class="headerlink" title="æœ¬åœ°æµ‹è¯•xxl-job-admin"></a>æœ¬åœ°æµ‹è¯•xxl-job-admin</h2><h3 id="æ‹‰å–æœ€æ–°æºç "><a href="#æ‹‰å–æœ€æ–°æºç " class="headerlink" title="æ‹‰å–æœ€æ–°æºç "></a>æ‹‰å–æœ€æ–°æºç </h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:xuxueli/xxl-job.git</span><br><span class="line">$ <span class="built_in">cd</span> xxl-job</span><br></pre></td></tr></table></figure>

<h3 id="å¯¼å…¥é¡¹ç›®"><a href="#å¯¼å…¥é¡¹ç›®" class="headerlink" title="å¯¼å…¥é¡¹ç›®"></a>å¯¼å…¥é¡¹ç›®</h3><p>æˆ‘æ¯”è¾ƒç†Ÿæ‚‰<code>Idea</code>å¼€å‘å·¥å…·ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨<code>Idea</code>çš„<code>Gradle</code>é¡¹ç›®è¿›è¡Œæ¼”ç¤ºã€‚</p>
<p>æ‰“å¼€<code>xxl-job</code>ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹</p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf75c6d3250b91960.png"></p>
<h3 id="æµ‹è¯•é¡¹ç›®"><a href="#æµ‹è¯•é¡¹ç›®" class="headerlink" title="æµ‹è¯•é¡¹ç›®"></a>æµ‹è¯•é¡¹ç›®</h3><p>æ‰“å¼€<code>xxl-job-admin/resources/application.properties</code>ï¼Œä¿®æ”¹mysqlè¿æ¥ä¿¡æ¯</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### xxl-job, datasource</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://192.168.32.129:3306/xxl-job?Unicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">xxl-job</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">xxlJob2019@</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>/xxl-job/doc/db/tables_xxl_job.sql</code>åˆå§‹åŒ–æ•°æ®åº“ï¼Œåˆå§‹åŒ–å®Œåº”è¯¥å¦‚ä¸‹å›¾</p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf75ee24c52a19926.png"></p>
<p>å‡†å¤‡å°±ç»ªåï¼Œå°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ï¼Œç„¶åæ‰“å¼€åœ°å€<a href="http://localhost:8080/xxl-job-admin%E5%B0%86%E4%BC%9A%E7%9C%8B%E5%88%B0%E9%A6%96%E9%A1%B5">http://localhost:8080/xxl-job-adminå°†ä¼šçœ‹åˆ°é¦–é¡µ</a></p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf77d0844d8895768.png"></p>
<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="æ‰“åŒ…è°ƒåº¦ä¸­å¿ƒ"><a href="#æ‰“åŒ…è°ƒåº¦ä¸­å¿ƒ" class="headerlink" title="æ‰“åŒ…è°ƒåº¦ä¸­å¿ƒ"></a>æ‰“åŒ…è°ƒåº¦ä¸­å¿ƒ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /xxl-job</span><br><span class="line">$ mvn install</span><br><span class="line">...</span><br><span class="line">[INFO] xxl-job ............................................ SUCCESS [  0.513 s]</span><br><span class="line">[INFO] xxl-job-core ....................................... SUCCESS [  4.258 s]</span><br><span class="line">[INFO] xxl-job-admin ...................................... SUCCESS [  5.525 s]</span><br><span class="line">[INFO] xxl-job-executor-samples ........................... SUCCESS [  0.016 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-spring ..................... SUCCESS [  2.188 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-springboot ................. SUCCESS [  0.892 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-jfinal ..................... SUCCESS [  1.753 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-nutz ....................... SUCCESS [  1.316 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-frameless .................. SUCCESS [  0.358 s]</span><br><span class="line">[INFO] xxl-job-executor-sample-jboot ...................... SUCCESS [  1.279 s]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  18.549 s</span><br><span class="line">[INFO] Finished at: 2019-06-05T14:40:25+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°ä»¥ä¸Šä¿¡æ¯ï¼Œè¯´æ˜æˆ‘ä»¬æ‰“åŒ…æˆåŠŸäº†ï¼Œåœ¨<code>/xxl-job/xxl-job-admin</code>ç›®å½•ä¸‹ä¼šå­˜åœ¨jaræ–‡ä»¶ï¼š<code>xxl-job-admin-2.1.0-SNAPSHOT.jar</code></p>
<h3 id="éƒ¨ç½²åˆ°æœåŠ¡å™¨"><a href="#éƒ¨ç½²åˆ°æœåŠ¡å™¨" class="headerlink" title="éƒ¨ç½²åˆ°æœåŠ¡å™¨"></a>éƒ¨ç½²åˆ°æœåŠ¡å™¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt install openjdk-8-jdk</span><br><span class="line">$ java -version</span><br><span class="line">openjdk version <span class="string">&quot;1.8.0_212&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_212-8u212-b03-0ubuntu1.16.04.1-b03)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.212-b03, mixed mode)</span><br><span class="line"></span><br><span class="line">$ sudo mkdir -p /data/xxl-job</span><br><span class="line">$ sudo <span class="built_in">cd</span> /data/xxl-job</span><br><span class="line"><span class="comment">## ä¸Šä¼ æˆ‘ä»¬æ‰“åŒ…å¥½çš„jarè‡³æ­¤ç›®å½•ï¼Œå¹¶æ·»åŠ è½¯è¿æ¥</span></span><br><span class="line">$ sudo ln -s xxl-job-admin-2.1.0-SNAPSHOT.jar current.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ³¨å†Œä¸ºsystemæœåŠ¡ï¼Œå¯ä»¥è¾¾åˆ°å¼‚å¸¸é‡å¯ï¼Œå¼€æœºè‡ªå¯ç­‰ç›®çš„</span></span><br><span class="line">$ sudo vim /etc/systemd/system/xxl-job.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=xxl-job Service Daemon</span><br><span class="line">After=mysql.service</span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;JAVA_OPTS= -Xmx1024m -Xms1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:NewRatio=3 -Dserver.port=8081&quot;</span></span><br><span class="line"><span class="comment"># javaè¦å†™ç»å¯¹è·¯å¾„</span></span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/jdk/bin/java -jar /data/xxl-job/current.jar</span><br><span class="line">Restart=always</span><br><span class="line">WorkingDirectory=/data/xxl-job/</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> xxl-job.service</span><br><span class="line">$ sudo service xxl-job start</span><br><span class="line">$ sudo service xxl-job status</span><br><span class="line">â— xxl-job.service - xxl-job Service Daemon</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/xxl-job.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Thu 2019-07-18 18:19:08 CST; 2min 19s ago</span><br><span class="line"> Main PID: 27572 (java)</span><br><span class="line">   CGroup: /system.slice/xxl-job.service</span><br><span class="line">           â””â”€27572 /usr/<span class="built_in">local</span>/jdk/bin/java -jar /data/xxl-job/current.jar</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è®¿é—®ä¸€ä¸‹<a href="http://192.168.32.129:8080/xxl-job-admin%EF%BC%9A">http://192.168.32.129:8080/xxl-job-adminï¼š</a></p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf7706901fb080448.png"></p>
<h1 id="æµ‹è¯•ä»»åŠ¡è°ƒåº¦"><a href="#æµ‹è¯•ä»»åŠ¡è°ƒåº¦" class="headerlink" title="æµ‹è¯•ä»»åŠ¡è°ƒåº¦"></a>æµ‹è¯•ä»»åŠ¡è°ƒåº¦</h1><p>ä»¥ä¸Šï¼Œæˆ‘ä»¬çš„ä»»åŠ¡è°ƒåº¦ç®¡ç†ç«¯å·²ç»æ­å»ºå®Œæˆï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸‹ä»»åŠ¡è°ƒåº¦ã€‚</p>
<p>ç›´æ¥ä½¿ç”¨è‡ªå¸¦çš„<code>SpringBoot</code>æµ‹è¯•é¡¹ç›®<code>xxl-job-executor-sample-springboot</code>è¿›è¡Œæµ‹è¯•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">xxl-job-executor-sample-springboot</span>=<span class="string">http://192.168.32.129:8080/xxl-job-admin</span></span><br></pre></td></tr></table></figure>

<h2 id="è‡ªå®šä¹‰ä»»åŠ¡"><a href="#è‡ªå®šä¹‰ä»»åŠ¡" class="headerlink" title="è‡ªå®šä¹‰ä»»åŠ¡"></a>è‡ªå®šä¹‰ä»»åŠ¡</h2><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œæ‰“å°100æ¬¡å½“å‰åºåˆ—</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxl.job.executor.service.jobhandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.biz.model.ReturnT;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.IJobHandler;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.handler.annotation.JobHandler;</span><br><span class="line"><span class="keyword">import</span> com.xxl.job.core.log.XxlJobLogger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JobHandler(value=&quot;gcddJobHandler&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GcddJobHandler</span> <span class="keyword">extends</span> <span class="title">IJobHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReturnT&lt;String&gt; <span class="title">execute</span><span class="params">(String param)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            XxlJobLogger.log(<span class="string">&quot;XXL-JOB, print &quot;</span> + i);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨æ‰§è¡Œå™¨"><a href="#å¯åŠ¨æ‰§è¡Œå™¨" class="headerlink" title="å¯åŠ¨æ‰§è¡Œå™¨"></a>å¯åŠ¨æ‰§è¡Œå™¨</h2><p>ç„¶åå¯åŠ¨æ‰§è¡Œå™¨ï¼Œå¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬ä¼šå‘ç°ç®¡ç†é¡µé¢çš„æ‰§è¡Œå™¨åˆ—è¡¨ä¼šå¤šå‡ºæˆ‘ä»¬åˆšæ‰å¯åŠ¨çš„æ‰§è¡Œå™¨</p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf7737de7cad58644.png"></p>
<h2 id="æ·»åŠ ä»»åŠ¡"><a href="#æ·»åŠ ä»»åŠ¡" class="headerlink" title="æ·»åŠ ä»»åŠ¡"></a>æ·»åŠ ä»»åŠ¡</h2><p><img data-src="https://i.loli.net/2019/06/05/5cf776088e84c40188.png"></p>
<p><img data-src="https://i.loli.net/2019/06/05/5cf77809c3c2d16509.png"></p>
<h2 id="æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—"><a href="#æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—" class="headerlink" title="æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—"></a>æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—</h2><p><img data-src="https://i.loli.net/2019/06/05/5cf7782580be085791.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»»åŠ¡å·²ç»æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ’æ‰§è¡ŒæˆåŠŸäº†ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚</p>
<h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æƒ³è¦äº†è§£æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·è®¿é—®<a href="http://www.xuxueli.com/xxl-job/#/">xxl-jobå®˜ç½‘</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>xxl-job</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘å¸ƒå¼€æºé¡¹ç›®åˆ°Jcenter</title>
    <url>/p/53809/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote>
<p>ä¸ºäº†å°†<a href="https://gcdd1993.github.io/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8/">é˜¿é‡Œäº‘çŸ­ä¿¡å¼€ç®±å³ç”¨</a>å‘å¸ƒåˆ°Jcenterä»“åº“ï¼Œå‰å‰ååèŠ±è´¹äº†1å¤©åŠçš„æ—¶é—´ï¼ŒæŠŠç«¯åˆèŠ‚éƒ½æ­è¿›å»äº†ã€‚ç»ˆäºä»Šå¤©æ”¶åˆ°äº†Jcenterçš„æ¶ˆæ¯ï¼Œè‡ªå·±å‘å¸ƒçš„åŒ…è¢«æ·»åŠ åˆ°äº†Jcenterä»“åº“ï¼Œä¹Ÿç®—ç»™å¼€æºç¤¾åŒºåšäº†æ¬¡å°è´¡çŒ®ğŸ˜ğŸ˜ğŸ˜ã€‚</p>
</blockquote>
<span id="more"></span>

<p><img data-src="https://i.loli.net/2019/06/10/5cfe1b03c61ee37109.png"></p>
<p>ç°åœ¨è®°å½•ä¸‹è¸©è¿‡çš„å‘ã€‚</p>
<h1 id="æ³¨å†ŒJcenterè´¦å·"><a href="#æ³¨å†ŒJcenterè´¦å·" class="headerlink" title="æ³¨å†ŒJcenterè´¦å·"></a>æ³¨å†ŒJcenterè´¦å·</h1><p>è¦æ³¨æ„çš„åœ°æ–¹ï¼ŒJcenterè´¦å·è·Ÿå›½å†…ä¸€æ ·åˆ†ä¸ºç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆï¼Œä¼ä¸šç‰ˆå½“ç„¶æ˜¯è¦ä»˜è´¹çš„ï¼Œè€Œä¸”å¾ˆå‘çš„æ˜¯ç‚¹è¿›Bintrayå®˜ç½‘ï¼Œé¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯å¤§å¤§çš„<code>Start Your Free Trial</code>ï¼ˆå¼€å§‹å…è´¹è¯•ç”¨ï¼‰ï¼Œä¸€å¼€å§‹æˆ‘å°±æ³¨å†Œäº†ä¼ä¸šç‰ˆè´¦å·ï¼Œåæ¥åˆ å·é‡å»ºäº†ğŸ˜‚ã€‚æˆ‘ä»¬åº”è¯¥ç‚¹è¿™é‡Œï¼š</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe1c155f37b42837.png"></p>
<p>å¡«å†™ä¿¡æ¯åæ³¨å†Œï¼Œæˆ‘æ˜¯ç›´æ¥ä½¿ç”¨çš„Githubè´¦å·æ³¨å†Œã€‚</p>
<h1 id="åˆ›å»ºRepository"><a href="#åˆ›å»ºRepository" class="headerlink" title="åˆ›å»ºRepository"></a>åˆ›å»ºRepository</h1><p>ç‚¹å‡»å³ä¸Šè§’<code>View Profile</code></p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe1cd1576dc26645.png"></p>
<p>åœ¨è´¦å·ä¿¡æ¯ä¸‹æ–¹ï¼Œæˆ‘ä»¬ç‚¹å‡»<code>Add New Repository</code>ï¼Œåˆ›å»ºæ–°çš„ä»“åº“ã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe1d28b975050822.png"></p>
<p>åœ¨å¡«å†™ä¿¡æ¯çš„æ—¶å€™ï¼Œé€‰æ‹©Publicï¼ˆPrivateæ˜¯éœ€è¦ä»˜é’±çš„ï¼Œå¤§å®¶éƒ½æ‡‚ï¼‰ï¼Œå¦‚æœä½ æ˜¯mavené¡¹ç›®ï¼Œä»“åº“åæœ€å¥½å¡«å†™mavenï¼Œå› ä¸ºæˆ‘åœ¨ç”³è¯·<code>Add To Jcenter</code>æ—¶ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥äº†ï¼Œè¦æ±‚æˆ‘æŠŠé¡¹ç›®æ”¾åœ¨mavenè·¯å¾„ä¸‹ã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe224c9096c25001.png"></p>
<h1 id="åˆ›å»ºPackage"><a href="#åˆ›å»ºPackage" class="headerlink" title="åˆ›å»ºPackage"></a>åˆ›å»ºPackage</h1><p>åˆ›å»ºå®Œä»“åº“ï¼Œå°±æ˜¯åˆ›å»ºåŒ…äº†ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½ çš„åº”ç”¨å«å•¥åï¼ŒåŒ…å°±å«å•¥åå°±è¡Œã€‚</p>
<p>åˆ›å»ºå®Œå¯ä»¥çœ‹åˆ°åŒ…çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe238ec652b53623.png"></p>
<h1 id="æ‰“åŒ…ä¸Šä¼ "><a href="#æ‰“åŒ…ä¸Šä¼ " class="headerlink" title="æ‰“åŒ…ä¸Šä¼ "></a>æ‰“åŒ…ä¸Šä¼ </h1><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯å¼€æºé¡¹ç›®<a href="https://github.com/novoda/bintray-release">bintray-release</a>ï¼Œå®˜æ–¹æ–‡æ¡£<a href="%5Bhttps://github.com/novoda/bintray-release/wiki/%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3HOME%5D(https://github.com/novoda/bintray-release/wiki/%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3HOME)">bintray-release/wiki</a></p>
<p>ä¸»è¦åœ¨<code>build.gradle</code>é‡Œæ·»åŠ å¦‚ä¸‹ä¿¡æ¯</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&#x27;com.novoda:bintray-release:0.9.1&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.novoda.bintray-release&#x27;</span></span><br><span class="line"></span><br><span class="line">publish &#123;</span><br><span class="line">    userOrg = <span class="string">&#x27;ä½ çš„Bintrayç”¨æˆ·å&#x27;</span></span><br><span class="line">    groupId = <span class="string">&#x27;åº”ç”¨çš„groupIdï¼Œä¾‹å¦‚ï¼šio.github.gcdd1993&#x27;</span></span><br><span class="line">    artifactId = <span class="string">&#x27;åº”ç”¨çš„åç§°ï¼Œä¾‹å¦‚ï¼šali-sms-spring-boot-starter&#x27;</span></span><br><span class="line">    publishVersion = <span class="string">&#x27;åº”ç”¨çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼š1.0.0.RELEASE&#x27;</span></span><br><span class="line">    desc = <span class="string">&#x27;ä¸€å¥è¯æ¦‚è¿°ä½ çš„åº”ç”¨å¹²å•¥çš„&#x27;</span></span><br><span class="line">    website = <span class="string">&#x27;åº”ç”¨é“¾æ¥ï¼Œä¸€èˆ¬å†™githubåœ°å€å°±è¡Œï¼Œä¾‹å¦‚ï¼šhttps://github.com/gcdd1993/ali-sms-spring-boot-starter&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±åŠ çš„</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸€ä¸ªè§£å†³Gradle Task:jar skippedçš„é—®é¢˜</span></span><br><span class="line"><span class="comment"> * ç¬¬äºŒä¸ªè§£å†³javaDoc &#x27;UTF-8&#x27;ä¹±ç é—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">jar &#123;</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123;</span><br><span class="line">    options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ‰§è¡Œ<code>gradle</code>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./gradlew bintrayUpload -PbintrayUser=BINTRAY_USERNAME -PbintrayKey=BINTRAY_KEY -PdryRun=false</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æµ‹è¯•å¯ä»¥æŠŠ<code>-PdryRun=false</code>æ”¹ä¸º<code>-PdryRun=true</code>ï¼Œè¿™æ ·å°±ä¸ä¼šå¸®ä½ ä¸Šä¼ åˆ°Bintrayï¼Œå…¶ä»–çš„éƒ½æ‰§è¡Œã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe29fbd33a449878.png"></p>
<p>çœ‹åˆ°ä»¥ä¸Šä¿¡æ¯ï¼Œè¯æ˜å‘å¸ƒæˆåŠŸäº†ã€‚</p>
<h1 id="Add-To-Jcenter"><a href="#Add-To-Jcenter" class="headerlink" title="Add To Jcenter"></a>Add To Jcenter</h1><p>å‘å¸ƒæˆåŠŸåï¼Œä½ åº”è¯¥ä¼šåœ¨Packageçš„Filesæ ‡ç­¾ä¸‹çœ‹åˆ°ä½ ä¸Šä¼ çš„æ–‡ä»¶</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe2aa92b4af15397.png"></p>
<p>æˆ‘ä»¬ç‚¹å‡»å³ä¸Šè§’Actionsä¸‹çš„Add To Jcenter</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe2b006401429419.png"></p>
<p>å¡«å†™ä¿¡æ¯ï¼Œä¸¤ä¸ªå¤é€‰æ¡†æˆ‘éƒ½å‹¾é€‰äº†ï¼Œç„¶åå¡«å†™Group Idï¼Œå¡«ä¸Šåº”ç”¨è¯´æ˜ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ï¼Œç„¶åç­‰ç€å°±è¡Œäº†ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´1~3å¤©ä½ å°†ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œé€šçŸ¥ä½ çš„ç”³è¯·é€šè¿‡æ²¡æœ‰ï¼Œå¦‚ä¸‹</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe2ba396f2386226.png"></p>
<p>ğŸ‘‰å¦‚æœæ²¡æœ‰é€šè¿‡ï¼Œä¹Ÿä¼šå‘Šè¯‰ä½ æ€ä¹ˆæ”¹ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚</p>
<p>è¿™æ—¶å€™å†æ‰“å¼€Bintrayçš„Packageé¡µé¢ï¼Œä¼šå‘ç°<code>Included In Jcenter</code>ï¼Œè¯æ˜å·²ç»è¢«Jcenteræ”¶å½•äº†ï¼Œå…¶ä»–äººå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å•¦ã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe2c01e777524132.png"></p>
<h1 id="Travis-CIæŒç»­é›†æˆ"><a href="#Travis-CIæŒç»­é›†æˆ" class="headerlink" title="Travis CIæŒç»­é›†æˆ"></a>Travis CIæŒç»­é›†æˆ</h1><p>Travis CIæ˜¯ä»€ä¹ˆå°±ä¸ä»‹ç»äº†ï¼Œä¸æ˜ç™½çš„å¯ä»¥çœ‹ä¸‹<a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—-æŒç»­é›†æˆæœåŠ¡ Travis CI æ•™ç¨‹</a>ï¼ŒGithubå…¬å¼€ä»“åº“å…è´¹çš„æŒç»­é›†æˆå·¥å…·ã€‚</p>
<p>é¡¹ç›®æ ¹ç›®å½•æ·»åŠ <code>.travis.yml</code>ï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼ˆé’ˆå¯¹Gradleæ­å»ºçš„Javaé¡¹ç›®é€‚ç”¨ï¼‰</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">java</span></span><br><span class="line"><span class="attr">sudo:</span> <span class="string">required</span></span><br><span class="line"><span class="attr">dist:</span> <span class="string">xenial</span></span><br><span class="line"><span class="attr">jdk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">openjdk8</span></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">before_cache:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-f</span>  <span class="string">$HOME/.gradle/caches/modules-2/modules-2.lock</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-fr</span> <span class="string">$HOME/.gradle/caches/*/plugin-resolution/</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">directories:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$HOME/.gradle/caches/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$HOME/.gradle/wrapper/</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">chmod</span> <span class="string">+x</span> <span class="string">gradlew</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./gradlew</span> <span class="string">jar</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./gradlew</span> <span class="string">bintrayUpload</span> <span class="string">-PbintrayUser=$&#123;bintray_user&#125;</span> <span class="string">-PbintrayKey=$&#123;bintray_key&#125;</span> <span class="string">-PdryRun=false</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å˜é‡<code>$&#123;bintray_user&#125;</code>å’Œ<code>$&#123;bintray_key&#125;</code>æ˜¯Travis CIè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ï¼Œè¯·åˆ°<a href="https://travis-ci.org/%7Byour-travis-ci-username%7D/ali-sms-spring-boot-starter/settings">Travis CI Settings</a>å¡«å†™ã€‚</p>
<p><img data-src="https://i.loli.net/2019/06/10/5cfe28657c37a76232.png"></p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><p><a href="https://github.com/HailouWang/bintray-release/wiki">bintray-release-wiki</a></p>
</li>
<li><p><a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Maven Publish Plugin</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—-æŒç»­é›†æˆæœåŠ¡ Travis CI æ•™ç¨‹</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Jcenter</tag>
      </tags>
  </entry>
  <entry>
    <title>åç«¯è·¨åŸŸçš„Nç§æ–¹æ³•</title>
    <url>/p/34331/</url>
    <content><![CDATA[<blockquote>
<p>ç®€å•æ¥è¯´ï¼ŒCORSæ˜¯ä¸€ç§è®¿é—®æœºåˆ¶ï¼Œè‹±æ–‡å…¨ç§°æ˜¯Cross-Origin Resource Sharingï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸèµ„æºå…±äº«ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®å“åº”å¤´ï¼ŒæŠŠå‘èµ·è·¨åŸŸçš„åŸå§‹åŸŸåæ·»åŠ åˆ°Access-Control-Allow-Origin å³å¯ã€‚</p>
</blockquote>
<span id="more"></span>

<h1 id="è¿”å›æ–°çš„CorsFilter-å…¨å±€è·¨åŸŸ"><a href="#è¿”å›æ–°çš„CorsFilter-å…¨å±€è·¨åŸŸ" class="headerlink" title="è¿”å›æ–°çš„CorsFilter(å…¨å±€è·¨åŸŸ)"></a>è¿”å›æ–°çš„CorsFilter(å…¨å±€è·¨åŸŸ)</h1><blockquote>
<p>åœ¨ä»»æ„é…ç½®ç±»ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„CorsFilter Beanï¼Œå¹¶æ·»åŠ æ˜ å°„è·¯å¾„å’Œå…·ä½“çš„CORSé…ç½®ä¿¡æ¯ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.æ·»åŠ CORSé…ç½®ä¿¡æ¯</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å‘é€Cookieä¿¡æ¯</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ(è¯·æ±‚æ–¹å¼)</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ(å¤´éƒ¨ä¿¡æ¯)</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//æš´éœ²å“ªäº›å¤´éƒ¨ä¿¡æ¯(å› ä¸ºè·¨åŸŸè®¿é—®é»˜è®¤ä¸èƒ½è·å–å…¨éƒ¨å¤´éƒ¨ä¿¡æ¯)</span></span><br><span class="line">        config.addExposedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ·»åŠ æ˜ å°„è·¯å¾„</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.è¿”å›æ–°çš„CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä½¿ç”¨æ³¨è§£-å±€éƒ¨è·¨åŸŸ"><a href="#ä½¿ç”¨æ³¨è§£-å±€éƒ¨è·¨åŸŸ" class="headerlink" title="ä½¿ç”¨æ³¨è§£(å±€éƒ¨è·¨åŸŸ)"></a>ä½¿ç”¨æ³¨è§£(å±€éƒ¨è·¨åŸŸ)</h1><h2 id="åœ¨æ–¹æ³•ä¸Š-RequestMapping-ä½¿ç”¨æ³¨è§£-CrossOrigin"><a href="#åœ¨æ–¹æ³•ä¸Š-RequestMapping-ä½¿ç”¨æ³¨è§£-CrossOrigin" class="headerlink" title="åœ¨æ–¹æ³•ä¸Š(@RequestMapping)ä½¿ç”¨æ³¨è§£ @CrossOrigin"></a>åœ¨æ–¹æ³•ä¸Š(@RequestMapping)ä½¿ç”¨æ³¨è§£ <code>@CrossOrigin</code></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@CrossOrigin(&quot;http://localhost:8080&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åœ¨æ§åˆ¶å™¨-Controller-ä¸Šä½¿ç”¨æ³¨è§£-CrossOrigin"><a href="#åœ¨æ§åˆ¶å™¨-Controller-ä¸Šä½¿ç”¨æ³¨è§£-CrossOrigin" class="headerlink" title="åœ¨æ§åˆ¶å™¨(@Controller)ä¸Šä½¿ç”¨æ³¨è§£ @CrossOrigin"></a>åœ¨æ§åˆ¶å™¨(@Controller)ä¸Šä½¿ç”¨æ³¨è§£ <code>@CrossOrigin</code></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;http://domain.com&quot;, maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰‹å·¥è®¾ç½®å“åº”å¤´-å±€éƒ¨è·¨åŸŸ"><a href="#æ‰‹å·¥è®¾ç½®å“åº”å¤´-å±€éƒ¨è·¨åŸŸ" class="headerlink" title="æ‰‹å·¥è®¾ç½®å“åº”å¤´(å±€éƒ¨è·¨åŸŸ)"></a>æ‰‹å·¥è®¾ç½®å“åº”å¤´(å±€éƒ¨è·¨åŸŸ)</h2><blockquote>
<p>ä½¿ç”¨HttpServletResponseå¯¹è±¡æ·»åŠ å“åº”å¤´ï¼ˆAccess-Control-Allow-Originï¼‰æ¥æˆæƒåŸå§‹åŸŸï¼Œè¿™é‡ŒOriginçš„å€¼ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºâ€*â€ ï¼Œè¡¨ç¤ºå…¨éƒ¨æ”¾è¡Œã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    response.addHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nginxé…ç½®è·¨åŸŸ"><a href="#Nginxé…ç½®è·¨åŸŸ" class="headerlink" title="Nginxé…ç½®è·¨åŸŸ"></a>Nginxé…ç½®è·¨åŸŸ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream server &#123;</span><br><span class="line">        server 127.0.0.1:8091;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name domain.com;</span><br><span class="line"></span><br><span class="line">        location ^~/api &#123;</span><br><span class="line">                //æ·»åŠ è·¨åŸŸè¯·æ±‚å¤´</span><br><span class="line">                proxy_set_header Access-Control-Allow-Origin *;</span><br><span class="line">                proxy_set_header Access-Control-Allow-Methods *;</span><br><span class="line">                proxy_set_header Access-Control-Allow-Headers *;</span><br><span class="line"></span><br><span class="line">                if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">                        return 204;</span><br><span class="line">                &#125;</span><br><span class="line">                rewrite ^/api/(.+?)$ /$1 break;</span><br><span class="line">                proxy_pass http://server;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨Dubboä¸­ä½¿ç”¨Kryoåºåˆ—åŒ–åè®®</title>
    <url>/p/34460/</url>
    <content><![CDATA[<h1 id="Kryoæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Kryoæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Kryoæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Kryoæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Kryoæ˜¯ç”¨äºJavaçš„<strong>å¿«é€Ÿé«˜æ•ˆ</strong>çš„äºŒè¿›åˆ¶å¯¹è±¡å›¾åºåˆ—åŒ–æ¡†æ¶ã€‚</p>
<blockquote>
<p>è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯é«˜é€Ÿï¼Œå°å°ºå¯¸å’Œæ˜“äºä½¿ç”¨çš„APIã€‚ä¸ç®¡æ˜¯å°†å¯¹è±¡æŒä¹…ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“è¿˜æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“æ—¶ï¼Œéƒ½å¯ä»¥å°è¯•Kryoã€‚</p>
</blockquote>
<p>Kryoè¿˜å¯ä»¥æ‰§è¡Œè‡ªåŠ¨çš„æ·±æµ…å¤åˆ¶/å…‹éš†ã€‚è¿™æ˜¯ä»å¯¹è±¡åˆ°å¯¹è±¡çš„ç›´æ¥å¤åˆ¶ï¼Œè€Œä¸æ˜¯ä»å¯¹è±¡åˆ°å­—èŠ‚çš„å¤åˆ¶ã€‚</p>
<span id="more"></span>

<p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/EsotericSoftware/kryo">Kryoå®˜ç½‘</a></p>
<h1 id="åœ¨Dubboä¸­ä½¿ç”¨Kryo"><a href="#åœ¨Dubboä¸­ä½¿ç”¨Kryo" class="headerlink" title="åœ¨Dubboä¸­ä½¿ç”¨Kryo"></a>åœ¨Dubboä¸­ä½¿ç”¨Kryo</h1><blockquote>
<p>æœ¬æ–‡åŸºäºDubboç‰ˆæœ¬2.7.8</p>
</blockquote>
<p>Dubboæ”¯æŒéå¸¸å¤šçš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¦‚<code>hession2</code>ã€<code>avro</code>ã€<code>FST</code>ç­‰ç­‰ï¼Œå…¶ä¸­Dubboå®˜ç½‘æ¨èçš„åºåˆ—åŒ–æ–¹å¼æ˜¯<code>Kryo</code>ï¼Œå› ä¸º<code>Kryo</code>æ˜¯ä¸€ç§éå¸¸æˆç†Ÿçš„åºåˆ—åŒ–å®ç°ï¼Œå·²ç»åœ¨Twitterã€Grouponã€Yahooä»¥åŠå¤šä¸ªè‘—åå¼€æºé¡¹ç›®ï¼ˆå¦‚Hiveã€Stormï¼‰ä¸­å¹¿æ³›çš„ä½¿ç”¨ã€‚</p>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>åœ¨Dubboä¸­ä½¿ç”¨Kryoéå¸¸æ–¹ä¾¿ï¼Œé¦–å…ˆå¼•å…¥ä¾èµ–</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è§£å†³ä¸€äº›Kryoç‰¹æ®Šåºåˆ—åŒ–ï¼Œhttps://github.com/magro/kryo-serializers</span></span><br><span class="line">implementation  <span class="string">&#x27;de.javakaffee:kryo-serializers:0.43&#x27;</span></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶, https://github.com/EsotericSoftware/kryo</span></span><br><span class="line">implementation <span class="string">&#x27;com.esotericsoftware:kryo:4.0.2&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœåªæ˜¯ç®€å•ä½¿ç”¨ï¼Œå¼•å…¥<a href="https://github.com/EsotericSoftware/kryo">kryo</a>å³å¯ï¼Œå¦‚æœè¦æ”¯æŒä¸€äº›ä¾‹å¦‚Listæ¥å£ï¼Œåˆ™éœ€è¦å¼•å…¥<a href="https://github.com/magro/kryo-serializers">kryo-serializers</a>ï¼Œå®ƒé’ˆå¯¹ä¸€äº›ç‰¹æ®Šç±»ä¸ºKryoåšäº†é€‚é…ã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åœ¨Dubboä¸­å¯ç”¨Kryoåºåˆ—åŒ–æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨SpringBoot YMLé…ç½®æ–¹å¼</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">serialization:</span> <span class="string">kryo</span></span><br><span class="line">    <span class="attr">optimizer:</span> <span class="string">org.hmwebframework.microservice.dubbo.serialize.SerializationOptimizerImpl</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>org.hmwebframework.microservice.dubbo.serialize.SerializationOptimizerImpl</code>æ˜¯æŒ‡å®šKryoåºåˆ—åŒ–ç±»ï¼Œä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializationOptimizerImpl</span> <span class="keyword">implements</span> <span class="title">SerializationOptimizer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;Class&gt; <span class="title">getSerializableClasses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Class&gt; classes = <span class="keyword">new</span> LinkedList&lt;Class&gt;();</span><br><span class="line">        classes.add(BidRequest.class);</span><br><span class="line">        classes.add(BidResponse.class);</span><br><span class="line">        classes.add(Device.class);</span><br><span class="line">        classes.add(Geo.class);</span><br><span class="line">        classes.add(Impression.class);</span><br><span class="line">        classes.add(SeatBid.class);</span><br><span class="line">        <span class="keyword">return</span> classes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™ï¼ŒDubboä½¿ç”¨Kryoå°±å·²ç»OKäº†ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦å®šä¹‰SerializationOptimizerå®ç°ç±»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å®šä¹‰SerializationOptimizerå®ç°ç±»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å®šä¹‰SerializationOptimizerå®ç°ç±»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å®šä¹‰SerializationOptimizerå®ç°ç±»ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬åˆ†æä¸‹SerializationOptimizer</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SerializationOptimizer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get serializable classes</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> serializable classes</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æä¾›äº†ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼Œç”¨äºè·å–åºåˆ—åŒ–çš„javaç±»å‹åˆ—è¡¨ï¼Œåœ¨<code>DubboProtocol#optimizeSerialization</code>ä¸­è¢«ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">optimizeSerialization</span><span class="params">(URL url)</span> <span class="keyword">throws</span> RpcException </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class clazz = Thread.currentThread().getContextClassLoader().loadClass(className);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºSerializationOptimizerå®ç°ç±»</span></span><br><span class="line">        <span class="keyword">if</span> (!SerializationOptimizer.class.isAssignableFrom(clazz)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">&quot;The serialization optimizer &quot;</span> + className + <span class="string">&quot; isn&#x27;t an instance of &quot;</span> + SerializationOptimizer.class.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SerializationOptimizer optimizer = (SerializationOptimizer) clazz.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (optimizer.getSerializableClasses() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†SerializationOptimizerä¸­å®šä¹‰çš„ç±»å‹åˆ—è¡¨ï¼Œæ³¨å†Œåˆ°SerializableClassRegistry</span></span><br><span class="line">        <span class="keyword">for</span> (Class c : optimizer.getSerializableClasses()) &#123;</span><br><span class="line">            SerializableClassRegistry.registerClass(c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        optimizers.add(className);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œä»<code>SerializableClassRegistry</code>ä¸­æ‹¿å‡ºæ³¨å†Œçš„ç±»å‹ï¼Œè¿›è¡ŒKryoçš„ç±»å‹æ³¨å†Œï¼Œå¯ä»¥çœ‹åˆ°<code>SerializableClassRegistry#getRegisteredClasses</code>è¢«FSTå’ŒKryoä½¿ç”¨ï¼Œè¯æ˜FSTå’ŒKryoéƒ½éœ€è¦è¿›è¡Œåºåˆ—åŒ–ç±»çš„æ³¨å†Œï¼Œå½“ç„¶FSTä¹Ÿæ”¯æŒä¸æ³¨å†Œåºåˆ—åŒ–ç±»å‹ã€‚<br><img data-src="https://i.loli.net/2020/12/09/OXdnskMZFKvjUHz.png"></p>
<p>Kryoç±»æ³¨å†Œçš„å…·ä½“ç»†èŠ‚ï¼Œ<code>AbstractKryoFactory#create</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> (Class clazz : registrations) &#123;</span><br><span class="line">    kryo.register(clazz);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éå†å–å‡ºSerializableClassRegistryçš„æ³¨å†Œç±»ï¼Œä¾æ¬¡å°†ç±»æ³¨å†Œåˆ°Kryo</span></span><br><span class="line">SerializableClassRegistry.getRegisteredClasses().forEach((clazz, ser) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ser == <span class="keyword">null</span>) &#123;</span><br><span class="line">        kryo.register(clazz);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        kryo.register(clazz, (Serializer) ser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¾ªç¯å–å‡ºSerializableClassRegistryä¸­çš„æ³¨å†Œç±»è¿›è¡Œæ³¨å†Œï¼Œçœ‹åˆ°è¿™é‡Œä¹Ÿèƒ½æ˜ç™½ï¼Œä¸ºä»€ä¹ˆDubboå®˜ç½‘çš„SerializationOptimizerä¾‹å­éœ€è¦ä½¿ç”¨LinkedListã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆKryoéœ€è¦è¿›è¡Œç±»çš„æ³¨å†Œï¼Œä¸”ä¿æŒé¡ºåºï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆKryoéœ€è¦è¿›è¡Œç±»çš„æ³¨å†Œï¼Œä¸”ä¿æŒé¡ºåºï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆKryoéœ€è¦è¿›è¡Œç±»çš„æ³¨å†Œï¼Œä¸”ä¿æŒé¡ºåºï¼Ÿ"></a>ä¸ºä»€ä¹ˆKryoéœ€è¦è¿›è¡Œç±»çš„æ³¨å†Œï¼Œä¸”ä¿æŒé¡ºåºï¼Ÿ</h1><h2 id="ç±»çš„æ³¨å†Œ"><a href="#ç±»çš„æ³¨å†Œ" class="headerlink" title="ç±»çš„æ³¨å†Œ"></a>ç±»çš„æ³¨å†Œ</h2><p>åœ¨Dubboè¿™æ ·çš„RPCæ¡†æ¶è¿›è¡Œé€šä¿¡æ—¶ï¼Œæ€§èƒ½ç“¶é¢ˆå¾€å¾€åœ¨äºRPCä¼ è¾“è¿‡ç¨‹ä¸­çš„ç½‘ç»œIOè€—æ—¶ï¼Œæå‡ç½‘ç»œIOçš„åŠæ³•ï¼Œä¸€æ˜¯åŠ å¤§å¸¦å®½ï¼ŒäºŒæ˜¯å‡å°ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œè€Œé«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶å¯ä»¥åšåˆ°çš„å°±æ˜¯å‡å°ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚</p>
<p>Kryoæ³¨å†Œç±»çš„æ—¶å€™ï¼Œä½¿ç”¨äº†ä¸€ä¸ªintç±»å‹çš„IDæ¥ä¸ç±»è¿›è¡Œå…³è”ï¼Œåœ¨åºåˆ—åŒ–è¯¥ç±»çš„å®ä¾‹æ—¶ï¼Œç”¨int IDæ¥æ ‡è¯†ç±»å‹ï¼Œååºåˆ—åŒ–è¯¥ç±»æ—¶ï¼ŒåŒæ ·é€šè¿‡int IDæ¥æ‰¾åˆ°ç±»å‹ï¼Œè¿™æ¯”å†™å‡ºç±»åé«˜æ•ˆçš„å¤šã€‚</p>
<h2 id="ç»´æŒç±»æ³¨å†Œé¡ºåº"><a href="#ç»´æŒç±»æ³¨å†Œé¡ºåº" class="headerlink" title="ç»´æŒç±»æ³¨å†Œé¡ºåº"></a>ç»´æŒç±»æ³¨å†Œé¡ºåº</h2><p>Kryoæ³¨å†Œç±»çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç±»å…³è”çš„int IDï¼Œä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Kryo kryo = <span class="keyword">new</span> Kryo();</span><br><span class="line">kryo.register(SomeClass.class, <span class="number">10</span>);</span><br><span class="line">kryo.register(AnotherClass.class, <span class="number">11</span>);</span><br><span class="line">kryo.register(YetAnotherClass.class, <span class="number">12</span>);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸Šé¢æˆ‘ä»¬è®²åˆ°ï¼ŒDubboå¯¹Kryoåšäº†ç›¸å½“ç¨‹åº¦çš„é›†æˆï¼Œå¯¼è‡´æˆ‘ä»¬æ²¡æ³•ç»™ç±»æŒ‡å®šint IDï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿è¯æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹ç±»æ³¨å†Œé¡ºåºçš„ä¸€è‡´ï¼Œé—´æ¥åœ°ä¿è¯äº†int IDçš„ä¸€è‡´æ€§ã€‚</p>
<h1 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h1><h2 id="åå°„è·å–ä»£æ³¨å†Œçš„ç±»"><a href="#åå°„è·å–ä»£æ³¨å†Œçš„ç±»" class="headerlink" title="åå°„è·å–ä»£æ³¨å†Œçš„ç±»"></a>åå°„è·å–ä»£æ³¨å†Œçš„ç±»</h2><blockquote>
<p>åœ¨Dubboä¸­ä½¿ç”¨Kryoæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªSerializationOptimizerï¼Œå¹¶æä¾›ä¸€ä¸ªæ³¨å†Œç±»åˆ—è¡¨ã€‚éšç€é¡¹ç›®è§„æ¨¡æ‰©å¤§ï¼Œä¸å¯èƒ½æ—¶æ—¶åˆ»åˆ»æƒ³ç€ç»´æŠ¤è¿™ä¸ªæ³¨å†Œç±»åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„æ¥è‡ªåŠ¨è·å–è¿™ä¸ªæ³¨å†Œç±»åˆ—è¡¨</p>
</blockquote>
<p>å¼•å…¥ä¾èµ–</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Javaåå°„å·¥å…·åŒ…</span></span><br><span class="line">implementation <span class="string">&#x27;org.reflections:reflections:0.9.11&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™æ¥å£ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">KryoDubboSerializable</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™SerializationOptimizerå®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractSerializationOptimizerImpl</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">SerializationOptimizer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Class&lt;?&gt;&gt; classList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbstractSerializationOptimizerImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> reflections = <span class="keyword">new</span> Reflections(</span><br><span class="line">                <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">                        .forPackages(basePackage())</span><br><span class="line">                        .addScanners(<span class="keyword">new</span> SubTypesScanner())</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">this</span>.classList = reflections.getSubTypesOf(KryoDubboSerializable.class)</span><br><span class="line">                .stream()</span><br><span class="line">            	<span class="comment">// Kryoåºåˆ—åŒ–åè®®è¦æ±‚ç±»æ³¨å†Œé¡ºåºä¸€è‡´</span></span><br><span class="line">                .sorted(Comparator.comparing(Class::getSimpleName))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        log.info(<span class="string">&quot;load &#123;&#125; classes to use kryo serializable&quot;</span>, <span class="keyword">this</span>.classList.size());</span><br><span class="line">        log.debug(<span class="string">&quot;kryo serializable classes: &#123;&#125;&quot;</span>, <span class="keyword">this</span>.classList.stream().map(Class::getSimpleName).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Class&lt;?&gt;&gt; getSerializableClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> classList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰«æåŒ…è·¯å¾„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> packages</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String[] basePackage();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦ç»§æ‰¿AbstractSerializationOptimizerImplï¼Œå¹¶æä¾›å¾…æ³¨å†ŒåŒ…è·¯å¾„ï¼ˆæ”¯æŒå¤šä¸ªï¼‰ï¼Œå¾…æ³¨å†Œçš„ç±»éœ€è¦å®ç°KryoDubboSerializableæ¥å£ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡çµæ´»æ€§ï¼ˆå¦‚æœä¸éœ€è¦æ³¨å†Œåˆ°Kryoï¼Œä¸å®ç°è¯¥æ¥å£å³å¯ï¼‰ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="https://dubbo.apache.org/zh/docs/v2.7/user/serialization/">https://dubbo.apache.org/zh/docs/v2.7/user/serialization/</a></li>
<li><a href="https://github.com/EsotericSoftware/kryo">https://github.com/EsotericSoftware/kryo</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„JAVAç¯å¢ƒæ­å»º</title>
    <url>/p/12106/</url>
    <content><![CDATA[<p>æ¯æ¬¡é‡è£…ç³»ç»Ÿåçš„å¼€å‘ç¯å¢ƒæ­å»ºï¼Œæ€»æ˜¯ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ç²¾åŠ›ï¼Œè½¯ä»¶ä¸‹è½½å®‰è£…å•¦ï¼Œé…ç½®ä¿®æ”¹å•¦ç­‰ç­‰ï¼Œç´¢æ€§æŠŠè¿™äº›æµç¨‹è®°å½•ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæ—¶é—´å°±æ˜¯é‡‘é’±ã€‚<span id="more"></span></p>
<h1 id="è½¯ä»¶åˆ—è¡¨"><a href="#è½¯ä»¶åˆ—è¡¨" class="headerlink" title="è½¯ä»¶åˆ—è¡¨"></a>è½¯ä»¶åˆ—è¡¨</h1><ul>
<li>JDK1.8</li>
<li>IntelliJ IDEA</li>
<li>Navicatæ•°æ®åº“ç®¡ç†å·¥å…·</li>
<li>Postman</li>
<li>Git</li>
<li>SourceTree</li>
<li>XShell5</li>
<li>DevCenter(cassandraæ•°æ®åº“ç®¡ç†å·¥å…·)</li>
<li>RedisDesktopManager(redisç®¡ç†å·¥å…·)</li>
</ul>
<p>è¿™äº›å·¥å…·å·²ç»å¯ä»¥æ»¡è¶³æˆ‘çš„æ—¥å¸¸å·¥ä½œäº†ï¼Œä»€ä¹ˆå°è±¡ç¬”è®°ï¼ŒmarkdownPad2ç­‰ç­‰ä¸åŒ…å«äºæ­¤ã€‚<br>è¿™äº›éƒ½å¯ä»¥åœ¨æˆ‘çš„åšå®¢ä¸‹è½½åˆ° -&gt; <a href="https://gcdd1993.github.io/2019/01/08/%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E9%9B%86%E5%90%88/#more">å¸¸ç”¨è½¯ä»¶é›†åˆ</a></p>
<h1 id="è½¯ä»¶é…ç½®"><a href="#è½¯ä»¶é…ç½®" class="headerlink" title="è½¯ä»¶é…ç½®"></a>è½¯ä»¶é…ç½®</h1><h2 id="IntelliJ-IDEA"><a href="#IntelliJ-IDEA" class="headerlink" title="IntelliJ IDEA"></a>IntelliJ IDEA</h2><h3 id="ç ´è§£"><a href="#ç ´è§£" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h3><p><a href="http://idea.lanyus.com/">IntelliJ IDEA æ³¨å†Œç </a></p>
<h3 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h3><p>å½“ç„¶æ˜¯é€‰é»‘è‰²ä¸»é¢˜äº†ï¼Œæ¯•ç«Ÿæå€¡ä¿æŠ¤çœ¼ç›ã€‚</p>
<p><img data-src="https://i.imgur.com/wyJ25mS.png"></p>
<h3 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h3><p>æˆ‘ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å­—ä½“+14å·å¤§å°ã€‚</p>
<p><img data-src="https://i.imgur.com/4gl570N.png"></p>
<h3 id="è®¾ç½®ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯keymap"><a href="#è®¾ç½®ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯keymap" class="headerlink" title="è®¾ç½®ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯keymap"></a>è®¾ç½®ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯keymap</h3><p>ç”±äºä»¥å‰ç”¨æƒ¯äº†Eclipse,æ‰€ä»¥è¿˜å¾—æ”¹ä¸ºEclipseçš„å¿«æ·é”®</p>
<p><img data-src="https://i.imgur.com/GokNm9o.png"></p>
<h3 id="ä»£ç è‡ªåŠ¨æç¤ºä¸åŒºåˆ†å¤§å°å†™"><a href="#ä»£ç è‡ªåŠ¨æç¤ºä¸åŒºåˆ†å¤§å°å†™" class="headerlink" title="ä»£ç è‡ªåŠ¨æç¤ºä¸åŒºåˆ†å¤§å°å†™"></a>ä»£ç è‡ªåŠ¨æç¤ºä¸åŒºåˆ†å¤§å°å†™</h3><p>è¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼Œæ¯•ç«Ÿè°ä¹Ÿä¸å¯èƒ½æ— æ—¶æ— åˆ»æ³¨æ„å¤§å°å†™ï¼Œåˆ°æ—¶å€™ä¸å¿«æ·æç¤ºå°±æµªè´¹å¤ªå¤šæ—¶é—´äº†ï¼Œä¹Ÿå½±å“å¼€å‘ä½“éªŒã€‚</p>
<p><img data-src="https://i.loli.net/2019/01/13/5c3a2d475bb3b.png"></p>
<h3 id="è‡ªåŠ¨å¯¼å…¥åŒ…å’Œå¯¼å…¥åŒ…ä¼˜åŒ–çš„è®¾ç½®"><a href="#è‡ªåŠ¨å¯¼å…¥åŒ…å’Œå¯¼å…¥åŒ…ä¼˜åŒ–çš„è®¾ç½®" class="headerlink" title="è‡ªåŠ¨å¯¼å…¥åŒ…å’Œå¯¼å…¥åŒ…ä¼˜åŒ–çš„è®¾ç½®"></a>è‡ªåŠ¨å¯¼å…¥åŒ…å’Œå¯¼å…¥åŒ…ä¼˜åŒ–çš„è®¾ç½®</h3><p><img data-src="https://i.loli.net/2019/01/13/5c3a2d473806d.png"></p>
<h3 id="Javaä»£ç é»˜è®¤æ³¨é‡Š"><a href="#Javaä»£ç é»˜è®¤æ³¨é‡Š" class="headerlink" title="Javaä»£ç é»˜è®¤æ³¨é‡Š"></a>Javaä»£ç é»˜è®¤æ³¨é‡Š</h3><p>ä¸€èˆ¬åˆ›å»ºä¸€ä¸ªjavaç±»çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šåˆ›å»ºè€…ä»¥åŠåˆ›å»ºæ—¶é—´</p>
<p><img data-src="https://i.loli.net/2019/01/13/5c3a2d473b94e.png"></p>
<p>æ³¨é‡Šä»£ç å¯ä»¥è‡ªå·±å†³å®šï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;DATE&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p> ç„¶ååˆ›å»ºçš„ç±»æ˜¯è¿™æ ·çš„:</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/1/31</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="IntelliJ-IDEAå¯åŠ¨è®¾ç½®ä¸é»˜è®¤æ‰“å¼€å‰ä¸€ä¸ªé¡¹ç›®"><a href="#IntelliJ-IDEAå¯åŠ¨è®¾ç½®ä¸é»˜è®¤æ‰“å¼€å‰ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="IntelliJ IDEAå¯åŠ¨è®¾ç½®ä¸é»˜è®¤æ‰“å¼€å‰ä¸€ä¸ªé¡¹ç›®"></a>IntelliJ IDEAå¯åŠ¨è®¾ç½®ä¸é»˜è®¤æ‰“å¼€å‰ä¸€ä¸ªé¡¹ç›®</h3><p> <img data-src="https://i.loli.net/2019/01/14/5c3be5127420c.png"></p>
<h3 id="IntelliJ-IDEAå¸¸ç”¨æ’ä»¶"><a href="#IntelliJ-IDEAå¸¸ç”¨æ’ä»¶" class="headerlink" title="IntelliJ IDEAå¸¸ç”¨æ’ä»¶"></a>IntelliJ IDEAå¸¸ç”¨æ’ä»¶</h3><ul>
<li>.ignore:è‡ªåŠ¨ç”Ÿæˆ.ignoreæ–‡ä»¶ï¼Œå¹¶æ”¯æŒä¸€é”®æ·»åŠ æ–‡ä»¶åˆ°.ignoreåˆ—è¡¨</li>
<li>Grep Console:åœ¨æ§åˆ¶å°æ”¯æŒç­›é€‰ï¼Œç±»ä¼¼shellå‘½ä»¤çš„cat 1.txt | grep â€˜11â€™</li>
<li>Lombok plugin:ä½¿ç”¨lombokå¿…é¡»è¦è£…çš„ä¸€ä¸ªæ’ä»¶</li>
<li>CodeGlance:ä»£ç ç¼–è¾‘åŒºè¿·ä½ ç¼©æ”¾å›¾æ’ä»¶ï¼Œéå¸¸å¥½ç”¨</li>
<li>HighlightBracketPair:è‡ªåŠ¨åŒ–é«˜äº®æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨ä»£ç å—å¯¹åº”çš„æ‹¬å·ï¼Œå¯ä»¥å®šåˆ¶é¢œè‰²å’Œå½¢çŠ¶ï¼Œå†ä¹Ÿä¸æ€•çœ‹ä»£ç çœ‹åˆ°çœ¼èŠ±äº†</li>
<li>Rainbow Brackets:å½©è‰²æ˜¾ç¤ºæ‰€æœ‰æ‹¬å·,æœ‰ç‚¹ç±»ä¼¼ä¸Šä¸€ä¸ª</li>
<li>Alibaba Java Coding Guidelines:é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œé…å¥—æ’ä»¶ï¼Œä¸€é”®æ‰«æå¸®ä½ ä¼˜åŒ–ä»£ç ã€‚</li>
<li>Codotaï¼šè®©ä»£ç æç¤ºæ›´åŠ æ™ºèƒ½ï¼ˆåªæ”¯æŒJavaï¼‰</li>
</ul>
<h2 id="Navicat"><a href="#Navicat" class="headerlink" title="Navicat"></a>Navicat</h2><h3 id="ç ´è§£-1"><a href="#ç ´è§£-1" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h3><p><a href="https://www.jianshu.com/p/42a33b0dda9c">Navicat Premium 12.0.18 / 12.0.24å®‰è£…ä¸æ¿€æ´»</a></p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://segmentfault.com/a/1190000013504412">Intellij IDEAæ’ä»¶æ¨è</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨è½¯ä»¶é›†åˆ</title>
    <url>/p/37491/</url>
    <content><![CDATA[<p>å¸¸ç”¨è½¯ä»¶å·¥å…·æ”¶è—é›†ï¼Œæ”¶è—äº†åœ¨å·¥ä½œç”Ÿæ´»ä¸­é‡åˆ°çš„å¥½ç”¨å®ç”¨çš„è½¯ä»¶ã€‚<span id="more"></span></p>
<h1 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h1><ul>
<li><a href="https://www.lanzous.com/i2eptwh">BeyondCompareç ´è§£ç‰ˆ</a></li>
<li><a href="https://www.lanzous.com/i2eptrc">Navicat Premium 12ç ´è§£ç‰ˆ</a></li>
<li><a href="https://www.lanzous.com/b547205/">markdown pad2ç ´è§£ç‰ˆ</a> å¯†ç :23w2</li>
<li><a href="https://www.lanzous.com/b539472/">RedisDesktopManager å…è´¹ç‰ˆ</a> å¯†ç :ciq1</li>
<li><a href="https://www.lanzous.com/i2q4x3i">QTransateç¿»è¯‘å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2epu5g">æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2epu2d">draw.ioæ‹“æ‰‘å›¾å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2eptdi">DevCenter cassandraç®¡ç†å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2en5xc">PostManä¾¿æºç‰ˆ</a></li>
<li><a href="https://www.lanzous.com/i2q4xyj">Git</a></li>
<li><a href="https://www.lanzous.com/i2q4y1c">SourceTree(Git Guiå·¥å…·)</a></li>
<li><a href="https://www.lanzous.com/i2v3p2d">XShell5ç ´è§£ç‰ˆ</a></li>
</ul>
<h1 id="å®ç”¨å·¥å…·"><a href="#å®ç”¨å·¥å…·" class="headerlink" title="å®ç”¨å·¥å…·"></a>å®ç”¨å·¥å…·</h1><ul>
<li><a href="https://www.lanzous.com/i2q4y6h">RSSè®¢é˜…å·¥å…·(åªé™windows)</a></li>
<li><a href="https://www.lanzous.com/b539477">ç§‘å­¦ä¸Šç½‘ShadowSocks</a></li>
<li><a href="https://www.lanzous.com/i2saiib">win10æ¿€æ´»å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2t3ukj">Officeå®‰è£…å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2flrje">OCRæ–‡å­—è¯†åˆ«å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2flr6b">GIFå½•åˆ¶å·¥å…·</a></li>
<li><a href="https://www.lanzous.com/i2fls4f">å†°ç‚¹æ–‡åº“ä¸‹è½½å™¨ç ´è§£ç‰ˆ</a></li>
</ul>
<h1 id="æ¨èå·¥å…·"><a href="#æ¨èå·¥å…·" class="headerlink" title="æ¨èå·¥å…·"></a>æ¨èå·¥å…·</h1><ul>
<li><a href="https://www.lanzous.com/i2zaiyj">ç°ä»£åŒ–Markdownç¼–è¾‘å·¥å…·</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>è½¯ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™IOCå®¹å™¨</title>
    <url>/p/11305/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡æ˜¯ä¸ºäº†å­¦ä¹ <code>Spring IOC</code>å®¹å™¨çš„æ‰§è¡Œè¿‡ç¨‹è€Œå†™ï¼Œä¸èƒ½å®Œå…¨ä»£è¡¨<code>Spring IOC</code>å®¹å™¨ï¼Œåªæ˜¯ç®€å•å®ç°äº†å®¹å™¨çš„<strong>ä¾èµ–æ³¨å…¥</strong>å’Œ<strong>æ§åˆ¶åè½¬</strong>åŠŸèƒ½ï¼Œæ— æ³•ç”¨äºç”Ÿäº§ï¼Œåªèƒ½è¯´å¯¹ç†è§£Springå®¹å™¨èƒ½å¤Ÿèµ·åˆ°ä¸€å®šçš„ä½œç”¨ã€‚</p>
<span id="more"></span>

<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p>åˆ›å»ºGradleé¡¹ç›®ï¼Œå¹¶ä¿®æ”¹<code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.franzbecker.gradle-lombok&quot;</span> version <span class="string">&quot;3.1.0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group <span class="string">&#x27;io.github.gcdd1993&#x27;</span></span><br><span class="line">version <span class="string">&#x27;1.0-SNAPSHOT&#x27;</span></span><br><span class="line"></span><br><span class="line">sourceCompatibility = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    testCompile <span class="attr">group:</span> <span class="string">&#x27;junit&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;junit&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;4.12&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºBeanFactory"><a href="#åˆ›å»ºBeanFactory" class="headerlink" title="åˆ›å»ºBeanFactory"></a>åˆ›å»º<code>BeanFactory</code></h2><p><code>BeanFactory</code>æ˜¯IOCä¸­ç”¨äºå­˜æ”¾beanå®ä¾‹ä»¥åŠè·å–beançš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯<code>getBean</code>ä»¥åŠ<code>getBean</code>çš„é‡è½½æ–¹æ³•ï¼Œè¿™é‡Œç®€å•å®ç°ä¸¤ä¸ª<code>getBean</code>çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.gcdd1993.ioc.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bean factory interface</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡beanåç§°è·å–bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name beanåç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">getBean</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡beanç±»å‹è·å–bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tClass beanç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;    æ³›å‹T</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; tClass)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºApplicationContextä¸Šä¸‹æ–‡"><a href="#åˆ›å»ºApplicationContextä¸Šä¸‹æ–‡" class="headerlink" title="åˆ›å»ºApplicationContextä¸Šä¸‹æ–‡"></a>åˆ›å»º<code>ApplicationContext</code>ä¸Šä¸‹æ–‡</h2><p><code>ApplicationContext</code>ï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå®é™…å°±æ˜¯Springå®¹å™¨æœ¬èº«äº†ã€‚</p>
<p>æˆ‘ä»¬åˆ›å»º<code>ApplicationContext</code>ç±»ï¼Œå¹¶å®ç°<code>BeanFactory</code>æ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContext</span> <span class="keyword">implements</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getBeanæ–¹æ³•"><a href="#getBeanæ–¹æ³•" class="headerlink" title="getBeanæ–¹æ³•"></a><code>getBean</code>æ–¹æ³•</h3><p>æ—¢ç„¶è¯´æ˜¯å®¹å™¨ï¼Œé‚£è‚¯å®šè¦æœ‰åœ°æ–¹è£…æˆ‘ä»¬çš„beanå®ä¾‹å§ï¼Œä½¿ç”¨ä¸¤ä¸ªMapä½œä¸ºå®¹å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ç…§beanNameåˆ†ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; beanByNameMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ç…§beanClassåˆ†ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, Object&gt; beanByClassMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">256</span>);</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®Œæˆæˆ‘ä»¬çš„<code>getBean</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> beanByNameMap.get(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; tClass)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tClass.cast(beanByClassMap.get(tClass));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ä»Mapä¸­è·å–beanå®ä¾‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå½“ç„¶äº†ï¼Œåœ¨çœŸå®çš„Springå®¹å™¨ä¸­ï¼Œæ˜¯ä¸ä¼šè¿™ä¹ˆç®€å•å•¦ï¼Œä¸è¿‡æˆ‘ä»¬è¿™æ¬¡æ˜¯è¦åŒ–ç¹ä¸ºç®€ï¼Œç†è§£IOCå®¹å™¨ã€‚</p>
<h3 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h3><p>Springæä¾›äº†<code>@ComponentScan</code>æ¥æ‰«æåŒ…ä¸‹çš„<code>Component</code>ï¼Œæˆ‘ä»¬ä¸ºäº†ç®€ä¾¿ï¼Œç›´æ¥åœ¨æ„é€ å™¨ä¸­æŒ‡å®šè¦æ‰«æçš„åŒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; basePackages;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤æ„é€ å™¨ï¼Œé»˜è®¤æ‰«æå½“å‰æ‰€åœ¨åŒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">new</span> HashSet&lt;&gt;(Collections.singletonList(ApplicationContext.class.getPackage().getName())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å‚æ„é€ å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> basePackages æ‰«æçš„åŒ…ååˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApplicationContext</span><span class="params">(Set&lt;String&gt; basePackages)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.basePackages = basePackages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="refreshæ–¹æ³•"><a href="#refreshæ–¹æ³•" class="headerlink" title="refreshæ–¹æ³•"></a><code>refresh</code>æ–¹æ³•</h3><p>refreshçš„è¿‡ç¨‹åŸºæœ¬æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ¥èµ°</p>
<p><img data-src="https://i.loli.net/2019/06/02/5cf3c4c4b465587417.png"></p>
<ol>
<li>æ‰«ææŒ‡å®šçš„åŒ…ä¸‹æ‰€æœ‰å¸¦<code>@Bean</code>æ³¨è§£ï¼ˆSpringä¸­æ˜¯<code>@Component</code>æ³¨è§£ï¼‰çš„ç±»ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Class&gt; beanClasses = PackageScanner.findClassesWithAnnotation(packageName, Bean.class);</span><br><span class="line">System.out.println(<span class="string">&quot;scan classes with Bean annotation : &quot;</span> + beanClasses.toString());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Class beanClass : beanClasses) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        createBean(beanClass);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException | IllegalAccessException | InvocationTargetException | InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>éå†ç±»ï¼Œè·å–ç±»çš„æ„é€ å™¨ä»¥åŠæ‰€æœ‰å­—æ®µã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor constructor = beanClass.getDeclaredConstructor();</span><br><span class="line">Object object = constructor.newInstance();</span><br><span class="line">Field[] fields = beanClass.getDeclaredFields();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åˆ¤æ–­å­—æ®µæ˜¯ä¾èµ–æ³¨å…¥çš„è¿˜æ˜¯æ™®é€šå­—æ®µã€‚</p>
</li>
<li><p>å¦‚æœæ˜¯æ™®é€šå­—æ®µï¼Œé€šè¿‡å­—æ®µç±»å‹åˆå§‹åŒ–è¯¥å­—æ®µï¼Œå¹¶å°è¯•ä»<code>@Value</code>æ³¨è§£è·å–å€¼å¡ç»™å­—æ®µã€‚</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Value value = field.getAnnotation(Value.class);</span><br><span class="line"><span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// æ³¨å…¥</span></span><br><span class="line">    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// éœ€è¦åšä¸€äº›ç±»å‹è½¬æ¢ï¼Œä»Stringè½¬ä¸ºå¯¹åº”çš„ç±»å‹</span></span><br><span class="line">    field.set(object, value.value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¦‚æœæ˜¯ä¾èµ–æ³¨å…¥çš„å­—æ®µï¼Œå°è¯•ä»<code>beanByClassMap</code>ä¸­è·å–å¯¹åº”çš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å…ˆè¦å»å®ä¾‹åŒ–è¯¥å­—æ®µå¯¹åº”çš„ç±»å‹ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Autowired autowired = field.getAnnotation(Autowired.class);</span><br><span class="line"><span class="keyword">if</span> (autowired != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¾èµ–æ³¨å…¥</span></span><br><span class="line">    String name = autowired.name();</span><br><span class="line">    <span class="comment">// æŒ‰ç…§åç§°æ³¨å…¥</span></span><br><span class="line">    Object diObj;</span><br><span class="line">    <span class="keyword">if</span> (!name.isEmpty()) &#123;</span><br><span class="line">        diObj = beanByNameMap.get(name) == <span class="keyword">null</span> ?</span><br><span class="line">                createBean(name) :</span><br><span class="line">                beanByNameMap.get(name);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æŒ‰ç…§ç±»å‹æ³¨å…¥</span></span><br><span class="line">        Class&lt;?&gt; aClass = field.getType();</span><br><span class="line">        diObj = beanByClassMap.get(aClass) == <span class="keyword">null</span> ?</span><br><span class="line">                createBean(aClass) :</span><br><span class="line">                beanByClassMap.get(aClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ³¨å…¥</span></span><br><span class="line">    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    field.set(object, diObj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•æˆ‘ä»¬çš„IOCå®¹å™¨"><a href="#æµ‹è¯•æˆ‘ä»¬çš„IOCå®¹å™¨" class="headerlink" title="æµ‹è¯•æˆ‘ä»¬çš„IOCå®¹å™¨"></a>æµ‹è¯•æˆ‘ä»¬çš„IOCå®¹å™¨</h2><p>åˆ›å»º<code>Address</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;2222&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String longitude;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;1111&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String latitude;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º<code>Person</code>å¹¶æ³¨å…¥<code>Address</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;gaochen&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;27&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæµ‹è¯•ç±»<code>ApplicationContextTest</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; basePackages = <span class="keyword">new</span> HashSet&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        basePackages.add(<span class="string">&quot;io.github.gcdd1993.ioc&quot;</span>);</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> ApplicationContext(basePackages);</span><br><span class="line">        ctx.refresh();</span><br><span class="line"></span><br><span class="line">        Person person = ctx.getBean(Person.class);</span><br><span class="line">        System.out.println(person);</span><br><span class="line"></span><br><span class="line">        Object person1 = ctx.getBean(<span class="string">&quot;Person&quot;</span>);</span><br><span class="line">        System.out.println(person1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°å°†ä¼šè¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scan classes with Bean annotation : [class io.github.gcdd1993.ioc.util.Address, class io.github.gcdd1993.ioc.util.Person]</span><br><span class="line">scan classes with Bean annotation : [class io.github.gcdd1993.ioc.util.Address, class io.github.gcdd1993.ioc.util.Person]</span><br><span class="line">Person(address=Address(longitude=2222, latitude=1111), name=gaochen, age=27)</span><br><span class="line">Person(address=Address(longitude=2222, latitude=1111), name=gaochen, age=27)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸå°†Addresså®ä¾‹æ³¨å…¥åˆ°äº†Personå®ä¾‹ä¸­ï¼Œå¹¶ä¸”å°†å®ƒä»¬å­˜å‚¨åœ¨äº†æˆ‘ä»¬è‡ªå·±çš„IOCå®¹å™¨ä¸­ã€‚å…¶å®ï¼ŒSpringå®¹å™¨çš„åŸç†å¤§è‡´å°±æ˜¯å¦‚æ­¤ï¼Œåªä¸è¿‡ä¸ºäº†åº”å¯¹ä¼ä¸šçº§å¼€å‘ï¼Œæä¾›äº†å¾ˆå¤šä¾¿æ·çš„åŠŸèƒ½ï¼Œä¾‹å¦‚beançš„ä½œç”¨åŸŸã€beançš„è‡ªå®šä¹‰æ–¹æ³•ç­‰ç­‰ã€‚</p>
<h1 id="è·å–æºç "><a href="#è·å–æºç " class="headerlink" title="è·å–æºç "></a>è·å–æºç </h1><p>å®Œæ•´æºç å¯ä»¥åœ¨æˆ‘çš„<code>github</code>ä»“åº“è·å–ğŸ‘‰<a href="https://github.com/gcdd1993/Simple-IOC-Container">Simple-IOC-Container</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>æ˜é‡‘è§£ç»‘æ–¹æ¡ˆï¼ˆå·²æˆåŠŸè§£ç»‘å¾®ä¿¡ï¼‰</title>
    <url>/p/34461/</url>
    <content><![CDATA[<p>æ˜é‡‘çš„ç»‘å®šé™åˆ¶ä¸ºåŒä¸€ä¸ªç¬¬ä¸‰æ–¹è´¦å·åªèƒ½ç»‘å®šä¸€ä¸ªæ˜é‡‘è´¦å·ï¼Œä¸”å¿…é¡»ç•™å­˜ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»‘å®šã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘åªç»‘å®šäº†å¾®ä¿¡ï¼Œæƒ³è¦è§£ç»‘å¾®ä¿¡ï¼Œå¯¹ä¸èµ·ï¼Œä¸æ”¯æŒã€‚</p>
<p><img data-src="https://i.loli.net/2020/02/10/XqgsL2DYIkCoapr.png"></p>
<span id="more"></span>

<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>æˆ‘çªç„¶æƒ³åˆ°ï¼Œæ—¢ç„¶å¿…é¡»ç•™å­˜ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»‘å®šï¼Œé‚£æˆ‘ç•™å­˜ä¸€ä¸ª<strong>é‚®ç®±ç»‘å®š</strong>ä¸å°±å¥½äº†å—ï¼Ÿ</p>
<p>æ€è·¯å°±æ˜¯<a href="https://temp-mail.org/zh/">ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€</a>ï¼Œé€šè¿‡ç»‘å®šä¸€ä¸ªé‚®ç®±è´¦å·ï¼Œæ¥ç»‘å®šé‚®ç®±ï¼Œä»è€Œå°†æˆ‘ä»¬çš„è´¦å·è§£æ”¾å‡ºæ¥ï¼Œç»‘å®šæˆ‘ä»¬çš„å¤§å·æˆ–è€…å…¶ä»–è´¦å·ã€‚</p>
<h2 id="è·å–ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€"><a href="#è·å–ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€" class="headerlink" title="è·å–ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€"></a>è·å–ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€</h2><p>æ‰“å¼€<a href="https://temp-mail.org/zh/">ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€</a>ï¼Œä½ å°†ä¼šè·å–åˆ°ä¸€ä¸ªä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªé‚®ä»¶ç»‘å®šæˆ‘ä»¬çš„æ˜é‡‘è´¦å·ã€‚</p>
<p><img data-src="https://i.loli.net/2020/02/10/WU5CKnDcYlrwLZp.png"></p>
<h2 id="ç»‘å®šä¸´æ—¶é‚®ç®±"><a href="#ç»‘å®šä¸´æ—¶é‚®ç®±" class="headerlink" title="ç»‘å®šä¸´æ—¶é‚®ç®±"></a>ç»‘å®šä¸´æ—¶é‚®ç®±</h2><p>ç‚¹å‡»ç»‘å®šé‚®ç®±ï¼Œè¾“å…¥æˆ‘ä»¬ä¸Šä¸€æ­¥è·å–åˆ°çš„ä¸´æ—¶é‚®ä»¶åœ°å€ï¼Œè¿”å›<a href="https://temp-mail.org/zh/">ä¸´æ—¶ç”µå­é‚®ä»¶åœ°å€</a>ç½‘ç«™ï¼Œè€å¿ƒç­‰å¾…10så·¦å³ã€‚</p>
<p><img data-src="https://i.loli.net/2020/02/10/MCRXaSIbO2KTHfr.png"></p>
<p>ä½ å°†ä¼šå—åˆ°æ˜é‡‘çš„é‚®ç®±ç»‘å®šéªŒè¯é‚®ä»¶ï¼Œæ‰“å¼€å¹¶ç‚¹å‡»ï¼Œç›´åˆ°ç»‘å®šæˆåŠŸã€‚</p>
<p><img data-src="https://i.loli.net/2020/02/10/sQpovuOjaEJwkbR.png"></p>
<h2 id="è§£ç»‘"><a href="#è§£ç»‘" class="headerlink" title="è§£ç»‘"></a>è§£ç»‘</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¼€å¿ƒçš„è§£ç»‘æˆ‘ä»¬è‡ªå·±çš„è´¦å·äº†ã€‚æˆ‘è¦è§£ç»‘çš„æ˜¯å¾®ä¿¡ï¼Œè¯•ä¸€ä¸‹å§ã€‚</p>
<p><img data-src="https://i.loli.net/2020/02/10/GL2yaCp7AsWZQiT.png"></p>
<h1 id="å‹æƒ…æé†’"><a href="#å‹æƒ…æé†’" class="headerlink" title="å‹æƒ…æé†’"></a>å‹æƒ…æé†’</h1><blockquote>
<p>ç”±äºä½¿ç”¨çš„æ˜¯ä¸€æ¬¡æ€§é‚®ä»¶åœ°å€ï¼Œè¯¥åšæ³•å¯èƒ½ä¼šå¯¼è‡´ä½ è§£ç»‘çš„è´¦å·ç™»å½•ä¸ä¸Šï¼Œè¯·è°¨æ…æ“ä½œï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸€ï¼‰ç®€ä»‹</title>
    <url>/p/27791/</url>
    <content><![CDATA[<h1 id="æ¶ˆæ¯é˜Ÿåˆ—-MQ-æ¦‚è¿°"><a href="#æ¶ˆæ¯é˜Ÿåˆ—-MQ-æ¦‚è¿°" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—(MQ)æ¦‚è¿°"></a>æ¶ˆæ¯é˜Ÿåˆ—(MQ)æ¦‚è¿°</h1><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ï¼Œå…¶é€šç”¨çš„ä½¿ç”¨åœºæ™¯å¯ä»¥ç®€å•åœ°æè¿°ä¸ºï¼š</p>
<blockquote>
<p>å½“ä¸éœ€è¦ç«‹å³è·å¾—ç»“æœï¼Œä½†æ˜¯å¹¶å‘é‡åˆéœ€è¦è¿›è¡Œæ§åˆ¶çš„æ—¶å€™ï¼Œå·®ä¸å¤šå°±æ˜¯éœ€è¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™ã€‚</p>
</blockquote>
<p>æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦è§£å†³äº†åº”ç”¨è€¦åˆã€å¼‚æ­¥å¤„ç†ã€æµé‡å‰Šé”‹ç­‰é—®é¢˜ã€‚</p>
<span id="more"></span>

<p>å½“å‰ä½¿ç”¨è¾ƒå¤šçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰RabbitMQã€RocketMQã€ActiveMQã€Kafkaã€ZeroMQã€MetaMqç­‰ï¼Œè€Œéƒ¨åˆ†æ•°æ®åº“å¦‚Redisã€Mysqlä»¥åŠphxsqlä¹Ÿå¯å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚</p>
<h1 id="æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"><a href="#æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"></a>æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</h1><p>æ¶ˆæ¯é˜Ÿåˆ—åœ¨å®é™…åº”ç”¨ä¸­åŒ…æ‹¬å¦‚ä¸‹å››ä¸ªåœºæ™¯ï¼š</p>
<ul>
<li>åº”ç”¨è€¦åˆï¼šå¤šåº”ç”¨é—´é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé¿å…è°ƒç”¨æ¥å£å¤±è´¥å¯¼è‡´æ•´ä¸ªè¿‡ç¨‹å¤±è´¥ï¼›</li>
<li>å¼‚æ­¥å¤„ç†ï¼šå¤šåº”ç”¨å¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œåº”ç”¨é—´å¹¶å‘å¤„ç†æ¶ˆæ¯ï¼Œç›¸æ¯”ä¸²è¡Œå¤„ç†ï¼Œå‡å°‘å¤„ç†æ—¶é—´ï¼›</li>
<li>é™æµå‰Šå³°ï¼šå¹¿æ³›åº”ç”¨äºç§’æ€æˆ–æŠ¢è´­æ´»åŠ¨ä¸­ï¼Œé¿å…æµé‡è¿‡å¤§å¯¼è‡´åº”ç”¨ç³»ç»ŸæŒ‚æ‰çš„æƒ…å†µï¼›</li>
<li>æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿï¼šç³»ç»Ÿåˆ†ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ã€æ¶ˆæ¯ç”Ÿäº§è€…ã€æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…è´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…(å¯èƒ½æœ‰å¤šä¸ª)è´Ÿè´£å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼›</li>
</ul>
<p>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸Šè¿°å››ä¸ªåœºæ™¯ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•åœ¨ä¸Šè¿°å››ä¸ªåœºæ™¯ä¸­ä½¿ç”¨ï¼š</p>
<h2 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h2><p>å…·ä½“åœºæ™¯ï¼šç”¨æˆ·ä¸ºäº†ä½¿ç”¨æŸä¸ªåº”ç”¨ï¼Œè¿›è¡Œæ³¨å†Œï¼Œç³»ç»Ÿéœ€è¦å‘é€æ³¨å†Œé‚®ä»¶å¹¶éªŒè¯<a href="https://cloud.tencent.com/product/sms">çŸ­ä¿¡</a>ã€‚å¯¹è¿™ä¸¤ä¸ªæ“ä½œçš„å¤„ç†æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸²è¡ŒåŠå¹¶è¡Œã€‚</p>
<h3 id="ä¸²è¡Œæ–¹å¼"><a href="#ä¸²è¡Œæ–¹å¼" class="headerlink" title="ä¸²è¡Œæ–¹å¼"></a>ä¸²è¡Œæ–¹å¼</h3><p>æ–°æ³¨å†Œä¿¡æ¯ç”Ÿæˆåï¼Œå…ˆå‘é€æ³¨å†Œé‚®ä»¶ï¼Œå†å‘é€éªŒè¯çŸ­ä¿¡ï¼›</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e27b495ce.png"></p>
<p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œéœ€è¦æœ€ç»ˆå‘é€éªŒè¯çŸ­ä¿¡åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3 id="å¹¶è¡Œå¤„ç†"><a href="#å¹¶è¡Œå¤„ç†" class="headerlink" title="å¹¶è¡Œå¤„ç†"></a>å¹¶è¡Œå¤„ç†</h3><p>æ–°æ³¨å†Œä¿¡æ¯å†™å…¥åï¼Œç”±å‘çŸ­ä¿¡å’Œå‘é‚®ä»¶å¹¶è¡Œå¤„ç†ï¼›</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e29f4742c.png"></p>
<p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå‘çŸ­ä¿¡å’Œå‘é‚®ä»¶ éœ€å¤„ç†å®Œæˆåå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>å‡è®¾ä»¥ä¸Šä¸‰ä¸ªå­ç³»ç»Ÿå¤„ç†çš„æ—¶é—´å‡ä¸º50msï¼Œä¸”ä¸è€ƒè™‘ç½‘ç»œå»¶è¿Ÿï¼Œåˆ™æ€»çš„å¤„ç†æ—¶é—´ï¼š</p>
<blockquote>
<p>ä¸²è¡Œï¼š50+50+50=150ms  å¹¶è¡Œï¼š50+50 = 100ms</p>
</blockquote>
<h3 id="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3><p><img data-src="https://i.loli.net/2019/04/01/5ca1e2d1891c2.png"></p>
<p>å¹¶åœ¨å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—åç«‹å³è¿”å›æˆåŠŸç»™å®¢æˆ·ç«¯ï¼Œåˆ™æ€»çš„å“åº”æ—¶é—´ä¾èµ–äºå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´ï¼Œè€Œå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´æœ¬èº«æ˜¯å¯ä»¥å¾ˆå¿«çš„ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤æ€»çš„å¤„ç†æ—¶é—´ç›¸æ¯”ä¸²è¡Œæé«˜äº†2å€ï¼Œç›¸æ¯”å¹¶è¡Œæé«˜äº†ä¸€å€ï¼›</p>
<h2 id="åº”ç”¨è€¦åˆ"><a href="#åº”ç”¨è€¦åˆ" class="headerlink" title="åº”ç”¨è€¦åˆ"></a>åº”ç”¨è€¦åˆ</h2><p>å…·ä½“åœºæ™¯ï¼šç”¨æˆ·ä½¿ç”¨QQç›¸å†Œä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œ<a href="https://cloud.tencent.com/product/facerecognition">äººè„¸è¯†åˆ«</a>ç³»ç»Ÿä¼šå¯¹è¯¥å›¾ç‰‡è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°å›¾ç‰‡åï¼Œå›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿç«‹å³è°ƒç”¨äººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œè°ƒç”¨å®Œæˆåå†è¿”å›æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e2f60d0ce.png"></p>
<p>è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</p>
<ul>
<li>äººè„¸è¯†åˆ«ç³»ç»Ÿè¢«è°ƒå¤±è´¥ï¼Œå¯¼è‡´å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼›</li>
<li>å»¶è¿Ÿé«˜ï¼Œéœ€è¦äººè„¸è¯†åˆ«ç³»ç»Ÿå¤„ç†å®Œæˆåï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå³ä½¿ç”¨æˆ·å¹¶ä¸éœ€è¦ç«‹å³çŸ¥é“ç»“æœï¼›</li>
<li>å›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿä¸äººè„¸è¯†åˆ«ç³»ç»Ÿä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œéœ€è¦åšè€¦åˆï¼›</li>
</ul>
<p>è‹¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e3363239e.png"></p>
<p>å®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡åï¼Œå›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿå°†å›¾ç‰‡ä¿¡æ¯å¦‚uinã€æ‰¹æ¬¡å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›´æ¥è¿”å›æˆåŠŸï¼›è€Œäººè„¸è¯†åˆ«ç³»ç»Ÿåˆ™å®šæ—¶ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œå®Œæˆå¯¹æ–°å¢å›¾ç‰‡çš„è¯†åˆ«ã€‚ </p>
<p>æ­¤æ—¶å›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿå¹¶ä¸éœ€è¦å…³å¿ƒäººè„¸è¯†åˆ«ç³»ç»Ÿæ˜¯å¦å¯¹è¿™äº›å›¾ç‰‡ä¿¡æ¯çš„å¤„ç†ã€ä»¥åŠä½•æ—¶å¯¹è¿™äº›å›¾ç‰‡ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚äº‹å®ä¸Šï¼Œç”±äºç”¨æˆ·å¹¶ä¸éœ€è¦ç«‹å³çŸ¥é“äººè„¸è¯†åˆ«ç»“æœï¼Œäººè„¸è¯†åˆ«ç³»ç»Ÿå¯ä»¥é€‰æ‹©ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼ŒæŒ‰ç…§é—²æ—¶ã€å¿™æ—¶ã€æ­£å¸¸æ—¶é—´ï¼Œå¯¹é˜Ÿåˆ—ä¸­çš„å›¾ç‰‡ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚</p>
<h2 id="é™æµå‰Šå³°"><a href="#é™æµå‰Šå³°" class="headerlink" title="é™æµå‰Šå³°"></a>é™æµå‰Šå³°</h2><p>å…·ä½“åœºæ™¯ï¼šè´­ç‰©ç½‘ç«™å¼€å±•ç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ç”±äºç¬æ—¶è®¿é—®é‡è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¿‡å¤§ï¼Œä¼šå¯¼è‡´æµé‡æš´å¢ï¼Œç›¸å…³ç³»ç»Ÿæ— æ³•å¤„ç†è¯·æ±‚ç”šè‡³å´©æºƒã€‚è€ŒåŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç³»ç»Ÿå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œç›¸å½“äºæ¶ˆæ¯é˜Ÿåˆ—åšäº†ä¸€æ¬¡ç¼“å†²ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e375ac957.png"></p>
<p>è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š </p>
<ol>
<li>è¯·æ±‚å…ˆå…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç”±ä¸šåŠ¡å¤„ç†ç³»ç»Ÿç›´æ¥å¤„ç†ï¼Œåšäº†ä¸€æ¬¡ç¼“å†²,æå¤§åœ°å‡å°‘äº†ä¸šåŠ¡å¤„ç†ç³»ç»Ÿçš„å‹åŠ›ï¼› </li>
<li> é˜Ÿåˆ—é•¿åº¦å¯ä»¥åšé™åˆ¶ï¼Œäº‹å®ä¸Šï¼Œç§’æ€æ—¶ï¼Œåå…¥é˜Ÿåˆ—çš„ç”¨æˆ·æ— æ³•ç§’æ€åˆ°å•†å“ï¼Œè¿™äº›è¯·æ±‚å¯ä»¥ç›´æ¥è¢«æŠ›å¼ƒï¼Œè¿”å›æ´»åŠ¨å·²ç»“æŸæˆ–å•†å“å·²å”®å®Œä¿¡æ¯ï¼›</li>
</ol>
<h2 id="æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿ"><a href="#æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿ" class="headerlink" title="æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿ"></a>æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿ</h2><p>å…·ä½“åœºæ™¯ï¼šç”¨æˆ·æ–°ä¸Šä¼ äº†ä¸€æ‰¹ç…§ç‰‡ï¼Œ äººè„¸è¯†åˆ«ç³»ç»Ÿéœ€è¦å¯¹è¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ç…§ç‰‡è¿›è¡Œèšç±»ï¼Œèšç±»å®Œæˆåç”±å¯¹è´¦ç³»ç»Ÿé‡æ–°ç”Ÿæˆç”¨æˆ·çš„äººè„¸ç´¢å¼•(åŠ å¿«æŸ¥è¯¢)ã€‚è¿™ä¸‰ä¸ªå­ç³»ç»Ÿé—´ç”±æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥ï¼Œå‰ä¸€ä¸ªé˜¶æ®µçš„å¤„ç†ç»“æœæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œåä¸€ä¸ªé˜¶æ®µä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ç»§ç»­å¤„ç†ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e3cbaddd7.png"></p>
<p>è¯¥æ–¹æ³•æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é¿å…äº†ç›´æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªç³»ç»Ÿå¯¼è‡´å½“å‰ç³»ç»Ÿå¤±è´¥ï¼›</li>
<li>æ¯ä¸ªå­ç³»ç»Ÿå¯¹äºæ¶ˆæ¯çš„å¤„ç†æ–¹å¼å¯ä»¥æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥é€‰æ‹©æ”¶åˆ°æ¶ˆæ¯æ—¶å°±å¤„ç†ï¼Œå¯ä»¥é€‰æ‹©å®šæ—¶å¤„ç†ï¼Œä¹Ÿå¯ä»¥åˆ’åˆ†æ—¶é—´æ®µæŒ‰ä¸åŒå¤„ç†é€Ÿåº¦å¤„ç†ï¼›</li>
</ul>
<h1 id="æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼</h1><p>æ¶ˆæ¯é˜Ÿåˆ—åŒ…æ‹¬ä¸¤ç§æ¨¡å¼ï¼Œç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆpoint to pointï¼Œ queueï¼‰å’Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆpublish/subscribeï¼Œtopicï¼‰ã€‚</p>
<h2 id="ç‚¹å¯¹ç‚¹æ¨¡å¼"><a href="#ç‚¹å¯¹ç‚¹æ¨¡å¼" class="headerlink" title="ç‚¹å¯¹ç‚¹æ¨¡å¼"></a>ç‚¹å¯¹ç‚¹æ¨¡å¼</h2><ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>å‘é€è€… (ç”Ÿäº§è€…)</li>
<li>æ¥æ”¶è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰</li>
</ul>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e40d3695e.png"></p>
<p>æ¶ˆæ¯å‘é€è€…ç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°queueä¸­ï¼Œç„¶åæ¶ˆæ¯æ¥æ”¶è€…ä»queueä¸­å–å‡ºå¹¶ä¸”æ¶ˆè´¹æ¶ˆæ¯ã€‚æ¶ˆæ¯è¢«æ¶ˆè´¹ä»¥åï¼Œqueueä¸­ä¸å†æœ‰å­˜å‚¨ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¥æ”¶è€…ä¸å¯èƒ½æ¶ˆè´¹åˆ°å·²ç»è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚</p>
<p>ç‚¹å¯¹ç‚¹æ¨¡å¼ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¯ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼ˆConsumerï¼‰(å³ä¸€æ—¦è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯å°±ä¸å†åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­)ï¼›</li>
<li>å‘é€è€…å’Œæ¥æ”¶è€…é—´æ²¡æœ‰ä¾èµ–æ€§ï¼Œå‘é€è€…å‘é€æ¶ˆæ¯ä¹‹åï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ¥æ”¶è€…åœ¨è¿è¡Œï¼Œéƒ½ä¸ä¼šå½±å“åˆ°å‘é€è€…ä¸‹æ¬¡å‘é€æ¶ˆæ¯ï¼›</li>
<li>æ¥æ”¶è€…åœ¨æˆåŠŸæ¥æ”¶æ¶ˆæ¯ä¹‹åéœ€å‘é˜Ÿåˆ—åº”ç­”æˆåŠŸï¼Œä»¥ä¾¿æ¶ˆæ¯é˜Ÿåˆ—åˆ é™¤å½“å‰æ¥æ”¶çš„æ¶ˆæ¯ï¼›</li>
</ul>
<h2 id="å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒ/è®¢é˜…æ¨¡å¼"></a>å‘å¸ƒ/è®¢é˜…æ¨¡å¼</h2><p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä¸‹åŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>è§’è‰²ä¸»é¢˜ï¼ˆTopicï¼‰</li>
<li>å‘å¸ƒè€…(Publisher)</li>
<li>è®¢é˜…è€…(Subscriber)</li>
</ul>
<p><img data-src="https://i.loli.net/2019/04/01/5ca1e45320c45.png"></p>
<p>å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°Topic,ç³»ç»Ÿå°†è¿™äº›æ¶ˆæ¯ä¼ é€’ç»™å¤šä¸ªè®¢é˜…è€…ã€‚</p>
<p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¯ä¸ªæ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªè®¢é˜…è€…ï¼›</li>
<li>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æœ‰æ—¶é—´ä¸Šçš„ä¾èµ–æ€§ã€‚é’ˆå¯¹æŸä¸ªä¸»é¢˜ï¼ˆTopicï¼‰çš„è®¢é˜…è€…ï¼Œå®ƒå¿…é¡»åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…ä¹‹åï¼Œæ‰èƒ½æ¶ˆè´¹å‘å¸ƒè€…çš„æ¶ˆæ¯ï¼›</li>
<li>ä¸ºäº†æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¢é˜…è€…éœ€è¦æå‰è®¢é˜…è¯¥è§’è‰²ä¸»é¢˜ï¼Œå¹¶ä¿æŒåœ¨çº¿è¿è¡Œï¼›</li>
</ul>
<h1 id="å¸¸ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#å¸¸ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å¸¸ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>å¸¸ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h1><ul>
<li><a href="https://www.rabbitmq.com/">RabbitMQ</a></li>
<li><a href="http://activemq.apache.org/">ActiveMQ</a></li>
<li><a href="https://github.com/alibaba/RocketMQ">RocketMQ</a></li>
<li><a href="http://kafka.apache.org/">Apache Kafka</a></li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>mq</tag>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸‰ï¼‰Apache ActiveMQ</title>
    <url>/p/32495/</url>
    <content><![CDATA[<h1 id="åœ¨Ubuntuä¸Šå®‰è£…ActiveMQ"><a href="#åœ¨Ubuntuä¸Šå®‰è£…ActiveMQ" class="headerlink" title="åœ¨Ubuntuä¸Šå®‰è£…ActiveMQ"></a>åœ¨Ubuntuä¸Šå®‰è£…ActiveMQ</h1><h2 id="ç³»ç»Ÿåˆå§‹åŒ–"><a href="#ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–"></a>ç³»ç»Ÿåˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt dist-upgrade</span><br><span class="line">$ sudo apt autoremove</span><br><span class="line">$ sudo apt clean</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="æ­å»ºactivemqæœåŠ¡"><a href="#æ­å»ºactivemqæœåŠ¡" class="headerlink" title="æ­å»ºactivemqæœåŠ¡"></a>æ­å»ºactivemqæœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir /home/active-mq</span><br><span class="line">$ <span class="built_in">cd</span> /home/active-mq</span><br><span class="line">$ wget http://www.apache.org/dist/activemq/5.15.9/apache-activemq-5.15.9-bin.tar.gz</span><br><span class="line"><span class="comment"># å…·ä½“ç‰ˆæœ¬è¯·æŸ¥çœ‹http://www.apache.org/dist/activemq</span></span><br><span class="line">$ tar -zxvf apache-activemq-5.15.9-bin.tar.gz</span><br><span class="line"><span class="comment"># å¦‚æœæœªå®‰è£…jdkï¼Œæ‰§è¡Œ sudo apt-get install openjdk-8-jdk</span></span><br><span class="line">$ ./activemq start</span><br><span class="line">INFO: Loading <span class="string">&#x27;/home/active-mq/apache-activemq-5.15.9//bin/env&#x27;</span></span><br><span class="line">INFO: Using java <span class="string">&#x27;/usr/bin/java&#x27;</span></span><br><span class="line">INFO: Starting - inspect logfiles specified <span class="keyword">in</span> logging.properties and log4j.properties to get details</span><br><span class="line">INFO: pidfile created : <span class="string">&#x27;/home/active-mq/apache-activemq-5.15.9//data/activemq.pid&#x27;</span> (pid <span class="string">&#x27;6356&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h2><p>æµè§ˆå™¨æ‰“å¼€<a href="http://localhost:8161/admin/%EF%BC%8C%E8%BE%93%E5%85%A5admin%EF%BC%8Cadmin">http://localhost:8161/admin/ï¼Œè¾“å…¥adminï¼Œadmin</a></p>
<p><img data-src="https://i.loli.net/2019/04/02/5ca2dc9f9f76c.png"></p>
<p>è‡³æ­¤ï¼ŒActiveMQæ­å»ºå®Œæˆã€‚</p>
<h1 id="ç†è§£JMS-Java-Message-Service"><a href="#ç†è§£JMS-Java-Message-Service" class="headerlink" title="ç†è§£JMS( Java Message Service)"></a>ç†è§£JMS( Java Message Service)</h1><p>Javaæ¶ˆæ¯æœåŠ¡æŒ‡çš„æ˜¯ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œå¼‚æ­¥é€šä¿¡çš„APIï¼Œå®ƒä¸ºæ ‡å‡†æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æœåŠ¡æä¾›äº†ä¸€ç»„é€šç”¨æ¥å£ï¼ŒåŒ…æ‹¬åˆ›å»ºã€å‘é€ã€è¯»å–æ¶ˆæ¯ç­‰ï¼Œç”¨äºæ”¯æŒJAVAåº”ç”¨ç¨‹åºå¼€å‘ã€‚</p>
<h2 id="JMSæ¨¡å‹"><a href="#JMSæ¨¡å‹" class="headerlink" title="JMSæ¨¡å‹"></a>JMSæ¨¡å‹</h2><ul>
<li><p><a href="https://zh.wikipedia.org/wiki/%E7%82%B9%E5%AF%B9%E7%82%B9">ç‚¹å¯¹ç‚¹</a>ï¼ˆP2Pï¼‰æˆ–é˜Ÿåˆ—æ¨¡å‹</p>
<ul>
<li>åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å°†è·å¾—æ¶ˆæ¯</li>
<li>ç”Ÿäº§è€…ä¸éœ€è¦åœ¨æ¥æ”¶è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯æœŸé—´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ¥æ”¶è€…ä¹ŸåŒæ ·ä¸éœ€è¦åœ¨æ¶ˆæ¯å‘é€æ—¶å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li>
<li>æ¯ä¸€ä¸ªæˆåŠŸå¤„ç†çš„æ¶ˆæ¯éƒ½ç”±æ¥æ”¶è€…ç­¾æ”¶</li>
</ul>
</li>
<li><p><a href="https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85">å‘å¸ƒ/è®¢é˜…</a>æ¨¡å‹</p>
<ul>
<li>å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è·å¾—æ¶ˆæ¯</li>
<li>åœ¨å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´å­˜åœ¨æ—¶é—´ä¾èµ–æ€§ã€‚å‘å¸ƒè€…éœ€è¦åˆ›å»ºä¸€ä¸ªè®¢é˜…ï¼ˆsubscriptionï¼‰ï¼Œä»¥ä¾¿å®¢æˆ·èƒ½å¤Ÿè´­è®¢é˜…ã€‚è®¢é˜…è€…å¿…é¡»ä¿æŒæŒç»­çš„æ´»åŠ¨çŠ¶æ€ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œé™¤éè®¢é˜…è€…åˆ›å»ºäº†æŒä¹…çš„è®¢é˜…ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œåœ¨è®¢é˜…è€…æœªè¿æ¥æ—¶å‘å¸ƒçš„æ¶ˆæ¯å°†åœ¨è®¢é˜…è€…é‡æ–°è¿æ¥æ—¶é‡æ–°å‘å¸ƒã€‚</li>
</ul>
</li>
</ul>
<h2 id="ä¼ ç»ŸAPI"><a href="#ä¼ ç»ŸAPI" class="headerlink" title="ä¼ ç»ŸAPI"></a>ä¼ ç»ŸAPI</h2><p>ä¼ ç»ŸAPIæä¾›çš„ä¸»è¦æ¥å£å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>ConnectionFactoryï¼šå®¢æˆ·ç«¯ç”¨æ¥åˆ›å»ºè¿æ¥çš„å—ç®¡å¯¹è±¡ã€‚ç®€åŒ–APIä¹Ÿä¼šä½¿ç”¨æ­¤æ¥å£ã€‚</p>
</li>
<li><p>Connectionï¼šå®¢æˆ·ç«¯åˆ°JMSæä¾›è€…ä¹‹é—´çš„æ´»åŠ¨è¿æ¥ã€‚</p>
</li>
<li><p>Sessionï¼šå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚</p>
</li>
<li><p>MessageProducerï¼šç”±Sessionåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºå‘é€æ¶ˆæ¯åˆ°Queueæˆ–Topic</p>
</li>
<li><p>MessageConsumerï¼šç”±Sessionåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶Queueæˆ–Topicä¸­çš„æ¶ˆæ¯</p>
</li>
</ul>
<p><img data-src="https://i.loli.net/2019/04/02/5ca3451b03d54.jpg"></p>
<h2 id="ç®€åŒ–API"><a href="#ç®€åŒ–API" class="headerlink" title="ç®€åŒ–API"></a>ç®€åŒ–API</h2><p>ç®€åŒ–APIä¸ä¼ ç»ŸAPIæä¾›çš„æ¶ˆæ¯åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒéœ€è¦çš„æ¥å£æ›´å°‘ã€ä½¿ç”¨æ›´æ–¹ä¾¿ã€‚ ç®€åŒ–APIæä¾›çš„ä¸»è¦æ¥å£å¦‚ä¸‹ï¼š</p>
<ul>
<li>ConnectionFactoryï¼šå®¢æˆ·ç«¯ç”¨æ¥åˆ›å»ºè¿æ¥çš„å—ç®¡å¯¹è±¡ã€‚ä¼ ç»ŸAPIä¹Ÿä¼šä½¿ç”¨æ­¤æ¥å£ã€‚</li>
<li>JMSContextï¼šå®¢æˆ·ç«¯åˆ°JMSæä¾›è€…ä¹‹é—´çš„æ´»åŠ¨è¿æ¥ï¼Œä»¥åŠå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚</li>
<li>JMSProducerï¼šç”±JMSContextåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºå‘é€æ¶ˆæ¯åˆ°Queueæˆ–Topic</li>
<li>JMSConsumerï¼šç”±JMSContextåˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶Queueæˆ–Topicä¸­çš„æ¶ˆæ¯</li>
</ul>
<p><img data-src="https://i.loli.net/2019/04/02/5ca3456dda534.png"></p>
<p>åœ¨ç®€åŒ–APIä¸­ï¼Œä¸€ä¸ªJMSContextå¯¹è±¡å°è£…äº†ä¼ ç»ŸAPIä¸­Connectionå’ŒSessionä¸¤ä¸ªå¯¹è±¡çš„è¡Œä¸ºã€‚</p>
<h2 id="å¼€å‘ä¸€ä¸ªJMSå®¢æˆ·ç«¯"><a href="#å¼€å‘ä¸€ä¸ªJMSå®¢æˆ·ç«¯" class="headerlink" title="å¼€å‘ä¸€ä¸ªJMSå®¢æˆ·ç«¯"></a>å¼€å‘ä¸€ä¸ªJMSå®¢æˆ·ç«¯</h2><p>ä¸€ä¸ªä½¿ç”¨ä¼ ç»ŸAPIçš„JMSå®¢æˆ·ç«¯å…¸å‹çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨JNDIæŸ¥æ‰¾ä¸€ä¸ªConnectionFactoryå¯¹è±¡</li>
<li>ä½¿ç”¨JNDIæŸ¥æ‰¾ä¸€ä¸ªæˆ–å¤šä¸ªDestinationå¯¹è±¡</li>
<li>ä½¿ç”¨ConnectionFactoryåˆ›å»ºä¸€ä¸ªJMS Connectionå¯¹è±¡</li>
<li>ä½¿ç”¨Connectionåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªJMS Sessionå¯¹è±¡</li>
<li>ä½¿ç”¨Sessionå’ŒDestinationå¯¹è±¡åˆ›å»ºéœ€è¦çš„MessageProducerå’ŒMessageConsumerå¯¹è±¡</li>
<li>é€šçŸ¥Connectionå¯¹è±¡å¼€å§‹æŠ•é€’æ¶ˆæ¯</li>
</ul>
<blockquote>
<p>Active MQæ˜¯å®Œå…¨å®ç°JMSè§„èŒƒçš„JMSå®¢æˆ·ç«¯</p>
</blockquote>
<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><h2 id="åˆ›å»ºHello-Worldé¡¹ç›®"><a href="#åˆ›å»ºHello-Worldé¡¹ç›®" class="headerlink" title="åˆ›å»ºHello Worldé¡¹ç›®"></a>åˆ›å»ºHello Worldé¡¹ç›®</h2><p>åˆ›å»ºgradleé¡¹ç›®ï¼Œå¹¶ç¼–è¾‘build.gradle</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">compile group: &#x27;org.apache.activemq&#x27;, name: &#x27;activemq-all&#x27;, version: &#x27;5.15.9&#x27;</span><br><span class="line">compile group: &#x27;com.fasterxml.jackson.core&#x27;, name: &#x27;jackson-databind&#x27;, version: &#x27;2.9.8&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºç”Ÿäº§è€…"><a href="#åˆ›å»ºç”Ÿäº§è€…" class="headerlink" title="åˆ›å»ºç”Ÿäº§è€…"></a>åˆ›å»ºç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldProducer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">            ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">&quot;vm://localhost&quot;</span>);</span><br><span class="line">            <span class="comment">// 2. åˆ›å»ºè¿æ¥</span></span><br><span class="line">            Connection connection = connectionFactory.createConnection();</span><br><span class="line">            connection.start();</span><br><span class="line">            <span class="comment">// 3. åˆ›å»ºä¼šè¯</span></span><br><span class="line">            Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">            <span class="comment">// 4. åˆ›å»ºç›®çš„åœ°ï¼ˆä¸»é¢˜æˆ–é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">            Destination destination = session.createQueue(<span class="string">&quot;TEST.FOO&quot;</span>);</span><br><span class="line">            <span class="comment">// 5. ä»ä¼šè¯åˆ›å»ºåˆ°ç›®çš„åœ°çš„æ¶ˆæ¯å‘å¸ƒè€…</span></span><br><span class="line">            MessageProducer producer = session.createProducer(destination);</span><br><span class="line">            producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</span><br><span class="line">            <span class="comment">// 6. åˆ›å»ºå¹¶å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">            String text = <span class="string">&quot;Hello world! From: &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + <span class="keyword">this</span>.hashCode();</span><br><span class="line">            TextMessage message = session.createTextMessage(text);</span><br><span class="line">            System.out.println(<span class="string">&quot;Sent message: &quot;</span> + message.hashCode() + <span class="string">&quot; : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            producer.send(message);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. é”€æ¯èµ„æº</span></span><br><span class="line">            session.close();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught: &quot;</span> + e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºæ¶ˆè´¹è€…"><a href="#åˆ›å»ºæ¶ˆè´¹è€…" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…"></a>åˆ›å»ºæ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldConsumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span>, <span class="title">ExceptionListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">            ActiveMQConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">&quot;vm://localhost&quot;</span>);</span><br><span class="line">            <span class="comment">// 2. åˆ›å»ºè¿æ¥</span></span><br><span class="line">            Connection connection = connectionFactory.createConnection();</span><br><span class="line">            connection.start();</span><br><span class="line">            <span class="comment">// 3. åˆ›å»ºä¼šè¯</span></span><br><span class="line">            Session session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">            <span class="comment">// 4. åˆ›å»ºç›®çš„åœ°ï¼ˆä¸»é¢˜æˆ–é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">            Destination destination = session.createQueue(<span class="string">&quot;TEST.FOO&quot;</span>);</span><br><span class="line">            <span class="comment">// 5. ä»ä¼šè¯åˆ›å»ºåˆ°ç›®çš„åœ°çš„æ¶ˆæ¯æ¶ˆè´¹è€…</span></span><br><span class="line">            MessageConsumer consumer = session.createConsumer(destination);</span><br><span class="line">            <span class="comment">// 6. ç­‰å¾…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">            Message message = consumer.receive(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">                TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                String text = textMessage.getText();</span><br><span class="line">                System.out.println(<span class="string">&quot;Received: &quot;</span> + text);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Received: &quot;</span> + message);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. é”€æ¯èµ„æº</span></span><br><span class="line">            consumer.close();</span><br><span class="line">            session.close();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught: &quot;</span> + e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(JMSException exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;JMS Exception occured.  Shutting down client.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldConsumer(), <span class="keyword">false</span>);</span><br><span class="line">        thread(<span class="keyword">new</span> HelloWorldProducer(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">thread</span><span class="params">(Runnable runnable, <span class="keyword">boolean</span> daemon)</span> </span>&#123;</span><br><span class="line">        Thread brokerThread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        brokerThread.setDaemon(daemon);</span><br><span class="line">        brokerThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ç¨‹åºï¼Œæ§åˆ¶å°å°†ä¼šæ‰“å°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Sent message: 507732978 : Thread-6</span><br><span class="line">Sent message: 2056557229 : Thread-0</span><br><span class="line">Sent message: 39234146 : Thread-8</span><br><span class="line">Sent message: 1100925878 : Thread-13</span><br><span class="line">Sent message: 1566392082 : Thread-17</span><br><span class="line">Sent message: 1329793151 : Thread-1</span><br><span class="line">Sent message: 988436874 : Thread-16</span><br><span class="line">Received: Hello world! From: Thread-6 : 1442537083</span><br><span class="line">Received: Hello world! From: Thread-1 : 1531760310</span><br><span class="line">Received: Hello world! From: Thread-0 : 1817576164</span><br><span class="line">Received: Hello world! From: Thread-8 : 262381200</span><br><span class="line">Received: Hello world! From: Thread-17 : 1647178742</span><br><span class="line">Received: Hello world! From: Thread-13 : 1610404140</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>ActiveMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ç†è§£Nginxè´Ÿè½½å‡è¡¡</title>
    <url>/p/52703/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å·¥ä½œä»¥æ¥ï¼Œä¸€ç›´éƒ½åœ¨ä½¿ç”¨Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä½†æ˜¯å…³äºNginxçš„è´Ÿè½½å‡è¡¡ç®—æ³•ä¸€ç›´æ²¡æœ‰æ·±å…¥ç†è§£è¿‡ï¼Œè¿™æ¬¡å¥½å¥½çš„æ•´ç†ä¸‹ã€‚</p>
<span id="more"></span>

<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><h2 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h2><blockquote>
<p>æ­å»ºä¸‰å°ç”¨äºæµ‹è¯•çš„è™šæ‹Ÿæœº</p>
</blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>IP</th>
<th>æœåŠ¡</th>
</tr>
</thead>
<tbody><tr>
<td>node01</td>
<td>192.168.198.131</td>
<td>Nginxã€æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰</td>
</tr>
<tr>
<td>node02</td>
<td>192.168.198.130</td>
<td>æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰</td>
</tr>
<tr>
<td>node03</td>
<td>192.168.198.132</td>
<td>æ¨¡æ‹Ÿä¸šåŠ¡ï¼ˆ8080ï¼‰</td>
</tr>
</tbody></table>
<p>ä¿®æ”¹<code>hostname</code>å’Œ<code>hosts</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line">192.168.198.131 node01</span><br><span class="line">$ vim /etc/hostname</span><br><span class="line">node01</span><br><span class="line">$ reboot</span><br><span class="line"><span class="comment">## å…¶ä½™ä¸¤å°ä¹Ÿæ”¹ä¸‹ï¼Œå¹¶é‡å¯ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure>

<p>åœ¨node01ä¸Š<a href="https://gcdd1993.github.io/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0%EF%BC%88%E9%83%A8%E7%BD%B2%E7%AF%87%EF%BC%89/#Nginx">å®‰è£…NginxæœåŠ¡</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&quot;deb http://nginx.org/packages/ubuntu/ <span class="subst">$(lsb_release -cs)</span> nginx\ndeb-src http://nginx.org/packages/ubuntu/ <span class="subst">$(lsb_release -cs)</span> nginx&quot;</span> | sudo tee /etc/apt/sources.list.d/nginx.list</span><br><span class="line">$ wget -O- http://nginx.org/keys/nginx_signing.key | sudo apt-key add -</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install nginx</span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡æ‹Ÿä¸šåŠ¡"><a href="#æ¨¡æ‹Ÿä¸šåŠ¡" class="headerlink" title="æ¨¡æ‹Ÿä¸šåŠ¡"></a>æ¨¡æ‹Ÿä¸šåŠ¡</h2><p>ä½¿ç”¨<a href="https://start.spring.io/">https://start.spring.io</a>å¿«é€Ÿæ–°å»º<code>Spring Boot</code>é¡¹ç›®ï¼Œæ·»åŠ Webæ¨¡å—ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;this is : &quot;</span> + Inet4Address.getLocalHost();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://docs.gradle.org/current/userguide/application_plugin.html">The Application Plugin</a>ï¼Œéƒ¨ç½²å®Œæ¯•å¯åŠ¨</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cedfb9fdb17458291.png"></p>
<p>æµ‹è¯•ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## node01</span></span><br><span class="line">$ curl 192.168.198.131:8080/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br><span class="line"><span class="comment">## node02</span></span><br><span class="line">$ curl 192.168.198.130:8080/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node02/192.168.198.130</span><br><span class="line"><span class="comment">## node03</span></span><br><span class="line">$ curl 192.168.198.132:8080/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br></pre></td></tr></table></figure>

<h1 id="Nginxè´Ÿè½½å‡è¡¡"><a href="#Nginxè´Ÿè½½å‡è¡¡" class="headerlink" title="Nginxè´Ÿè½½å‡è¡¡"></a>Nginxè´Ÿè½½å‡è¡¡</h1><h2 id="Round-Robinï¼ˆè½®è¯¢ï¼‰"><a href="#Round-Robinï¼ˆè½®è¯¢ï¼‰" class="headerlink" title="Round Robinï¼ˆè½®è¯¢ï¼‰"></a><strong>Round Robin</strong>ï¼ˆè½®è¯¢ï¼‰</h2><blockquote>
<p>è¯·æ±‚åœ¨æœåŠ¡å™¨ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼Œ<strong>å¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡</strong>ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	server 192.168.198.131:8080;</span><br><span class="line">	server 192.168.198.132:8080;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name 192.168.198.131;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://backend;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131 <span class="comment"># node01</span></span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132 <span class="comment"># node03</span></span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.130 <span class="comment"># node02</span></span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131 <span class="comment"># node01</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯å°æœåŠ¡å™¨è®¿é—®åˆ°çš„æ¬¡æ•°æ˜¯ç›¸ç­‰çš„ã€‚</p>
<h2 id="Least-Connections"><a href="#Least-Connections" class="headerlink" title="Least Connections"></a><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html?&_ga=2.118306121.1736170978.1559096932-1620268891.1559096932#least_conn"><strong>Least Connections</strong></a></h2><blockquote>
<p>è¯·æ±‚åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼Œ<strong>å¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡</strong>ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	least_conn;</span><br><span class="line">	server 192.168.198.131:8080;</span><br><span class="line">	server 192.168.198.132:8080;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¸çŸ¥é“æ€ä¹ˆæ¨¡æ‹Ÿå‡ºè¿æ¥æ•°æœ€å°‘åœºæ™¯ã€‚</p>
<h2 id="IP-Hash"><a href="#IP-Hash" class="headerlink" title="IP Hash"></a><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash"><strong>IP Hash</strong></a></h2><blockquote>
<p>ä»å®¢æˆ·ç«¯çš„IPåœ°å€æ¥ç¡®å®šè¯·æ±‚åº”è¯¥å‘é€ç»™å“ªå°æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨IPv4åœ°å€çš„å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚æˆ–æ•´ä¸ªIPv6åœ°å€æ¥è®¡ç®—æ•£åˆ—å€¼ã€‚è¯¥æ–¹æ³•èƒ½ä¿è¯æ¥è‡ªåŒä¸€åœ°å€çš„è¯·æ±‚åˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œé™¤éè¯¥æœåŠ¡å™¨ä¸å¯ç”¨ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.198.131:8080;</span><br><span class="line">	server 192.168.198.132:8080;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°node01èŠ‚ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°†node01èŠ‚ç‚¹å…³é—­ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ps -ef | grep demo</span><br><span class="line">root       3343   1764  0 11:52 pts/0    00:00:23 java -jar /home/demo/demo-boot-0.0.1-SNAPSHOT/lib/demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">root       4529   1764  0 13:11 pts/0    00:00:00 grep --color=auto demo</span><br><span class="line">$ <span class="built_in">kill</span> -9 3343</span><br><span class="line">$ ps -ef | grep demo</span><br><span class="line">root       4529   1764  0 13:11 pts/0    00:00:00 grep --color=auto demo</span><br><span class="line"></span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br></pre></td></tr></table></figure>

<p>ç”±äºnode01èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°node03èŠ‚ç‚¹ã€‚</p>
<h2 id="Generic-Hash"><a href="#Generic-Hash" class="headerlink" title="Generic Hash"></a>Generic <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash"><strong>Hash</strong></a></h2><blockquote>
<p>ä¸ä¸Šé¢çš„IP_HASHç±»ä¼¼ï¼Œé€šç”¨HASHæŒ‰ç…§ç”¨æˆ·å®šä¹‰çš„å‚æ•°æ¥è®¡ç®—æ•£åˆ—å€¼ï¼Œå‚æ•°å¯ä»¥æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå˜é‡æˆ–ç»„åˆã€‚ä¾‹å¦‚ï¼Œå‚æ•°å¯ä»¥æ˜¯è¿œç«¯åœ°å€ï¼š</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	<span class="built_in">hash</span> <span class="variable">$remote_addr</span> consistent;</span><br><span class="line">	server 192.168.198.131:8080;</span><br><span class="line">	server 192.168.198.132:8080;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node02/192.168.198.130</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node02/192.168.198.130</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node02/192.168.198.130</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚éƒ½è¢«åˆ†é…åˆ°äº†<code>node02</code>èŠ‚ç‚¹ã€‚</p>
<p>ğŸ‘‰ä¸Šé¢çš„<code>consistent</code>æ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œå°†é‡‡ç”¨<a href="http://blog.codinglabs.org/articles/consistent-hashing.html">Ketamaä¸€è‡´æ€§hashç®—æ³•</a>è®¡ç®—æ•£åˆ—å€¼ã€‚</p>
<p>å…³äºä¸€è‡´æ€§Hashï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="https://gcdd1993.github.io/%E7%90%86%E8%A7%A3%E4%B8%80%E8%87%B4%E6%80%A7Hash%E7%AE%97%E6%B3%95">ç†è§£ä¸€è‡´æ€§Hashç®—æ³•</a></p>
<h2 id="Random"><a href="#Random" class="headerlink" title="Random"></a><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#random"><strong>Random</strong></a></h2><blockquote>
<p>è¯·æ±‚ä¼šè¢«éšæœºåˆ†é…åˆ°ä¸€å°æœåŠ¡å™¨ï¼Œ<strong>å¯ä»¥è®¾ç½®æœåŠ¡å™¨æƒé‡</strong>ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	random;</span><br><span class="line">	server 192.168.198.131:8080;</span><br><span class="line">	server 192.168.198.132:8080;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node02/192.168.198.130</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.130</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚æ˜¯è¢«éšæœºåˆ†é…åˆ°ä¸‰å°æœåŠ¡å™¨çš„ã€‚</p>
<h2 id="Weights"><a href="#Weights" class="headerlink" title="Weights"></a>Weights</h2><blockquote>
<p>é™¤äº†è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæœåŠ¡å™¨è®¾ç½®æƒé‡ï¼Œæƒé‡é»˜è®¤å€¼æ˜¯1</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/nginx/conf/demo.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line">	server 192.168.198.131:8080 weight=5;</span><br><span class="line">	server 192.168.198.132:8080 weight=10;</span><br><span class="line">	server 192.168.198.130:8080;</span><br><span class="line">&#125;</span><br><span class="line">$ service nginx restart</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node03/192.168.198.132</span><br><span class="line">$ curl 192.168.198.131/<span class="built_in">test</span></span><br><span class="line">...</span><br><span class="line">this is : node01/192.168.198.131</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ5æ¬¡è¯·æ±‚ä¸­ï¼Œ<code>node03(weight=10)</code>å äº†3æ¬¡ï¼Œ<code>node01(weight=5)</code>å äº†2æ¬¡ï¼Œ<code>node02(weight=1)</code>1æ¬¡éƒ½æ²¡æœ‰ã€‚</p>
<p>ç†è®ºä¸Šæ¥è¯´ï¼Œä¸Šé¢çš„é…ç½®ï¼Œè®¿é—®16æ¬¡ï¼Œnode03åº”è¢«åˆ†é…10æ¬¡ï¼Œnode01åº”è¢«åˆ†é…5æ¬¡ï¼Œnode02åº”è¢«åˆ†é…1æ¬¡ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#overview">http-load-balancer</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>ç†è§£ä¸€è‡´æ€§Hashç®—æ³•</title>
    <url>/p/61241/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨1997å¹´ç”±éº»çœç†å·¥å­¦é™¢çš„Kargerç­‰äººåœ¨è§£å†³åˆ†å¸ƒå¼Cacheä¸­æå‡ºçš„ï¼Œè®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³å› ç‰¹ç½‘ä¸­çš„çƒ­ç‚¹(Hot spot)é—®é¢˜ï¼Œåˆè¡·å’ŒCARPååˆ†ç±»ä¼¼ã€‚ä¸€è‡´æ€§å“ˆå¸Œä¿®æ­£äº†CARPä½¿ç”¨çš„ç®€å•å“ˆå¸Œç®—æ³•å¸¦æ¥çš„é—®é¢˜ï¼Œä½¿å¾—DHTå¯ä»¥åœ¨P2Pç¯å¢ƒä¸­çœŸæ­£å¾—åˆ°åº”ç”¨ã€‚</p>
</blockquote>
<p>ç°åœ¨ä¸€è‡´æ€§hashç®—æ³•åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¹Ÿå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œç ”ç©¶è¿‡memcachedç¼“å­˜æ•°æ®åº“çš„äººéƒ½çŸ¥é“ï¼ŒmemcachedæœåŠ¡å™¨ç«¯æœ¬èº«ä¸æä¾›åˆ†å¸ƒå¼cacheçš„ä¸€è‡´æ€§ï¼Œè€Œæ˜¯ç”±å®¢æˆ·ç«¯æ¥æä¾›ï¼Œå…·ä½“åœ¨è®¡ç®—ä¸€è‡´æ€§hashæ—¶é‡‡ç”¨å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<span id="more"></span>

<ol>
<li><p>é¦–å…ˆæ±‚å‡ºmemcachedæœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶é…ç½®åˆ°0ï½2^32çš„åœ†ï¼ˆcontinuumï¼‰ä¸Šã€‚</p>
</li>
<li><p>é‡‡ç”¨åŒæ ·çš„æ–¹æ³•æ±‚å‡ºå­˜å‚¨æ•°æ®çš„é”®çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ˜ å°„åˆ°ç›¸åŒçš„åœ†ä¸Šã€‚</p>
</li>
<li><p>ä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹<strong>é¡ºæ—¶é’ˆ</strong>æŸ¥æ‰¾ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚å¦‚æœè¶…è¿‡2^32ä»ç„¶æ‰¾ä¸åˆ°æœåŠ¡å™¨ï¼Œå°±ä¼šä¿å­˜åˆ°ç¬¬ä¸€å°memcachedæœåŠ¡å™¨ä¸Šã€‚</p>
</li>
</ol>
<p><img data-src="https://i.loli.net/2019/05/29/5cee559706c3135766.png"></p>
<p>ä»ä¸Šå›¾çš„çŠ¶æ€ä¸­æ·»åŠ ä¸€å°memcachedæœåŠ¡å™¨ã€‚ä½™æ•°åˆ†å¸ƒå¼ç®—æ³•ç”±äºä¿å­˜é”®çš„æœåŠ¡å™¨ä¼šå‘ç”Ÿå·¨å¤§å˜åŒ–è€Œå½±å“ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œä½†Consistent Hashingä¸­ï¼Œåªæœ‰åœ¨åœ†ï¼ˆcontinuumï¼‰ä¸Šå¢åŠ æœåŠ¡å™¨çš„åœ°ç‚¹é€†æ—¶é’ˆæ–¹å‘çš„ç¬¬ä¸€å°æœåŠ¡å™¨ä¸Šçš„é”®ä¼šå—åˆ°å½±å“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee508b7cfab34733.png"></p>
<h1 id="ä¸€è‡´æ€§Hashæ€§è´¨"><a href="#ä¸€è‡´æ€§Hashæ€§è´¨" class="headerlink" title="ä¸€è‡´æ€§Hashæ€§è´¨"></a>ä¸€è‡´æ€§Hashæ€§è´¨</h1><blockquote>
<p>è€ƒè™‘åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½<strong>å¤±æ•ˆ</strong>ï¼Œå¹¶ä¸”<strong>æ–°çš„èŠ‚ç‚¹</strong>å¾ˆå¯èƒ½åŠ¨æ€çš„å¢åŠ è¿›æ¥ï¼Œå¦‚ä½•ä¿è¯å½“ç³»ç»Ÿçš„èŠ‚ç‚¹æ•°ç›®å‘ç”Ÿå˜åŒ–æ—¶ä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›è‰¯å¥½çš„æœåŠ¡ï¼Œè¿™æ˜¯å€¼å¾—è€ƒè™‘çš„ã€‚</p>
<p>å°¤å…¶æ˜¯åœ¨è®¾è®¡åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿæ—¶ï¼Œå¦‚æœæŸå°æœåŠ¡å™¨å¤±æ•ˆï¼Œå¯¹äºæ•´ä¸ªç³»ç»Ÿæ¥è¯´å¦‚æœä¸é‡‡ç”¨åˆé€‚çš„ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆç¼“å­˜äºç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¯èƒ½ä¼šå¤±æ•ˆï¼ˆå³ç”±äºç³»ç»ŸèŠ‚ç‚¹æ•°ç›®å˜å°‘ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚æŸä¸€å¯¹è±¡æ—¶éœ€è¦é‡æ–°è®¡ç®—å…¶hashå€¼ï¼ˆé€šå¸¸ä¸ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ•°ç›®æœ‰å…³ï¼‰ï¼Œç”±äºhashå€¼å·²ç»æ”¹å˜ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½æ‰¾ä¸åˆ°ä¿å­˜è¯¥å¯¹è±¡çš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼‰ï¼Œå› æ­¤ä¸€è‡´æ€§hashå°±æ˜¾å¾—è‡³å…³é‡è¦ã€‚</p>
</blockquote>
<p>è‰¯å¥½çš„åˆ†å¸ƒå¼cahceç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§hashç®—æ³•åº”è¯¥æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>å¹³è¡¡æ€§(Balance)</strong></li>
</ul>
<blockquote>
<p>å¹³è¡¡æ€§æ˜¯æŒ‡<strong>å“ˆå¸Œçš„ç»“æœèƒ½å¤Ÿå°½å¯èƒ½åˆ†å¸ƒåˆ°æ‰€æœ‰çš„ç¼“å†²ä¸­å»</strong>ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ‰€æœ‰çš„ç¼“å†²ç©ºé—´éƒ½å¾—åˆ°åˆ©ç”¨ã€‚å¾ˆå¤šå“ˆå¸Œç®—æ³•éƒ½èƒ½å¤Ÿæ»¡è¶³è¿™ä¸€æ¡ä»¶ã€‚</p>
</blockquote>
<ul>
<li><strong>å•è°ƒæ€§(Monotonicity)</strong></li>
</ul>
<blockquote>
<p>å•è°ƒæ€§æ˜¯æŒ‡å¦‚æœå·²ç»æœ‰ä¸€äº›å†…å®¹é€šè¿‡å“ˆå¸Œåˆ†æ´¾åˆ°äº†ç›¸åº”çš„ç¼“å†²ä¸­ï¼Œåˆæœ‰æ–°çš„ç¼“å†²åŒºåŠ å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆå“ˆå¸Œçš„ç»“æœåº”èƒ½å¤Ÿä¿è¯åŸæœ‰å·²åˆ†é…çš„å†…å®¹å¯ä»¥è¢«æ˜ å°„åˆ°æ–°çš„ç¼“å†²åŒºä¸­å»ï¼Œè€Œä¸ä¼šè¢«æ˜ å°„åˆ°æ—§çš„ç¼“å†²é›†åˆä¸­çš„å…¶ä»–ç¼“å†²åŒºã€‚</p>
<p>ç®€å•çš„å“ˆå¸Œç®—æ³•å¾€å¾€ä¸èƒ½æ»¡è¶³å•è°ƒæ€§çš„è¦æ±‚ï¼Œå¦‚æœ€ç®€å•çš„çº¿æ€§å“ˆå¸Œ<code>x = (ax + b) mod (P)</code>ï¼Œåœ¨ä¸Šå¼ä¸­ï¼ŒPè¡¨ç¤ºå…¨éƒ¨ç¼“å†²çš„å¤§å°ã€‚ä¸éš¾çœ‹å‡ºï¼Œå½“ç¼“å†²å¤§å°å‘ç”Ÿå˜åŒ–æ—¶(ä»P1åˆ°P2)ï¼ŒåŸæ¥æ‰€æœ‰çš„å“ˆå¸Œç»“æœå‡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œä¸æ»¡è¶³å•è°ƒæ€§çš„è¦æ±‚ã€‚</p>
<p>å“ˆå¸Œç»“æœçš„å˜åŒ–æ„å‘³ç€å½“ç¼“å†²ç©ºé—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰çš„æ˜ å°„å…³ç³»éœ€è¦åœ¨ç³»ç»Ÿå†…å…¨éƒ¨æ›´æ–°ã€‚è€Œåœ¨P2Pç³»ç»Ÿå†…ï¼Œç¼“å†²çš„å˜åŒ–ç­‰ä»·äºPeeråŠ å…¥æˆ–é€€å‡ºç³»ç»Ÿï¼Œè¿™ä¸€æƒ…å†µåœ¨P2Pç³»ç»Ÿä¸­ä¼šé¢‘ç¹å‘ç”Ÿï¼Œå› æ­¤ä¼šå¸¦æ¥æå¤§è®¡ç®—å’Œä¼ è¾“è´Ÿè·ã€‚<strong>å•è°ƒæ€§å°±æ˜¯è¦æ±‚å“ˆå¸Œç®—æ³•èƒ½å¤Ÿåº”å¯¹è¿™ç§æƒ…å†µ</strong>ã€‚</p>
</blockquote>
<ul>
<li><strong>åˆ†æ•£æ€§(Spread)</strong></li>
</ul>
<blockquote>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»ˆç«¯æœ‰å¯èƒ½çœ‹ä¸åˆ°æ‰€æœ‰çš„ç¼“å†²ï¼Œè€Œæ˜¯åªèƒ½çœ‹åˆ°å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å½“ç»ˆç«¯å¸Œæœ›é€šè¿‡å“ˆå¸Œè¿‡ç¨‹å°†å†…å®¹æ˜ å°„åˆ°ç¼“å†²ä¸Šæ—¶ï¼Œç”±äºä¸åŒç»ˆç«¯æ‰€è§çš„ç¼“å†²èŒƒå›´æœ‰å¯èƒ½ä¸åŒï¼Œä»è€Œå¯¼è‡´å“ˆå¸Œçš„ç»“æœä¸ä¸€è‡´ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„å†…å®¹è¢«ä¸åŒçš„ç»ˆç«¯æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ã€‚è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯åº”è¯¥é¿å…çš„ï¼Œå› ä¸ºå®ƒå¯¼è‡´ç›¸åŒå†…å®¹è¢«å­˜å‚¨åˆ°ä¸åŒç¼“å†²ä¸­å»ï¼Œé™ä½äº†ç³»ç»Ÿå­˜å‚¨çš„æ•ˆç‡ã€‚</p>
<p>åˆ†æ•£æ€§çš„å®šä¹‰å°±æ˜¯ä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„ä¸¥é‡ç¨‹åº¦ã€‚å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é¿å…ä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯<strong>å°½é‡é™ä½åˆ†æ•£æ€§</strong>ã€‚</p>
</blockquote>
<ul>
<li><strong>è´Ÿè½½(Load)</strong></li>
</ul>
<blockquote>
<p>è´Ÿè½½é—®é¢˜å®é™…ä¸Šæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦çœ‹å¾…åˆ†æ•£æ€§é—®é¢˜ã€‚</p>
<p>æ—¢ç„¶ä¸åŒçš„ç»ˆç«¯å¯èƒ½å°†ç›¸åŒçš„å†…å®¹æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„ç¼“å†²åŒºè€Œè¨€ï¼Œä¹Ÿå¯èƒ½è¢«ä¸åŒçš„ç”¨æˆ·æ˜ å°„ä¸ºä¸åŒçš„å†…å®¹ã€‚</p>
<p>ä¸åˆ†æ•£æ€§ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯åº”å½“é¿å…çš„ï¼Œå› æ­¤å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿ<strong>å°½é‡é™ä½ç¼“å†²çš„è´Ÿè·</strong>ã€‚</p>
</blockquote>
<ul>
<li><strong>å¹³æ»‘æ€§(Smoothness)</strong></li>
</ul>
<blockquote>
<p>å¹³æ»‘æ€§æ˜¯æŒ‡ç¼“å­˜æœåŠ¡å™¨çš„æ•°ç›®å¹³æ»‘æ”¹å˜å’Œç¼“å­˜å¯¹è±¡çš„å¹³æ»‘æ”¹å˜æ˜¯ä¸€è‡´çš„ã€‚</p>
</blockquote>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆConsistent Hashingï¼‰æœ€æ—©åœ¨è®ºæ–‡ã€Š<a href="https://link.juejin.im/?target=http://dl.acm.org/citation.cfm?id=258660">Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web</a>ã€‹ä¸­è¢«æå‡ºã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§å“ˆå¸Œå°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ª<strong>è™šæ‹Ÿçš„åœ†ç¯</strong>ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-2^32-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç©ºé—´ç¯å¦‚ä¸‹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee54431b19c11690.png"></p>
<p>æ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ã€‚0å’Œ2^32-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆã€‚</p>
<p>ä¸‹ä¸€æ­¥å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨Hashè¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œå…·ä½“å¯ä»¥é€‰æ‹©<strong>æœåŠ¡å™¨çš„ipæˆ–ä¸»æœºå</strong>ä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ï¼Œè¿™é‡Œå‡è®¾å°†ä¸Šæ–‡ä¸­å››å°æœåŠ¡å™¨ä½¿ç”¨ipåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee5564c55f998409.png"></p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼šå°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯<strong>é¡ºæ—¶é’ˆ</strong>â€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬æœ‰Object Aã€Object Bã€Object Cã€Object Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee55cfac53c21054.png"></p>
<p>æ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Šã€‚</p>
<h2 id="å®¹é”™æ€§"><a href="#å®¹é”™æ€§" class="headerlink" title="å®¹é”™æ€§"></a>å®¹é”™æ€§</h2><p>ç°å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œ<strong>å¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚</strong></p>
<h2 id="å¯æ‰©å±•æ€§"><a href="#å¯æ‰©å±•æ€§" class="headerlink" title="å¯æ‰©å±•æ€§"></a>å¯æ‰©å±•æ€§</h2><p>å¦‚æœåœ¨ç³»ç»Ÿä¸­å¢åŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee566ef2a4232874.png"></p>
<p>æ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œ<strong>å¦‚æœå¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚</strong></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯¹äºèŠ‚ç‚¹çš„å¢å‡éƒ½åªéœ€é‡å®šä½ç¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h2 id="æ•°æ®å€¾æ–œé—®é¢˜"><a href="#æ•°æ®å€¾æ–œé—®é¢˜" class="headerlink" title="æ•°æ®å€¾æ–œé—®é¢˜"></a>æ•°æ®å€¾æ–œé—®é¢˜</h2><p>å¦å¤–ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œé—®é¢˜ã€‚ä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee56cb65e7138601.png"></p>
<p>æ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•å…¥äº†<strong>è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶</strong>ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚</p>
<p>å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨ipæˆ–ä¸»æœºåçš„åé¢å¢åŠ ç¼–å·æ¥å®ç°ã€‚ä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š</p>
<p><img data-src="https://i.loli.net/2019/05/29/5cee56f99435a20863.png"></p>
<p>åŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚</p>
<h1 id="ä»£ç æµ‹è¯•"><a href="#ä»£ç æµ‹è¯•" class="headerlink" title="ä»£ç æµ‹è¯•"></a>ä»£ç æµ‹è¯•</h1><p>ä¸€è‡´æ€§Hashæ¨¡æ‹Ÿç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸€è‡´æ€§Hash</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsistentHash</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èŠ‚ç‚¹çš„å¤åˆ¶å› å­,å®é™…èŠ‚ç‚¹ä¸ªæ•° * numberOfReplicas</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> numberOfReplicas;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è™šæ‹ŸèŠ‚ç‚¹ä¸ªæ•°,å­˜å‚¨è™šæ‹ŸèŠ‚ç‚¹çš„hashå€¼åˆ°çœŸå®èŠ‚ç‚¹çš„æ˜ å°„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SortedMap&lt;Integer, T&gt; circle = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConsistentHash</span><span class="params">(<span class="keyword">int</span> numberOfReplicas, Collection&lt;T&gt; nodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.numberOfReplicas = numberOfReplicas;</span><br><span class="line">        <span class="keyword">for</span> (T node : nodes) &#123;</span><br><span class="line">            add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * å¯¹äºä¸€ä¸ªå®é™…æœºå™¨èŠ‚ç‚¹ node, å¯¹åº” numberOfReplicas ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * ä¸åŒçš„è™šæ‹ŸèŠ‚ç‚¹(iä¸åŒ)æœ‰ä¸åŒçš„hashå€¼,ä½†éƒ½å¯¹åº”åŒä¸€ä¸ªå®é™…æœºå™¨node</span></span><br><span class="line"><span class="comment">     * è™šæ‹Ÿnodeä¸€èˆ¬æ˜¯å‡è¡¡åˆ†å¸ƒåœ¨ç¯ä¸Šçš„,æ•°æ®å­˜å‚¨åœ¨é¡ºæ—¶é’ˆæ–¹å‘çš„è™šæ‹Ÿnodeä¸Š</span></span><br><span class="line"><span class="comment">     * &lt;/P&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node å“ˆå¸Œç¯èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfReplicas; i++) &#123;</span><br><span class="line">            String nodestr = node.toString() + i;</span><br><span class="line">            <span class="keyword">int</span> hashcode = nodestr.hashCode();</span><br><span class="line">            System.out.println(<span class="string">&quot;hashcode:&quot;</span> + hashcode);</span><br><span class="line">            circle.put(hashcode, node);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node å¾…åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(T node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfReplicas; i++) &#123;</span><br><span class="line">            circle.remove((node.toString() + i).hashCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—ä¸€ä¸ªæœ€è¿‘çš„é¡ºæ—¶é’ˆèŠ‚ç‚¹,æ ¹æ®ç»™å®šçš„key å–Hash</span></span><br><span class="line"><span class="comment">     * ç„¶åå†å–å¾—é¡ºæ—¶é’ˆæ–¹å‘ä¸Šæœ€è¿‘çš„ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„å®é™…èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * å†ä»å®é™…èŠ‚ç‚¹ä¸­å–å¾— æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key æ¨¡æ‹Ÿç¼“å­˜Key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (circle.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// node ç”¨Stringæ¥è¡¨ç¤º,è·å¾—nodeåœ¨å“ˆå¸Œç¯ä¸­çš„hashCode</span></span><br><span class="line">        <span class="keyword">int</span> hash = key.hashCode();</span><br><span class="line">        System.out.println(<span class="string">&quot;hashcode-----&gt;:&quot;</span> + hash);</span><br><span class="line">        <span class="comment">//æ•°æ®æ˜ å°„åœ¨ä¸¤å°è™šæ‹Ÿæœºå™¨æ‰€åœ¨ç¯ä¹‹é—´,å°±éœ€è¦æŒ‰é¡ºæ—¶é’ˆæ–¹å‘å¯»æ‰¾æœºå™¨</span></span><br><span class="line">        <span class="keyword">if</span> (!circle.containsKey(hash)) &#123;</span><br><span class="line">            SortedMap&lt;Integer, T&gt; tailMap = circle.tailMap(hash);</span><br><span class="line">            hash = tailMap.isEmpty() ? circle.firstKey() : tailMap.firstKey();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> circle.get(hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰å“ˆå¸Œç¯èŠ‚ç‚¹æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å“ˆå¸Œç¯èŠ‚ç‚¹æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> circle.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹è¡¨ç¤ºæ•´ä¸ªå“ˆå¸Œç¯ä¸­å„ä¸ªè™šæ‹ŸèŠ‚ç‚¹ä½ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å¾—TreeMapä¸­æ‰€æœ‰çš„Key</span></span><br><span class="line">        Set&lt;Integer&gt; sets = circle.keySet();</span><br><span class="line">        <span class="comment">//å°†è·å¾—çš„Keyé›†åˆæ’åº</span></span><br><span class="line">        SortedSet&lt;Integer&gt; sortedSets = <span class="keyword">new</span> TreeSet&lt;Integer&gt;(sets);</span><br><span class="line">        <span class="keyword">for</span> (Integer hashCode : sortedSets) &#123;</span><br><span class="line">            System.out.println(hashCode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;----each location &#x27;s distance are follows: ----&quot;</span>);</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹ç›¸é‚»ä¸¤ä¸ªhashCodeçš„å·®å€¼</span></span><br><span class="line">        Iterator&lt;Integer&gt; it = sortedSets.iterator();</span><br><span class="line">        Iterator&lt;Integer&gt; it2 = sortedSets.iterator();</span><br><span class="line">        <span class="keyword">if</span> (it2.hasNext()) &#123;</span><br><span class="line">            it2.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> keyPre, keyAfter;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext() &amp;&amp; it2.hasNext()) &#123;</span><br><span class="line">            keyPre = it.next();</span><br><span class="line">            keyAfter = it2.next();</span><br><span class="line">            System.out.println(keyAfter - keyPre);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsistentHashTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConsistentHash&lt;String&gt; consistentHash;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initHash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; nodes = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        consistentHash = <span class="keyword">new</span> ConsistentHash&lt;&gt;(<span class="number">2</span>, nodes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ†é…ä¸‰ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        consistentHash.add(<span class="string">&quot;A1&quot;</span>);</span><br><span class="line">        consistentHash.add(<span class="string">&quot;C1&quot;</span>);</span><br><span class="line">        consistentHash.add(<span class="string">&quot;D1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;hash circle size: &quot;</span> + consistentHash.getSize());</span><br><span class="line">        System.out.println(<span class="string">&quot;location of each node are follows: &quot;</span>);</span><br><span class="line"><span class="comment">//        consistentHash.showBalance();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// hashå€¼åœ¨å½“å‰å“ˆå¸Œç¯å†…</span></span><br><span class="line">        <span class="keyword">final</span> String key1 = <span class="string">&quot;A31&quot;</span>;</span><br><span class="line">        <span class="comment">// hashå€¼è¶…å‡ºäº†å½“å‰å“ˆå¸Œç¯</span></span><br><span class="line">        <span class="keyword">final</span> String key2 = <span class="string">&quot;Apple&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; keys = Arrays.asList(key1, key2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹ŸèŠ‚ç‚¹åˆ†é…</span></span><br><span class="line">        showAllocate(keys);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå¢åŠ èŠ‚ç‚¹, A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„B1èŠ‚ç‚¹</span></span><br><span class="line">        consistentHash.add(<span class="string">&quot;B1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¢åŠ èŠ‚ç‚¹B1&quot;</span>);</span><br><span class="line">        showAllocate(keys);</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿåˆ é™¤èŠ‚ç‚¹, A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„C1èŠ‚ç‚¹</span></span><br><span class="line">        consistentHash.remove(<span class="string">&quot;B1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤èŠ‚ç‚¹B1&quot;</span>);</span><br><span class="line">        showAllocate(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿç¼“å­˜åˆ†é…</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keys ç¼“å­˜é”®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showAllocate</span><span class="params">(List&lt;String&gt; keys)</span> </span>&#123;</span><br><span class="line">        keys.forEach(key -&gt; &#123;</span><br><span class="line">            String node = consistentHash.get(key);</span><br><span class="line">            <span class="comment">// A31è¢«åˆ†é…åˆ°æ›´è¿‘çš„C1èŠ‚ç‚¹</span></span><br><span class="line">            System.out.println(String.format(<span class="string">&quot;key %s is allocated to node %s&quot;</span>, key, node));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hashcode:64032</span><br><span class="line">hashcode:64033</span><br><span class="line">hashcode:65954</span><br><span class="line">hashcode:65955</span><br><span class="line">hashcode:66915</span><br><span class="line">hashcode:66916</span><br><span class="line"><span class="built_in">hash</span> circle size: 6</span><br><span class="line">location of each node are follows: </span><br><span class="line">hashcode-----&gt;:64095</span><br><span class="line">key A31 is allocated to node C1</span><br><span class="line">hashcode-----&gt;:63476538</span><br><span class="line">key Apple is allocated to node A1</span><br><span class="line">hashcode:64993</span><br><span class="line">hashcode:64994</span><br><span class="line">å¢åŠ èŠ‚ç‚¹B1</span><br><span class="line">hashcode-----&gt;:64095</span><br><span class="line">key A31 is allocated to node B1</span><br><span class="line">hashcode-----&gt;:63476538</span><br><span class="line">key Apple is allocated to node A1</span><br><span class="line">-------------------------------------</span><br><span class="line">åˆ é™¤èŠ‚ç‚¹B1</span><br><span class="line">hashcode-----&gt;:64095</span><br><span class="line">key A31 is allocated to node C1</span><br><span class="line">hashcode-----&gt;:63476538</span><br><span class="line">key Apple is allocated to node A1</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œåªä¼šå½±å“åˆ°èŠ‚ç‚¹ä¸ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸€è‡´æ€§Hashç®—æ³•åœ¨å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ä¸Šé¢è¾ƒæ™®é€šHashæ˜¯æœ‰å·¨å¤§æå‡çš„ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://juejin.im/post/5ae1476ef265da0b8d419ef2#heading-4">äº”åˆ†é’Ÿçœ‹æ‡‚ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B8">ç»´åŸºç™¾ç§‘-æ•£åˆ—å‡½æ•°</a></p>
<p><a href="http://blog.codinglabs.org/articles/consistent-hashing.html">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŠå…¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>ä¸€è‡´æ€§Hash</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®—æ³•å¾ˆç¾ï¼ˆè“æ¡¥ï¼‰ | ä½è¿ç®—çš„å¥‡æŠ€æ·«å·§</title>
    <url>/p/60563/</url>
    <content><![CDATA[<h1 id="æˆ‘æœ‰è¯è¯´"><a href="#æˆ‘æœ‰è¯è¯´" class="headerlink" title="æˆ‘æœ‰è¯è¯´"></a>æˆ‘æœ‰è¯è¯´</h1><p>å‰é˜µå­è·‘å»é¢è¯•ï¼Œæœ‰å®¶å…¬å¸æ˜¯åšç”µå•†å¹¿å‘Šæ•°æ®åˆ†æçš„ï¼Œå¾ˆæœ‰æ„æ€ï¼Œä¸Šæ¥å…ˆåšäº†ä¸‰é“ç®—æ³•é¢˜ï¼ˆç­”å¾—ä¸å¥½ï¼‰ï¼Œç„¶åé¢è¯•å®˜èŠ±äº†å¾ˆé•¿æ—¶é—´ä¸ºæˆ‘è§£ç­”äº†ä¸‰é“é¢˜ç›®ï¼Œä¸€åº¦è®©æˆ‘ä»¥ä¸ºå·²ç»æ˜¯è¿™å®¶å…¬å¸çš„å‘˜å·¥äº†ã€‚ä¸´äº†ï¼Œå¾æ±‚äº†ä¸‹é¢è¯•å®˜å¯¹æˆ‘çš„å»ºè®®ï¼Œâ€œä¸æ˜¯ç§‘ç­å‡ºèº«ï¼ˆæˆ‘æœ¬ç§‘å­¦çš„ç‰©ç†ï¼‰ï¼Œè®¡ç®—æœºåŸºç¡€å’Œç®—æ³•æ˜¯åå¼±äº›ï¼Œè¿™ä¸¤å—è¦å¥½å¥½æ‰“ç£¨æ‰“ç£¨ã€‚â€<span id="more"></span></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote>
<p>åœ¨å­¦ä¹ ç®—æ³•å¾ˆç¾è¯¾ç¨‹çš„æ—¶å€™ï¼Œå­¦ä¹ åˆ°äº†ä¸€äº›ä½è¿ç®—çš„å¥‡æŠ€æ·«å·§ï¼Œæ”¶å½•åœ¨æ­¤</p>
</blockquote>
<h2 id="åˆ¤æ–­å¥‡å¶æ•°"><a href="#åˆ¤æ–­å¥‡å¶æ•°" class="headerlink" title="åˆ¤æ–­å¥‡å¶æ•°"></a>åˆ¤æ–­å¥‡å¶æ•°</h2><h3 id="åˆ¤æ–­å¥‡æ•°1-amp-x-1"><a href="#åˆ¤æ–­å¥‡æ•°1-amp-x-1" class="headerlink" title="åˆ¤æ–­å¥‡æ•°1 &amp; x == 1"></a>åˆ¤æ–­å¥‡æ•°<code>1 &amp; x == 1</code></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println((<span class="number">1991</span> &amp; <span class="number">1</span>) == <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­å¶æ•°<code>1 &amp; x == 0</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">System.out.println((1990 &amp; 1) == 0);</span><br></pre></td></tr></table></figure>

<h2 id="è·å–äºŒè¿›åˆ¶æ•°xä½yæ˜¯1è¿˜æ˜¯0"><a href="#è·å–äºŒè¿›åˆ¶æ•°xä½yæ˜¯1è¿˜æ˜¯0" class="headerlink" title="è·å–äºŒè¿›åˆ¶æ•°xä½yæ˜¯1è¿˜æ˜¯0"></a>è·å–äºŒè¿›åˆ¶æ•°xä½yæ˜¯1è¿˜æ˜¯0</h2><blockquote>
<p>å°†xå³ç§»<code>y - 1</code>ä½ï¼Œä¸1</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0b010110010</span>;</span><br><span class="line"><span class="keyword">int</span> y = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> res = (x &gt;&gt; (y - <span class="number">1</span>)) &amp; <span class="number">1</span>;</span><br><span class="line">System.out.println(res);</span><br></pre></td></tr></table></figure>

<h2 id="äº¤æ¢ä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼"><a href="#äº¤æ¢ä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼" class="headerlink" title="äº¤æ¢ä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼"></a>äº¤æ¢ä¸¤ä¸ªæ•´æ•°å˜é‡çš„å€¼</h2><h2 id="ä¸ç”¨åˆ¤æ–­è¯­å¥ï¼Œæ±‚æ•´æ•°çš„ç»å¯¹å€¼"><a href="#ä¸ç”¨åˆ¤æ–­è¯­å¥ï¼Œæ±‚æ•´æ•°çš„ç»å¯¹å€¼" class="headerlink" title="ä¸ç”¨åˆ¤æ–­è¯­å¥ï¼Œæ±‚æ•´æ•°çš„ç»å¯¹å€¼"></a>ä¸ç”¨åˆ¤æ–­è¯­å¥ï¼Œæ±‚æ•´æ•°çš„ç»å¯¹å€¼</h2><blockquote>
<p>å¼‚æˆ–ï¼Œå¯ä»¥ç†è§£ä¸ºä¸è¿›ä½åŠ æ³•ï¼Œ<code>1 + 1 = 0ï¼Œ0 + 0 = 0ï¼Œ1 + 0 = 1</code></p>
</blockquote>
<h3 id="å¼‚æˆ–çš„æ€§è´¨"><a href="#å¼‚æˆ–çš„æ€§è´¨" class="headerlink" title="å¼‚æˆ–çš„æ€§è´¨"></a>å¼‚æˆ–çš„æ€§è´¨</h3><ul>
<li>äº¤æ¢å¾‹ï¼šå¯ä»»æ„äº¤æ¢è¿ç®—å› å­çš„ä½ç½®ï¼Œç»“æœä¸å˜</li>
<li>ç»“åˆå¾‹ï¼šå³<code>ï¼ˆa ^ bï¼‰^ c == a ^ ( b ^ c )</code></li>
<li>å¯¹äºä»»ä½•æ•°xï¼Œéƒ½æœ‰<code>x ^ x = 0, x ^ 0 = x</code>ï¼ŒåŒè‡ªå·±æ±‚å¼‚æˆ–ä¸º0ï¼ŒåŒ0æ±‚å¼‚æˆ–ä¸ºè‡ªå·±</li>
<li>è‡ªåæ€§ï¼š<code>A ^ B ^ B = A ^ 0 = A</code>ï¼Œè¿ç»­å’ŒåŒä¸€ä¸ªå› å­åšå¼‚æˆ–è¿ç®—ï¼Œæœ€ç»ˆç»“æœä¸ºè‡ªå·±</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a = -<span class="number">100</span>;</span><br><span class="line"><span class="comment">// aä¸ºæ­£æ•°ï¼Œa &gt;&gt; 31 = 00000000 00000000 00000000 00000000ï¼Œæ±‚ç»å¯¹å€¼å°±æ˜¯è‡ªå·±</span></span><br><span class="line"><span class="comment">// aä¸ºè´Ÿæ•°ï¼Œa &gt;&gt; 31 = 11111111 11111111 11111111 11111111ï¼Œæ±‚ç»å¯¹å€¼å°±æ˜¯è‡ªå·± * -1ï¼ˆ00000000 00000000 00000000 00000001ï¼‰</span></span><br><span class="line">System.out.println((a + (a &gt;&gt; <span class="number">31</span>) ^ (a &gt;&gt; <span class="number">31</span>)));</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹è¯¾ç¨‹è®²çš„ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä¸‹<a href="https://blog.csdn.net/weixin_37490221/article/details/91044963">ä½è¿ç®—æ±‚æ•´æ•°çš„ç»å¯¹å€¼</a>ï¼Œå†™çš„å¾ˆå¥½ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»</title>
    <url>/p/14256/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œé‡åˆ°ä¾‹å¦‚è´§å¸ï¼Œç»Ÿè®¡ç­‰å•†ä¸šè®¡ç®—çš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦é‡‡ç”¨java.math.BigDecimalç±»æ¥è¿›è¡Œç²¾ç¡®è®¡ç®—ã€‚è€Œè¿™ç±»æ“ä½œé€šå¸¸éƒ½æ˜¯å¯é¢„çŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯é€šç”¨çš„ã€‚æ‰€ä»¥ï¼Œå†™äº†ä¸ªå·¥å…·ç±»æ¥æ–¹ä¾¿ä»¥åçš„å·¥ä½œã€‚<br>è¿™æ˜¯ä»“åº“åœ°å€ï¼š<a href="https://github.com/gcdd1993/Precise-calculation">ä»“åº“åœ°å€</a></p>
<span id="more"></span>
<h1 id="BigDecimalçš„æ„å»º"><a href="#BigDecimalçš„æ„å»º" class="headerlink" title="BigDecimalçš„æ„å»º"></a>BigDecimalçš„æ„å»º</h1><p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä¸»è¦ä»int,long,double,floatæ¥è¿›è¡Œè®¡ç®—ï¼Œåœ¨æ„å»ºçš„æ—¶å€™æ¨èä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">BigDecimal</span><span class="params">(String s)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºé€šè¿‡doubleæ„é€ ä¼šæŸå¤±ç²¾åº¦ï¼Œè€ŒStringæ„é€ æ˜¯å›ºå®šçš„å€¼ã€‚<br>åˆ›å»ºä»¥ä¸‹æ–¹æ³•ä½œä¸ºé€šç”¨BigDecimalè½¬åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Number -&gt; BigDecimal</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Number&gt; <span class="function">BigDecimal <span class="title">transform</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (v <span class="keyword">instanceof</span> Double) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(Double.toString((Double) v));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(Integer.toString((Integer) v));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> Long) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(Long.toString((Long) v));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> Short) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(Short.toString((Short) v));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> Float) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(Float.toString((Float) v));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (BigDecimal) v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="BigDecimalæ–¹æ³•"><a href="#BigDecimalæ–¹æ³•" class="headerlink" title="BigDecimalæ–¹æ³•"></a>BigDecimalæ–¹æ³•</h1><p>è®¡ç®—ç±»å‹åŠ å‡ä¹˜é™¤å››ç§ï¼ŒBigDecimalæä¾›çš„æ–¹æ³•ä¹Ÿæ˜¯å›´ç»•è¿™å››ç§è®¡ç®—ç±»å‹è®¾è®¡çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">BigDecimal <span class="title">add</span><span class="params">(BigDecimal augend)</span> <span class="comment">//åŠ </span></span></span><br><span class="line"><span class="function">BigDecimal <span class="title">subtract</span><span class="params">(BigDecimal subtrahend)</span> <span class="comment">//å‡</span></span></span><br><span class="line"><span class="function">BigDecimal <span class="title">multiply</span><span class="params">(BigDecimal multiplicand)</span> <span class="comment">//ä¹˜</span></span></span><br><span class="line"><span class="function">BigDecimal <span class="title">divide</span><span class="params">(BigDecimal divisor, <span class="keyword">int</span> scale, RoundingMode roundingMode)</span> <span class="comment">//é™¤</span></span></span><br></pre></td></tr></table></figure>
<p>å·¥å…·ç±»åœ¨åŠ å‡ä¹˜é™¤åŸºç¡€ä¸Šï¼Œæä¾›äº†</p>
<ol>
<li>é“¾å¼è®¡ç®—ï¼Œç±»ä¼¼JDK8 lamada apiï¼Œçˆ½å¿«ä¸æ»‘çš„ç¼–ç¨‹ä½“éªŒ</li>
<li>æ”¯æŒé›†åˆæ±‚å’Œã€æ±‚å¹³å‡</li>
<li>æ”¯æŒå¤åˆè®¡ç®—ï¼Œä¾‹å¦‚2*(2+8)</li>
</ol>
<h1 id="BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»å®ç”¨æ¡ˆä¾‹"><a href="#BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»å®ç”¨æ¡ˆä¾‹" class="headerlink" title="BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»å®ç”¨æ¡ˆä¾‹"></a>BigDecimalç²¾ç¡®è®¡ç®—å·¥å…·ç±»å®ç”¨æ¡ˆä¾‹</h1><h2 id="ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼Œä¸æŒ‡å®šç²¾åº¦"><a href="#ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼Œä¸æŒ‡å®šç²¾åº¦" class="headerlink" title="ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼Œä¸æŒ‡å®šç²¾åº¦"></a>ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼Œä¸æŒ‡å®šç²¾åº¦</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(PreciseCalculations.transform(<span class="number">121.11</span>)); <span class="comment">//è½¬åŒ–double -&gt; 121.11</span></span><br><span class="line">System.out.println(PreciseCalculations.transform(Integer.MAX_VALUE)); <span class="comment">//è½¬åŒ–int -&gt; 2147483647</span></span><br><span class="line">System.out.println(PreciseCalculations.transform(Short.MAX_VALUE)); <span class="comment">//è½¬åŒ–Short -&gt; 32767</span></span><br><span class="line">System.out.println(PreciseCalculations.transform(Long.MAX_VALUE)); <span class="comment">//è½¬åŒ–long -&gt; 9223372036854775807</span></span><br><span class="line">System.out.println(PreciseCalculations.transform(<span class="number">121.19F</span>)); <span class="comment">//è½¬åŒ–float -&gt; 121.19</span></span><br></pre></td></tr></table></figure>
<h2 id="ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼ŒæŒ‡å®šç²¾åº¦"><a href="#ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼ŒæŒ‡å®šç²¾åº¦" class="headerlink" title="ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼ŒæŒ‡å®šç²¾åº¦"></a>ç²¾ç¡®è½¬æ¢ä¸ºBigDecimalï¼ŒæŒ‡å®šç²¾åº¦</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(PreciseCalculations.transform(<span class="number">121.1111111111</span>, <span class="number">5</span>)); <span class="comment">//ç²¾åº¦å¤§äºæŒ‡å®šç²¾åº¦ -&gt; 121.11111</span></span><br><span class="line">System.out.println(PreciseCalculations.transform(<span class="number">121.11</span>, <span class="number">5</span>)); <span class="comment">//ç²¾åº¦å°äºæŒ‡å®šç²¾åº¦ï¼Œè¡¥é›¶ -&gt; 121.11000</span></span><br></pre></td></tr></table></figure>
<h2 id="åŠ å‡ä¹˜é™¤"><a href="#åŠ å‡ä¹˜é™¤" class="headerlink" title="åŠ å‡ä¹˜é™¤"></a>åŠ å‡ä¹˜é™¤</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(PreciseCalculations.add(<span class="number">12.11</span>, <span class="number">12.11</span>)); <span class="comment">//åŠ æ³• -&gt; 24.22</span></span><br><span class="line">System.out.println(PreciseCalculations.subtract(<span class="number">12.11</span>, <span class="number">12.11</span>)); <span class="comment">//å‡æ³• -&gt; 0.00</span></span><br><span class="line">System.out.println(PreciseCalculations.multiply(<span class="number">12.11</span>, <span class="number">12.11</span>)); <span class="comment">//ä¹˜æ³• -&gt; 146.6521</span></span><br><span class="line">System.out.println(PreciseCalculations.divide(<span class="number">12.11</span>, <span class="number">2.35</span>, <span class="number">5</span>)); <span class="comment">//é™¤æ³• -&gt; 5.15319</span></span><br></pre></td></tr></table></figure>
<h2 id="è´Ÿæ•°è®¡ç®—"><a href="#è´Ÿæ•°è®¡ç®—" class="headerlink" title="è´Ÿæ•°è®¡ç®—"></a>è´Ÿæ•°è®¡ç®—</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// -1.11 * 13 - 90 = -104.43</span></span><br><span class="line">System.out.println(<span class="keyword">new</span> PreciseCalculation(-<span class="number">1.11</span>).multiply(<span class="number">13</span>).add(-<span class="number">90</span>).getValue()); </span><br><span class="line"><span class="comment">// -11.11111111 + 90 = 78.88888889</span></span><br><span class="line">System.out.println(PreciseCalculations.add(-<span class="number">11.11111111</span>,<span class="number">90</span>));</span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆ-æ±‚å’Œ-æ±‚å¹³å‡å€¼"><a href="#é›†åˆ-æ±‚å’Œ-æ±‚å¹³å‡å€¼" class="headerlink" title="é›†åˆ æ±‚å’Œ æ±‚å¹³å‡å€¼"></a>é›†åˆ æ±‚å’Œ æ±‚å¹³å‡å€¼</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Double&gt; list = Arrays.asList(<span class="number">12.11D</span>, <span class="number">13.11D</span>, <span class="number">14.11D</span>, <span class="number">15.321312D</span>);</span><br><span class="line">System.out.println(PreciseCalculations.sum(list)); <span class="comment">//æ±‚å’Œ -&gt; Optional[54.651312]</span></span><br><span class="line">System.out.println(PreciseCalculations.average(list)); <span class="comment">//å¹³å‡å€¼ -&gt; Optional[13.66283]</span></span><br><span class="line">System.out.println(PreciseCalculations.average(Collections.emptyList())); <span class="comment">//ç©ºé›†åˆ -&gt; Optional.empty</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤åˆè®¡ç®—"><a href="#å¤åˆè®¡ç®—" class="headerlink" title="å¤åˆè®¡ç®—"></a>å¤åˆè®¡ç®—</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®— 121.11 * 13 / 60 + 100 - 12 = 114.24050</span></span><br><span class="line">System.out.println(<span class="keyword">new</span> PreciseCalculation(<span class="number">121.11</span>).multiply(<span class="number">13</span>).divide(<span class="number">60</span>, <span class="number">5</span>).add(<span class="number">100</span>).subtract(<span class="number">12</span>).getValue());</span><br><span class="line"><span class="comment">//è®¡ç®— 121.11 * 128.59 / (100 + 12) - 100 = 39.04942</span></span><br><span class="line">System.out.println(<span class="keyword">new</span> PreciseCalculation(<span class="number">121.11</span>).multiply(<span class="number">128.59</span>).divide(</span><br><span class="line">       <span class="keyword">new</span> PreciseCalculation(<span class="number">100</span>).add(<span class="number">12</span>), <span class="number">5</span>).subtract(<span class="number">100</span>).getValue());</span><br></pre></td></tr></table></figure>
<h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul>
<li>PreciseCalculation æ ¸å¿ƒç±»ï¼Œæä¾›åŠ å‡ä¹˜é™¤ã€é›†åˆç²¾ç¡®è®¡ç®—æ–¹æ³•ï¼Œå†…éƒ¨ç»´æŠ¤valueå€¼ï¼Œæ¯æ¬¡è®¡ç®—è¯¥valueéƒ½ä¼šæ”¹å˜ã€‚</li>
<li>PreciseCalculations åŸºäºä¸Šè¿°çš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿ç®€å•è®¡ç®—æ—¶ä½¿ç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³Spring Securityè‡ªå®šä¹‰filteré‡å¤æ‰§è¡Œé—®é¢˜</title>
    <url>/p/356/</url>
    <content><![CDATA[<p>ä»Šå¤©åšé¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°æ¯æ¬¡æ‹¦æˆªå™¨æ—¥å¿—éƒ½ä¼šæ‰“ä¸¤éï¼Œå¾ˆçº³é—·ï¼Œæ€€ç–‘æ˜¯Filterè¢«æ‰§è¡Œäº†ä¸¤éã€‚ç»“æœdebugä¹‹åå‘ç°è¿˜çœŸæ˜¯ï¼è®°å½•ä¸€ä¸‹è¿™ä¸ªç¥å¥‡çš„BUGï¼<span id="more"></span></p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯Spring-securityä½œä¸ºæƒé™æ¡†æ¶ï¼Œç„¶ååšäº†ä¸€ä¸ª<code>JwtAuthenticationTokenFilter</code>ä½œä¸ºæ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚ï¼Œæ ¡éªŒTokenï¼Œä½†æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰“ä¸¤éæ—¥å¿—ã€‚ä¸‹é¢æ˜¯ç²¾ç®€çš„æºä»£ç :</p>
<p>è‡ªå®šä¹‰çš„Filterç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">            HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">            FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//...çœç•¥</span></span><br><span class="line">        <span class="comment">//æ‰“å‡ºä¸¤éæ—¥å¿—çš„åœ°æ–¹</span></span><br><span class="line">        log.info(<span class="string">&quot;User:&#123;&#125; request path:&#123;&#125;, method:&#123;&#125;, param:&#123;&#125;&quot;</span>, username, request.getServletPath(),</span><br><span class="line">                request.getMethod(), request.getParameterMap() == <span class="keyword">null</span> ? <span class="keyword">null</span> : OBJECT_MAPPER.writeValueAsString(request.getParameterMap()));</span><br><span class="line">        <span class="comment">//...çœç•¥</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebSecurityConfigé…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...çœç•¥</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtAuthenticationTokenFilter <span class="title">authenticationTokenFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtAuthenticationTokenFilter();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//...çœç•¥</span></span><br><span class="line">        <span class="comment">//æŠŠJwtAuthenticationTokenFilteråŠ å…¥åˆ°RememberMeAuthenticationFilterä¹‹å‰</span></span><br><span class="line">        httpSecurity.addFilterBefore(authenticationTokenFilterBean(), RememberMeAuthenticationFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚æ—¥å¿—å¦‚ä¸‹:</p>
<p><img data-src="https://i.loli.net/2019/01/14/5c3c75bd6e40b.png"></p>
<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>æŠŠè‡ªå®šä¹‰Filter<code>JwtAuthenticationTokenFilter</code>çš„<code>@Component</code>å–æ¶ˆæ‰å°±å¯ä»¥äº†ï¼Œä¸è®©å®ƒè¢«Springå®¹å™¨ç®¡ç†ã€‚</p>
<h1 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h1><p>åœ¨springå®¹å™¨æ‰˜ç®¡çš„OncePerRequestFilterçš„beanï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ å…¥åˆ°servletçš„filter chainï¼Œè€Œä¸Šé¢çš„å®šä¹‰ï¼Œè¿˜é¢å¤–æŠŠfilteråŠ å…¥åˆ°äº†spring securityçš„<br>ememberMeAuthenticationFilterä¹‹å‰ã€‚è€Œspring securityä¹Ÿæ˜¯ä¸€ç³»åˆ—çš„filterï¼Œåœ¨mvcçš„filterä¹‹å‰æ‰§è¡Œã€‚å› æ­¤åœ¨é‰´æƒé€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå…ˆåå„æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://segmentfault.com/a/1190000012173419">è§£å†³spring securityè‡ªå®šä¹‰filteré‡å¤æ‰§è¡Œé—®é¢˜</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring-Security</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç”Ÿäº§äº‹æ•…--ç£ç›˜è¢«å æ»¡</title>
    <url>/p/58700/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>ä»Šå¤©ï¼Œè·‘åœ¨é˜¿é‡Œäº‘ECSä¸Šçš„ç”Ÿäº§ç¯å¢ƒï¼Œçªç„¶é—´è®¿é—®å¼‚å¸¸ï¼Œæ¥å£å„ç§æŠ¥é”™ï¼Œæ— å¥ˆå…¬å¸æ²¡æœ‰ä¸“ä¸šçš„è¿ç»´äººå‘˜ï¼Œåªèƒ½ç¡¬ç€å¤´çš®è§£å†³ä¸€ä¸‹ã€‚<span id="more"></span></p>
<h1 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h1><p>å…ˆä»è¡¨é¢çœ‹èµ·ï¼Œæ•°æ®åº“é¦–å…ˆæŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Caused by: org.postgresql.util.PSQLException: ERROR: could not extend file &quot;base/16385/16587_fsm&quot;: No space left on device</span><br><span class="line">  å»ºè®®ï¼šCheck free disk space.</span><br></pre></td></tr></table></figure>

<p>ç›´è§‚ä¸Šçœ‹ï¼Œè®¾å¤‡æ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜æ»¡äº†ã€‚</p>
<p>è¿›å…¥æœåŠ¡å™¨åå°ï¼Œæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                  7.9G     0  7.9G   0% /dev</span><br><span class="line">tmpfs                 1.6G  3.5M  1.6G   1% /run</span><br><span class="line">/dev/vda1              59G   56G     0 100% /</span><br><span class="line">tmpfs                 7.9G  4.0K  7.9G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M  4.0K  5.0M   1% /run/lock</span><br><span class="line">tmpfs                 7.9G     0  7.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/vg0-vol0 1000G   14G  937G   2% /data</span><br><span class="line">tmpfs                 1.6G     0  1.6G   0% /run/user/0</span><br></pre></td></tr></table></figure>

<p>å‘ç°ç¡®å®ç£ç›˜æ»¡äº†ï¼Œè€Œä¸”æ»¡çš„å¾ˆå½»åº•ã€‚ç³»ç»Ÿç›˜å ç”¨100%ï¼Œä¼°è®¡ä»€ä¹ˆæœåŠ¡éƒ½è·‘ä¸åŠ¨äº†ã€‚<code>/dev/vda1              59G   56G     0 100% /</code></p>
<p>ä¸è¿‡å‘ç°<code>/dev/mapper/vg0-vol0 1000G   14G  937G   2% /data</code>ï¼Œ1000Gåªç”¨äº†2%</p>
<blockquote>
<p>é˜¿é‡Œäº‘ECSåˆ†ä¸ºç³»ç»Ÿç›˜å’Œæ•°æ®ç›˜ï¼Œ1000Gçš„æ˜¯æ•°æ®ç›˜</p>
</blockquote>
<p>ç¬¬ä¸€ååº”ï¼Œåº”è¯¥æ˜¯æ­å»ºçš„PGæ•°æ®åº“çš„æ•°æ®æ²¡æœ‰ç§»åˆ°æ•°æ®ç›˜ä¸Šã€‚</p>
<h2 id="å°†Postgresæ•°æ®åº“æ•°æ®ç›®å½•ç§»åŠ¨åˆ°ç³»ç»Ÿç›˜"><a href="#å°†Postgresæ•°æ®åº“æ•°æ®ç›®å½•ç§»åŠ¨åˆ°ç³»ç»Ÿç›˜" class="headerlink" title="å°†Postgresæ•°æ®åº“æ•°æ®ç›®å½•ç§»åŠ¨åˆ°ç³»ç»Ÿç›˜"></a>å°†Postgresæ•°æ®åº“æ•°æ®ç›®å½•ç§»åŠ¨åˆ°ç³»ç»Ÿç›˜</h2><blockquote>
<p>å‚è€ƒ<a href="https://www.digitalocean.com/community/tutorials/how-to-move-a-postgresql-data-directory-to-a-new-location-on-ubuntu-16-04">å¦‚ä½•å°†PostgreSQLæ•°æ®ç›®å½•ç§»åŠ¨åˆ°Ubuntu 16.04ä¸Šçš„æ–°ä½ç½®</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -u postgres psql</span><br><span class="line">postgres<span class="comment"># SHOW data_directory; # æŸ¥çœ‹å½“å‰æ•°æ®ç›®å½•</span></span><br><span class="line">        data_directory        </span><br><span class="line">------------------------------</span><br><span class="line"> /var/lib/postgresql/9.5/main</span><br><span class="line">(1 row)</span><br><span class="line">postgres<span class="comment"># \q; # é€€å‡º</span></span><br><span class="line"><span class="comment"># ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬å°†åœ¨å®é™…æ›´æ”¹æ•°æ®ç›®å½•ä¹‹å‰å…³é—­PostgreSQL</span></span><br><span class="line">$ sudo systemctl stop postgresql</span><br><span class="line"><span class="comment"># ç¡®ä¿å…³é—­å®Œæˆ</span></span><br><span class="line">$ sudo systemctl status postgresql</span><br><span class="line">. . .</span><br><span class="line">Jul 22 16:22:44 ubuntu-512mb-nyc1-01 systemd[1]: Stopped PostgreSQL RDBMS.</span><br><span class="line">$ sudo rsync -av /var/lib/postgresql /data <span class="comment"># /dataä¸ºè¦è¿ç§»åˆ°çš„æ–°ç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> /data</span><br><span class="line">$ ls</span><br><span class="line">... postgresql</span><br><span class="line"><span class="comment"># åˆ é™¤åŸæ•°æ®ç›®å½•</span></span><br><span class="line">$ sudo rm -rf /var/lib/postgresql</span><br><span class="line"><span class="comment"># å°†æ–°æ•°æ®ç›®å½•é“¾æ¥åˆ°åŸæ•°æ®ç›®å½•</span></span><br><span class="line">$ sudo ln -s /data/postgresql /var/lib/postgresql</span><br><span class="line"><span class="comment"># é‡å¯Postgresæ•°æ®åº“</span></span><br><span class="line">$ sudo systemctl start postgresql</span><br><span class="line">$ sudo systemctl status postgresql</span><br></pre></td></tr></table></figure>

<p>å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œå³å°†postgreæ•°æ®åº“æ•°æ®ç›®å½•ç§»åˆ°äº†é˜¿é‡Œäº‘æ•°æ®ç›˜</p>
<p>ä»¥ä¸ºOKäº†ï¼Œæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                  7.9G     0  7.9G   0% /dev</span><br><span class="line">tmpfs                 1.6G  3.5M  1.6G   1% /run</span><br><span class="line">/dev/vda1              59G   56G   51M 100% /</span><br><span class="line">tmpfs                 7.9G  4.0K  7.9G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M  4.0K  5.0M   1% /run/lock</span><br><span class="line">tmpfs                 7.9G     0  7.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/vg0-vol0 1000G   14G  937G   2% /data</span><br><span class="line">tmpfs                 1.6G     0  1.6G   0% /run/user/0</span><br></pre></td></tr></table></figure>

<p>çº¹ä¸æœªåŠ¨ã€‚ã€‚ã€‚</p>
<h2 id="UbuntuæŸ¥è¯¢å¤§æ–‡ä»¶"><a href="#UbuntuæŸ¥è¯¢å¤§æ–‡ä»¶" class="headerlink" title="UbuntuæŸ¥è¯¢å¤§æ–‡ä»¶"></a>UbuntuæŸ¥è¯¢å¤§æ–‡ä»¶</h2><p>çŒœæµ‹æ˜¯å­˜åœ¨å¤§æ–‡ä»¶å¯¼è‡´ç£ç›˜è¢«å æ»¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /</span><br><span class="line">$ find . -<span class="built_in">type</span> f -size +800M  -print0 | xargs -0 du -h</span><br><span class="line">5.6G ./var/<span class="built_in">log</span>/syslog.1</span><br><span class="line">6.7G ./var/<span class="built_in">log</span>/syslog</span><br><span class="line">...</span><br><span class="line">$ rm ...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‘ç°æ˜¯logå­—çœ¼çš„å¤§æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¯«ä¸ç•™æƒ…çš„åˆ æ‰ï¼Œè¦æ˜¯é‡è§ä¸€äº›ä¸è®¤è¯†çš„ï¼Œä¸è¦è´¸ç„¶åˆ æ‰ï¼Œä¸€å®šè¦æŸ¥æ¸…æ¥šæ–‡ä»¶çš„ä½œç”¨ï¼Œèƒ½åˆ åˆ™åˆ ï¼Œåƒä¸‡ä¸è¦ä¸å°å¿ƒåˆ åº“è·‘è·¯ã€‚ã€‚ã€‚</p>
<p>åˆ é™¤å®Œæ¯•åï¼Œå†æ¬¡æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                  7.9G     0  7.9G   0% /dev</span><br><span class="line">tmpfs                 1.6G  3.4M  1.6G   1% /run</span><br><span class="line">/dev/vda1              59G   45G   12G  80% /</span><br><span class="line">tmpfs                 7.9G  4.0K  7.9G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M  4.0K  5.0M   1% /run/lock</span><br><span class="line">tmpfs                 7.9G     0  7.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/vg0-vol0 1000G   14G  936G   2% /data</span><br><span class="line">tmpfs                 1.6G     0  1.6G   0% /run/user/0</span><br></pre></td></tr></table></figure>

<p>å¤šå‡ºäº†12Gã€‚</p>
<h2 id="æŸ¥çœ‹å·²åˆ é™¤ç©ºé—´å´æ²¡æœ‰é‡Šæ”¾çš„è¿›ç¨‹"><a href="#æŸ¥çœ‹å·²åˆ é™¤ç©ºé—´å´æ²¡æœ‰é‡Šæ”¾çš„è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹å·²åˆ é™¤ç©ºé—´å´æ²¡æœ‰é‡Šæ”¾çš„è¿›ç¨‹"></a>æŸ¥çœ‹å·²åˆ é™¤ç©ºé—´å´æ²¡æœ‰é‡Šæ”¾çš„è¿›ç¨‹</h2><p>è¿™æ—¶å€™ï¼ŒæœåŠ¡åº”è¯¥å¯ä»¥æ¢å¤æˆåŠŸã€‚ä½†ä½ é©¬ä¸Šä¼šå‘ç°ï¼Œç£ç›˜åˆè¢«å æ»¡ï¼Œè€Œè¿™æ¬¡ï¼Œæ—¥å¿—æ–‡ä»¶å´ä¸ç®—å¤§ã€‚</p>
<p>æŸ¥çœ‹å·²ç»åˆ é™¤çš„æ–‡ä»¶ï¼Œç©ºé—´æœ‰æ²¡æœ‰é‡Šæ”¾ï¼Œæ²¡æœ‰çš„è¯killæ‰pid</p>
<blockquote>
<p>ä½¿ç”¨rmåˆ é™¤æ–‡ä»¶çš„æ—¶å€™ï¼Œè™½ç„¶æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œç©ºé—´å´æ²¡æœ‰é‡Šæ”¾</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo lsof -n |grep deleted</span><br><span class="line">java      17866                  root  237r      REG              253,1    163541    1709285 /tmp/tomcat.8250394289784312179.8080/work/Tomcat/localhost/ROOT/upload_c6db0c17_6e6a_4141_bfb6_ac1b2d8a3b0b_00000000.tmp (deleted)</span><br><span class="line">...</span><br><span class="line">$ sudo <span class="built_in">kill</span> -9 17866</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡ä½¿ç”¨<code>df -h</code>å‘½ä»¤ï¼Œç£ç›˜ä½¿ç”¨ç‡ä¸€ä¸‹å­å‡å°‘äº†å¥½å¤šã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li><p>æœåŠ¡å™¨ç³»ç»Ÿç›˜è¢«å æ»¡æ˜¯éå¸¸å¯æ€•çš„ï¼å±Šæ—¶ï¼Œä¸€åˆ‡æœåŠ¡éƒ½å°†å˜å¾—ä¸å¯ç”¨ï¼Œä¸šåŠ¡ç³»ç»Ÿä¹Ÿä¼šè«åå…¶å¦™å¤šå‡ºå¥‡æ€ªçš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œè¿ç»´éœ€è¦ç»å¸¸æ€§çš„æŸ¥çœ‹æœåŠ¡å™¨ç£ç›˜å ç”¨æƒ…å†µï¼Œé˜¿é‡Œäº‘ECSç”¨æˆ·ï¼Œå¯ä»¥å¼€å¯æŠ¥è­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ï¼Œè§£å†³é—®é¢˜ï¼</p>
</li>
<li><p>é˜¿é‡Œäº‘ECSæä¾›äº†ç³»ç»Ÿç›˜å’Œæ•°æ®ç›˜ï¼Œè®°ä½ï¼Œä¾‹å¦‚Pgã€Redisã€Cassandraç­‰å®¹æ˜“å ç£ç›˜çš„æœåŠ¡ï¼Œä¸€å®šè¦å°†æ•°æ®ç›®å½•æ”¾åœ¨é˜¿é‡Œäº‘ECSæä¾›çš„æ•°æ®ç›˜ä¸Šã€‚</p>
</li>
<li><p><code>/var/log</code>æ˜¯ç³»ç»Ÿæ—¥å¿—ç›®å½•ï¼Œå¯ä»¥ç»å¸¸æ€§çš„å…³æ³¨ä¸‹ï¼Œå¤§å®¹é‡æ—¥å¿—å°½æ—©åˆ é™¤ã€‚</p>
</li>
<li><p>å¯¹å¾…è¿›ç¨‹ä¸åœå¯¹æ–‡ä»¶å†™æ—¥å¿—çš„æ“ä½œï¼Œè¦é‡Šæ”¾æ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çº¿æ¸…ç©ºè¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®Œæˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;&quot; &gt;/var/log/syslog</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p> é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œç£ç›˜ç©ºé—´ä¸ä½†å¯ä»¥é©¬ä¸Šé‡Šæ”¾ï¼Œä¹Ÿå¯ä¿éšœè¿›ç¨‹ç»§ç»­å‘æ–‡ä»¶å†™å…¥æ—¥å¿—ï¼Œè¿™ç§æ–¹æ³•ç»å¸¸ç”¨äºåœ¨çº¿æ¸…ç†Apacheã€Tomcatã€Nginxç­‰WebæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
</blockquote>
<p><strong>æœ€åï¼Œæœ‰ä¸€ä¸ªä¸“ä¸šçš„è¿ç»´æ˜¯å¤šä¹ˆé‡è¦ï¼</strong></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>è¿ç»´</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡Postgres CPUçˆ†æ»¡æ•…éšœ</title>
    <url>/p/7877/</url>
    <content><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>å…¬å¸é¡¹ç›®æµ‹è¯•ç¯å¢ƒè°ƒç”¨æŸäº›æ¥å£çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«‹å³å´©æºƒï¼Œå¹¶ä¸€å®šæ—¶é—´å†…æ— æ³•æä¾›æœåŠ¡ã€‚<span id="more"></span></p>
<h1 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h1><h2 id="æœåŠ¡å™¨é…ç½®ä¸å¤Ÿ"><a href="#æœåŠ¡å™¨é…ç½®ä¸å¤Ÿ" class="headerlink" title="æœåŠ¡å™¨é…ç½®ä¸å¤Ÿ"></a>æœåŠ¡å™¨é…ç½®ä¸å¤Ÿ</h2><p>ç¬¬ä¸€ååº”æ˜¯æœåŠ¡å™¨éœ€è¦å‡é…å•¦ï¼ŒèŠ±é’±è§£å†³ä¸€åˆ‡ï¼æ¯•ç«Ÿæµ‹è¯•æœåŠ¡å™¨é…ç½®ç¡®å®ä¸é«˜ï¼Œ2CPU + 4Gibï¼Œèƒ½å¹²å•¥ï¼Ÿä¸è¿‡é—®é¢˜æ˜¯ä»Šå¤©çªç„¶å‘ç”Ÿçš„ï¼Œè€Œä¸”è¯´å´©å°±å´©ã€‚å‡­ç€ä¸¥è°¨çš„æ€åº¦ï¼Œè¿˜æ˜¯è¦åˆ¨æ ¹é—®åº•åœ°æ‰¾ä¸‹é—®é¢˜ã€‚</p>
<h2 id="æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½"><a href="#æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½" class="headerlink" title="æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½"></a>æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½</h2><ul>
<li><code>free -m</code></li>
</ul>
<p>å†…å­˜å ç”¨å¹¶ä¸å¤§ï¼Œå¿˜è®°æˆªå›¾äº†ï¼Œåæ­£çœ‹ä¸‹æ¥ä¸æ˜¯å†…å­˜è¿‡é«˜å¯¼è‡´çš„å´©æºƒ</p>
<ul>
<li><code>top</code></li>
</ul>
<p><img data-src="https://i.loli.net/2019/05/10/5cd50e714a69f.png"></p>
<h2 id="æ•°æ®åº“å ç”¨CPUè¿‡é«˜"><a href="#æ•°æ®åº“å ç”¨CPUè¿‡é«˜" class="headerlink" title="æ•°æ®åº“å ç”¨CPUè¿‡é«˜"></a>æ•°æ®åº“å ç”¨CPUè¿‡é«˜</h2><h3 id="è¿æ¥æ•°è¿‡å¤š"><a href="#è¿æ¥æ•°è¿‡å¤š" class="headerlink" title="è¿æ¥æ•°è¿‡å¤š"></a>è¿æ¥æ•°è¿‡å¤š</h3><blockquote>
<p>ä¸šåŠ¡é«˜å³°æ´»è·ƒè¿æ¥é™¡å¢ï¼Œæ´»è·ƒçš„è¿æ¥æ•°æ˜¯å¦æ¯”å¹³æ—¶å¤šå¾ˆå¤š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT </span><br><span class="line">  COUNT(*) </span><br><span class="line">FROM </span><br><span class="line">  pg_stat_activity </span><br><span class="line">WHERE </span><br><span class="line">  STATE NOT LIKE &#x27;%idle&#x27;;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ä¸‹æ¥åªæœ‰3ä¸ªè¿æ¥ï¼Œæ‰€ä»¥ä¸æ˜¯è¿æ¥æ•°å¯¼è‡´çš„CPUè¿‡é«˜</p>
<h3 id="æ…¢SQL"><a href="#æ…¢SQL" class="headerlink" title="æ…¢SQL"></a>æ…¢SQL</h3><blockquote>
<p>å¦‚æœæ´»è·ƒè¿æ¥æ•°çš„å˜åŒ–å¤„äºæ­£å¸¸èŒƒå›´ï¼Œåˆ™å¯èƒ½æ˜¯å½“æ—¶æœ‰æ€§èƒ½å¾ˆå·®çš„SQLè¢«å¤§é‡æ‰§è¡Œã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select </span><br><span class="line">  datname, </span><br><span class="line">  usename, </span><br><span class="line">  client_addr, </span><br><span class="line">  application_name, </span><br><span class="line">  state, </span><br><span class="line">  backend_start, </span><br><span class="line">  xact_start, </span><br><span class="line">  xact_stay, </span><br><span class="line">  query_start, </span><br><span class="line">  query_stay, </span><br><span class="line">  replace(</span><br><span class="line">    query, </span><br><span class="line">    chr(10), </span><br><span class="line">    &#x27; &#x27;</span><br><span class="line">  ) as query </span><br><span class="line">from </span><br><span class="line">  (</span><br><span class="line">    select </span><br><span class="line">      pgsa.datname as datname, </span><br><span class="line">      pgsa.usename as usename, </span><br><span class="line">      pgsa.client_addr client_addr, </span><br><span class="line">      pgsa.application_name as application_name, </span><br><span class="line">      pgsa.state as state, </span><br><span class="line">      pgsa.backend_start as backend_start, </span><br><span class="line">      pgsa.xact_start as xact_start, </span><br><span class="line">      extract(</span><br><span class="line">        epoch </span><br><span class="line">        from </span><br><span class="line">          (now() - pgsa.xact_start)</span><br><span class="line">      ) as xact_stay, </span><br><span class="line">      pgsa.query_start as query_start, </span><br><span class="line">      extract(</span><br><span class="line">        epoch </span><br><span class="line">        from </span><br><span class="line">          (now() - pgsa.query_start)</span><br><span class="line">      ) as query_stay, </span><br><span class="line">      pgsa.query as query </span><br><span class="line">    from </span><br><span class="line">      pg_stat_activity as pgsa </span><br><span class="line">    where </span><br><span class="line">      pgsa.state != &#x27;idle&#x27; </span><br><span class="line">      and pgsa.state != &#x27;idle in transaction&#x27; </span><br><span class="line">      and pgsa.state != &#x27;idle in transaction (aborted)&#x27;</span><br><span class="line">  ) idleconnections </span><br><span class="line">order by </span><br><span class="line">  query_stay desc </span><br><span class="line">limit </span><br><span class="line">  5;</span><br></pre></td></tr></table></figure>

<p><img data-src="https://i.loli.net/2019/05/10/5cd513b65c46f.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®æœ‰ä¸€æ¡æ…¢SQLï¼Œè€Œä¸”å±äºå¥‡æ…¢æ— æ¯”ï¼Œæ‰§è¡Œäº†æ¥è¿‘1åˆ†é’Ÿè¿˜æ²¡æ‰§è¡Œå®Œæ¯•ï¼ŒåŸºæœ¬å¯ä»¥å®šä½ï¼Œæ˜¯æ…¢SQLå¯¼è‡´çš„CPUå ç”¨é™¡å¢ã€‚</p>
<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>å¯¹äºä¸Šé¢çš„æ–¹æ³•æŸ¥å‡ºæ¥çš„æ…¢SQLï¼Œé¦–å…ˆéœ€è¦åšçš„æ˜¯Killæ‰ä»–ä»¬ï¼Œä½¿ä¸šåŠ¡å…ˆæ¢å¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select pg_cancel_backend(pid) from pg_stat_activity where  query like &#x27;%&lt;query text&gt;%&#x27; and pid != pg_backend_pid();</span><br><span class="line">select pg_terminate_backend(pid) from pg_stat_activity where  query like &#x27;%&lt;query text&gt;%&#x27; and pid != pg_backend_pid();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿™äº›SQLç¡®å®æ˜¯ä¸šåŠ¡ä¸Šå¿…éœ€çš„ï¼Œåˆ™éœ€è¦å¯¹ä»–ä»¬åšå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<ol>
<li>å¯¹æŸ¥è¯¢æ¶‰åŠçš„è¡¨ï¼Œæ‰§è¡Œ<code>ANALYZE &lt;table&gt;</code>æˆ–<code>VACUUM ANZLYZE &lt;table&gt;</code>ï¼Œæ›´æ–°è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿æŸ¥è¯¢è®¡åˆ’æ›´å‡†ç¡®ã€‚ä¸ºé¿å…å¯¹ä¸šåŠ¡å½±å“ï¼Œæœ€å¥½åœ¨ä¸šåŠ¡ä½å³°æ‰§è¡Œã€‚</li>
<li>æ‰§è¡Œ<code>explain &lt;query text&gt;</code>æˆ–<code>explain (buffers true, analyze true, verbose true) &lt;query text&gt;</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹SQLçš„æ‰§è¡Œè®¡åˆ’ï¼ˆå‰è€…ä¸ä¼šå®é™…æ‰§è¡ŒSQLï¼Œåè€…ä¼šå®é™…æ‰§è¡Œè€Œä¸”èƒ½å¾—åˆ°è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯ï¼‰ï¼Œå¯¹å…¶ä¸­çš„Table Scanæ¶‰åŠçš„è¡¨ï¼Œå»ºç«‹ç´¢å¼•ã€‚</li>
<li>é‡æ–°ç¼–å†™SQLï¼Œå»é™¤æ‰ä¸å¿…è¦çš„å­æŸ¥è¯¢ã€æ”¹å†™UNION ALLã€ä½¿ç”¨JOIN CLAUSEå›ºå®šè¿æ¥é¡ºåºç­‰ï¼Œéƒ½æ˜¯è¿›ä¸€æ­¥æ·±åº¦ä¼˜åŒ–SQLçš„æ‰‹æ®µï¼Œè¿™é‡Œä¸å†æ·±å…¥è¯´æ˜ã€‚</li>
</ol>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå°½é‡å‡å°‘ä¸å¿…è¦çš„å­æŸ¥è¯¢ï¼Œå…¬å¸ä½¿ç”¨çš„ORMæ¡†æ¶æ˜¯Spring JPAï¼Œé’ˆå¯¹ä¸€äº›ç‰¹åˆ«æ…¢çš„HQLï¼Œå¯ä»¥é‡‡ç”¨ç›´æ¥æ‰§è¡ŒSQLçš„æ–¹å¼æ¥ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(value = &quot;select count(*) from example_table where example_id = :exampleId&quot;, nativeQuery = true)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">exampleNativeQuery</span><span class="params">(<span class="meta">@Param(&quot;exampleId&quot;)</span> Long exampleId)</span></span>;</span><br></pre></td></tr></table></figure>

<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://help.aliyun.com/knowledge_detail/43562.html">PostgreSQL/PPAS CPUä½¿ç”¨ç‡é«˜çš„åŸå› åŠè§£å†³åŠæ³•</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘çŸ­ä¿¡å¼€ç®±å³ç”¨</title>
    <url>/p/28056/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>ä½¿ç”¨<code>SpringBoot</code>è‡ªåŠ¨è£…é…ç®€åŒ–å¯¹æ¥é˜¿é‡Œäº‘çŸ­ä¿¡è¿‡ç¨‹ã€‚</p>
</blockquote>
<p><strong>å°å·¥å…·ä¸€æšï¼Œæ¬¢è¿ä½¿ç”¨å’ŒStaræ”¯æŒï¼Œå¦‚ä½¿ç”¨è¿‡ç¨‹ä¸­ç¢°åˆ°é—®é¢˜ï¼Œå¯ä»¥æå‡ºIssueï¼Œæˆ‘ä¼šå°½åŠ›å®Œå–„è¯¥Starterã€‚</strong></p>
<span id="more"></span>

<h1 id="ç‰ˆæœ¬åŸºç¡€"><a href="#ç‰ˆæœ¬åŸºç¡€" class="headerlink" title="ç‰ˆæœ¬åŸºç¡€"></a>ç‰ˆæœ¬åŸºç¡€</h1><p><code>aliyun-java-sdk-core:4.1.0</code></p>
<h1 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h1><h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.gcdd1993<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ali-sms-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h2><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">compile <span class="string">&#x27;io.github.gcdd1993:ali-sms-spring-boot-starter:1.0.0.RELEASE&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ‘‰æ³¨æ„ï¼šéœ€è¦å¼•å…¥<code>Jcenter</code>ä»“åº“</p>
<h2 id="å‚æ•°é…ç½®"><a href="#å‚æ•°é…ç½®" class="headerlink" title="å‚æ•°é…ç½®"></a>å‚æ•°é…ç½®</h2><p>ä»¥<code>application.yml</code>ä¸¾ä¾‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ali:</span></span><br><span class="line">  <span class="attr">sms:</span></span><br><span class="line">  	<span class="attr">domain:</span> <span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span> <span class="comment">## é»˜è®¤dysmsapi.aliyuncs.com</span></span><br><span class="line">  	<span class="attr">version:</span> <span class="string">&quot;2017-05-25&quot;</span> <span class="comment">## é»˜è®¤2017-05-25</span></span><br><span class="line">  	<span class="attr">action:</span> <span class="string">&quot;SendSms&quot;</span> <span class="comment">## é»˜è®¤SendSms</span></span><br><span class="line">    <span class="attr">access-key:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">&quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡AccessKeyId&#125;&quot;</span></span><br><span class="line">      <span class="attr">secret:</span> <span class="string">&quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡AccessKeySecret&#125;&quot;</span></span><br><span class="line">    <span class="attr">region-id:</span> <span class="string">&quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡åœ°åŸŸ&#125;&quot;</span></span><br><span class="line">    <span class="attr">sign-name:</span> <span class="string">&quot;$&#123;é˜¿é‡Œäº‘çŸ­ä¿¡ç­¾å&#125;&quot;</span> <span class="comment">## å¦‚æœä¸å¡«ï¼Œå¿…é¡»åœ¨å‘é€æ–¹æ³•ä¸­æŒ‡å®š</span></span><br></pre></td></tr></table></figure>

<h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><h3 id="åŒæ­¥å‘é€çŸ­ä¿¡"><a href="#åŒæ­¥å‘é€çŸ­ä¿¡" class="headerlink" title="åŒæ­¥å‘é€çŸ­ä¿¡"></a>åŒæ­¥å‘é€çŸ­ä¿¡</h3><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ¥å£ä¸Šè¿›è¡Œäº†æ–¹æ³•çš„é‡è½½ï¼Œæä¾›5ç§ä¸åŒçš„å‚æ•°åˆ—è¡¨ä¾›é€‰æ‹©ï¼Œä½ å¯ä»¥è‡ªè¡Œé€‰æ‹©ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°1ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment"> *     å‚æ•°2ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°3ï¼šMapï¼Œkeyå¯¹åº”æ¨¡æ¿ä¸­çš„å‚æ•°åï¼Œvalueå¯¹åº”å€¼ï¼ˆè¿™é‡Œæ˜¯ä½¿ç”¨Jacksonæ¥åºåˆ—åŒ–ï¼‰</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SmsResponse smsResponse = sendService.sendSync(TEMPLATE_ID, PHONE_NUMBER, MAP);</span><br><span class="line">    Assert.assertTrue(smsResponse.isSuccess());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°1ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment"> *     å‚æ•°2ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°3ï¼šè¦å‘é€çš„çŸ­ä¿¡å†™å…¥å€¼ï¼Œä½ å¯ä»¥è‡ªå·±è¿›è¡Œjsonçš„æ‹¼è£…ã€‚æ³¨æ„è¦è¿›è¡Œjsonçš„è½¬ä¹‰ï¼Œä¾‹å¦‚ï¼š&quot;&#123;\&quot;code\&quot;:\&quot;112233\&quot;&#125;&quot;</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSync1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SmsResponse smsResponse = sendService.sendSync(TEMPLATE_ID, PHONE_NUMBER, <span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;112233\&quot;&#125;&quot;</span>);</span><br><span class="line">    Assert.assertTrue(smsResponse.isSuccess());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°1ï¼šçŸ­ä¿¡ç­¾åï¼Œé€‚ç”¨äºåŒä¸€æ¨¡æ¿éœ€è¦æœ‰ä¸åŒçŸ­ä¿¡ç­¾åçš„</span></span><br><span class="line"><span class="comment"> *     å‚æ•°2ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment"> *     å‚æ•°3ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°4ï¼šMapï¼Œkeyå¯¹åº”æ¨¡æ¿ä¸­çš„å‚æ•°åï¼Œvalueå¯¹åº”å€¼ï¼ˆè¿™é‡Œæ˜¯ä½¿ç”¨Jacksonæ¥åºåˆ—åŒ–ï¼‰</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSync2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SmsResponse smsResponse = sendService.sendSync(SIGN_NAME, TEMPLATE_ID, PHONE_NUMBER, MAP);</span><br><span class="line">    Assert.assertTrue(smsResponse.isSuccess());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥å‘é€çŸ­ä¿¡</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°1ï¼šçŸ­ä¿¡ç­¾åï¼Œé€‚ç”¨äºåŒä¸€æ¨¡æ¿éœ€è¦æœ‰ä¸åŒçŸ­ä¿¡ç­¾åçš„</span></span><br><span class="line"><span class="comment"> *     å‚æ•°2ï¼šä½¿ç”¨çš„çŸ­ä¿¡æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment"> *     å‚æ•°3ï¼šæ¥æ”¶è€…çš„æ‰‹æœºå·ï¼Œå¦‚&quot;17602526129,17602923211&quot;</span></span><br><span class="line"><span class="comment"> *     å‚æ•°4ï¼šè¦å‘é€çš„çŸ­ä¿¡å†™å…¥å€¼ï¼Œä½ å¯ä»¥è‡ªå·±è¿›è¡Œjsonçš„æ‹¼è£…ã€‚æ³¨æ„è¦è¿›è¡Œjsonçš„è½¬ä¹‰ï¼Œä¾‹å¦‚ï¼š&quot;&#123;\&quot;code\&quot;:\&quot;112233\&quot;&#125;&quot;</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSync3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SmsResponse smsResponse = sendService.sendSync(SIGN_NAME, TEMPLATE_ID, PHONE_NUMBER, <span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;112233\&quot;&#125;&quot;</span>);</span><br><span class="line">    Assert.assertTrue(smsResponse.isSuccess());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€ä¸ªæä¾›äº†ä¸€ä¸ªå‚æ•°å¯¹è±¡æ¥å®šä¹‰çŸ­ä¿¡å‘é€è¯·æ±‚ï¼Œå¦‚æœä¸å«Œéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜¿é‡Œäº‘çŸ­ä¿¡è¯·æ±‚ä½“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç ã€‚ä»¥è‹±æ–‡é€—å·ï¼ˆ,ï¼‰åˆ†éš”ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNumbers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŸ­ä¿¡ç­¾ååç§°ã€‚è¯·åœ¨æ§åˆ¶å°ç­¾åç®¡ç†é¡µé¢ç­¾ååç§°ä¸€åˆ—æŸ¥çœ‹ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String signName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŸ­ä¿¡æ¨¡æ¿IDï¼Œå‰ç¼€ä¸ºSMS_</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer templateId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜¿é‡Œäº‘çŸ­ä¿¡å†…å®¹,key:çŸ­ä¿¡æ¨¡æ¿ä¸­çš„å­—æ®µåï¼Œvalueï¼šçŸ­ä¿¡æ¨¡æ¿å­—æ®µå¯¹åº”å€¼</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨æ­¤å­—æ®µéœ€è¦&#123;<span class="doctag">@link</span> com.fasterxml.jackson.databind.ObjectMapper&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; params;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * json str of  &#123;<span class="doctag">@link</span> #getParams()&#125;</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨æ­¤å­—æ®µè¯·è®¾ç½®paramsä¸ºNull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String paramStr;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSync4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SmsRequest smsRequest = <span class="keyword">new</span> SmsRequest();</span><br><span class="line">    smsRequest.setPhoneNumbers(PHONE_NUMBER);</span><br><span class="line">    smsRequest.setTemplateId(TEMPLATE_ID);</span><br><span class="line">    smsRequest.setParams(MAP);</span><br><span class="line">    SmsResponse smsResponse = sendService.sendSync(smsRequest);</span><br><span class="line">    Assert.assertTrue(smsResponse.isSuccess());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¼‚æ­¥å‘é€çŸ­ä¿¡"><a href="#å¼‚æ­¥å‘é€çŸ­ä¿¡" class="headerlink" title="å¼‚æ­¥å‘é€çŸ­ä¿¡"></a>å¼‚æ­¥å‘é€çŸ­ä¿¡</h3><blockquote>
<p>è€ƒè™‘åˆ°å‘çŸ­ä¿¡çš„éœ€æ±‚ï¼Œä¸€èˆ¬æ¥è¯´éƒ½éœ€è¦å¼‚æ­¥åŠ æŒï¼Œå¯¹ä»¥ä¸Š5ç§æ–¹æ³•åˆ†åˆ«æä¾›äº†å¼‚æ­¥æ¥å£<code>sendAsync</code>ï¼Œä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä½ å¯ä»¥å¼‚æ­¥å¤„ç†çŸ­ä¿¡å‘é€è¿”å›å€¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CompletableFuture&lt;SmsResponse&gt; smsResponse = sendService.sendAsync(TEMPLATE_ID, PHONE_NUMBER, MAP);</span><br><span class="line">smsResponse.thenAcceptAsync(sr -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (sr.isSuccess()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡†å¤‡é‡è¯•æ­¤æ¬¡çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="é«˜çº§ä½¿ç”¨"><a href="#é«˜çº§ä½¿ç”¨" class="headerlink" title="é«˜çº§ä½¿ç”¨"></a>é«˜çº§ä½¿ç”¨</h2><p>é™¤äº†ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•å‘é€çŸ­ä¿¡å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹çš„<code>IAcsClient</code>æ¥å‘é€çŸ­ä¿¡ï¼Œå¦‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.gcdd1993.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.request;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.CommonResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.http.MethodType;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> io.github.gcdd1993.alisms.domain.SmsRequest;</span><br><span class="line"><span class="keyword">import</span> io.github.gcdd1993.alisms.domain.SmsResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gaochen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAcsClient acsClient;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SmsResponse <span class="title">sendSync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">            request.setMethod(MethodType.POST);</span><br><span class="line">            request.setDomain(<span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>);</span><br><span class="line">            request.setVersion(<span class="string">&quot;2017-05-25&quot;</span>);</span><br><span class="line">            request.setAction(<span class="string">&quot;SendSms&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;RegionId&quot;</span>, <span class="string">&quot;region&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;PhoneNumbers&quot;</span>, <span class="string">&quot;1771636783&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;SignName&quot;</span>, <span class="string">&quot;SignName&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;TemplateCode&quot;</span>, <span class="string">&quot;SMS_12345678&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;TemplateParam&quot;</span>, <span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;112233\&quot;&#125;&quot;</span>);</span><br><span class="line">            CommonResponse commonResponse = acsClient.getCommonResponse(request);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> SmsResponse.SmsResponseBuilder.build(commonResponse);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;send msg error.&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> SmsResponse.SmsResponseBuilder.buildFail(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;write json failed.&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> SmsResponse.SmsResponseBuilder.buildFail(<span class="string">&quot;çŸ­ä¿¡å‚æ•°åœ¨jsonåºåˆ—åŒ–æ—¶å‡ºé”™&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Licenses"><a href="#Licenses" class="headerlink" title="Licenses"></a>Licenses</h1><p><a href="http://www.apache.org/licenses/LICENSE-2.0.txt">The Apache License, Version 2.0</a></p>
<h1 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h1><p><a href="https://github.com/gcdd1993/ali-sms-spring-boot-starter/issues">Issues Welcome</a></p>
<h1 id="æ”¯æŒ"><a href="#æ”¯æŒ" class="headerlink" title="æ”¯æŒ"></a>æ”¯æŒ</h1><ul>
<li>Click <a href="https://github.com/gcdd1993/ali-sms-spring-boot-starter">Github</a> to star, Thanks!</li>
</ul>
<h1 id="æ›´å¤šå‚è€ƒ"><a href="#æ›´å¤šå‚è€ƒ" class="headerlink" title="æ›´å¤šå‚è€ƒ"></a>æ›´å¤šå‚è€ƒ</h1><p><a href="https://help.aliyun.com/document_detail/101300.html">é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡APIå‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>Cassandraå­¦ä¹ ç¬”è®°</title>
    <url>/p/60138/</url>
    <content><![CDATA[<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>æŒ‰ç…§<a href="https://gcdd1993.github.io/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0%EF%BC%88%E9%83%A8%E7%BD%B2%E7%AF%87%EF%BC%89/#more">Cassandraé›†ç¾¤éƒ¨ç½²</a>æ­å»ºä¸¤å°æµ‹è¯•æœºï¼Œç¯å¢ƒä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>IP</th>
<th>æ•°æ®ä¸­å¿ƒåç§°</th>
</tr>
</thead>
<tbody><tr>
<td>node-01</td>
<td>192.168.198.130</td>
<td>datacenter1</td>
</tr>
<tr>
<td>node-02</td>
<td>192.168.198.131</td>
<td>datacenter1</td>
</tr>
</tbody></table>
<h1 id="Keyspace"><a href="#Keyspace" class="headerlink" title="Keyspace"></a>Keyspace</h1><h2 id="åˆ›å»ºKeyspace"><a href="#åˆ›å»ºKeyspace" class="headerlink" title="åˆ›å»ºKeyspace"></a>åˆ›å»ºKeyspace</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create_keyspace_statement ::=  CREATE KEYSPACE [ IF NOT EXISTS ] keyspace_name WITH options</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">## ä½¿ç”¨SimpleStrategyå¤åˆ¶ç­–ç•¥</span><br><span class="line">CREATE KEYSPACE excelsior</span><br><span class="line">    WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125;;</span><br><span class="line"></span><br><span class="line">## ä½¿ç”¨NetworkTopologyStrategyå¤åˆ¶ç­–ç•¥</span><br><span class="line"># 1. ç¡®è®¤åˆ†åŒºåç§°</span><br><span class="line">$ nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># 2. ä½¿ç”¨NetworkTopologyStrategyå¤åˆ¶ç­–ç•¥åˆ›å»ºkeyspace</span><br><span class="line">CREATE KEYSPACE excalibur</span><br><span class="line">    WITH replication = &#123;&#x27;class&#x27;: &#x27;NetworkTopologyStrategy&#x27;, &#x27;DC1&#x27; : 1, &#x27;DC2&#x27; : 3&#125;</span><br><span class="line">    AND durable_writes = false;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨Keyspace"><a href="#ä½¿ç”¨Keyspace" class="headerlink" title="ä½¿ç”¨Keyspace"></a>ä½¿ç”¨Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use_statement ::=  USE keyspace_name</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹Keyspaceï¼ˆreplication-factorï¼‰"><a href="#ä¿®æ”¹Keyspaceï¼ˆreplication-factorï¼‰" class="headerlink" title="ä¿®æ”¹Keyspaceï¼ˆreplication factorï¼‰"></a>ä¿®æ”¹Keyspaceï¼ˆreplication factorï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter_keyspace_statement ::=  ALTER KEYSPACE keyspace_name WITH options</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ALTER KEYSPACE excelsior </span><br><span class="line">	WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 4&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹Keyspace"><a href="#æŸ¥çœ‹Keyspace" class="headerlink" title="æŸ¥çœ‹Keyspace"></a>æŸ¥çœ‹Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DESCRIBE KEYSPACE &lt;keyspace name&gt;;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¯¥è¯­å¥æŸ¥çœ‹åˆ›å»ºçš„é”®ç©ºé—´æ˜¯å¦æ­£ç¡®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DESCRIBE KEYSPACE excelsior;</span><br><span class="line"></span><br><span class="line">CREATE KEYSPACE excelsior WITH replication = &#123;&#x27;class&#x27;: &#x27;SimpleStrategy&#x27;, &#x27;replication_factor&#x27; : 3&#125; AND durable_writes = true;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤Keyspace"><a href="#åˆ é™¤Keyspace" class="headerlink" title="åˆ é™¤Keyspace"></a>åˆ é™¤Keyspace</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">drop_keyspace_statement ::=  DROP KEYSPACE [ IF EXISTS ] keyspace_name</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DROP KEYSPACE excelsior;</span><br><span class="line">DESCRIBE excelsior;</span><br><span class="line"></span><br><span class="line">&#x27;excelsior&#x27; not found in keyspaces</span><br></pre></td></tr></table></figure>

<h1 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h1><h2 id="åˆ›å»ºTable"><a href="#åˆ›å»ºTable" class="headerlink" title="åˆ›å»ºTable"></a>åˆ›å»ºTable</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create_table_statement ::=  CREATE TABLE [ IF NOT EXISTS ] table_name</span><br><span class="line">                            &#x27;(&#x27;</span><br><span class="line">                                column_definition</span><br><span class="line">                                ( &#x27;,&#x27; column_definition )*</span><br><span class="line">                                [ &#x27;,&#x27; PRIMARY KEY &#x27;(&#x27; primary_key &#x27;)&#x27; ]</span><br><span class="line">                            &#x27;)&#x27; [ WITH table_options ]</span><br><span class="line">column_definition      ::=  column_name cql_type [ STATIC ] [ PRIMARY KEY]</span><br><span class="line">primary_key            ::=  partition_key [ &#x27;,&#x27; clustering_columns ]</span><br><span class="line">partition_key          ::=  column_name</span><br><span class="line">                            | &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27;</span><br><span class="line">clustering_columns     ::=  column_name ( &#x27;,&#x27; column_name )*</span><br><span class="line">table_options          ::=  COMPACT STORAGE [ AND table_options ]</span><br><span class="line">                            | CLUSTERING ORDER BY &#x27;(&#x27; clustering_order &#x27;)&#x27; [ AND table_options ]</span><br><span class="line">                            | options</span><br><span class="line">clustering_order       ::=  column_name (ASC | DESC) ( &#x27;,&#x27; column_name (ASC | DESC) )*</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºTableå¿…é¡»æŒ‡å®šä¸»é”®ï¼Œä¸»é”®æ˜¯ç”¨äºåœ¨è¡¨ä¸­å”¯ä¸€æ ‡è¯†æŸä¸€è¡Œï¼Œå¯ä»¥æ˜¯ä¸€åˆ—æˆ–å¤šåˆ—ã€‚</p>
<p>ç¤ºä¾‹ï¼Œåœ¨<code>excelsior</code>é”®ç©ºé—´åˆ›å»ºä¸€å¼ åä¸º<code>excelsior_alt_stats </code>çš„è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE excelsior.excelsior_alt_stats (</span><br><span class="line">	id UUID PRIMARY KEY,</span><br><span class="line">	lastname text,</span><br><span class="line">	birthday timestamp,</span><br><span class="line">	nationality text,</span><br><span class="line">	weight text,</span><br><span class="line">	height text</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>cassandraè¿˜æ”¯æŒcollectionï¼ˆmap, set, æˆ–è€… listï¼‰ç±»å‹ä½œä¸ºåˆ—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE excelsior.whimsey ( </span><br><span class="line">    id UUID PRIMARY KEY, </span><br><span class="line">    lastname text, </span><br><span class="line">    excelsior_teams set&lt;text&gt;, </span><br><span class="line">    events list&lt;text&gt;, </span><br><span class="line">    teams map&lt;int,text&gt; </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ç”šè‡³æ˜¯åµŒå¥—çš„å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE excelsior.route (</span><br><span class="line">    race_id int, </span><br><span class="line">    race_name text, </span><br><span class="line">    point_id int, </span><br><span class="line">    lat_long tuple&lt;text, tuple&lt;float,float&gt;&gt;, </span><br><span class="line">    PRIMARY KEY (race_id, point_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šæ•°æ®ç±»å‹è¯·å‚é˜…ä¸‹ä¸€èŠ‚<a href="#Cassandra%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">Cassandraæ•°æ®ç»“æ„</a></p>
<h3 id="é™æ€åˆ—"><a href="#é™æ€åˆ—" class="headerlink" title="é™æ€åˆ—"></a>é™æ€åˆ—</h3><p>æŸäº›åˆ—å¯ä»¥åœ¨è¡¨å®šä¹‰ä¸­å£°æ˜ä¸ºSTATICã€‚é™æ€çš„åˆ—å°†ç”±å±äºåŒä¸€åˆ†åŒºï¼ˆå…·æœ‰ç›¸åŒåˆ†åŒºé”®ï¼‰çš„æ‰€æœ‰è¡Œâ€œå…±äº«â€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE t (</span><br><span class="line">    pk int,</span><br><span class="line">    t int,</span><br><span class="line">    v text,</span><br><span class="line">    s text static,</span><br><span class="line">    PRIMARY KEY (pk, t)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO t (pk, t, v, s) VALUES (0, 0, &#x27;val0&#x27;, &#x27;static0&#x27;);</span><br><span class="line">INSERT INTO t (pk, t, v, s) VALUES (0, 1, &#x27;val1&#x27;, &#x27;static1&#x27;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM t;</span><br><span class="line">   pk | t | v      | s</span><br><span class="line">  ----+---+--------+-----------</span><br><span class="line">   0  | 0 | &#x27;val0&#x27; | &#x27;static1&#x27;</span><br><span class="line">   0  | 1 | &#x27;val1&#x27; | &#x27;static1&#x27;</span><br><span class="line">   </span><br><span class="line">## æ‰€æœ‰è®°å½•ä¸­çš„é™æ€åˆ—å°†æ°¸è¿œå±•ç¤ºæœ€åä¸€æ¬¡æ›´æ–°çš„å€¼   </span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹Table"><a href="#ä¿®æ”¹Table" class="headerlink" title="ä¿®æ”¹Table"></a>ä¿®æ”¹Table</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter_table_statement   ::=  ALTER TABLE table_name alter_table_instruction</span><br><span class="line">alter_table_instruction ::=  ADD column_name cql_type ( &#x27;,&#x27; column_name cql_type )*</span><br><span class="line">                             | DROP column_name ( column_name )*</span><br><span class="line">                             | WITH options</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ALTER TABLE addamsFamily ADD gravesite varchar;</span><br><span class="line"></span><br><span class="line">ALTER TABLE addamsFamily</span><br><span class="line">       WITH comment = &#x27;A most excellent and useful table&#x27;;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹Tableå¯ä»¥ï¼š</p>
<ol>
<li>å‘è¡¨ä¸­æ·»åŠ æ–°åˆ—ï¼ˆé€šè¿‡ADDæŒ‡ä»¤ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæ— æ³•æ›´æ”¹è¡¨çš„ä¸»é”®ï¼Œå› æ­¤æ–°æ·»åŠ çš„åˆ—å°†ä¸ä¼šæˆä¸ºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>ä»è¡¨ä¸­åˆ é™¤åˆ—ã€‚è¿™ä¼šä¸¢å¼ƒåˆ—åŠå…¶æ‰€æœ‰å†…å®¹ã€‚</li>
<li>æ›´æ”¹ä¸€äº›è¡¨é€‰é¡¹ï¼ˆé€šè¿‡WITHæŒ‡ä»¤ï¼‰ã€‚æ”¯æŒçš„é€‰é¡¹ä¸åˆ›å»ºè¡¨æ—¶ç›¸åŒï¼ˆåœ¨åˆ›å»ºåæ— æ³•æ›´æ”¹çš„COMPACT STORAGEå’ŒCLUSTERING ORDERä¹‹å¤–ï¼‰ã€‚</li>
</ol>
<h2 id="åˆ é™¤Table"><a href="#åˆ é™¤Table" class="headerlink" title="åˆ é™¤Table"></a>åˆ é™¤Table</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">drop_table_statement ::=  DROP TABLE [ IF EXISTS ] table_name</span><br></pre></td></tr></table></figure>

<h2 id="æˆªæ–­Tableï¼ˆæ¸…ç©ºè¡¨æ•°æ®ï¼‰"><a href="#æˆªæ–­Tableï¼ˆæ¸…ç©ºè¡¨æ•°æ®ï¼‰" class="headerlink" title="æˆªæ–­Tableï¼ˆæ¸…ç©ºè¡¨æ•°æ®ï¼‰"></a>æˆªæ–­Tableï¼ˆæ¸…ç©ºè¡¨æ•°æ®ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">truncate_statement ::=  TRUNCATE [ TABLE ] table_name</span><br></pre></td></tr></table></figure>

<p>ç”±äºè¡¨æ˜¯å”¯ä¸€å¯ä»¥åœ¨å½“å‰æˆªæ–­çš„å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥çœç•¥TABLEå…³é”®å­—ã€‚</p>
<p>æˆªæ–­è¡¨ä¼šæ°¸ä¹…åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œä½†ä¸ä¼šåˆ é™¤è¡¨æœ¬èº«ã€‚</p>
<h1 id="Cassandraæ•°æ®ç»“æ„"><a href="#Cassandraæ•°æ®ç»“æ„" class="headerlink" title="Cassandraæ•°æ®ç»“æ„"></a>Cassandraæ•°æ®ç»“æ„</h1><blockquote>
<p>CQLæ˜¯ä¸€ç§ç±»å‹åŒ–è¯­è¨€ï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹é›†ï¼ŒåŒ…æ‹¬æœ¬åœ°ç±»å‹ï¼Œé›†åˆç±»å‹ï¼Œç”¨æˆ·å®šä¹‰ç±»å‹ï¼Œå…ƒç»„ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹ï¼š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cql_type ::=  native_type | collection_type | user_defined_type | tuple_type | custom_type</span><br></pre></td></tr></table></figure>

<h2 id="æœ¬åœ°ç±»å‹ï¼ˆNative-Typesï¼‰"><a href="#æœ¬åœ°ç±»å‹ï¼ˆNative-Typesï¼‰" class="headerlink" title="æœ¬åœ°ç±»å‹ï¼ˆNative Typesï¼‰"></a>æœ¬åœ°ç±»å‹ï¼ˆNative Typesï¼‰</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å¸¸é‡æ”¯æŒ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ascii</td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>ASCIIå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>bigint</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>64ä½æ— ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td><code>blob</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-blob"><code>blob</code></a></td>
<td>ä»»æ„å­—èŠ‚ï¼ˆæ— éªŒè¯ï¼‰</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-boolean"><code>boolean</code></a></td>
<td><code>true</code>æˆ–<code>false</code></td>
</tr>
<tr>
<td><code>counter</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>è®¡æ•°å™¨åˆ—ï¼ˆ64ä½æœ‰ç¬¦å·å€¼ï¼‰</td>
</tr>
<tr>
<td><code>date</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>ï¼Œ <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>æ—¥æœŸï¼ˆæ²¡æœ‰ç›¸åº”çš„æ—¶é—´å€¼ï¼‰</td>
</tr>
<tr>
<td><code>decimal</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>ï¼Œ <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>åè¿›åˆ¶å¯å˜ç²¾åº¦</td>
</tr>
<tr>
<td><code>double</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a> <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>64ä½IEEE-754æµ®ç‚¹</td>
</tr>
<tr>
<td><code>duration</code></td>
<td><code>duration</code></td>
<td>æŒç»­æ—¶é—´ï¼ˆçº³ç§’ç²¾åº¦ï¼‰</td>
</tr>
<tr>
<td><code>float</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>ï¼Œ <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-float"><code>float</code></a></td>
<td>32ä½IEEE-754æµ®ç‚¹</td>
</tr>
<tr>
<td><code>inet</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>IPåœ°å€ï¼ŒIPv4ï¼ˆ4å­—èŠ‚é•¿ï¼‰æˆ–IPv6ï¼ˆ16å­—èŠ‚é•¿ï¼‰</td>
</tr>
<tr>
<td><code>int</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>32ä½æ— ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td><code>smallint</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>16ä½æœ‰ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td><code>text</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>UTF8ç¼–ç çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>time</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>ï¼Œ <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>å…·æœ‰çº³ç§’ç²¾åº¦çš„æ—¶é—´ï¼ˆæ²¡æœ‰ç›¸åº”çš„æ—¥æœŸå€¼ï¼‰</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a>ï¼Œ <a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>æ—¶é—´æˆ³ï¼ˆæ—¥æœŸå’Œæ—¶é—´ï¼‰ï¼Œç²¾åº¦ä¸ºæ¯«ç§’</td>
</tr>
<tr>
<td><code>timeuuid</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-uuid"><code>uuid</code></a></td>
<td><a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>ï¼ˆç‰ˆæœ¬1ï¼‰ï¼Œé€šå¸¸ç”¨ä½œâ€œæ— å†²çªâ€æ—¶é—´æˆ³</td>
</tr>
<tr>
<td><code>tinyint</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>8ä½æœ‰ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td><code>uuid</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-uuid"><code>uuid</code></a></td>
<td>ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>ï¼ˆä»»ä½•ç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td><code>varchar</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-string"><code>string</code></a></td>
<td>UTF8ç¼–ç çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>varint</code></td>
<td><a href="http://cassandra.apache.org/doc/latest/cql/definitions.html#grammar-token-integer"><code>integer</code></a></td>
<td>ä»»æ„ç²¾åº¦æ•´æ•°</td>
</tr>
</tbody></table>
<p>å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯æ—¶é—´ç±»å‹ï¼š</p>
<h3 id="timestamps"><a href="#timestamps" class="headerlink" title="timestamps"></a>timestamps</h3><blockquote>
<p>æ—¶é—´æˆ³ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º64ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºè‡ªæ ‡å‡†åŸºå‡†æ—¶é—´ï¼ˆç§°ä¸ºçºªå…ƒï¼š1970å¹´1æœˆ1æ—¥æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´00:00:00ï¼‰ä»¥æ¥çš„æ¯«ç§’æ•°ã€‚</p>
</blockquote>
<ul>
<li><code>1299038700000</code></li>
<li><code>&#39;2011-02-03 04:05+0000&#39;</code></li>
<li><code>&#39;2011-02-03 04:05:00+0000&#39;</code></li>
<li><code>&#39;2011-02-03 04:05:00.000+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05:00+0000&#39;</code></li>
<li><code>&#39;2011-02-03T04:05:00.000+0000&#39;</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM point</span><br><span class="line">WHERE ts = &#x27;2018-11-15 00:00:30.557+0000&#x27;;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM point</span><br><span class="line">WHERE ts = 1542211230557;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>+0000</code>æ˜¯RFC 822 4-digitæ—¶åŒºè§„èŒƒï¼Œ<code>+0000</code>æŒ‡GMTã€‚ç¾å›½å¤ªå¹³æ´‹æ ‡å‡†æ—¶é—´ä¸º<code>-0800</code>ï¼Œä¸­å›½åŒ—äº¬æ ‡å‡†æ—¶é—´ä¸º<code>+8000</code>ï¼Œå®˜æ–¹å»ºè®®<strong>æ¯æ¬¡æ’å…¥æŸ¥è¯¢éƒ½å¸¦ä¸Šæ—¶åŒº</strong>ï¼Œä¸åŠ çš„è¯ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨CassandraèŠ‚ç‚¹é…ç½®çš„æ—¶åŒºï¼Œå¯èƒ½ä¼šå‡ºç°æ—¶åŒºä¸ä¸€è‡´å¯¼è‡´çš„æŸ¥è¯¢å¤±è´¥é—®é¢˜ã€‚</p>
<h3 id="dates"><a href="#dates" class="headerlink" title="dates"></a>dates</h3><blockquote>
<p> æ—¥æœŸç±»å‹çš„å€¼è¢«ç¼–ç ä¸º32ä½æ— ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºåœ¨è¯¥èŒƒå›´çš„ä¸­å¿ƒå¤„å…·æœ‰â€œçºªå…ƒâ€çš„å¤©æ•°ï¼ˆ2^31ï¼‰ã€‚å¤§çºªå…ƒæ˜¯1970å¹´1æœˆ1æ—¥ã€‚</p>
</blockquote>
<p>è‡³äºæ—¶é—´æˆ³ï¼Œæ—¥æœŸå¯ä»¥ä½œä¸ºæ•´æ•°æˆ–ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²è¾“å…¥ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ ¼å¼åº”ä¸º<code>yyyy-mm-dd</code>ï¼ˆä¾‹å¦‚â€™2011-02-03â€™ï¼‰ã€‚</p>
<h3 id="times"><a href="#times" class="headerlink" title="times"></a>times</h3><blockquote>
<p>æ—¶é—´ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º64ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤ºè‡ªåˆå¤œä»¥æ¥çš„çº³ç§’æ•°ã€‚</p>
</blockquote>
<p>å¯¹äºæ—¶é—´æˆ³ï¼Œå¯ä»¥ä»¥æ•´æ•°æˆ–è¡¨ç¤ºæ—¶é—´çš„å­—ç¬¦ä¸²çš„å½¢å¼è¾“å…¥æ—¶é—´ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ ¼å¼åº”ä¸º<code>hh:mm:ss [.fffffffff]</code>ï¼ˆå…¶ä¸­äºšç§’ç²¾åº¦æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæä¾›ï¼Œåˆ™å¯ä»¥å°äºçº³ç§’ï¼‰ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€æ®µæ—¶é—´å†…çš„æœ‰æ•ˆè¾“å…¥ï¼š</p>
<ul>
<li><code>&#39;08:12:54&#39;</code></li>
<li><code>&#39;08:12:54.123&#39;</code></li>
<li><code>&#39;08:12:54.123456&#39;</code></li>
<li><code>&#39;08:12:54.123456789&#39;</code></li>
</ul>
<h3 id="durations"><a href="#durations" class="headerlink" title="durations"></a>durations</h3><blockquote>
<p>æŒç»­æ—¶é—´ç±»å‹çš„å€¼è¢«ç¼–ç ä¸º3ä¸ªæœ‰ç¬¦å·æ•´æ•°çš„å¯å˜é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºä¸€ä¸ªæœˆçš„å¤©æ•°å¯ä»¥æ”¹å˜ï¼Œä¸€å¤©å¯ä»¥æœ‰23æˆ–25å°æ—¶ï¼Œå…·ä½“å–å†³äºå¤ä»¤æ—¶ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæœˆæ•°ï¼ˆ32ä½æ•´æ•°ï¼‰</p>
</li>
<li><p>ç¬¬äºŒä¸ªè¡¨ç¤ºå¤©æ•°ï¼ˆ32ä½æ•´æ•°ï¼‰</p>
</li>
<li><p>ç¬¬ä¸‰ä¸ªè¡¨ç¤ºçº³ç§’æ•°ï¼ˆ64ä½æ•´æ•°ï¼‰</p>
</li>
</ul>
</blockquote>
<ol>
<li>æ”¯æŒçš„å•ä½ï¼š</li>
</ol>
<ul>
<li><code>y</code>: å¹´(12 æœˆ)</li>
<li><code>mo</code>: æœˆ (1 æœˆ)</li>
<li><code>w</code>: å‘¨(7 å¤©)</li>
<li><code>d</code>: å¤©(1 å¤©)</li>
<li><code>h</code>: å°æ—¶(3,600,000,000,000 çº³ç§’)</li>
<li><code>m</code>: åˆ†é’Ÿ(60,000,000,000 çº³)</li>
<li><code>s</code>: ç§’(1,000,000,000 çº³)</li>
<li><code>ms</code>: æ¯«ç§’(1,000,000 çº³)</li>
<li><code>us</code> or <code>Âµs</code> : å¾®å¦™(1000 çº³)</li>
<li><code>ns</code>: çº³ç§’(1 çº³)</li>
</ul>
<ol start="2">
<li>ISO 8601æ ¼å¼ï¼š<code>P[n]Y[n]M[n]DT[n]H[n]M[n]S or P[n]W</code></li>
<li>ISO 8601æ›¿ä»£æ ¼å¼ï¼š<code>P[YYYY]-[MM]-[DD]T[hh]:[mm]:[ss]</code></li>
</ol>
<p>æ’å…¥ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;Christopher Froome&#x27;, &#x27;Tour de France&#x27;, 89h4m48s);</span><br><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;BARDET Romain&#x27;, &#x27;Tour de France&#x27;, PT89H8M53S);</span><br><span class="line">INSERT INTO RiderResults (rider, race, result) VALUES (&#x27;QUINTANA Nairo&#x27;, &#x27;Tour de France&#x27;, P0000-00-00T89:09:09);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŒç»­æ—¶é—´åˆ—ä¸èƒ½ä½œä¸ºä¸»é”®ã€‚è¿™æ˜¯ç”±äºæ— æ³•ç²¾ç¡®ç¡®è®¤æŒç»­æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰æ—¥æœŸä¸Šä¸‹æ–‡ï¼Œå®é™…ä¸Šä¸å¯èƒ½çŸ¥é“1ä¸ªæœˆæ˜¯å¦å¤§äº29å¤©ã€‚</p>
<p>1å¤©çš„æŒç»­æ—¶é—´ä¹Ÿä¸ç­‰äº24hï¼Œå› ä¸ºæŒç»­æ—¶é—´ç±»å‹éœ€è¦æ”¯æŒå¤ä»¤æ—¶ã€‚</p>
</blockquote>
<h2 id="é›†åˆç±»å‹ï¼ˆCollectionsï¼‰"><a href="#é›†åˆç±»å‹ï¼ˆCollectionsï¼‰" class="headerlink" title="é›†åˆç±»å‹ï¼ˆCollectionsï¼‰"></a>é›†åˆç±»å‹ï¼ˆCollectionsï¼‰</h2><p>cassandraæ”¯æŒä¸‰ç§ç±»å‹çš„é›†åˆï¼š<a href="http://cassandra.apache.org/doc/latest/cql/types.html#maps">Maps</a>, <a href="http://cassandra.apache.org/doc/latest/cql/types.html#sets">Sets</a> and <a href="http://cassandra.apache.org/doc/latest/cql/types.html#lists">Lists</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">collection_type ::=  MAP &#x27;&lt;&#x27; cql_type &#x27;,&#x27; cql_type &#x27;&gt;&#x27;</span><br><span class="line">                     | SET &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27;</span><br><span class="line">                     | LIST &#x27;&lt;&#x27; cql_type &#x27;&gt;&#x27;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿™æ ·è¾“å…¥é›†åˆç±»å‹çš„æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">collection_literal ::=  map_literal | set_literal | list_literal</span><br><span class="line">map_literal        ::=  &#x27;&#123;&#x27; [ term &#x27;:&#x27; term (&#x27;,&#x27; term : term)* ] &#x27;&#125;&#x27;</span><br><span class="line">set_literal        ::=  &#x27;&#123;&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;&#125;&#x27;</span><br><span class="line">list_literal       ::=  &#x27;[&#x27; [ term (&#x27;,&#x27; term)* ] &#x27;]&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h3><blockquote>
<p>Mapsæ˜¯ä¸€ç»„ï¼ˆæœ‰åºï¼‰é”®å€¼å¯¹ï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æŒ‰å…¶é”®æ’åºã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    name text,</span><br><span class="line">    favs map&lt;text, text&gt; // A map of text keys, and text values</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO users (id, name, favs)</span><br><span class="line">           VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">// Replace the existing map entirely.</span><br><span class="line">UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒMapsè¿˜å…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š</p>
<ul>
<li>æ›´æ–°æˆ–æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE users SET favs[&#x27;author&#x27;] = &#x27;Ed Poe&#x27; WHERE id = &#x27;jsmith&#x27;;</span><br><span class="line">UPDATE users SET favs = favs + &#123; &#x27;movie&#x27; : &#x27;Cassablanca&#x27;, &#x27;band&#x27; : &#x27;ZZ Top&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå¦‚æœä¸€ä¸ªå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ é™¤å®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œä½†ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE favs[&#x27;author&#x27;] FROM users WHERE id = &#x27;jsmith&#x27;;</span><br><span class="line">UPDATE users SET favs = favs - &#123; &#x27;movie&#x27;, &#x27;band&#x27;&#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h3><blockquote>
<p> Setsæ˜¯å”¯ä¸€å€¼çš„ï¼ˆå·²æ’åºï¼‰é›†åˆã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    name text,</span><br><span class="line">    favs map&lt;text, text&gt; // A map of text keys, and text values</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO users (id, name, favs)</span><br><span class="line">           VALUES (&#x27;jsmith&#x27;, &#x27;John Smith&#x27;, &#123; &#x27;fruit&#x27; : &#x27;Apple&#x27;, &#x27;band&#x27; : &#x27;Beatles&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">// Replace the existing map entirely.</span><br><span class="line">UPDATE users SET favs = &#123; &#x27;fruit&#x27; : &#x27;Banana&#x27; &#125; WHERE id = &#x27;jsmith&#x27;;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒSetsä¹Ÿå…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé›†åˆï¼Œæ’å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ æ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE images SET tags = tags + &#123; &#x27;gray&#x27;, &#x27;cuddly&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ˆå¦‚æœä¸€ä¸ªå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ é™¤å®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œä½†ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE images SET tags = tags - &#123; &#x27;cat&#x27; &#125; WHERE name = &#x27;cat.jpg&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><blockquote>
<p>Listsæ˜¯éå”¯ä¸€å€¼çš„ï¼ˆå·²æ’åºï¼‰é›†åˆï¼Œå…¶ä¸­å…ƒç´ æŒ‰åˆ—è¡¨ä¸­çš„ä½ç½®æ’åºã€‚å®ƒä¸Setsçš„åŒºåˆ«å°±åœ¨äºæ˜¯å¦æ˜¯å”¯ä¸€å€¼ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE plays (</span><br><span class="line">    id text PRIMARY KEY,</span><br><span class="line">    game text,</span><br><span class="line">    players int,</span><br><span class="line">    scores list&lt;int&gt; // A list of integers</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">INSERT INTO plays (id, game, players, scores)</span><br><span class="line">           VALUES (&#x27;123-afde&#x27;, &#x27;quake&#x27;, 3, [17, 4, 2]);</span><br><span class="line"></span><br><span class="line">// Replace the existing list entirely</span><br><span class="line">UPDATE plays SET scores = [ 3, 9, 4] WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼ŒListsåŒæ ·ä¹Ÿå…·æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼š</p>
<ul>
<li>åœ¨åˆ—è¡¨å¤´æˆ–å°¾æ·»åŠ å…ƒç´ </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE plays SET players = 5, scores = scores + [ 14, 21 ] WHERE id = &#x27;123-afde&#x27;;</span><br><span class="line">UPDATE plays SET players = 6, scores = [ 3 ] + scores WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡è¯¥æ“ä½œä¸æ˜¯å¹‚ç­‰çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¶ä¸­ä¸€ä¸ªæ“ä½œè¶…æ—¶æ—¶ï¼Œé‡è¯•æ“ä½œæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒä¸€æ•°æ®æ’å…¥ä¸¤æ¬¡ã€‚</p>
<ul>
<li>åœ¨åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡å¤„è®¾ç½®å€¼ã€‚è¯¥åˆ—è¡¨å¿…é¡»é•¿åº¦å¤§äºæ­¤ä¸‹æ ‡ï¼Œå¦åˆ™å°†æŠ›å‡ºåˆ—è¡¨å¤ªå°çš„é”™è¯¯</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE plays SET scores[1] = 7 WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡åˆ—è¡¨æŒ‡å®šä¸‹æ ‡åˆ é™¤å…ƒç´ ã€‚è¯¥åˆ—è¡¨å¿…é¡»é•¿åº¦å¤§äºæ­¤ä¸‹æ ‡ï¼Œå¦åˆ™å°†æŠ›å‡ºåˆ—è¡¨å¤ªå°çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå½“æ“ä½œä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œåˆ—è¡¨å¤§å°å°†å‡1ï¼Œä»è€Œæ”¹å˜æ­¤ä¸‹æ ‡ä¹‹åæ‰€æœ‰å…ƒç´ çš„ä½ç½®</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE scores[1] FROM plays WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE plays SET scores = scores - [ 12, 21 ] WHERE id = &#x27;123-afde&#x27;;</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡ä»¥ä¸Š2,3,4æ“ä½œä¼šå‡ºç°å†…éƒ¨çš„<code> read-before-write</code>ï¼Œä¼šæ¯”é€šå¸¸çš„æ›´æ–°æ¶ˆè€—æ›´å¤šçš„èµ„æºï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨<a href="#Sets">Sets</a>ä»£æ›¿Listsã€‚</p>
<h2 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUser-Defined-Typesï¼‰"><a href="#ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUser-Defined-Typesï¼‰" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUser-Defined Typesï¼‰"></a>ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUser-Defined Typesï¼‰</h2><blockquote>
<p>CQLæ”¯æŒç”¨æˆ·å®šä¹‰ç±»å‹ï¼ˆä»¥ä¸‹ç®€ç§°UDTï¼‰ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢<code>create_type_statement</code>ï¼Œ<code>alter_type_statement</code>å’Œ<code>drop_type_statement</code>åˆ›å»ºï¼Œä¿®æ”¹å’Œåˆ é™¤æ­¤ç±»å‹ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user_defined_type ::=  udt_name</span><br><span class="line">udt_name          ::=  [ keyspace_name &#x27;.&#x27; ] identifier</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create_type_statement ::=  CREATE TYPE [ IF NOT EXISTS ] udt_name</span><br><span class="line">                               &#x27;(&#x27; field_definition ( &#x27;,&#x27; field_definition )* &#x27;)&#x27;</span><br><span class="line">field_definition      ::=  identifier cql_type</span><br></pre></td></tr></table></figure>

<p>UDTæœ‰ä¸€ä¸ªåç§°ï¼ˆç”¨äºå£°æ˜è¯¥ç±»å‹çš„åˆ—ï¼‰ï¼Œæ˜¯ä¸€ç»„å‘½åå’Œç±»å‹å­—æ®µã€‚å­—æ®µåç§°å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬é›†åˆæˆ–å…¶ä»–UDTã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TYPE phone (</span><br><span class="line">    country_code int,</span><br><span class="line">    number text,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE TYPE address (</span><br><span class="line">    street text,</span><br><span class="line">    city text,</span><br><span class="line">    zip text,</span><br><span class="line">    phones map&lt;text, phone&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE TABLE user (</span><br><span class="line">    name text PRIMARY KEY,</span><br><span class="line">    addresses map&lt;text, frozen&lt;address&gt;&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡æ³¨æ„</p>
<ul>
<li>å°è¯•åˆ›å»ºç°æœ‰ç±»å‹æ—¶è¯·ä½¿ç”¨<code>IF NOT EXISTS</code>é€‰é¡¹ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
<li>UDTæœ¬è´¨ä¸Šç»‘å®šåˆ°åˆ›å»ºå®ƒçš„é”®ç©ºé—´ï¼Œå¹¶ä¸”åªèƒ½åœ¨è¯¥é”®ç©ºé—´ä¸­ä½¿ç”¨ã€‚åœ¨åˆ›å»ºæ—¶ï¼Œå¦‚æœç±»å‹åç§°ä»¥é”®ç©ºé—´åç§°ä¸ºå‰ç¼€ï¼Œåˆ™åœ¨è¯¥é”®ç©ºé—´ä¸­åˆ›å»ºå®ƒã€‚å¦åˆ™ï¼Œå®ƒå°†åœ¨å½“å‰é”®ç©ºé—´ä¸­åˆ›å»ºã€‚</li>
<li>ä»Cassandra 4.0å¼€å§‹ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¿…é¡»å†»ç»“UDTï¼Œå› æ­¤åœ¨ä¸Šé¢çš„è¡¨å®šä¹‰ä¸­å†»ç»“äº†<code>&lt;address&gt;</code>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.datastax.com/en/archived/cql/3.1/cql/cql_reference/collection_type_r.html">å†»ç»“</a>éƒ¨åˆ†ã€‚</li>
</ul>
<h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter_type_statement    ::=  ALTER TYPE udt_name alter_type_modification</span><br><span class="line">alter_type_modification ::=  ADD field_definition</span><br><span class="line">                             | RENAME identifier TO identifier ( identifier TO identifier )*</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸ªUDTï¼Œå¯ä»¥ï¼š</p>
<ol>
<li>åœ¨ç±»å‹ä¸­æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µ</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ALTER TYPE address ADD country text</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼šæ–°æ·»åŠ çš„å­—æ®µåœ¨ä¹‹å‰çš„è®°å½•ä¸­ï¼Œéƒ½å°†è¢«ç½®ä¸ºNULLã€‚</p>
<ol start="2">
<li>é‡å‘½åè¯¥ç±»å‹çš„å­—æ®µ</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ALTER TYPE address RENAME zip TO zipcode</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">drop_type_statement ::=  DROP TYPE [ IF EXISTS ] udt_name</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">udt_literal ::=  &#x27;&#123;&#x27; identifier &#x27;:&#x27; term ( &#x27;,&#x27; identifier &#x27;:&#x27; term )* &#x27;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨UDTæœ‰ç‚¹åƒ<a href="#Maps">Maps</a>ï¼Œä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO user (name, addresses)</span><br><span class="line">          VALUES (&#x27;z3 Pr3z1den7&#x27;, &#123;</span><br><span class="line">              &#x27;home&#x27; : &#123;</span><br><span class="line">                  street: &#x27;1600 Pennsylvania Ave NW&#x27;,</span><br><span class="line">                  city: &#x27;Washington&#x27;,</span><br><span class="line">                  zip: &#x27;20500&#x27;,</span><br><span class="line">                  phones: &#123; &#x27;cell&#x27; : &#123; country_code: 1, number: &#x27;202 456-1111&#x27; &#125;,</span><br><span class="line">                            &#x27;landline&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#x27;work&#x27; : &#123;</span><br><span class="line">                  street: &#x27;1600 Pennsylvania Ave NW&#x27;,</span><br><span class="line">                  city: &#x27;Washington&#x27;,</span><br><span class="line">                  zip: &#x27;20500&#x27;,</span><br><span class="line">                  phones: &#123; &#x27;fax&#x27; : &#123; country_code: 1, number: &#x27;...&#x27; &#125; &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="å…ƒç»„ï¼ˆTuplesï¼‰"><a href="#å…ƒç»„ï¼ˆTuplesï¼‰" class="headerlink" title="å…ƒç»„ï¼ˆTuplesï¼‰"></a>å…ƒç»„ï¼ˆTuplesï¼‰</h2><blockquote>
<p>CQLè¿˜æ”¯æŒå…ƒç»„å’Œå…ƒç»„ç±»å‹ï¼ˆå…ƒç´ å¯ä»¥æ˜¯ä¸åŒç±»å‹ï¼‰ï¼Œç±»ä¼¼äºåŒ¿åçš„UDTæˆ–è€…æ˜¯Scalaçš„Tupleç±»å‹ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tuple_type    ::=  TUPLE &#x27;&lt;&#x27; cql_type ( &#x27;,&#x27; cql_type )* &#x27;&gt;&#x27;</span><br><span class="line">tuple_literal ::=  &#x27;(&#x27; term ( &#x27;,&#x27; term )* &#x27;)&#x27;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE durations (</span><br><span class="line">    event text,</span><br><span class="line">    duration tuple&lt;int, text&gt;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">INSERT INTO durations (event, duration) VALUES (&#x27;ev1&#x27;, (3, &#x27;hours&#x27;));</span><br></pre></td></tr></table></figure>

<h2 id="è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom-Typesï¼‰"><a href="#è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom-Typesï¼‰" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom Typesï¼‰"></a>è‡ªå®šä¹‰ç±»å‹ï¼ˆCustom Typesï¼‰</h2><blockquote>
<p>è‡ªå®šä¹‰ç±»å‹ä¸»è¦æ˜¯ä¸ºäº†<strong>å…¼å®¹è€é¡¹ç›®ï¼Œä¸å»ºè®®ä½¿ç”¨</strong>ã€‚ä½¿ç”¨å·²æœ‰çš„ç±»å‹åŠ ä¸Šç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆUDTï¼‰å°±å¤Ÿäº†ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">custom_type ::=  string</span><br></pre></td></tr></table></figure>

<h1 id="æ•°æ®å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰"><a href="#æ•°æ®å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰" class="headerlink" title="æ•°æ®å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰"></a>æ•°æ®å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰</h1><h2 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select_statement ::=  SELECT [ JSON | DISTINCT ] ( select_clause | &#x27;*&#x27; )</span><br><span class="line">                      FROM table_name</span><br><span class="line">                      [ WHERE where_clause ]</span><br><span class="line">                      [ GROUP BY group_by_clause ]</span><br><span class="line">                      [ ORDER BY ordering_clause ]</span><br><span class="line">                      [ PER PARTITION LIMIT (integer | bind_marker) ]</span><br><span class="line">                      [ LIMIT (integer | bind_marker) ]</span><br><span class="line">                      [ ALLOW FILTERING ]</span><br><span class="line">select_clause    ::=  selector [ AS identifier ] ( &#x27;,&#x27; selector [ AS identifier ] )</span><br><span class="line">selector         ::=  column_name</span><br><span class="line">                      | term</span><br><span class="line">                      | CAST &#x27;(&#x27; selector AS cql_type &#x27;)&#x27;</span><br><span class="line">                      | function_name &#x27;(&#x27; [ selector ( &#x27;,&#x27; selector )* ] &#x27;)&#x27;</span><br><span class="line">                      | COUNT &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;</span><br><span class="line">where_clause     ::=  relation ( AND relation )*</span><br><span class="line">relation         ::=  column_name operator term</span><br><span class="line">                      &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator tuple_literal</span><br><span class="line">                      TOKEN &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27; operator term</span><br><span class="line">operator         ::=  &#x27;=&#x27; | &#x27;&lt;&#x27; | &#x27;&gt;&#x27; | &#x27;&lt;=&#x27; | &#x27;&gt;=&#x27; | &#x27;!=&#x27; | IN | CONTAINS | CONTAINS KEY</span><br><span class="line">group_by_clause  ::=  column_name ( &#x27;,&#x27; column_name )*</span><br><span class="line">ordering_clause  ::=  column_name [ ASC | DESC ] ( &#x27;,&#x27; column_name [ ASC | DESC ] )*</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT name, occupation FROM users WHERE userid IN (199, 200, 207);</span><br><span class="line">SELECT JSON name, occupation FROM users WHERE userid = 199;</span><br><span class="line">SELECT name AS user_name, occupation AS user_occupation FROM users;</span><br><span class="line"></span><br><span class="line">SELECT time, value</span><br><span class="line">FROM events</span><br><span class="line">WHERE event_type = &#x27;myEvent&#x27;</span><br><span class="line">  AND time &gt; &#x27;2011-02-03&#x27;</span><br><span class="line">  AND time &lt;= &#x27;2012-01-01&#x27;</span><br><span class="line"></span><br><span class="line">SELECT COUNT (*) AS user_count FROM users;</span><br></pre></td></tr></table></figure>

<h3 id="Allowing-filtering"><a href="#Allowing-filtering" class="headerlink" title="Allowing filtering"></a>Allowing filtering</h3><blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCQLä»…å…è®¸ä¸æ¶‰åŠâ€œè¿‡æ»¤â€æœåŠ¡å™¨ç«¯çš„é€‰æ‹©æŸ¥è¯¢ï¼ŒåŸå› æ˜¯é‚£äº›â€œéè¿‡æ»¤â€æŸ¥è¯¢å…·æœ‰å¯é¢„æµ‹çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬çš„æŸ¥è¯¢æ€§èƒ½ä¸Limitæˆæ¯”ä¾‹ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE users (</span><br><span class="line">    username text PRIMARY KEY,</span><br><span class="line">    firstname text,</span><br><span class="line">    lastname text,</span><br><span class="line">    birth_year int,</span><br><span class="line">    country text</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CREATE INDEX ON users(birth_year);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ä¸¤ç§æŸ¥è¯¢æ˜¯ä¸éœ€è¦æ·»åŠ <code>ALLOW FILTERING</code>çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users;</span><br><span class="line">SELECT * FROM users WHERE birth_year = 1981;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒCassandraéƒ½ä¿è¯è¿™äº›æŸ¥è¯¢æ€§èƒ½ä¸è¿”å›çš„æ•°æ®é‡æˆæ­£æ¯”ã€‚</p>
<p>è€Œä¸‹é¢çš„è¿™ä¸ªæŸ¥è¯¢ï¼Œåˆ™éœ€è¦å¼ºåˆ¶æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE birth_year = 1981 AND country = &#x27;FR&#x27; ALLOW FILTERING;</span><br></pre></td></tr></table></figure>

<p>ğŸ‘‰ğŸ¼ å…³äºå¦‚ä½•å®šä¹‰å¯é¢„æµ‹çš„åˆ—ï¼Œå¯å‚è€ƒ<a href="http://cassandra.apache.org/doc/latest/cql/indexes.html">Cassandraä¸­çš„ç´¢å¼•</a></p>
<h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert_statement ::=  INSERT INTO table_name ( names_values | json_clause )</span><br><span class="line">                      [ IF NOT EXISTS ]</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">names_values     ::=  names VALUES tuple_literal</span><br><span class="line">json_clause      ::=  JSON string [ DEFAULT ( NULL | UNSET ) ]</span><br><span class="line">names            ::=  &#x27;(&#x27; column_name ( &#x27;,&#x27; column_name )* &#x27;)&#x27;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO NerdMovies (movie, director, main_actor, year)</span><br><span class="line">                VALUES (&#x27;Serenity&#x27;, &#x27;Joss Whedon&#x27;, &#x27;Nathan Fillion&#x27;, 2005)</span><br><span class="line">      USING TTL 86400;</span><br><span class="line"></span><br><span class="line">INSERT INTO NerdMovies JSON &#x27;&#123;&quot;movie&quot;: &quot;Serenity&quot;,</span><br><span class="line">                              &quot;director&quot;: &quot;Joss Whedon&quot;,</span><br><span class="line">                              &quot;year&quot;: 2005&#125;&#x27;;</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡è¯·æ³¨æ„</p>
<ol>
<li><p>ä¸SQLä¸åŒï¼ŒINSERTé»˜è®¤æƒ…å†µä¸‹ä¸æ£€æŸ¥è¡Œçš„å…ˆå‰å­˜åœ¨ï¼šå¦‚æœä¹‹å‰ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¡Œï¼Œå¦åˆ™æ›´æ–°ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“å‘ç”Ÿäº†å“ªäº›åˆ›å»ºæˆ–æ›´æ–°ã€‚</p>
</li>
<li><p>å¦‚æœè¦åšåˆ°å­˜åœ¨åˆ™ä¸æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨<code>IF NOT EXISTS</code>æ¡ä»¶ã€‚ä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨<code>IF NOT EXISTS</code>å°†å¯¼è‡´ä¸å¯å¿½ç•¥çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚</p>
</li>
<li><p>INSERTçš„æ‰€æœ‰æ›´æ–°éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚</p>
</li>
</ol>
<h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update_statement ::=  UPDATE table_name</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                      SET assignment ( &#x27;,&#x27; assignment )*</span><br><span class="line">                      WHERE where_clause</span><br><span class="line">                      [ IF ( EXISTS | condition ( AND condition )*) ]</span><br><span class="line">update_parameter ::=  ( TIMESTAMP | TTL ) ( integer | bind_marker )</span><br><span class="line">assignment       ::=  simple_selection &#x27;=&#x27; term</span><br><span class="line">                     | column_name &#x27;=&#x27; column_name ( &#x27;+&#x27; | &#x27;-&#x27; ) term</span><br><span class="line">                     | column_name &#x27;=&#x27; list_literal &#x27;+&#x27; column_name</span><br><span class="line">simple_selection ::=  column_name</span><br><span class="line">                     | column_name &#x27;[&#x27; term &#x27;]&#x27;</span><br><span class="line">                     | column_name &#x27;.&#x27; `field_name</span><br><span class="line">condition        ::=  simple_selection operator term</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE NerdMovies USING TTL 400</span><br><span class="line">   SET director   = &#x27;Joss Whedon&#x27;,</span><br><span class="line">       main_actor = &#x27;Nathan Fillion&#x27;,</span><br><span class="line">       year       = 2005</span><br><span class="line"> WHERE movie = &#x27;Serenity&#x27;;</span><br><span class="line"></span><br><span class="line">UPDATE UserActions</span><br><span class="line">   SET total = total + 2</span><br><span class="line">   WHERE user = B70DE1D0-9908-4AE3-BE34-5573E5B09F14</span><br><span class="line">     AND action = &#x27;click&#x27;;</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡è¯·æ³¨æ„</p>
<ol>
<li><p>ä¸SQLä¸åŒï¼ŒUPDATEé»˜è®¤æƒ…å†µä¸‹ä¸æ£€æŸ¥è¡Œçš„å…ˆå‰å­˜åœ¨ï¼ˆé™¤éé€šè¿‡IFï¼‰ï¼šå¦‚æœä¹‹å‰ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¡Œï¼Œå¦åˆ™æ›´æ–°ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“æ˜¯å¦å‘ç”Ÿäº†åˆ›å»ºæˆ–æ›´æ–°ã€‚</p>
</li>
<li><p>å¯ä»¥é€šè¿‡IFåœ¨æŸäº›åˆ—ä¸Šä½¿ç”¨æ¡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤éæ»¡è¶³æ¡ä»¶ï¼Œå¦åˆ™ä¸ä¼šæ›´æ–°è¡Œã€‚ä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨IFæ¡ä»¶ä¼šäº§ç”Ÿä¸å¯å¿½è§†çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚</p>
</li>
<li><p>åœ¨UPDATEè¯­å¥ä¸­ï¼ŒåŒä¸€åˆ†åŒºé”®ä¸­çš„æ‰€æœ‰æ›´æ–°éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚</p>
</li>
</ol>
<p>æ­¤å¤–ï¼ŒUPDATEæ“ä½œé’ˆå¯¹æŸäº›æ•°æ®ç±»å‹æœ‰å¼ºåˆ¶æ€§è¦æ±‚ï¼š</p>
<ol>
<li><code>c = c + 3</code></li>
</ol>
<p>ç”¨äºé€’å¢/é€’å‡è®¡æ•°å™¨ã€‚ </p>
<p>â€˜=â€™ç¬¦å·åé¢çš„åˆ—åç§°å¿…é¡»ä¸â€™=â€™ç¬¦å·å‰é¢çš„åˆ—åç›¸åŒã€‚è¯·æ³¨æ„ï¼Œ<strong>ä»…åœ¨è®¡æ•°å™¨ä¸Šå…è®¸é€’å¢/é€’å‡ï¼Œå¹¶ä¸”æ˜¯è®¡æ•°å™¨ä¸Šå…è®¸çš„å”¯ä¸€æ›´æ–°æ“ä½œ</strong>ã€‚</p>
<ol start="2">
<li><code>id = id + &lt;some-collection&gt;</code> å’Œ<code>id[value1] = value2</code></li>
</ol>
<p>ç”¨äºé›†åˆã€‚</p>
<ol start="3">
<li><code>id.field = 3</code></li>
</ol>
<p>åœ¨éå†»ç»“çš„ç”¨æˆ·å®šä¹‰ç±»å‹ä¸Šè®¾ç½®å­—æ®µçš„å€¼ã€‚</p>
<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete_statement ::=  DELETE [ simple_selection ( &#x27;,&#x27; simple_selection ) ]</span><br><span class="line">                      FROM table_name</span><br><span class="line">                      [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                      WHERE where_clause</span><br><span class="line">                      [ IF ( EXISTS | condition ( AND condition )*) ]</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE FROM NerdMovies USING TIMESTAMP 1240003134</span><br><span class="line"> WHERE movie = &#x27;Serenity&#x27;;</span><br><span class="line"></span><br><span class="line">DELETE phone FROM Users</span><br><span class="line"> WHERE userid IN (C73DE1D3-AF08-40F3-B124-3FF3E5109F22, B70DE1D0-9908-4AE3-BE34-5573E5B09F14);</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡è¯·æ³¨æ„</p>
<ol>
<li><p>WHEREå­å¥æŒ‡å®šè¦åˆ é™¤çš„è¡Œã€‚ä½¿ç”¨INè¿ç®—ç¬¦å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¯­å¥åˆ é™¤å¤šè¡Œã€‚å¯ä»¥ä½¿ç”¨ä¸ç­‰è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚&gt;=ï¼‰åˆ é™¤ä¸€ç³»åˆ—è¡Œã€‚</p>
</li>
<li><p>åœ¨DELETEè¯­å¥ä¸­ï¼ŒåŒä¸€åˆ†åŒºé”®ä¸­çš„æ‰€æœ‰åˆ é™¤éƒ½ä»¥åŸå­æ–¹å¼å•ç‹¬åº”ç”¨ã€‚</p>
</li>
<li><p>DELETEæ“ä½œå¯ä»¥é€šè¿‡ä½¿ç”¨IFå­å¥æ¥æ¡ä»¶åŒ–ï¼Œç±»ä¼¼äºUPDATEå’ŒINSERTè¯­å¥ã€‚ä½†æ˜¯ï¼Œä¸INSERTå’ŒUPDATEè¯­å¥ä¸€æ ·ï¼Œè¿™å°†å¯¼è‡´ä¸å¯å¿½ç•¥çš„æ€§èƒ½æˆæœ¬ï¼ˆå†…éƒ¨ï¼Œå°†ä½¿ç”¨Paxosï¼‰ï¼Œå› æ­¤åº”è°¨æ…ä½¿ç”¨ã€‚</p>
</li>
</ol>
<h2 id="æ‰¹å¤„ç†"><a href="#æ‰¹å¤„ç†" class="headerlink" title="æ‰¹å¤„ç†"></a>æ‰¹å¤„ç†</h2><blockquote>
<p>æ‰¹å¤„ç†åªå…è®¸åŒ…å«UPDATEï¼ŒINSERTå’ŒDELETEè¯­å¥ã€‚</p>
<p>æ‰¹å¤„ç†èŠ‚çœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œèµ„æºæ¶ˆè€—ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">batch_statement        ::=  BEGIN [ UNLOGGED | COUNTER ] BATCH</span><br><span class="line">                            [ USING update_parameter ( AND update_parameter )* ]</span><br><span class="line">                            modification_statement ( &#x27;;&#x27; modification_statement )*</span><br><span class="line">                            APPLY BATCH</span><br><span class="line">modification_statement ::=  insert_statement | update_statement | delete_statement</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BEGIN BATCH</span><br><span class="line">   INSERT INTO users (userid, password, name) VALUES (&#x27;user2&#x27;, &#x27;ch@ngem3b&#x27;, &#x27;second user&#x27;);</span><br><span class="line">   UPDATE users SET password = &#x27;ps22dhds&#x27; WHERE userid = &#x27;user3&#x27;;</span><br><span class="line">   INSERT INTO users (userid, password) VALUES (&#x27;user4&#x27;, &#x27;ch@ngem3c&#x27;);</span><br><span class="line">   DELETE name FROM users WHERE userid = &#x27;user1&#x27;;</span><br><span class="line">APPLY BATCH;</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡è¯·æ³¨æ„</p>
<ol>
<li>å±äºç»™å®šåˆ†åŒºé”®çš„BATCHä¸­çš„æ‰€æœ‰æ›´æ–°éƒ½æ˜¯å•ç‹¬æ‰§è¡Œçš„ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰¹å¤„ç†ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æŒ‰è®°å½•æ‰§è¡Œï¼Œä»¥ç¡®ä¿æ‰€æœ‰å˜æ›´éƒ½æœ€ç»ˆå®Œæˆï¼ˆæˆ–ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€‚ç±»ä¼¼äºSQLäº‹åŠ¡ï¼Œä½†ä¸å®Œå…¨ç­‰åŒäºSQLäº‹åŠ¡ã€‚</li>
</ol>
<h3 id="UNLOGGED-batches"><a href="#UNLOGGED-batches" class="headerlink" title="UNLOGGED batches"></a>UNLOGGED batches</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCassandraä½¿ç”¨æ‰¹å¤„ç†æ—¥å¿—æ¥ç¡®ä¿æ‰€æœ‰å˜æ›´éƒ½æœ€ç»ˆå®Œæˆï¼ˆæˆ–ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€è¯·æ³¨æ„ï¼Œæ“ä½œä»…åœ¨å•ä¸ªåˆ†åŒºä¸­éš”ç¦»ã€‘ã€‚</p>
<p>æ‰¹å¤„ç†è·¨è¶Šå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ‰¹å¤„ç†åœ¨æ€§èƒ½ä¸Šä¼šæœ‰æ‰€æŸå¤±ã€‚å¯ä»¥ä½¿ç”¨UNLOGGEDé€‰é¡¹æ¥è·³è¿‡æ‰¹å¤„ç†æ—¥å¿—ï¼Œä¸è¿‡ï¼Œå¦‚æœæ‰¹å¤„ç†å¤±è´¥ï¼Œå¯èƒ½ä¼šé€ æˆæ‰¹å¤„ç†ä¸­çš„ä»»åŠ¡éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥ï¼Œè¯·è°¨æ…é€‰æ‹©ã€‚</p>
<h3 id="COUNTER-batches"><a href="#COUNTER-batches" class="headerlink" title="COUNTER batches"></a>COUNTER batches</h3><p>ä½¿ç”¨COUNTERé€‰é¡¹è¿›è¡Œæ‰¹é‡è®¡æ•°å™¨æ›´æ–°ã€‚</p>
<p>ä¸Cassandraä¸­çš„å…¶ä»–æ›´æ–°ä¸åŒï¼Œè®¡æ•°å™¨æ›´æ–°ä¸æ˜¯å¹‚ç­‰çš„ã€‚</p>
<h1 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h1><p><a href="http://cassandra.apache.org/doc/latest/">Apache Cassandra Documentation</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Cassandra</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8æ–°ç‰¹æ€§ä¸€è§ˆè¡¨</title>
    <url>/p/55630/</url>
    <content><![CDATA[<h1 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h1><ul>
<li>forEach() method in Iterable interface(Iterableæ¥å£ä¸­çš„forEach()æ–¹æ³•)</li>
<li>default and static methods in Interfaces(æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•)</li>
<li>Functional Interfaces and Lambda Expressions(functionæ¥å£å’ŒLambdaè¡¨è¾¾å¼)</li>
<li>Java Stream API for Bulk Data Operations on Collections(ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java Stream API)</li>
<li>Java Time API</li>
<li>Collection API improvements</li>
<li>Concurrency API improvements</li>
<li>Java IO improvements</li>
</ul>
<span id="more"></span>

<h1 id="1-forEach-method-in-Iterable-interface-Iterableæ¥å£ä¸­çš„forEach-æ–¹æ³•"><a href="#1-forEach-method-in-Iterable-interface-Iterableæ¥å£ä¸­çš„forEach-æ–¹æ³•" class="headerlink" title="1.forEach() method in Iterable interface(Iterableæ¥å£ä¸­çš„forEach()æ–¹æ³•)"></a>1.forEach() method in Iterable interface(Iterableæ¥å£ä¸­çš„forEach()æ–¹æ³•)</h1><p>æ¯å½“æˆ‘ä»¬éœ€è¦éå†Collectionæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªIteratorï¼Œå…¶ç›®çš„æ˜¯è¿­ä»£ï¼Œç„¶åæˆ‘ä»¬åœ¨å¾ªç¯ä¸­ä¸ºCollectionä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ConcurrentModificationExceptionã€‚</p>
<p>Java 8åœ¨java.lang.Iterableæ¥å£ä¸­å¼•å…¥äº†forEachæ–¹æ³•ï¼Œè¿™æ ·åœ¨ç¼–å†™ä»£ç æ—¶æˆ‘ä»¬åªå…³æ³¨ä¸šåŠ¡é€»è¾‘ã€‚ forEachæ–¹æ³•å°†java.util.function.Consumerå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå› æ­¤å®ƒæœ‰åŠ©äºå°†æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨æˆ‘ä»¬å¯ä»¥é‡ç”¨çš„å•ç‹¬ä½ç½®ã€‚è®©æˆ‘ä»¬é€šè¿‡ç®€å•çš„ä¾‹å­çœ‹çœ‹æ¯ä¸ªç”¨æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;IntegermyList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) myList.add(i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨iterator</span></span><br><span class="line">Iterator&lt;Integeriterator = myList.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">    Integer next = iterator.next();</span><br><span class="line">    System.out.println(<span class="string">&quot;Iterator Value::&quot;</span> + next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//foreach + åŒ¿åç±»</span></span><br><span class="line">myList.forEach(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer t)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;forEach anonymous class Value::&quot;</span>+t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨consumer æ¥å£</span></span><br><span class="line">MyConsumer action = <span class="keyword">new</span> MyConsumer();</span><br><span class="line">myList.forEach(action);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨lambdaè¡¨è¾¾å¼</span></span><br><span class="line">myList.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h1 id="2-default-and-static-methods-in-Interfaces-æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•"><a href="#2-default-and-static-methods-in-Interfaces-æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•" class="headerlink" title="2.default and static methods in Interfaces(æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•)"></a>2.default and static methods in Interfaces(æ¥å£ä¸­çš„é»˜è®¤å’Œé™æ€æ–¹æ³•)</h1><p>jdk8ä¹‹å‰ï¼Œinterfaceæ–¹æ³•ä¸èƒ½æœ‰å®ç°ï¼Œä½†æ˜¯ä»Java 8å¼€å§‹ï¼Œæ¥å£è¢«å¢å¼ºä¸ºå…·æœ‰å®ç°æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨defaultå’Œstaticå…³é”®å­—æ¥åˆ›å»ºå…·æœ‰æ–¹æ³•å®ç°çš„æ¥å£ã€‚ä¾‹å¦‚Iterableæ¥å£ä¸­çš„forEachæ–¹æ³•å®ç°æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> Taction)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">    <span class="keyword">for</span> (T t : <span class="keyword">this</span>) &#123;</span><br><span class="line">        action.accept(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>åˆ›å»ºä¸€ä¸ªæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">showA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ¥å£é»˜è®¤æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ¥å£é™æ€æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºè¯¥æ¥å£å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> <span class="keyword">implements</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å®ç°æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é»˜è®¤æ–¹æ³•æ”¯æŒé‡å†™,ä¸è¦†ç›–åˆ™æ‰§è¡Œæ¥å£çš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘è¦†ç›–äº†æ¥å£çš„é»˜è®¤æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™æ€æ–¹æ³•ä¸å¯ä»¥é‡å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyClass myClass = <span class="keyword">new</span> MyClass();</span><br><span class="line">        myClass.show();</span><br><span class="line">        myClass.showA();</span><br><span class="line">        <span class="comment">//é€šè¿‡ç±»å.æ–¹æ³•åè°ƒç”¨æ¥å£é™æ€æ–¹æ³•</span></span><br><span class="line">        MyInterface.showB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-Functional-Interfaces-and-Lambda-Expressionsï¼ˆfunctionæ¥å£å’ŒLambdaè¡¨è¾¾å¼ï¼‰"><a href="#3-Functional-Interfaces-and-Lambda-Expressionsï¼ˆfunctionæ¥å£å’ŒLambdaè¡¨è¾¾å¼ï¼‰" class="headerlink" title="3.Functional Interfaces and Lambda Expressionsï¼ˆfunctionæ¥å£å’ŒLambdaè¡¨è¾¾å¼ï¼‰"></a>3.Functional Interfaces and Lambda Expressionsï¼ˆfunctionæ¥å£å’ŒLambdaè¡¨è¾¾å¼ï¼‰</h1><p>å¦‚æœä½ æ³¨æ„åˆ°ä¸Šé¢çš„æ¥å£ä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ°@FunctionalInterfaceæ³¨é‡Šã€‚åŠŸèƒ½æ¥å£æ˜¯Java 8ä¸­å¼•å…¥çš„æ–°æ¦‚å¿µã€‚<strong>åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å°±å˜æˆäº†åŠŸèƒ½æ¥å£</strong>ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨@FunctionalInterfaceæ³¨é‡Šå°†æ¥å£æ ‡è®°ä¸ºåŠŸèƒ½æ¥å£ã€‚ @FunctionalInterfaceæ³¨é‡Šæ˜¯ä¸€ç§é¿å…åœ¨åŠŸèƒ½ç•Œé¢ä¸­æ„å¤–æ·»åŠ æŠ½è±¡æ–¹æ³•çš„å·¥å…·ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸º@Overrideæ³¨é‡Šï¼Œå¹¶ä¸”æœ€ä½³å®è·µæ˜¯ä½¿ç”¨å®ƒã€‚å®ä¾‹ï¼šjava8 çš„runnable runæ¥å£ï¼Œå¸¦æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½æ¥å£çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥å®ä¾‹åŒ–å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ¿åç±»å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£ï¼Œä½†ä»£ç çœ‹èµ·æ¥å¾ˆç¬¨é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨åŒ¿åç±»å®ä¾‹åŒ–</span></span><br><span class="line">Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;My Runnable&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”±äºåŠŸèƒ½æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤lambdaè¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°æä¾›æ–¹æ³•å®ç°ã€‚æˆ‘ä»¬åªéœ€è¦æä¾›æ–¹æ³•å‚æ•°å’Œä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼å°†ä¸Šé¢çš„å®ç°ç¼–å†™ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨lambdaè¡¨è¾¾å¼</span></span><br><span class="line">Runnable runnable1 = () -System.out.println(<span class="string">&quot;My Runnable&quot;</span>);</span><br><span class="line">runnable.run();</span><br><span class="line">runnable1.run();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨æ–¹æ³•å®ç°ä¸­æœ‰å•ä¸ªè¯­å¥ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦èŠ±æ‹¬å·ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„Interface1åŒ¿åç±»å¯ä»¥ä½¿ç”¨lambdaå®ä¾‹åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Interface1 interface1 = (s) -System.out.println(s);</span><br><span class="line">interface1.method1(<span class="string">&quot;interface1 method&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="lambdaè¡¨è¾¾å¼æ‰©å±•"><a href="#lambdaè¡¨è¾¾å¼æ‰©å±•" class="headerlink" title="lambdaè¡¨è¾¾å¼æ‰©å±•"></a>lambdaè¡¨è¾¾å¼æ‰©å±•</h2><h3 id="Java-ä¸­çš„-Lambda-è¡¨è¾¾å¼é€šå¸¸ä½¿ç”¨-argument-body-è¯­æ³•ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š"><a href="#Java-ä¸­çš„-Lambda-è¡¨è¾¾å¼é€šå¸¸ä½¿ç”¨-argument-body-è¯­æ³•ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š" class="headerlink" title="Java ä¸­çš„ Lambda è¡¨è¾¾å¼é€šå¸¸ä½¿ç”¨ (argument) -(body) è¯­æ³•ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š"></a>Java ä¸­çš„ Lambda è¡¨è¾¾å¼é€šå¸¸ä½¿ç”¨ (argument) -(body) è¯­æ³•ä¹¦å†™ï¼Œä¾‹å¦‚ï¼š</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(arg1, arg2...) -&gt; &#123; body &#125;</span><br><span class="line">(type1 arg1, type2 arg2...) -&gt; &#123; body &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lambda-è¡¨è¾¾å¼çš„ç»“æ„"><a href="#Lambda-è¡¨è¾¾å¼çš„ç»“æ„" class="headerlink" title="Lambda è¡¨è¾¾å¼çš„ç»“æ„"></a>Lambda è¡¨è¾¾å¼çš„ç»“æ„</h3><ul>
<li>ä¸€ä¸ªLambdaè¡¨è¾¾å¼å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°</li>
<li>å‚æ•°çš„ç±»å‹æ—¢å¯ä»¥æ˜ç¡®å£°æ˜ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡æ¥æ¨æ–­ã€‚ä¾‹å¦‚ï¼š<code>(int a)</code>ä¸<code>(a)</code>æ•ˆæœç›¸åŒ</li>
<li>æ‰€æœ‰å‚æ•°éœ€åŒ…å«åœ¨åœ†æ‹¬å·å†…ï¼Œå‚æ•°ä¹‹é—´ç”¨é€—å·ç›¸éš”ã€‚ä¾‹å¦‚ï¼š<code>(a, b)</code> æˆ– <code>(int a, int b)</code> æˆ– <code>(String a, int b, float c)</code></li>
<li>ç©ºåœ†æ‹¬å·ä»£è¡¨å‚æ•°é›†ä¸ºç©ºã€‚ä¾‹å¦‚ï¼š<code>() -&gt; 42</code></li>
<li>å½“åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸”å…¶ç±»å‹å¯æ¨å¯¼æ—¶ï¼Œåœ†æ‹¬å·ï¼ˆï¼‰å¯çœç•¥ã€‚ä¾‹å¦‚ï¼š<code>a -&gt; return a * a</code></li>
<li>Lambdaè¡¨è¾¾å¼çš„ä¸»ä½“å¯åŒ…å«é›¶æ¡æˆ–å¤šæ¡è¯­å¥</li>
<li>å¦‚æœLambdaè¡¨è¾¾å¼çš„ä¸»ä½“åªæœ‰ä¸€æ¡è¯­å¥ï¼ŒèŠ±æ‹¬å·{}å¯çœç•¥ã€‚åŒ¿åå‡½æ•°çš„è¿”å›ç±»å‹ä¸è¯¥ä¸»ä½“è¡¨è¾¾å¼ä¸€è‡´</li>
<li>å¦‚æœLambdaè¡¨è¾¾å¼çš„ä¸»ä½“åŒ…å«ä¸€æ¡ä»¥ä¸Šè¯­å¥ï¼Œåˆ™è¡¨è¾¾å¼å¿…é¡»åŒ…å«åœ¨èŠ±æ‹¬å·{}ä¸­ï¼ˆå½¢æˆä»£ç å—ï¼‰ã€‚åŒ¿åå‡½æ•°çš„è¿”å›ç±»å‹ä¸ä»£ç å—çš„è¿”å›ç±»å‹ä¸€è‡´ï¼Œè‹¥æ²¡æœ‰è¿”å›åˆ™ä¸ºç©º</li>
</ul>
<h2 id="å‡½æ•°å¼æ¥å£æ‰©å±•"><a href="#å‡½æ•°å¼æ¥å£æ‰©å±•" class="headerlink" title="å‡½æ•°å¼æ¥å£æ‰©å±•"></a>å‡½æ•°å¼æ¥å£æ‰©å±•</h2><p>å‡½æ•°å¼æ¥å£æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜çš„æ¥å£,å¯ä»¥ä½¿ç”¨<code>@FunctionalInterface</code>æ ‡è®°</p>
<h3 id="JDK8ä¹‹å‰å·²æœ‰çš„å‡½æ•°å¼æ¥å£"><a href="#JDK8ä¹‹å‰å·²æœ‰çš„å‡½æ•°å¼æ¥å£" class="headerlink" title="JDK8ä¹‹å‰å·²æœ‰çš„å‡½æ•°å¼æ¥å£"></a>JDK8ä¹‹å‰å·²æœ‰çš„å‡½æ•°å¼æ¥å£</h3><ul>
<li>java.lang.Runnable</li>
<li>java.util.concurrent.Callable</li>
<li>java.security.PrivilegedAction</li>
<li>java.util.Comparator</li>
<li>java.io.FileFilter</li>
<li>java.nio.file.PathMatcher</li>
<li>java.lang.reflect.InvocationHandler</li>
<li>java.beans.PropertyChangeListener</li>
<li>java.awt.event.ActionListener</li>
<li>javax.swing.event.ChangeListener</li>
</ul>
<h3 id="æ–°å®šä¹‰çš„å‡½æ•°å¼æ¥å£"><a href="#æ–°å®šä¹‰çš„å‡½æ•°å¼æ¥å£" class="headerlink" title="æ–°å®šä¹‰çš„å‡½æ•°å¼æ¥å£"></a>æ–°å®šä¹‰çš„å‡½æ•°å¼æ¥å£</h3><p>java.util.functionä¸­å®šä¹‰äº†å‡ ç»„ç±»å‹çš„å‡½æ•°å¼æ¥å£ä»¥åŠé’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å­æ¥å£ã€‚</p>
<ul>
<li>Predicate:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªboolç»“æœï¼Œæ–¹æ³•ä¸ºboolean test(T t)</li>
<li>Consumer:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ— è¿”å›å€¼ï¼Œçº¯æ¶ˆè´¹ã€‚æ–¹æ³•ä¸ºvoid accept(T t)</li>
<li>Function:ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸ºR apply(T t)</li>
<li>Supplier:æ— å‚æ•°ä¼ å…¥ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸ºT get()</li>
<li>UnaryOperator:ä¸€å…ƒæ“ä½œç¬¦ï¼Œç»§æ‰¿Function,ä¼ å…¥å‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒã€‚</li>
<li>BinaryOperator:äºŒå…ƒæ“ä½œç¬¦ï¼Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒï¼Œç»§æ‰¿BiFunctionã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Predicate&lt;Integer&gt; predicate = (i) -&gt; i &gt; <span class="number">0</span>;</span><br><span class="line">Consumer&lt;Integer&gt; consumer = (i) -&gt; System.out.println(<span class="string">&quot;consumer : &quot;</span> + i);</span><br><span class="line">Function&lt;Integer,Boolean&gt; function = (i) -&gt; i &gt; <span class="number">0</span>;</span><br><span class="line">Supplier&lt;Integer&gt; supplier = () -&gt; <span class="number">1</span>;</span><br><span class="line">UnaryOperator&lt;Integer&gt; unaryOperator = (i) -&gt; i * i;</span><br><span class="line">BinaryOperator&lt;Integer&gt; binaryOperator = (i1,i2) -&gt; i1 * i2;</span><br><span class="line"></span><br><span class="line">System.out.println(predicate.test(<span class="number">10</span>));</span><br><span class="line">consumer.accept(<span class="number">10</span>);</span><br><span class="line">System.out.println(function.apply(<span class="number">10</span>));</span><br><span class="line">System.out.println(supplier.get());</span><br><span class="line">System.out.println(unaryOperator.apply(<span class="number">100</span>));</span><br><span class="line">System.out.println(binaryOperator.apply(<span class="number">100</span>,<span class="number">200</span>));</span><br></pre></td></tr></table></figure>

<h1 id="4-Java-Stream-API-for-Bulk-Data-Operations-on-Collections-ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java-Stream-API"><a href="#4-Java-Stream-API-for-Bulk-Data-Operations-on-Collections-ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java-Stream-API" class="headerlink" title="4.Java Stream API for Bulk Data Operations on Collections(ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java Stream API)"></a>4.Java Stream API for Bulk Data Operations on Collections(ç”¨äºé›†åˆä¸Šçš„æ‰¹é‡æ•°æ®æ“ä½œçš„Java Stream API)</h1><h2 id="ç¤ºä¾‹ä»£ç -1"><a href="#ç¤ºä¾‹ä»£ç -1" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä» Collection å’Œæ•°ç»„</span></span><br><span class="line">List&lt;Integerlist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br><span class="line">Stream&lt;Integerstream = list.stream(); <span class="comment">//ä¸²è¡Œæµ</span></span><br><span class="line">Stream&lt;Integerstream1 = list.parallelStream(); <span class="comment">//å¹¶è¡Œæµ</span></span><br><span class="line">Stream&lt;Integerstream2 = Arrays.stream(list.toArray(<span class="keyword">new</span> Integer[<span class="number">0</span>]));</span><br><span class="line">Stream&lt;Integerstream3 = Stream.of(list.toArray(<span class="keyword">new</span> Integer[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä» BufferedReader</span></span><br><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(<span class="string">&quot;path&quot;</span>)));</span><br><span class="line">Stream&lt;Stringstream4 = bufferedReader.lines();</span><br><span class="line"></span><br><span class="line"><span class="comment">//é™æ€å·¥å‚</span></span><br><span class="line">IntStream stream5 = IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>);<span class="comment">//ç”Ÿæˆ1-100 çš„int stream</span></span><br><span class="line">Stream&lt;Pathstream6 = Files.walk(Paths.get(<span class="string">&quot;path&quot;</span>), <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå·±æ„å»º é€šè¿‡StreamSupportè¾…åŠ©ç±»ä»spliteratoräº§ç”Ÿæµ</span></span><br><span class="line">Stream&lt;Integerstream7 = StreamSupport.stream(list.spliterator(), <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¶å®ƒ</span></span><br><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line">IntStream stream8 = random.ints();</span><br><span class="line"></span><br><span class="line">BitSet bitSet = BitSet.valueOf(<span class="keyword">new</span> <span class="keyword">long</span>[]&#123;<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>&#125;);</span><br><span class="line">IntStream stream9 = bitSet.stream();</span><br><span class="line"></span><br><span class="line">Pattern pattern = Pattern.compile(<span class="string">&quot;\\d+&quot;</span>);</span><br><span class="line">Stream&lt;Stringstream10 = pattern.splitAsStream(<span class="string">&quot;111sda123sda&quot;</span>);</span><br><span class="line"></span><br><span class="line">JarFile jarFile = <span class="keyword">new</span> JarFile(<span class="string">&quot;xxx.jar&quot;</span>);</span><br><span class="line">Stream&lt;JarEntrystream11 = jarFile.stream();</span><br></pre></td></tr></table></figure>

<h1 id="5-Java-Time-API-Javaæ—¶é—´API"><a href="#5-Java-Time-API-Javaæ—¶é—´API" class="headerlink" title="5.Java Time API(Javaæ—¶é—´API)"></a>5.Java Time API(Javaæ—¶é—´API)</h1><p>Java 8é€šè¿‡å‘å¸ƒæ–°çš„Date-Time API (JSR 310)æ¥è¿›ä¸€æ­¥åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚å¯¹æ—¥æœŸä¸æ—¶é—´çš„æ“ä½œä¸€ç›´æ˜¯Javaç¨‹åºå‘˜æœ€ç—›è‹¦çš„åœ°æ–¹ä¹‹ä¸€ã€‚æ ‡å‡†çš„ java.util.Dateä»¥åŠåæ¥çš„java.util.Calendarä¸€ç‚¹æ²¡æœ‰æ”¹å–„è¿™ç§æƒ…å†µï¼ˆå¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®ƒä»¬ä¸€å®šç¨‹åº¦ä¸Šæ›´åŠ å¤æ‚ï¼‰ã€‚</p>
<h2 id="Clockç±»"><a href="#Clockç±»" class="headerlink" title="Clockç±»"></a>Clockç±»</h2><p>å®ƒé€šè¿‡æŒ‡å®šä¸€ä¸ªæ—¶åŒºï¼Œç„¶åå°±å¯ä»¥è·å–åˆ°å½“å‰çš„æ—¶åˆ»ï¼Œæ—¥æœŸä¸æ—¶é—´ã€‚Clockå¯ä»¥æ›¿æ¢System.currentTimeMillis()ä¸TimeZone.getDefault()ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get the system clock as UTC offset </span></span><br><span class="line"><span class="keyword">final</span> Clock clock = Clock.systemUTC();</span><br><span class="line">System.out.println(clock.instant());</span><br><span class="line">System.out.println(clock.millis());</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡º:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T14:<span class="number">52</span>:<span class="number">50.</span>111Z</span><br><span class="line"><span class="number">1547045570335</span></span><br></pre></td></tr></table></figure>

<h2 id="LocaleDateä¸LocalTime"><a href="#LocaleDateä¸LocalTime" class="headerlink" title="LocaleDateä¸LocalTime"></a>LocaleDateä¸LocalTime</h2><p>LocaleDateåªæŒæœ‰ISO-8601æ ¼å¼ä¸”æ— æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸéƒ¨åˆ†ã€‚ç›¸åº”çš„ï¼ŒLocaleTimeåªæŒæœ‰ISO-8601æ ¼å¼ä¸”æ— æ—¶åŒºä¿¡æ¯çš„æ—¶é—´éƒ¨åˆ†ã€‚LocaleDateä¸LocalTimeéƒ½å¯ä»¥ä»Clockä¸­å¾—åˆ°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get the local date and local time</span></span><br><span class="line"><span class="keyword">final</span> LocalDate date = LocalDate.now();</span><br><span class="line"><span class="keyword">final</span> LocalDate dateFromClock = LocalDate.now(clock);</span><br><span class="line"></span><br><span class="line">System.out.println(date);</span><br><span class="line">System.out.println(dateFromClock);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the local date and local time</span></span><br><span class="line"><span class="keyword">final</span> LocalTime time = LocalTime.now();</span><br><span class="line"><span class="keyword">final</span> LocalTime timeFromClock = LocalTime.now(clock);</span><br><span class="line"></span><br><span class="line">System.out.println(time);</span><br><span class="line">System.out.println(timeFromClock);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09</span><br><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09</span><br><span class="line"><span class="number">22</span>:<span class="number">52</span>:<span class="number">50.383</span></span><br><span class="line"><span class="number">14</span>:<span class="number">52</span>:<span class="number">50.383</span></span><br></pre></td></tr></table></figure>

<h2 id="LocaleDateTime"><a href="#LocaleDateTime" class="headerlink" title="LocaleDateTime"></a>LocaleDateTime</h2><p>LocaleDateTimeæŠŠLocaleDateä¸LocaleTimeçš„åŠŸèƒ½åˆå¹¶èµ·æ¥ï¼Œå®ƒæŒæœ‰çš„æ˜¯ISO-8601æ ¼å¼æ— æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸä¸æ—¶é—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get the local date/time</span></span><br><span class="line"><span class="keyword">final</span> LocalDateTime datetime = LocalDateTime.now();</span><br><span class="line"><span class="keyword">final</span> LocalDateTime datetimeFromClock = LocalDateTime.now(clock);</span><br><span class="line"></span><br><span class="line">System.out.println(datetime);</span><br><span class="line">System.out.println(datetimeFromClock);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡º:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T22:<span class="number">55</span>:<span class="number">05.194</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T14:<span class="number">55</span>:<span class="number">05.194</span></span><br></pre></td></tr></table></figure>

<h2 id="ZonedDateTime"><a href="#ZonedDateTime" class="headerlink" title="ZonedDateTime"></a>ZonedDateTime</h2><p>å¦‚æœä½ éœ€è¦ç‰¹å®šæ—¶åŒºçš„æ—¥æœŸ/æ—¶é—´ï¼Œé‚£ä¹ˆZonedDateTimeæ˜¯ä½ çš„é€‰æ‹©ã€‚å®ƒæŒæœ‰ISO-8601æ ¼å¼å…·å…·æœ‰æ—¶åŒºä¿¡æ¯çš„æ—¥æœŸä¸æ—¶é—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get the zoned date/time</span></span><br><span class="line"><span class="keyword">final</span> ZonedDateTime zonedDatetime = ZonedDateTime.now();</span><br><span class="line"><span class="keyword">final</span> ZonedDateTime zonedDatetimeFromClock = ZonedDateTime.now(clock);</span><br><span class="line"><span class="keyword">final</span> ZonedDateTime zonedDatetimeFromZone = ZonedDateTime.now(ZoneId.of(<span class="string">&quot;America/Los_Angeles&quot;</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(zonedDatetime);</span><br><span class="line">System.out.println(zonedDatetimeFromClock);</span><br><span class="line">System.out.println(zonedDatetimeFromZone);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T22:<span class="number">56</span>:<span class="number">34.033</span>+08:<span class="number">00</span>[Asia/Shanghai]</span><br><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T14:<span class="number">56</span>:<span class="number">34.</span>033Z</span><br><span class="line"><span class="number">2019</span>-<span class="number">01</span>-09T06:<span class="number">56</span>:<span class="number">34.035</span>-08:<span class="number">00</span>[America/Los_Angeles]</span><br></pre></td></tr></table></figure>

<h2 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h2><p>åœ¨ç§’ä¸çº³ç§’çº§åˆ«ä¸Šçš„ä¸€æ®µæ—¶é—´ã€‚Durationä½¿è®¡ç®—ä¸¤ä¸ªæ—¥æœŸé—´çš„ä¸åŒå˜çš„ååˆ†ç®€å•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get duration between two dates</span></span><br><span class="line"><span class="keyword">final</span> LocalDateTime from = LocalDateTime.of(<span class="number">2018</span>, Month.APRIL, <span class="number">16</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">final</span> LocalDateTime to = LocalDateTime.of(<span class="number">2019</span>, Month.APRIL, <span class="number">16</span>, <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Duration duration = Duration.between(from, to);</span><br><span class="line">System.out.println(<span class="string">&quot;Duration in days: &quot;</span> + duration.toDays());</span><br><span class="line">System.out.println(<span class="string">&quot;Duration in hours: &quot;</span> + duration.toHours());</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­è®¡ç®—äº†ä¸¤ä¸ªæ—¥æœŸ2018å¹´4æœˆ16å·ä¸2019å¹´4æœˆ16å·ä¹‹é—´çš„è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯ç¨‹åºåœ¨æ§åˆ¶å°ä¸Šçš„è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Duration in days: <span class="number">365</span></span><br><span class="line">Duration in hours: <span class="number">8783</span></span><br></pre></td></tr></table></figure>

<h1 id="Collection-API-improvements-é›†åˆAPIæ”¹è¿›"><a href="#Collection-API-improvements-é›†åˆAPIæ”¹è¿›" class="headerlink" title="Collection API improvements(é›†åˆAPIæ”¹è¿›)"></a>Collection API improvements(é›†åˆAPIæ”¹è¿›)</h1><p>ä¸Šé¢å·²ç»å±•ç¤ºäº†forEach()æ–¹æ³•å’ŒStream APIåœ¨é›†åˆä¸Šçš„ä½¿ç”¨ã€‚java8çš„Collection APIä¸­æ·»åŠ äº†ä¸€äº›æ–°æ–¹æ³•ï¼š</p>
<h2 id="Iterator-default-method-forEachRemaining-Consumer-action"><a href="#Iterator-default-method-forEachRemaining-Consumer-action" class="headerlink" title="Iterator default method forEachRemaining(Consumer action)"></a>Iterator default method forEachRemaining(Consumer action)</h2><p>ä¸ºæ¯ä¸ªå…ƒç´ æ‰§è¡Œç»™å®šæ“ä½œï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½å·²å¤„ç†æˆ–æ“ä½œå¼•å‘å¼‚å¸¸ã€‚</p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> E&gt; action)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//ä¼ å…¥ä¸€ä¸ªéç©ºæ¶ˆè´¹è€…</span></span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">	<span class="comment">//éå†æ‰§è¡Œæ¶ˆè´¹è€…å‡½æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (hasNext())</span><br><span class="line">        action.accept(next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹ä»£ç -2"><a href="#ç¤ºä¾‹ä»£ç -2" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line">Iterator&lt;Integer&gt; iterator = list.iterator();</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line">Consumer&lt;Integer&gt; consumer = i -&gt; System.out.println(<span class="string">&quot;consumer print &quot;</span> + i);</span><br><span class="line"><span class="comment">//iteratorçš„forEachRemainingå°†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ¶ˆè´¹</span></span><br><span class="line">iterator.forEachRemaining(consumer);</span><br></pre></td></tr></table></figure>

<h3 id="æ§åˆ¶å°è¾“å‡º"><a href="#æ§åˆ¶å°è¾“å‡º" class="headerlink" title="æ§åˆ¶å°è¾“å‡º"></a>æ§åˆ¶å°è¾“å‡º</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">consumer print <span class="number">1</span></span><br><span class="line">consumer print <span class="number">2</span></span><br><span class="line">consumer print <span class="number">3</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Collection-default-method-removeIf-Predicate-filter"><a href="#Collection-default-method-removeIf-Predicate-filter" class="headerlink" title="Collection default method removeIf(Predicate filter)"></a>Collection default method removeIf(Predicate filter)</h2><p>åˆ é™¤æ»¡è¶³ç»™å®šæ¡ä»¶çš„æ­¤é›†åˆçš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<h3 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">removeIf</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> E&gt; filter)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//ä¼ å…¥ä¸€ä¸ªéç©ºè°“è¯­</span></span><br><span class="line">    Objects.requireNonNull(filter);</span><br><span class="line">    <span class="keyword">boolean</span> removed = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">final</span> Iterator&lt;E&gt; each = iterator();</span><br><span class="line">    <span class="keyword">while</span> (each.hasNext()) &#123;</span><br><span class="line">		<span class="comment">//éå†å…ƒç´ ï¼Œæ‰§è¡Œè°“è¯­çš„æ ¡éªŒï¼Œå¦‚æœä¸ºçœŸï¼Œåˆ™åˆ é™¤è¯¥å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (filter.test(each.next())) &#123;</span><br><span class="line">            each.remove();</span><br><span class="line">            removed = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> removed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹ä»£ç -3"><a href="#ç¤ºä¾‹ä»£ç -3" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">list.add(<span class="number">4</span>);</span><br><span class="line">Predicate&lt;Integer&gt; predicate = i -&gt; i &gt; <span class="number">1</span>;</span><br><span class="line">list.removeIf(predicate);</span><br><span class="line">System.out.println(<span class="string">&quot;remove if left items : &quot;</span> + list);</span><br></pre></td></tr></table></figure>

<h3 id="æ§åˆ¶å°è¾“å‡º-1"><a href="#æ§åˆ¶å°è¾“å‡º-1" class="headerlink" title="æ§åˆ¶å°è¾“å‡º"></a>æ§åˆ¶å°è¾“å‡º</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//2,3,4æ»¡è¶³æ¡ä»¶è¢«åˆ é™¤äº†</span></span><br><span class="line">remove <span class="keyword">if</span> left items : [<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Collection-spliterator"><a href="#Collection-spliterator" class="headerlink" title="Collection spliterator()"></a>Collection spliterator()</h2><p>è¿”å›Spliteratorå®ä¾‹çš„æ–¹æ³•ï¼Œè¯¥å®ä¾‹å¯ç”¨äºé¡ºåºæˆ–å¹¶è¡Œéå†å…ƒç´ ã€‚</p>
<h3 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯¥æ–¹æ³•æ˜¯æ¥å£é»˜è®¤æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> Spliterator&lt;E&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Spliterators.spliterator(<span class="keyword">this</span>, Spliterator.ORDERED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹ä»£ç -4"><a href="#ç¤ºä¾‹ä»£ç -4" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line">Spliterator&lt;Integer&gt; spliterator = list.spliterator();</span><br><span class="line"><span class="comment">//åˆ›å»ºé¡ºåºæµ</span></span><br><span class="line">Stream&lt;Integer&gt; stream = StreamSupport.stream(spliterator, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºå¹¶è¡Œæµ</span></span><br><span class="line">Stream&lt;Integer&gt; parallelStream = StreamSupport.stream(spliterator, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Map-replaceAll-compute-merge-methods"><a href="#Map-replaceAll-compute-merge-methods" class="headerlink" title="Map replaceAll(), compute(), merge() methods"></a>Map replaceAll(), compute(), merge() methods</h2><h3 id="replaceAll"><a href="#replaceAll" class="headerlink" title="replaceAll()"></a>replaceAll()</h3><p>æ›¿æ¢Mapä¸­æ‰€æœ‰Entryçš„valueå€¼ï¼Œè¿™ä¸ªå€¼ç”±æ—§çš„keyå’Œvalueè®¡ç®—å¾—å‡ºï¼Œæ¥æ”¶å‚æ•° (K, V) -&gt; V</p>
<h4 id="æºç -3"><a href="#æºç -3" class="headerlink" title="æºç "></a>æºç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; function)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab;</span><br><span class="line">    <span class="keyword">if</span> (function == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span> &amp;&amp; (tab = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> mc = modCount;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">				<span class="comment">//ä½¿ç”¨ç»™å®šçš„å‡½æ•°æ›¿æ¢åŸæ¥çš„valueå€¼ï¼Œkeyä¸å˜</span></span><br><span class="line">                e.value = function.apply(e.key, e.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (modCount != mc)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¤ºä¾‹ä»£ç -5"><a href="#ç¤ºä¾‹ä»£ç -5" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;5&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line"><span class="comment">//replaceAllæ–¹æ³•</span></span><br><span class="line">map.replaceAll((s, s2) -&gt; s + s2);</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>

<h4 id="æ§åˆ¶å°è¾“å‡º-2"><a href="#æ§åˆ¶å°è¾“å‡º-2" class="headerlink" title="æ§åˆ¶å°è¾“å‡º"></a>æ§åˆ¶å°è¾“å‡º</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸæ¥çš„valueç”±key + valueæ›¿æ¢æ‰äº†</span></span><br><span class="line">&#123;<span class="number">1</span>=1A, <span class="number">2</span>=2B, <span class="number">3</span>=3C, <span class="number">4</span>=<span class="number">4D</span>, <span class="number">5</span>=5E&#125;</span><br></pre></td></tr></table></figure>

<h3 id="compute"><a href="#compute" class="headerlink" title="compute()"></a>compute()</h3><p>æ˜¯<code>computeIfPresent</code>å’Œ<code>computeIfAbsent</code>æ–¹æ³•çš„ç»„åˆä½“</p>
<ul>
<li>computeIfPresent:å¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡æŒ‡å®šçš„K -&gt; Vè®¡ç®—å‡ºæ–°çš„å€¼è®¾ç½®ä¸ºkeyçš„å€¼ã€‚</li>
<li>computeIfPresent:å¦‚æœæŒ‡å®šçš„keyå­˜åœ¨ï¼Œåˆ™æ ¹æ®æ—§çš„keyå’Œvalueè®¡ç®—æ–°çš„å€¼newValue, å¦‚æœnewValueä¸ä¸ºnullï¼Œåˆ™è®¾ç½®keyæ–°çš„å€¼ä¸ºnewValue, å¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyçš„å€¼ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹ä»£ç -6"><a href="#ç¤ºä¾‹ä»£ç -6" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;5&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line"><span class="comment">//keyå­˜åœ¨ï¼Œæ ¹æ®æ—§çš„keyå’Œvalueè®¡ç®—æ–°çš„å€¼newValue</span></span><br><span class="line">map.compute(<span class="string">&quot;1&quot;</span>, (k, v) -&gt; v + <span class="string">&quot; computed&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;keyå­˜åœ¨&quot;</span> + map.get(<span class="string">&quot;1&quot;</span>));</span><br><span class="line"><span class="comment">//keyä¸å­˜åœ¨ï¼Œé€šè¿‡æŒ‡å®šçš„K -&gt; Vè®¡ç®—å‡ºæ–°çš„å€¼è®¾ç½®ä¸ºkeyçš„å€¼</span></span><br><span class="line">map.compute(<span class="string">&quot;6&quot;</span>, (k, v) -&gt; <span class="string">&quot;F&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;keyä¸å­˜åœ¨&quot;</span> + map.get(<span class="string">&quot;6&quot;</span>));</span><br><span class="line"><span class="comment">//keyå­˜åœ¨ï¼Œå¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyçš„å€¼</span></span><br><span class="line">map.compute(<span class="string">&quot;1&quot;</span>, (k, v) -&gt; <span class="keyword">null</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;keyå­˜åœ¨ï¼Œè®¾ç½®ä¸ºnull &quot;</span> + map.get(<span class="string">&quot;1&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="æ§åˆ¶å°è¾“å‡º-3"><a href="#æ§åˆ¶å°è¾“å‡º-3" class="headerlink" title="æ§åˆ¶å°è¾“å‡º"></a>æ§åˆ¶å°è¾“å‡º</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">keyå­˜åœ¨A computed</span><br><span class="line">keyä¸å­˜åœ¨F</span><br><span class="line">keyå­˜åœ¨ï¼Œè®¾ç½®ä¸º<span class="keyword">null</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<h3 id="merge"><a href="#merge" class="headerlink" title="merge()"></a>merge()</h3><p>å¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®æŒ‡å®šçš„valueå€¼ï¼Œå¦åˆ™æ ¹æ®keyçš„æ—§çš„å€¼oldvalueï¼Œvalueè®¡ç®—å‡ºæ–°çš„å€¼newValue, å¦‚æœnewValueä¸ºnull, åˆ™åˆ é™¤è¯¥keyï¼Œå¦åˆ™è®¾ç½®keyçš„æ–°å€¼newValueã€‚</p>
<h4 id="ç¤ºä¾‹ä»£ç -7"><a href="#ç¤ºä¾‹ä»£ç -7" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;5&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line"><span class="comment">//å­˜åœ¨keyä¸º1,è¾“å‡º Amerge</span></span><br><span class="line">System.out.println(map.merge(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;merge&quot;</span>, (k, v) -&gt; k + v));</span><br><span class="line"><span class="comment">//æ–°å€¼ä¸ºnullï¼Œåˆ é™¤keyï¼Œè¾“å‡º null</span></span><br><span class="line">System.out.println(map.merge(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;merge&quot;</span>, (k, v) -&gt; <span class="keyword">null</span>));</span><br><span class="line"><span class="comment">//ä¸å­˜åœ¨keyä¸º6ï¼Œè¾“å‡º &quot;merge&quot;</span></span><br><span class="line">System.out.println(map.merge(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;merge&quot;</span>, (k, v) -&gt; k + v));</span><br></pre></td></tr></table></figure>

<h4 id="æ§åˆ¶å°è¾“å‡º-4"><a href="#æ§åˆ¶å°è¾“å‡º-4" class="headerlink" title="æ§åˆ¶å°è¾“å‡º"></a>æ§åˆ¶å°è¾“å‡º</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Amerge</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">merge</span><br></pre></td></tr></table></figure>
<h2 id="Performance-Improvement-for-HashMap-class-with-Key-Collisions"><a href="#Performance-Improvement-for-HashMap-class-with-Key-Collisions" class="headerlink" title="Performance Improvement for HashMap class with Key Collisions"></a>Performance Improvement for HashMap class with Key Collisions</h2><p>å…·æœ‰é”®å†²çªçš„HashMapç±»çš„æ€§èƒ½æ”¹è¿›</p>
<h1 id="Concurrency-API-improvements-å¹¶å‘APIæ”¹è¿›"><a href="#Concurrency-API-improvements-å¹¶å‘APIæ”¹è¿›" class="headerlink" title="Concurrency API improvements(å¹¶å‘APIæ”¹è¿›)"></a>Concurrency API improvements(å¹¶å‘APIæ”¹è¿›)</h1><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p>JDK8æä¾›çš„å¹¶å‘å‹å¥½çš„HashMap</p>
<h2 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h2><p>æä¾›äº†éå¸¸å¼ºå¤§çš„ Future çš„æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œå¹¶ä¸”æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å›è°ƒçš„æ–¹å¼å¤„ç†è®¡ç®—ç»“æœï¼Œä¹Ÿæä¾›äº†è½¬æ¢å’Œç»„åˆ CompletableFuture çš„æ–¹æ³•ã€‚</p>
<h2 id="Executors-newWorkStealingPool"><a href="#Executors-newWorkStealingPool" class="headerlink" title="Executors newWorkStealingPool()"></a>Executors newWorkStealingPool()</h2><p>åˆ›å»ºæŒæœ‰è¶³å¤Ÿçº¿ç¨‹çš„çº¿ç¨‹æ± æ¥æ”¯æŒç»™å®šçš„å¹¶è¡Œçº§åˆ«ï¼Œå¹¶é€šè¿‡ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ï¼Œå‡å°‘ç«äº‰ï¼Œå®ƒéœ€è¦ä¼ ä¸€ä¸ªå¹¶è¡Œçº§åˆ«çš„å‚æ•°ï¼Œå¦‚æœä¸ä¼ ï¼Œåˆ™è¢«è®¾å®šä¸ºé»˜è®¤çš„CPUæ•°é‡ã€‚</p>
<h1 id="Java-IO-improvements-Java-IO-APIçš„æ”¹è¿›"><a href="#Java-IO-improvements-Java-IO-APIçš„æ”¹è¿›" class="headerlink" title="Java IO improvements(Java IO APIçš„æ”¹è¿›)"></a>Java IO improvements(Java IO APIçš„æ”¹è¿›)</h1><h2 id="Files-list-Path-dir"><a href="#Files-list-Path-dir" class="headerlink" title="Files.list(Path dir)"></a>Files.list(Path dir)</h2><p>è¿”å›ä¸€ä¸ªå»¶è¿Ÿå¡«å……çš„Streamï¼Œå…¶ä¸­çš„å…ƒç´ æ˜¯ç›®å½•ä¸­çš„æ¡ç›®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›ç›®å½•ä¸‹çš„å…ƒç´ é›†åˆæµ</span></span><br><span class="line">Stream&lt;Path&gt; list = Files.list(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\Administrator\\Desktop&quot;</span>).toPath());</span><br><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="Files-lines-Path-path"><a href="#Files-lines-Path-path" class="headerlink" title="Files.lines(Path path)"></a>Files.lines(Path path)</h2><p>ä»æ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰è¡Œä½œä¸ºæµã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œæ•°</span></span><br><span class="line">Stream&lt;String&gt; lines = Files.lines(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\Administrator\\Desktop\\new 3.txt&quot;</span>).toPath());</span><br><span class="line">lines.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="Files-find"><a href="#Files-find" class="headerlink" title="Files.find()"></a>Files.find()</h2><p>é€šè¿‡æœç´¢ä»¥ç»™å®šèµ·å§‹æ–‡ä»¶ä¸ºæ ¹çš„æ–‡ä»¶æ ‘ä¸­çš„æ–‡ä»¶ï¼Œè¿”å›ä½¿ç”¨Pathå»¶è¿Ÿå¡«å……çš„Streamã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›ç¬¦åˆåˆ¤æ–­æ¡ä»¶çš„Pathæµ</span></span><br><span class="line">Stream&lt;Path&gt; stream = Files.find(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\Administrator\\Desktop&quot;</span>).toPath(),</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        (path, basicFileAttributes) -&gt; basicFileAttributes.isDirectory());</span><br><span class="line">stream.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="BufferedReader-lines"><a href="#BufferedReader-lines" class="headerlink" title="BufferedReader.lines()"></a>BufferedReader.lines()</h2><p>è¿”å›ä¸€ä¸ªStreamï¼Œå…¶å…ƒç´ æ˜¯ä»è¿™ä¸ªBufferedReaderè¯»å–çš„è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œæ•°,ç±»ä¼¼Files.lines()</span></span><br><span class="line">BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;C:\\Users\\Administrator\\Desktop\\new 3.txt&quot;</span>));</span><br><span class="line">Stream&lt;String&gt; stringStream = br.lines();</span><br><span class="line">stringStream.forEach(System.out::println);</span><br></pre></td></tr></table></figure>


<h1 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h1><ul>
<li><a href="https://www.journaldev.com/2389/java-8-features-with-examples#java8-collection">Java 8 Features with Examples</a></li>
<li><a href="https://www.cnblogs.com/yangming1996/p/8031199.html">ä¸ºå¹¶å‘è€Œç”Ÿçš„ ConcurrentHashMapï¼ˆJava 8ï¼‰</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-cf-of-jdk8/index.html">é€šè¿‡å®ä¾‹ç†è§£ JDK8 çš„ CompletableFuture</a></li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jacksonä½¿ç”¨æŒ‡å—</title>
    <url>/p/56384/</url>
    <content><![CDATA[<p>ä»äº‹JAVAå¼€å‘å·¥ä½œä»¥æ¥,ä¸€ç›´éƒ½ç¦»ä¸å¼€Jacksonçš„åºåˆ—åŒ–ååºåˆ—åŒ–,å¯¹äºJacksonçš„ä½¿ç”¨ä¹Ÿä¸€ç›´å¤„äºå¤Ÿç”¨ä½†ä¸æ·±å…¥çš„çŠ¶æ€ï¼Œä¸‹é¢æ˜¯æ—¥å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­å¯¹Jacksonçš„æ€»ç»“ã€‚</p>
<span id="more"></span>

<h1 id="Jacksonå¸¸ç”¨æ³¨è§£"><a href="#Jacksonå¸¸ç”¨æ³¨è§£" class="headerlink" title="Jacksonå¸¸ç”¨æ³¨è§£"></a>Jacksonå¸¸ç”¨æ³¨è§£</h1><h2 id="åºåˆ—åŒ–æ³¨è§£"><a href="#åºåˆ—åŒ–æ³¨è§£" class="headerlink" title="åºåˆ—åŒ–æ³¨è§£"></a>åºåˆ—åŒ–æ³¨è§£</h2><h3 id="JsonAnyGetter"><a href="#JsonAnyGetter" class="headerlink" title="@JsonAnyGetter"></a>@JsonAnyGetter</h3><blockquote>
<p>åƒæ™®é€šå±æ€§ä¸€æ ·åºåˆ—åŒ–Map</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; properties;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonAnyGetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr2&quot;</span>:<span class="string">&quot;val2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr1&quot;</span>:<span class="string">&quot;val1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonGetter"><a href="#JsonGetter" class="headerlink" title="@JsonGetter"></a>@JsonGetter</h3><blockquote>
<p>å°†æŒ‡å®šçš„æ–¹æ³•æ ‡è®°ä¸º<code>getter</code>æ–¹æ³•ã€‚å¯ä»¥ç”¨æ¥ä»£æ›¿<code>@JsonProperty</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonGetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonPropertyOrder"><a href="#JsonPropertyOrder" class="headerlink" title="@JsonPropertyOrder"></a>@JsonPropertyOrder</h3><blockquote>
<p>ç”¨åœ¨ç±»ä¸Šï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™è‡ªå®šä¹‰å±æ€§è¾“å‡ºé¡ºåº</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonRawValue"><a href="#JsonRawValue" class="headerlink" title="@JsonRawValue"></a>@JsonRawValue</h3><blockquote>
<p>å®Œå…¨æŒ‰ç…§åŸæ ·åºåˆ—åŒ–å±æ€§çš„å€¼</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RawBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonRawValue</span></span><br><span class="line">    <span class="keyword">public</span> String json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RawBean bean = <span class="keyword">new</span> RawBean(<span class="string">&quot;My bean&quot;</span>, <span class="string">&quot;&#123;\&quot;attr\&quot;:false&#125;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å°†åºåˆ—åŒ–ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;json&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;attr&quot;</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä¸æ˜¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;json&quot;</span>:<span class="string">&quot;&#123;\&quot;attr\&quot;:false&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonValue"><a href="#JsonValue" class="headerlink" title="@JsonValue"></a>@JsonValue</h3><blockquote>
<p>å®šä¹‰æ•´ä¸ªå®ä½“çš„åºåˆ—åŒ–æ–¹æ³•ï¼ŒJacksonå°†ä¼šä½¿ç”¨è¯¥æ–¹æ³•çš„è¾“å‡ºä½œä¸ºåºåˆ—åŒ–è¾“å‡ºã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">TypeEnumWithValue</span> </span>&#123;</span><br><span class="line">    TYPE1(<span class="number">1</span>, <span class="string">&quot;Type A&quot;</span>), TYPE2(<span class="number">2</span>, <span class="string">&quot;Type 2&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// standard constructors</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Type 2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonRootName"><a href="#JsonRootName" class="headerlink" title="@JsonRootName"></a>@JsonRootName</h3><blockquote>
<p>å¦‚æœéœ€è¦å°†å®ä½“åŒ…è£…ä¸€å±‚ï¼Œå¯ä»¥ä½¿ç”¨<code>@JsonRootName</code>æ¥æŒ‡å®šæ ¹åŒ…è£…å™¨çš„åç§°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonRootName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸ç”¨è¯¥æ³¨è§£ï¼Œå°†ä¼šåºåˆ—åŒ–ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonSerialize"><a href="#JsonSerialize" class="headerlink" title="@JsonSerialize"></a>@JsonSerialize</h3><blockquote>
<p>ç”¨äºæŒ‡å®šè‡ªå®šä¹‰åºåˆ—åŒ–å™¨æ¥åºåˆ—åŒ–å®ä½“</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonSerialize(using = CustomDateSerializer.class)</span></span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDateSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SimpleDateFormat formatter </span><br><span class="line">      = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyyy hh:mm:ss&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateSerializer</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateSerializer</span><span class="params">(Class&lt;Date&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t); </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      Date value, JsonGenerator gen, SerializerProvider arg2)</span> </span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</span><br><span class="line">        gen.writeString(formatter.format(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;eventDate&quot;</span>: <span class="string">&quot;20-12-2014 02:30:00&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ååºåˆ—åŒ–æ³¨è§£"><a href="#ååºåˆ—åŒ–æ³¨è§£" class="headerlink" title="ååºåˆ—åŒ–æ³¨è§£"></a>ååºåˆ—åŒ–æ³¨è§£</h2><h3 id="JsonCreator"><a href="#JsonCreator" class="headerlink" title="@JsonCreator"></a>@JsonCreator</h3><blockquote>
<p>æŒ‡å®šååºåˆ—åŒ–ä½¿ç”¨çš„æ„é€ å‡½æ•°æˆ–æ–¹æ³•</p>
</blockquote>
<p>å¾…ååºåˆ—åŒ–Jsonç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;theName&quot;</span>:<span class="string">&quot;My bean&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCreator</span><span class="params">(<span class="meta">@JsonProperty(&quot;id&quot;)</span> <span class="keyword">int</span> id, <span class="meta">@JsonProperty(&quot;theName&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JacksonInject"><a href="#JacksonInject" class="headerlink" title="@JacksonInject"></a>@JacksonInject</h3><blockquote>
<p>æŒ‡å®šæŸä¸ªå­—æ®µä»æ³¨å…¥èµ‹å€¼ï¼Œè€Œä¸æ˜¯ä»Json</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithInject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JacksonInject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ç”¨æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;My bean\&quot;&#125;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">InjectableValues inject = <span class="keyword">new</span> InjectableValues.Std()</span><br><span class="line">  .addValue(<span class="keyword">int</span>.class, <span class="number">1</span>);</span><br><span class="line">BeanWithInject bean = <span class="keyword">new</span> ObjectMapper().reader(inject)</span><br><span class="line">  .forType(BeanWithInject.class)</span><br><span class="line">  .readValue(json);</span><br></pre></td></tr></table></figure>

<h3 id="JsonAnySetter"><a href="#JsonAnySetter" class="headerlink" title="@JsonAnySetter"></a>@JsonAnySetter</h3><blockquote>
<p>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå°†Mapå½“æˆæ™®é€šå±æ€§</p>
</blockquote>
<p>å¾…ååºåˆ—åŒ–Jsonï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr2&quot;</span>:<span class="string">&quot;val2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr1&quot;</span>:<span class="string">&quot;val1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; properties;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonAnySetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        properties.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>properties</code>å­—æ®µçš„å€¼å°†ä¼šæ˜¯ç”± <code>attr2 -&gt; val2,attr1 -&gt; val1</code>ç»„æˆçš„é”®å€¼å¯¹ã€‚</p>
<h3 id="JsonSetter"><a href="#JsonSetter" class="headerlink" title="@JsonSetter"></a>@JsonSetter</h3><blockquote>
<p>å°†æ–¹æ³•æ ‡è®°ä¸º<code>setter</code>æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šå±æ€§åç§°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonSetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonDeserialize"><a href="#JsonDeserialize" class="headerlink" title="@JsonDeserialize"></a>@JsonDeserialize</h3><blockquote>
<p>ç”¨äºæŒ‡å®šè‡ªå®šä¹‰ååºåˆ—åŒ–å™¨æ¥ååºåˆ—åŒ–å®ä½“</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonDeserialize(using = CustomDateDeserializer.class)</span></span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ååºåˆ—åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDateDeserializer</span></span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SimpleDateFormat formatter</span><br><span class="line">      = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyyy hh:mm:ss&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateDeserializer</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomDateDeserializer</span><span class="params">(Class&lt;?&gt; vc)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">super</span>(vc); </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">deserialize</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      JsonParser jsonparser, DeserializationContext context)</span> </span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         </span><br><span class="line">        String date = jsonparser.getText();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> formatter.parse(date);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Jacksonè®¾ç½®å±æ€§æ˜¯å¦å‚ä¸åºåˆ—åŒ–"><a href="#Jacksonè®¾ç½®å±æ€§æ˜¯å¦å‚ä¸åºåˆ—åŒ–" class="headerlink" title="Jacksonè®¾ç½®å±æ€§æ˜¯å¦å‚ä¸åºåˆ—åŒ–"></a>Jacksonè®¾ç½®å±æ€§æ˜¯å¦å‚ä¸åºåˆ—åŒ–</h2><h3 id="JsonIgnoreProperties"><a href="#JsonIgnoreProperties" class="headerlink" title="@JsonIgnoreProperties"></a>@JsonIgnoreProperties</h3><blockquote>
<p>åœ¨ç±»ä¸ŠæŒ‡å®šè¦å¿½ç•¥çš„å±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIgnoreProperties(&#123; &quot;id&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithIgnore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonIgnore"><a href="#JsonIgnore" class="headerlink" title="@JsonIgnore"></a>@JsonIgnore</h3><blockquote>
<p>åœ¨å…·ä½“å±æ€§ä¸Šå¿½ç•¥ï¼Œä½¿å…¶ä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithIgnore</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸<code>@JsonIgnoreProperties</code>æ˜¯ç­‰æ•ˆçš„ã€‚</p>
<h3 id="JsonIgnoreType"><a href="#JsonIgnoreType" class="headerlink" title="@JsonIgnoreType"></a>@JsonIgnoreType</h3><blockquote>
<p>ç”¨åœ¨ç±»ä¸Šï¼Œå°†å¿½ç•¥è¯¥ç±»æ‰€æœ‰å±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonIgnoreType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String firstName;</span><br><span class="line">        <span class="keyword">public</span> String lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonInclude"><a href="#JsonInclude" class="headerlink" title="@JsonInclude"></a>@JsonInclude</h3><blockquote>
<p>ç”¨äºæ’é™¤å€¼ä¸º<code>empty/null/default</code>çš„å±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonAutoDetect"><a href="#JsonAutoDetect" class="headerlink" title="@JsonAutoDetect"></a>@JsonAutoDetect</h3><blockquote>
<p>å¼ºåˆ¶åºåˆ—åŒ–ç§æœ‰å±æ€§ï¼Œä¸ç®¡å®ƒæœ‰æ²¡æœ‰<code>getter</code>æ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonAutoDetect(fieldVisibility = Visibility.ANY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Jacksonå¤„ç†å¤šæ€"><a href="#Jacksonå¤„ç†å¤šæ€" class="headerlink" title="Jacksonå¤„ç†å¤šæ€"></a>Jacksonå¤„ç†å¤šæ€</h2><p>ä¸€èˆ¬éƒ½æ˜¯ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œæœ‰ä¸‹é¢ä¸‰ä¸ªæ³¨è§£ï¼š</p>
<ul>
<li>@JsonTypeInfo<blockquote>
<p>æŒ‡å®šåºåˆ—åŒ–ä¸­åŒ…å«çš„ç±»å‹ä¿¡æ¯çš„è¯¦ç»†ä¿¡æ¯</p>
</blockquote>
</li>
<li>@JsonSubTypes<blockquote>
<p>æŒ‡å®šå¸¦æ³¨é‡Šç±»å‹çš„å­ç±»å‹</p>
</blockquote>
</li>
<li>@JsonTypeName<blockquote>
<p>æŒ‡å®šç”¨äºå¸¦æ³¨é‡Šçš„ç±»çš„é€»è¾‘ç±»å‹åç§°</p>
</blockquote>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonTypeInfo(</span></span><br><span class="line"><span class="meta">      use = JsonTypeInfo.Id.NAME, </span></span><br><span class="line"><span class="meta">      include = As.PROPERTY, </span></span><br><span class="line"><span class="meta">      property = &quot;type&quot;)</span></span><br><span class="line">    <span class="meta">@JsonSubTypes(&#123;</span></span><br><span class="line"><span class="meta">        @JsonSubTypes.Type(value = Dog.class, name = &quot;dog&quot;),</span></span><br><span class="line"><span class="meta">        @JsonSubTypes.Type(value = Cat.class, name = &quot;cat&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonTypeName(&quot;dog&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> barkVolume;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonTypeName(&quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> likesCream;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> lives;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒæŒ‡å®šå±æ€§<code>type</code>ä¸ºåˆ¤æ–­å…·ä½“å­ç±»çš„ä¾æ®ï¼Œä¾‹å¦‚ï¼š<code>type=dog</code>ï¼Œå°†è¢«åºåˆ—åŒ–ä¸º<code>Dog</code>ç±»å‹ã€‚</p>
<h2 id="Jacksoné€šç”¨æ³¨è§£ï¼ˆåºåˆ—åŒ–ååºåˆ—åŒ–éƒ½ç”Ÿæ•ˆï¼‰"><a href="#Jacksoné€šç”¨æ³¨è§£ï¼ˆåºåˆ—åŒ–ååºåˆ—åŒ–éƒ½ç”Ÿæ•ˆï¼‰" class="headerlink" title="Jacksoné€šç”¨æ³¨è§£ï¼ˆåºåˆ—åŒ–ååºåˆ—åŒ–éƒ½ç”Ÿæ•ˆï¼‰"></a>Jacksoné€šç”¨æ³¨è§£ï¼ˆåºåˆ—åŒ–ååºåˆ—åŒ–éƒ½ç”Ÿæ•ˆï¼‰</h2><h3 id="JsonProperty"><a href="#JsonProperty" class="headerlink" title="@JsonProperty"></a>@JsonProperty</h3><blockquote>
<p>æŒ‡å®šJSONä¸­çš„å±æ€§åç§°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonFormat"><a href="#JsonFormat" class="headerlink" title="@JsonFormat"></a>@JsonFormat</h3><blockquote>
<p>ç”¨äºåœ¨åºåˆ—åŒ–æ—¥æœŸ/æ—¶é—´å€¼æ—¶æŒ‡å®šæ ¼å¼ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonFormat(</span></span><br><span class="line"><span class="meta">      shape = JsonFormat.Shape.STRING,</span></span><br><span class="line"><span class="meta">      pattern = &quot;dd-MM-yyyy hh:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonUnwrapped"><a href="#JsonUnwrapped" class="headerlink" title="@JsonUnwrapped"></a>@JsonUnwrapped</h3><blockquote>
<p>å°†å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§ä¸å½“å‰å¹³çº§ï¼Œä¸å¤ªå¥½æè¿°ï¼Œç®€å•è¯´å°±æ˜¯æ‹†å¼€åŒ…è£…ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnwrappedUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> String firstName;</span><br><span class="line">        <span class="keyword">public</span> String lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;firstName&quot;</span>:<span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lastName&quot;</span>:<span class="string">&quot;Doe&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸åŠ <code>@JsonUnwrapped</code>æ³¨è§£ï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;firstName&quot;</span>:<span class="string">&quot;John&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lastName&quot;</span>:<span class="string">&quot;Doe&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonView"><a href="#JsonView" class="headerlink" title="@JsonView"></a>@JsonView</h3><blockquote>
<p>æŒ‡å®šè§†å›¾ï¼Œç±»ä¼¼åˆ†ç»„è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–</p>
</blockquote>
<p>å®šä¹‰è§†å›¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Views</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Public</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Internal</span> <span class="keyword">extends</span> <span class="title">Public</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonView(Views.Internal.class)</span></span><br><span class="line">    <span class="keyword">public</span> String ownerName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">  .writerWithView(Views.Public.class)</span><br><span class="line">  .writeValueAsString(item);</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶ï¼Œå°†åªä¼šåºåˆ—åŒ–<code>id</code>å’Œ<code>itemName</code>å­—æ®µ</p>
<h3 id="JsonManagedReference-JsonBackReference"><a href="#JsonManagedReference-JsonBackReference" class="headerlink" title="@JsonManagedReference, @JsonBackReference"></a>@JsonManagedReference, @JsonBackReference</h3><blockquote>
<p>@JsonManagedReferenceå’Œ@JsonBackReferenceæ³¨é‡Šç”¨äºå¤„ç†çˆ¶/å­å…³ç³»å¹¶è§£å†³å¾ªç¯é—®é¢˜ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ªç›¸äº’å¼•ç”¨çš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonManagedReference</span></span><br><span class="line">    <span class="keyword">public</span> UserWithRef owner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonBackReference</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; userItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸åŠ æ³¨è§£ï¼Œä¼šå¾ªç¯è°ƒç”¨ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>@JsonManagedReference</code>å’Œ<code>@JsonBackReference</code>æ¥é¿å…å†…å­˜æº¢å‡ºã€‚</p>
<h3 id="JsonIdentityInfo"><a href="#JsonIdentityInfo" class="headerlink" title="@JsonIdentityInfo"></a>@JsonIdentityInfo</h3><blockquote>
<p>ç”¨äºæŒ‡å®šåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–å€¼æ—¶ä½¿ç”¨å¯¹è±¡æ ‡è¯†ï¼Œä¾‹å¦‚ï¼Œå¤„ç†æ— é™é€’å½’ç±»å‹çš„é—®é¢˜ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIdentityInfo(</span></span><br><span class="line"><span class="meta">  generator = ObjectIdGenerators.PropertyGenerator.class,</span></span><br><span class="line"><span class="meta">  property = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line">    <span class="keyword">public</span> UserWithIdentity owner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JsonFilter"><a href="#JsonFilter" class="headerlink" title="@JsonFilter"></a>@JsonFilter</h3><blockquote>
<p>æŒ‡å®šåºåˆ—åŒ–æœŸé—´è¦ä½¿ç”¨çš„è¿‡æ»¤å™¨ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonFilter(&quot;myFilter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BeanWithFilter bean = <span class="keyword">new</span> BeanWithFilter(<span class="number">1</span>, <span class="string">&quot;My bean&quot;</span>);</span><br><span class="line"></span><br><span class="line">FilterProvider filters </span><br><span class="line">  = <span class="keyword">new</span> SimpleFilterProvider().addFilter(</span><br><span class="line">    <span class="string">&quot;myFilter&quot;</span>, </span><br><span class="line">    SimpleBeanPropertyFilter.filterOutAllExcept(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"></span><br><span class="line">String result = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">  .writer(filters)</span><br><span class="line">  .writeValueAsString(bean);</span><br></pre></td></tr></table></figure>

<h2 id="è‡ªå®šä¹‰Jacksonæ³¨è§£"><a href="#è‡ªå®šä¹‰Jacksonæ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰Jacksonæ³¨è§£"></a>è‡ªå®šä¹‰Jacksonæ³¨è§£</h2><p>å¯ä»¥ä½¿ç”¨@JacksonAnnotationsInsideæ¥å¼€å‘è‡ªå®šä¹‰æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line">    <span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line">    <span class="meta">@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot;, &quot;dateCreated&quot; &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> CustomAnnotation &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CustomAnnotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCustomAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> Date dateCreated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æ³¨è§£å¯ä»¥<strong>å¢å¼ºä»£ç å¤ç”¨</strong>ï¼ŒæŠŠä¸€äº›é€šç”¨çš„Jacksonæ³¨è§£ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°æ³¨è§£ï¼Œæ–°æ³¨è§£å¯ä»¥ä»£æ›¿ç»„åˆçš„æ³¨è§£ã€‚</p>
<h2 id="Jackson-MixIn-æ³¨è§£"><a href="#Jackson-MixIn-æ³¨è§£" class="headerlink" title="Jackson MixIn æ³¨è§£"></a>Jackson MixIn æ³¨è§£</h2><blockquote>
<p>åŠ¨æ€åœ°ä¸ºæŸäº›ç±»å‹å¢åŠ ç»Ÿä¸€çš„Jacksonæ³¨è§£</p>
</blockquote>
<p>å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String itemName;</span><br><span class="line">    <span class="keyword">public</span> User owner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MixInç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixInForIgnoreType</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°è®©<code>User</code>ç±»å‹ä¸å‚ä¸åºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Item item = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">&quot;book&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">mapper.addMixIn(User.class, MyMixInForIgnoreType.class);</span><br><span class="line">result = mapper.writeValueAsString(item);</span><br></pre></td></tr></table></figure>

<h2 id="ç¦ç”¨Jacksonæ³¨è§£"><a href="#ç¦ç”¨Jacksonæ³¨è§£" class="headerlink" title="ç¦ç”¨Jacksonæ³¨è§£"></a>ç¦ç”¨Jacksonæ³¨è§£</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦Jacksonæ³¨è§£çš„å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123; &quot;name&quot;, &quot;id&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç¦ç”¨è¯¥å®ä½“ä¸Šçš„æ‰€æœ‰Jacksonæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MyBean bean = <span class="keyword">new</span> MyBean(<span class="number">1</span>, <span class="keyword">null</span>);</span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">mapper.disable(MapperFeature.USE_ANNOTATIONS);</span><br></pre></td></tr></table></figure>

<h1 id="Jacksonçš„ObjectMapperç”¨æ³•"><a href="#Jacksonçš„ObjectMapperç”¨æ³•" class="headerlink" title="Jacksonçš„ObjectMapperç”¨æ³•"></a>Jacksonçš„<code>ObjectMapper</code>ç”¨æ³•</h1><h2 id="javaç±»-è½¬æ¢ä¸º-json"><a href="#javaç±»-è½¬æ¢ä¸º-json" class="headerlink" title="javaç±» è½¬æ¢ä¸º json"></a>javaç±» è½¬æ¢ä¸º json</h2><p>å¯ä»¥ç›´æ¥åºåˆ—åŒ–ä¸ºJsonå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.writeValueAsString(car);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¯ä»¥åºåˆ—åŒ–åˆ°æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯Jsonå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.writeValue(<span class="keyword">new</span> File(<span class="string">&quot;target/car.json&quot;</span>), car);</span><br></pre></td></tr></table></figure>

<h2 id="json-è½¬æ¢ä¸º-javaç±»"><a href="#json-è½¬æ¢ä¸º-javaç±»" class="headerlink" title="json è½¬æ¢ä¸º javaç±»"></a>json è½¬æ¢ä¸º javaç±»</h2><p>ä»å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">&quot;&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;&quot;</span>;</span><br><span class="line">objectMapper.readValue(json, Car.class); </span><br></pre></td></tr></table></figure>

<p>ä»æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.readValue(<span class="keyword">new</span> File(<span class="string">&quot;target/json_car.json&quot;</span>), Car.class);</span><br></pre></td></tr></table></figure>

<p>ä»URLï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.readValue(<span class="keyword">new</span> URL(<span class="string">&quot;target/json_car.json&quot;</span>), Car.class);</span><br></pre></td></tr></table></figure>

<h2 id="jsonè½¬æ¢ä¸ºJackson-JsonNode"><a href="#jsonè½¬æ¢ä¸ºJackson-JsonNode" class="headerlink" title="jsonè½¬æ¢ä¸ºJackson JsonNode"></a>jsonè½¬æ¢ä¸ºJackson JsonNode</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">&quot;&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;&quot;</span>;</span><br><span class="line">JsonNode jsonNode = objectMapper.readTree(json);</span><br><span class="line">String color = jsonNode.get(<span class="string">&quot;color&quot;</span>).asText();</span><br><span class="line"><span class="comment">// Output: color -&gt; Black</span></span><br></pre></td></tr></table></figure>

<h2 id="json-è½¬æ¢ä¸º-javaé›†åˆ"><a href="#json-è½¬æ¢ä¸º-javaé›†åˆ" class="headerlink" title="json è½¬æ¢ä¸º javaé›†åˆ"></a>json è½¬æ¢ä¸º javaé›†åˆ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = </span><br><span class="line">  <span class="string">&quot;[&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;, &#123; \&quot;color\&quot; : \&quot;Red\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;]&quot;</span>;</span><br><span class="line">List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="json-è½¬æ¢ä¸º-Map"><a href="#json-è½¬æ¢ä¸º-Map" class="headerlink" title="json è½¬æ¢ä¸º Map"></a>json è½¬æ¢ä¸º Map</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String json = <span class="string">&quot;&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;&quot;</span>;</span><br><span class="line">Map&lt;String, Object&gt; map = objectMapper.readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String,Object&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ObjectMapperçš„å¸¸ç”¨é…ç½®"><a href="#ObjectMapperçš„å¸¸ç”¨é…ç½®" class="headerlink" title="ObjectMapperçš„å¸¸ç”¨é…ç½®"></a><code>ObjectMapper</code>çš„å¸¸ç”¨é…ç½®</h2><p>å¿½ç•¥ä¸è¯†åˆ«çš„å­—æ®µï¼ˆjsonå±æ€§ä¸ç›®æ ‡å®ä½“å­˜åœ¨å±æ€§ä¸Šçš„å·®å¼‚ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>å…è®¸åŸå§‹å€¼ä¸ºnullï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>å…è®¸å°†æšä¸¾åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸ºæ•°å­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®è‡ªå®šä¹‰åºåˆ—åŒ–-ååºåˆ—åŒ–å™¨"><a href="#é…ç½®è‡ªå®šä¹‰åºåˆ—åŒ–-ååºåˆ—åŒ–å™¨" class="headerlink" title="é…ç½®è‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨"></a>é…ç½®è‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨</h2><p>å‡è®¾æœ‰ä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">(Class&lt;Car&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      Car car, JsonGenerator jsonGenerator, SerializerProvider serializer)</span> </span>&#123;</span><br><span class="line">        jsonGenerator.writeStartObject();</span><br><span class="line">        jsonGenerator.writeStringField(<span class="string">&quot;car_brand&quot;</span>, car.getType());</span><br><span class="line">        jsonGenerator.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarDeserializer</span> <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">(Class&lt;?&gt; vc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(vc);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">deserialize</span><span class="params">(JsonParser parser, DeserializationContext deserializer)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        ObjectCodec codec = parser.getCodec();</span><br><span class="line">        JsonNode node = codec.readTree(parser);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// try catch block</span></span><br><span class="line">        JsonNode colorNode = node.get(<span class="string">&quot;color&quot;</span>);</span><br><span class="line">        String color = colorNode.asText();</span><br><span class="line">        car.setColor(color);</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>ObjectMapper</code>ä½¿ç”¨ä»–ä»¬ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="keyword">module</span>.addSerializer(Car.class, <span class="keyword">new</span> CustomCarSerializer());</span><br><span class="line"><span class="comment">//æ·»åŠ è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="keyword">module</span>.addDeserializer(Car.class, <span class="keyword">new</span> CustomCarDeserializer());</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†æ—¥æœŸæ ¼å¼åŒ–"><a href="#å¤„ç†æ—¥æœŸæ ¼å¼åŒ–" class="headerlink" title="å¤„ç†æ—¥æœŸæ ¼å¼åŒ–"></a>å¤„ç†æ—¥æœŸæ ¼å¼åŒ–</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm a z&quot;</span>);</span><br><span class="line">objectMapper.setDateFormat(df);</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†é›†åˆ"><a href="#å¤„ç†é›†åˆ" class="headerlink" title="å¤„ç†é›†åˆ"></a>å¤„ç†é›†åˆ</h2><p>ååºåˆ—åŒ–ä¸ºæ•°ç»„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = </span><br><span class="line">  <span class="string">&quot;[&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;, &#123; \&quot;color\&quot; : \&quot;Red\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;]&quot;</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, <span class="keyword">true</span>);</span><br><span class="line">Car[] cars = objectMapper.readValue(jsonCarArray, Car[].class);</span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–ä¸ºé›†åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = </span><br><span class="line">  <span class="string">&quot;[&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;, &#123; \&quot;color\&quot; : \&quot;Red\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;]&quot;</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="ObjectMapperçš„åŸºæœ¬ç”¨æ³•"><a href="#ObjectMapperçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="ObjectMapperçš„åŸºæœ¬ç”¨æ³•"></a><code>ObjectMapper</code>çš„åŸºæœ¬ç”¨æ³•</h1><h2 id="ObjectMapperå¯ä»¥é€šè¿‡configureæ–¹æ³•è®¾ç½®å…¨å±€åºåˆ—åŒ–-ååºåˆ—åŒ–è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š"><a href="#ObjectMapperå¯ä»¥é€šè¿‡configureæ–¹æ³•è®¾ç½®å…¨å±€åºåˆ—åŒ–-ååºåˆ—åŒ–è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š" class="headerlink" title="ObjectMapperå¯ä»¥é€šè¿‡configureæ–¹æ³•è®¾ç½®å…¨å±€åºåˆ—åŒ–/ååºåˆ—åŒ–è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š"></a><code>ObjectMapper</code>å¯ä»¥é€šè¿‡<code>configure</code>æ–¹æ³•è®¾ç½®å…¨å±€åºåˆ—åŒ–/ååºåˆ—åŒ–è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„ä¸€äº›è®¾ç½®ï¼š</p>
<ol>
<li><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code>ï¼šå¿½ç•¥ä¸è¯†åˆ«çš„å­—æ®µ</li>
<li><code>DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES</code>ï¼šå…è®¸ä½¿ç”¨å±æ€§çš„é»˜è®¤å€¼è¿›è¡Œååºåˆ—åŒ–</li>
<li><code>DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS</code>ï¼šå…è®¸å°†æšä¸¾å€¼åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸ºæ•°å­—</li>
</ol>
<h2 id="æ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–-ååºåˆ—åŒ–ç¨‹åº"><a href="#æ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–-ååºåˆ—åŒ–ç¨‹åº" class="headerlink" title="æ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–ç¨‹åº"></a>æ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–ç¨‹åº</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ¨¡å—</span></span><br><span class="line">SimpleModule <span class="keyword">module</span> = <span class="keyword">new</span> SimpleModule(<span class="string">&quot;CustomCarSerializer&quot;</span>, <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line"><span class="comment">//å°†è‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–ç¨‹åºæ³¨å†Œåˆ°æ¨¡å—</span></span><br><span class="line"><span class="keyword">module</span>.addSerializer(Car.class, <span class="keyword">new</span> CustomCarSerializer());</span><br><span class="line"><span class="comment">//module.addDeserializer(Car.class, new CustomCarDeserializer());</span></span><br><span class="line"><span class="comment">//æ³¨å†Œæ¨¡å—</span></span><br><span class="line">mapper.registerModule(<span class="keyword">module</span>);</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†æ—¥æœŸæ ¼å¼"><a href="#å¤„ç†æ—¥æœŸæ ¼å¼" class="headerlink" title="å¤„ç†æ—¥æœŸæ ¼å¼"></a>å¤„ç†æ—¥æœŸæ ¼å¼</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm a z&quot;</span>);</span><br><span class="line">mapper.setDateFormat(df);</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†é›†åˆ-1"><a href="#å¤„ç†é›†åˆ-1" class="headerlink" title="å¤„ç†é›†åˆ"></a>å¤„ç†é›†åˆ</h2><h3 id="å¤„ç†æ•°ç»„"><a href="#å¤„ç†æ•°ç»„" class="headerlink" title="å¤„ç†æ•°ç»„"></a>å¤„ç†æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = <span class="string">&quot;[&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;, &#123; \&quot;color\&quot; : \&quot;Red\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;]&quot;</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, <span class="keyword">true</span>);</span><br><span class="line">Car[] cars = objectMapper.readValue(jsonCarArray, Car[].class);</span><br></pre></td></tr></table></figure>

<h3 id="å¤„ç†é›†åˆ-2"><a href="#å¤„ç†é›†åˆ-2" class="headerlink" title="å¤„ç†é›†åˆ"></a>å¤„ç†é›†åˆ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonCarArray = <span class="string">&quot;[&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;, &#123; \&quot;color\&quot; : \&quot;Red\&quot;, \&quot;type\&quot; : \&quot;FIAT\&quot; &#125;]&quot;</span>;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">List&lt;Car&gt; listCar = objectMapper.readValue(jsonCarArray, <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Jacksonæ³¨è§£æ‰©å±•"><a href="#Jacksonæ³¨è§£æ‰©å±•" class="headerlink" title="Jacksonæ³¨è§£æ‰©å±•"></a>Jacksonæ³¨è§£æ‰©å±•</h1><h2 id="JsonIdentityReference"><a href="#JsonIdentityReference" class="headerlink" title="@JsonIdentityReference"></a>@JsonIdentityReference</h2><blockquote>
<p>ä½¿ç”¨æŒ‡å®šçš„æ ‡è¯†æ¥åºåˆ—åŒ–Javaå¯¹è±¡ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)</span></span><br><span class="line"><span class="meta">@JsonIdentityReference(alwaysAsId = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithoutIdentityReference</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†è¢«åºåˆ—åŒ–ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="JsonAppend"><a href="#JsonAppend" class="headerlink" title="@JsonAppend"></a>@JsonAppend</h2><blockquote>
<p>è¿è¡Œåœ¨åºåˆ—åŒ–æ—¶æ·»åŠ é¢å¤–çš„å±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonAppend(attrs = &#123; </span></span><br><span class="line"><span class="meta">  @JsonAppend.Attr(value = &quot;version&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithAppend</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// constructor, getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–æ—¶æ‰‹åŠ¨å¢åŠ <code>version = 1.0</code>çš„å±æ€§</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BeanWithAppend bean = <span class="keyword">new</span> BeanWithAppend(<span class="number">2</span>, <span class="string">&quot;Bean With Append Annotation&quot;</span>);</span><br><span class="line">ObjectWriter writer = mapper.writerFor(BeanWithAppend.class).withAttribute(<span class="string">&quot;version&quot;</span>, <span class="string">&quot;1.0&quot;</span>);</span><br><span class="line">String jsonString = writer.writeValueAsString(bean);</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Bean With Append Annotation&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JsonNaming"><a href="#JsonNaming" class="headerlink" title="@JsonNaming"></a>@JsonNaming</h2><blockquote>
<p>æŒ‡å®šåºåˆ—åŒ–çš„æ—¶å€™å±æ€§å‘½åæ–¹å¼</p>
</blockquote>
<p>æœ‰å››ç§é€‰é¡¹ï¼š</p>
<ul>
<li><code>KEBAB_CASE</code><blockquote>
<p>ç”±è¿å­—ç¬¦åˆ†å‰²ï¼Œä¾‹å¦‚ï¼škebab-case</p>
</blockquote>
</li>
<li><code>LOWER_CASE</code><blockquote>
<p>æ‰€æœ‰çš„å­—æ¯éƒ½è½¬æ¢ä¸ºå°å†™ï¼Œä¾‹å¦‚ï¼šlowercase</p>
</blockquote>
</li>
<li><code>SNAKE_CASE</code><blockquote>
<p>æ‰€æœ‰çš„å­—æ¯éƒ½è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶ä¸”ç”±ä¸‹åˆ’çº¿åˆ†å‰²ï¼Œä¾‹å¦‚ï¼šsnake_case</p>
</blockquote>
</li>
<li><code>UPPER_CAMEL_CASE</code><blockquote>
<p>æ‰€æœ‰åç§°å…ƒç´ ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œåè·Ÿå°å†™å­—æ¯ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ï¼šUpperCamelCase</p>
</blockquote>
</li>
</ul>
<p>ä½¿ç”¨ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonNaming(PropertyNamingStrategy.SnakeCaseStrategy.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NamingBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JsonPropertyDescription"><a href="#JsonPropertyDescription" class="headerlink" title="@JsonPropertyDescription"></a><code>@JsonPropertyDescription</code></h2><blockquote>
<p>ç”¨äºç”Ÿæˆå­—æ®µçš„æè¿°ä¿¡æ¯</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢ä¸€ä¸ªå®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyDescriptionBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;This is a description of the name property&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è¾“å‡ºè¯¥ç±»çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SchemaFactoryWrapper wrapper = <span class="keyword">new</span> SchemaFactoryWrapper();</span><br><span class="line">mapper.acceptJsonFormatVisitor(PropertyDescriptionBean.class, wrapper);</span><br><span class="line">JsonSchema jsonSchema = wrapper.finalSchema();</span><br><span class="line">String jsonString = mapper.writeValueAsString(jsonSchema);</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;urn:jsonschema:com:baeldung:jackson:annotation:extra:PropertyDescriptionBean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;This is a description of the name property&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line"> </span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JsonPOJOBuilder"><a href="#JsonPOJOBuilder" class="headerlink" title="@JsonPOJOBuilder"></a>@JsonPOJOBuilder</h2><blockquote>
<p>è‡ªå®šä¹‰ç”Ÿæˆå™¨ç±»ï¼Œæ¥æ§åˆ¶jsonçš„ååºåˆ—åŒ–è¡Œä¸º</p>
</blockquote>
<p><code>@JsonPOJOBuilder</code>æœ‰ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li><code>buildMethodName</code><blockquote>
<p>å°†JSONå­—æ®µç»‘å®šåˆ°beançš„å±æ€§åï¼Œç”¨äºå®ä¾‹åŒ–é¢„æœŸbeançš„æ— å‚æ„é€ çš„åç§°ã€‚é»˜è®¤åç§°ä¸º<code>build</code>ã€‚</p>
</blockquote>
</li>
<li><code>withPrefix</code><blockquote>
<p>ç”¨äºè‡ªåŠ¨æ£€æµ‹JSONå’Œbeanå±æ€§ä¹‹é—´åŒ¹é…çš„åç§°å‰ç¼€ã€‚é»˜è®¤å‰ç¼€ä¸º<code>with</code>ã€‚</p>
</blockquote>
</li>
</ul>
<p>å‡è®¾æˆ‘ä»¬è¦ååºåˆ—åŒ–çš„jsonå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;POJO Builder Bean&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„pojoï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonDeserialize(builder = BeanBuilder.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">POJOBuilderBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> identity;</span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// constructor, getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ç”Ÿæˆå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonPOJOBuilder(buildMethodName = &quot;createBean&quot;, withPrefix = &quot;construct&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> idValue;</span><br><span class="line">    <span class="keyword">private</span> String nameValue;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanBuilder <span class="title">constructId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        idValue = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanBuilder <span class="title">constructName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        nameValue = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> POJOBuilderBean <span class="title">createBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> POJOBuilderBean(idValue, nameValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>ObjectMapper</code>ååºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jsonString = <span class="string">&quot;&#123;\&quot;id\&quot;:5,\&quot;name\&quot;:\&quot;POJO Builder Bean\&quot;&#125;&quot;</span>;</span><br><span class="line">POJOBuilderBean bean = mapper.readValue(jsonString, POJOBuilderBean.class);</span><br></pre></td></tr></table></figure>

<hr>
<p>ğŸ‘‰ <a href="https://github.com/gcdd1993/Jackson-Guide-With-Samples">ä»£ç ä»“åº“</a><br>ğŸ‘‰ <a href="https://www.baeldung.com/jackson">Jackson JSON Tutorial</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>jackson</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis æ•°æ®ç±»å‹åŠæ“ä½œ</title>
    <url>/p/38807/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä½œä¸ºKey-valueå‹æ•°æ®åº“ï¼ŒRedisä¹Ÿæä¾›äº†é”®ï¼ˆKeyï¼‰å’Œé”®å€¼ï¼ˆValueï¼‰çš„æ˜ å°„å…³ç³»ã€‚ä½†æ˜¯ï¼Œé™¤äº†å¸¸è§„çš„æ•°å€¼æˆ–<a href="#strings%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89">å­—ç¬¦ä¸²</a>ï¼ŒRedisçš„é”®å€¼è¿˜å¯ä»¥æ˜¯ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š<span id="more"></span></p>
<ul>
<li>[Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰ ](#Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰ )</li>
<li>[Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰ ](#Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰)</li>
<li>[Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰ ](#Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰)</li>
<li>[Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰](#Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰)</li>
</ul>
<p>é”®å€¼çš„æ•°æ®ç±»å‹å†³å®šäº†è¯¥é”®å€¼æ”¯æŒçš„æ“ä½œã€‚Redisæ”¯æŒè¯¸å¦‚åˆ—è¡¨ã€é›†åˆæˆ–æœ‰åºé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€æŸ¥é›†ç­‰é«˜çº§åŸå­æ“ä½œï¼›åŒæ—¶ï¼Œå¦‚æœé”®å€¼çš„ç±»å‹æ˜¯æ™®é€šæ•°å­—ï¼ŒRedisåˆ™æä¾›è‡ªå¢ç­‰åŸå­æ“ä½œã€‚</p>
<h1 id="stringsï¼ˆå­—ç¬¦ä¸²ï¼‰"><a href="#stringsï¼ˆå­—ç¬¦ä¸²ï¼‰" class="headerlink" title="stringsï¼ˆå­—ç¬¦ä¸²ï¼‰"></a>stringsï¼ˆå­—ç¬¦ä¸²ï¼‰</h1><blockquote>
<p>stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p>
</blockquote>
<h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><blockquote>
<p>è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name wwl</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="setnx"><a href="#setnx" class="headerlink" title="setnx"></a>setnx</h2><blockquote>
<p>è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueã€‚å¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œè¿”å›0ï¼Œnxæ˜¯not existçš„æ„æ€ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;wwl&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; setnx name HongWan_new</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºåŸæ¥nameæœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥æœ¬æ¬¡çš„ä¿®æ”¹ä¸ç”Ÿæ•ˆï¼Œä¸”è¿”å›ç æ˜¯0ã€‚</p>
<h2 id="setex"><a href="#setex" class="headerlink" title="setex"></a>setex</h2><blockquote>
<p>è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueï¼Œå¹¶æŒ‡å®šæ­¤é”®å€¼å¯¹åº”çš„æœ‰æ•ˆæœŸã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setex haircolor 10 red </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get haircolor</span><br><span class="line"><span class="string">&quot;red&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get haircolor</span><br><span class="line"><span class="string">&quot;red&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get haircolor</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p>å¯è§ç”±äºæœ€åä¸€æ¬¡çš„è°ƒç”¨æ˜¯10ç§’ä»¥åäº†ï¼Œæ‰€ä»¥å–ä¸åˆ°haicolorè¿™ä¸ªé”®å¯¹åº”çš„å€¼ã€‚</p>
<h2 id="setrange"><a href="#setrange" class="headerlink" title="setrange"></a>setrange</h2><blockquote>
<p>è®¾ç½®æŒ‡å®škeyçš„valueå€¼çš„å­å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name <span class="string">&#x27;HongWan@126.com&#x27;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan@126.com&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;  setrange name 8 gmail.com </span><br><span class="line">(<span class="built_in">integer</span>) 17</span><br><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„8æ˜¯æŒ‡ä»ä¸‹æ ‡ä¸º8ï¼ˆåŒ…å«8ï¼‰çš„å­—ç¬¦å¼€å§‹æ›¿æ¢ã€‚</p>
<h2 id="mset"><a href="#mset" class="headerlink" title="mset"></a>mset</h2><blockquote>
<p>ä¸€æ¬¡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼ŒæˆåŠŸè¿”å›okè¡¨ç¤ºæ‰€æœ‰çš„å€¼éƒ½è®¾ç½®äº†ï¼Œå¤±è´¥è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½®ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset key1 HongWan1 key2 HongWan2 </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1 </span><br><span class="line"><span class="string">&quot;HongWan1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;HongWan2&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="msetnx"><a href="#msetnx" class="headerlink" title="msetnx"></a>msetnx</h2><blockquote>
<p>ä¸€æ¬¡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼ŒæˆåŠŸè¿”å›okè¡¨ç¤ºæ‰€æœ‰çš„å€¼éƒ½è®¾ç½®äº†ï¼Œå¤±è´¥è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½®ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„keyã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">&quot;HongWan1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line"><span class="string">&quot;HongWan2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; msetnx key2 HongWan2_new key3 HongWan3</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; get key2 </span><br><span class="line"><span class="string">&quot;HongWan2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get key3</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºå¦‚æœè¿™æ¡å‘½ä»¤è¿”å›0ï¼Œé‚£ä¹ˆé‡Œé¢æ“ä½œéƒ½ä¼šå›æ»šï¼Œéƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><blockquote>
<p>è·å–keyå¯¹åº”çš„stringå€¼,å¦‚æœkeyä¸å­˜åœ¨è¿”å›nilã€‚ </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan_new&quot;</span></span><br><span class="line"><span class="comment">## æˆ‘ä»¬è·å–ä¸€ä¸ªåº“ä¸­ä¸å­˜åœ¨çš„é”®name1ï¼Œé‚£ä¹ˆå®ƒä¼šè¿”å›ä¸€ä¸ªnilä»¥è¡¨æ—¶æ— æ­¤é”®å€¼å¯¹ </span></span><br><span class="line">redis 127.0.0.1:6379&gt; get name1 </span><br><span class="line">(nil) </span><br></pre></td></tr></table></figure>

<h2 id="getset"><a href="#getset" class="headerlink" title="getset"></a>getset</h2><blockquote>
<p>è®¾ç½®keyçš„å€¼ï¼Œå¹¶è¿”å›keyçš„æ—§å€¼ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getset name HongWan_new </span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan_new&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœkeyä¸å­˜åœ¨ï¼Œå°†è¿”å›nilï¼Œå¹¶ä¼šè®¾ç½®æ–°å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; getset name1 aaa</span><br><span class="line">(nil) </span><br><span class="line">127.0.0.1:6379&gt; get name1</span><br><span class="line"><span class="string">&quot;aaa&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="getrange"><a href="#getrange" class="headerlink" title="getrange"></a>getrange</h2><blockquote>
<p>è·å–æŒ‡å®škeyçš„valueå€¼çš„å­å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name </span><br><span class="line"><span class="string">&quot;HongWan_new&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name 0 6 </span><br><span class="line"><span class="string">&quot;HongWan&quot;</span></span><br><span class="line"><span class="comment">## å­—ç¬¦ä¸²å·¦é¢ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name -7 -1</span><br><span class="line"><span class="string">&quot;Wan_new&quot;</span></span><br><span class="line"><span class="comment">## å­—ç¬¦ä¸²å³é¢ä¸‹æ ‡æ˜¯ä»-1å¼€å§‹çš„</span></span><br><span class="line">127.0.0.1:6379&gt; getrange name 7 100 </span><br><span class="line"><span class="string">&quot;_new&quot;</span></span><br><span class="line"><span class="comment">## å½“ä¸‹æ ‡è¶…å‡ºå­—ç¬¦ä¸²é•¿åº¦æ—¶ï¼Œå°†é»˜è®¤ä¸ºæ˜¯åŒæ–¹å‘çš„æœ€å¤§ä¸‹æ ‡</span></span><br></pre></td></tr></table></figure>

<h2 id="mget"><a href="#mget" class="headerlink" title="mget"></a>mget</h2><blockquote>
<p>ä¸€æ¬¡è·å–å¤šä¸ªkeyçš„å€¼ï¼Œå¦‚æœå¯¹åº”keyä¸å­˜åœ¨ï¼Œåˆ™å¯¹åº”è¿”å›nilã€‚ </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mget key1 key2 key3 </span><br><span class="line">1) <span class="string">&quot;HongWan1&quot;</span></span><br><span class="line">2) <span class="string">&quot;HongWan2&quot;</span></span><br><span class="line">3) (nil)</span><br><span class="line"><span class="comment">## key3ç”±äºæ²¡æœ‰è¿™ä¸ªé”®å®šä¹‰ï¼Œæ‰€ä»¥è¿”å›nilã€‚ </span></span><br></pre></td></tr></table></figure>

<h2 id="incr"><a href="#incr" class="headerlink" title="incr"></a>incr</h2><blockquote>
<p>å¯¹keyçš„å€¼åšåŠ åŠ æ“ä½œ,å¹¶è¿”å›æ–°çš„å€¼ã€‚æ³¨æ„incrä¸€ä¸ªä¸æ˜¯intçš„valueä¼šè¿”å›é”™è¯¯ï¼Œincrä¸€ä¸ªä¸å­˜åœ¨çš„keyï¼Œåˆ™è®¾ç½®keyä¸º1 ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incr age </span><br><span class="line">(<span class="built_in">integer</span>) 21</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;21&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="incrby"><a href="#incrby" class="headerlink" title="incrby"></a>incrby</h2><blockquote>
<p>åŒincrç±»ä¼¼ï¼ŒåŠ æŒ‡å®šå€¼ ï¼Œkeyä¸å­˜åœ¨æ—¶å€™ä¼šè®¾ç½®keyï¼Œå¹¶è®¤ä¸ºåŸæ¥çš„valueæ˜¯ 0 ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get age </span><br><span class="line"><span class="string">&quot;21&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; incrby age 5</span><br><span class="line">(<span class="built_in">integer</span>) 26</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan_new&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;26&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="decr"><a href="#decr" class="headerlink" title="decr"></a>decr</h2><blockquote>
<p>å¯¹keyçš„å€¼åšçš„æ˜¯å‡å‡æ“ä½œï¼Œdecrä¸€ä¸ªä¸å­˜åœ¨keyï¼Œåˆ™è®¾ç½®keyä¸º-1ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;26&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; decr age</span><br><span class="line">(<span class="built_in">integer</span>) 25</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;25&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="decrby"><a href="#decrby" class="headerlink" title="decrby"></a>decrby</h2><blockquote>
<p>åŒdecrï¼Œå‡æŒ‡å®šå€¼ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;25&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; decrby age 5</span><br><span class="line">(<span class="built_in">integer</span>) 20</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<p>decrbyå®Œå…¨æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡incrbyä¸€ä¸ªè´Ÿå€¼æ¥å®ç°åŒæ ·æ•ˆæœï¼Œåä¹‹ä¸€æ ·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;20&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; incrby age -5</span><br><span class="line">(<span class="built_in">integer</span>) 15</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;15&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="append"><a href="#append" class="headerlink" title="append"></a>append</h2><blockquote>
<p>ç»™æŒ‡å®škeyçš„å­—ç¬¦ä¸²å€¼è¿½åŠ value,è¿”å›æ–°å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚ </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan_new&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; append name @126.com</span><br><span class="line">(<span class="built_in">integer</span>) 19</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan_new@126.com&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="strlen"><a href="#strlen" class="headerlink" title="strlen"></a>strlen</h2><blockquote>
<p>å–æŒ‡å®škeyçš„valueå€¼çš„é•¿åº¦ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;HongWan_new@126.com&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; strlen name</span><br><span class="line">(<span class="built_in">integer</span>) 19</span><br><span class="line">127.0.0.1:6379&gt; get age</span><br><span class="line"><span class="string">&quot;15&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; strlen age</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h1 id="Lists-ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰"><a href="#Lists-ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰" class="headerlink" title="Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰"></a>Lists ï¼ˆå¯é‡å¤åˆ—è¡¨ï¼‰</h1><p>listæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œä¸»è¦åŠŸèƒ½æ˜¯pushã€popã€è·å–ä¸€ä¸ªèŒƒå›´çš„æ‰€æœ‰å€¼ç­‰ç­‰ï¼Œæ“ä½œä¸­keyç†è§£ä¸ºé“¾è¡¨çš„åå­—ã€‚</p>
<p>Redisçš„listç±»å‹å…¶å®å°±æ˜¯ä¸€ä¸ªæ¯ä¸ªå­å…ƒç´ éƒ½æ˜¯stringç±»å‹çš„åŒå‘é“¾è¡¨ã€‚é“¾è¡¨çš„æœ€å¤§é•¿åº¦æ˜¯(2^32)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡push,popæ“ä½œä»é“¾è¡¨çš„å¤´éƒ¨æˆ–è€…å°¾éƒ¨æ·»åŠ åˆ é™¤å…ƒç´ ã€‚è¿™ä½¿å¾—listæ—¢å¯ä»¥ç”¨ä½œæ ˆï¼Œä¹Ÿå¯ä»¥ç”¨ä½œé˜Ÿåˆ—ã€‚ </p>
<h2 id="lpush"><a href="#lpush" class="headerlink" title="lpush"></a>lpush</h2><blockquote>
<p>åœ¨keyå¯¹åº”listçš„å¤´éƒ¨æ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush mylist <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush mylist <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt;  lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªworldï¼Œç„¶ååœ¨worldçš„å¤´éƒ¨æ’å…¥äº†ä¸€ä¸ªhelloã€‚å…¶ä¸­lrangeæ˜¯ç”¨äºè·å–mylistçš„å†…å®¹ã€‚</p>
<h2 id="rpush"><a href="#rpush" class="headerlink" title="rpush"></a>rpush</h2><blockquote>
<p>åœ¨keyå¯¹åº”listçš„å°¾éƒ¨æ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist2 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist2 <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªhelloï¼Œç„¶ååœ¨helloçš„å°¾éƒ¨æ’å…¥äº†ä¸€ä¸ªworldã€‚</p>
<h2 id="linsert"><a href="#linsert" class="headerlink" title="linsert"></a>linsert</h2><blockquote>
<p>åœ¨keyå¯¹åº”listçš„ç‰¹å®šä½ç½®ä¹‹å‰æˆ–ä¹‹åæ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist3 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist3 <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; linsert mylist3 before <span class="string">&quot;world&quot;</span> <span class="string">&quot;there&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist3 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;there&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤å¤„æˆ‘ä»¬å…ˆæ’å…¥äº†ä¸€ä¸ªhelloï¼Œç„¶ååœ¨helloçš„å°¾éƒ¨æ’å…¥äº†ä¸€ä¸ªworldï¼Œç„¶ååˆåœ¨worldçš„å‰é¢æ’å…¥äº†thereã€‚</p>
<h2 id="lset"><a href="#lset" class="headerlink" title="lset"></a>lset</h2><blockquote>
<p>è®¾ç½®listä¸­æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ å€¼(ä¸‹æ ‡ä»0å¼€å§‹) ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist4 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist4 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist4 <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lset mylist4 0 <span class="string">&quot;four&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lset mylist4 -2 <span class="string">&quot;five&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist4 0 -1</span><br><span class="line">1) <span class="string">&quot;four&quot;</span></span><br><span class="line">2) <span class="string">&quot;five&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤å¤„æˆ‘ä»¬ä¾æ¬¡æ’å…¥äº†one,two,threeï¼Œç„¶åå°†æ ‡æ˜¯0çš„å€¼è®¾ç½®ä¸ºfourï¼Œå†å°†ä¸‹æ ‡æ˜¯-2çš„å€¼è®¾ç½®ä¸ºfiveã€‚</p>
<h2 id="lrem"><a href="#lrem" class="headerlink" title="lrem"></a>lrem</h2><blockquote>
<p>ä»keyå¯¹åº”listä¸­åˆ é™¤countä¸ªå’Œvalueç›¸åŒçš„å…ƒç´ ã€‚</p>
</blockquote>
<p>count&gt;0æ—¶ï¼ŒæŒ‰ä»å¤´åˆ°å°¾çš„é¡ºåºåˆ é™¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist5 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist5 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist5 <span class="string">&quot;foo&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist5 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrem mylist5 2 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) <span class="string">&quot;foo&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure>

<p>count&lt;0æ—¶ï¼ŒæŒ‰ä»å°¾åˆ°å¤´çš„é¡ºåºåˆ é™¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist6 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist6 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist6 <span class="string">&quot;foo&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist6 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrem mylist6 -2 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist6 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure>

<p>count=0æ—¶ï¼Œåˆ é™¤å…¨éƒ¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist7 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist7 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist7 <span class="string">&quot;foo&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist7 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrem mylist7 0 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist7 0 -1</span><br><span class="line">1) <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="ltrim"><a href="#ltrim" class="headerlink" title="ltrim"></a>ltrim</h2><blockquote>
<p>ä¿ç•™æŒ‡å®škey çš„å€¼èŒƒå›´å†…çš„æ•°æ®ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush mylist8 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist8 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist8 <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist8 <span class="string">&quot;four&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; ltrim mylist8 1 -1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist8 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;three&quot;</span></span><br><span class="line">3) <span class="string">&quot;four&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="lpop"><a href="#lpop" class="headerlink" title="lpop"></a>lpop</h2><blockquote>
<p>ä»listçš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lpop mylist</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="rpop"><a href="#rpop" class="headerlink" title="rpop"></a>rpop</h2><blockquote>
<p>ä»listçš„å°¾éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; rpop mylist2</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist2 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="rpoplpush"><a href="#rpoplpush" class="headerlink" title="rpoplpush"></a>rpoplpush</h2><blockquote>
<p>ä»ç¬¬ä¸€ä¸ªlistçš„å°¾éƒ¨ç§»é™¤å…ƒç´ å¹¶æ·»åŠ åˆ°ç¬¬äºŒä¸ªlistçš„å¤´éƒ¨,æœ€åè¿”å›è¢«ç§»é™¤çš„å…ƒç´ å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚å¦‚æœç¬¬ä¸€ä¸ªlistæ˜¯ç©ºæˆ–è€…ä¸å­˜åœ¨è¿”å›nilã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) <span class="string">&quot;foo&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist6 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;foo&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; rpoplpush mylist5 mylist6</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) <span class="string">&quot;foo&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange mylist6 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="lindex"><a href="#lindex" class="headerlink" title="lindex"></a>lindex</h2><blockquote>
<p>è¿”å›åç§°ä¸ºkeyçš„listä¸­indexä½ç½®çš„å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange mylist5 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;foo&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lindex mylist5 0</span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lindex mylist5 1</span><br><span class="line"><span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="llen"><a href="#llen" class="headerlink" title="llen"></a>llen</h2><blockquote>
<p>è¿”å›keyå¯¹åº”listçš„é•¿åº¦ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; llen mylist5</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h1 id="Sets-ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰"><a href="#Sets-ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰" class="headerlink" title="Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰"></a>Sets ï¼ˆä¸å¯é‡å¤é›†åˆï¼‰</h1><p>Redisçš„setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚setå…ƒç´ æœ€å¤§å¯ä»¥åŒ…å«(2^32)ä¸ªå…ƒç´ ã€‚</p>
<p>setçš„æ˜¯é€šè¿‡hash tableå®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ã€åˆ é™¤å’ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚hash tableä¼šéšç€æ·»åŠ æˆ–è€…åˆ é™¤è‡ªåŠ¨çš„è°ƒæ•´å¤§å°ã€‚</p>
<h2 id="sadd"><a href="#sadd" class="headerlink" title="sadd"></a>sadd</h2><blockquote>
<p>å‘åç§°ä¸ºkeyçš„setä¸­æ·»åŠ å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;world&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘mysetä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ï¼Œä½†ç”±äºç¬¬ä¸‰ä¸ªå…ƒç´ è·Ÿç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå…ƒç´ æ²¡æœ‰æ·»åŠ æˆåŠŸï¼Œæœ€åæˆ‘ä»¬ç”¨smembersæ¥æŸ¥çœ‹mysetä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<h2 id="srem"><a href="#srem" class="headerlink" title="srem"></a>srem</h2><blockquote>
<p>åˆ é™¤åç§°ä¸ºkeyçš„setä¸­çš„å…ƒç´ memberã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset2 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset2 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset2 <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; srem myset2 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; srem myset2 <span class="string">&quot;four&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘myset2ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ åï¼Œå†è°ƒç”¨sremæ¥åˆ é™¤oneå’Œfourï¼Œä½†ç”±äºå…ƒç´ ä¸­æ²¡æœ‰fouræ‰€ä»¥ï¼Œæ­¤æ¡sremå‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</p>
<h2 id="spop"><a href="#spop" class="headerlink" title="spop"></a>spop</h2><blockquote>
<p>éšæœºè¿”å›å¹¶åˆ é™¤åç§°ä¸ºkeyçš„setä¸­ä¸€ä¸ªå…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset3 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset3 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset3 <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; spop myset3</span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘myset3ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ åï¼Œå†è°ƒç”¨spopæ¥éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ°threeå…ƒç´ è¢«åˆ é™¤äº†ã€‚</p>
<h2 id="sdiff"><a href="#sdiff" class="headerlink" title="sdiff"></a>sdiff</h2><blockquote>
<p>è¿”å›æ‰€æœ‰ç»™å®škeyä¸ç¬¬ä¸€ä¸ªkeyçš„å·®é›†ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sdiff myset2 myset3</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°myset2ä¸­çš„å…ƒç´ ä¸myset3ä¸­ä¸åŒçš„åªæ˜¯threeï¼Œæ‰€ä»¥åªæœ‰threeè¢«æŸ¥å‡ºæ¥äº†ï¼Œè€Œä¸æ˜¯threeå’Œoneï¼Œå› ä¸ºoneæ˜¯myset3çš„å…ƒç´ ã€‚ </p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†myset2å’Œmyset3æ¢ä¸ªé¡ºåºæ¥çœ‹ä¸€ä¸‹ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sdiff myset3 myset2</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç»“æœä¸­åªæ˜¾ç¤ºäº†ï¼Œmyset3ä¸­çš„å…ƒç´ ä¸myset2ä¸­ä¸åŒçš„å…ƒç´ ã€‚</p>
<h2 id="sdiffstore"><a href="#sdiffstore" class="headerlink" title="sdiffstore"></a>sdiffstore</h2><p>è¿”å›æ‰€æœ‰ç»™å®škeyä¸ç¬¬ä¸€ä¸ªkeyçš„å·®é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sdiffstore myset4 myset2 myset3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers myset4</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="sinter"><a href="#sinter" class="headerlink" title="sinter"></a>sinter</h2><blockquote>
<p>è¿”å›æ‰€æœ‰ç»™å®škeyçš„äº¤é›†ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter myset2 myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„äº¤é›†twoè¢«æŸ¥å‡ºæ¥äº†ã€‚</p>
<h2 id="sinterstore"><a href="#sinterstore" class="headerlink" title="sinterstore"></a>sinterstore</h2><blockquote>
<p>è¿”å›æ‰€æœ‰ç»™å®škeyçš„äº¤é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinterstore myset5 myset2 myset3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers myset5</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„äº¤é›†è¢«ä¿å­˜åˆ°myset5ä¸­äº†ã€‚</p>
<h2 id="sunion"><a href="#sunion" class="headerlink" title="sunion"></a>sunion</h2><blockquote>
<p>è¿”å›æ‰€æœ‰ç»™å®škeyçš„å¹¶é›†ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sunion myset2 myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„å¹¶é›†è¢«æŸ¥å‡ºæ¥äº†ã€‚</p>
<h2 id="sunionstore"><a href="#sunionstore" class="headerlink" title="sunionstore"></a>sunionstore</h2><blockquote>
<p>è¿”å›æ‰€æœ‰ç»™å®škeyçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœå­˜ä¸ºå¦ä¸€ä¸ªkeyã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sunionstore myset6 myset2 myset3</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; smembers myset6</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹çš„ç»“æœå¯ä»¥çœ‹å‡º, myset2å’Œmyset3çš„å¹¶é›†è¢«ä¿å­˜åˆ°myset6ä¸­äº†ã€‚</p>
<h2 id="smove"><a href="#smove" class="headerlink" title="smove"></a>smove</h2><blockquote>
<p>ä»ç¬¬ä¸€ä¸ªkeyå¯¹åº”çš„setä¸­ç§»é™¤memberå¹¶æ·»åŠ åˆ°ç¬¬äºŒä¸ªå¯¹åº”setä¸­ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smove myset2 myset7 three</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers myset7</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œmyset2çš„threeè¢«ç§»åˆ°myset7ä¸­äº†ã€‚</p>
<h2 id="scard"><a href="#scard" class="headerlink" title="scard"></a>scard</h2><blockquote>
<p>è¿”å›åç§°ä¸ºkeyçš„setçš„å…ƒç´ ä¸ªæ•°ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scard myset2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h2 id="sismember"><a href="#sismember" class="headerlink" title="sismember"></a>sismember</h2><blockquote>
<p>æµ‹è¯•memberæ˜¯å¦æ˜¯åç§°ä¸ºkeyçš„setçš„å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset2</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sismember myset2 two</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember myset2 one</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œtwoæ˜¯myset2çš„æˆå‘˜ï¼Œè€Œoneä¸æ˜¯ã€‚</p>
<h2 id="srandmember"><a href="#srandmember" class="headerlink" title="srandmember"></a>srandmember</h2><blockquote>
<p>éšæœºè¿”å›åç§°ä¸ºkeyçš„setçš„ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ä¸åˆ é™¤å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset3</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset3</span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset3</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset3</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡è¿”å›äº†å…ƒç´ â€oneâ€ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åˆ é™¤â€oneâ€å…ƒç´ ã€‚</p>
<h1 id="Sorted-sets-ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰"><a href="#Sorted-sets-ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰" class="headerlink" title="Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰"></a>Sorted sets ï¼ˆä¸å¯é‡å¤æœ‰åºé›†åˆï¼‰</h1><p>sorted setæ˜¯setçš„ä¸€ä¸ªå‡çº§ç‰ˆæœ¬ï¼Œå®ƒåœ¨setçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªé¡ºåºå±æ€§ï¼Œè¿™ä¸€å±æ€§åœ¨æ·»åŠ ä¿®æ”¹å…ƒç´ çš„æ—¶å€™å¯ä»¥æŒ‡å®šï¼Œæ¯æ¬¡æŒ‡å®šåï¼Œzsetä¼šè‡ªåŠ¨é‡æ–°æŒ‰æ–°çš„å€¼è°ƒæ•´é¡ºåºã€‚å¯ä»¥ç†è§£ä¸ºæœ‰ä¸¤åˆ—çš„mysqlè¡¨ï¼Œä¸€åˆ—å­˜valueï¼Œä¸€åˆ—å­˜é¡ºåºã€‚</p>
<p>å’Œsetä¸€æ ·sorted setä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„scoreã€‚sorted setçš„å®ç°æ˜¯skip listå’Œhash tableçš„æ··åˆä½“ã€‚</p>
<h2 id="zadd"><a href="#zadd" class="headerlink" title="zadd"></a>zadd</h2><blockquote>
<p>å‘åç§°ä¸ºkeyçš„zsetä¸­æ·»åŠ å…ƒç´ memberï¼Œscoreç”¨äºæ’åºã€‚å¦‚æœè¯¥å…ƒç´ å·²ç»å­˜åœ¨ï¼Œåˆ™æ ¹æ®scoreæ›´æ–°è¯¥å…ƒç´ çš„é¡ºåºã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd myzset 1 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset 2 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset 3 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; zrange myzset 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="zrem"><a href="#zrem" class="headerlink" title="zrem"></a>zrem</h2><blockquote>
<p>åˆ é™¤åç§°ä¸ºkeyçš„zsetä¸­çš„å…ƒç´ memberã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange myzset 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrem myzset two</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange myzset 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°twoè¢«åˆ é™¤äº†ã€‚</p>
<h2 id="zincrby"><a href="#zincrby" class="headerlink" title="zincrby"></a>zincrby</h2><blockquote>
<p>å¦‚æœåœ¨åç§°ä¸ºkeyçš„zsetä¸­å·²ç»å­˜åœ¨å…ƒç´ memberï¼Œåˆ™è¯¥å…ƒç´ çš„scoreå¢åŠ incrementï¼›å¦åˆ™å‘é›†åˆä¸­æ·»åŠ è¯¥å…ƒç´ ï¼Œå…¶scoreçš„å€¼ä¸ºincrementã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd myzset2 1 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset2 2 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zincrby myzset2 2 <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrange myzset2 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­å°†oneçš„scoreä»1å¢åŠ äº†2ï¼Œå¢åŠ åˆ°äº†3ã€‚</p>
<h2 id="zrank"><a href="#zrank" class="headerlink" title="zrank"></a>zrank</h2><blockquote>
<p>è¿”å›åç§°ä¸ºkeyçš„zsetä¸­memberå…ƒç´ çš„æ’å(æŒ‰scoreä»å°åˆ°å¤§æ’åº)å³ä¸‹æ ‡ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd myzset3 1 <span class="string">&quot;one&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset3 2 <span class="string">&quot;two&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset3 3 <span class="string">&quot;three&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset3 5 <span class="string">&quot;five&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;three&quot;</span></span><br><span class="line">6) <span class="string">&quot;3&quot;</span></span><br><span class="line">7) <span class="string">&quot;five&quot;</span></span><br><span class="line">8) <span class="string">&quot;5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrank myzset3 two</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h2 id="zrevrank"><a href="#zrevrank" class="headerlink" title="zrevrank"></a>zrevrank</h2><blockquote>
<p>è¿”å›åç§°ä¸ºkeyçš„zsetä¸­memberå…ƒç´ çš„æ’å(æŒ‰scoreä»å¤§åˆ°å°æ’åº)å³ä¸‹æ ‡ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;three&quot;</span></span><br><span class="line">6) <span class="string">&quot;3&quot;</span></span><br><span class="line">7) <span class="string">&quot;five&quot;</span></span><br><span class="line">8) <span class="string">&quot;5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrevrank myzset3 two</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<p>æŒ‰ä»å¤§åˆ°å°æ’åºçš„è¯twoæ˜¯ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œä¸‹æ ‡æ˜¯2ã€‚</p>
<h2 id="zrevrange"><a href="#zrevrange" class="headerlink" title="zrevrange"></a>zrevrange</h2><blockquote>
<p>è¿”å›åç§°ä¸ºkeyçš„zsetï¼ˆæŒ‰scoreä»å¤§åˆ°å°æ’åºï¼‰ä¸­çš„indexä»startåˆ°endçš„æ‰€æœ‰å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;5&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;2&quot;</span></span><br><span class="line">7) <span class="string">&quot;one&quot;</span></span><br><span class="line">8) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="zrangebyscore"><a href="#zrangebyscore" class="headerlink" title="zrangebyscore"></a>zrangebyscore</h2><blockquote>
<p>è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;three&quot;</span></span><br><span class="line">6) <span class="string">&quot;3&quot;</span></span><br><span class="line">7) <span class="string">&quot;five&quot;</span></span><br><span class="line">8) <span class="string">&quot;5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore myzset3 2 3 withscores</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="zcount"><a href="#zcount" class="headerlink" title="zcount"></a>zcount</h2><blockquote>
<p>è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„æ•°é‡ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;5&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;2&quot;</span></span><br><span class="line">7) <span class="string">&quot;one&quot;</span></span><br><span class="line">8) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zcount myzset3 2 3</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h2 id="zcard"><a href="#zcard" class="headerlink" title="zcard"></a>zcard</h2><blockquote>
<p>è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;5&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;2&quot;</span></span><br><span class="line">7) <span class="string">&quot;one&quot;</span></span><br><span class="line">8) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zcard myzset3</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>

<h2 id="zscore"><a href="#zscore" class="headerlink" title="zscore"></a>zscore</h2><blockquote>
<p>è¿”å›ç»™å®šå…ƒç´ å¯¹åº”çš„scoreã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;5&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;2&quot;</span></span><br><span class="line">7) <span class="string">&quot;one&quot;</span></span><br><span class="line">8) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;  zscore myzset3 two</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="zremrangebyrank"><a href="#zremrangebyrank" class="headerlink" title="zremrangebyrank"></a>zremrangebyrank</h2><blockquote>
<p>åˆ é™¤é›†åˆä¸­æ’ååœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;five&quot;</span></span><br><span class="line">2) <span class="string">&quot;5&quot;</span></span><br><span class="line">3) <span class="string">&quot;three&quot;</span></span><br><span class="line">4) <span class="string">&quot;3&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;2&quot;</span></span><br><span class="line">7) <span class="string">&quot;one&quot;</span></span><br><span class="line">8) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zremrangebyrank myzset3 3 3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;one&quot;</span></span><br><span class="line">6) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†myzset3ä¸­æŒ‰ä»å°åˆ°å¤§æ’åºç»“æœçš„ä¸‹æ ‡ä¸º3çš„å…ƒç´ åˆ é™¤äº†ã€‚</p>
<h2 id="zremrangebyscore"><a href="#zremrangebyscore" class="headerlink" title="zremrangebyscore"></a>zremrangebyscore</h2><blockquote>
<p>åˆ é™¤é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;two&quot;</span></span><br><span class="line">4) <span class="string">&quot;2&quot;</span></span><br><span class="line">5) <span class="string">&quot;one&quot;</span></span><br><span class="line">6) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; zremrangebyscore myzset3 1 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; zrevrange myzset3 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†myzset3ä¸­æŒ‰ä»å°åˆ°å¤§æ’åºç»“æœçš„scoreåœ¨1~2ä¹‹é—´çš„å…ƒç´ åˆ é™¤äº†ã€‚</p>
<h1 id="Hashes-ï¼ˆå“ˆå¸Œè¡¨ï¼‰"><a href="#Hashes-ï¼ˆå“ˆå¸Œè¡¨ï¼‰" class="headerlink" title="Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰"></a>Hashes ï¼ˆå“ˆå¸Œè¡¨ï¼‰</h1><p>Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ã€‚å®ƒçš„æ·»åŠ ã€åˆ é™¤æ“ä½œéƒ½æ˜¯O(1)ï¼ˆå¹³å‡ï¼‰ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p>
<p>ç›¸è¾ƒäºå°†å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå­˜æˆå•ä¸ªstringç±»å‹ï¼Œå°†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨åœ¨hashç±»å‹ä¸­ä¼šå ç”¨æ›´å°‘çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ–¹ä¾¿çš„å­˜å–æ•´ä¸ªå¯¹è±¡ã€‚</p>
<h2 id="hset"><a href="#hset" class="headerlink" title="hset"></a>hset</h2><blockquote>
<p>è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset myhash field1 Hello</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h2 id="hsetnx"><a href="#hsetnx" class="headerlink" title="hsetnx"></a>hsetnx</h2><blockquote>
<p>è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚å¦‚æœfieldå·²ç»å­˜åœ¨ï¼Œè¿”å›0ï¼Œnxæ˜¯not existçš„æ„æ€ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hsetnx myhash field <span class="string">&quot;Hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash field <span class="string">&quot;Hello&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œæ˜¯æˆåŠŸçš„ï¼Œä½†ç¬¬äºŒæ¬¡æ‰§è¡Œç›¸åŒçš„å‘½ä»¤å¤±è´¥ï¼ŒåŸå› æ˜¯fieldå·²ç»å­˜åœ¨äº†ã€‚ </p>
<h2 id="hmset"><a href="#hmset" class="headerlink" title="hmset"></a>hmset</h2><blockquote>
<p>åŒæ—¶è®¾ç½®hashçš„å¤šä¸ªfieldã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hmset myhash field1 Hello field2 World</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="hget"><a href="#hget" class="headerlink" title="hget"></a>hget</h2><blockquote>
<p>è·å–æŒ‡å®šçš„hash fieldã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hget myhash field1</span><br><span class="line"><span class="string">&quot;Hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hget myhash field2</span><br><span class="line"><span class="string">&quot;World&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hget myhash field3</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ•°æ®åº“æ²¡æœ‰field3ï¼Œæ‰€ä»¥å–åˆ°çš„æ˜¯ä¸€ä¸ªç©ºå€¼nilã€‚</p>
<h2 id="hmget"><a href="#hmget" class="headerlink" title="hmget"></a>hmget</h2><blockquote>
<p>è·å–å…¨éƒ¨æŒ‡å®šçš„hash filedã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hmget myhash field1 field2 field3</span><br><span class="line">1) <span class="string">&quot;Hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;World&quot;</span></span><br><span class="line">3) (nil)</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ•°æ®åº“æ²¡æœ‰field3ï¼Œæ‰€ä»¥å–åˆ°çš„æ˜¯ä¸€ä¸ªç©ºå€¼nilã€‚</p>
<h2 id="hincrby"><a href="#hincrby" class="headerlink" title="hincrby"></a>hincrby</h2><blockquote>
<p>ç»™æŒ‡å®šçš„hash filed åŠ ä¸Šç»™å®šå€¼ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset myhash field3 20</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hget myhash field3 </span><br><span class="line"><span class="string">&quot;20&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; hincrby myhash field3 -8</span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br><span class="line">127.0.0.1:6379&gt; hget myhash field3</span><br><span class="line"><span class="string">&quot;12&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†field3çš„å€¼ä»20é™åˆ°äº†12ï¼Œå³åšäº†ä¸€ä¸ªå‡8çš„æ“ä½œã€‚</p>
<h2 id="hexists"><a href="#hexists" class="headerlink" title="hexists"></a>hexists</h2><blockquote>
<p>æµ‹è¯•æŒ‡å®šfieldæ˜¯å¦å­˜åœ¨ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hexists myhash field1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hexists myhash field9</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šä¾‹å¯ä»¥è¯´æ˜field1å­˜åœ¨ï¼Œä½†field9æ˜¯ä¸å­˜åœ¨çš„ã€‚</p>
<h2 id="hlen"><a href="#hlen" class="headerlink" title="hlen"></a>hlen</h2><blockquote>
<p>è¿”å›æŒ‡å®šhashçš„fieldæ•°é‡ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šä¾‹å¯ä»¥çœ‹åˆ°myhashä¸­æœ‰4ä¸ªfieldã€‚</p>
<h2 id="hdel"><a href="#hdel" class="headerlink" title="hdel"></a>hdel</h2><blockquote>
<p>åˆ é™¤æŒ‡å®šhashçš„æŒ‡å®šfieldã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; hdel myhash field1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h2 id="hkeys"><a href="#hkeys" class="headerlink" title="hkeys"></a>hkeys</h2><blockquote>
<p>è¿”å›hashçš„æ‰€æœ‰fieldã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt;  hkeys myhash</span><br><span class="line">1) <span class="string">&quot;field&quot;</span></span><br><span class="line">2) <span class="string">&quot;field2&quot;</span></span><br><span class="line">3) <span class="string">&quot;field3&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="hvals"><a href="#hvals" class="headerlink" title="hvals"></a>hvals</h2><blockquote>
<p>è¿”å›hashçš„æ‰€æœ‰valueã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hvals myhash</span><br><span class="line">1) <span class="string">&quot;Hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;World&quot;</span></span><br><span class="line">3) <span class="string">&quot;12&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="hgetall"><a href="#hgetall" class="headerlink" title="hgetall"></a>hgetall</h2><blockquote>
<p>è·å–æŸä¸ªhashä¸­å…¨éƒ¨çš„filedåŠvalueã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) <span class="string">&quot;field&quot;</span></span><br><span class="line">2) <span class="string">&quot;Hello&quot;</span></span><br><span class="line">3) <span class="string">&quot;field2&quot;</span></span><br><span class="line">4) <span class="string">&quot;World&quot;</span></span><br><span class="line">5) <span class="string">&quot;field3&quot;</span></span><br><span class="line">6) <span class="string">&quot;12&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸‹å­å°†myhashä¸­æ‰€æœ‰çš„fieldåŠå¯¹åº”çš„valueéƒ½å–å‡ºæ¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>NoSql</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Framework-å®˜æ–¹æ–‡æ¡£é˜…è¯»ï¼ˆä¸€ï¼‰Spring IoC Container</title>
    <url>/p/433/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é€šè¯»Spring IoCå®¹å™¨å®˜æ–¹æ–‡æ¡£ï¼Œå¯¹IoCå®¹å™¨æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚</p>
<span id="more"></span>

<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><ul>
<li>JDK1.8</li>
<li>Spring Framework Version ï¼š4.3.18.RELEASE</li>
</ul>
<h1 id="å®¹å™¨æ¦‚è¿°"><a href="#å®¹å™¨æ¦‚è¿°" class="headerlink" title="å®¹å™¨æ¦‚è¿°"></a>å®¹å™¨æ¦‚è¿°</h1><blockquote>
<p>æ¥å£<code>org.springframework.context.ApplicationContext</code>ä»£è¡¨Spring IoCå®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…beanã€‚<br>åœ¨ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ª<code>ClassPathXmlApplicationContext</code>æˆ–è€… <code>FileSystemXmlApplicationContext</code>çš„å®ä¾‹ã€‚</p>
</blockquote>
<!-- more -->

<p>Springå·¥ä½œåŸç†çš„é«˜çº§è§†å›¾<br><img data-src="https://i.loli.net/2019/03/21/5c9278544811e.png"></p>
<p>1.é…ç½®å…ƒæ•°æ®<br>åˆ›å»ºSimpleBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Spring Bean!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>config.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;simple&quot;</span> <span class="attr">class</span>=<span class="string">&quot;base.SimpleBeanFactoryBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.å®ä¾‹åŒ–å®¹å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>3.ä½¿ç”¨å®¹å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€ç´¢Springå®¹å™¨ä¸­çš„bean</span></span><br><span class="line">SimpleBean simpleBean = context.getBean(SimpleBean.class);</span><br><span class="line"><span class="comment">// ä½¿ç”¨bean</span></span><br><span class="line">simpleBean.send();</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰æ›´çµæ´»çš„æ–¹å¼æ¥ä»é…ç½®æ–‡ä»¶è·å–beanï¼Œä½¿ç”¨<code>GenericApplicationContext</code>ä¸<code>BeanDefinitionReader</code>ç»“åˆï¼Œç›´æ¥è¯»å–beanå®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">GenericApplicationContext context = <span class="keyword">new</span> GenericApplicationContext();</span><br><span class="line"><span class="keyword">new</span> XmlBeanDefinitionReader(context).loadBeanDefinitions(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">context.refresh();</span><br><span class="line">SimpleBean simpleBean = (SimpleBean) context.getBean(<span class="string">&quot;simple&quot;</span>);</span><br><span class="line">simpleBean.send();</span><br></pre></td></tr></table></figure>

<h1 id="Beanæ¦‚è¿°"><a href="#Beanæ¦‚è¿°" class="headerlink" title="Beanæ¦‚è¿°"></a>Beanæ¦‚è¿°</h1><blockquote>
<p>Spring IoCå®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚è¿™äº›beanæ˜¯ä½¿ç”¨æ‚¨æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼Œä¾‹å¦‚ï¼Œä»¥XML <code>&lt;bean/&gt;</code>å®šä¹‰çš„å½¢å¼ ã€‚</p>
</blockquote>
<p>åœ¨å®¹å™¨æœ¬èº«å†…ï¼Œè¿™äº›beanå®šä¹‰è¡¨ç¤ºä¸º<code>BeanDefinition</code>å¯¹è±¡ã€‚</p>
<p>é™¤äº†åˆ›å»ºé…ç½®å¥½çš„beanä¹‹å¤–ï¼Œ<code>ApplicationContext</code>è¿˜å…è®¸ç”¨æˆ·æ³¨å†Œåœ¨å®¹å™¨å¤–éƒ¨åˆ›å»ºçš„ç°æœ‰å¯¹è±¡ã€‚é€šè¿‡<code>getBeanFactory()</code>è·å¾—<code>DefaultListableBeanFactory</code>ï¼Œç„¶åä½¿ç”¨<code>registerSingleton()</code>æˆ–è€…<code>registerBeanDefinition()</code>æ¥æ³¨å†Œbeanã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DefaultListableBeanFactory beanFactory = <span class="keyword">new</span> DefaultListableBeanFactory();</span><br><span class="line">ClassPathXmlApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setId(<span class="number">1L</span>);</span><br><span class="line">user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">beanFactory.registerSingleton(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">User bean = (User) applicationContext.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">System.out.println(bean);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æ˜¯ä»¥ä¸‹åšæ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ClassPathXmlApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;config.xml&quot;</span>);</span><br><span class="line">DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory) applicationContext.getBeanFactory();</span><br><span class="line">BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(User.class);</span><br><span class="line">builder.addPropertyValue(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">builder.addPropertyValue(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">AbstractBeanDefinition beanDefinition = builder.getBeanDefinition();</span><br><span class="line">beanFactory.registerBeanDefinition(<span class="string">&quot;user&quot;</span>, beanDefinition);</span><br><span class="line"></span><br><span class="line">User bean = (User) applicationContext.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">System.out.println(bean);</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åbean"><a href="#å‘½åbean" class="headerlink" title="å‘½åbean"></a>å‘½åbean</h2><p>æ¯ä¸ªbeanéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ã€‚è¿™äº›æ ‡è¯†ç¬¦åœ¨æ‰˜ç®¡beançš„å®¹å™¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚beané€šå¸¸åªæœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä½†å¦‚æœå®ƒéœ€è¦å¤šä¸ªæ ‡è¯†ç¬¦ï¼Œåˆ™é¢å¤–çš„æ ‡è¯†ç¬¦å¯ä»¥è¢«è§†ä¸ºåˆ«åã€‚</p>
<p>åœ¨åŸºäºXMLçš„é…ç½®å…ƒæ•°æ®ä¸­ï¼Œä½¿ç”¨idå’Œ/æˆ–nameå±æ€§æŒ‡å®šbeanæ ‡è¯†ç¬¦ã€‚</p>
<h2 id="å®ä¾‹åŒ–bean"><a href="#å®ä¾‹åŒ–bean" class="headerlink" title="å®ä¾‹åŒ–bean"></a>å®ä¾‹åŒ–bean</h2><p>1.æ„é€ å‡½æ•°å®ä¾‹åŒ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;anotherExample&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBeanTwo&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;examples.ClientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ClientService clientService = <span class="keyword">new</span> ClientService();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ClientService</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClientService <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;serviceLocator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the bean to be created via the factory bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createClientServiceInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultServiceLocator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ClientService clientService = <span class="keyword">new</span> ClientServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientService <span class="title">createClientServiceInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå·¥å‚ç±»ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå·¥å‚æ–¹æ³•:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;serviceLocator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clientService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createClientServiceInstance&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-bean</span>=<span class="string">&quot;serviceLocator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">factory-method</span>=<span class="string">&quot;createAccountServiceInstance&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultServiceLocator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ClientService clientService = <span class="keyword">new</span> ClientServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AccountService accountService = <span class="keyword">new</span> AccountServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientService <span class="title">createClientServiceInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clientService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AccountService <span class="title">createAccountServiceInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h1><h2 id="æ„é€ å™¨æ³¨å…¥"><a href="#æ„é€ å™¨æ³¨å…¥" class="headerlink" title="æ„é€ å™¨æ³¨å…¥"></a>æ„é€ å™¨æ³¨å…¥</h2><blockquote>
<p>åŸºäºæ„é€ å‡½æ•°çš„ DIç”±å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SimpleMovieListerä¾èµ–äºMovieFinder</span></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»¥ä¾¿Springå®¹å™¨å¯ä»¥æ³¨å…¥ä¸€ä¸ªMovieFinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleMovieLister</span><span class="params">(MovieFinder movieFinder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ å‡½æ•°å‚æ•°è§£æ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">(Bar bar, Baz baz)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;foo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Foo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;bar&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;baz&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Bar&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;baz&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.Baz&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;exampleBean&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg type=<span class="string">&quot;int&quot;</span> value=<span class="string">&quot;7500000&quot;</span>/&gt;</span><br><span class="line">    &lt;constructor-arg type=<span class="string">&quot;java.lang.String&quot;</span> value=<span class="string">&quot;42&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨indexå±æ€§æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç´¢å¼•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°åç§°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;years&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ultimateAnswer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="setteræ³¨å…¥"><a href="#setteræ³¨å…¥" class="headerlink" title="setteræ³¨å…¥"></a>setteræ³¨å…¥</h2><blockquote>
<p>åŸºäºsetterçš„ DIæ˜¯åœ¨è°ƒç”¨æ— å‚æ•°æ„é€ å‡½æ•°æˆ–æ— å‚æ•°staticå·¥å‚æ–¹æ³•æ¥å®ä¾‹åŒ–beanä¹‹åï¼Œé€šè¿‡å®¹å™¨è°ƒç”¨beanä¸Šçš„setteræ–¹æ³•æ¥å®Œæˆçš„ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SimpleMovieListerä¾èµ–äºMovieFinder</span></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªsetteræ–¹æ³•ï¼Œä»¥ä¾¿Springå®¹å™¨å¯ä»¥æ³¨å…¥ä¸€ä¸ªMovieFinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>ApplicationContext</code>çš„ä¾èµ–æ³¨å…¥æ”¯æŒæ„é€ å™¨æ³¨å…¥å’Œsetteræ³¨å…¥ä¸¤ç§æ–¹å¼ã€‚åœ¨é€šè¿‡æ„é€ å‡½æ•°æ–¹æ³•æ³¨å…¥äº†ä¸€äº›ä¾èµ–é¡¹ä¹‹åï¼Œå®ƒè¿˜æ”¯æŒåŸºäºsetterçš„ä¾èµ–æ³¨å…¥ã€‚å¯ä»¥ç”¨<code>BeanDefinition</code>ä¸<code>PropertyEditor</code>å®ä¾‹ç»“åˆä½¿ç”¨çš„æ–¹å¼æ¥é…ç½®ä¾èµ–é¡¹ã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨<code>BeanDefinition</code>ä¸<code>PropertyEditor</code>ï¼Œè€Œæ˜¯ç”¨XML å®šä¹‰beanæˆ–è€…æ˜¯æ³¨è§£æ–¹å¼ï¼ˆ<code>@Component</code>ï¼Œ <code>@Controller</code>ç­‰ç­‰ï¼‰ï¼Œæˆ–è€…æ˜¯ç›´æ¥ç¼–å†™@Configurationç±»ã€‚ç„¶åï¼Œè¿™äº›ç±»åœ¨å†…éƒ¨è½¬æ¢ä¸ºå®ä¾‹<code>BeanDefinition</code>å¹¶ç”¨äºåŠ è½½æ•´ä¸ªSpring IoCå®¹å™¨å®ä¾‹ã€‚</p>
<h2 id="è§£å†³å¾ªç¯ä¾èµ–"><a href="#è§£å†³å¾ªç¯ä¾èµ–" class="headerlink" title="è§£å†³å¾ªç¯ä¾èµ–"></a>è§£å†³å¾ªç¯ä¾èµ–</h2><p>å¦‚æœä¸»è¦ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œåˆ™å¯èƒ½å‡ºç°æ— æ³•è§£æçš„å¾ªç¯ä¾èµ–å…³ç³»åœºæ™¯ã€‚<br>ä¾‹å¦‚ï¼šç±»Aé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥éœ€è¦ç±»Bçš„å®ä¾‹ï¼Œè€Œç±»Bé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ç±»Açš„å®ä¾‹ã€‚å¦‚æœå°†Aç±»å’ŒBç±»çš„beané…ç½®ä¸ºç›¸äº’æ³¨å…¥ï¼Œåˆ™Spring IoCå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°æ­¤å¾ªç¯å¼•ç”¨ï¼Œå¹¶æŠ›å‡º<code>BeanCurrentlyInCreationException</code>å¼‚å¸¸ã€‚<br>ä¸€ç§å¯è¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ä»…ä½¿ç”¨setteræ³¨å…¥ã€‚<br>ä¸å…¸å‹æƒ…å†µï¼ˆæ²¡æœ‰å¾ªç¯ä¾èµ–ï¼‰ä¸åŒï¼Œbean Aå’Œbean Bä¹‹é—´çš„å¾ªç¯ä¾èµ–å¼ºåˆ¶å…¶ä¸­ä¸€ä¸ªbeanåœ¨å®Œå…¨åˆå§‹åŒ–ä¹‹å‰è¢«æ³¨å…¥å¦ä¸€ä¸ªbeanï¼ˆä¸€ä¸ªç»å…¸çš„é¸¡/è›‹åœºæ™¯ï¼‰ã€‚</p>
<h2 id="ä½¿ç”¨-depends-on"><a href="#ä½¿ç”¨-depends-on" class="headerlink" title="ä½¿ç”¨ depends-on"></a>ä½¿ç”¨ depends-on</h2><p><code>depends-on</code>å¯ä»¥åœ¨åˆå§‹åŒ–beanä¹‹å‰ï¼Œæ˜¾å¼åœ°å¼ºåˆ¶åˆå§‹åŒ–ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚ä¸‹é¢çš„ä¾‹å­ï¼Œåœ¨åˆå§‹åŒ–<code>beanOne</code>ä¹‹å‰ï¼Œå°†å¼ºåˆ¶åˆå§‹åŒ–<code>manager</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ExampleBean&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;manager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;manager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ManagerBean&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ‡’åŠ è½½çš„bean"><a href="#æ‡’åŠ è½½çš„bean" class="headerlink" title="æ‡’åŠ è½½çš„bean"></a>æ‡’åŠ è½½çš„bean</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ApplicationContext</code>ä¼šç«‹å³é…ç½®å¹¶åˆå§‹åŒ–æ‰€æœ‰å•ä¾‹beanï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>lazy-init=&quot;true&quot;</code>å°†å…¶è®¾ç½®ä¸ºæŒ‰éœ€åŠ è½½ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lazy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.ExpensiveToCreateBean&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;not.lazy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.AnotherBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ‡’åŠ è½½ä¸è¦ä½¿ç”¨åœ¨æ•°æ®åº“è¿æ¥æ± ä¸Šï¼Œå› ä¸ºæ— æ³•ç«‹å³è·çŸ¥æ•°æ®åº“è¿æ¥çŠ¶æ€ï¼Œå°†å¯¼è‡´è¿è¡Œæ—¶åˆ›å»ºè¿æ¥æ± å¤±è´¥ï¼Œä¸å¯é¢„çŸ¥çš„åæœã€‚</p>
<h2 id="è‡ªåŠ¨è£…é…åä½œè€…"><a href="#è‡ªåŠ¨è£…é…åä½œè€…" class="headerlink" title="è‡ªåŠ¨è£…é…åä½œè€…"></a>è‡ªåŠ¨è£…é…åä½œè€…</h2><p>Springå®¹å™¨å¯ä»¥è‡ªåŠ¨è¿æ¥åä½œbeanä¹‹é—´çš„å…³ç³»ã€‚æ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥<code>ApplicationContext</code>çš„å†…å®¹ï¼Œå…è®¸Springè‡ªåŠ¨ä¸ºæ‚¨çš„beanè§£æåä½œè€…ï¼ˆå…¶ä»–beanï¼‰ã€‚</p>
<p>è‡ªåŠ¨è£…é…æ¨¡å¼</p>
<ul>
<li>noï¼šæ— è‡ªåŠ¨è£…é…ï¼Œå¿…é¡»ä½¿ç”¨refæ¥å®šä¹‰Beanå¼•ç”¨ã€‚</li>
<li>byNameï¼šæŒ‰å±æ€§åç§°è‡ªåŠ¨è£…é…ã€‚</li>
<li>byTypeï¼šæŒ‰å±æ€§ç±»å‹è‡ªåŠ¨è£…é…ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªåŒç±»å‹Beanï¼Œåˆ™æŠ›å‡ºè‡´å‘½å¼‚å¸¸ã€‚</li>
<li>constructorï¼šç±»ä¼¼äºbyTypeï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ„é€ å‡½æ•°å‚æ•°ç±»å‹çš„ä¸€ä¸ªbeanï¼Œåˆ™æŠ›å‡ºè‡´å‘½å¼‚å¸¸ã€‚</li>
</ul>
<h1 id="Bean-ä½œç”¨åŸŸ"><a href="#Bean-ä½œç”¨åŸŸ" class="headerlink" title="Bean ä½œç”¨åŸŸ"></a>Bean ä½œç”¨åŸŸ</h1><h2 id="singleton"><a href="#singleton" class="headerlink" title="singleton"></a>singleton</h2><blockquote>
<p>Spring IoCå®¹å™¨åªåˆ›å»ºè¯¥beanå®šä¹‰çš„å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ã€‚æ­¤å•ä¸ªå®ä¾‹å­˜å‚¨åœ¨æ­¤ç±»å•ä¾‹beançš„ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”è¯¥Beançš„æ‰€æœ‰åç»­è¯·æ±‚å’Œå¼•ç”¨éƒ½å°†è¿”å›ç¼“å­˜å¯¹è±¡ã€‚</p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/03/21/5c9278545f51f.png"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.DefaultAccountService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.DefaultAccountService&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h2><blockquote>
<p>å’Œå•ä¾‹å¯¹ç«‹ï¼Œé€šå¸¸ï¼Œå¯¹æ‰€æœ‰æœ‰çŠ¶æ€beanä½¿ç”¨åŸå‹èŒƒå›´ï¼Œå¯¹æ— çŠ¶æ€beanä½¿ç”¨å•ä¾‹èŒƒå›´ã€‚</p>
</blockquote>
<p><img data-src="https://i.loli.net/2019/03/21/5c92785478899.png"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.DefaultAccountService&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Request-session-global-session-application-and-WebSocket"><a href="#Request-session-global-session-application-and-WebSocket" class="headerlink" title="Request, session, global session, application, and WebSocket"></a>Request, session, global session, application, and WebSocket</h2><blockquote>
<p>åœ¨webç¨‹åºä¸­ä½¿ç”¨ï¼Œå¯¹åº”äºHTTPè¯·æ±‚ä½œç”¨åŸŸ</p>
</blockquote>
<h1 id="è‡ªå®šä¹‰beançš„æ€§è´¨"><a href="#è‡ªå®šä¹‰beançš„æ€§è´¨" class="headerlink" title="è‡ªå®šä¹‰beançš„æ€§è´¨"></a>è‡ªå®šä¹‰beançš„æ€§è´¨</h1><h2 id="ç”Ÿå‘½å‘¨æœŸå›è°ƒ"><a href="#ç”Ÿå‘½å‘¨æœŸå›è°ƒ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸå›è°ƒ"></a>ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h2><h2 id="åˆå§‹åŒ–å›è°ƒ"><a href="#åˆå§‹åŒ–å›è°ƒ" class="headerlink" title="åˆå§‹åŒ–å›è°ƒ"></a>åˆå§‹åŒ–å›è°ƒ</h2><p>å®ç°<code>org.springframework.beans.factory.InitializingBean</code>æ¥å£ï¼Œå¯ä»¥ä¸ºbeanè®¾ç½®åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹ä¸å»ºè®®ä½¿ç”¨è¯¥æ¥å£ï¼Œå› ä¸ºä¼šå¢åŠ ä¸Springçš„è€¦åˆåº¦ã€‚å¯ä»¥ä½¿ç”¨<code>@PostConstruct</code>æˆ–æŒ‡å®šbeançš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<ul>
<li>ä½¿ç”¨xmlé…ç½®æ–‡ä»¶</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨Java @Beanæ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(initMethod = &quot;init&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="é”€æ¯å›è°ƒ"><a href="#é”€æ¯å›è°ƒ" class="headerlink" title="é”€æ¯å›è°ƒ"></a>é”€æ¯å›è°ƒ</h2><p>å®ç°<code>org.springframework.beans.factory.DisposableBean</code>å¯ä»¥ä¸ºbeanè®¾ç½®é”€æ¯å›è°ƒæ–¹æ³•ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œä¸å»ºè®®å®ç°è¯¥æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨<code>@PreDestroy</code>æˆ–æŒ‡å®šbeançš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<ul>
<li>ä½¿ç”¨xmlé…ç½®æ–‡ä»¶</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleInitBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;cleanup&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨Java @Beanæ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod = &quot;cleanup&quot;)</span></span><br></pre></td></tr></table></figure>

<p>ä»Spring 2.5å¼€å§‹ï¼Œæ‚¨æœ‰ä¸‰ä¸ªæ§åˆ¶beanç”Ÿå‘½å‘¨æœŸè¡Œä¸ºçš„é€‰é¡¹ï¼š</p>
<ul>
<li> <code>InitializingBean</code>å’Œ <code>DisposableBean</code>å›è°ƒæ¥å£</li>
<li> init()å’Œdestroy()æ–¹æ³•</li>
<li> <code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>æ³¨è§£</li>
</ul>
<p>å¦‚æœä¸ºä¸€ä¸ªbeanåŒæ—¶é…ç½®äº†ä¸Šè¿°æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œæ–¹æ³•é¡ºåºä¸ºï¼š</p>
<ul>
<li><code>@PostConstruct</code>å®šä¹‰çš„æ–¹æ³•</li>
<li><code>InitializingBean</code>å›è°ƒæ¥å£å®šä¹‰çš„<code>afterPropertiesSet()</code></li>
<li>è‡ªå®šä¹‰é…ç½®çš„<code>init()</code>æ–¹æ³•</li>
</ul>
<p>é”€æ¯ï¼š</p>
<ul>
<li><code>@PreDestroy</code>å®šä¹‰çš„æ–¹æ³•</li>
<li><code>DisposableBean</code>å›è°ƒæ¥å£ å®šä¹‰çš„<code>destroy()</code></li>
<li>è‡ªå®šä¹‰é…ç½®çš„<code>destroy()</code>æ–¹æ³•</li>
</ul>
<h1 id="ApplicationContextAwareå’ŒBeanNameAware"><a href="#ApplicationContextAwareå’ŒBeanNameAware" class="headerlink" title="ApplicationContextAwareå’ŒBeanNameAware"></a><code>ApplicationContextAware</code>å’Œ<code>BeanNameAware</code></h1><ul>
<li><code>ApplicationContextAware</code>ï¼šå®ç°è¯¥æ¥å£ï¼Œå°†æ³¨å…¥<code>ApplicationContext</code>å®ä¾‹çš„å¼•ç”¨</li>
<li><code>BeanNameAware</code>ï¼šå®ç°è¯¥æ¥å£ï¼Œå°†æ³¨å…¥<code>BeanName</code></li>
</ul>
<p>é™¤äº†<code>ApplicationContextAware</code>å’Œ<code>BeanNameAware</code>ï¼ŒSpringè¿˜æä¾›äº†ä¸€ç³»åˆ—Awareæ¥å£ï¼Œè¿™äº›æ¥å£å°†ä¸ºå®ç°ç±»æ³¨å…¥å¯¹åº”çš„å®ä¾‹ã€‚</p>
<ul>
<li>ApplicationContextAwareï¼šå£°æ˜ ApplicationContext</li>
<li>ApplicationEventPublisherAwareï¼šApplicationContextçš„äº‹ä»¶å‘å¸ƒè€…</li>
<li>BeanClassLoaderAwareï¼šç”¨äºåŠ è½½beanç±»çš„ç±»åŠ è½½å™¨ã€‚</li>
<li>BeanFactoryAwareï¼šå£°æ˜ BeanFactory</li>
<li>BeanNameAwareï¼šå£°æ˜beançš„åç§°</li>
<li>BootstrapContextAware</li>
<li>LoadTimeWeaverAware</li>
<li>MessageSourceAware</li>
<li>NotificationPublisherAwareï¼šSpring JMXé€šçŸ¥å‘å¸ƒè€…</li>
<li>PortletConfigAwareï¼šå½“å‰PortletConfigå®¹å™¨</li>
<li>PortletContextAwareï¼šå½“å‰PortletContextå®¹å™¨</li>
<li>ResourceLoaderAwareï¼šé…ç½®çš„åŠ è½½ç¨‹åºï¼Œç”¨äºå¯¹èµ„æºè¿›è¡Œä½çº§è®¿é—®</li>
<li>ServletConfigAwareï¼šå½“å‰ServletConfigå®¹å™¨</li>
<li>ServletContextAwareï¼šå½“å‰ServletContextå®¹å™¨</li>
</ul>
<h1 id="Beançš„ç»§æ‰¿"><a href="#Beançš„ç»§æ‰¿" class="headerlink" title="Beançš„ç»§æ‰¿"></a>Beançš„ç»§æ‰¿</h1><p>åœ¨xmlé…ç½®æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰beançš„ç»§æ‰¿ä½“ç³»ï¼Œä½¿ç”¨<code>parent</code>å±æ€§å®šä¹‰çˆ¶ç±»ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritedTestBean&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inheritsWithDifferentClass&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.DerivedTestBean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">parent</span>=<span class="string">&quot;inheritedTestBean&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initialize&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;override&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æºç é‡Œï¼Œå­ç±»æ˜¯é€šè¿‡<code>ChildBeanDefinition</code>æ¥å®šä¹‰çš„ã€‚</p>
<h1 id="å®¹å™¨æ‰©å±•ç‚¹"><a href="#å®¹å™¨æ‰©å±•ç‚¹" class="headerlink" title="å®¹å™¨æ‰©å±•ç‚¹"></a>å®¹å™¨æ‰©å±•ç‚¹</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»ç»§æ‰¿<code>ApplicationContext</code>å®ç°ç±»ï¼Œä¸è¿‡Springé¢„ç•™äº†ä¸€äº›æ¥å£ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ‰©å±•Spring IoCå®¹å™¨ã€‚</p>
<h2 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨</span></span><br><span class="line">	<span class="function">Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">    <span class="comment">//åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–å®Œæ¯•åè°ƒç”¨</span></span><br><span class="line">	<span class="function">Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¯ä»¥å®šä¹‰å¤šä¸ª`BeanPostProcessor`ï¼Œç„¶åå®ç°`Ordered`æ¥å£å¹¶ä¿®æ”¹å±æ€§orderæ¥æ§åˆ¶`BeanPostProcessor`çš„æ‰§è¡Œé¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼š`ConfigurableBeanFactory`æä¾›</span><br><span class="line"></span><br><span class="line">â€‹```<span class="function">java</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addBeanPostProcessor</span><span class="params">(BeanPostProcessor beanPostProcessor)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æ¥æ‰‹åŠ¨æ³¨å†Œ<code>BeanPostProcessor</code>ï¼Œè¿™äº›<code>BeanPostProcessor</code>ä¸éœ€è¦éµå¾ª<code>Orderd</code>æ’åºè§„åˆ™ï¼Œæ€»æ˜¯åœ¨è‡ªåŠ¨æ³¨å…¥çš„<code>BeanPostProcessor</code>ä¹‹å‰æ‰§è¡Œã€‚</p>
<p>ä¸€ä¸ª<code>BeanPostProcessor</code>çš„å®ç°ä¾‹å­<code>RequiredAnnotationBeanPostProcessor</code></p>
<h2 id="ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®"><a href="#ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®" class="headerlink" title="ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®"></a>ä½¿ç”¨<code>BeanFactoryPostProcessor</code>è‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äº<code>BeanPostProcessor</code>ï¼Œä¸åŒçš„æ˜¯ï¼Œ<code>BeanFactoryPostProcessor</code>æ“ä½œé…ç½®å…ƒæ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpringå®¹å™¨å…è®¸<code>BeanFactoryPostProcessor</code>è¯»å–é…ç½®å¹¶æ›´æ”¹ã€‚</p>
<p>è¿™äº›<code>BeanPostProcessor</code>å°†åœ¨æ¯ä¸ªbeanåˆå§‹åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä¾¿å°†æ›´æ”¹åº”ç”¨äºå®šä¹‰å®¹å™¨çš„é…ç½®å…ƒæ•°æ®ã€‚SpringåŒ…å«è®¸å¤šé¢„å®šä¹‰çš„<code>BeanPostProcessor</code>,ä¾‹å¦‚<code>PropertyOverrideConfigurer</code>å’Œ<code>PropertyPlaceholderConfigurer</code>ã€‚</p>
<h2 id="ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘"><a href="#ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘" class="headerlink" title="ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘"></a>ä½¿ç”¨<code>FactoryBean</code>è‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FactoryBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰beançš„åˆå§‹åŒ–é€»è¾‘</span></span><br><span class="line">	<span class="function">T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">	Class&lt;?&gt; getObjectType();</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®ç°<code>FactoryBean&lt;T&gt;</code>çš„beanæ˜¯ï¼Œè¿”å›çš„æ˜¯<code>getObject()</code>ç”Ÿæˆçš„beanï¼Œå¦‚æœè¦è¿”å› FactoryBeanå®ä¾‹æœ¬èº«ï¼Œåº”è¯¥ä½¿ç”¨<code>getBean(&quot;&amp;myBean&quot;)</code></p>
<h1 id="åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"><a href="#åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®" class="headerlink" title="åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"></a>åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</h1><ul>
<li>@Required</li>
<li>@Autowired</li>
<li>@Resource</li>
<li>@Qualifier</li>
<li>@PostConstruct and @PreDestroy</li>
</ul>
<h2 id="ç±»è·¯å¾„æ‰«æå’Œæ‰˜ç®¡ç»„ä»¶"><a href="#ç±»è·¯å¾„æ‰«æå’Œæ‰˜ç®¡ç»„ä»¶" class="headerlink" title="ç±»è·¯å¾„æ‰«æå’Œæ‰˜ç®¡ç»„ä»¶"></a>ç±»è·¯å¾„æ‰«æå’Œæ‰˜ç®¡ç»„ä»¶</h2><ul>
<li>@Component,@Controller,@Repository,@Service</li>
<li>@Scope,@SessionScope</li>
<li>@ComponentScan</li>
</ul>
<h2 id="JSR-330æ ‡å‡†æ³¨è§£å’ŒSpringæ³¨è§£å¯¹ç…§"><a href="#JSR-330æ ‡å‡†æ³¨è§£å’ŒSpringæ³¨è§£å¯¹ç…§" class="headerlink" title="JSR 330æ ‡å‡†æ³¨è§£å’ŒSpringæ³¨è§£å¯¹ç…§"></a>JSR 330æ ‡å‡†æ³¨è§£å’ŒSpringæ³¨è§£å¯¹ç…§</h2><table>
<thead>
<tr>
<th>Spring</th>
<th>javax.inject.*</th>
</tr>
</thead>
<tbody><tr>
<td>@Autowired</td>
<td>@Inject</td>
</tr>
<tr>
<td>@Component</td>
<td>@Named / @ManagedBean</td>
</tr>
<tr>
<td>@Scope(â€œsingletonâ€)</td>
<td>@Singleton</td>
</tr>
<tr>
<td>@Qualifier</td>
<td>@Qualifier / @Named</td>
</tr>
<tr>
<td>@Value</td>
<td>-</td>
</tr>
<tr>
<td>@Required</td>
<td>-</td>
</tr>
<tr>
<td>@Lazy</td>
<td>-</td>
</tr>
<tr>
<td>ObjectFactory</td>
<td>Provider</td>
</tr>
</tbody></table>
<h1 id="Environment-æŠ½è±¡"><a href="#Environment-æŠ½è±¡" class="headerlink" title="Environment æŠ½è±¡"></a>Environment æŠ½è±¡</h1><p>ä¸»è¦åŒ…å«ä¸¤ä¸ªæ–¹é¢ï¼šprofilesï¼ˆå¤šç¯å¢ƒï¼‰ and propertiesï¼ˆé…ç½®ï¼‰.</p>
<h2 id="å¤šç¯å¢ƒé…ç½®"><a href="#å¤šç¯å¢ƒé…ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½®"></a>å¤šç¯å¢ƒé…ç½®</h2><ol>
<li>ä»£ç æ–¹å¼</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">ctx.getEnvironment().setActiveProfiles(<span class="string">&quot;development&quot;</span>);</span><br><span class="line">ctx.register(SomeConfig.class, StandaloneDataConfig.class, JndiDataConfig.class);</span><br><span class="line">ctx.refresh();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é…ç½®æ–¹å¼</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.profiles.active</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®æŠ½è±¡"><a href="#é…ç½®æŠ½è±¡" class="headerlink" title="é…ç½®æŠ½è±¡"></a>é…ç½®æŠ½è±¡</h2><p>ä»£ç æ¼”ç¤ºä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext ctx = <span class="keyword">new</span> GenericApplicationContext();</span><br><span class="line">Environment env = ctx.getEnvironment();</span><br><span class="line"><span class="comment">// æ˜¯å¦åŒ…å«fooçš„é…ç½®</span></span><br><span class="line"><span class="keyword">boolean</span> containsFoo = env.containsProperty(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Does my environment contain the &#x27;foo&#x27; property? &quot;</span> + containsFoo);</span><br><span class="line"><span class="comment">// å‘ç¯å¢ƒä¸­æ·»åŠ é…ç½®</span></span><br><span class="line">MutablePropertySources sources = ctx.getEnvironment().getPropertySources();</span><br><span class="line">sources.addFirst(<span class="keyword">new</span> MyPropertySource());</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>@PropertySource</code>æ·»åŠ é…ç½®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/myco/app.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Environment env;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestBean <span class="title">testBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TestBean testBean = <span class="keyword">new</span> TestBean();</span><br><span class="line">        testBean.setName(env.getProperty(<span class="string">&quot;testbean.name&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> testBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="BeanFactoryè¿˜æ˜¯ApplicationContextï¼Ÿ"><a href="#BeanFactoryè¿˜æ˜¯ApplicationContextï¼Ÿ" class="headerlink" title="BeanFactoryè¿˜æ˜¯ApplicationContextï¼Ÿ"></a>BeanFactoryè¿˜æ˜¯ApplicationContextï¼Ÿ</h1><p>å°½é‡ä½¿ç”¨<code>ApplicationContext</code>ï¼Œå› ä¸º<code>ApplicationContext</code>åŒ…å«<code>BeanFactory</code>çš„æ‰€æœ‰åŠŸèƒ½ï¼š</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>BeanFactory</th>
<th>ApplicationContext</th>
</tr>
</thead>
<tbody><tr>
<td>beanåˆå§‹åŒ–/ç¼–è¾‘</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>è‡ªåŠ¨æ³¨å†Œ<code>BeanPostProcessor</code></td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>è‡ªåŠ¨æ³¨å†Œ<code>BeanFactoryPostProcessor</code></td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>æ–¹ä¾¿çš„MessageSourceè®¿é—®ï¼ˆé€‚ç”¨äºi18nï¼‰</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>å‘å¸ƒ<code>ApplicationEvent</code></td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
</tbody></table>
<p>è¦ä½¿ç”¨BeanFactoryå®ç°æ˜¾å¼æ³¨å†Œbeanåç½®å¤„ç†å™¨ï¼Œæ‚¨éœ€è¦ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DefaultListableBeanFactory factory = <span class="keyword">new</span> DefaultListableBeanFactory();</span><br><span class="line"><span class="comment">// populate the factory with bean definitions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// now register any needed BeanPostProcessor instances</span></span><br><span class="line">MyBeanPostProcessor postProcessor = <span class="keyword">new</span> MyBeanPostProcessor();</span><br><span class="line">factory.addBeanPostProcessor(postProcessor);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now start using the factory</span></span><br></pre></td></tr></table></figure>

<p>è¦ä½¿ç”¨<code>BeanFactory</code>å®ç°æ—¶æ˜¾å¼æ³¨å†Œ<code>BeanFactoryPostProcessor</code>ï¼Œæ‚¨å¿…é¡»ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DefaultListableBeanFactory factory = <span class="keyword">new</span> DefaultListableBeanFactory();</span><br><span class="line">XmlBeanDefinitionReader reader = <span class="keyword">new</span> XmlBeanDefinitionReader(factory);</span><br><span class="line">reader.loadBeanDefinitions(<span class="keyword">new</span> FileSystemResource(<span class="string">&quot;beans.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// bring in some property values from a Properties file</span></span><br><span class="line">PropertyPlaceholderConfigurer cfg = <span class="keyword">new</span> PropertyPlaceholderConfigurer();</span><br><span class="line">cfg.setLocation(<span class="keyword">new</span> FileSystemResource(<span class="string">&quot;jdbc.properties&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// now actually do the replacement</span></span><br><span class="line">cfg.postProcessBeanFactory(factory);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆäºŒï¼‰RabbitMQ</title>
    <url>/p/45284/</url>
    <content><![CDATA[<h1 id="åœ¨Ubuntuä¸Šå®‰è£…RabbitMQ"><a href="#åœ¨Ubuntuä¸Šå®‰è£…RabbitMQ" class="headerlink" title="åœ¨Ubuntuä¸Šå®‰è£…RabbitMQ"></a>åœ¨Ubuntuä¸Šå®‰è£…RabbitMQ</h1><h2 id="ç³»ç»Ÿåˆå§‹åŒ–"><a href="#ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–"></a>ç³»ç»Ÿåˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt dist-upgrade</span><br><span class="line">$ sudo apt autoremove</span><br><span class="line">$ sudo apt clean</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 127.0.0.1 mq &gt; /etc/hosts</span><br><span class="line">$ <span class="built_in">echo</span> rabbitmq &gt; /etc/hostname</span><br><span class="line">$ <span class="built_in">export</span> HOSTNAME=mq</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="æ­å»ºrabbitmqæœåŠ¡"><a href="#æ­å»ºrabbitmqæœåŠ¡" class="headerlink" title="æ­å»ºrabbitmqæœåŠ¡"></a>æ­å»ºrabbitmqæœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;deb http://www.rabbitmq.com/debian/ testing main&#x27;</span>| sudo tee /etc/apt/sources.list.d/rabbitmq.list</span><br><span class="line">$ wget -O- https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | sudo apt-key add -</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install rabbitmq-server</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºç®¡ç†è´¦æˆ·"><a href="#åˆ›å»ºç®¡ç†è´¦æˆ·" class="headerlink" title="åˆ›å»ºç®¡ç†è´¦æˆ·"></a>åˆ›å»ºç®¡ç†è´¦æˆ·</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo rabbitmqctl add_user <span class="built_in">test</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ sudo rabbitmqctl add_vhost /<span class="built_in">test</span></span><br><span class="line">$ sudo rabbitmqctl set_user_tags <span class="built_in">test</span> administrator</span><br><span class="line"></span><br><span class="line">$ sudo rabbitmqctl set_permissions -p /<span class="built_in">test</span> <span class="built_in">test</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br><span class="line">$ sudo rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>

<h1 id="AMQPè§„èŒƒ"><a href="#AMQPè§„èŒƒ" class="headerlink" title="AMQPè§„èŒƒ"></a>AMQPè§„èŒƒ</h1><p>AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œåè®®ã€‚å®ƒæ”¯æŒç¬¦åˆè¦æ±‚çš„å®¢æˆ·ç«¯åº”ç”¨ï¼ˆapplicationï¼‰å’Œæ¶ˆæ¯ä¸­é—´ä»¶ä»£ç†ï¼ˆmessaging middleware brokerï¼‰ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p>
<h2 id="æ¶ˆæ¯ä»£ç†å’Œä»–ä»¬æ‰€æ‰®æ¼”çš„è§’è‰²"><a href="#æ¶ˆæ¯ä»£ç†å’Œä»–ä»¬æ‰€æ‰®æ¼”çš„è§’è‰²" class="headerlink" title="æ¶ˆæ¯ä»£ç†å’Œä»–ä»¬æ‰€æ‰®æ¼”çš„è§’è‰²"></a>æ¶ˆæ¯ä»£ç†å’Œä»–ä»¬æ‰€æ‰®æ¼”çš„è§’è‰²</h2><p>æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokersï¼‰ä»å‘å¸ƒè€…ï¼ˆpublishersï¼‰äº¦ç§°ç”Ÿäº§è€…ï¼ˆproducersï¼‰é‚£å„¿æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®æ—¢å®šçš„è·¯ç”±è§„åˆ™æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯å‘é€ç»™å¤„ç†æ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚</p>
<p>ç”±äºAMQPæ˜¯ä¸€ä¸ªç½‘ç»œåè®®ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¸­çš„å‘å¸ƒè€…ï¼Œæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä»£ç† å¯ä»¥å­˜åœ¨äºä¸åŒçš„è®¾å¤‡ä¸Šã€‚</p>
<h2 id="AMQP-0-9-1-æ¨¡å‹ç®€ä»‹"><a href="#AMQP-0-9-1-æ¨¡å‹ç®€ä»‹" class="headerlink" title="AMQP 0-9-1 æ¨¡å‹ç®€ä»‹"></a>AMQP 0-9-1 æ¨¡å‹ç®€ä»‹</h2><p>AMQP 0-9-1çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼šæ¶ˆæ¯ï¼ˆmessageï¼‰è¢«å‘å¸ƒè€…ï¼ˆpublisherï¼‰å‘é€ç»™äº¤æ¢æœºï¼ˆexchangeï¼‰ï¼Œäº¤æ¢æœºå¸¸å¸¸è¢«æ¯”å–»æˆé‚®å±€æˆ–è€…é‚®ç®±ã€‚ç„¶åäº¤æ¢æœºå°†æ”¶åˆ°çš„æ¶ˆæ¯æ ¹æ®è·¯ç”±è§„åˆ™åˆ†å‘ç»™ç»‘å®šçš„é˜Ÿåˆ—ï¼ˆqueueï¼‰ã€‚æœ€åAMQPä»£ç†ä¼šå°†æ¶ˆæ¯æŠ•é€’ç»™è®¢é˜…äº†æ­¤é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…æ¶ˆè´¹è€…æŒ‰ç…§éœ€æ±‚è‡ªè¡Œè·å–ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/02/5ca2b9fc49b65.png"></p>
<blockquote>
<p>é˜Ÿåˆ—ï¼Œäº¤æ¢æœºå’Œç»‘å®šç»Ÿç§°ä¸ºAMQPå®ä½“ï¼ˆAMQP entitiesï¼‰ã€‚</p>
</blockquote>
<h2 id="äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹"><a href="#äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹" class="headerlink" title="äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹"></a>äº¤æ¢æœºå’Œäº¤æ¢æœºç±»å‹</h2><p>äº¤æ¢æœºæ˜¯ç”¨æ¥å‘é€æ¶ˆæ¯çš„AMQPå®ä½“ã€‚äº¤æ¢æœºæ‹¿åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¹‹åå°†å®ƒè·¯ç”±ç»™ä¸€ä¸ªæˆ–é›¶ä¸ªé˜Ÿåˆ—ã€‚å®ƒä½¿ç”¨å“ªç§è·¯ç”±ç®—æ³•æ˜¯ç”±äº¤æ¢æœºç±»å‹å’Œè¢«ç§°ä½œç»‘å®šï¼ˆbindingsï¼‰çš„è§„åˆ™æ‰€å†³å®šçš„ã€‚AMQP 0-9-1çš„ä»£ç†æä¾›äº†å››ç§äº¤æ¢æœº</p>
<table>
<thead>
<tr>
<th>Nameï¼ˆäº¤æ¢æœºç±»å‹ï¼‰</th>
<th>Default pre-declared namesï¼ˆé¢„å£°æ˜çš„é»˜è®¤åç§°ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>Direct exchangeï¼ˆç›´è¿äº¤æ¢æœºï¼‰</td>
<td>(Empty string) and amq.direct</td>
</tr>
<tr>
<td>Fanout exchangeï¼ˆæ‰‡å‹äº¤æ¢æœºï¼‰</td>
<td>amq.fanout</td>
</tr>
<tr>
<td>Topic exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰</td>
<td>amq.topic</td>
</tr>
<tr>
<td>Headers exchangeï¼ˆå¤´äº¤æ¢æœºï¼‰</td>
<td>amq.match (and amq.headers in RabbitMQ)</td>
</tr>
</tbody></table>
<p>é™¤äº¤æ¢æœºç±»å‹å¤–ï¼Œåœ¨å£°æ˜äº¤æ¢æœºæ—¶è¿˜å¯ä»¥é™„å¸¦è®¸å¤šå…¶ä»–çš„å±æ€§ï¼Œå…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Name</li>
<li>Durability ï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œäº¤æ¢æœºæ˜¯å¦è¿˜å­˜åœ¨ï¼‰</li>
<li>Auto-delete ï¼ˆå½“æ‰€æœ‰ä¸ä¹‹ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½å®Œæˆäº†å¯¹æ­¤äº¤æ¢æœºçš„ä½¿ç”¨åï¼Œåˆ æ‰å®ƒï¼‰</li>
<li>Argumentsï¼ˆä¾èµ–ä»£ç†æœ¬èº«ï¼‰</li>
</ul>
<p>äº¤æ¢æœºå¯ä»¥æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šæŒä¹…ï¼ˆdurableï¼‰ã€æš‚å­˜ï¼ˆtransientï¼‰ã€‚æŒä¹…åŒ–çš„äº¤æ¢æœºä¼šåœ¨æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰é‡å¯åä¾æ—§å­˜åœ¨ï¼Œè€Œæš‚å­˜çš„äº¤æ¢æœºåˆ™ä¸ä¼šï¼ˆå®ƒä»¬éœ€è¦åœ¨ä»£ç†å†æ¬¡ä¸Šçº¿åé‡æ–°è¢«å£°æ˜ï¼‰ã€‚</p>
<h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p>AMQPä¸­çš„é˜Ÿåˆ—ï¼ˆqueueï¼‰è·Ÿå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„é˜Ÿåˆ—æ˜¯å¾ˆç›¸ä¼¼çš„ï¼šå®ƒä»¬å­˜å‚¨ç€å³å°†è¢«åº”ç”¨æ¶ˆè´¹æ‰çš„æ¶ˆæ¯ã€‚</p>
<p>é˜Ÿåˆ—è·Ÿäº¤æ¢æœºå…±äº«æŸäº›å±æ€§ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¹Ÿæœ‰ä¸€äº›å¦å¤–çš„å±æ€§ã€‚</p>
<ul>
<li>Name</li>
<li>Durableï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œé˜Ÿåˆ—ä¾æ—§å­˜åœ¨ï¼‰</li>
<li>Exclusiveï¼ˆåªè¢«ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰ä½¿ç”¨ï¼Œè€Œä¸”å½“è¿æ¥å…³é—­åé˜Ÿåˆ—å³è¢«åˆ é™¤ï¼‰</li>
<li>Auto-deleteï¼ˆå½“æœ€åä¸€ä¸ªæ¶ˆè´¹è€…é€€è®¢åå³è¢«åˆ é™¤ï¼‰</li>
<li>Argumentsï¼ˆä¸€äº›æ¶ˆæ¯ä»£ç†ç”¨ä»–æ¥å®Œæˆç±»ä¼¼ä¸TTLçš„æŸäº›é¢å¤–åŠŸèƒ½ï¼‰</li>
</ul>
<p>é˜Ÿåˆ—åœ¨å£°æ˜ï¼ˆdeclareï¼‰åæ‰èƒ½è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—å°šä¸å­˜åœ¨ï¼Œå£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ä¼šåˆ›å»ºå®ƒã€‚å¦‚æœå£°æ˜çš„é˜Ÿåˆ—å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å±æ€§å®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆæ­¤æ¬¡å£°æ˜ä¸ä¼šå¯¹åŸæœ‰é˜Ÿåˆ—äº§ç”Ÿä»»ä½•å½±å“ã€‚å¦‚æœå£°æ˜ä¸­çš„å±æ€§ä¸å·²å­˜åœ¨é˜Ÿåˆ—çš„å±æ€§æœ‰å·®å¼‚ï¼Œé‚£ä¹ˆä¸€ä¸ªé”™è¯¯ä»£ç ä¸º406çš„é€šé“çº§å¼‚å¸¸å°±ä¼šè¢«æŠ›å‡ºã€‚</p>
<h2 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h2><p>ç»‘å®šï¼ˆBindingï¼‰æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰å°†æ¶ˆæ¯ï¼ˆmessageï¼‰è·¯ç”±ç»™é˜Ÿåˆ—ï¼ˆqueueï¼‰æ‰€éœ€éµå¾ªçš„è§„åˆ™ã€‚</p>
<h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><ul>
<li>å°†æ¶ˆæ¯æŠ•é€’ç»™åº”ç”¨ (â€œpush APIâ€)</li>
<li>åº”ç”¨æ ¹æ®éœ€è¦ä¸»åŠ¨è·å–æ¶ˆæ¯ (â€œpull APIâ€)</li>
</ul>
<h3 id="æ¶ˆæ¯ç¡®è®¤"><a href="#æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤"></a>æ¶ˆæ¯ç¡®è®¤</h3><ul>
<li>è‡ªåŠ¨ç¡®è®¤ï¼šå½“æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰å°†æ¶ˆæ¯å‘é€ç»™åº”ç”¨åç«‹å³åˆ é™¤ã€‚</li>
<li>æ˜¾å¼ç¡®è®¤ï¼šå¾…åº”ç”¨ï¼ˆapplicationï¼‰å‘é€ä¸€ä¸ªç¡®è®¤å›æ‰§ï¼ˆacknowledgementï¼‰åå†åˆ é™¤æ¶ˆæ¯ã€‚</li>
</ul>
<h3 id="æ‹’ç»æ¶ˆæ¯"><a href="#æ‹’ç»æ¶ˆæ¯" class="headerlink" title="æ‹’ç»æ¶ˆæ¯"></a>æ‹’ç»æ¶ˆæ¯</h3><p>å½“æ‹’ç»ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥</p>
<ul>
<li>é”€æ¯æ¶ˆæ¯</li>
<li>é‡æ–°æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—</li>
</ul>
<p>å½“æ­¤é˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œè¯·ç¡®è®¤ä¸è¦ç”±äºæ‹’ç»æ¶ˆæ¯å¹¶ä¸”é€‰æ‹©äº†é‡æ–°æ”¾å…¥é˜Ÿåˆ—çš„è¡Œä¸ºè€Œå¼•èµ·æ¶ˆæ¯åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…èº«ä¸Šæ— é™å¾ªç¯çš„æƒ…å†µå‘ç”Ÿã€‚</p>
<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><ul>
<li>ç”Ÿäº§(Producing)çš„æ„æ€å°±æ˜¯å‘é€ã€‚å‘é€æ¶ˆæ¯çš„ç¨‹åºå°±æ˜¯ä¸€ä¸ªç”Ÿäº§è€…(producer)ã€‚æˆ‘ä»¬ä¸€èˆ¬ç”¨â€Pâ€æ¥è¡¨ç¤º:<br><img data-src="https://i.loli.net/2019/04/02/5ca23898ea5b0.png"></li>
<li>é˜Ÿåˆ—(queue)å°±æ˜¯å­˜åœ¨äºRabbitMQä¸­é‚®ç®±çš„åç§°ã€‚è™½ç„¶æ¶ˆæ¯çš„ä¼ è¾“ç»è¿‡äº†RabbitMQå’Œä½ çš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å®ƒåªèƒ½è¢«å­˜å‚¨äºé˜Ÿåˆ—å½“ä¸­ã€‚å®è´¨ä¸Šé˜Ÿåˆ—å°±æ˜¯ä¸ªå·¨å¤§çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå®ƒçš„å¤§å°åªå—ä¸»æœºå†…å­˜å’Œç¡¬ç›˜é™åˆ¶ã€‚å¤šä¸ªç”Ÿäº§è€…ï¼ˆproducersï¼‰å¯ä»¥æŠŠæ¶ˆæ¯å‘é€ç»™åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒæ ·ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ä¹Ÿèƒ½å¤Ÿä»åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰ä¸­è·å–æ•°æ®ã€‚é˜Ÿåˆ—å¯ä»¥ç»˜åˆ¶æˆè¿™æ ·ï¼ˆå›¾ä¸Šæ˜¯é˜Ÿåˆ—çš„åç§°ï¼‰ï¼š<br><img data-src="https://i.loli.net/2019/04/02/5ca238ab81f7c.png"></li>
<li>åœ¨è¿™é‡Œï¼Œæ¶ˆè´¹ï¼ˆConsumingï¼‰å’Œæ¥æ”¶(receiving)æ˜¯åŒä¸€ä¸ªæ„æ€ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰å°±æ˜¯ä¸€ä¸ªç­‰å¾…è·å–æ¶ˆæ¯çš„ç¨‹åºã€‚æˆ‘ä»¬æŠŠå®ƒç»˜åˆ¶ä¸ºâ€Câ€ï¼š<br><img data-src="https://i.loli.net/2019/04/02/5ca238bd84a4a.png"></li>
</ul>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ä»£ç†éœ€ä¸è¦å¾…åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šï¼›äº‹å®ä¸Šå¤§å¤šæ•°åº”ç”¨ä¹Ÿç¡®å®ä¸åœ¨ä¼šå°†ä»–ä»¬æ”¾åœ¨ä¸€å°æœºå™¨ä¸Šã€‚</p>
<p>åˆ›å»ºgradleé¡¹ç›®ï¼Œå¹¶é…ç½®build.gradleï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">compile group: <span class="string">&#x27;com.rabbitmq&#x27;</span>, name: <span class="string">&#x27;amqp-client&#x27;</span>, version: <span class="string">&#x27;5.6.0&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºç”Ÿäº§è€…"><a href="#åˆ›å»ºç”Ÿäº§è€…" class="headerlink" title="åˆ›å»ºç”Ÿäº§è€…"></a>åˆ›å»ºç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºRabbitMQè¿æ¥å·¥å‚</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">// 2. è®¾ç½®host,rabbitmq-serverçš„ç›‘å¬åœ°å€</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        <span class="comment">// 4. åˆ›å»ºé¢‘é“</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">// 5. è¿æ¥åˆ°å…·ä½“é¢‘é“</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        String message = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="comment">// 6. å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot; [x] Sent &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºæ¶ˆè´¹è€…"><a href="#åˆ›å»ºæ¶ˆè´¹è€…" class="headerlink" title="åˆ›å»ºæ¶ˆè´¹è€…"></a>åˆ›å»ºæ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Recv</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        <span class="comment">// 4. åˆ›å»ºé¢‘é“</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            String message = <span class="keyword">new</span> String(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot; [x] Received &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="keyword">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éœ€è¦å£°æ˜æ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æˆ‘ä»¬å…ˆæ‰§è¡ŒSend.mainï¼Œæ§åˆ¶å°å°†æ‰“å°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[x] Sent &#x27;Hello World!&#x27;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡ŒRecv.mainï¼Œæ§åˆ¶å°å°†æ‰“å°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] Waiting for messages. To exit press CTRL+C</span><br><span class="line">[x] Received &#x27;Hello World!&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—"></a>ä»»åŠ¡é˜Ÿåˆ—</h1><p><img data-src="https://i.loli.net/2019/04/01/5ca21485049c7.png"></p>
<p>å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆç§°ï¼šä»»åŠ¡é˜Ÿåˆ—â€”â€”Task Queuesï¼‰æ˜¯ä¸ºäº†é¿å…ç­‰å¾…ä¸€äº›å ç”¨å¤§é‡èµ„æºã€æ—¶é—´çš„æ“ä½œã€‚å½“æˆ‘ä»¬æŠŠä»»åŠ¡ï¼ˆTaskï¼‰å½“ä½œæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªè¿è¡Œåœ¨åå°çš„å·¥ä½œè€…ï¼ˆworkerï¼‰è¿›ç¨‹å°±ä¼šå–å‡ºä»»åŠ¡ç„¶åå¤„ç†ã€‚å½“ä½ è¿è¡Œå¤šä¸ªå·¥ä½œè€…ï¼ˆworkersï¼‰ï¼Œä»»åŠ¡å°±ä¼šåœ¨å®ƒä»¬ä¹‹é—´å…±äº«ã€‚</p>
<p>è¿™ä¸ªæ¦‚å¿µåœ¨ç½‘ç»œåº”ç”¨ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒå¯ä»¥åœ¨çŸ­æš‚çš„HTTPè¯·æ±‚ä¸­å¤„ç†ä¸€äº›å¤æ‚çš„ä»»åŠ¡ã€‚</p>
<p>ä¿®æ”¹<a href="#%E5%88%9B%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85">Send.java</a>ä»£ç ï¼Œæ¥é—´éš”10ç§’å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">    String message = String.format(<span class="string">&quot;å‘é€ç¬¬%dæ¡æ¶ˆæ¯&quot;</span>, i);</span><br><span class="line">    <span class="comment">// 6. å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">    channel.basicPublish(<span class="string">&quot;&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">    System.out.println(<span class="string">&quot; [x] Sent &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹<a href="#%E5%88%9B%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85">Recv.java</a>ï¼Œæ¥å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œè¿™é‡Œï¼Œå‡è£…ä»»åŠ¡æ‰§è¡Œéœ€è¦è€—æ—¶1sï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">    String message = <span class="keyword">new</span> String(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot; [x] Received &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        doWork(message);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; [x] Done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="keyword">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">(String task)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> ch : task.toCharArray()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å…ˆå¼€å¯Recv.javaï¼Œç„¶åå¼€å¯Send.javaï¼Œæ§åˆ¶å°å°†ä¼šæ‰“å°</p>
<p>Send.java</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[x] Sent &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Sent &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Sent &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27;</span><br></pre></td></tr></table></figure>

<p>Recv.java</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] Waiting for messages. To exit press CTRL+C</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Done</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Done</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="å¾ªç¯è°ƒåº¦"><a href="#å¾ªç¯è°ƒåº¦" class="headerlink" title="å¾ªç¯è°ƒåº¦"></a>å¾ªç¯è°ƒåº¦</h2><p>ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å®ƒèƒ½å¤Ÿå¹¶è¡Œçš„å¤„ç†é˜Ÿåˆ—ã€‚å¦‚æœå †ç§¯äº†å¾ˆå¤šä»»åŠ¡ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ æ›´å¤šçš„å·¥ä½œè€…ï¼ˆworkersï¼‰å°±å¯ä»¥äº†ï¼Œæ‰©å±•å¾ˆç®€å•ã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•åŒæ—¶è¿è¡Œä¸¤ä¸ªworkerå®ä¾‹ï¼Œä»–ä»¬éƒ½ä¼šä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼š</p>
<p>Send.java</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[x] Sent &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Sent &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Sent &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27;</span><br></pre></td></tr></table></figure>

<p>Recv.java-1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] Waiting for messages. To exit press CTRL+C</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬1æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Done</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬3æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Done</span><br></pre></td></tr></table></figure>

<p>Recv.java-2</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] Waiting for messages. To exit press CTRL+C</span><br><span class="line">[x] Received &#x27;å‘é€ç¬¬2æ¡æ¶ˆæ¯&#x27;</span><br><span class="line">[x] Done</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æ¥è¯´ï¼ŒRabbitMQä¼šæŒ‰é¡ºåºå¾—æŠŠæ¶ˆæ¯å‘é€ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚å¹³å‡æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°åŒç­‰æ•°é‡å¾—æ¶ˆæ¯ã€‚è¿™ç§å‘é€æ¶ˆæ¯å¾—æ–¹å¼å«åšâ€”â€”è½®è¯¢ï¼ˆround-robinï¼‰ã€‚è¯•ç€æ·»åŠ ä¸‰ä¸ªæˆ–æ›´å¤šå¾—å·¥ä½œè€…ï¼ˆworkersï¼‰ã€‚</p>
<h2 id="æ¶ˆæ¯ç¡®è®¤-1"><a href="#æ¶ˆæ¯ç¡®è®¤-1" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤"></a>æ¶ˆæ¯ç¡®è®¤</h2><p>å½“å¤„ç†ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶å¾—ä»»åŠ¡çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸æƒ³çŸ¥é“æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰æ˜¯å¦è¿è¡Œåˆ°ä¸€åŠå°±æŒ‚æ‰ã€‚å½“å‰çš„ä»£ç ä¸­ï¼Œå½“æ¶ˆæ¯è¢«RabbitMQå‘é€ç»™æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ä¹‹åï¼Œé©¬ä¸Šå°±ä¼šåœ¨å†…å­˜ä¸­ç§»é™¤ã€‚è¿™ç§æƒ…å†µï¼Œä½ åªè¦æŠŠä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰åœæ­¢ï¼Œæ­£åœ¨å¤„ç†çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚åŒæ—¶ï¼Œæ‰€æœ‰å‘é€åˆ°è¿™ä¸ªå·¥ä½œè€…çš„è¿˜æ²¡æœ‰å¤„ç†çš„æ¶ˆæ¯éƒ½ä¼šä¸¢å¤±ã€‚</p>
<p>æˆ‘ä»¬ä¸æƒ³ä¸¢å¤±ä»»ä½•ä»»åŠ¡æ¶ˆæ¯ã€‚å¦‚æœä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ä»»åŠ¡ä¼šé‡æ–°å‘é€ç»™å…¶ä»–çš„å·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼ŒRabbitMQæä¾›äº†æ¶ˆæ¯å“åº”ï¼ˆacknowledgmentsï¼‰ã€‚æ¶ˆè´¹è€…ä¼šé€šè¿‡ä¸€ä¸ªackï¼ˆå“åº”ï¼‰ï¼Œå‘Šè¯‰RabbitMQå·²ç»æ”¶åˆ°å¹¶å¤„ç†äº†æŸæ¡æ¶ˆæ¯ï¼Œç„¶åRabbitMQå°±ä¼šé‡Šæ”¾å¹¶åˆ é™¤è¿™æ¡æ¶ˆæ¯ã€‚</p>
<p>å¦‚æœæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æŒ‚æ‰äº†ï¼Œæ²¡æœ‰å‘é€å“åº”ï¼ŒRabbitMQå°±ä¼šè®¤ä¸ºæ¶ˆæ¯æ²¡æœ‰è¢«å®Œå…¨å¤„ç†ï¼Œç„¶åé‡æ–°å‘é€ç»™å…¶ä»–æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚è¿™æ ·ï¼ŒåŠæ—¶å·¥ä½œè€…ï¼ˆworkersï¼‰å¶å°”çš„æŒ‚æ‰ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚</p>
<p>æ¶ˆæ¯æ˜¯æ²¡æœ‰è¶…æ—¶è¿™ä¸ªæ¦‚å¿µçš„ï¼›å½“å·¥ä½œè€…ä¸å®ƒæ–­å¼€è¿çš„æ—¶å€™ï¼ŒRabbitMQä¼šé‡æ–°å‘é€æ¶ˆæ¯ã€‚è¿™æ ·åœ¨å¤„ç†ä¸€ä¸ªè€—æ—¶éå¸¸é•¿çš„æ¶ˆæ¯ä»»åŠ¡çš„æ—¶å€™å°±ä¸ä¼šå‡ºé—®é¢˜äº†ã€‚</p>
<p>æ¶ˆæ¯å“åº”é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ä¹‹å‰çš„ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨no_ack=Trueæ ‡è¯†æŠŠå®ƒå…³é—­ã€‚æ˜¯æ—¶å€™ç§»é™¤è¿™ä¸ªæ ‡è¯†äº†ï¼Œå½“å·¥ä½œè€…ï¼ˆworkerï¼‰å®Œæˆäº†ä»»åŠ¡ï¼Œå°±å‘é€ä¸€ä¸ªå“åº”ã€‚</p>
<p>ä¿®æ”¹Worker.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€æ¬¡åªæ¥å—ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">channel.basicQos(<span class="number">1</span>);</span><br><span class="line">DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">    String message = <span class="keyword">new</span> String(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot; [x] Received &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        doWork(message);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">boolean</span> autoAck = <span class="keyword">false</span>;</span><br><span class="line">channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å‘ç°å³ä½¿ä½¿ç”¨CTRL+Cæ€æ‰äº†ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰è¿›ç¨‹ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚å½“å·¥ä½œè€…ï¼ˆworkerï¼‰æŒ‚æ‰è¿™åï¼Œæ‰€æœ‰æ²¡æœ‰å“åº”çš„æ¶ˆæ¯éƒ½ä¼šé‡æ–°å‘é€ã€‚</p>
<h2 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h2><p>å¦‚æœä½ æ²¡æœ‰ç‰¹æ„å‘Šè¯‰RabbitMQï¼Œé‚£ä¹ˆåœ¨å®ƒé€€å‡ºæˆ–è€…å´©æºƒçš„æ—¶å€™ï¼Œå°†ä¼šä¸¢å¤±æ‰€æœ‰é˜Ÿåˆ—å’Œæ¶ˆæ¯ã€‚ä¸ºäº†ç¡®ä¿ä¿¡æ¯ä¸ä¼šä¸¢å¤±ï¼Œæœ‰ä¸¤ä¸ªäº‹æƒ…æ˜¯éœ€è¦æ³¨æ„çš„ï¼šæˆ‘ä»¬å¿…é¡»æŠŠâ€œé˜Ÿåˆ—â€å’Œâ€œæ¶ˆæ¯â€è®¾ä¸ºæŒä¹…åŒ–ã€‚</p>
<p>é¦–å…ˆï¼Œä¸ºäº†ä¸è®©é˜Ÿåˆ—æ¶ˆå¤±ï¼Œéœ€è¦æŠŠé˜Ÿåˆ—å£°æ˜ä¸ºæŒä¹…åŒ–ï¼ˆdurableï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> durable = <span class="keyword">true</span>;</span><br><span class="line">channel.queueDeclare(QUEUE_NAME, durable, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡è¿™è¡Œä»£ç æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä»ç„¶ä¸ä¼šæ­£ç¡®è¿è¡Œã€‚å› ä¸ºæˆ‘ä»¬å·²ç»å®šä¹‰è¿‡ä¸€ä¸ªå«helloçš„éæŒä¹…åŒ–é˜Ÿåˆ—ã€‚RabbitMqä¸å…è®¸ä½ ä½¿ç”¨ä¸åŒçš„å‚æ•°é‡æ–°å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ä½†æˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸ªå¿«æ·çš„è§£å†³æ–¹æ³•â€”â€”ç”¨ä¸åŒçš„åå­—ï¼Œä¾‹å¦‚task_queueã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> durable = <span class="keyword">true</span>;</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;task_queue&quot;</span>, durable, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®ä¿åœ¨RabbitMqé‡å¯ä¹‹åqueue_declareé˜Ÿåˆ—ä¸ä¼šä¸¢å¤±ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…æ€§ - é€šè¿‡å°†MessagePropertiesï¼ˆå®ç°BasicPropertiesï¼‰è®¾ç½®ä¸ºå€¼PERSISTENT_TEXT_PLAINã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class="line"></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, <span class="string">&quot;task_queue&quot;</span>,</span><br><span class="line">            MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class="line">            message.getBytes());</span><br></pre></td></tr></table></figure>

<h2 id="å…¬å¹³è°ƒåº¦"><a href="#å…¬å¹³è°ƒåº¦" class="headerlink" title="å…¬å¹³è°ƒåº¦"></a>å…¬å¹³è°ƒåº¦</h2><p>ä½ åº”è¯¥å·²ç»å‘ç°ï¼Œå®ƒä»æ—§æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬æœŸæœ›çš„é‚£æ ·è¿›è¡Œåˆ†å‘ã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå·¥ä½œè€…ï¼ˆworkersï¼‰ï¼Œå¤„ç†å¥‡æ•°æ¶ˆæ¯çš„æ¯”è¾ƒç¹å¿™ï¼Œå¤„ç†å¶æ•°æ¶ˆæ¯çš„æ¯”è¾ƒè½»æ¾ã€‚ç„¶è€ŒRabbitMQå¹¶ä¸çŸ¥é“è¿™äº›ï¼Œå®ƒä»ç„¶ä¸€å¦‚æ—¢å¾€çš„æ´¾å‘æ¶ˆæ¯ã€‚</p>
<p>è¿™æ—¶å› ä¸ºRabbitMQåªç®¡åˆ†å‘è¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¸ä¼šå…³å¿ƒæœ‰å¤šå°‘æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ²¡æœ‰ä½œå‡ºå“åº”ã€‚å®ƒç›²ç›®çš„æŠŠç¬¬n-thæ¡æ¶ˆæ¯å‘ç»™ç¬¬n-thä¸ªæ¶ˆè´¹è€…ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/02/5ca238f761f47.png"></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨basicQosæ–¹æ³•ï¼Œå¹¶è®¾ç½®<code>prefetchCount = 1</code>ã€‚è¿™æ ·æ˜¯å‘Šè¯‰RabbitMQï¼Œå†åŒä¸€æ—¶åˆ»ï¼Œä¸è¦å‘é€è¶…è¿‡1æ¡æ¶ˆæ¯ç»™ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰ï¼Œç›´åˆ°å®ƒå·²ç»å¤„ç†äº†ä¸Šä¸€æ¡æ¶ˆæ¯å¹¶ä¸”ä½œå‡ºäº†å“åº”ã€‚è¿™æ ·ï¼ŒRabbitMQå°±ä¼šæŠŠæ¶ˆæ¯åˆ†å‘ç»™ä¸‹ä¸€ä¸ªç©ºé—²çš„å·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> prefetchCount = <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure>

<h1 id="å‘å¸ƒï¼è®¢é˜…"><a href="#å‘å¸ƒï¼è®¢é˜…" class="headerlink" title="å‘å¸ƒï¼è®¢é˜…"></a>å‘å¸ƒï¼è®¢é˜…</h1><p>åœ¨ä¸Šç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œæ¯ä¸ªä»»åŠ¡åªåˆ†å‘ç»™ä¸€ä¸ªå·¥ä½œè€…ï¼ˆworkerï¼‰ã€‚åœ¨æœ¬ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦åšçš„è·Ÿä¹‹å‰å®Œå…¨ä¸ä¸€æ · â€”â€” åˆ†å‘ä¸€ä¸ªæ¶ˆæ¯ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä¸ºâ€œå‘å¸ƒï¼è®¢é˜…â€ã€‚</p>
<p>ä¸ºäº†æè¿°è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å°†ä¼šæ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚</p>
<h2 id="äº¤æ¢æœºï¼ˆExchangesï¼‰"><a href="#äº¤æ¢æœºï¼ˆExchangesï¼‰" class="headerlink" title="äº¤æ¢æœºï¼ˆExchangesï¼‰"></a>äº¤æ¢æœºï¼ˆExchangesï¼‰</h2><p>RabbitMQä¸­å®Œæ•´çš„æ¶ˆæ¯æ¨¡å‹ï¼š</p>
<ul>
<li>å‘å¸ƒè€…ï¼ˆproducerï¼‰æ˜¯å‘å¸ƒæ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</li>
<li>é˜Ÿåˆ—ï¼ˆqueueï¼‰ç”¨äºæ¶ˆæ¯å­˜å‚¨çš„ç¼“å†²ã€‚</li>
<li>æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ˜¯æ¥æ”¶æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<p>RabbitMQæ¶ˆæ¯æ¨¡å‹çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼šå‘å¸ƒè€…ï¼ˆproducerï¼‰ä¸ä¼šç›´æ¥å‘é€ä»»ä½•æ¶ˆæ¯ç»™é˜Ÿåˆ—ã€‚äº‹å®ä¸Šï¼Œå‘å¸ƒè€…ï¼ˆproducerï¼‰ç”šè‡³ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦å·²ç»è¢«æŠ•é€’åˆ°é˜Ÿåˆ—ã€‚</p>
<p>å‘å¸ƒè€…ï¼ˆproducerï¼‰åªéœ€è¦æŠŠæ¶ˆæ¯å‘é€ç»™ä¸€ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰ã€‚äº¤æ¢æœºéå¸¸ç®€å•ï¼Œå®ƒä¸€è¾¹ä»å‘å¸ƒè€…æ–¹æ¥æ”¶æ¶ˆæ¯ï¼Œä¸€è¾¹æŠŠæ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯åº”è¯¥æ¨é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—è¿˜æ˜¯æ˜¯å¤šä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ˜¯ç›´æ¥å¿½ç•¥æ¶ˆæ¯ã€‚è¿™äº›è§„åˆ™æ˜¯é€šè¿‡äº¤æ¢æœºç±»å‹ï¼ˆexchange typeï¼‰æ¥å®šä¹‰çš„ã€‚</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca22e6de6cab.png"></p>
<p>æœ‰å‡ ä¸ªå¯ä¾›é€‰æ‹©çš„äº¤æ¢æœºç±»å‹ï¼šç›´è¿äº¤æ¢æœºï¼ˆdirectï¼‰, ä¸»é¢˜äº¤æ¢æœºï¼ˆtopicï¼‰, ï¼ˆå¤´äº¤æ¢æœºï¼‰headerså’Œ æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¸»è¦è¯´æ˜æœ€åä¸€ä¸ª â€”â€” æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰ã€‚å…ˆåˆ›å»ºä¸€ä¸ªfanoutç±»å‹çš„äº¤æ¢æœºï¼Œå‘½åä¸ºlogsï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.exchangeDeclare(<span class="string">&quot;logs&quot;</span>, <span class="string">&quot;fanout&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰å¾ˆç®€å•ï¼Œä½ å¯èƒ½ä»åå­—ä¸Šå°±èƒ½çŒœæµ‹å‡ºæ¥ï¼Œå®ƒæŠŠæ¶ˆæ¯å‘é€ç»™å®ƒæ‰€çŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªå…·åäº¤æ¢æœºäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.basicPublish( <span class="string">&quot;logs&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">null</span>, message.getBytes());</span><br></pre></td></tr></table></figure>

<h2 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h2><p>è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li><p>å½“æˆ‘ä»¬è¿æ¥ä¸ŠRabbitMQçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ã€ç©ºçš„é˜Ÿåˆ—ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªéšæœºçš„é˜Ÿåˆ—åï¼Œæˆ–è€…è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºçš„é˜Ÿåˆ—åï¼ˆæ¨èï¼‰ã€‚</p>
</li>
<li><p>å½“ä¸æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰æ–­å¼€è¿æ¥çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—åº”å½“è¢«ç«‹å³åˆ é™¤ã€‚</p>
</li>
</ol>
<p>åœ¨Javaå®¢æˆ·ç«¯ä¸­ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰å‘queueDeclareï¼ˆï¼‰æä¾›å‚æ•°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆçš„åç§°åˆ›å»ºä¸€ä¸ªéæŒä¹…çš„ï¼Œç‹¬å çš„è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨åˆ†é…çš„éšæœºé˜Ÿåˆ—åï¼Œå¯èƒ½åƒè¿™æ · amq.gen-U0srCoW8TsaXjNh73pnVAw==</span></span><br><span class="line">String queueName = channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure>

<h2 id="ç»‘å®šï¼ˆBindingsï¼‰"><a href="#ç»‘å®šï¼ˆBindingsï¼‰" class="headerlink" title="ç»‘å®šï¼ˆBindingsï¼‰"></a>ç»‘å®šï¼ˆBindingsï¼‰</h2><p><img data-src="https://i.loli.net/2019/04/01/5ca230f4266fc.png"></p>
<p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ‰‡å‹äº¤æ¢æœºï¼ˆfanoutï¼‰å’Œä¸€ä¸ªé˜Ÿåˆ—ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰äº¤æ¢æœºå¦‚ä½•å‘é€æ¶ˆæ¯ç»™æˆ‘ä»¬çš„é˜Ÿåˆ—ã€‚äº¤æ¢å™¨å’Œé˜Ÿåˆ—ä¹‹é—´çš„è”ç³»æˆ‘ä»¬ç§°ä¹‹ä¸ºç»‘å®šï¼ˆbindingï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.queueBind(queueName, <span class="string">&quot;logs&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="è·¯ç”±-Routing"><a href="#è·¯ç”±-Routing" class="headerlink" title="è·¯ç”±(Routing)"></a>è·¯ç”±(Routing)</h1><p>å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºè¿‡ç»‘å®šï¼ˆbindingsï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç»‘å®šï¼ˆbindingï¼‰æ˜¯æŒ‡äº¤æ¢æœºï¼ˆexchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆqueueï¼‰çš„å…³ç³»ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šè¿™ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰å¯¹è¿™ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰çš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚</p>
<p>ç»‘å®šçš„æ—¶å€™å¯ä»¥å¸¦ä¸Šä¸€ä¸ªé¢å¤–çš„routing_keyå‚æ•°ã€‚ä¸ºäº†é¿å…ä¸basic_publishçš„å‚æ•°æ··æ·†ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšç»‘å®šé”®ï¼ˆbinding keyï¼‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¸¦ç»‘å®šé”®çš„ç»‘å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;black&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç»‘å®šé”®çš„æ„ä¹‰å–å†³äºäº¤æ¢æœºï¼ˆexchangeï¼‰çš„ç±»å‹ã€‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡çš„æ‰‡å‹äº¤æ¢æœºï¼ˆfanout exchangesï¼‰ä¼šå¿½ç•¥è¿™ä¸ªå€¼ã€‚</p>
<h2 id="ç›´è¿äº¤æ¢æœºï¼ˆDirect-exchangeï¼‰"><a href="#ç›´è¿äº¤æ¢æœºï¼ˆDirect-exchangeï¼‰" class="headerlink" title="ç›´è¿äº¤æ¢æœºï¼ˆDirect exchangeï¼‰"></a>ç›´è¿äº¤æ¢æœºï¼ˆDirect exchangeï¼‰</h2><p>æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå¹¿æ’­æ‰€æœ‰çš„æ¶ˆæ¯ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰ã€‚æˆ‘ä»¬æ‰“ç®—æ‰©å±•å®ƒï¼Œä½¿å…¶åŸºäºæ—¥å¿—çš„ä¸¥é‡ç¨‹åº¦è¿›è¡Œæ¶ˆæ¯è¿‡æ»¤ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨çš„æ‰‡å‹äº¤æ¢æœºï¼ˆfanout exchangeï¼‰æ²¡æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ â€”â€” å®ƒèƒ½åšçš„ä»…ä»…æ˜¯å¹¿æ’­ã€‚</p>
<p>æˆ‘ä»¬å°†ä¼šä½¿ç”¨ç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰æ¥ä»£æ›¿ã€‚è·¯ç”±çš„ç®—æ³•å¾ˆç®€å• â€”â€” äº¤æ¢æœºå°†ä¼šå¯¹ç»‘å®šé”®ï¼ˆbinding keyï¼‰å’Œè·¯ç”±é”®ï¼ˆrouting keyï¼‰è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä»è€Œç¡®å®šæ¶ˆæ¯è¯¥åˆ†å‘åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚</p>
<p>ä¸‹å›¾èƒ½å¤Ÿå¾ˆå¥½çš„æè¿°è¿™ä¸ªåœºæ™¯ï¼š</p>
<p><img data-src="https://i.loli.net/2019/04/01/5ca23254e4784.png"></p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´è¿äº¤æ¢æœº Xå’Œä¸¤ä¸ªé˜Ÿåˆ—è¿›è¡Œäº†ç»‘å®šã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä½¿ç”¨orangeä½œä¸ºç»‘å®šé”®ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—æœ‰ä¸¤ä¸ªç»‘å®šï¼Œä¸€ä¸ªä½¿ç”¨blackä½œä¸ºç»‘å®šé”®ï¼Œå¦å¤–ä¸€ä¸ªä½¿ç”¨greenã€‚</p>
<p>è¿™æ ·ä»¥æ¥ï¼Œå½“è·¯ç”±é”®ä¸ºorangeçš„æ¶ˆæ¯å‘å¸ƒåˆ°äº¤æ¢æœºï¼Œå°±ä¼šè¢«è·¯ç”±åˆ°é˜Ÿåˆ—Q1ã€‚è·¯ç”±é”®ä¸ºblackæˆ–è€…greençš„æ¶ˆæ¯å°±ä¼šè·¯ç”±åˆ°Q2ã€‚å…¶ä»–çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<h2 id="å¤šä¸ªç»‘å®šï¼ˆMultiple-bindingsï¼‰"><a href="#å¤šä¸ªç»‘å®šï¼ˆMultiple-bindingsï¼‰" class="headerlink" title="å¤šä¸ªç»‘å®šï¼ˆMultiple bindingsï¼‰"></a>å¤šä¸ªç»‘å®šï¼ˆMultiple bindingsï¼‰</h2><p><img data-src="https://i.loli.net/2019/04/01/5ca2330e8a92f.png"></p>
<p>å¤šä¸ªé˜Ÿåˆ—ä½¿ç”¨ç›¸åŒçš„ç»‘å®šé”®æ˜¯åˆæ³•çš„ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªXå’ŒQ1ä¹‹é—´çš„ç»‘å®šï¼Œä½¿ç”¨blackç»‘å®šé”®ã€‚è¿™æ ·ä¸€æ¥ï¼Œç›´è¿äº¤æ¢æœºå°±å’Œæ‰‡å‹äº¤æ¢æœºçš„è¡Œä¸ºä¸€æ ·ï¼Œä¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ã€‚å¸¦æœ‰blackè·¯ç”±é”®çš„æ¶ˆæ¯ä¼šåŒæ—¶å‘é€åˆ°Q1å’ŒQ2ã€‚</p>
<h2 id="å‘é€æ—¥å¿—"><a href="#å‘é€æ—¥å¿—" class="headerlink" title="å‘é€æ—¥å¿—"></a>å‘é€æ—¥å¿—</h2><p>æˆ‘ä»¬å°†ä¼šå‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ŒæŠŠæ—¥å¿—çº§åˆ«ä½œä¸ºè·¯ç”±é”®ã€‚è¿™æ ·æ¥æ”¶æ—¥å¿—çš„è„šæœ¬å°±å¯ä»¥æ ¹æ®ä¸¥é‡çº§åˆ«æ¥é€‰æ‹©å®ƒæƒ³è¦å¤„ç†çš„æ—¥å¿—ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹å‘é€æ—¥å¿—ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºï¼ˆexchangeï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;direct&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å‘é€ä¸€åˆ™æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">channel.basicPublish(EXCHANGE_NAME, severity, <span class="keyword">null</span>, message.getBytes());</span><br></pre></td></tr></table></figure>

<h2 id="è®¢é˜…"><a href="#è®¢é˜…" class="headerlink" title="è®¢é˜…"></a>è®¢é˜…</h2><p>å¤„ç†æ¥æ”¶æ¶ˆæ¯çš„æ–¹å¼å’Œä¹‹å‰å·®ä¸å¤šï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œæˆ‘ä»¬å°†ä¼šä¸ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ¯ä¸ªä¸¥é‡çº§åˆ«åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæ–°çš„ç»‘å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String queueName = channel.queueDeclare().getQueue();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(String severity : argv)&#123;</span><br><span class="line">  channel.queueBind(queueName, EXCHANGE_NAME, severity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p><img data-src="https://i.loli.net/2019/04/01/5ca2339a9dd56.png"></p>
<p><a href="">Routing</a></p>
<h1 id="ä¸»é¢˜äº¤æ¢æœº"><a href="#ä¸»é¢˜äº¤æ¢æœº" class="headerlink" title="ä¸»é¢˜äº¤æ¢æœº"></a>ä¸»é¢˜äº¤æ¢æœº</h1><p>ç›´è¿äº¤æ¢æœºçš„é™åˆ¶ â€”â€” æ²¡åŠæ³•åŸºäºå¤šä¸ªæ ‡å‡†æ‰§è¡Œè·¯ç”±æ“ä½œã€‚</p>
<p>å‘é€åˆ°ä¸»é¢˜äº¤æ¢æœºï¼ˆtopic exchangeï¼‰çš„æ¶ˆæ¯ä¸å¯ä»¥æºå¸¦éšæ„ä»€ä¹ˆæ ·å­çš„è·¯ç”±é”®ï¼ˆrouting_keyï¼‰ï¼Œå®ƒçš„è·¯ç”±é”®å¿…é¡»æ˜¯ä¸€ä¸ªç”±<code>.</code>åˆ†éš”å¼€çš„è¯è¯­åˆ—è¡¨ã€‚è¿™äº›å•è¯éšä¾¿æ˜¯ä»€ä¹ˆéƒ½å¯ä»¥ï¼Œä½†æ˜¯æœ€å¥½æ˜¯è·Ÿæºå¸¦å®ƒä»¬çš„æ¶ˆæ¯æœ‰å…³ç³»çš„è¯æ±‡ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªæ¨èçš„ä¾‹å­ï¼šâ€stock.usd.nyseâ€, â€œnyse.vmwâ€, â€œquick.orange.rabbitâ€ã€‚è¯è¯­çš„ä¸ªæ•°å¯ä»¥éšæ„ï¼Œä½†æ˜¯ä¸è¦è¶…è¿‡255å­—èŠ‚ã€‚</p>
<p>ç»‘å®šé”®ä¹Ÿå¿…é¡»æ‹¥æœ‰åŒæ ·çš„æ ¼å¼ã€‚ä¸»é¢˜äº¤æ¢æœºèƒŒåçš„é€»è¾‘è·Ÿç›´è¿äº¤æ¢æœºå¾ˆç›¸ä¼¼ â€”â€” ä¸€ä¸ªæºå¸¦ç€ç‰¹å®šè·¯ç”±é”®çš„æ¶ˆæ¯ä¼šè¢«ä¸»é¢˜äº¤æ¢æœºæŠ•é€’ç»™ç»‘å®šé”®ä¸ä¹‹æƒ³åŒ¹é…çš„é˜Ÿåˆ—ã€‚ä½†æ˜¯å®ƒçš„ç»‘å®šé”®å’Œè·¯ç”±é”®æœ‰ä¸¤ä¸ªç‰¹æ®Šåº”ç”¨æ–¹å¼ï¼š</p>
<ul>
<li><code>*</code> (æ˜Ÿå·) ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå•è¯.</li>
<li><code>#</code> (äº•å·) ç”¨æ¥è¡¨ç¤ºä»»æ„æ•°é‡ï¼ˆé›¶ä¸ªæˆ–å¤šä¸ªï¼‰å•è¯ã€‚</li>
</ul>
<p>ä¸‹è¾¹ç”¨å›¾è¯´æ˜ï¼š</p>
<p><img data-src="https://i.loli.net/2019/04/02/5ca23915b99b2.png"></p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªç»‘å®šï¼šQ1çš„ç»‘å®šé”®ä¸º <code>*.orange.*</code>ï¼ŒQ2çš„ç»‘å®šé”®ä¸º <code>*.*.rabbit</code> å’Œ <code>lazy.#</code> ã€‚</p>
<p>è¿™ä¸‰ä¸ªç»‘å®šé”®è¢«å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ul>
<li>Q1 å¯¹<em>æ‰€æœ‰çš„æ¡”é»„è‰²åŠ¨ç‰©</em>éƒ½æ„Ÿå…´è¶£ã€‚</li>
<li>Q2 åˆ™æ˜¯å¯¹<em>æ‰€æœ‰çš„å…”å­</em>å’Œ<em>æ‰€æœ‰æ‡’æƒ°çš„åŠ¨ç‰©</em>æ„Ÿå…´è¶£ã€‚</li>
</ul>
<blockquote>
<p>ä¸»é¢˜äº¤æ¢æœºæ˜¯å¾ˆå¼ºå¤§çš„ï¼Œå®ƒå¯ä»¥è¡¨ç°å‡ºè·Ÿå…¶ä»–äº¤æ¢æœºç±»ä¼¼çš„è¡Œä¸º</p>
<p>å½“ä¸€ä¸ªé˜Ÿåˆ—çš„ç»‘å®šé”®ä¸º â€œ#â€ï¼ˆäº•å·ï¼‰ çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°†ä¼šæ— è§†æ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œæ¥æ”¶æ‰€æœ‰çš„æ¶ˆæ¯ã€‚</p>
<p>å½“ <code>*</code> (æ˜Ÿå·) å’Œ <code>#</code> (äº•å·) è¿™ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦éƒ½æœªåœ¨ç»‘å®šé”®ä¸­å‡ºç°çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»é¢˜äº¤æ¢æœºå°±æ‹¥æœ‰çš„ç›´è¿äº¤æ¢æœºçš„è¡Œä¸ºã€‚</p>
</blockquote>
<h1 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰</h1><p>å¦‚æœæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå‡½æ•°è¿è¡Œåœ¨è¿œç¨‹è®¡ç®—æœºä¸Šå¹¶ä¸”ç­‰å¾…ä»é‚£å„¿è·å–ç»“æœæ—¶ï¼Œè¿™ç§æ¨¡å¼é€šå¸¸è¢«ç§°ä¸ºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼‰æˆ–è€…RPCã€‚</p>
<p>æˆ‘ä»¬ä¼šä½¿ç”¨RabbitMQæ¥æ„å»ºä¸€ä¸ªRPCç³»ç»Ÿï¼šåŒ…å«ä¸€ä¸ªå®¢æˆ·ç«¯å’Œä¸€ä¸ªRPCæœåŠ¡å™¨ã€‚</p>
<h2 id="å®¢æˆ·ç«¯æ¥å£"><a href="#å®¢æˆ·ç«¯æ¥å£" class="headerlink" title="å®¢æˆ·ç«¯æ¥å£"></a>å®¢æˆ·ç«¯æ¥å£</h2><p>ä¸ºäº†å±•ç¤ºRPCæœåŠ¡å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ç±»ã€‚å®ƒä¼šæš´éœ²å‡ºä¸€ä¸ªåä¸ºâ€œcallâ€çš„æ–¹æ³•ç”¨æ¥å‘é€ä¸€ä¸ªRPCè¯·æ±‚ï¼Œå¹¶ä¸”åœ¨æ”¶åˆ°å›åº”å‰ä¿æŒé˜»å¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FibonacciRpcClient fibonacciRpc = <span class="keyword">new</span> FibonacciRpcClient();</span><br><span class="line">String result = fibonacciRpc.call(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">System.out.println( <span class="string">&quot;fib(4) is &quot;</span> + result);</span><br></pre></td></tr></table></figure>

<h3 id="å›è°ƒé˜Ÿåˆ—"><a href="#å›è°ƒé˜Ÿåˆ—" class="headerlink" title="å›è°ƒé˜Ÿåˆ—"></a>å›è°ƒé˜Ÿåˆ—</h3><p>ä¸€èˆ¬æ¥è¯´é€šè¿‡RabbitMQæ¥å®ç°RPCæ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€è¯·æ±‚ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ç«¯å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ªå›å¤ä¿¡æ¯ä¸­ã€‚ä¸ºäº†æ¥æ”¶åˆ°å›å¤ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯éœ€è¦åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™åŒæ—¶å‘é€ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼ˆcallback queueï¼‰çš„åœ°å€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">callbackQueueName = channel.queueDeclare().getQueue();</span><br><span class="line"></span><br><span class="line">BasicProperties props = <span class="keyword">new</span> BasicProperties</span><br><span class="line">                            .Builder()</span><br><span class="line">                            .replyTo(callbackQueueName)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, <span class="string">&quot;rpc_queue&quot;</span>, props, message.getBytes());</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="æ¶ˆæ¯å±æ€§"><a href="#æ¶ˆæ¯å±æ€§" class="headerlink" title="æ¶ˆæ¯å±æ€§"></a>æ¶ˆæ¯å±æ€§</h4><p>AMQPåè®®ç»™æ¶ˆæ¯é¢„å®šä¹‰äº†ä¸€ç³»åˆ—çš„14ä¸ªå±æ€§ã€‚å¤§å¤šæ•°å±æ€§å¾ˆå°‘ä¼šç”¨åˆ°ï¼Œé™¤äº†ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>delivery_modeï¼ˆæŠ•é€’æ¨¡å¼ï¼‰ï¼šå°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…çš„ï¼ˆå€¼ä¸º2ï¼‰æˆ–æš‚å­˜çš„ï¼ˆé™¤äº†2ä¹‹å¤–çš„å…¶ä»–ä»»ä½•å€¼ï¼‰ã€‚ç¬¬äºŒç¯‡æ•™ç¨‹é‡Œæ¥è§¦è¿‡è¿™ä¸ªå±æ€§ï¼Œè®°å¾—å§ï¼Ÿ</li>
<li>content_typeï¼ˆå†…å®¹ç±»å‹ï¼‰:ç”¨æ¥æè¿°ç¼–ç çš„mime-typeã€‚ä¾‹å¦‚åœ¨å®é™…ä½¿ç”¨ä¸­å¸¸å¸¸ä½¿ç”¨application/jsonæ¥æè¿°JOSNç¼–ç ç±»å‹ã€‚</li>
<li>reply_toï¼ˆå›å¤ç›®æ ‡ï¼‰ï¼šé€šå¸¸ç”¨æ¥å‘½åå›è°ƒé˜Ÿåˆ—ã€‚</li>
<li>correlation_idï¼ˆå…³è”æ ‡è¯†ï¼‰ï¼šç”¨æ¥å°†RPCçš„å“åº”å’Œè¯·æ±‚å…³è”èµ·æ¥ã€‚</li>
</ul>
</blockquote>
<h3 id="å…³è”æ ‡è¯†"><a href="#å…³è”æ ‡è¯†" class="headerlink" title="å…³è”æ ‡è¯†"></a>å…³è”æ ‡è¯†</h3><p>ä¸Šè¾¹ä»‹ç»çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å»ºè®®ç»™æ¯ä¸€ä¸ªRPCè¯·æ±‚æ–°å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„åšæ³•ï¼Œå¹¸å¥½è¿™å„¿æœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³• â€”â€” æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åªå»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„å›è°ƒé˜Ÿåˆ—ã€‚</p>
<p>è¿™å°±å¸¦æ¥ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå½“æ­¤é˜Ÿåˆ—æ¥æ”¶åˆ°ä¸€ä¸ªå“åº”çš„æ—¶å€™å®ƒæ— æ³•è¾¨åˆ«å‡ºè¿™ä¸ªå“åº”æ˜¯å±äºå“ªä¸ªè¯·æ±‚çš„ã€‚<strong>correlation_id</strong> å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæ¥çš„ã€‚æˆ‘ä»¬ç»™æ¯ä¸ªè¯·æ±‚è®¾ç½®ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ã€‚ç¨åï¼Œå½“æˆ‘ä»¬ä»å›è°ƒé˜Ÿåˆ—ä¸­æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹è¿™æ¡å±æ€§ä»è€Œå°†å“åº”å’Œè¯·æ±‚åŒ¹é…èµ·æ¥ã€‚å¦‚æœæˆ‘ä»¬æ¥æ‰‹åˆ°çš„æ¶ˆæ¯çš„correlation_idæ˜¯æœªçŸ¥çš„ï¼Œé‚£å°±ç›´æ¥é”€æ¯æ‰å®ƒï¼Œå› ä¸ºå®ƒä¸å±äºæˆ‘ä»¬çš„ä»»ä½•ä¸€æ¡è¯·æ±‚ã€‚</p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¥æ”¶åˆ°æœªçŸ¥æ¶ˆæ¯çš„æ—¶å€™ä¸æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€Œæ˜¯è¦å°†å®ƒå¿½ç•¥æ‰ï¼Ÿè¿™æ˜¯ä¸ºäº†è§£å†³æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½å‘ç”Ÿçš„ç«äº‰æƒ…å†µã€‚å°½ç®¡å¯èƒ½æ€§ä¸å¤§ï¼Œä½†RPCæœåŠ¡å™¨è¿˜æ˜¯æœ‰å¯èƒ½åœ¨å·²å°†åº”ç­”å‘é€ç»™æˆ‘ä»¬ä½†è¿˜æœªå°†ç¡®è®¤æ¶ˆæ¯å‘é€ç»™è¯·æ±‚çš„æƒ…å†µä¸‹æ­»æ‰ã€‚å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒRPCåœ¨é‡å¯åä¼šé‡æ–°å¤„ç†è¯·æ±‚ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨å®¢æˆ·ç«¯ä¼˜é›…çš„å¤„ç†é‡å¤å“åº”ï¼ŒåŒæ—¶RPCä¹Ÿéœ€è¦å°½å¯èƒ½ä¿æŒå¹‚ç­‰æ€§ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img data-src="https://i.loli.net/2019/04/02/5ca236b2abcea.png"></p>
<p>æˆ‘ä»¬çš„RPCå¦‚æ­¤å·¥ä½œ:</p>
<ul>
<li>å½“å®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªåŒ¿åç‹¬äº«çš„å›è°ƒé˜Ÿåˆ—ã€‚</li>
<li>åœ¨RPCè¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€å¸¦æœ‰ä¸¤ä¸ªå±æ€§çš„æ¶ˆæ¯ï¼šä¸€ä¸ªæ˜¯è®¾ç½®å›è°ƒé˜Ÿåˆ—çš„ <em>reply_to</em> å±æ€§ï¼Œå¦ä¸€ä¸ªæ˜¯è®¾ç½®å”¯ä¸€å€¼çš„ <em>correlation_id</em> å±æ€§ã€‚</li>
<li>å°†è¯·æ±‚å‘é€åˆ°ä¸€ä¸ª <em>rpc_queue</em> é˜Ÿåˆ—ä¸­ã€‚</li>
<li>RPCå·¥ä½œè€…ï¼ˆåˆåï¼šæœåŠ¡å™¨ï¼‰ç­‰å¾…è¯·æ±‚å‘é€åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­æ¥ã€‚å½“è¯·æ±‚å‡ºç°çš„æ—¶å€™ï¼Œå®ƒæ‰§è¡Œä»–çš„å·¥ä½œå¹¶ä¸”å°†å¸¦æœ‰æ‰§è¡Œç»“æœçš„æ¶ˆæ¯å‘é€ç»™reply_toå­—æ®µæŒ‡å®šçš„é˜Ÿåˆ—ã€‚</li>
<li>å®¢æˆ·ç«¯ç­‰å¾…å›è°ƒé˜Ÿåˆ—é‡Œçš„æ•°æ®ã€‚å½“æœ‰æ¶ˆæ¯å‡ºç°çš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æŸ¥correlation_idå±æ€§ã€‚å¦‚æœæ­¤å±æ€§çš„å€¼ä¸è¯·æ±‚åŒ¹é…ï¼Œå°†å®ƒè¿”å›ç»™åº”ç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿ç»´ç¬”è®°ï¼ˆéƒ¨ç½²ç¯‡ï¼‰</title>
    <url>/p/8505/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é’ˆå¯¹<code>Ubuntu 16.04</code>ï¼Œæ±‡æ€»å¸¸ç”¨æœåŠ¡çš„æ­å»ºæŒ‡å—ã€‚</p>
<span id="more"></span>

<h1 id="ç³»ç»Ÿåˆå§‹åŒ–"><a href="#ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–"></a>ç³»ç»Ÿåˆå§‹åŒ–</h1><blockquote>
<p>æ–°ä¹°çš„ECSéœ€è¦æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt dist-upgrade</span><br><span class="line">$ sudo apt autoremove</span><br><span class="line">$ sudo apt clean</span><br><span class="line"></span><br><span class="line">$ cat /etc/hosts <span class="comment"># ä¿®æ”¹hostsï¼Œä¸€èˆ¬å°†æœ¬æœºéœ€è¦ä½¿ç”¨çš„å¤–éƒ¨å†…ç½‘æœåŠ¡è®¾ç½®æ˜ å°„ä¸ºåç§°</span></span><br><span class="line">172.16.0.192    kftest-config01</span><br><span class="line"></span><br><span class="line">$ cat /etc/hostname <span class="comment"># ä¿®æ”¹hostnameï¼Œä¾¿äºè¾¨è®¤</span></span><br><span class="line">pg_1</span><br><span class="line"></span><br><span class="line">$ reboot <span class="comment"># ä¿®æ”¹hostnameéœ€è¦é‡å¯ç”Ÿæ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½æ•°æ®ç›˜ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘æ•°æ®ç›˜ https://help.aliyun.com/document_detail/25446.html</span></span><br><span class="line">$ sudo fdisk -l <span class="comment"># æŸ¥çœ‹å®ä¾‹ä¸Šçš„æ•°æ®ç›˜</span></span><br><span class="line">Disk /dev/vdb: 1000 GiB, 1073741824000 bytes, 2097152000 sectors</span><br><span class="line">$ sudo fdisk -u /dev/vdb</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">... ä¸€è·¯enter</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://help.aliyun.com/document_detail/108501.html</span></span><br><span class="line">$ sudo fdisk -lu /dev/vdb</span><br><span class="line">Device     Boot Start        End    Sectors  Size Id Type</span><br><span class="line">/dev/vdb1        2048 2097151999 2097149952 1000G 83 Linux</span><br><span class="line">$ sudo mkfs.ext4 /dev/vdb1 <span class="comment"># åœ¨æ–°åˆ†åŒºä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line"></span><br><span class="line">$ cp /etc/fstab /etc/fstab.bak <span class="comment"># å¤‡ä»½ etc/fstab</span></span><br><span class="line">$ <span class="built_in">echo</span> /dev/vdb1 /data ext4 defaults 0 0 &gt;&gt; /etc/fstab <span class="comment"># å‘ /etc/fstab å†™å…¥æ–°åˆ†åŒºä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">$ sudo mkdir /data</span><br><span class="line">$ sudo mount /dev/vdb1 /data <span class="comment"># æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line"></span><br><span class="line">$ df -h</span><br><span class="line">/dev/vdb1       985G   72M  935G   1% /data</span><br></pre></td></tr></table></figure>

<h1 id="Postgresql"><a href="#Postgresql" class="headerlink" title="Postgresql"></a>Postgresql</h1><h2 id="å®‰è£…Postgresql"><a href="#å®‰è£…Postgresql" class="headerlink" title="å®‰è£…Postgresql"></a>å®‰è£…Postgresql</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb http://apt.postgresql.org/pub/repos/apt/ <span class="subst">$(lsb_release -cs)</span>-pgdg main&quot;</span> | sudo tee /etc/apt/sources.list.d/pgdg.list</span><br><span class="line">$ wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install postgresql-9.6 <span class="comment"># è‡ªè¡Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/download/linux/ubuntu/</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vim /etc/postgresql/9.6/main/postgresql.conf</span><br><span class="line">listen_addresses = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">max_connections = 1000</span><br><span class="line">logging_collector = on</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/runtime-config.html</span></span><br><span class="line"> </span><br><span class="line">$ sudo vim /etc/postgresql/9.6/main/pg_hba.conf</span><br><span class="line">host    all             all             0.0.0.0/0             md5</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html</span></span><br><span class="line">   </span><br><span class="line">$ sudo service postgresql restart</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹é»˜è®¤ç”¨æˆ·Postgresçš„å¯†ç "><a href="#ä¿®æ”¹é»˜è®¤ç”¨æˆ·Postgresçš„å¯†ç " class="headerlink" title="ä¿®æ”¹é»˜è®¤ç”¨æˆ·Postgresçš„å¯†ç "></a>ä¿®æ”¹é»˜è®¤ç”¨æˆ·Postgresçš„å¯†ç </h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -u postgres psql</span><br><span class="line"><span class="comment"># ALTER USER postgres WITH PASSWORD &#x27;postgres&#x27;;</span></span><br><span class="line"><span class="comment"># \q</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="æ­å»ºé›†ç¾¤ï¼ˆå¯é€‰ï¼‰"><a href="#æ­å»ºé›†ç¾¤ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æ­å»ºé›†ç¾¤ï¼ˆå¯é€‰ï¼‰"></a>æ­å»ºé›†ç¾¤ï¼ˆå¯é€‰ï¼‰</h2><table>
<thead>
<tr>
<th align="center">ä¸»æœº</th>
<th align="center">ip</th>
</tr>
</thead>
<tbody><tr>
<td align="center">MasterèŠ‚ç‚¹</td>
<td align="center">10.10.10.10</td>
</tr>
<tr>
<td align="center">SlaveèŠ‚ç‚¹</td>
<td align="center">10.10.10.9</td>
</tr>
</tbody></table>
<p>MasterèŠ‚ç‚¹å’ŒSlaveèŠ‚ç‚¹åˆ†åˆ«æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å®‰è£…å®Œæˆ<code>postgres</code>åï¼Œå¼€å§‹æ­å»ºé›†ç¾¤ã€‚</p>
<h3 id="masterèŠ‚ç‚¹ï¼š"><a href="#masterèŠ‚ç‚¹ï¼š" class="headerlink" title="masterèŠ‚ç‚¹ï¼š"></a>masterèŠ‚ç‚¹ï¼š</h3><ol>
<li>ä¿®æ”¹é…ç½®</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sudo vi /etc/postgresql/9.6/main/postgresql.conf</span><br><span class="line">listen_addresses = &#x27;*&#x27;</span><br><span class="line">wal_level = hot_standby</span><br><span class="line">archive_mode = on</span><br><span class="line">archive_command = &#x27;test ! -f /var/lib/postgresql/9.6/archive/%f &amp;&amp; cp %p /var/lib/postgresql/9.6/archive/%f&#x27;</span><br><span class="line">max_wal_senders = 16</span><br><span class="line">wal_keep_segments = 100</span><br><span class="line">hot_standby = on</span><br><span class="line">logging_collector = on</span><br><span class="line">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/runtime-config.html</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/postgresql/9.6/main/pg_hba.conf</span><br><span class="line">host    all             all             10.0.0.0/8              md5</span><br><span class="line">host    replication     repuser         10.0.0.0/8              md5</span><br><span class="line">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html</span><br><span class="line">  </span><br><span class="line">$ sudo -upostgres mkdir /var/lib/postgresql/9.6/archive</span><br><span class="line">$ sudo chmod 0700 /var/lib/postgresql/9.6/archive</span><br><span class="line">  </span><br><span class="line">$ sudo service postgresql restart</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºå·¥ä½œè´¦æˆ· repuser</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -upostgres createuser --replication repuser</span><br><span class="line">$ sudo -upostgres psql</span><br><span class="line">postgres=<span class="comment"># \password repuser</span></span><br><span class="line">&lt;password&gt;</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/user-manag.html</span></span><br></pre></td></tr></table></figure>

<h3 id="slaveèŠ‚ç‚¹ï¼š"><a href="#slaveèŠ‚ç‚¹ï¼š" class="headerlink" title="slaveèŠ‚ç‚¹ï¼š"></a>slaveèŠ‚ç‚¹ï¼š</h3><ol>
<li>å…ˆåœæ­¢æœåŠ¡</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo service postgresql stop</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç”±masterèŠ‚ç‚¹å¯¼å…¥æ•°æ®ï¼ˆpostgres å…å¯†ç ç™»å½• repuser roleï¼‰</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -upostgres vi /var/lib/postgresql/.pgpass</span><br><span class="line">10.10.10.10:5432:*:repuser:&lt;password&gt;</span><br><span class="line">127.0.0.1:5432:*:repuser:&lt;password&gt;</span><br><span class="line"> </span><br><span class="line">$ sudo chmod 0600 /var/lib/postgresql/.pgpass</span><br><span class="line">$ sudo mv /var/lib/postgresql/9.6/main /var/lib/postgresql/9.6/main.bak</span><br><span class="line">$ sudo -upostgres pg_basebackup -D /var/lib/postgresql/9.6/main -F p -X stream -v -R -h 10.10.10.10 -p 5432 -U repuser</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¿®æ”¹é…ç½®</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vi /var/lib/postgresql/9.6/main/recovery.conf</span><br><span class="line">standby_mode = <span class="string">&#x27;on&#x27;</span></span><br><span class="line">primary_conninfo = <span class="string">&#x27;user=repuser host=10.10.10.10 port=5432&#x27;</span></span><br><span class="line">trigger_file = <span class="string">&#x27;failover.now&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://www.postgresql.org/docs/current/static/recovery-config.html</span></span><br><span class="line">  </span><br><span class="line">$ sudo vi /etc/postgresql/9.6/main/postgresql.conf</span><br><span class="line">hot_standby = on</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é‡å¯å¹¶æ£€æŸ¥æœåŠ¡</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo service postgresql start</span><br><span class="line">  </span><br><span class="line">$ sudo service postgresql status</span><br><span class="line">...</span><br><span class="line">Active: active (exited)</span><br><span class="line"></span><br><span class="line">$ sudo -upostgres psql</span><br><span class="line">psql (9.6.12)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•é›†ç¾¤"><a href="#æµ‹è¯•é›†ç¾¤" class="headerlink" title="æµ‹è¯•é›†ç¾¤"></a>æµ‹è¯•é›†ç¾¤</h3><p>åœ¨masterèŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œå¯¹ç…§çœ‹slaveèŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿä»masterèŠ‚ç‚¹å¤åˆ¶æ“ä½œ</p>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo service postgresql start</span><br><span class="line">$ sudo service postgresql status</span><br><span class="line">$ sudo service postgresql restart</span><br></pre></td></tr></table></figure>

<p>ğŸ‘‰ <a href="https://gcdd1993.github.io/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/PG%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">PGæ•°æ®åº“å¸¸ç”¨å‘½ä»¤</a></p>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="å®‰è£…Redisï¼ˆå•æœºï¼‰"><a href="#å®‰è£…Redisï¼ˆå•æœºï¼‰" class="headerlink" title="å®‰è£…Redisï¼ˆå•æœºï¼‰"></a>å®‰è£…Redisï¼ˆå•æœºï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install redis-server</span><br><span class="line">$ sudo vim /etc/redis/redis.conf</span><br><span class="line"><span class="comment"># bind 127.0.0.1</span></span><br><span class="line">$ sudo systemctl restart redis-server</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…Redisï¼ˆé›†ç¾¤ï¼‰"><a href="#å®‰è£…Redisï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="å®‰è£…Redisï¼ˆé›†ç¾¤ï¼‰"></a>å®‰è£…Redisï¼ˆé›†ç¾¤ï¼‰</h2><table>
<thead>
<tr>
<th align="center">ä¸»æœº</th>
<th align="center">ip</th>
<th align="center">redis-server</th>
<th align="center">sentinel</th>
</tr>
</thead>
<tbody><tr>
<td align="center">node01</td>
<td align="center">10.10.10.5</td>
<td align="center">ä¸»</td>
<td align="center">âˆš</td>
</tr>
<tr>
<td align="center">node02</td>
<td align="center">10.10.10.4</td>
<td align="center">ä»</td>
<td align="center">âˆš</td>
</tr>
<tr>
<td align="center">node03</td>
<td align="center">10.10.10.6</td>
<td align="center">ä»</td>
<td align="center">âˆš</td>
</tr>
</tbody></table>
<h3 id="å®‰è£…-Redis-Server"><a href="#å®‰è£…-Redis-Server" class="headerlink" title="å®‰è£… Redis-Server"></a>å®‰è£… Redis-Server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node01:</span><br><span class="line">$ sudo apt-get install redis-server</span><br><span class="line">$ sudo vi /etc/redis/redis.conf</span><br><span class="line"><span class="built_in">bind</span>: 10.10.10.5</span><br><span class="line"></span><br><span class="line">$ sudo service redis-server restart</span><br><span class="line"></span><br><span class="line">node02:</span><br><span class="line">$ sudo apt-get install redis-server</span><br><span class="line">$ sudo vi /etc/redis/redis.conf</span><br><span class="line"><span class="built_in">bind</span>: 10.10.10.4</span><br><span class="line">slaveof 10.10.10.5</span><br><span class="line"> </span><br><span class="line">$ sudo service redis-server restart</span><br><span class="line"></span><br><span class="line">node03 åŒnode02</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•ä¸»ä»åŒæ­¥"><a href="#æµ‹è¯•ä¸»ä»åŒæ­¥" class="headerlink" title="æµ‹è¯•ä¸»ä»åŒæ­¥"></a>æµ‹è¯•ä¸»ä»åŒæ­¥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node01:</span><br><span class="line">$ redis-cli -h 10.10.10.5 -p 6379</span><br><span class="line">10.10.10.5:6379&gt;info</span><br><span class="line">....</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=10.10.10.4,port=6379,state=online,offset=99,lag=0</span><br><span class="line">slave1:ip=10.10.10.6,port=6379,state=online,offset=99,lag=1</span><br><span class="line">master_repl_offset:99</span><br><span class="line">....</span><br><span class="line">10.10.10.5:6379&gt;<span class="built_in">set</span> testkey testvalue</span><br><span class="line">OK</span><br><span class="line">10.10.10.5:6379&gt;get testkey</span><br><span class="line"><span class="string">&quot;testvalue&quot;</span></span><br><span class="line">  </span><br><span class="line">node02:</span><br><span class="line">$ redis-cli -h 10.10.10.4 -p 6379</span><br><span class="line">10.9.8.203:6379&gt;info</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:10.10.10.5</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br><span class="line">10.10.10.4:6379&gt;get testkey</span><br><span class="line"><span class="string">&quot;testvalue&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-Sentinelï¼ˆå¯é€‰ï¼‰"><a href="#é…ç½®-Sentinelï¼ˆå¯é€‰ï¼‰" class="headerlink" title="é…ç½® Sentinelï¼ˆå¯é€‰ï¼‰"></a>é…ç½® Sentinelï¼ˆå¯é€‰ï¼‰</h3><blockquote>
<p>ä¸€ä¸ªç¨³å¥çš„ <code>Redis Sentinel</code> é›†ç¾¤ï¼Œåº”è¯¥ä½¿ç”¨è‡³å°‘ <strong>ä¸‰ä¸ª</strong> <code>Sentinel</code> å®ä¾‹ï¼Œå¹¶ä¸”ä¿è¯å°†è¿™äº›å®ä¾‹æ”¾åˆ° <strong>ä¸åŒçš„æœºå™¨</strong> ä¸Šï¼Œç”šè‡³ä¸åŒçš„ <strong>ç‰©ç†åŒºåŸŸ</strong>ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo wget http://download.redis.io/redis-stable/sentinel.conf -O /etc/redis/sentinel.conf</span><br><span class="line">$ sudo chown redis:redis /etc/redis/sentinel.conf</span><br><span class="line">$ sudo vi /etc/redis/sentinel.conf</span><br><span class="line">sentinel monitor mymaster 10.10.10.5 6379 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 60000</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line"><span class="comment">## è‡ªå¯åŠ¨é…ç½®</span></span><br><span class="line">$ sudo vi /etc/redis/sentinel.service</span><br><span class="line">[Unit]</span><br><span class="line">Documentation=http://redis.io/topics/sentinel</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/redis-server /etc/redis/sentinel.conf --sentinel</span><br><span class="line">User=redis</span><br><span class="line">Group=redis</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">  </span><br><span class="line">$ sudo ln -s /etc/redis/sentinel.service /lib/systemd/system/sentinel.service</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> sentinel.service</span><br><span class="line">$ sudo service sentinel start</span><br><span class="line"></span><br><span class="line">node02 node03 sentinel é…ç½®åŒnode01ï¼Œæ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œæˆï¼Œå†ç»§ç»­ä¸‹ä¸€æ­¥</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®å¥½<code>sentinel</code>ä¹‹åï¼Œ<code>redis.conf</code>å’Œ<code>sentinel.conf</code>éƒ½ç”±<code>sentinel</code>æ¥ç®¡ï¼›<code>sentinel</code>ç›‘æ§ä¸»èŠ‚ç‚¹å‘ç”Ÿæ”¹å˜çš„è¯ï¼Œä¼šæ›´æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶<code>sentinel.conf</code>å’Œ<code>redis.conf</code>ã€‚</p>
</blockquote>
<h3 id="æµ‹è¯•Sentinelç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»"><a href="#æµ‹è¯•Sentinelç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»" class="headerlink" title="æµ‹è¯•Sentinelç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»"></a>æµ‹è¯•Sentinelç›‘æ§ã€é€šçŸ¥ã€è‡ªåŠ¨æ•…éšœè½¬ç§»</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹å“¨å…µé…ç½®</span></span><br><span class="line">node01,node02,node03:</span><br><span class="line">$ redis-cli -h 10.10.10.5 -p 26379</span><br><span class="line">10.10.10.5:26379&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:3.0.6</span><br><span class="line">...</span><br><span class="line">config_file:/etc/redis/sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sentinel</span></span><br><span class="line">sentinel_masters:1</span><br><span class="line">sentinel_tilt:0</span><br><span class="line">sentinel_running_scripts:0</span><br><span class="line">sentinel_scripts_queue_length:0</span><br><span class="line">master0:name=mymaster,status=ok,address=10.10.10.5:6379,slaves=2,sentinels=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä»èŠ‚ç‚¹æŸ¥çœ‹å“¨å…µè¯¦æƒ…ï¼Œå…³æ³¨ä¸»èŠ‚ç‚¹</span></span><br><span class="line">$ redis-cli -h 10.10.10.4 -p 26379</span><br><span class="line">10.10.10.5:26379&gt; sentinel master mymaster</span><br><span class="line"> 1) <span class="string">&quot;name&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;mymaster&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;ip&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;10.10.10.5&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;port&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;6379&quot;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢ä¸»èŠ‚ç‚¹æ‰€åœ¨redis-server</span></span><br><span class="line">node01:</span><br><span class="line">$ systemctl stop redis-server.service</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä»èŠ‚ç‚¹çš„å“¨å…µè¯¦æƒ…ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿‡1åˆ†é’Ÿ~2åˆ†é’Ÿï¼Œä¼šè‡ªåŠ¨é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¾‹å¦‚node03è¢«æ¨ä¸¾ä¸ºä¸»èŠ‚ç‚¹</span></span><br><span class="line">node02:</span><br><span class="line">$ redis-cli -h 10.10.10.4 -p 26379</span><br><span class="line">10.10.10.4:26379&gt; info</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Sentinel</span></span><br><span class="line">sentinel_masters:1</span><br><span class="line">sentinel_tilt:0</span><br><span class="line">sentinel_running_scripts:0</span><br><span class="line">sentinel_scripts_queue_length:0</span><br><span class="line">master0:name=mymaster,status=ok,address=10.10.10.6:6379,slaves=2,sentinels=3</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 10.10.10.6 -p 6379</span><br><span class="line">10.10.10.6:6379&gt; info</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=10.10.10.4,port=6379,state=online,offset=19874,lag=0</span><br><span class="line">master_repl_offset:19874</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨åˆšæ‰è¢«åœæ­¢çš„åŸä¸»èŠ‚ç‚¹redis-serverï¼Œå°†ä½œä¸ºä»èŠ‚ç‚¹åŠ å…¥åˆ°redisé›†ç¾¤</span></span><br><span class="line">node01:</span><br><span class="line">$ systemctl start redis-server</span><br><span class="line">$ redis-cli -h 10.10.10.5 -p 6379</span><br><span class="line">10.10.10.5:6379&gt; info</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:10.10.10.6</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 10.10.10.5 -p 26379</span><br><span class="line">10.10.10.5:26379&gt; info</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Sentinel</span></span><br><span class="line">sentinel_masters:1</span><br><span class="line">sentinel_tilt:0</span><br><span class="line">sentinel_running_scripts:0</span><br><span class="line">sentinel_scripts_queue_length:0</span><br><span class="line">master0:name=mymaster,status=ok,address=10.10.10.6:6379,slaves=2,sentinels=3</span><br></pre></td></tr></table></figure>

<h3 id="å®¢æˆ·ç«¯è¿æ¥Sentinel"><a href="#å®¢æˆ·ç«¯è¿æ¥Sentinel" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥Sentinel"></a>å®¢æˆ·ç«¯è¿æ¥Sentinel</h3><p>é…ç½®å®Œsentinelï¼Œå®¢æˆ·ç«¯è¿æ¥æ–¹å¼å°±æ”¹å˜äº†ï¼Œæ‹¿<a href="https://github.com/redisson/redisson/wiki/2.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95#27-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F">Redisson</a>ä¸¾ä¾‹ï¼Œéœ€è¦å¢åŠ ä»¥ä¸‹é…ç½®ï¼Œå¹¶åˆ é™¤å•æœºæ¨¡å¼ä¸‹<code>spring.redis.host</code>é…ç½®ï¼Œç«¯å£å·æ”¹æˆå“¨å…µçš„ç«¯å£å·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.redis.sentinel.master=mymaster</span><br><span class="line">spring.redis.sentinel.nodes=10.10.10.4:26379,10.10.10.5:26379,10.10.10.6:26379</span><br></pre></td></tr></table></figure>

<p>å¼•å…¥çš„jaræ˜¯</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">compile <span class="string">&quot;org.redisson:redisson-spring-boot-starter:3.9.1&quot;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®ç±»æ‰€åœ¨ä½ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisProperties.Sentinel</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨å‘½ä»¤-1"><a href="#å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start redis</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> redis</span><br><span class="line">$ sudo systemctl restart</span><br><span class="line">$ sudo systemctl stop redis</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><ol>
<li>æœ‰æ—¶å¯èƒ½ä¼šé‡åˆ°å…³é—­æˆ–é‡å¯ä¸äº†ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>redis-cli</code>æä¾›çš„å‘½ä»¤è¡Œæ¥å¼ºåˆ¶å…³é—­</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ redis-cli -h 10.10.10.5 -p 6379</span><br><span class="line">10.10.10.5:6379&gt; shutdown nosave</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://redis.io/commands/SHUTDOWN</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Redis is configured to save RDB snapshots, but is currently not able to persist on disk.</li>
</ol>
<blockquote>
<p>Redisè¢«é…ç½®ä¸ºä¿å­˜æ•°æ®åº“å¿«ç…§ï¼Œä½†å®ƒç›®å‰ä¸èƒ½æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/sysctl.conf</span><br><span class="line"><span class="comment">## æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line">vm.overcommit_memory=1</span><br><span class="line">$ sudo sysctl -p /etc/sysctl.conf</span><br><span class="line"><span class="comment">## é‡å¯æ‰€æœ‰èŠ‚ç‚¹redis-serverå’Œsentinel</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ”¹å¥½åï¼Œè¿˜ä¸è¡Œï¼Œå°±éœ€è¦æŸ¥çœ‹ä¸‹Redisçš„dumpæ–‡ä»¶é…ç½®æ˜¯ä¸æ˜¯è¢«æ›´æ”¹äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ redis-cli -h 10.10.10.5</span><br><span class="line">10.10.10.5:6379&gt; CONFIG GET dbfilename</span><br><span class="line">1) <span class="string">&quot;dbfilename&quot;</span></span><br><span class="line">2) <span class="string">&quot;.rdb&quot;</span> <span class="comment">## é»˜è®¤æ˜¯dump.rdb</span></span><br><span class="line">10.10.10.5:6379&gt; CONFIG GET dir</span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/var/spool/cron&quot;</span> <span class="comment">## é»˜è®¤æ˜¯dump.rdb</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šé…ç½®ï¼Œå¦‚æœä¸æ˜¯è‡ªå·±æ›´æ”¹çš„ï¼Œåˆ™å¯æ€€ç–‘æ˜¯è¢«é»‘å®¢ç¯¡æ”¹äº†</p>
<ol>
<li>æ£€æŸ¥Redisç«¯å£æ˜¯å¦åœ¨å…¬ç½‘å¼€æ”¾ï¼Œå¦‚æœæ˜¯ï¼Œç«‹é©¬å…³é—­</li>
<li>è®¾ç½®Redisè®¿é—®å¯†ç </li>
<li>æ¢å¤Redisé»˜è®¤é…ç½®</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/redis/redis.conf</span><br><span class="line">dbfilename <span class="string">&quot;dump.rdb&quot;</span></span><br><span class="line">dir <span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line">$ service redis-server restart</span><br><span class="line"></span><br><span class="line">node01 node02 node03å‡æŒ‰æ­¤ä¿®æ”¹å¹¶é‡å¯</span><br><span class="line"><span class="comment">## äº†è§£æ›´å¤š https://serverfault.com/questions/800295/redis-spontaneously-failed-failed-opening-rdb-for-saving-permission-denied</span></span><br></pre></td></tr></table></figure>

<h1 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h1><h2 id="å®‰è£…Consulï¼ˆå•æœºï¼‰"><a href="#å®‰è£…Consulï¼ˆå•æœºï¼‰" class="headerlink" title="å®‰è£…Consulï¼ˆå•æœºï¼‰"></a>å®‰è£…Consulï¼ˆå•æœºï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mkdir -p /data/consul/&#123;current/&#123;bin,etc&#125;,data&#125;</span><br><span class="line">$ sudo wget https://releases.hashicorp.com/consul/1.5.3/consul_1.5.3_linux_amd64.zip -O /data/consul/consul_1.5.3_linux_amd64.zip</span><br><span class="line">$ sudo apt-get install unzip</span><br><span class="line">$ sudo unzip /data/consul/consul_1.5.3_linux_amd64.zip -d /data/consul/current/bin</span><br><span class="line">$ sudo vi /data/consul/current/etc/consul.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;bootstrap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;datacenter&quot;</span>: <span class="string">&quot;test-datacenter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data_dir&quot;</span>: <span class="string">&quot;/data/consul/data&quot;</span>,</span><br><span class="line">    <span class="string">&quot;log_level&quot;</span>: <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;client_addr&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ui&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;start_join&quot;</span>: [<span class="string">&quot;ip:8301&quot;</span>],</span><br><span class="line">    <span class="string">&quot;enable_syslog&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/agent/options.html#configuration_files</span></span><br><span class="line"></span><br><span class="line">$ sudo ln -s /data/consul/current/etc /data/consul/etc</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/systemd/system/consul.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=consul service</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/data/consul/current/bin/consul agent -<span class="built_in">bind</span>=&#123;ip&#125; -config-dir /data/consul/etc/consul.json</span><br><span class="line">User=root</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> consul.service</span><br><span class="line">$ sudo systemctl start consul.service</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…Consulï¼ˆé›†ç¾¤ï¼‰"><a href="#å®‰è£…Consulï¼ˆé›†ç¾¤ï¼‰" class="headerlink" title="å®‰è£…Consulï¼ˆé›†ç¾¤ï¼‰"></a>å®‰è£…Consulï¼ˆé›†ç¾¤ï¼‰</h2><table>
<thead>
<tr>
<th align="center">ä¸»æœº</th>
<th align="center">ip</th>
</tr>
</thead>
<tbody><tr>
<td align="center">node01</td>
<td align="center">10.10.10.5</td>
</tr>
<tr>
<td align="center">node02</td>
<td align="center">10.10.10.4</td>
</tr>
<tr>
<td align="center">node03</td>
<td align="center">10.10.10.6</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node01 node02 node03</span><br><span class="line">$ sudo mkdir -p /data/consul/&#123;current/&#123;bin,etc&#125;,data&#125;</span><br><span class="line">$ sudo wget https://releases.hashicorp.com/consul/1.5.3/consul_1.5.3_linux_amd64.zip -O /data/consul/consul_1.5.3_linux_amd64.zip</span><br><span class="line">$ sudo apt-get install unzip</span><br><span class="line">$ sudo unzip /data/consul/consul_1.5.3_linux_amd64.zip -d /data/consul/current/bin</span><br><span class="line">$ sudo vi /data/consul/current/etc/consul.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;datacenter&quot;</span>: <span class="string">&quot;roc-datacenter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data_dir&quot;</span>: <span class="string">&quot;/data/consul/data&quot;</span>,</span><br><span class="line">    <span class="string">&quot;log_level&quot;</span>: <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;bootstrap_expect&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;client_addr&quot;</span>: <span class="string">&quot;10.10.10.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ui&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;start_join&quot;</span>: [<span class="string">&quot;10.10.10.4:8301&quot;</span>,<span class="string">&quot;10.10.10.5:8301&quot;</span>,<span class="string">&quot;10.10.10.6:8301&quot;</span>],</span><br><span class="line">    <span class="string">&quot;enable_syslog&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/agent/options.html#configuration_files</span></span><br><span class="line"></span><br><span class="line">$ sudo ln -s /data/consul/current/etc /data/consul/etc</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/systemd/system/consul.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=consul service</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/data/consul/current/bin/consul agent -config-dir /data/consul/etc/consul.json</span><br><span class="line">User=root</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> consul.service</span><br><span class="line">$ sudo systemctl start consul.service</span><br></pre></td></tr></table></figure>

<p>éœ€è¦å¼€æ”¾çš„ç«¯å£ï¼š8300, 8301, 8500ï¼Œå¦‚æœç½‘ç»œä¸é€šï¼Œåˆ™å­èŠ‚ç‚¹å°†æ— æ³•joinåˆ°ä¸»èŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå‡ºç°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">failed to sync remote state: No cluster leader</span><br></pre></td></tr></table></figure>

<p>æ— æ³•é€‰ä¸¾å‡ºleaderï¼Œå…¶å®æ˜¯èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œå¦‚æœé€šä¿¡æ­£å¸¸ï¼Œå¯åŠ¨ä¹‹æ—¶æ‰€æœ‰èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¨ä¸¾å‡ºleaderã€‚</p>
<h2 id="å¸¸ç”¨å‘½ä»¤-2"><a href="#å¸¸ç”¨å‘½ä»¤-2" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start consul.service</span><br><span class="line">$ sudo systemctl stop consul.service</span><br><span class="line">$ sudo systemctl restart consul.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒï¼šhttps://www.consul.io/docs/commands/index.html</span></span><br></pre></td></tr></table></figure>

<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&quot;deb http://nginx.org/packages/ubuntu/ <span class="subst">$(lsb_release -cs)</span> nginx\ndeb-src http://nginx.org/packages/ubuntu/ <span class="subst">$(lsb_release -cs)</span> nginx&quot;</span> | sudo tee /etc/apt/sources.list.d/nginx.list</span><br><span class="line">$ wget -O- http://nginx.org/keys/nginx_signing.key | sudo apt-key add -</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install nginx</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒï¼šhttp://nginx.org/en/linux_packages.html#stable</span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨å‘½ä»¤-3"><a href="#å¸¸ç”¨å‘½ä»¤-3" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo service nginx start</span><br><span class="line">$ sudo service nginx stop</span><br><span class="line">$ sudo service nginx restart</span><br><span class="line"></span><br><span class="line">$ sudo service nginx reload <span class="comment"># é‡æ–°åŠ è½½é…ç½®</span></span><br></pre></td></tr></table></figure>

<h1 id="Cassandraé›†ç¾¤"><a href="#Cassandraé›†ç¾¤" class="headerlink" title="Cassandraé›†ç¾¤"></a>Cassandraé›†ç¾¤</h1><table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>cassandra-1</td>
<td>192.168.0.1</td>
</tr>
<tr>
<td>cassandra-2</td>
<td>192.168.0.2</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…Cassandra"><a href="#å®‰è£…Cassandra" class="headerlink" title="å®‰è£…Cassandra"></a>å®‰è£…Cassandra</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb http://www.apache.org/dist/cassandra/debian 39x main&quot;</span> | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list</span><br><span class="line">$ curl https://www.apache.org/dist/cassandra/KEYS | sudo apt-key add -</span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt -y install cassandra</span><br><span class="line">$ sudo apt install openjdk-8-jdk-headless</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒï¼šhttp://cassandra.apache.org/download/#installation-from-debian-packages</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶-1"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶-1" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vi /etc/cassandra/cassandra.yaml</span><br><span class="line"></span><br><span class="line">seed_provider:</span><br><span class="line">          - seeds: <span class="string">&quot;192.168.0.1,192.168.0.2&quot;</span></span><br><span class="line"> </span><br><span class="line">concurrent_writes: 64</span><br><span class="line">concurrent_counter_writes: 64</span><br><span class="line">concurrent_counter_writes: 64</span><br><span class="line">concurrent_materialized_view_writes: 64</span><br><span class="line">compaction_throughput_mb_per_sec: 128</span><br><span class="line">file_cache_size_in_mb: 1024</span><br><span class="line">buffer_pool_use_heap_if_exhausted: <span class="literal">true</span></span><br><span class="line">disk_optimization_strategy: spinning</span><br><span class="line"><span class="comment">#listen_address: localhost</span></span><br><span class="line">listen_interface: eth0</span><br><span class="line"><span class="comment">#rpc_address: localhost</span></span><br><span class="line">rpc_interface: eth0</span><br><span class="line">enable_user_defined_functions: <span class="literal">true</span></span><br><span class="line">auto_bootstrap: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¼˜åŒ–cassandra jvmé…ç½®</span></span><br><span class="line">$ sudo vi /etc/cassandra/jvm.options</span><br><span class="line"><span class="comment">#-XX:+UseParNewGC</span></span><br><span class="line"><span class="comment">#-XX:+UseConcMarkSweepGC</span></span><br><span class="line"><span class="comment">#-XX:+CMSParallelRemarkEnabled</span></span><br><span class="line"><span class="comment">#-XX:SurvivorRatio=8</span></span><br><span class="line"><span class="comment">#-XX:MaxTenuringThreshold=1</span></span><br><span class="line"><span class="comment">#-XX:CMSInitiatingOccupancyFraction=75</span></span><br><span class="line"><span class="comment">#-XX:+UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"><span class="comment">#-XX:CMSWaitDuration=10000</span></span><br><span class="line"><span class="comment">#-XX:+CMSParallelInitialMarkEnabled</span></span><br><span class="line"><span class="comment">#-XX:+CMSEdenChunksRecordAlways</span></span><br><span class="line"></span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:G1RSetUpdatingPauseTimePercent=5</span><br><span class="line">-XX:MaxGCPauseMillis=500</span><br><span class="line">-XX:InitiatingHeapOccupancyPercent=70</span><br><span class="line">-XX:ParallelGCThreads=16</span><br><span class="line">-XX:ConcGCThreads=16</span><br><span class="line"></span><br><span class="line">$ sudo vi /etc/cassandra/cassandra-env.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½®ä¸ºä¸»æœºå†…ç½‘åœ°å€</span></span><br><span class="line">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Djava.rmi.server.hostname=192.168.0.1&quot;</span></span><br><span class="line"><span class="comment">#if [ &quot;x$LOCAL_JMX&quot; = &quot;x&quot; ]; then</span></span><br><span class="line"><span class="comment">#      LOCAL_JMX=yes</span></span><br><span class="line"><span class="comment">#  fi</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;x<span class="variable">$LOCAL_JMX</span>&quot;</span> = <span class="string">&quot;x&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      LOCAL_JMX=no</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.authenticate=true&quot;</span></span><br><span class="line">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Dcom.sun.management.jmxremote.authenticate=false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.password.file=/etc/cassandra/jmxremote.password&quot;</span></span><br><span class="line"></span><br><span class="line">$ sudo systemctl stop cassandra</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç§»é…ç½®å¯¼æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰"><a href="#è¿ç§»é…ç½®å¯¼æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="è¿ç§»é…ç½®å¯¼æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰"></a>è¿ç§»é…ç½®å¯¼æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mv /var/lib/cassandra /data/cassandra</span><br><span class="line">$ sudo ln -s /data/cassandra /var/lib/cassandra</span><br><span class="line"></span><br><span class="line">$ sudo systemctl start cassandra</span><br></pre></td></tr></table></figure>

<p>é›†ç¾¤å†…å…¶ä½™æœºå™¨ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä¿®æ”¹å¯¹åº”IP</p>
<h1 id="Zookeeperé›†ç¾¤"><a href="#Zookeeperé›†ç¾¤" class="headerlink" title="Zookeeperé›†ç¾¤"></a>Zookeeperé›†ç¾¤</h1><table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>zk-01</td>
<td>192.168.0.1</td>
</tr>
<tr>
<td>zk-02</td>
<td>192.168.0.2</td>
</tr>
<tr>
<td>zk-03</td>
<td>192.168.0.3</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…Zookeeper"><a href="#å®‰è£…Zookeeper" class="headerlink" title="å®‰è£…Zookeeper"></a>å®‰è£…Zookeeper</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt install zookeeperd</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶-2"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶-2" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo vim /etc/zookeeper/conf/zoo.cfg</span><br><span class="line">server.1=192.168.0.1:2888:3888</span><br><span class="line">server.2=192.168.0.2:2888:3888</span><br><span class="line">server.3=192.168.0.3:2888:3888</span><br><span class="line">$ sudo vim /etc/zookeeper/conf/myid</span><br><span class="line">1</span><br><span class="line"><span class="comment"># æ¯å°ä¸»æœºidå„ä¸ç›¸åŒï¼Œæ¯”å¦‚zk-01=1,zk-02=2,zk-03=3</span></span><br><span class="line">$ sudo systemctl restart zookeeper</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…ZK-UIï¼ˆå¯é€‰ï¼‰"><a href="#å®‰è£…ZK-UIï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å®‰è£…ZK-UIï¼ˆå¯é€‰ï¼‰"></a>å®‰è£…<a href="https://github.com/DeemOpen/zkui">ZK-UI</a>ï¼ˆå¯é€‰ï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…zkui</span></span><br><span class="line">$ <span class="built_in">cd</span> /data &amp;&amp; wget https://github.com/zifangsky/zkui/releases/download/v2.0/zkui-2.0.zip</span><br><span class="line">$ sudo unzip zkui-2.0.zip</span><br><span class="line">$ sudo vi /data/zkui/config.cfg</span><br><span class="line">  </span><br><span class="line">zkServer=192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181</span><br><span class="line">userSet = &#123;<span class="string">&quot;users&quot;</span>: [&#123; <span class="string">&quot;username&quot;</span>:<span class="string">&quot;&lt;username&gt;&quot;</span> , <span class="string">&quot;password&quot;</span>:<span class="string">&quot;&lt;password&gt;&quot;</span>,<span class="string">&quot;role&quot;</span>: <span class="string">&quot;ADMIN&quot;</span> &#125;,&#123; <span class="string">&quot;username&quot;</span>:<span class="string">&quot;appconfig&quot;</span> , <span class="string">&quot;password&quot;</span>:<span class="string">&quot;appconfig&quot;</span>,<span class="string">&quot;role&quot;</span>: <span class="string">&quot;USER&quot;</span> &#125;]&#125;</span><br><span class="line">  </span><br><span class="line">$ <span class="built_in">cd</span> /data/zkui &amp;&amp; sudo bash start.sh</span><br></pre></td></tr></table></figure>

<p>é›†ç¾¤å†…å…¶ä½™æœºå™¨ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤</p>
<h1 id="Kafkaé›†ç¾¤"><a href="#Kafkaé›†ç¾¤" class="headerlink" title="Kafkaé›†ç¾¤"></a>Kafkaé›†ç¾¤</h1><table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>zk-01</td>
<td>192.168.0.1</td>
</tr>
<tr>
<td>zk-02</td>
<td>192.168.0.2</td>
</tr>
<tr>
<td>zk-03</td>
<td>192.168.0.3</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…Kafka"><a href="#å®‰è£…Kafka" class="headerlink" title="å®‰è£…Kafka"></a>å®‰è£…Kafka</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mkdir /data/kafka &amp;&amp; <span class="built_in">cd</span> ~</span><br><span class="line">$ wget <span class="string">&quot;http://www-eu.apache.org/dist/kafka/1.0.1/kafka_2.12-1.0.1.tgz&quot;</span></span><br><span class="line">$ curl http://kafka.apache.org/KEYS | gpg --import</span><br><span class="line">$ wget https://dist.apache.org/repos/dist/release/kafka/1.0.1/kafka_2.12-1.0.1.tgz.asc</span><br><span class="line">$ gpg --verify kafka_2.12-1.0.1.tgz.asc kafka_2.12-1.0.1.tgz</span><br><span class="line">$ sudo tar -xvzf kafka_2.12-1.0.1.tgz --directory /data/kafka --strip-components 1</span><br><span class="line">$ sudo rm -rf kafka_2.12-1.0.1.tgz kafka_2.12-1.0.1.tgz.asc</span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://tecadmin.net/install-apache-kafka-ubuntu/</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶-3"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶-3" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mkdir /data/kafka-logs</span><br><span class="line">$ sudo cp /data/kafka/config/server.properties&#123;,.bak&#125;</span><br><span class="line">$ sudo vim /data/kafka/config/server.properties</span><br><span class="line"> </span><br><span class="line">broker.id=0    <span class="comment"># æ¯å°ä¸»æœºå„ä¸ç›¸åŒ</span></span><br><span class="line">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class="line">advertised.listeners=PLAINTEXT://&lt;ip&gt;:9092</span><br><span class="line">delete.topic.enable = <span class="literal">true</span></span><br><span class="line">leader.imbalance.check.interval.seconds=5  <span class="comment"># leaderä¸å¹³è¡¡æ£€æŸ¥é—´éš”</span></span><br><span class="line">leader.imbalance.per.broker.percentage=1</span><br><span class="line">log.dirs=/data/kafka-logs</span><br><span class="line">offsets.topic.replication.factor=3</span><br><span class="line">log.retention.hours=72</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">zookeeper.connect=192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181</span><br><span class="line">  </span><br><span class="line">$ sudo vim /data/kafka/bin/kafka-server-start.sh</span><br><span class="line"><span class="built_in">export</span> JMX_PORT=12345    <span class="comment"># æš´éœ²jmxç«¯å£ï¼Œç•™å¾…ç›‘æ§ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å†Œä¸ºSystemdæœåŠ¡"><a href="#æ³¨å†Œä¸ºSystemdæœåŠ¡" class="headerlink" title="æ³¨å†Œä¸ºSystemdæœåŠ¡"></a>æ³¨å†Œä¸ºSystemdæœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo adduser --system --no-create-home --disabled-password --disabled-login kafka</span><br><span class="line">$ sudo chown -R kafka:nogroup /data/kafka</span><br><span class="line">$ sudo chown -R kafka:nogroup /data/kafka-logs</span><br><span class="line">  </span><br><span class="line">$ sudo vim /etc/systemd/system/kafka.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=High-available, distributed message broker</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">User=kafka</span><br><span class="line">ExecStart=/data/kafka/bin/kafka-server-start.sh /data/kafka/config/server.properties</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¯ç”¨æœåŠ¡</span></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> kafka.service</span><br><span class="line">$ sudo systemctl start kafka.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ›´å¤šå‚è€ƒ https://kafka.apache.org/quickstart</span></span><br></pre></td></tr></table></figure>

<h2 id="æµ‹è¯•Kafkaçš„ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰"><a href="#æµ‹è¯•Kafkaçš„ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æµ‹è¯•Kafkaçš„ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰"></a>æµ‹è¯•Kafkaçš„ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /data/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br><span class="line">$ /data/kafka/bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class="line">  </span><br><span class="line">$ /data/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt; Hello World</span><br><span class="line">  </span><br><span class="line"><span class="comment"># å¦å¤–ä¸€ä¸ªterminal</span></span><br><span class="line">$ /data/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --from-beginning</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<h2 id="éƒ¨ç½²Kafka-manager"><a href="#éƒ¨ç½²Kafka-manager" class="headerlink" title="éƒ¨ç½²Kafka-manager"></a>éƒ¨ç½²<a href="https://github.com/yahoo/kafka-manager">Kafka-manager</a></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data &amp; sudo wget https://github.com/yahoo/kafka-manager/archive/1.3.3.17.zip</span><br><span class="line">$ sudo unzip kafka-manager-1.3.3.17.zip</span><br><span class="line">$ sudo mv kafka-manager-1.3.3.17 kafka-manager</span><br><span class="line">$ sudo chown -R kafka:nogroup /data/kafka-manager</span><br><span class="line">$ sudo vim /data/kafka-manager/conf/application.conf</span><br><span class="line">kafka-manager.zkhosts=<span class="string">&quot;192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181&quot;</span></span><br><span class="line">basicAuthentication.enabled=<span class="literal">true</span></span><br><span class="line">basicAuthentication.username=<span class="string">&quot;&lt;username&gt;&quot;</span></span><br><span class="line">basicAuthentication.password=<span class="string">&quot;&lt;password&gt;&quot;</span></span><br><span class="line">  </span><br><span class="line">$ sudo vim /etc/systemd/system/kafka-manager.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=High-available, distributed message broker manager</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">User=kafka</span><br><span class="line">ExecStart=/data/kafka-manager/bin/kafka-manager</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¯ç”¨æœåŠ¡</span></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> kafka-manager.service</span><br><span class="line">$ sudo systemctl start kafka-manager.service</span><br></pre></td></tr></table></figure>

<h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><h2 id="å®‰è£…Mysql"><a href="#å®‰è£…Mysql" class="headerlink" title="å®‰è£…Mysql"></a>å®‰è£…Mysql</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure>

<div class="note warning"><p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå°†æç¤ºæ‚¨åˆ›å»ºrootå¯†ç ã€‚è¯·åŠ¡å¿…è®°ä½rootå¯†ç </p>
</div>

<h2 id="é…ç½®Mysql"><a href="#é…ç½®Mysql" class="headerlink" title="é…ç½®Mysql"></a>é…ç½®Mysql</h2><p>è¿è¡Œå®‰å…¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>Disallow root login remotely?</code>ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨rootè´¦å·è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œè¯·é€‰æ‹©No</p>
<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æ¥ä¸‹æ¥æµ‹è¯•ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸäº†</p>
<ol>
<li>è¿è¡ŒçŠ¶æ€</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ systemctl status mysql.service</span><br><span class="line">â— mysql.service - MySQL Community Server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Thu 2019-07-18 23:38:43 PDT; 11min ago</span><br><span class="line"> Main PID: 2948 (mysqld)</span><br><span class="line">    Tasks: 28</span><br><span class="line">   Memory: 142.6M</span><br><span class="line">      CPU: 545ms</span><br><span class="line">   CGroup: /system.slice/mysql.service</span><br><span class="line">           â””â”€2948 /usr/sbin/mysqld</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç™»å½•æŸ¥çœ‹ç‰ˆæœ¬</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -p -u root version</span><br><span class="line">mysqladmin  Ver 8.42 Distrib 5.7.26, <span class="keyword">for</span> Linux on x86_64</span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Server version		5.7.26-0ubuntu0.16.04.1</span><br><span class="line">Protocol version	10</span><br><span class="line">Connection		Localhost via UNIX socket</span><br><span class="line">UNIX socket		/var/run/mysqld/mysqld.sock</span><br><span class="line">Uptime:			12 min 18 sec</span><br><span class="line"></span><br><span class="line">Threads: 1  Questions: 36  Slow queries: 0  Opens: 121  Flush tables: 1  Open tables: 40  Queries per second avg: 0.048</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œï¼ŒMysqlå®‰è£…å®Œæˆï¼</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥ä½œ</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>è¿ç»´</tag>
      </tags>
  </entry>
</search>
